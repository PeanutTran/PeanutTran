var ka=Object.defineProperty;var Ua=(n,t,e)=>t in n?ka(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var v=(n,t,e)=>(Ua(n,typeof t!="symbol"?t+"":t,e),e);import{a as z,E as Qe,g as Na,m as _n,b as fi,i as no,c as bi,d as se,T as oo,e as Ha,f as Wa,h as Qa,j as Ts,S as pn,k as ao,B as Ya,l as $a,n as Xa,o as $s,W as xn,p as Ga,q as ja,C as Va}from"./CoreExtension-3fd98810.js";function Yf(){import.meta.url,import("_").catch(()=>1);async function*n(){}}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();function Ka(){document.getElementById("video-controls"),document.getElementById("video"),document.getElementById("player")}function qa(){var n=document.getElementById("player"),t=document.getElementById("video"),e=document.getElementById("video-controls"),i=document.getElementById("playpause"),s=document.getElementById("mute"),r=document.getElementById("max"),o=document.getElementById("back"),a=document.getElementById("next"),h=document.getElementById("current-time"),l=document.getElementById("end-time"),c=document.getElementById("progress"),u=document.getElementById("progress-bar"),d=t.getAttribute("data-src"),g=0;if(t.controls=!1,Hls.isSupported()){var _=new Hls;_.loadSource(d),_.attachMedia(t),_.on(Hls.Events.MANIFEST_PARSED,function(){t.hidden=!1,t.play(),Za(_),setTimeout(()=>{i.focus()},500)}),_.on(Hls.Events.LEVEL_LOADED,function(T,x){g===0&&((x.details||{}).live?g=1:g=2,g===1&&ih())})}i.addEventListener("click",function(T){t.paused||t.ended?t.play():t.pause()}),s.addEventListener("click",function(T){t.muted=!t.muted,y("mute")}),c.addEventListener("click",function(T){var x=(T.pageX-(this.offsetLeft+this.offsetParent.offsetLeft+n.offsetLeft))/this.offsetWidth;t.currentTime=x*t.duration,h.innerHTML=me(t.currentTime)});function f(){var T=document.getElementById("player"),x=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,m=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;x-T.offsetWidth>40||m-T.offsetHeight>40?(T.style.width="100%",T.style.top="0"):(T.style.width="80%",T.style.top="20px")}r.addEventListener("click",function(T){f()}),o.addEventListener("click",function(T){t.currentTime=Math.max(t.currentTime-10,0),h.innerHTML=me(t.currentTime)}),a.addEventListener("click",function(T){t.currentTime=Math.min(t.currentTime+10,t.duration),h.innerHTML=me(t.currentTime)}),t.addEventListener("loadedmetadata",function(){var T=Math.min(t.currentTime,t.duration);t.currentTime=T,h.innerHTML=me(t.currentTime),l.innerHTML=me(t.duration)}),t.addEventListener("play",function(){y("playpause")},!1),t.addEventListener("pause",function(){y("playpause")},!1),t.addEventListener("timeupdate",function(){c.getAttribute("max")||c.setAttribute("max",t.duration),c.value=t.currentTime,h.innerHTML=me(t.currentTime),u.style.width=Math.floor(t.currentTime/t.duration*100)+"%"});function y(T){T=="playpause"?t.paused||t.ended?(i.setAttribute("data-state","play"),e.classList.add("display-control")):i.setAttribute("data-state","pause"):T=="mute"&&s.setAttribute("data-state",t.muted?"unmute":"mute")}}function Za(n){var t=document.getElementById("quality-btn"),e=document.getElementById("quality");t.addEventListener("click",function(c){h(),e.classList.toggle("show")});var i=n.levels;for(console.log(i);e.firstChild;)e.removeChild(e.firstChild);var s=document.createElement("button");s.setAttribute("data-value",-1),s.setAttribute("class","quality"),s.setAttribute("tabindex","0"),s.setAttribute("id","quality-0"),s.textContent="Auto",e.appendChild(s);for(var r=0;r<i.length;r++){var o=document.createElement("button");o.setAttribute("data-value",r),o.setAttribute("class","quality"),o.setAttribute("tabindex","0"),o.setAttribute("id","quality-"+(r+1)),o.textContent=(i[r].name||i[r].height)+"p",e.appendChild(o)}var a=document.querySelectorAll("#quality button");function h(l){for(var c=0;c<a.length;c++)!l&&c==n.currentLevel+1?n.autoLevelEnabled?(a[0].classList.add("active"),a[c].classList.remove("active")):a[c].classList.add("active"):a[c].classList.remove("active");if(l){var u=parseInt(this.getAttribute("data-value"));n.currentLevel=u,this.classList.add("active")}}for(var r=0;r<a.length;r++)a[r].addEventListener("click",h)}function me(n){var t=Math.floor(n/3600),e=Math.floor(n%3600/60),i=Math.floor(n%60),s="";return t>0&&(s+="".concat(t.toString().padStart(2,"0"),":")),s+="".concat(e.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0")),s}function Ja(n){var t=n||"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",e=document.getElementById("video");e.setAttribute("data-src",t),hh()}function th(){var n=document.getElementById("video");n.hidden=!0,n.pause(),ah();var t=document.getElementById("quality");t.className="dropdown-content",eh()}function eh(){var n=document.getElementById("player"),t=n.cloneNode(!0);n.parentNode.replaceChild(t,n)}function ih(){var n=document.getElementById("time"),t=document.getElementById("live-indicator");n.className="display_none",t.className="",t.setAttribute("data-type","live")}function sh(){var n=document.getElementById("video"),t=document.getElementById("live-indicator"),e=document.getElementById("current-time"),i=t.getAttribute("data-type");i==="video"&&(n.currentTime=Math.max(n.currentTime-10,0),e.innerHTML=me(n.currentTime))}function rh(){var n=document.getElementById("video"),t=document.getElementById("live-indicator"),e=document.getElementById("current-time"),i=t.getAttribute("data-type");i==="video"&&(n.currentTime=Math.min(n.currentTime+10,n.duration),e.innerHTML=me(n.currentTime))}function nh(){var n=document.activeElement.getAttribute("id");if(!n){var t=document.getElementById("playpause");t.focus();return}if(n==="playpause"){var t=document.getElementById("max");t.focus();return}if(n==="max"){var t=document.getElementById("mute");t.focus();return}if(n==="mute"){var t=document.getElementById("quality-btn");t.focus();return}if(n==="quality-btn"){var e=document.getElementById("quality");if(e.className==="dropdown-content show"){var i=document.getElementById("quality-0");i&&i.focus()}return}if(n.includes("quality-")){const s=parseInt(ho(n),10);var e=document.getElementById("quality-"+(s+1));e&&e.focus();return}}function oh(){var n=document.activeElement.getAttribute("id");if(!n){var t=document.getElementById("playpause");t.focus();return}if(n==="max"){var t=document.getElementById("playpause");t.focus();return}if(n==="mute"){var t=document.getElementById("max");t.focus();return}if(n==="quality-btn"){var t=document.getElementById("mute");t.focus();return}if(n.includes("quality-")){const i=parseInt(ho(n),10);if(i===0){var e=document.getElementById("quality-btn");e.focus();return}else{var e=document.getElementById("quality-"+(i-1));e.focus();return}}}function ho(n){var t=n.match(/quality-(\d+)/);return t&&t[1]?parseInt(t[1],10):null}function ah(){var n=document.getElementById("time"),t=document.getElementById("live-indicator");t.className="display_none",n.className="",t.setAttribute("data-type","video")}function hh(){Ka(),qa()}function lh(){var n='<video id="video" tabindex="0" poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArwAAAEsCAYAAAAhNGCdAAAAAXNSR0IArs4c6QAAELlJREFUeF7t1kERAAAIAkHpX9oeN2sDFh/sHAECBAgQIECAAIGwwMLZRCNAgAABAgQIECBwBq8nIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAgQf4tAEt5FxRQwAAAABJRU5ErkJggg==" hidden></video><div id="video-controls" class="controls display-control"><button id="playpause" tabindex="0" type="button" data-state="play"></button><button id="back" tabindex="0" type="button" data-state="back"></button><button id="next" tabindex="0" type="button" data-state="next"></button><button id="max" tabindex="0" type="button" data-state="max"></button><button id="mute" type="button" data-state="mute">Mute/Unmute</button><div class="dropdown"><button id="quality-btn" class="dropbtn btn-settings"></button><div id="quality" class="dropdown-content"></div></div><div data-type="video" id="live-indicator" class="display_none"><span id="red-dot"></span><span id="live-text">Live</span></div><div id="time"><span id="current-time">10:11</span>/<span id="end-time">11:23</span></div><div class="progress"><progress id="progress" tabindex="0" value="0" min="0"><span id="progress-bar"></span></progress></div></div>',t=document.getElementById("app"),e=document.createElement("div");e.id="player",e.innerHTML=n.trim(),t.parentNode.insertBefore(e,t.nextSibling)}document.addEventListener("DOMContentLoaded",lh);const lo=(n,t)=>n===t,es=Symbol("solid-proxy"),ch=Symbol("solid-track"),is={equals:lo};let co=po;const $t=1,ss=2,uo={owned:null,cleanups:null,context:null,owner:null},Xs={};var $=null;let Gs=null,X=null,pt=null,te=null,Cs=0;function ii(n,t){const e=X,i=$,s=n.length===0,r=t===void 0?i:t,o=s?uo:{owned:null,cleanups:null,context:r?r.context:null,owner:r},a=s?n:()=>n(()=>At(()=>Es(o)));$=o,X=null;try{return ee(a,!0)}finally{X=e,$=i}}function Y(n,t){t=t?Object.assign({},is,t):is;const e={value:n,observers:null,observerSlots:null,comparator:t.equals||void 0},i=s=>(typeof s=="function"&&(s=s(e.value)),_o(e,s));return[go.bind(e),i]}function rr(n,t,e){const i=Ei(n,t,!0,$t);Ye(i)}function Kt(n,t,e){const i=Ei(n,t,!1,$t);Ye(i)}function Rt(n,t,e){co=mh;const i=Ei(n,t,!1,$t),s=nr&&bs(nr);s&&(i.suspense=s),(!e||!e.render)&&(i.user=!0),te?te.push(i):Ye(i)}function lt(n,t,e){e=e?Object.assign({},is,e):is;const i=Ei(n,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=e.equals||void 0,Ye(i),go.bind(i)}function uh(n){return n&&typeof n=="object"&&"then"in n}function Rr(n,t,e){let i,s,r;arguments.length===2&&typeof t=="object"||arguments.length===1?(i=!0,s=n,r=t||{}):(i=n,s=t,r=e||{});let o=null,a=Xs,h=!1,l="initialValue"in r,c=typeof i=="function"&&lt(i);const u=new Set,[d,g]=(r.storage||Y)(r.initialValue),[_,f]=Y(void 0),[y,T]=Y(void 0,{equals:!1}),[x,m]=Y(l?"ready":"unresolved");function p(S,A,E,F){return o===S&&(o=null,F!==void 0&&(l=!0),(S===a||A===a)&&r.onHydrated&&queueMicrotask(()=>r.onHydrated(F,{value:A})),a=Xs,w(A,E)),A}function w(S,A){ee(()=>{A===void 0&&g(()=>S),m(A!==void 0?"errored":l?"ready":"unresolved"),f(A);for(const E of u.keys())E.decrement();u.clear()},!1)}function R(){const S=nr,A=d(),E=_();if(E!==void 0&&!o)throw E;return X&&!X.user&&S&&rr(()=>{y(),o&&(S.resolved||u.has(S)||(S.increment(),u.add(S)))}),A}function I(S=!0){if(S!==!1&&h)return;h=!1;const A=c?c():i;if(A==null||A===!1){p(o,At(d));return}const E=a!==Xs?a:At(()=>s(A,{value:d(),refetching:S}));return uh(E)?(o=E,"value"in E?(E.status==="success"?p(o,E.value,void 0,A):p(o,void 0,void 0,A),E):(h=!0,queueMicrotask(()=>h=!1),ee(()=>{m(l?"refreshing":"pending"),T()},!1),E.then(F=>p(E,F,void 0,A),F=>p(E,void 0,mo(F),A)))):(p(o,E,void 0,A),E)}return Object.defineProperties(R,{state:{get:()=>x()},error:{get:()=>_()},loading:{get(){const S=x();return S==="pending"||S==="refreshing"}},latest:{get(){if(!l)return R();const S=_();if(S&&!o)throw S;return d()}}}),c?rr(()=>I(!1)):I(!1),[R,{refetch:I,mutate:g}]}function oi(n,t=lo,e){const i=new Map,s=Ei(r=>{const o=n();for(const[a,h]of i.entries())if(t(a,o)!==t(a,r))for(const l of h.values())l.state=$t,l.pure?pt.push(l):te.push(l);return o},void 0,!0,$t);return Ye(s),r=>{const o=X;if(o){let a;(a=i.get(r))?a.add(o):i.set(r,a=new Set([o])),Te(()=>{a.delete(o),!a.size&&i.delete(r)})}return t(r,s.value)}}function dh(n){return ee(n,!1)}function At(n){if(X===null)return n();const t=X;X=null;try{return n()}finally{X=t}}function Xt(n,t,e){const i=Array.isArray(n);let s,r=e&&e.defer;return o=>{let a;if(i){a=Array(n.length);for(let l=0;l<n.length;l++)a[l]=n[l]()}else a=n();if(r){r=!1;return}const h=At(()=>t(a,s,o));return s=a,h}}function fh(n){Rt(()=>At(n))}function Te(n){return $===null||($.cleanups===null?$.cleanups=[n]:$.cleanups.push(n)),n}function ws(){return $}function gh(n,t){const e=$,i=X;$=n,X=null;try{return ee(t,!0)}catch(s){Lr(s)}finally{$=e,X=i}}function _h(n){const t=X,e=$;return Promise.resolve().then(()=>{X=t,$=e;let i;return ee(n,!1),X=$=null,i?i.done:void 0})}function fo(n,t){const e=Symbol("context");return{id:e,Provider:yh(e),defaultValue:n}}function bs(n){return $&&$.context&&$.context[n.id]!==void 0?$.context[n.id]:n.defaultValue}function Ir(n){const t=lt(n),e=lt(()=>or(t()));return e.toArray=()=>{const i=e();return Array.isArray(i)?i:i!=null?[i]:[]},e}let nr;function go(){if(this.sources&&this.state)if(this.state===$t)Ye(this);else{const n=pt;pt=null,ee(()=>ns(this),!1),pt=n}if(X){const n=this.observers?this.observers.length:0;X.sources?(X.sources.push(this),X.sourceSlots.push(n)):(X.sources=[this],X.sourceSlots=[n]),this.observers?(this.observers.push(X),this.observerSlots.push(X.sources.length-1)):(this.observers=[X],this.observerSlots=[X.sources.length-1])}return this.value}function _o(n,t,e){let i=n.value;return(!n.comparator||!n.comparator(i,t))&&(n.value=t,n.observers&&n.observers.length&&ee(()=>{for(let s=0;s<n.observers.length;s+=1){const r=n.observers[s],o=Gs&&Gs.running;o&&Gs.disposed.has(r),(o?!r.tState:!r.state)&&(r.pure?pt.push(r):te.push(r),r.observers&&xo(r)),o||(r.state=$t)}if(pt.length>1e6)throw pt=[],new Error},!1)),t}function Ye(n){if(!n.fn)return;Es(n);const t=Cs;ph(n,n.value,t)}function ph(n,t,e){let i;const s=$,r=X;X=$=n;try{i=n.fn(t)}catch(o){return n.pure&&(n.state=$t,n.owned&&n.owned.forEach(Es),n.owned=null),n.updatedAt=e+1,Lr(o)}finally{X=r,$=s}(!n.updatedAt||n.updatedAt<=e)&&(n.updatedAt!=null&&"observers"in n?_o(n,i):n.value=i,n.updatedAt=e)}function Ei(n,t,e,i=$t,s){const r={fn:n,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:$,context:$?$.context:null,pure:e};return $===null||$!==uo&&($.owned?$.owned.push(r):$.owned=[r]),r}function rs(n){if(n.state===0)return;if(n.state===ss)return ns(n);if(n.suspense&&At(n.suspense.inFallback))return n.suspense.effects.push(n);const t=[n];for(;(n=n.owner)&&(!n.updatedAt||n.updatedAt<Cs);)n.state&&t.push(n);for(let e=t.length-1;e>=0;e--)if(n=t[e],n.state===$t)Ye(n);else if(n.state===ss){const i=pt;pt=null,ee(()=>ns(n,t[0]),!1),pt=i}}function ee(n,t){if(pt)return n();let e=!1;t||(pt=[]),te?e=!0:te=[],Cs++;try{const i=n();return xh(e),i}catch(i){e||(te=null),pt=null,Lr(i)}}function xh(n){if(pt&&(po(pt),pt=null),n)return;const t=te;te=null,t.length&&ee(()=>co(t),!1)}function po(n){for(let t=0;t<n.length;t++)rs(n[t])}function mh(n){let t,e=0;for(t=0;t<n.length;t++){const i=n[t];i.user?n[e++]=i:rs(i)}for(t=0;t<e;t++)rs(n[t])}function ns(n,t){n.state=0;for(let e=0;e<n.sources.length;e+=1){const i=n.sources[e];if(i.sources){const s=i.state;s===$t?i!==t&&(!i.updatedAt||i.updatedAt<Cs)&&rs(i):s===ss&&ns(i,t)}}}function xo(n){for(let t=0;t<n.observers.length;t+=1){const e=n.observers[t];e.state||(e.state=ss,e.pure?pt.push(e):te.push(e),e.observers&&xo(e))}}function Es(n){let t;if(n.sources)for(;n.sources.length;){const e=n.sources.pop(),i=n.sourceSlots.pop(),s=e.observers;if(s&&s.length){const r=s.pop(),o=e.observerSlots.pop();i<s.length&&(r.sourceSlots[o]=i,s[i]=r,e.observerSlots[i]=o)}}if(n.owned){for(t=n.owned.length-1;t>=0;t--)Es(n.owned[t]);n.owned=null}if(n.cleanups){for(t=n.cleanups.length-1;t>=0;t--)n.cleanups[t]();n.cleanups=null}n.state=0}function mo(n){return n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error",{cause:n})}function Lr(n,t=$){throw mo(n)}function or(n){if(typeof n=="function"&&!n.length)return or(n());if(Array.isArray(n)){const t=[];for(let e=0;e<n.length;e++){const i=or(n[e]);Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}return n}function yh(n,t){return function(i){let s;return Kt(()=>s=At(()=>($.context={...$.context,[n]:i.value},Ir(()=>i.children))),void 0),s}}const vh=Symbol("fallback");function mn(n){for(let t=0;t<n.length;t++)n[t]()}function Ah(n,t,e={}){let i=[],s=[],r=[],o=0,a=t.length>1?[]:null;return Te(()=>mn(r)),()=>{let h=n()||[],l,c;return h[ch],At(()=>{let d=h.length,g,_,f,y,T,x,m,p,w;if(d===0)o!==0&&(mn(r),r=[],i=[],s=[],o=0,a&&(a=[])),e.fallback&&(i=[vh],s[0]=ii(R=>(r[0]=R,e.fallback())),o=1);else if(o===0){for(s=new Array(d),c=0;c<d;c++)i[c]=h[c],s[c]=ii(u);o=d}else{for(f=new Array(d),y=new Array(d),a&&(T=new Array(d)),x=0,m=Math.min(o,d);x<m&&i[x]===h[x];x++);for(m=o-1,p=d-1;m>=x&&p>=x&&i[m]===h[p];m--,p--)f[p]=s[m],y[p]=r[m],a&&(T[p]=a[m]);for(g=new Map,_=new Array(p+1),c=p;c>=x;c--)w=h[c],l=g.get(w),_[c]=l===void 0?-1:l,g.set(w,c);for(l=x;l<=m;l++)w=i[l],c=g.get(w),c!==void 0&&c!==-1?(f[c]=s[l],y[c]=r[l],a&&(T[c]=a[l]),c=_[c],g.set(w,c)):r[l]();for(c=x;c<d;c++)c in f?(s[c]=f[c],r[c]=y[c],a&&(a[c]=T[c],a[c](c))):s[c]=ii(u);s=s.slice(0,o=d),i=h.slice(0)}return s});function u(d){if(r[c]=d,a){const[g,_]=Y(c);return a[c]=_,t(h[c],g)}return t(h[c])}}}function yo(n,t){return At(()=>n(t||{}))}function Mi(){return!0}const ar={get(n,t,e){return t===es?e:n.get(t)},has(n,t){return t===es?!0:n.has(t)},set:Mi,deleteProperty:Mi,getOwnPropertyDescriptor(n,t){return{configurable:!0,enumerable:!0,get(){return n.get(t)},set:Mi,deleteProperty:Mi}},ownKeys(n){return n.keys()}};function js(n){return(n=typeof n=="function"?n():n)?n:{}}function Sh(){for(let n=0,t=this.length;n<t;++n){const e=this[n]();if(e!==void 0)return e}}function Pr(...n){let t=!1;for(let r=0;r<n.length;r++){const o=n[r];t=t||!!o&&es in o,n[r]=typeof o=="function"?(t=!0,lt(o)):o}if(t)return new Proxy({get(r){for(let o=n.length-1;o>=0;o--){const a=js(n[o])[r];if(a!==void 0)return a}},has(r){for(let o=n.length-1;o>=0;o--)if(r in js(n[o]))return!0;return!1},keys(){const r=[];for(let o=0;o<n.length;o++)r.push(...Object.keys(js(n[o])));return[...new Set(r)]}},ar);const e={},i={},s=new Set;for(let r=n.length-1;r>=0;r--){const o=n[r];if(!o)continue;const a=Object.getOwnPropertyNames(o);for(let h=0,l=a.length;h<l;h++){const c=a[h];if(c==="__proto__"||c==="constructor")continue;const u=Object.getOwnPropertyDescriptor(o,c);if(!s.has(c))u.get?(s.add(c),Object.defineProperty(e,c,{enumerable:!0,configurable:!0,get:Sh.bind(i[c]=[u.get.bind(o)])})):(u.value!==void 0&&s.add(c),e[c]=u.value);else{const d=i[c];d?u.get?d.push(u.get.bind(o)):u.value!==void 0&&d.push(()=>u.value):e[c]===void 0&&(e[c]=u.value)}}}return e}function Th(n,...t){if(es in n){const s=new Set(t.length>1?t.flat():t[0]),r=t.map(o=>new Proxy({get(a){return o.includes(a)?n[a]:void 0},has(a){return o.includes(a)&&a in n},keys(){return o.filter(a=>a in n)}},ar));return r.push(new Proxy({get(o){return s.has(o)?void 0:n[o]},has(o){return s.has(o)?!1:o in n},keys(){return Object.keys(n).filter(o=>!s.has(o))}},ar)),r}const e={},i=t.map(()=>({}));for(const s of Object.getOwnPropertyNames(n)){const r=Object.getOwnPropertyDescriptor(n,s),o=!r.get&&!r.set&&r.enumerable&&r.writable&&r.configurable;let a=!1,h=0;for(const l of t)l.includes(s)&&(a=!0,o?i[h][s]=r.value:Object.defineProperty(i[h],s,r)),++h;a||(o?e[s]=r.value:Object.defineProperty(e,s,r))}return[...i,e]}const Ch=n=>"Stale read from <".concat(n,">.");function Me(n){const t="fallback"in n&&{fallback:()=>n.fallback};return lt(Ah(()=>n.each,n.children,t||void 0))}function le(n){const t=n.keyed,e=lt(()=>n.when,void 0,{equals:(i,s)=>t?i===s:!i==!s});return lt(()=>{const i=e();if(i){const s=n.children;return typeof s=="function"&&s.length>0?At(()=>s(t?i:()=>{if(!At(e))throw Ch("Show");return n.when})):s}return n.fallback},void 0,void 0)}const wh=void 0,[ce,vo]=Y(null);class Ao{constructor(t){v(this,"releaseCallback");this.releaseCallback=t}}class bh extends Ao{constructor(e,i){var s,r;super(e);v(this,"textureMap",new Map);v(this,"zeroReferenceTextureSet",new Set);v(this,"options");this.options={textureCleanupIntervalMs:(s=i.textureCleanupIntervalMs)!=null?s:1e4,textureCleanupAgeThreadholdMs:(r=i.textureCleanupAgeThreadholdMs)!=null?r:6e4},setInterval(()=>{const o=Date.now(),a=this.options.textureCleanupAgeThreadholdMs;for(const h of this.zeroReferenceTextureSet)o-h.lastUpdate>a&&(this.releaseCallback(h.id),this.textureMap.delete(h.id),this.zeroReferenceTextureSet.delete(h))},this.options.textureCleanupIntervalMs)}registerTexture(e){var s;const i=(s=e.options)==null?void 0:s.id;if(z(i,"Texture must have an id to be registered"),!this.textureMap.has(i)){const r={id:i,nodeRefCount:0,lastUpdate:Date.now()};this.textureMap.set(i,r),this.zeroReferenceTextureSet.add(r)}}incrementTextureRefCount(e){var r;const i=(r=e.options)==null?void 0:r.id;z(i,"Texture must have an id to be registered");let s=this.textureMap.get(i);s||(this.registerTexture(e),s=this.textureMap.get(i)),z(s,"Texture must have been registered"),e.txType==="SubTexture"&&this.incrementTextureRefCount(e.props.texture),s.nodeRefCount++,s.lastUpdate=Date.now(),this.zeroReferenceTextureSet.has(s)&&this.zeroReferenceTextureSet.delete(s)}decrementTextureRefCount(e){var r;const i=(r=e.options)==null?void 0:r.id;z(i,"Texture must have an id to be registered");const s=this.textureMap.get(i);z(s,"Texture must have been registered"),s.nodeRefCount--,s.lastUpdate=Date.now(),s.nodeRefCount===0&&this.zeroReferenceTextureSet.add(s),e.txType==="SubTexture"&&this.decrementTextureRefCount(e.props.texture)}}class Eh extends Ao{constructor(e){super(e);v(this,"registry");this.registry=new FinalizationRegistry(e)}registerTexture(e){var i,s;z((i=e.options)==null?void 0:i.id,"Texture must have an ID to be registered"),this.registry.register(e,(s=e.options)==null?void 0:s.id)}incrementTextureRefCount(){}decrementTextureRefCount(){}}class Rh extends Qe{constructor(e,i,s){var y,T;super();v(this,"root",null);v(this,"driver");v(this,"canvas");v(this,"settings");v(this,"nodes",new Map);v(this,"nextTextureId",1);v(this,"textureTracker");const r={appWidth:e.appWidth||1920,appHeight:e.appHeight||1080,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:(y=e.clearColor)!=null?y:0,coreExtensionModule:e.coreExtensionModule||null,experimental_FinalizationRegistryTextureUsageTracker:(T=e.experimental_FinalizationRegistryTextureUsageTracker)!=null?T:!1,textureCleanupOptions:e.textureCleanupOptions||{},fpsUpdateInterval:e.fpsUpdateInterval||0};this.settings=r;const{appWidth:o,appHeight:a,deviceLogicalPixelRatio:h,devicePhysicalPixelRatio:l}=r,c=x=>{this.driver.releaseTexture(x)},u=r.experimental_FinalizationRegistryTextureUsageTracker&&typeof FinalizationRegistry=="function";this.textureTracker=u?new Eh(c):new bh(c,this.settings.textureCleanupOptions);const d=o*h,g=a*h;this.driver=s;const _=document.createElement("canvas");this.canvas=_,_.width=d*l,_.height=g*l,_.style.width="".concat(d,"px"),_.style.height="".concat(g,"px");let f;if(typeof i=="string"?f=document.getElementById(i):f=i,!f)throw new Error("Could not find target element");s.onCreateNode=x=>{this.nodes.set(x.id,x)},s.onBeforeDestroyNode=x=>{this.nodes.delete(x.id)},s.onFpsUpdate=x=>{this.emit("fpsUpdate",x)},f.appendChild(_)}async init(){await this.driver.init(this,this.settings,this.canvas),this.root=this.driver.getRootNode()}createNode(e){return this.driver.createNode(this.resolveNodeDefaults(e))}createTextNode(e){var i,s,r,o,a,h,l,c,u,d,g,_,f,y;return this.driver.createTextNode({...this.resolveNodeDefaults(e),text:(i=e.text)!=null?i:"",textRendererOverride:(s=e.textRendererOverride)!=null?s:null,fontSize:(r=e.fontSize)!=null?r:16,fontFamily:(o=e.fontFamily)!=null?o:"sans-serif",fontStyle:(a=e.fontStyle)!=null?a:"normal",fontWeight:(h=e.fontWeight)!=null?h:"normal",fontStretch:(l=e.fontStretch)!=null?l:"normal",textAlign:(c=e.textAlign)!=null?c:"left",contain:(u=e.contain)!=null?u:"none",scrollable:(d=e.scrollable)!=null?d:!1,scrollY:(g=e.scrollY)!=null?g:0,offsetY:(_=e.offsetY)!=null?_:0,letterSpacing:(f=e.letterSpacing)!=null?f:0,debug:(y=e.debug)!=null?y:{}})}resolveNodeDefaults(e){var h,l,c,u,d,g,_,f,y,T,x,m,p,w,R,I,S,A,E,F,L,k,V,j,gt,ut,It,Wt,li,Pi,Fi,be,jt,zt,dt,Z,fe,Tt,ge,Bi,zi,Ee,Re,Ie,ci;const i=(h=e.color)!=null?h:4294967295,s=(u=(c=(l=e.colorTl)!=null?l:e.colorTop)!=null?c:e.colorLeft)!=null?u:i,r=(_=(g=(d=e.colorTr)!=null?d:e.colorTop)!=null?g:e.colorRight)!=null?_:i,o=(T=(y=(f=e.colorBl)!=null?f:e.colorBottom)!=null?y:e.colorLeft)!=null?T:i,a=(p=(m=(x=e.colorBr)!=null?x:e.colorBottom)!=null?m:e.colorRight)!=null?p:i;return{x:(w=e.x)!=null?w:0,y:(R=e.y)!=null?R:0,width:(I=e.width)!=null?I:0,height:(S=e.height)!=null?S:0,alpha:(A=e.alpha)!=null?A:1,clipping:(E=e.clipping)!=null?E:!1,color:i,colorTop:(F=e.colorTop)!=null?F:i,colorBottom:(L=e.colorBottom)!=null?L:i,colorLeft:(k=e.colorLeft)!=null?k:i,colorRight:(V=e.colorRight)!=null?V:i,colorBl:o,colorBr:a,colorTl:s,colorTr:r,zIndex:(j=e.zIndex)!=null?j:0,zIndexLocked:(gt=e.zIndexLocked)!=null?gt:0,parent:(ut=e.parent)!=null?ut:null,texture:(It=e.texture)!=null?It:null,shader:(Wt=e.shader)!=null?Wt:null,src:(li=e.src)!=null?li:"",scale:(Pi=e.scale)!=null?Pi:null,scaleX:(be=(Fi=e.scaleX)!=null?Fi:e.scale)!=null?be:1,scaleY:(zt=(jt=e.scaleY)!=null?jt:e.scale)!=null?zt:1,mount:(dt=e.mount)!=null?dt:0,mountX:(fe=(Z=e.mountX)!=null?Z:e.mount)!=null?fe:0,mountY:(ge=(Tt=e.mountY)!=null?Tt:e.mount)!=null?ge:0,pivot:(Bi=e.pivot)!=null?Bi:.5,pivotX:(Ee=(zi=e.pivotX)!=null?zi:e.pivot)!=null?Ee:.5,pivotY:(Ie=(Re=e.pivotY)!=null?Re:e.pivot)!=null?Ie:.5,rotation:(ci=e.rotation)!=null?ci:0}}destroyNode(e){return this.driver.destroyNode(e)}createTexture(e,i,s){const r=this.nextTextureId++,o={descType:"texture",txType:e,props:i,options:{...s,id:r}};return this.textureTracker.registerTexture(o),o}createShader(e,i){return{descType:"shader",shType:e,props:i}}getNodeById(e){return this.nodes.get(e)||null}toggleFreeze(){throw new Error("Not implemented")}advanceFrame(){throw new Error("Not implemented")}rerender(){throw new Error("Not implemented")}}class Ih extends Qe{constructor(e,i,s){super();v(this,"node");v(this,"props");v(this,"settings");v(this,"propStartValues",{});v(this,"restoreValues",{});v(this,"progress",0);v(this,"timingFunction");v(this,"propsList");this.node=e,this.props=i,this.settings=s,this.propStartValues={},this.propsList=Object.keys(i),this.propsList.forEach(r=>{this.propStartValues[r]=e[r]}),this.timingFunction=r=>r,s.easing&&typeof s.easing=="string"&&(this.timingFunction=Na(s.easing))}reset(){this.progress=0,this.update(0)}restore(){this.reset(),Object.keys(this.props).forEach(e=>{this.node[e]=this.propStartValues[e]})}reverse(){this.progress=0,Object.keys(this.props).forEach(e=>{const i=this.props[e],s=this.propStartValues[e];this.props[e]=s,this.propStartValues[e]=i}),this.settings.loop||(this.settings.stopMethod=!1)}applyEasing(e,i,s){return(this.timingFunction(e)||e)*(s-i)+i}update(e){const{duration:i,loop:s,easing:r,stopMethod:o}=this.settings;if(!i){this.emit("finished",{});return}if(this.progress+=e/i,this.progress>1&&(this.progress=s?0:1,o)){this.emit("finished",{});return}for(let a=0;a<this.propsList.length;a++){const h=this.propsList[a],l=this.props[h],c=this.propStartValues[h],u=l;if(h.indexOf("color")!==-1){if(c===u){this.node[h]=c;continue}if(r){const d=this.timingFunction(this.progress)||this.progress,g=_n(c,u,d);this.node[h]=g;continue}this.node[h]=_n(c,u,this.progress);continue}if(r){this.node[h]=this.applyEasing(this.progress,c,u);continue}this.node[h]=c+(u-c)*this.progress}this.progress===1&&this.emit("finished",{})}}class Lh{constructor(t,e){v(this,"manager");v(this,"animation");v(this,"stoppedPromise",null);v(this,"stoppedResolve",null);v(this,"state");this.manager=t,this.animation=e,this.state="stopped"}start(){return this.makeStoppedPromise(),this.animation.once("finished",this.finished.bind(this)),this.manager.activeAnimations.has(this.animation)||this.manager.registerAnimation(this.animation),this.state="running",this}stop(){return this.manager.unregisterAnimation(this.animation),this.stoppedResolve!==null&&(this.stoppedResolve(),this.stoppedResolve=null),this.animation.reset(),this.state="stopped",this}pause(){return this.manager.unregisterAnimation(this.animation),this.state="paused",this}restore(){return this.stoppedResolve=null,this.animation.restore(),this}waitUntilStopped(){this.makeStoppedPromise();const t=this.stoppedPromise;return z(t),t}makeStoppedPromise(){this.stoppedResolve===null&&(this.stoppedPromise=new Promise(t=>{this.stoppedResolve=t}))}finished(){z(this.stoppedResolve);const{loop:t,stopMethod:e}=this.animation.settings;if(e==="reverse"){this.animation.reverse(),this.start();return}this.stoppedResolve(),this.stoppedResolve=null,!t&&this.manager.unregisterAnimation(this.animation)}}const rt=0,nt=3,vt=6,et=1,ot=4,Ct=7,Mt=2,Ot=5,Dt=8;class Nt{constructor(t){v(this,"data");t?(this.data=new Float32Array(9),this.data[rt]=t[0],this.data[nt]=t[3],this.data[vt]=t[6],this.data[et]=t[1],this.data[ot]=t[4],this.data[Ct]=t[7],this.data[Mt]=t[2],this.data[Ot]=t[5],this.data[Dt]=t[8]):this.data=new Float32Array(9)}static get temp(){return Ph}static multiply(t,e,i){const s=t.data[rt]*e.data[rt]+t.data[nt]*e.data[et]+t.data[vt]*e.data[Mt],r=t.data[rt]*e.data[nt]+t.data[nt]*e.data[ot]+t.data[vt]*e.data[Ot],o=t.data[rt]*e.data[vt]+t.data[nt]*e.data[Ct]+t.data[vt]*e.data[Dt],a=t.data[et]*e.data[rt]+t.data[ot]*e.data[et]+t.data[Ct]*e.data[Mt],h=t.data[et]*e.data[nt]+t.data[ot]*e.data[ot]+t.data[Ct]*e.data[Ot],l=t.data[et]*e.data[vt]+t.data[ot]*e.data[Ct]+t.data[Ct]*e.data[Dt],c=t.data[Mt]*e.data[rt]+t.data[Ot]*e.data[et]+t.data[Dt]*e.data[Mt],u=t.data[Mt]*e.data[nt]+t.data[Ot]*e.data[ot]+t.data[Dt]*e.data[Ot],d=t.data[Mt]*e.data[vt]+t.data[Ot]*e.data[Ct]+t.data[Dt]*e.data[Dt];return i||(i=new Nt),i.data[rt]=s,i.data[nt]=r,i.data[vt]=o,i.data[et]=a,i.data[ot]=h,i.data[Ct]=l,i.data[Mt]=c,i.data[Ot]=u,i.data[Dt]=d,i}static identity(t){return t||(t=new Nt),t.data[rt]=1,t.data[nt]=0,t.data[vt]=0,t.data[et]=0,t.data[ot]=1,t.data[Ct]=0,t.data[Mt]=0,t.data[Ot]=0,t.data[Dt]=1,t}static translate(t,e,i){return i||(i=new Nt),i.data[rt]=1,i.data[nt]=0,i.data[vt]=t,i.data[et]=0,i.data[ot]=1,i.data[Ct]=e,i.data[Mt]=0,i.data[Ot]=0,i.data[Dt]=1,i}static scale(t,e,i){return i||(i=new Nt),i.data[rt]=t,i.data[nt]=0,i.data[vt]=0,i.data[et]=0,i.data[ot]=e,i.data[Ct]=0,i.data[Mt]=0,i.data[Ot]=0,i.data[Dt]=1,i}static rotate(t,e){const i=Math.cos(t),s=Math.sin(t);return e||(e=new Nt),e.data[rt]=i,e.data[nt]=-s,e.data[vt]=0,e.data[et]=s,e.data[ot]=i,e.data[Ct]=0,e.data[Mt]=0,e.data[Ot]=0,e.data[Dt]=1,e}static copy(t,e,i){return e||(e=new Nt),e.data[0]=t.data[0],e.data[1]=t.data[1],e.data[2]=t.data[2],e.data[3]=t.data[3],e.data[4]=t.data[4],e.data[5]=t.data[5],e.data[6]=t.data[6],e.data[7]=t.data[7],e.data[8]=t.data[8],e}translate(t,e){return this.data[vt]=this.data[rt]*t+this.data[nt]*e+this.data[vt],this.data[Ct]=this.data[et]*t+this.data[ot]*e+this.data[Ct],this}scale(t,e){return this.data[rt]=this.data[rt]*t,this.data[nt]=this.data[nt]*e,this.data[et]=this.data[et]*t,this.data[ot]=this.data[ot]*e,this}rotate(t){if(t===0||!(t%Math.PI*2))return this;const e=Math.cos(t),i=Math.sin(t),s=this.data[rt]*e+this.data[nt]*i,r=this.data[nt]*e-this.data[rt]*i,o=this.data[et]*e+this.data[ot]*i,a=this.data[ot]*e-this.data[et]*i;return this.data[rt]=s,this.data[nt]=r,this.data[et]=o,this.data[ot]=a,this}multiply(t){return Nt.multiply(this,t,this)}get tx(){return this.data[vt]}get ty(){return this.data[Ct]}get ta(){return this.data[rt]}get tb(){return this.data[nt]}get tc(){return this.data[et]}get td(){return this.data[ot]}transformPoint(t,e){return[this.data[rt]*t+this.data[nt]*e+this.data[vt],this.data[et]*t+this.data[ot]*e+this.data[et]]}}const Ph=new Nt;var B;(function(n){n[n.Children=1]="Children",n[n.ScaleRotate=2]="ScaleRotate",n[n.Local=4]="Local",n[n.Global=8]="Global",n[n.Clipping=16]="Clipping",n[n.CalculatedZIndex=32]="CalculatedZIndex",n[n.ZIndexSortedChildren=64]="ZIndexSortedChildren",n[n.PremultipliedColors=128]="PremultipliedColors",n[n.WorldAlpha=256]="WorldAlpha",n[n.None=0]="None",n[n.All=511]="All"})(B||(B={}));class Fr extends Qe{constructor(e,i){super();v(this,"stage");v(this,"children",[]);v(this,"props");v(this,"updateType",B.All);v(this,"globalTransform");v(this,"scaleRotateTransform");v(this,"localTransform");v(this,"clippingRect",null);v(this,"isRenderable",!1);v(this,"parentClippingRect",null);v(this,"worldAlpha",1);v(this,"premultipliedColorTl",0);v(this,"premultipliedColorTr",0);v(this,"premultipliedColorBl",0);v(this,"premultipliedColorBr",0);v(this,"calcZIndex",0);v(this,"isComplex",!1);v(this,"onTextureLoaded",(e,i)=>{this.stage.requestRender(),this.emit("loaded",{type:"texture",dimensions:i})});v(this,"onTextureFailed",(e,i)=>{this.emit("failed",{type:"texture",error:i})});this.stage=e,this.props={...i,parent:null},this.parent=i.parent,this.updateScaleRotateTransform()}loadTexture(e,i,s=null){this.props.texture&&this.unloadTexture();const{txManager:r}=this.stage,o=r.loadTexture(e,i,s);this.props.texture=o,this.props.textureOptions=s,this.checkIsRenderable(),queueMicrotask(()=>{o.state==="loaded"?this.onTextureLoaded(o,o.dimensions):o.state==="failed"&&this.onTextureFailed(o,o.error),o.on("loaded",this.onTextureLoaded),o.on("failed",this.onTextureFailed)})}unloadTexture(){this.props.texture&&(this.props.texture.off("loaded",this.onTextureLoaded),this.props.texture.off("failed",this.onTextureFailed)),this.props.texture=null,this.props.textureOptions=null,this.checkIsRenderable()}loadShader(e,i){const s=this.stage.renderer.getShaderManager();z(s);const{shader:r,props:o}=s.loadShader(e,i);this.props.shader=r,this.props.shaderProps=o,this.checkIsRenderable()}setUpdateType(e){this.updateType|=e;const i=this.props.parent;i&&!(i.updateType&B.Children)&&i.setUpdateType(B.Children)}sortChildren(){this.children.sort((e,i)=>e.calcZIndex-i.calcZIndex)}updateScaleRotateTransform(){this.scaleRotateTransform=Nt.rotate(this.props.rotation,this.scaleRotateTransform).scale(this.props.scaleX,this.props.scaleY)}updateLocalTransform(){z(this.scaleRotateTransform);const e=this.props.pivotX*this.props.width,i=this.props.pivotY*this.props.height,s=this.props.mountX*this.props.width,r=this.props.mountY*this.props.height;this.localTransform=Nt.translate(e-s+this.props.x,i-r+this.props.y,this.localTransform).multiply(this.scaleRotateTransform).translate(-e,-i),this.setUpdateType(B.Global)}update(e,i=null){this.updateType&B.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(B.Local)),this.updateType&B.Local&&(this.updateLocalTransform(),this.setUpdateType(B.Global));const s=this.props.parent;let r=B.None;this.updateType&B.Global&&(z(this.localTransform),this.globalTransform=Nt.copy((s==null?void 0:s.globalTransform)||this.localTransform,this.globalTransform),s&&this.globalTransform.multiply(this.localTransform),this.setUpdateType(B.Clipping|B.Children),r|=B.Global),this.updateType&B.Clipping&&(this.calculateClippingRect(i),this.checkIsRenderable(),this.setUpdateType(B.Children),r|=B.Clipping),this.updateType&B.WorldAlpha&&(s?this.worldAlpha=s.worldAlpha*this.props.alpha:this.worldAlpha=this.props.alpha,this.setUpdateType(B.Children|B.PremultipliedColors),r|=B.WorldAlpha),this.updateType&B.PremultipliedColors&&(this.premultipliedColorTl=fi(this.props.colorTl,this.worldAlpha,!0),this.premultipliedColorTr=fi(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=fi(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=fi(this.props.colorBr,this.worldAlpha,!0),this.checkIsRenderable(),this.setUpdateType(B.Children),r|=B.PremultipliedColors),s&&this.updateType&B.CalculatedZIndex&&(this.calculateZIndex(),s.setUpdateType(B.ZIndexSortedChildren)),this.updateType&B.Children&&this.children.length&&this.children.forEach(o=>{o.setUpdateType(r),o.updateType!==0&&o.update(e,this.clippingRect)}),this.updateType&B.ZIndexSortedChildren&&this.sortChildren(),this.updateType=0}checkIsRenderable(){return this.props.texture?this.isRenderable=!0:this.props.shader?this.isRenderable=!0:this.props.clipping?this.isRenderable=!0:["color","colorTop","colorBottom","colorLeft","colorRight","colorTl","colorTr","colorBl","colorBr"].some(i=>this.props[i]!==0)?this.isRenderable=!0:this.isRenderable=!1}calculateClippingRect(e=null){if(z(this.globalTransform),this.parentClippingRect===e&&this.clippingRect)return;const i=this.globalTransform,s=i.tb!==0||i.tc!==0;let r=this.props.clipping&&!s?{x:i.tx,y:i.ty,width:this.width*i.ta,height:this.height*i.td}:null;e&&r?r=no(e,r):e&&(r=e),this.parentClippingRect=e,this.clippingRect=r}calculateZIndex(){var o,a;const e=this.props,i=e.zIndex||0,s=((o=e.parent)==null?void 0:o.zIndex)||0;let r=i;(a=e.parent)!=null&&a.zIndexLocked&&(r=i<s?i:s),this.calcZIndex=r}renderQuads(e){const{width:i,height:s,texture:r,textureOptions:o,shader:a,shaderProps:h}=this.props,{premultipliedColorTl:l,premultipliedColorTr:c,premultipliedColorBl:u,premultipliedColorBr:d}=this,{zIndex:g,worldAlpha:_,globalTransform:f,clippingRect:y}=this;z(f),e.addQuad({width:i,height:s,colorTl:l,colorTr:c,colorBl:u,colorBr:d,texture:r,textureOptions:o,zIndex:g,shader:a,shaderProps:h,alpha:_,clippingRect:y,tx:f.tx,ty:f.ty,ta:f.ta,tb:f.tb,tc:f.tc,td:f.td})}get id(){return this.props.id}get x(){return this.props.x}set x(e){this.props.x!==e&&(this.props.x=e,this.setUpdateType(B.Local))}get absX(){var e,i,s;return this.props.x+(((e=this.props.parent)==null?void 0:e.absX)||((s=(i=this.props.parent)==null?void 0:i.globalTransform)==null?void 0:s.tx)||0)}get absY(){var e,i;return this.props.y+((i=(e=this.props.parent)==null?void 0:e.absY)!=null?i:0)}get y(){return this.props.y}set y(e){this.props.y!==e&&(this.props.y=e,this.setUpdateType(B.Local))}get width(){return this.props.width}set width(e){this.props.width!==e&&(this.props.width=e,this.setUpdateType(B.Local))}get height(){return this.props.height}set height(e){this.props.height!==e&&(this.props.height=e,this.setUpdateType(B.Local))}get scale(){return this.scaleX}set scale(e){this.scaleX=e,this.scaleY=e}get scaleX(){return this.props.scaleX}set scaleX(e){this.props.scaleX!==e&&(this.props.scaleX=e,this.setUpdateType(B.ScaleRotate))}get scaleY(){return this.props.scaleY}set scaleY(e){this.props.scaleY!==e&&(this.props.scaleY=e,this.setUpdateType(B.ScaleRotate))}get mount(){return this.props.mount}set mount(e){(this.props.mountX!==e||this.props.mountY!==e)&&(this.props.mountX=e,this.props.mountY=e,this.props.mount=e,this.setUpdateType(B.Local))}get mountX(){return this.props.mountX}set mountX(e){this.props.mountX!==e&&(this.props.mountX=e,this.setUpdateType(B.Local))}get mountY(){return this.props.mountY}set mountY(e){this.props.mountY!==e&&(this.props.mountY=e,this.setUpdateType(B.Local))}get pivot(){return this.props.pivot}set pivot(e){(this.props.pivotX!==e||this.props.pivotY!==e)&&(this.props.pivotX=e,this.props.pivotY=e,this.props.pivot=e,this.setUpdateType(B.Local))}get pivotX(){return this.props.pivotX}set pivotX(e){this.props.pivotX!==e&&(this.props.pivotX=e,this.setUpdateType(B.Local))}get pivotY(){return this.props.pivotY}set pivotY(e){this.props.pivotY!==e&&(this.props.pivotY=e,this.setUpdateType(B.Local))}get rotation(){return this.props.rotation}set rotation(e){this.props.rotation!==e&&(this.props.rotation=e,this.setUpdateType(B.ScaleRotate))}get alpha(){return this.props.alpha}set alpha(e){this.props.alpha=e,this.setUpdateType(B.PremultipliedColors|B.WorldAlpha)}get clipping(){return this.props.clipping}set clipping(e){this.props.clipping=e,this.setUpdateType(B.Clipping)}get color(){return this.props.color}set color(e){(this.props.colorTl!==e||this.props.colorTr!==e||this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorTl=e,this.colorTr=e,this.colorBl=e,this.colorBr=e),this.props.color=e,this.setUpdateType(B.PremultipliedColors)}get colorTop(){return this.props.colorTop}set colorTop(e){(this.props.colorTl!==e||this.props.colorTr!==e)&&(this.colorTl=e,this.colorTr=e),this.props.colorTop=e,this.setUpdateType(B.PremultipliedColors)}get colorBottom(){return this.props.colorBottom}set colorBottom(e){(this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorBl=e,this.colorBr=e),this.props.colorBottom=e,this.setUpdateType(B.PremultipliedColors)}get colorLeft(){return this.props.colorLeft}set colorLeft(e){(this.props.colorTl!==e||this.props.colorBl!==e)&&(this.colorTl=e,this.colorBl=e),this.props.colorLeft=e,this.setUpdateType(B.PremultipliedColors)}get colorRight(){return this.props.colorRight}set colorRight(e){(this.props.colorTr!==e||this.props.colorBr!==e)&&(this.colorTr=e,this.colorBr=e),this.props.colorRight=e,this.setUpdateType(B.PremultipliedColors)}get colorTl(){return this.props.colorTl}set colorTl(e){this.props.colorTl=e,this.setUpdateType(B.PremultipliedColors)}get colorTr(){return this.props.colorTr}set colorTr(e){this.props.colorTr=e,this.setUpdateType(B.PremultipliedColors)}get colorBl(){return this.props.colorBl}set colorBl(e){this.props.colorBl=e,this.setUpdateType(B.PremultipliedColors)}get colorBr(){return this.props.colorBr}set colorBr(e){this.props.colorBr=e,this.setUpdateType(B.PremultipliedColors)}get zIndexLocked(){return this.props.zIndexLocked||0}set zIndexLocked(e){this.props.zIndexLocked=e,this.setUpdateType(B.CalculatedZIndex|B.Children),this.children.forEach(i=>{i.setUpdateType(B.CalculatedZIndex)})}get zIndex(){return this.props.zIndex}set zIndex(e){this.props.zIndex=e,this.setUpdateType(B.CalculatedZIndex|B.Children),this.children.forEach(i=>{i.setUpdateType(B.CalculatedZIndex)})}get parent(){return this.props.parent}set parent(e){const i=this.props.parent;if(i!==e){if(this.props.parent=e,i){const s=i.children.indexOf(this);z(s!==-1,"CoreNode.parent: Node not found in old parent's children!"),i.children.splice(s,1)}e&&(e.children.push(this),this.setUpdateType(B.All),e.setUpdateType(B.Children|B.ZIndexSortedChildren)),this.updateScaleRotateTransform()}}}let Fh=1;function Br(){return Fh++}class hr extends Qe{constructor(e,i,s,r){var o;super();v(this,"rendererMain");v(this,"stage");v(this,"id");v(this,"coreNode");v(this,"_children",[]);v(this,"_src","");v(this,"_parent",null);v(this,"_texture",null);v(this,"_shader",null);v(this,"onTextureLoaded",(e,i)=>{this.emit("loaded",i)});v(this,"onTextureFailed",(e,i)=>{this.emit("failed",i)});this.rendererMain=i,this.stage=s,this.id=(o=r==null?void 0:r.id)!=null?o:Br(),this.coreNode=r||new Fr(this.stage,{id:this.id,x:e.x,y:e.y,width:e.width,height:e.height,alpha:e.alpha,clipping:e.clipping,color:e.color,colorTop:e.colorTop,colorBottom:e.colorBottom,colorLeft:e.colorLeft,colorRight:e.colorRight,colorTl:e.colorTl,colorTr:e.colorTr,colorBl:e.colorBl,colorBr:e.colorBr,zIndex:e.zIndex,zIndexLocked:e.zIndexLocked,scaleX:e.scaleX,scaleY:e.scaleY,mountX:e.mountX,mountY:e.mountY,mount:e.mount,pivot:e.pivot,pivotX:e.pivotX,pivotY:e.pivotY,rotation:e.rotation,parent:null,shader:null,shaderProps:null,texture:null,textureOptions:null}),this.coreNode.on("loaded",this.onTextureLoaded),this.coreNode.on("failed",this.onTextureFailed),this.parent=e.parent,this.shader=e.shader,this.texture=e.texture,this.src=e.src}get x(){return this.coreNode.x}set x(e){this.coreNode.x=e}get y(){return this.coreNode.y}set y(e){this.coreNode.y=e}get width(){return this.coreNode.width}set width(e){this.coreNode.width=e}get height(){return this.coreNode.height}set height(e){this.coreNode.height=e}get alpha(){return this.coreNode.alpha}set alpha(e){this.coreNode.alpha=e}get clipping(){return this.coreNode.clipping}set clipping(e){this.coreNode.clipping=e}get color(){return this.coreNode.color}set color(e){this.coreNode.color=e}get colorTop(){return this.coreNode.colorTop}set colorTop(e){this.coreNode.colorTop=e}get colorBottom(){return this.coreNode.colorBottom}set colorBottom(e){this.coreNode.colorBottom=e}get colorLeft(){return this.coreNode.colorLeft}set colorLeft(e){this.coreNode.colorLeft=e}get colorRight(){return this.coreNode.colorRight}set colorRight(e){this.coreNode.colorRight=e}get colorTl(){return this.coreNode.colorTl}set colorTl(e){this.coreNode.colorTl=e}get colorTr(){return this.coreNode.colorTr}set colorTr(e){this.coreNode.colorTr=e}get colorBl(){return this.coreNode.colorBl}set colorBl(e){this.coreNode.colorBl=e}get colorBr(){return this.coreNode.colorBr}set colorBr(e){this.coreNode.colorBr=e}get scale(){return this.scaleX!==this.scaleY?null:this.coreNode.scaleX}set scale(e){e!==null&&(this.coreNode.scaleX=e,this.coreNode.scaleY=e)}get scaleX(){return this.coreNode.scaleX}set scaleX(e){this.coreNode.scaleX=e}get scaleY(){return this.coreNode.scaleY}set scaleY(e){this.coreNode.scaleY=e}get mount(){return this.coreNode.mount}set mount(e){this.coreNode.mount=e}get mountX(){return this.coreNode.mountX}set mountX(e){this.coreNode.mountX=e}get mountY(){return this.coreNode.mountY}set mountY(e){this.coreNode.mountY=e}get pivot(){return this.coreNode.pivot}set pivot(e){this.coreNode.pivot=e}get pivotX(){return this.coreNode.pivotX}set pivotX(e){this.coreNode.pivotX=e}get pivotY(){return this.coreNode.pivotY}set pivotY(e){this.coreNode.pivotY=e}get rotation(){return this.coreNode.rotation}set rotation(e){this.coreNode.rotation=e}get parent(){return this._parent}set parent(e){var s;const i=this._parent;if(this._parent=e,this.coreNode.parent=(s=e==null?void 0:e.coreNode)!=null?s:null,i){const r=i.children.indexOf(this);z(r!==-1,"MainOnlyNode.parent: Node not found in old parent's children!"),i.children.splice(r,1)}e&&e.children.push(this)}get children(){return this._children}get zIndex(){return this.coreNode.zIndex}set zIndex(e){this.coreNode.zIndex=e}get zIndexLocked(){return this.coreNode.zIndexLocked}set zIndexLocked(e){this.coreNode.zIndexLocked=e}get src(){return this._src}set src(e){if(this._src!==e){if(this._src=e,!e){this.texture=null;return}this.texture=this.rendererMain.createTexture("ImageTexture",{src:e})}}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this.rendererMain.textureTracker.decrementTextureRefCount(this._texture),e&&this.rendererMain.textureTracker.incrementTextureRefCount(e),this._texture=e,e?this.coreNode.loadTexture(e.txType,e.props,e.options):this.coreNode.unloadTexture())}get shader(){return this._shader}set shader(e){this._shader!==e&&(this._shader=e,e&&this.coreNode.loadShader(e.shType,e.props))}destroy(){this.emit("beforeDestroy",{}),this.parent=null,this.texture=null,this.emit("afterDestroy",{}),this.removeAllListeners()}flush(){}animate(e,i){const s=new Ih(this.coreNode,e,i);return new Lh(this.stage.animationManager,s)}}const Bh=n=>{const t=()=>{if(n.updateAnimations(),!n.hasSceneUpdates()){setTimeout(t,16.666666666666668);return}n.drawFrame(),requestAnimationFrame(t)};requestAnimationFrame(t)},zh=()=>performance?performance.now():Date.now();var sr;let Mh=(sr=class extends bi{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}bindTextures(t){const{gl:e}=this;e.getParameter(e.TEXTURE_BINDING_2D)!==t[0].ctxTexture&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t[0].ctxTexture))}},v(sr,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",fragment:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    "}),sr);class So extends bi{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]});v(this,"supportsIndexedTextures",!0)}bindTextures(e){const{renderer:i,gl:s}=this;if(e.length>i.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error("DefaultShaderBatched: Cannot bind more than ".concat(i.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS," textures"));e.forEach((o,a)=>{s.activeTexture(s.TEXTURE0+a),s.bindTexture(s.TEXTURE_2D,o.ctxTexture)});const r=Array.from(Array(e.length).keys());this.setUniform("u_textures[0]",r)}}v(So,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",fragment:e=>"\n      #define txUnits ".concat(e,"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[").concat(e,"], int idx, vec2 uv) {\n        ").concat(Array.from(Array(e).keys()).map(i=>"\n          ".concat(i!==0?"else ":"","if (idx == ").concat(i,") {\n            return texture2D(textures[").concat(i,"], uv);\n          }\n        ")).join(""),"\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    ")});class _t{constructor(t){v(this,"priority",1);v(this,"name","");v(this,"ref");v(this,"target");v(this,"passParameters","");v(this,"declaredUniforms","");v(this,"uniformInfo",{});const{ref:e,target:i,props:s={}}=t;this.ref=e,this.target=i;const r={},o=[];let a="";const h=this.constructor.uniforms||{};for(const l in h){const c=h[l],u=c.type,d="".concat(e,"_").concat(l);let g="";c.size&&(g="[".concat(c.size(s),"]")),o.push(d),a+="uniform ".concat(u," ").concat(d).concat(g,";"),r[l]={name:d,uniform:h[l].method}}this.passParameters=o.join(","),this.declaredUniforms=a,this.uniformInfo=r}static getEffectKey(t){return""}static getMethodParameters(t,e){const i=[];for(const s in t){const r=t[s];let o="";r.size&&(o="[".concat(r.size(e),"]")),i.push("".concat(r.type," ").concat(s).concat(o))}return i.join(",")}static resolveDefaults(t){return{}}static makeEffectKey(t){return!1}}v(_t,"uniforms",{}),v(_t,"methods"),v(_t,"onShaderMask"),v(_t,"onColorize"),v(_t,"onEffectMask");const oe=class oe extends bi{constructor(e,i,s){const r=oe.createShader(i,s);super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"},...r.uniforms],shaderSources:{vertex:r.vertex,fragment:r.fragment}});v(this,"effects",[]);this.effects=r.effects}bindTextures(e){const{gl:i}=this;i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e[0].ctxTexture)}bindProps(e){var s;const i=this.renderer.shManager.getRegisteredEffects();(s=e.effects)==null||s.forEach((r,o)=>{var u;const a=this.effects[o],h=i[a.name],l=(u=r.props)!=null?u:{},c=a.uniformInfo;Object.keys(l).forEach(d=>{const g=h.uniforms[d],_=c[d];let f=g.validator?g.validator(l[d],l):l[d];Array.isArray(f)&&(f=new Float32Array(f)),this.setUniform(_.name,f)})})}static createShader(e,i){const s={},r={};let o="";const a=[],h=[],l=e.effects.map(_=>{const f=i[_.type],y=f.getEffectKey(_.props||{});s[y]=s[y]?++s[y]:1;const T=s[y];T===1&&h.push({key:y,type:_.type,props:_.props});const x=new f({ref:"".concat(y).concat(T===1?"":T),target:y,props:_.props});return o+=x.declaredUniforms,a.push(...Object.values(x.uniformInfo)),x});let c="";h==null||h.forEach(_=>{var I;const f=i[_.type],y=f.resolveDefaults((I=_.props)!=null?I:{}),T=[];for(const S in f.methods){let A=S;const E=f.methods[S];r[S]&&r[S]!==E&&(A=oe.resolveMethodDuplicate(S,E,r)),r[A]=E.replace("function",A),T.push({m:S,cm:A})}let x=f.onShaderMask instanceof Function?f.onShaderMask(y):f.onShaderMask,m=f.onColorize instanceof Function?f.onColorize(y):f.onColorize,p=f.onEffectMask instanceof Function?f.onEffectMask(y):f.onEffectMask;T.forEach(S=>{const{m:A,cm:E}=S,F=new RegExp("\\$".concat(A),"g");x&&(x=x.replace(F,E)),m&&(m=m.replace(F,E)),p&&(p=p.replace(F,E))});const w=f.getMethodParameters(f.uniforms,y),R=w.length>0?", ".concat(w):"";x&&(c+="\n        float fx_".concat(_.key,"_onShaderMask(float shaderMask ").concat(R,") {\n          ").concat(x,"\n        }\n        ")),m&&(c+="\n          vec4 fx_".concat(_.key,"_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(R,") {\n            ").concat(m,"\n          }\n        ")),p&&(c+="\n          vec4 fx_".concat(_.key,"_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(R,") {\n            ").concat(p,"\n          }\n        "))});let u="";for(const _ in r)u+=r[_];let d="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",g="\n\n    ";for(let _=0;_<l.length;_++){const f=l[_],y=f.passParameters.length>0?", ".concat(f.passParameters):"",T=i[f.name];T.onShaderMask&&(g+="\n        shaderMask = fx_".concat(f.target,"_onShaderMask(shaderMask ").concat(y,");\n        ")),T.onColorize&&(g+="\n        maskColor = fx_".concat(f.target,"_onColorize(shaderMask, maskColor, shaderColor").concat(y,");\n        ")),T.onEffectMask&&(d="fx_".concat(f.target,"_onEffectMask(shaderMask, maskColor, shaderColor").concat(y,")"));const x=l[_+1];(x===void 0||i[x.name].onEffectMask)&&(g+="\n          shaderColor = ".concat(d,";\n        "))}return{effects:l,uniforms:a,fragment:oe.fragment(o,u,c,g),vertex:oe.vertex()}}static resolveMethodDuplicate(e,i,s,r=0){const o=e+(r>0?r:"");return s[o]&&s[o]!==i?this.resolveMethodDuplicate(e,i,s,++r):o}static resolveDefaults(e,i){var s;return{effects:((s=e.effects)!=null?s:[]).map(r=>({type:r.type,props:i[r.type].resolveDefaults(r.props||{})})),$dimensions:{width:0,height:0},$alpha:0}}static makeCacheKey(e,i){var r;let s="";return(r=e.effects)==null||r.forEach(o=>{const h=i[o.type].getEffectKey(o.props||{});s+=",".concat(h)}),"DynamicShader".concat(s)}};v(oe,"z$__type__Props"),v(oe,"vertex",()=>"\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  "),v(oe,"fragment",(e,i,s,r)=>"\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    ".concat(e,"\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n\n    ").concat(i,"\n\n    ").concat(s,"\n\n    void main() {\n      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ").concat(r,"\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  "));let ei=oe;class lr extends bi{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}static resolveDefaults(t){return{radius:t.radius||10,$dimensions:{width:0,height:0}}}bindTextures(t){const{gl:e}=this;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t[0].ctxTexture)}bindProps(t){this.setUniform("u_radius",t.radius)}canBatchShaderProps(t,e){return t.radius===e.radius&&t.$dimensions.width===e.$dimensions.width&&t.$dimensions.height===e.$dimensions.height}}v(lr,"z$__type__Props"),v(lr,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",fragment:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    "});const Oh=new Float32Array([1,0,0,0,1,0,0,0,1]),Ss=class Ss extends bi{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}bindTextures(t){const{gl:e}=this;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t[0].ctxTexture)}bindProps(t){const e=Ss.resolveDefaults(t);for(const i in e)if(i==="transform")this.setUniform("u_transform",!1,e[i]);else if(i==="scrollY")this.setUniform("u_scrollY",e[i]);else if(i==="color"){const s=se(e.color);this.setUniform("u_color",s)}else i==="size"?this.setUniform("u_size",e[i]):i==="distanceRange"?this.setUniform("u_distanceRange",e[i]):i==="debug"&&this.setUniform("u_debug",e[i]?1:0)}static resolveDefaults(t={}){var e,i,s,r,o,a;return{transform:(e=t.transform)!=null?e:Oh,scrollY:(i=t.scrollY)!=null?i:0,color:(s=t.color)!=null?s:4294967295,size:(r=t.size)!=null?r:16,distanceRange:(o=t.distanceRange)!=null?o:1,debug:(a=t.debug)!=null?a:!1}}};v(Ss,"shaderSources",{vertex:"\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n        gl_Position = vec4((transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1), 0, 1);\n        v_texcoord = a_textureCoordinate;\n      }\n    ",fragment:"\n      precision highp float;\n\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    "});let cr=Ss;class Ge extends _t{constructor(){super(...arguments);v(this,"name","radius")}static getEffectKey(){return"radius"}static resolveDefaults(e){var i;return{radius:(i=e.radius)!=null?i:10}}}v(Ge,"z$__type__Props"),v(Ge,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",validator:e=>{let i=e;return Array.isArray(i)?i.length===2?i=[i[0],i[1],i[0],i[1]]:i.length===3?i=[i[0],i[1],i[2],i[0]]:i.length!==4&&(i=[i[0],i[0],i[0],i[0]]):typeof i=="number"&&(i=[i,i,i,i]),i}}}),v(Ge,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",boxDist:"\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    "}),v(Ge,"onShaderMask","\n  vec2 halfDimensions = u_dimensions * 0.5;\n  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);\n  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);\n  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);\n  "),v(Ge,"onEffectMask","\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  ");class gi extends _t{constructor(){super(...arguments);v(this,"name","border")}static getEffectKey(){return"border"}static resolveDefaults(e){var i,s;return{width:(i=e.width)!=null?i:10,color:(s=e.color)!=null?s:4294967295}}}v(gi,"z$__type__Props"),v(gi,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>se(e),method:"uniform4fv",type:"vec4"}}),v(gi,"onEffectMask","\n  float mask = clamp(shaderMask + width, 0.0, 1.0) - clamp(shaderMask, 0.0, 1.0);\n  return mix(shaderColor, maskColor, mask);\n  "),v(gi,"onColorize","\n    return color;\n  ");class je extends _t{constructor(){super(...arguments);v(this,"name","linearGradient")}static getEffectKey(e){return"linearGradient".concat(e.colors.length)}static resolveDefaults(e){var r,o;const i=(r=e.colors)!=null?r:[4278190080,4294967295];let s=e.stops;if(!s){s=[];const a=i.length-1;for(let h=0;h<i.length;h++)s.push(h*(1/a))}return{colors:i,stops:s,angle:(o=e.angle)!=null?o:0}}}v(je,"z$__type__Props"),v(je,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:e=>e.map(s=>se(s)).reduce((s,r)=>s.concat(r),[]),size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],validator:(e,i)=>{var a;const s=(a=i.colors)!=null?a:[];let r=e;const o=e;if(r.length===0||r&&r.length!==s.length){for(let h=0;h<s.length;h++)r[h]?(o[h]=r[h],r[h-1]===void 0&&o[h-2]!==void 0&&(o[h-1]=o[h-2]+(r[h]-o[h-2])/2)):o[h]=h*(1/(s.length-1));r=o}return o},size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),v(je,"methods",{fromLinear:"\n      vec4 function(vec4 linearRGB) {\n        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n        vec4 lower = linearRGB * vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",toLinear:"\n      vec4 function(vec4 sRGB) {\n        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));\n        vec4 lower = sRGB/vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",calcPoint:"\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    "}),v(je,"ColorLoop",e=>{let i="";for(let s=2;s<e;s++)i+="colorOut = mix(colorOut, colors[".concat(s,"], clamp((dist - stops[").concat(s-1,"]) / (stops[").concat(s,"] - stops[").concat(s-1,"]), 0.0, 1.0));");return i}),v(je,"onColorize",e=>{const i=e.colors.length||1;return"\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));\n      for(int i = 1; i < ".concat(i,"-1; i++) {\n        stopCalc = (dist - stops[i]) / (stops[i + 1] - stops[i]);\n        colorOut = mix(colorOut, colors[i + 1], clamp(stopCalc, 0.0, 1.0));\n      }\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ")});class To extends _t{constructor(){super(...arguments);v(this,"name","grayscale")}static getEffectKey(){return"grayscale"}}v(To,"onColorize","\n    vec3 color = pow(maskColor.rgb, vec3(2.0));\n    float gray = dot(color, vec3(0.2126, 0.7152, 0.0722));\n    float gammaGray = sqrt(gray);\n    return vec4(gammaGray, gammaGray, gammaGray, 1.0);\n  ");class Ve extends _t{constructor(){super(...arguments);v(this,"name","borderRight")}static getEffectKey(){return"borderRight"}static resolveDefaults(e){var i,s;return{width:(i=e.width)!=null?i:10,color:(s=e.color)!=null?s:4294967295}}}v(Ve,"z$__type__Props"),v(Ve,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>se(e),method:"uniform4fv",type:"vec4"}}),v(Ve,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),v(Ve,"onEffectMask","\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),v(Ve,"onColorize","\n    return color;\n  ");class Ke extends _t{constructor(){super(...arguments);v(this,"name","borderTop")}static getEffectKey(){return"borderTop"}static resolveDefaults(e){var i,s;return{width:(i=e.width)!=null?i:10,color:(s=e.color)!=null?s:4294967295}}}v(Ke,"z$__type__Props"),v(Ke,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>se(e),method:"uniform4fv",type:"vec4"}}),v(Ke,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),v(Ke,"onEffectMask","\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),v(Ke,"onColorize","\n    return color;\n  ");class qe extends _t{constructor(){super(...arguments);v(this,"name","borderBottom")}static getEffectKey(){return"borderBottom"}static resolveDefaults(e){var i,s;return{width:(i=e.width)!=null?i:10,color:(s=e.color)!=null?s:4294967295}}}v(qe,"z$__type__Props"),v(qe,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>se(e),method:"uniform4fv",type:"vec4"}}),v(qe,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),v(qe,"onEffectMask","\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),v(qe,"onColorize","\n    return color;\n  ");class Ze extends _t{constructor(){super(...arguments);v(this,"name","borderLeft")}static getEffectKey(){return"borderLeft"}static resolveDefaults(e){var i,s;return{width:(i=e.width)!=null?i:10,color:(s=e.color)!=null?s:4294967295}}}v(Ze,"z$__type__Props"),v(Ze,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>se(e),method:"uniform4fv",type:"vec4"}}),v(Ze,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),v(Ze,"onEffectMask","\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),v(Ze,"onColorize","\n    return color;\n  ");class _i extends _t{constructor(){super(...arguments);v(this,"name","glitch")}static getEffectKey(e){return"glitch"}static resolveDefaults(e){var i,s,r,o,a;return{amplitude:(i=e.amplitude)!=null?i:.2,narrowness:(s=e.narrowness)!=null?s:4,blockiness:(r=e.blockiness)!=null?r:2,minimizer:(o=e.minimizer)!=null?o:8,time:(a=e.time)!=null?a:Date.now()}}}v(_i,"z$__type__Props"),v(_i,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",validator:e=>(Date.now()-e)%1e3,type:"float"}}),v(_i,"methods",{rand:"\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    ",noise:"\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    ",fbm:"\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    "}),v(_i,"onColorize","\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  ");class $i extends _t{constructor(){super(...arguments);v(this,"name","fadeOut")}static getEffectKey(){return"fadeOut"}static resolveDefaults(e){var i;return{fade:(i=e.fade)!=null?i:10}}}v($i,"z$__type__Props"),v($i,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:e=>{let i=e;return Array.isArray(i)?i.length===2?i=[i[0],i[1],i[0],i[1]]:i.length===3?i=[i[0],i[1],i[2],i[0]]:i.length!==4&&(i=[i[0],i[0],i[0],i[0]]):typeof i=="number"&&(i=[i,i,i,i]),i}}}),v($i,"onColorize","\n  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  ");class Xi extends _t{constructor(){super(...arguments);v(this,"name","radialGradient")}static getEffectKey(e){return"radialGradient".concat(e.colors.length)}static resolveDefaults(e){var r,o,a,h,l;const i=(r=e.colors)!=null?r:[4278190080,4294967295];let s=e.stops;if(!s){s=[];const c=i.length-1;for(let u=0;u<i.length;u++)s.push(u*(1/c))}return{colors:i,stops:s,width:(o=e.width)!=null?o:0,height:(h=(a=e.height)!=null?a:e.width)!=null?h:0,pivot:(l=e.pivot)!=null?l:[.5,.5]}}}v(Xi,"z$__type__Props"),v(Xi,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:e=>e.map(s=>se(s)).reduce((s,r)=>s.concat(r),[]),size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],validator:(e,i)=>{var a;const s=(a=i.colors)!=null?a:[];let r=e;const o=e;if(r.length===0||r&&r.length!==s.length){for(let h=0;h<s.length;h++)r[h]?(o[h]=r[h],r[h-1]===void 0&&o[h-2]!==void 0&&(o[h-1]=o[h-2]+(r[h]-o[h-2])/2)):o[h]=h*(1/(s.length-1));r=o}return o},size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),v(Xi,"onColorize",e=>{const i=e.colors.length||1;return"\n      vec2 point = v_textureCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = mix(colors[0], colors[1], stopCalc);\n      for(int i = 1; i < ".concat(i,"-1; i++) {\n        stopCalc = (dist - stops[i]) / (stops[i + 1] - stops[i]);\n        colorOut = mix(colorOut, colors[i + 1], clamp(stopCalc, 0.0, 1.0));\n      }\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ")});class Je extends _t{constructor(){super(...arguments);v(this,"name","radialProgress")}static getEffectKey(){return"radialProgress"}static resolveDefaults(e){var i,s,r,o,a,h,l;return{width:(i=e.width)!=null?i:10,progress:(s=e.progress)!=null?s:.5,offset:(r=e.offset)!=null?r:0,range:(o=e.range)!=null?o:Math.PI*2,rounded:(a=e.rounded)!=null?a:!1,radius:(h=e.radius)!=null?h:1,color:(l=e.color)!=null?l:4294967295}}}v(Je,"z$__type__Props"),v(Je,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:e=>e?1:0},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>se(e),method:"uniform4fv",type:"vec4"}}),v(Je,"methods",{rotateUV:"\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    ",drawDot:"\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    "}),v(Je,"onEffectMask","\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  "),v(Je,"onColorize","\n    return color;\n  ");class Dh{constructor(){v(this,"shCache",new Map);v(this,"shConstructors",{});v(this,"attachedShader",null);v(this,"effectConstructors",{});v(this,"renderer");this.registerShaderType("DefaultShader",Mh),this.registerShaderType("DefaultShaderBatched",So),this.registerShaderType("RoundedRectangle",lr),this.registerShaderType("DynamicShader",ei),this.registerShaderType("SdfShader",cr),this.registerEffectType("border",gi),this.registerEffectType("borderBottom",qe),this.registerEffectType("borderLeft",Ze),this.registerEffectType("borderRight",Ve),this.registerEffectType("borderTop",Ke),this.registerEffectType("fadeOut",$i),this.registerEffectType("linearGradient",je),this.registerEffectType("radialGradient",Xi),this.registerEffectType("grayscale",To),this.registerEffectType("glitch",_i),this.registerEffectType("radius",Ge),this.registerEffectType("radialProgress",Je)}registerShaderType(t,e){this.shConstructors[t]=e}registerEffectType(t,e){this.effectConstructors[t]=e}getRegisteredEffects(){return this.effectConstructors}getRegisteredShaders(){return this.shConstructors}loadShader(t,e){if(!this.renderer)throw new Error("Renderer is not been defined");const i=this.shConstructors[t];if(!i)throw new Error('Shader type "'.concat(t,'" is not registered'));if(t==="DynamicShader")return this.loadDynamicShader(e);const s=i.resolveDefaults(e),r=i.makeCacheKey(s)||i.name;if(r&&this.shCache.has(r))return{shader:this.shCache.get(r),props:s};const o=new i(this.renderer,e);return r&&this.shCache.set(r,o),{shader:o,props:s}}loadDynamicShader(t){if(!this.renderer)throw new Error("Renderer is not been defined");const e=ei.resolveDefaults(t,this.effectConstructors),i=ei.makeCacheKey(e,this.effectConstructors);if(i&&this.shCache.has(i))return{shader:this.shCache.get(i),props:e};const s=new ei(this.renderer,t,this.effectConstructors);return i&&this.shCache.set(i,s),{shader:s,props:e}}useShader(t){this.attachedShader!==t&&(this.attachedShader&&this.attachedShader.detach(),t.attach(),this.attachedShader=t)}}let kh=class{constructor(){v(this,"activeAnimations",new Set)}registerAnimation(t){this.activeAnimations.add(t)}unregisterAnimation(t){this.activeAnimations.delete(t)}update(t){this.activeAnimations.forEach(e=>{e.update(t)})}};var ke;let Uh=(ke=class extends oo{constructor(e,i){super(e);v(this,"props");this.props=ke.resolveDefaults(i)}async getTextureData(){const{src:e,premultiplyAlpha:i}=this.props;if(!e)return{data:null};if(e instanceof ImageData)return{data:e,premultiplyAlpha:i};const r=await(await fetch(e)).blob();return{data:await createImageBitmap(r,{premultiplyAlpha:i?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"})}}static makeCacheKey(e){const i=ke.resolveDefaults(e);return i.src instanceof ImageData?!1:"ImageTexture,".concat(i.src,",").concat(i.premultiplyAlpha)}static resolveDefaults(e){var i,s;return{src:(i=e.src)!=null?i:"",premultiplyAlpha:(s=e.premultiplyAlpha)!=null?s:!0}}},v(ke,"z$__type__Props"),ke);var Ue;let Nh=(Ue=class extends oo{constructor(e,i){super(e);v(this,"props");this.props=Ue.resolveDefaults(i)}async getTextureData(){const{width:e,height:i}=this.props,s=e*i*4,r=new Uint8ClampedArray(s);for(let o=0;o<s;o+=4){const a=Math.floor(Math.random()*256);r[o]=a,r[o+1]=a,r[o+2]=a,r[o+3]=255}return{data:new ImageData(r,e,i)}}static makeCacheKey(e){const i=Ue.resolveDefaults(e);return"NoiseTexture,".concat(i.width,",").concat(i.height,",").concat(i.cacheId)}static resolveDefaults(e){var i,s,r;return{width:(i=e.width)!=null?i:128,height:(s=e.height)!=null?s:128,cacheId:(r=e.cacheId)!=null?r:0}}},v(Ue,"z$__type__Props"),Ue);class Hh{constructor(){v(this,"usedMemory",0);v(this,"txConstructors",{});v(this,"textureKeyCache",new Map);v(this,"textureIdCache",new Map);v(this,"ctxTextureCache",new WeakMap);v(this,"textureRefCountMap",new WeakMap);v(this,"renderer");this.registerTextureType("ImageTexture",Uh),this.registerTextureType("ColorTexture",Ha),this.registerTextureType("NoiseTexture",Nh),this.registerTextureType("SubTexture",Wa)}registerTextureType(t,e){this.txConstructors[t]=e}loadTexture(t,e,i=null){var o;const s=this.txConstructors[t];if(!s)throw new Error('Texture type "'.concat(t,'" is not registered'));let r;if((i==null?void 0:i.id)!==void 0&&this.textureIdCache.has(i.id)&&(r=this.textureIdCache.get(i.id)),!r){const a=i==null?void 0:i.id,h=(o=i==null?void 0:i.cacheKey)!=null?o:s.makeCacheKey(e);h&&this.textureKeyCache.has(h)?r=this.textureKeyCache.get(h):r=new s(this,e),a&&this.addTextureIdToCache(a,h,r)}return i!=null&&i.preload&&this.getCtxTexture(r).load(),r}addTextureIdToCache(t,e,i){const{textureIdCache:s,textureRefCountMap:r}=this;s.set(t,i),r.has(i)?r.get(i).count++:(r.set(i,{cacheKey:e,count:1}),e&&this.textureKeyCache.set(e,i))}removeTextureIdFromCache(t){const{textureIdCache:e,textureRefCountMap:i}=this,s=e.get(t);if(s&&(e.delete(t),i.has(s))){const r=i.get(s);z(r),r.count--,r.count===0&&(i.delete(s),r.cacheKey&&this.textureKeyCache.delete(r.cacheKey))}}getDebugInfo(){return{keyCacheSize:this.textureKeyCache.size,idCacheSize:this.textureIdCache.size}}getCtxTexture(t){if(this.ctxTextureCache.has(t))return this.ctxTextureCache.get(t);const e=this.renderer.createCtxTexture(t);return this.ctxTextureCache.set(t,e),e}}class Co{constructor(t){v(this,"textRenderers");this.textRenderers=t}addFontFace(t){for(const e in this.textRenderers){const i=this.textRenderers[e];i&&i.isFontFaceSupported(t)&&i.addFontFace(t)}}static resolveFontFace(t,e){const i=[];return t.reduce((r,o)=>{if(r)return r;const a=o[e.fontFamily];if(!a)return;const h=new Set(a);for(const l of h)(l.descriptors.stretch!==e.fontStretch||l.descriptors.style!==e.fontStyle||l.descriptors.weight!==e.fontWeight)&&h.delete(l);return h.values().next().value},void 0)||i[0]}}const Wh={x:(n,t)=>{n.props.x=t},y:(n,t)=>{n.props.y=t},width:(n,t)=>{n.props.width=t},height:(n,t)=>{n.props.height=t},color:(n,t)=>{n.props.color=t},zIndex:(n,t)=>{n.props.zIndex=t},fontFamily:(n,t)=>{n.props.fontFamily=t},fontWeight:(n,t)=>{n.props.fontWeight=t},fontStyle:(n,t)=>{n.props.fontStyle=t},fontStretch:(n,t)=>{n.props.fontStretch=t},fontSize:(n,t)=>{n.props.fontSize=t},text:(n,t)=>{n.props.text=t},textAlign:(n,t)=>{n.props.textAlign=t},contain:(n,t)=>{n.props.contain=t},offsetY:(n,t)=>{n.props.offsetY=t},scrollable:(n,t)=>{n.props.scrollable=t},scrollY:(n,t)=>{n.props.scrollY=t},letterSpacing:(n,t)=>{n.props.letterSpacing=t},debug:(n,t)=>{n.props.debug=t}};class wo{constructor(t){v(this,"stage");v(this,"set");this.stage=t;const e={...Wh,...this.getPropertySetters()};this.set=Object.freeze(Object.fromEntries(Object.entries(e).map(([i,s])=>[i,(r,o)=>{r.props[i]!==o&&s(r,o)}])))}setStatus(t,e,i){t.status!==e&&(t.status=e,t.emitter.emit(e,i))}scheduleUpdateState(t){t.updateScheduled||(t.updateScheduled=!0,queueMicrotask(()=>{t.updateScheduled=!1,this.updateState(t)}))}}const Qh=24;function Yh(n,t,e,i,s,r,o){let a=0;s&&(a=Math.min(Math.max(Math.floor(s.y1/n),0),r.length));const h=0,l=t/e+a*i;if(!(o&&l>=o/e))return{x:h,y:l,lineIndex:a}}class Gi{constructor(t,e=0){v(this,"iterator");v(this,"peekBuffer",[]);v(this,"_lastIndex");this.iterator=t,this.iterator=t,this._lastIndex=e-1,this.peekBuffer=[]}next(){const t=this.peekBuffer.length>0?this.peekBuffer.pop():this.iterator.next();return t.done?this._lastIndex=-1:this._lastIndex++,t}peek(){if(this.peekBuffer.length>0)return this.peekBuffer[0];const t=this.iterator.next();return this.peekBuffer.push(t),t}get lastIndex(){return this._lastIndex}}function*ji(n,t=0){let e=t;for(;e<n.length;){const i=n.codePointAt(e);if(i===void 0)throw new Error("Invalid Unicode code point");yield i,e+=i<=65535?1:2}}function $h(n,t,e){const i=e.shapeText(t,new Gi(ji(n,0),0));let s=0;for(const r of i)r.mapped&&(s+=r.xAdvance);return s}function Xh(n,t,e,i,s,r,o,a,h,l,c,u,d,g,_,f){z(g,"Font face must be loaded"),z(g.loaded,"Font face must be loaded"),z(g.data,"Font face must be loaded"),z(g.shaper,"Font face must be loaded");const y=g.data.info.size,T=a/y,x=r/T,m=h/T,p=u[n],w=(p==null?void 0:p.codepointIndex)||0,R=(p==null?void 0:p.maxX)||0,I=(p==null?void 0:p.maxY)||0;let S=R,A=I,E=t,F=e,L=0;const k={codepointIndex:-1,bufferOffset:-1,xStart:-1},V=g.shaper,j={letterSpacing:m};let gt=V.shapeText(j,new Gi(ji(i,w),w)),ut,It=-1;const Wt=[],li="...",Pi=o/T,Fi=$h(li,j,V);let be=!0;for(;be;){const jt=c!=="both"||f||F+y+y<=Pi,zt=jt?x:x-Fi;let dt=0;for(;(ut=gt.next())&&!ut.done;){const Z=ut.value;if(n===u.length)u.push({codepointIndex:Z.cluster,maxY:A,maxX:S});else if(n>u.length)throw new Error("Unexpected lineCache length");if(Z.codepoint===32||Z.codepoint===10?k.codepointIndex!==-1&&(k.codepointIndex=-1,dt=E):k.codepointIndex===-1&&(k.codepointIndex=Z.cluster,k.bufferOffset=L,k.xStart=dt),Z.mapped){const fe=E+Z.xOffset+Z.width;if(c!=="none"&&fe>=zt&&k.codepointIndex!==-1&&k.codepointIndex<Z.cluster&&k.xStart>0)if(jt){gt=V.shapeText(j,new Gi(ji(i,k.codepointIndex),k.codepointIndex)),L=k.bufferOffset;break}else gt=V.shapeText(j,new Gi(ji(li,0),0)),E=k.xStart,L=k.bufferOffset;else{const Tt=E+Z.xOffset,ge=F+Z.yOffset,Bi=d?F+y>=d.y1/T:!0,zi=d?F<=d.y2/T:!0;if(Bi&&zi){It===-1&&(It=L);const Ee=g.getAtlasEntry(Z.glyphId),Re=Ee.x/g.data.common.scaleW,Ie=Ee.y/g.data.common.scaleH,ci=Ee.width/g.data.common.scaleW,gn=Ee.height/g.data.common.scaleH;l[L++]=Tt,l[L++]=ge,l[L++]=Re,l[L++]=Ie,l[L++]=Tt+Z.width,l[L++]=ge,l[L++]=Re+ci,l[L++]=Ie,l[L++]=Tt,l[L++]=ge+Z.height,l[L++]=Re,l[L++]=Ie+gn,l[L++]=Tt+Z.width,l[L++]=ge+Z.height,l[L++]=Re+ci,l[L++]=Ie+gn}A=Math.max(A,ge+Z.height),E+=Z.xAdvance,S=Math.max(S,E)}}else if(Z.codepoint===10)break}It!==-1&&(Wt.push({bufferStart:It,bufferEnd:L}),It=-1),E=0,F+=y,n++,k.codepointIndex=-1,dt=0,(!_&&c==="both"&&d&&F>d.y2/T||ut&&ut.done||c==="both"&&!f&&!jt)&&(be=!1)}if(s==="center"){const jt=c==="none"?S:x;for(let zt=0;zt<Wt.length;zt++){const dt=Wt[zt],Z=l[dt.bufferEnd-4]-l[dt.bufferStart],fe=(jt-Z)/2;for(let Tt=dt.bufferStart;Tt<dt.bufferEnd;Tt+=4)l[Tt]+=fe}}else if(s==="right"){const jt=c==="none"?S:x;for(let zt=0;zt<Wt.length;zt++){const dt=Wt[zt],Z=dt.bufferEnd===dt.bufferStart?0:l[dt.bufferEnd-4]-l[dt.bufferStart],fe=jt-Z;for(let Tt=dt.bufferStart;Tt<dt.bufferEnd;Tt+=4)l[Tt]+=fe}}return z(ut),{bufferNumFloats:L,bufferNumQuads:L/16,layoutNumCharacters:ut.done?i.length-w:ut.value.cluster-w+1,fullyProcessed:!!ut.done,maxX:S,maxY:A}}function Gh(n,t,e,i,s,r){const o=i*s,a=r.x1-n,h=r.y1-t;return Qa(r)?{x1:a,y1:h+e-o,x2:a+(r.x2-r.x1),y2:h+e+(r.y2-r.y1)+o}:{x1:0,y1:0,x2:0,y2:0}}const jh=Ts(0,0,0,0);class Vh extends wo{constructor(e){super(e);v(this,"ssdfFontFamilies",{});v(this,"msdfFontFamilies",{});v(this,"sdfShader");v(this,"rendererBounds");this.sdfShader=this.stage.shManager.loadShader("SdfShader").shader,this.rendererBounds={x1:0,y1:0,x2:this.stage.options.appWidth,y2:this.stage.options.appHeight}}getPropertySetters(){return{fontFamily:(e,i)=>{e.props.fontFamily=i,e.trFontFace=void 0,this.invalidateLayoutCache(e)},fontWeight:(e,i)=>{e.props.fontWeight=i,e.trFontFace=void 0,this.invalidateLayoutCache(e)},fontStyle:(e,i)=>{e.props.fontStyle=i,e.trFontFace=void 0,this.invalidateLayoutCache(e)},fontStretch:(e,i)=>{e.props.fontStretch=i,e.trFontFace=void 0,this.invalidateLayoutCache(e)},fontSize:(e,i)=>{e.props.fontSize=i,this.invalidateLayoutCache(e)},text:(e,i)=>{e.props.text=i,this.invalidateLayoutCache(e)},textAlign:(e,i)=>{e.props.textAlign=i,this.invalidateLayoutCache(e)},color:(e,i)=>{e.props.color=i},x:(e,i)=>{e.props.x=i,this.invalidateVisibleWindowCache(e)},y:(e,i)=>{e.props.y=i,this.invalidateVisibleWindowCache(e)},contain:(e,i)=>{e.props.contain=i,this.invalidateLayoutCache(e)},width:(e,i)=>{e.props.width=i,this.invalidateLayoutCache(e)},height:(e,i)=>{e.props.height=i,this.invalidateLayoutCache(e)},offsetY:(e,i)=>{e.props.offsetY=i,this.invalidateLayoutCache(e)},scrollable:(e,i)=>{e.props.scrollable=i,this.invalidateLayoutCache(e)},scrollY:(e,i)=>{e.props.scrollY=i,this.scheduleUpdateState(e)},letterSpacing:(e,i)=>{e.props.letterSpacing=i,this.invalidateLayoutCache(e)},debug:(e,i)=>{e.props.debug=i}}}canRenderFont(e){const{fontFamily:i}=e;return i in this.ssdfFontFamilies||i in this.msdfFontFamilies||i==="$$SDF_FAILURE_TEST$$"}isFontFaceSupported(e){return e instanceof pn}addFontFace(e){z(e instanceof pn);const i=e.fontFamily,s=e.type==="ssdf"?this.ssdfFontFamilies:e.type==="msdf"?this.msdfFontFamilies:void 0;if(!s){console.warn("Invalid font face type: ".concat(e.type));return}let r=s[i];r||(r=new Set,s[i]=r),r.add(e)}createState(e){return{props:e,status:"initialState",updateScheduled:!1,emitter:new Qe,lineCache:[],forceFullLayoutCalc:!1,renderWindow:void 0,visibleWindow:{x1:0,y1:0,x2:0,y2:0,valid:!1},bufferNumFloats:0,bufferNumQuads:0,vertexBuffer:void 0,webGlBuffers:null,bufferUploaded:!1,textH:void 0,textW:void 0,distanceRange:0,trFontFace:void 0,debugData:{updateCount:0,layoutCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,drawCount:0,bufferSize:0}}}updateState(e){let{trFontFace:i}=e;const{textH:s,lineCache:r,debugData:o,forceFullLayoutCalc:a}=e;if(o.updateCount++,e.status==="initialState"&&this.setStatus(e,"loading"),!i&&(i=this.resolveFontFace(e.props),e.trFontFace=i,!i)){const L="SdfTextRenderer: Could not resolve font face for family: '".concat(e.props.fontFamily,"'");console.error(L),this.setStatus(e,"failed",new Error(L));return}if(!i.loaded){i.once("loaded",()=>{this.scheduleUpdateState(e)});return}z(i.data,"Font face data should be loaded");const{text:h,fontSize:l,x:c,y:u,contain:d,width:g,height:_,scrollable:f}=e.props,y=d==="both"&&f?e.props.scrollY:0;let{renderWindow:T}=e;const x=i.data.info.size,m=l/x;e.distanceRange=m*i.data.distanceField.distanceRange;const p=h.length*Qh;let w=e.vertexBuffer;(!w||w.length<p)&&(w=new Float32Array(p*2));const R=e.visibleWindow;if(!R.valid){const L=Ts(c,u,d!=="none"?c+g:1/0,d==="both"?u+_:1/0,jh);ao(this.rendererBounds,L,e.visibleWindow),R.valid=!0}if(!a&&T){if(c+T.x1<=R.x1&&c+T.x2>=R.x2&&u-y+T.y1<=R.y1&&u-y+T.y2>=R.y2){this.setStatus(e,"loaded");return}T=e.renderWindow=void 0,this.setStatus(e,"loading")}const{offsetY:I,textAlign:S}=e.props;if(!T){const L=R.y2-R.y1,k=Math.ceil(L/x);T=Gh(c,u,y,x,k,R)}const A=Yh(l,I,m,x,T,r,s);if(!A){this.setStatus(e,"loaded");return}const{letterSpacing:E}=e.props,F=Xh(A.lineIndex,A.x,A.y,h,S,g,_,l,E,w,d,r,T,i,a,f);e.bufferUploaded=!1,e.bufferNumFloats=F.bufferNumFloats,e.bufferNumQuads=F.bufferNumQuads,e.vertexBuffer=w,e.renderWindow=T,o.lastLayoutNumCharacters=F.layoutNumCharacters,o.bufferSize=w.byteLength,F.fullyProcessed&&(e.textW=F.maxX*m,e.textH=F.maxY*m),this.setStatus(e,"loaded")}renderQuads(e,i,s,r){var S,A,E;if(!e.vertexBuffer)return;performance.now();const{renderer:o}=this.stage;this.stage.options;const{fontSize:a,color:h,contain:l,scrollable:c,zIndex:u,debug:d}=e.props,g=l==="both"&&c?e.props.scrollY:0,{textW:_=0,textH:f=0,distanceRange:y,vertexBuffer:T,bufferUploaded:x,trFontFace:m}=e;let{webGlBuffers:p}=e;if(!p){const F=o.gl,L=4*Float32Array.BYTES_PER_ELEMENT,k=F.createBuffer();z(k),e.webGlBuffers=new Ya([{buffer:k,attributes:{a_position:{name:"a_position",size:2,type:F.FLOAT,normalized:!1,stride:L,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:F.FLOAT,normalized:!1,stride:L,offset:2*Float32Array.BYTES_PER_ELEMENT}}}]),e.bufferUploaded=!1,z(e.webGlBuffers),p=e.webGlBuffers}if(!x){const F=o.gl,L=(S=p==null?void 0:p.getBuffer("a_textureCoordinate"))!=null?S:null;F.bindBuffer(F.ARRAY_BUFFER,L),F.bufferData(F.ARRAY_BUFFER,T,F.STATIC_DRAW),e.bufferUploaded=!0}z(m);const w=new $a(o.gl,o.options,p,this.sdfShader,{transform:i.data,color:Xa(h,r),size:a/(((A=m.data)==null?void 0:A.info.size)||0),scrollY:g,distanceRange:y,debug:d.sdfShaderDebug},r,s,{height:f,width:_},0,u),R=(E=e.trFontFace)==null?void 0:E.texture;z(R);const I=this.stage.txManager.getCtxTexture(R);w.addTexture(I),w.length=e.bufferNumFloats,w.numQuads=e.bufferNumQuads,o.addRenderOp(w)}resolveFontFace(e){return Co.resolveFontFace([this.msdfFontFamilies,this.ssdfFontFamilies],e)}invalidateVisibleWindowCache(e){e.visibleWindow.valid=!1,this.scheduleUpdateState(e)}invalidateLayoutCache(e){e.visibleWindow.valid=!1,e.renderWindow=void 0,e.textH=void 0,e.textW=void 0,e.lineCache=[],this.setStatus(e,"loading"),this.scheduleUpdateState(e)}}const yn=2048;class Kh{constructor(t,e){v(this,"_canvas");v(this,"_context");v(this,"_settings");v(this,"renderInfo");this._canvas=t,this._context=e,this._settings=this.mergeDefaults({})}set settings(t){this._settings=this.mergeDefaults(t)}get settings(){return this._settings}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}_getFontSetting(){const t=[this._settings.fontFace],e=[];for(let i=0,s=t.length;i<s;i++)t[i]==="serif"||t[i]==="sans-serif"?e.push(t[i]):e.push('"'.concat(t[i],'"'));return"".concat(this._settings.fontStyle," ").concat(this._settings.fontSize*this.getPrecision(),"px ").concat(e.join(","))}_load(){if(document.fonts){const t=this._getFontSetting();try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch(e=>{console.warn("[Lightning] Font load error",e,t)}).then(()=>{document.fonts.check(t,this._settings.text)||console.warn("[Lightning] Font not found",t)})}catch(e){console.warn("[Lightning] Can't check font loading for "+t)}}}calculateRenderInfo(){const t={},e=this.getPrecision(),i=this._settings.paddingLeft*e,s=this._settings.paddingRight*e,r=this._settings.fontSize*e;let o=this._settings.offsetY===null?null:this._settings.offsetY*e,a=(this._settings.lineHeight||r)*e;const h=this._settings.w*e,l=this._settings.h*e;let c=this._settings.wordWrapWidth*e;const u=this._settings.cutSx*e,d=this._settings.cutEx*e,g=this._settings.cutSy*e,_=this._settings.cutEy*e,f=(this._settings.letterSpacing||0)*e,y=this._settings.textIndent*e;this.setFontProperties();let T=h||2048/this.getPrecision(),x=T-i;if(x<10&&(T+=10-x,x=10),c||(c=x),this._settings.textOverflow&&!this._settings.wordWrap){let S;switch(this._settings.textOverflow){case"clip":S="";break;case"ellipsis":S=this._settings.maxLinesSuffix;break;default:S=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,c-y,S)}let m;if(this._settings.wordWrap)m=this.wrapText(this._settings.text,c,f,y);else{m={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};const S=m.l.length;for(let A=0;A<S-1;A++)m.n.push(A)}let p=m.l;if(this._settings.maxLines&&p.length>this._settings.maxLines){const S=p.slice(0,this._settings.maxLines);let A=null;if(this._settings.maxLinesSuffix){const V=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,j=this.wrapText(S[S.length-1],c-V,f,y);S[S.length-1]="".concat(j.l[0]).concat(this._settings.maxLinesSuffix),A=[j.l.length>1?j.l[1]:""]}else A=[""];let E;const F=p.length;let L=0;const k=m.n.length;for(E=this._settings.maxLines;E<F;E++)A[L]+="".concat(A[L]?" ":"").concat(p[E]),E+1<k&&m.n[E+1]&&L++;t.remainingText=A.join("\n"),t.moreTextLines=!0,p=S}else t.moreTextLines=!1,t.remainingText="";let w=0;const R=[];for(let S=0;S<p.length;S++){const A=this.measureText(p[S],f)+(S===0?y:0);R.push(A),w=Math.max(w,A)}t.lineWidths=R,h||(T=w+i+s,x=w),a=a||r;let I;if(l)I=l;else{const S=this._settings.textBaseline!="bottom"?.5*r:0;I=a*(p.length-1)+S+Math.max(a,r)+(o||0)}return o===null&&(o=r),t.w=T,t.h=I,t.lines=p,t.precision=e,T||(T=1),I||(I=1),(u||d)&&(T=Math.min(T,d-u)),(g||_)&&(I=Math.min(I,_-g)),t.width=T,t.innerWidth=x,t.height=I,t.fontSize=r,t.cutSx=u,t.cutSy=g,t.cutEx=d,t.cutEy=_,t.lineHeight=a,t.lineWidths=R,t.offsetY=o,t.paddingLeft=i,t.paddingRight=s,t.letterSpacing=f,t.textIndent=y,t}draw(t,e){const i=this.getPrecision(),s=(e==null?void 0:e.lines)||t.lines,r=(e==null?void 0:e.lineWidths)||t.lineWidths,o=e?e.lines.length*t.lineHeight:t.height;this._canvas.width=Math.min(Math.ceil(t.width+this._settings.textRenderIssueMargin),yn),this._canvas.height=Math.min(Math.ceil(o),yn),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy);let a,h;const l=[];for(let u=0,d=s.length;u<d;u++)a=u===0?t.textIndent:0,h=u*t.lineHeight+t.offsetY,this._settings.verticalAlign=="middle"?h+=(t.lineHeight-t.fontSize)/2:this._settings.verticalAlign=="bottom"&&(h+=t.lineHeight-t.fontSize),this._settings.textAlign==="right"?a+=t.innerWidth-r[u]:this._settings.textAlign==="center"&&(a+=(t.innerWidth-r[u])/2),a+=t.paddingLeft,l.push({text:s[u],x:a,y:h,w:r[u]});if(this._settings.highlight){const u=this._settings.highlightColor,d=this._settings.highlightHeight*i||t.fontSize*1.5,g=this._settings.highlightOffset*i,_=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*i:t.paddingLeft,f=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*i:t.paddingRight;this._context.fillStyle=$s(u);for(let y=0;y<l.length;y++){const T=l[y];this._context.fillRect(T.x-_,T.y-t.offsetY+g,T.w+f+_,d)}}let c=null;this._settings.shadow&&(c=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=$s(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*i,this._context.shadowOffsetY=this._settings.shadowOffsetY*i,this._context.shadowBlur=this._settings.shadowBlur*i),this._context.fillStyle=$s(this._settings.textColor);for(let u=0,d=l.length;u<d;u++){const g=l[u];if(t.letterSpacing===0)this._context.fillText(g.text,g.x,g.y);else{const _=g.text.split("");let f=g.x;for(let y=0,T=_.length;y<T;y++)this._context.fillText(_[y],f,g.y),f+=this.measureText(_[y],t.letterSpacing)}}c&&(this._context.shadowColor=c[0],this._context.shadowOffsetX=c[1],this._context.shadowOffsetY=c[2],this._context.shadowBlur=c[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),this.renderInfo=t}wrapWord(t,e,i){const s=this._context.measureText(i).width,r=t.length,o=this._context.measureText(t).width;if(o<=e)return t;let a=Math.floor(e*r/o),h=this._context.measureText(t.substring(0,a)).width+s;if(h>e)for(;a>0&&(h=this._context.measureText(t.substring(0,a)).width+s,h>e);)a-=1;else for(;a<r;)if(h=this._context.measureText(t.substring(0,a)).width+s,h<e)a+=1;else{a-=1;break}return t.substring(0,a)+(e>=s?i:"")}wrapText(t,e,i,s=0){const r=t.split(/\r?\n/g);let o=[];const a=[];for(let h=0;h<r.length;h++){const l=[];let c="",u=e-s;const d=r[h].split(" ");for(let g=0;g<d.length;g++){const _=this.measureText(d[g],i),f=_+this.measureText(" ",i);g===0||f>u?(g>0&&(l.push(c),c=""),c+=d[g],u=e-_-(g===0?s:0)):(u-=f,c+=" ".concat(d[g]))}l.push(c),c="",o=o.concat(l),h<r.length-1&&a.push(o.length)}return{l:o,n:a}}measureText(t,e=0){return e?t.split("").reduce((i,s)=>i+this._context.measureText(s).width+e,0):this._context.measureText(t).width}mergeDefaults(t){return{text:"",w:0,h:0,fontStyle:"normal",fontSize:40,fontFace:null,wordWrap:!0,wordWrapWidth:0,wordBreak:!1,textOverflow:"",lineHeight:null,textBaseline:"alphabetic",textAlign:"left",verticalAlign:"top",offsetY:null,maxLines:0,maxLinesSuffix:"..",textColor:[1,1,1,1],paddingLeft:0,paddingRight:0,shadow:!1,shadowColor:[0,0,0,1],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,highlight:!1,highlightHeight:0,highlightColor:[0,0,0,1],highlightOffset:0,highlightPaddingLeft:0,highlightPaddingRight:0,letterSpacing:0,textIndent:0,cutSx:0,cutEx:0,cutSy:0,cutEy:0,advancedRenderer:!1,fontBaselineRatio:0,precision:1,textRenderIssueMargin:0,...t}}}const vn=typeof self>"u"?globalThis:self;var ro;const An=((ro=vn.document)==null?void 0:ro.fonts)||vn.fonts;function qh(n){const{fontFamily:t,fontStyle:e,fontWeight:i,fontStretch:s,fontSize:r}=n;return[e,i,s,"".concat(r,"px"),t].join(" ")}const Zh=Ts(0,0,0,0);class Jh extends wo{constructor(e){super(e);v(this,"canvas");v(this,"context");v(this,"rendererBounds");typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(0,0):this.canvas=document.createElement("canvas");let i=this.canvas.getContext("2d");i||(this.canvas=document.createElement("canvas"),i=this.canvas.getContext("2d")),z(i),this.context=i,this.rendererBounds={x1:0,y1:0,x2:this.stage.options.appWidth,y2:this.stage.options.appHeight}}getPropertySetters(){return{fontFamily:(e,i)=>{e.props.fontFamily=i,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontWeight:(e,i)=>{e.props.fontWeight=i,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStyle:(e,i)=>{e.props.fontStyle=i,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStretch:(e,i)=>{e.props.fontStretch=i,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontSize:(e,i)=>{e.props.fontSize=i,e.fontInfo=void 0,this.invalidateLayoutCache(e)},text:(e,i)=>{e.props.text=i,this.invalidateLayoutCache(e)},textAlign:(e,i)=>{e.props.textAlign=i,this.invalidateLayoutCache(e)},color:(e,i)=>{e.props.color=i,this.invalidateLayoutCache(e)},x:(e,i)=>{e.props.x=i,this.invalidateVisibleWindowCache(e)},y:(e,i)=>{e.props.y=i,this.invalidateVisibleWindowCache(e)},contain:(e,i)=>{e.props.contain=i,this.invalidateLayoutCache(e)},width:(e,i)=>{e.props.width=i,this.invalidateLayoutCache(e)},height:(e,i)=>{e.props.height=i,this.invalidateLayoutCache(e)},offsetY:(e,i)=>{e.props.offsetY=i,this.invalidateLayoutCache(e)},scrollY:(e,i)=>{e.props.scrollY=i},letterSpacing:(e,i)=>{e.props.letterSpacing=i,this.invalidateLayoutCache(e)}}}canRenderFont(e){return!0}isFontFaceSupported(e){return e instanceof xn}addFontFace(e){z(e instanceof xn),An.add(e.fontFace)}createState(e){return{props:e,status:"initialState",updateScheduled:!1,emitter:new Qe,canvasPages:void 0,lightning2TextRenderer:new Kh(this.canvas,this.context),renderWindow:void 0,visibleWindow:{x1:0,y1:0,x2:0,y2:0,valid:!1},renderInfo:void 0,forceFullLayoutCalc:!1,textW:0,textH:0,fontInfo:void 0,fontFaceLoadedHandler:void 0,debugData:{updateCount:0,layoutCount:0,drawCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,bufferSize:0}}}updateState(e){if(e.status==="initialState"&&this.setStatus(e,"loading"),!e.fontInfo){const _=qh(e.props);if(e.fontInfo={cssString:_,loaded:!1},!e.fontInfo.loaded){An.load(_).then(this.onFontLoaded.bind(this,e,_)).catch(this.onFontLoadError.bind(this,e,_));return}}if(!e.fontInfo.loaded)return;e.renderInfo||(e.lightning2TextRenderer.settings={text:e.props.text,textAlign:e.props.textAlign,fontFace:e.props.fontFamily,fontSize:e.props.fontSize,fontStyle:[e.props.fontStretch,e.props.fontStyle,e.props.fontWeight].join(" "),textColor:se(e.props.color),offsetY:e.props.fontSize+e.props.offsetY,wordWrap:e.props.contain!=="none",wordWrapWidth:e.props.contain==="none"?void 0:e.props.width,letterSpacing:e.props.letterSpacing},e.renderInfo=e.lightning2TextRenderer.calculateRenderInfo(),e.textH=e.renderInfo.lineHeight*e.renderInfo.lines.length,e.textW=e.renderInfo.width,e.renderWindow=void 0);const{x:i,y:s,width:r,height:o,scrollY:a,contain:h}=e.props,{visibleWindow:l}=e;let{renderWindow:c,canvasPages:u}=e;if(!l.valid){const _=Ts(i,s,h!=="none"?i+r:1/0,h==="both"?s+o:1/0,Zh);ao(this.rendererBounds,_,l),l.valid=!0}const d=l.y2-l.y1,g=Math.ceil(d/e.renderInfo.lineHeight);if(d===0){u=void 0,c=void 0,this.setStatus(e,"loaded");return}else if(c&&u){const _=i+c.x1,f=s-a+c.y1,y=i+c.x2,T=s-a+c.y2;if(_<=l.x1&&y>=l.x2&&f<=l.y1&&T>=l.y2){this.setStatus(e,"loaded");return}T<l.y2?(c.y1+=g*e.renderInfo.lineHeight,c.y2+=g*e.renderInfo.lineHeight,u.push(u.shift()),u[2].lineNumStart=u[1].lineNumStart+g,u[2].lineNumEnd=u[2].lineNumStart+g,u[2].valid=!1):f>l.y1&&(c.y1-=g*e.renderInfo.lineHeight,c.y2-=g*e.renderInfo.lineHeight,u.unshift(u.pop()),u[0].lineNumStart=u[1].lineNumStart-g,u[0].lineNumEnd=u[0].lineNumStart+g,u[0].valid=!1)}else{const _=e.renderInfo.lineHeight*g,f=Math.ceil(a/_),y=f*g,T=y-g,x=y+g;u=[{texture:u==null?void 0:u[0].texture,lineNumStart:T,lineNumEnd:T+g,valid:!1},{texture:u==null?void 0:u[1].texture,lineNumStart:y,lineNumEnd:y+g,valid:!1},{texture:u==null?void 0:u[2].texture,lineNumStart:x,lineNumEnd:x+g,valid:!1}],e.canvasPages=u;const m=f*_;c={x1:0,y1:m-_,x2:r,y2:m+_*2}}e.renderWindow=c,performance.now();for(const _ of u)if(!_.valid){if(_.lineNumStart<0){_.texture=this.stage.txManager.loadTexture("ImageTexture",{src:""}),_.valid=!0;continue}e.lightning2TextRenderer.draw(e.renderInfo,{lines:e.renderInfo.lines.slice(_.lineNumStart,_.lineNumEnd),lineWidths:e.renderInfo.lineWidths.slice(_.lineNumStart,_.lineNumEnd)}),this.canvas.width===0||this.canvas.height===0||(_.texture=this.stage.txManager.loadTexture("ImageTexture",{src:this.context.getImageData(0,0,this.canvas.width,this.canvas.height)},{preload:!0})),_.valid=!0}this.setStatus(e,"loaded")}renderQuads(e,i,s,r){var S,A,E,F,L,k,V,j,gt,ut,It,Wt;const{stage:o}=this,{canvasPages:a,textW:h=0,textH:l=0,renderWindow:c}=e;if(!a||!c)return;const{x:u,y:d,scrollY:g,contain:_,width:f,height:y}=e.props,T={x:u,y:d,width:_!=="none"?f:h,height:_==="both"?y:l};no({x:0,y:0,width:o.options.appWidth,height:o.options.appHeight},T),z(a,"canvasPages is not defined"),z(c,"renderWindow is not defined");const m=(c.y2-c.y1)/3,{zIndex:p,color:w}=e.props,R=r*Ga(w),I=fi(4294967295,R);a[0].valid&&this.stage.renderer.addQuad({alpha:R,clippingRect:s,colorBl:I,colorBr:I,colorTl:I,colorTr:I,width:((A=(S=a[0].texture)==null?void 0:S.dimensions)==null?void 0:A.width)||0,height:((F=(E=a[0].texture)==null?void 0:E.dimensions)==null?void 0:F.height)||0,texture:a[0].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:p,tx:i.tx,ty:i.ty-g+c.y1,ta:i.ta,tb:i.tb,tc:i.tc,td:i.td}),a[1].valid&&this.stage.renderer.addQuad({alpha:R,clippingRect:s,colorBl:I,colorBr:I,colorTl:I,colorTr:I,width:((k=(L=a[1].texture)==null?void 0:L.dimensions)==null?void 0:k.width)||0,height:((j=(V=a[1].texture)==null?void 0:V.dimensions)==null?void 0:j.height)||0,texture:a[1].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:p,tx:i.tx,ty:i.ty-g+c.y1+m,ta:i.ta,tb:i.tb,tc:i.tc,td:i.td}),a[2].valid&&this.stage.renderer.addQuad({alpha:R,clippingRect:s,colorBl:I,colorBr:I,colorTl:I,colorTr:I,width:((ut=(gt=a[2].texture)==null?void 0:gt.dimensions)==null?void 0:ut.width)||0,height:((Wt=(It=a[2].texture)==null?void 0:It.dimensions)==null?void 0:Wt.height)||0,texture:a[2].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:p,tx:i.tx,ty:i.ty-g+c.y1+m+m,ta:i.ta,tb:i.tb,tc:i.tc,td:i.td})}invalidateVisibleWindowCache(e){e.visibleWindow.valid=!1,this.setStatus(e,"loading"),this.scheduleUpdateState(e)}invalidateLayoutCache(e){e.renderInfo=void 0,this.setStatus(e,"loading"),this.scheduleUpdateState(e)}onFontLoaded(e,i){var s;i!==((s=e.fontInfo)==null?void 0:s.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,this.scheduleUpdateState(e))}onFontLoadError(e,i,s){var r;i!==((r=e.fontInfo)==null?void 0:r.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,console.error("CanvasTextRenderer: Error loading font '".concat(e.fontInfo.cssString,"'"),s),this.scheduleUpdateState(e))}}const tl=2e6;let el=class extends Qe{constructor(e){super();v(this,"options");v(this,"animationManager");v(this,"txManager");v(this,"fontManager");v(this,"textRenderers");v(this,"shManager");v(this,"renderer");v(this,"root");v(this,"deltaTime",0);v(this,"lastFrameTime",0);v(this,"currentFrameTime",0);v(this,"fpsNumFrames",0);v(this,"fpsElapsedTime",0);v(this,"renderRequested",!1);this.options=e;const{canvas:i,clearColor:s,rootId:r,debug:o,appWidth:a,appHeight:h}=e;this.txManager=new Hh,this.shManager=new Dh,this.animationManager=new kh,o!=null&&o.monitorTextureCache&&setInterval(()=>{z(this.txManager);const c=this.txManager.getDebugInfo();console.log("Texture ID Cache Size: ",c.idCacheSize),console.log("Texture Key Cache Size: ",c.keyCacheSize)},1e3),this.renderer=new ja({stage:this,canvas:i,pixelRatio:e.devicePhysicalPixelRatio*e.deviceLogicalPixelRatio,clearColor:s!=null?s:4278190080,bufferMemory:tl,txManager:this.txManager,shManager:this.shManager}),this.txManager.renderer=this.renderer,this.textRenderers={canvas:new Jh(this),sdf:new Vh(this)},this.fontManager=new Co(this.textRenderers);const l=new Fr(this,{id:r,x:0,y:0,width:a,height:h,alpha:1,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:null,shader:null,shaderProps:null});this.root=l,Bh(this)}updateAnimations(){const{animationManager:e}=this;this.root&&(this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=zh(),this.deltaTime=this.lastFrameTime?this.currentFrameTime-this.lastFrameTime:100/6,e.update(this.deltaTime))}hasSceneUpdates(){return!!this.root.updateType||this.renderRequested}drawFrame(){const{renderer:e,renderRequested:i}=this;this.root.updateType!==0&&this.root.update(this.deltaTime),e==null||e.reset(),this.addQuads(this.root),e==null||e.render(),i&&(this.renderRequested=!1);const{fpsUpdateInterval:s}=this.options;if(s&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=s)){const r=Math.round(this.fpsNumFrames*1e3/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.emit("fpsUpdate",r)}}addQuads(e){z(this.renderer&&e.globalTransform),e.isRenderable&&e.renderQuads(this.renderer);for(let i=0;i<e.children.length;i++){const s=e.children[i];s&&(s==null?void 0:s.worldAlpha)!==0&&this.addQuads(s)}}requestRender(){this.renderRequested=!0}resolveTextRenderer(e,i=null){let s=i,r=!1;if(s){const a=this.textRenderers[s];a?a.canRenderFont(e)||(console.warn("Cannot use override text renderer '".concat(s,"' for font"),e),s=null,r=!0):(console.warn("Text renderer override '".concat(s,"' not found.")),s=null,r=!0)}if(!s){for(const[a,h]of Object.entries(this.textRenderers))if(a!=="canvas"&&h.canRenderFont(e)){s=a;break}s||(s="canvas")}r&&console.warn("Falling back to text renderer ".concat(String(s)));const o=this.textRenderers[s];return z(o,"resolvedTextRenderer undefined"),o}};class il extends Fr{constructor(e,i){super(e,i);v(this,"textRenderer");v(this,"trState");v(this,"_textRendererOverride",null);v(this,"onTextLoaded",()=>{const{contain:e}=this,i=this.trState.props.width,s=this.trState.props.height,r=this.trState.textW||0,o=this.trState.textH||0;e==="both"?(this.props.width=i,this.props.height=s):e==="width"?(this.props.width=i,this.props.height=o):e==="none"&&(this.props.width=r,this.props.height=o),this.updateLocalTransform(),this.stage.requestRender(),this.emit("loaded",{type:"text",dimensions:{width:this.trState.textW||0,height:this.trState.textH||0}})});v(this,"onTextFailed",(e,i)=>{this.emit("failed",{type:"text",error:i})});this._textRendererOverride=i.textRendererOverride;const{resolvedTextRenderer:s,textRendererState:r}=this.resolveTextRendererAndState({x:this.absX,y:this.absY,width:i.width,height:i.height,textAlign:i.textAlign,color:i.color,zIndex:i.zIndex,contain:i.contain,scrollable:i.scrollable,scrollY:i.scrollY,offsetY:i.offsetY,letterSpacing:i.letterSpacing,debug:i.debug,fontFamily:i.fontFamily,fontSize:i.fontSize,fontStretch:i.fontStretch,fontStyle:i.fontStyle,fontWeight:i.fontWeight,text:i.text},void 0);this.textRenderer=s,this.trState=r}get width(){return this.trState.props.width}set width(e){this.textRenderer.set.width(this.trState,e)}get height(){return this.trState.props.height}set height(e){this.textRenderer.set.height(this.trState,e)}get color(){return this.trState.props.color}set color(e){this.textRenderer.set.color(this.trState,e)}get text(){return this.trState.props.text}set text(e){this.textRenderer.set.text(this.trState,e),this.checkIsRenderable()}get textRendererOverride(){return this._textRendererOverride}set textRendererOverride(e){this._textRendererOverride=e;const{resolvedTextRenderer:i,textRendererState:s}=this.resolveTextRendererAndState(this.trState.props,this.trState);this.textRenderer=i,this.trState=s}get fontSize(){return this.trState.props.fontSize}set fontSize(e){this.textRenderer.set.fontSize(this.trState,e)}get fontFamily(){return this.trState.props.fontFamily}set fontFamily(e){this.textRenderer.set.fontFamily(this.trState,e)}get fontStretch(){return this.trState.props.fontStretch}set fontStretch(e){this.textRenderer.set.fontStretch(this.trState,e)}get fontStyle(){return this.trState.props.fontStyle}set fontStyle(e){this.textRenderer.set.fontStyle(this.trState,e)}get fontWeight(){return this.trState.props.fontWeight}set fontWeight(e){this.textRenderer.set.fontWeight(this.trState,e)}get textAlign(){return this.trState.props.textAlign}set textAlign(e){this.textRenderer.set.textAlign(this.trState,e)}get contain(){return this.trState.props.contain}set contain(e){this.textRenderer.set.contain(this.trState,e)}get scrollable(){return this.trState.props.scrollable}set scrollable(e){this.textRenderer.set.scrollable(this.trState,e)}get scrollY(){return this.trState.props.scrollY}set scrollY(e){this.textRenderer.set.scrollY(this.trState,e)}get offsetY(){return this.trState.props.offsetY}set offsetY(e){this.textRenderer.set.offsetY(this.trState,e)}get letterSpacing(){return this.trState.props.letterSpacing}set letterSpacing(e){this.textRenderer.set.letterSpacing(this.trState,e)}get debug(){return this.trState.props.debug}set debug(e){this.textRenderer.set.debug(this.trState,e)}update(e,i=null){super.update(e,i),z(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}checkIsRenderable(){return super.checkIsRenderable()?!0:this.trState.props.text!==""?this.isRenderable=!0:this.isRenderable=!1}renderQuads(e){z(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha)}resolveTextRendererAndState(e,i){const s=this.stage.resolveTextRenderer(e,this._textRendererOverride),r=s.createState(e);return i&&["loading","loaded","failed"].forEach(a=>{i.emitter.off(a)}),r.emitter.on("loaded",this.onTextLoaded),r.emitter.on("failed",this.onTextFailed),s.scheduleUpdateState(r),{resolvedTextRenderer:s,textRendererState:r}}}class sl extends hr{constructor(t,e,i){super(t,e,i,new il(i,{id:Br(),x:t.x,y:t.y,width:t.width,height:t.height,alpha:t.alpha,clipping:t.clipping,color:t.color,colorTop:t.colorTop,colorBottom:t.colorBottom,colorLeft:t.colorLeft,colorRight:t.colorRight,colorTl:t.colorTl,colorTr:t.colorTr,colorBl:t.colorBl,colorBr:t.colorBr,zIndex:t.zIndex,zIndexLocked:t.zIndexLocked,scaleX:t.scaleX,scaleY:t.scaleY,mountX:t.mountX,mountY:t.mountY,mount:t.mount,pivot:t.pivot,pivotX:t.pivotX,pivotY:t.pivotY,rotation:t.rotation,text:t.text,fontSize:t.fontSize,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontStretch:t.fontStretch,fontStyle:t.fontStyle,contain:t.contain,scrollable:t.scrollable,letterSpacing:t.letterSpacing,textAlign:t.textAlign,scrollY:t.scrollY,offsetY:t.offsetY,textRendererOverride:t.textRendererOverride,debug:t.debug,parent:null,texture:null,textureOptions:null,shader:null,shaderProps:null}))}get text(){return this.coreNode.text}set text(t){this.coreNode.text=t}get textRendererOverride(){return this.coreNode.textRendererOverride}set textRendererOverride(t){this.coreNode.textRendererOverride=t}get fontSize(){return this.coreNode.fontSize}set fontSize(t){this.coreNode.fontSize=t}get fontFamily(){return this.coreNode.fontFamily}set fontFamily(t){this.coreNode.fontFamily=t}get fontWeight(){return this.coreNode.fontWeight}set fontWeight(t){this.coreNode.fontWeight=t}get fontStretch(){return this.coreNode.fontStretch}set fontStretch(t){this.coreNode.fontStretch=t}get fontStyle(){return this.coreNode.fontStyle}set fontStyle(t){this.coreNode.fontStyle=t}get textAlign(){return this.coreNode.textAlign}set textAlign(t){this.coreNode.textAlign=t}get contain(){return this.coreNode.contain}set contain(t){this.coreNode.contain=t}get scrollable(){return this.coreNode.scrollable}set scrollable(t){this.coreNode.scrollable=t}get scrollY(){return this.coreNode.scrollY}set scrollY(t){this.coreNode.scrollY=t}get offsetY(){return this.coreNode.offsetY}set offsetY(t){this.coreNode.offsetY=t}get letterSpacing(){return this.coreNode.letterSpacing}set letterSpacing(t){this.coreNode.letterSpacing=t}get debug(){return this.coreNode.debug}set debug(t){this.coreNode.debug=t}}const rl="modulepreload",nl=function(n,t){return new URL(n,t).href},Sn={},ol=function(t,e,i){if(!e||e.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(e.map(r=>{if(r=nl(r,i),r in Sn)return;Sn[r]=!0;const o=r.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let c=s.length-1;c>=0;c--){const u=s[c];if(u.href===r&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector('link[href="'.concat(r,'"]').concat(a)))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":rl,o||(l.as="script",l.crossOrigin=""),l.href=r,document.head.appendChild(l),o)return new Promise((c,u)=>{l.addEventListener("load",c),l.addEventListener("error",()=>u(new Error("Unable to preload CSS for ".concat(r))))})})).then(()=>t()).catch(r=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r})};function al(n){return n.prototype instanceof Va}async function hl(n,t){let e;try{console.log("Loading core extension",n),e=await ol(()=>import(n),[],import.meta.url)}catch(s){console.error("The core extension module at '".concat(n,"' could not be loaded.")),console.error(s);return}if(!e.default){console.error("The core extension module at '".concat(n,"' does not have a default export."));return}const i=e.default;if(al(i)){const s=new i;try{await s.run(t)}catch(r){console.error("The core extension at '".concat(n,"' threw an error.")),console.error(r)}}else console.error("The core extension at '".concat(n,"' does not extend CoreExtension."))}class ll{constructor(){v(this,"root",null);v(this,"stage",null);v(this,"rendererMain",null)}async init(t,e,i){this.stage=new el({rootId:Br(),appWidth:e.appWidth,appHeight:e.appHeight,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio,clearColor:e.clearColor,canvas:i,fpsUpdateInterval:e.fpsUpdateInterval,debug:{monitorTextureCache:!1}}),this.rendererMain=t,z(this.stage.root);const s=new hr(t.resolveNodeDefaults({}),this.rendererMain,this.stage,this.stage.root);this.root=s,s.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,s)),this.onCreateNode(s),e.coreExtensionModule&&await hl(e.coreExtensionModule,this.stage),this.stage.on("fpsUpdate",(r,o)=>{this.onFpsUpdate(o)})}createNode(t){z(this.rendererMain),z(this.stage);const e=new hr(t,this.rendererMain,this.stage);return e.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,e)),this.onCreateNode(e),e}createTextNode(t){z(this.rendererMain),z(this.stage);const e=new sl(t,this.rendererMain,this.stage);return e.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,e)),this.onCreateNode(e),e}destroyNode(t){t.destroy()}releaseTexture(t){const{stage:e}=this;z(e),e.txManager.removeTextureIdFromCache(t)}getRootNode(){return z(this.root),this.root}onCreateNode(t){throw new Error("Method not implemented.")}onBeforeDestroyNode(t){throw new Error("Method not implemented.")}onFpsUpdate(t){throw new Error("Method not implemented.")}}let ve,zr;function cl(n={}){const t=new ll;return ve=new Rh(n,n.rootId||"app",t),zr=ve.createShader.bind(ve),ve}class ul extends Array{constructor(t){super(),this._parent=t}get selected(){return this[this._parent.selected||0]}get firstChild(){return this[0]}insert(t,e){if(e){const i=this.indexOf(e);this.splice(i,0,t)}else this.push(t);t.parent=this._parent,this._parent._isDirty=!0}remove(t){const e=this.indexOf(t);e>=0&&this.splice(e,1)}}import.meta.env={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1,LEGACY:!1};const Ae={debug:!1,animationSettings:{duration:250,easing:"ease-in-out"},fontSettings:{fontFamily:"Ubuntu",fontSize:100}};function dl(n,t,...e){}function ti(n){return typeof n=="function"}function mi(n){return Array.isArray(n)}function fl(n){return typeof n=="string"}function gl(n){return typeof n=="number"}function _l(n){return Number.isInteger(n)}function pl(n,t){for(const e of t)if(e in n)return!0;return!1}function xl(n){return mi(n)?n[0]:n}class Tn extends Array{constructor(t,e={}){var i=(...s)=>{super(...s)};return mi(e)?i(...e):fl(e)?i(e):i(...Object.entries(e).filter(([s,r])=>r).map(([s])=>s)),this.onChange=t,this}has(t){return this.indexOf(t)>=0}is(t){return this.indexOf(t)>=0}add(t){this.push(t),this.onChange()}toggle(t){this.has(t)?this.remove(t):this.add(t)}remove(t){const e=this.indexOf(t);e>=0&&(this.splice(e,1),this.onChange())}}function ml(n){const t=[];for(let x=0;x<n.children.length;x++){const m=n.children[x];if(m.name!=="TextNode"){if(m.name==="text"&&!(m.width||m.height))return!1;t.push(m)}}const e=t.length,s=(n.flexDirection||"row")==="row",r=s?"width":"height",o=s?"height":"width",a=s?"marginLeft":"marginTop",h=s?"marginRight":"marginBottom",l=s?"x":"y",c=s?"y":"x",u=n[r]||0,d=n[o]||0,g=n.gap||0,_=n.justifyContent||"flexStart",f=n.alignItems;let y=0;["center","spaceBetween","spaceEvenly"].includes(_)&&(y=t.reduce((x,m)=>x+(m[r]||0),0));const T=d&&f?x=>{f==="flexStart"?x[c]=0:f==="center"?x[c]=(d-(x[o]||0))/2:f==="flexEnd"&&(x[c]=d-(x[o]||0))}:x=>x;if(_==="flexStart"){let x=0;if(t.forEach(m=>{m[l]=x+(m[a]||0),x+=(m[r]||0)+g+(m[a]||0)+(m[h]||0),T(m)}),n._autosized){const m=x-g;if(m!==n[r])return n[r]=m,!0}}else if(_==="flexEnd"){let x=u;for(let m=e-1;m>=0;m--){const p=t[m];z(p),p[l]=x-(p[r]||0)-(p[h]||0),x-=(p[r]||0)+g+(p[a]||0)+(p[h]||0),T(p)}}else if(_==="center"){let x=(u-(y+g*(e-1)))/2;t.forEach(m=>{m[l]=x,x+=(m[r]||0)+g,T(m)})}else if(_==="spaceBetween"){const x=(u-y)/(e-1);let m=0;t.forEach(p=>{p[l]=m,m+=(p[r]||0)+x,T(p)})}else if(_==="spaceEvenly"){const x=(u-y)/(e+1);let m=x;t.forEach(p=>{p[l]=m,m+=(p[r]||0)+x,T(p)})}return!1}const{animationSettings:yl}=Ae;function vl(n){const t=[];for(const[e,i]of Object.entries(n))t.push({type:e,props:i});return zr("DynamicShader",{effects:t})}function ui(n=""){return{set(t){gl(t)&&(t={width:t,color:255}),this.effects={...this.effects||{},["border".concat(n)]:t},this["_border".concat(n)]=t},get(){return this["_border".concat(n)]}}}const Al=["alpha","color","colorTop","colorRight","colorLeft","colorBottom","colorTl","colorTr","colorBl","colorBr","height","fontSize","lineHeight","mount","mountX","mountY","pivot","pivotX","pivotY","rotation","scale","width","worldX","worldY","x","y","zIndex","zIndexLocked"],Sl=["clipping","contain","fontFamily","src","text","textAlign","texture","maxLines","maxLinesSuffix","textBaseline","textOverflow","verticalAlign","wordWrap"];class Ne extends Object{constructor(t){super(),this.lng=null,this._parent=null,this.name=t,this.rendered=!1,this.autofocus=!1,this._renderProps={x:0,y:0},this.children=new ul(this);for(const e of Al)Object.defineProperty(this,e,{get(){return this["_".concat(e)]||this.lng&&this.lng[e]},set(i){this["_".concat(e)]=xl(i),this._sendToLightningAnimatable(e,i)}});for(const e of Sl)Object.defineProperty(this,e,{get(){return this["_".concat(e)]||this.lng&&this.lng[e]},set(i){this["_".concat(e)]=i,this._sendToLightning(e,i)}});Object.defineProperties(this,{borderRadius:{set(e){this._borderRadius=e,this.effects={...this.effects||{},radius:{radius:e}}},get(){return this._borderRadius}},border:ui(),borderLeft:ui("Left"),borderRight:ui("Right"),borderTop:ui("Top"),borderBottom:ui("Bottom")}),Object.defineProperties(this,{linearGradient:{set(e={}){this._linearGradient=e,this.effects={...this.effects||{},linearGradient:e}},get(){return this._linearGradient}}})}get effects(){return this._effects}set effects(t){this._effects=t,this.shader=vl(t)}get parent(){return this._parent}set parent(t){var e;this._parent=t,this.rendered&&this.lng&&(this.lng.parent=(e=t==null?void 0:t.lng)!=null?e:null)}get shader(){return this._shader}set shader(t){mi(t)?this._shader=zr(...t):this._shader=t,this._sendToLightning("shader",this._shader)}_sendToLightningAnimatable(t,e){if(this.rendered&&this.lng){if(mi(e))return this.createAnimation({[t]:e[0]},e[1]).start();if(this._animate)return this.createAnimation({[t]:e}).start();this.lng[t]=e}else mi(e)&&(e=e[0]),this._renderProps[t]=e}_sendToLightning(t,e){this.rendered&&this.lng?this.lng[t]=e:this._renderProps[t]=e}createAnimation(t,e){return z(this.lng,"Node must be rendered before animating"),this.lng.animate(t,e||this.animationSettings)}setFocus(){this.rendered?vo(this):this.autofocus=!0}isTextNode(){return this.name==="text"}_resizeOnTextLoad(){this.lng.once("loaded",(t,e)=>{if(e.type==="text"){const{dimensions:i}=e;this.width=i.width,this.height=i.height,this.parent.updateLayout(this,i)}})}getText(){return this.children.map(t=>t.text).join("")}destroy(){this.lng&&ve.destroyNode(this.lng)}set style(t){for(let e in t)e==="animate"&&(e="_animate"),this[e]||(this[e]=t[e]);this._style=t}get style(){return this._style}get hasChildren(){return this.children.length>0}set states(t){this._states=new Tn(this._stateChanged.bind(this),t),this.rendered&&this._stateChanged()}get states(){return this._states=this._states||new Tn(this._stateChanged.bind(this)),this._states}get animationSettings(){return this._animationSettings||yl}set animationSettings(t){this._animationSettings=t}updateLayout(t,e){var i;this.hasChildren&&(ti(this.onBeforeLayout)&&this.onBeforeLayout.call(this,t,e),this.display==="flex"&&ml(this)&&((i=this.parent)==null||i.updateLayout()),ti(this.onLayout)&&this.onLayout.call(this,t,e))}_stateChanged(){var e;if(dl("State Changed: ",this,this.states),this.forwardStates){const i=this.states.slice();this.children.forEach(s=>s.states=i)}const t=((e=Ae.stateMapperHook)==null?void 0:e.call(Ae,this,this.states))||this.states;if(this._undoStates||this.style&&pl(this.style,t)){this._undoStates=this._undoStates||{};let i={};for(const[r,o]of Object.entries(this._undoStates))t.includes(r)||(i={...i,...o});const s=t.reduce((r,o)=>{const a=this.style[o];return a&&(r={...r,...a},this._undoStates&&!this._undoStates[o]&&(this._undoStates[o]={},Object.keys(a).forEach(h=>{this._undoStates[o][h]=this[h]}))),r},{});Object.assign(this,{...i,...s})}}render(){const t=this,e=this.parent;e._isDirty&&(e.updateLayout(),e._isDirty=!1),t.updateLayout(),this.states.length&&this._stateChanged();let i=t._renderProps;e.lng&&(i.parent=e.lng),t.isTextNode()?(i={...Ae.fontSettings,...i,text:t.getText()},i.contain&&(i.width||(i.width=(e.width||0)-i.x-(i.marginRight||0),t._width=i.width,t._autosized=!0),!i.height&&i.contain==="both"&&(i.height=(e.height||0)-i.y-(i.marginBottom||0),t._height=i.height,t._autosized=!0)),t.lng=ve.createTextNode(i),ti(this.onCreate)&&this.onCreate.call(this,t),ti(t.onLoad)&&t.lng.on("loaded",t.onLoad),(!t.width||!t.height)&&(t._autosized=!0,t._resizeOnTextLoad())):(i.src||i.texture||(isNaN(i.width)&&(i.width=(e.width||0)-i.x,t._width=i.width,t._autosized=!0),isNaN(i.height)&&(i.height=(e.height||0)-i.y,t._height=i.height,t._autosized=!0),i.color||(t._color=i.color=0)),t.lng=ve.createNode(i),t.onFail&&t.lng.on("failed",t.onFail),t.onLoad&&t.lng.on("loaded",t.onLoad),ti(this.onCreate)&&this.onCreate.call(this,t)),t.rendered=!0,t.autofocus&&t.setFocus(),delete this._renderProps}}const tt=n=>(()=>{const t=ai("text");return Ri(t,n,!1),t})(),D=n=>(()=>{const t=ai("node");return Ri(t,n,!1),t})();function bo(n){n.name!=="TextNode"&&(z(n instanceof Ne),n.render(),n.children.forEach(t=>bo(t)))}const Tl=n=>{const t=cl(n.options),e=t.init();let i;return Rt(()=>{e.then(()=>{z(i),i.lng=t.root,i.children.forEach(bo),ti(n.onFirstRender)&&n.onFirstRender(i)}).catch(console.error)}),(()=>{const s=ai("canvas"),r=i;return typeof r=="function"?Io(r,s):i=s,Rs(s,()=>n.children),s})()};function Cl({createElement:n,createTextNode:t,isTextNode:e,replaceText:i,insertNode:s,removeNode:r,setProperty:o,getParentNode:a,getFirstChild:h,getNextSibling:l}){function c(x,m,p,w){if(p!==void 0&&!w&&(w=[]),typeof m!="function")return u(x,m,w,p);Kt(R=>u(x,m(),R,p),w)}function u(x,m,p,w,R){for(;typeof p=="function";)p=p();if(m===p)return p;const I=typeof m,S=w!==void 0;if(I==="string"||I==="number")if(I==="number"&&(m=m.toString()),S){let A=p[0];A&&e(A)?i(A,m):A=t(m),p=_(x,p,w,A)}else p!==""&&typeof p=="string"?i(h(x),p=m):(_(x,p,w,t(m)),p=m);else if(m==null||I==="boolean")p=_(x,p,w);else{if(I==="function")return Kt(()=>{let A=m();for(;typeof A=="function";)A=A();p=u(x,A,p,w)}),()=>p;if(Array.isArray(m)){const A=[];if(d(A,m,R))return Kt(()=>p=u(x,A,p,w,!0)),()=>p;if(A.length===0){const E=_(x,p,w);if(S)return p=E}else Array.isArray(p)?p.length===0?f(x,A,w):g(x,p,A):p==null||p===""?f(x,A):g(x,S&&p||[h(x)],A);p=A}else{if(Array.isArray(p)){if(S)return p=_(x,p,w,m);_(x,p,null,m)}else p==null||p===""||!h(x)?s(x,m):y(x,m,h(x));p=m}}return p}function d(x,m,p){let w=!1;for(let R=0,I=m.length;R<I;R++){let S=m[R],A;if(!(S==null||S===!0||S===!1))if(Array.isArray(S))w=d(x,S)||w;else if((A=typeof S)=="string"||A==="number")x.push(t(S));else if(A==="function")if(p){for(;typeof S=="function";)S=S();w=d(x,Array.isArray(S)?S:[S])||w}else x.push(S),w=!0;else x.push(S)}return w}function g(x,m,p){let w=p.length,R=m.length,I=w,S=0,A=0,E=l(m[R-1]),F=null;for(;S<R||A<I;){if(m[S]===p[A]){S++,A++;continue}for(;m[R-1]===p[I-1];)R--,I--;if(R===S){const L=I<w?A?l(p[A-1]):p[I-A]:E;for(;A<I;)s(x,p[A++],L)}else if(I===A)for(;S<R;)(!F||!F.has(m[S]))&&r(x,m[S]),S++;else if(m[S]===p[I-1]&&p[A]===m[R-1]){const L=l(m[--R]);s(x,p[A++],l(m[S++])),s(x,p[--I],L),m[R]=p[I]}else{if(!F){F=new Map;let k=A;for(;k<I;)F.set(p[k],k++)}const L=F.get(m[S]);if(L!=null)if(A<L&&L<I){let k=S,V=1,j;for(;++k<R&&k<I&&!((j=F.get(m[k]))==null||j!==L+V);)V++;if(V>L-A){const gt=m[S];for(;A<L;)s(x,p[A++],gt)}else y(x,p[A++],m[S++])}else S++;else r(x,m[S++])}}}function _(x,m,p,w){if(p===void 0){let I;for(;I=h(x);)r(x,I);return w&&s(x,w),""}const R=w||t("");if(m.length){let I=!1;for(let S=m.length-1;S>=0;S--){const A=m[S];if(R!==A){const E=a(A)===x;!I&&!S?E?y(x,R,A):s(x,R,p):E&&r(x,A)}else I=!0}}else s(x,R,p);return[R]}function f(x,m,p){for(let w=0,R=m.length;w<R;w++)s(x,m[w],p)}function y(x,m,p){s(x,m,p),r(x,p)}function T(x,m,p={},w){return m||(m={}),w||Kt(()=>p.children=u(x,m.children,p.children)),Kt(()=>m.ref&&m.ref(x)),Kt(()=>{for(const R in m){if(R==="children"||R==="ref")continue;const I=m[R];I!==p[R]&&(o(x,R,I,p[R]),p[R]=I)}}),p}return{render(x,m){let p;return ii(w=>{p=w,c(m,x())}),p},insert:c,spread(x,m,p){typeof m=="function"?Kt(w=>T(x,m(),w,p)):T(x,m,void 0,p)},createElement:n,createTextNode:t,insertNode:s,setProp(x,m,p,w){return o(x,m,p,w),p},mergeProps:Pr,effect:Kt,memo:lt,createComponent:yo,use(x,m,p){return At(()=>x(m,p))}}}function wl(n){const t=Cl(n);return t.mergeProps=Pr,t}const bl={createElement(n){const t=new Ne(n);return ve.root&&Rt(()=>t.render()),t},createTextNode(n){return{name:"TextNode",text:n,parent:null}},replaceText(n,t){n.text=t;const e=n.parent;z(e),e._autosized&&e._resizeOnTextLoad(),e.text=e.getText()},setProperty(n,t,e=!0){if(t==="animate"){n._animate=e;return}n[t]=e},insertNode(n,t,e){n&&(n.children.insert(t,e),t.name==="TextNode"&&n.isTextNode()&&(n._autosized&&n._resizeOnTextLoad(),n.text=n.getText()))},isTextNode(n){return n.isTextNode()},removeNode(n,t){n.children.remove(t),t instanceof Ne&&t.destroy()},getParentNode(n){var t;return(t=n.parent)!=null?t:void 0},getFirstChild(n){return n.children[0]},getNextSibling(n){if(n.parent){const t=n.parent.children||[],e=t.indexOf(n)+1;if(e<t.length)return t[e]}}},Eo=wl(bl),El=Eo.render,{effect:Vf,memo:Ro,createComponent:C,createElement:ai,createTextNode:Kf,insertNode:qf,insert:Rs,spread:Ri,setProp:os,mergeProps:St,use:Io}=Eo;function O(n=""){return _l(n)?n:typeof n=="string"?n.startsWith("#")?+(n.replace("#","0x")+(n.length===7?"ff":"")):n.startsWith("0x")?Number(n):+("0x"+(n.length===6?n+"ff":n)):0}function Rl(n){return n*Math.PI/180}const Cn="_$DX_DELEGATE";function Il(n,t=window.document){const e=t[Cn]||(t[Cn]=new Set);for(let i=0,s=n.length;i<s;i++){const r=n[i];e.has(r)||(e.add(r),t.addEventListener(r,Ll))}}function Ll(n){const t="$$".concat(n.type);let e=n.composedPath&&n.composedPath()[0]||n.target;for(n.target!==e&&Object.defineProperty(n,"target",{configurable:!0,value:e}),Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return e||document}});e;){const i=e[t];if(i&&!e.disabled){const s=e["".concat(t,"Data")];if(s!==void 0?i.call(e,s,n):i.call(e,n),n.cancelBubble)return}e=e._$host||e.parentNode||e.host}}const Pl=!1;function Fl(){let n=new Set;function t(s){return n.add(s),()=>n.delete(s)}let e=!1;function i(s,r){if(e)return!(e=!1);const o={to:s,options:r,defaultPrevented:!1,preventDefault:()=>o.defaultPrevented=!0};for(const a of n)a.listener({...o,from:a.location,retry:h=>{h&&(e=!0),a.navigate(s,r)}});return!o.defaultPrevented}return{subscribe:t,confirm:i}}const Bl=/^(?:[a-z0-9]+:)?\/\//i,zl=/^\/+|(\/)\/+$/g;function yi(n,t=!1){const e=n.replace(zl,"$1");return e?t||/^[?#]/.test(e)?e:"/"+e:""}function Vi(n,t,e){if(Bl.test(t))return;const i=yi(n),s=e&&yi(e);let r="";return!s||t.startsWith("/")?r=i:s.toLowerCase().indexOf(i.toLowerCase())!==0?r=i+s:r=s,(r||"/")+yi(t,!r)}function Ml(n,t){if(n==null)throw new Error(t);return n}function Ol(n,t){return yi(n).replace(/\/*(\*.*)?$/g,"")+yi(t)}function Lo(n){const t={};return n.searchParams.forEach((e,i)=>{t[i]=e}),t}function Dl(n,t,e){const[i,s]=n.split("/*",2),r=i.split("/").filter(Boolean),o=r.length;return a=>{const h=a.split("/").filter(Boolean),l=h.length-o;if(l<0||l>0&&s===void 0&&!t)return null;const c={path:o?"":"/",params:{}},u=d=>e===void 0?void 0:e[d];for(let d=0;d<o;d++){const g=r[d],_=h[d],f=g[0]===":",y=f?g.slice(1):g;if(f&&Vs(_,u(y)))c.params[y]=_;else if(f||!Vs(_,g))return null;c.path+="/".concat(_)}if(s){const d=l?h.slice(-l).join("/"):"";if(Vs(d,u(s)))c.params[s]=d;else return null}return c}}function Vs(n,t){const e=i=>i.localeCompare(n,void 0,{sensitivity:"base"})===0;return t===void 0?!0:typeof t=="string"?e(t):typeof t=="function"?t(n):Array.isArray(t)?t.some(e):t instanceof RegExp?t.test(n):!1}function kl(n){const[t,e]=n.pattern.split("/*",2),i=t.split("/").filter(Boolean);return i.reduce((s,r)=>s+(r.startsWith(":")?2:3),i.length-(e===void 0?0:1))}function Po(n){const t=new Map,e=ws();return new Proxy({},{get(i,s){return t.has(s)||gh(e,()=>t.set(s,lt(()=>n()[s]))),t.get(s)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(n())}})}function Fo(n){let t=/(\/?\:[^\/]+)\?/.exec(n);if(!t)return[n];let e=n.slice(0,t.index),i=n.slice(t.index+t[0].length);const s=[e,e+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(i);)s.push(e+=t[1]),i=i.slice(t[0].length);return Fo(i).reduce((r,o)=>[...r,...s.map(a=>a+o)],[])}const Ul=100,Bo=fo(),Is=fo(),Mr=()=>Ml(bs(Bo),"Make sure your app is wrapped in a <Router />"),Nl=()=>bs(Is)||Mr().base,Ls=()=>Mr().navigatorFactory(),Hl=()=>Mr().location,Or=()=>Nl().params;function Wl(n,t=""){const{component:e,load:i,children:s,metadata:r}=n,o=!s||Array.isArray(s)&&!s.length,a={key:n,component:e,load:i,metadata:r};return zo(n.path).reduce((h,l)=>{for(const c of Fo(l)){const u=Ol(t,c),d=o?u:u.split("/*",1)[0];h.push({...a,originalPath:c,pattern:d,matcher:Dl(d,!o,n.matchFilters)})}return h},[])}function Ql(n,t=0){return{routes:n,score:kl(n[n.length-1])*1e4-t,matcher(e){const i=[];for(let s=n.length-1;s>=0;s--){const r=n[s],o=r.matcher(e);if(!o)return null;i.unshift({...o,route:r})}return i}}}function zo(n){return Array.isArray(n)?n:[n]}function Mo(n,t="",e=[],i=[]){const s=zo(n);for(let r=0,o=s.length;r<o;r++){const a=s[r];if(a&&typeof a=="object"){a.hasOwnProperty("path")||(a.path="");const h=Wl(a,t);for(const l of h){e.push(l);const c=Array.isArray(a.children)&&a.children.length===0;if(a.children&&!c)Mo(a.children,l.pattern,e,i);else{const u=Ql([...e],i.length);i.push(u)}e.pop()}}}return e.length?i:i.sort((r,o)=>o.score-r.score)}function Oo(n,t){for(let e=0,i=n.length;e<i;e++){const s=n[e].matcher(t);if(s)return s}return[]}function Yl(n,t){const e=new URL("http://sar"),i=lt(h=>{const l=n();try{return new URL(l,e)}catch(c){return console.error("Invalid path ".concat(l)),h}},e,{equals:(h,l)=>h.href===l.href}),s=lt(()=>i().pathname),r=lt(()=>i().search,!0),o=lt(()=>i().hash),a=()=>"";return{get pathname(){return s()},get search(){return r()},get hash(){return o()},get state(){return t()},get key(){return a()},query:Po(Xt(r,()=>Lo(i())))}}let _e;function $l(n,t,e={}){const{signal:[i,s],utils:r={}}=n,o=r.parsePath||(A=>A),a=r.renderPath||(A=>A),h=r.beforeLeave||Fl(),l=Vi("",e.base||"");if(l===void 0)throw new Error("".concat(l," is not a valid base path"));l&&!i().value&&s({value:l,replace:!0,scroll:!1});const[c,u]=Y(!1),d=async A=>{u(!0);try{await _h(A)}finally{u(!1)}},[g,_]=Y(i().value),[f,y]=Y(i().state),T=Yl(g,f),x=[],m=Y([]),p={pattern:l,params:{},path:()=>l,outlet:()=>null,resolvePath(A){return Vi(l,A)}};return Kt(()=>{const{value:A,state:E}=i();At(()=>{A!==g()&&d(()=>{_e="native",_(A),y(E),m[1]([])}).then(()=>{_e=void 0})})}),{base:p,location:T,isRouting:c,renderPath:a,parsePath:o,navigatorFactory:R,beforeLeave:h,preloadRoute:S,submissions:m};function w(A,E,F){At(()=>{if(typeof E=="number"){E&&(r.go?h.confirm(E,F)&&r.go(E):console.warn("Router integration does not support relative routing"));return}const{replace:L,resolve:k,scroll:V,state:j}={replace:!1,resolve:!0,scroll:!0,...F},gt=k?A.resolvePath(E):Vi("",E);if(gt===void 0)throw new Error("Path '".concat(E,"' is not a routable path"));if(x.length>=Ul)throw new Error("Too many redirects");const ut=g();if((gt!==ut||j!==f())&&!Pl){if(h.confirm(gt,F)){const It=x.push({value:ut,replace:L,scroll:V,state:f()});d(()=>{_e="navigate",_(gt),y(j),m[1]([])}).then(()=>{x.length===It&&(_e=void 0,I({value:gt,state:j}))})}}})}function R(A){return A=A||bs(Is)||p,(E,F)=>w(A,E,F)}function I(A){const E=x[0];E&&((A.value!==E.value||A.state!==E.state)&&s({...A,replace:E.replace,scroll:E.scroll}),x.length=0)}function S(A,E){const F=Oo(t(),A.pathname),L=_e;_e="preload";for(let k in F){const{route:V,params:j}=F[k];V.component&&V.component.preload&&V.component.preload(),E&&V.load&&V.load({params:j,location:{pathname:A.pathname,search:A.search,hash:A.hash,query:Lo(A),state:null,key:""},intent:"preload"})}_e=L}}function Xl(n,t,e,i,s){const{base:r,location:o}=n,{pattern:a,component:h,load:l}=i().route,c=lt(()=>i().path);h&&h.preload&&h.preload();const u=l?l({params:s,location:o,intent:_e||"initial"}):void 0;return{parent:t,pattern:a,path:c,params:s,outlet:()=>h?yo(h,{params:s,location:o,data:u,get children(){return e()}}):e(),resolvePath(g){return Vi(r.path(),g,c())}}}const Gl=n=>t=>{const{base:e}=t,i=Ir(()=>t.children),s=lt(()=>Mo(t.root?{component:t.root,children:i()}:i(),t.base||"")),r=$l(n,s,{base:e});return n.create&&n.create(r),C(Bo.Provider,{value:r,get children(){return C(jl,{routerState:r,get branches(){return s()}})}})};function jl(n){const t=lt(()=>Oo(n.branches,n.routerState.location.pathname)),e=Po(()=>{const o=t(),a={};for(let h=0;h<o.length;h++)Object.assign(a,o[h].params);return a}),i=[];let s;const r=lt(Xt(t,(o,a,h)=>{let l=a&&o.length===a.length;const c=[];for(let u=0,d=o.length;u<d;u++){const g=a&&a[u],_=o[u];h&&g&&_.route.key===g.route.key?c[u]=h[u]:(l=!1,i[u]&&i[u](),ii(f=>{i[u]=f,c[u]=Xl(n.routerState,c[u-1]||n.routerState.base,Vl(()=>r()[u+1]),()=>t()[u],e)}))}return i.splice(o.length).forEach(u=>u()),h&&l?h:(s=c[0],c)}));return C(le,{get when(){return r()&&s},keyed:!0,children:o=>C(Is.Provider,{value:o,get children(){return o.outlet()}})})}const Vl=n=>()=>C(le,{get when(){return n()},keyed:!0,children:t=>C(Is.Provider,{value:t,get children(){return t.outlet()}})}),Xe=n=>{const t=Ir(()=>n.children);return Pr(n,{get children(){return t()}})};function Kl([n,t],e,i){return[e?()=>e(n()):n,i?s=>t(i(s)):t]}function ql(n){if(n==="#")return null;try{return document.querySelector(n)}catch(t){return null}}function Zl(n){let t=!1;const e=s=>typeof s=="string"?{value:s}:s,i=Kl(Y(e(n.get()),{equals:(s,r)=>s.value===r.value}),void 0,s=>(!t&&n.set(s),s));return n.init&&Te(n.init((s=n.get())=>{t=!0,i[1](e(s)),t=!1})),Gl({signal:i,create:n.create,utils:n.utils})}function Jl(n,t,e){return n.addEventListener(t,e),()=>n.removeEventListener(t,e)}function tc(n,t){const e=ql("#".concat(n));e?e.scrollIntoView():t&&window.scrollTo(0,0)}const ec=new Map;function ic(n=!0,t=!1,e="/_server"){return i=>{const s=i.base.path(),r=i.navigatorFactory(i.base);let o={};function a(_){return _.namespaceURI==="http://www.w3.org/2000/svg"}function h(_){if(_.defaultPrevented||_.button!==0||_.metaKey||_.altKey||_.ctrlKey||_.shiftKey)return;const f=_.composedPath().find(w=>w instanceof Node&&w.nodeName.toUpperCase()==="A");if(!f||t&&!f.getAttribute("link"))return;const y=a(f),T=y?f.href.baseVal:f.href;if((y?f.target.baseVal:f.target)||!T&&!f.hasAttribute("state"))return;const m=(f.getAttribute("rel")||"").split(/\s+/);if(f.hasAttribute("download")||m&&m.includes("external"))return;const p=y?new URL(T,document.baseURI):new URL(T);if(!(p.origin!==window.location.origin||s&&p.pathname&&!p.pathname.toLowerCase().startsWith(s.toLowerCase())))return[f,p]}function l(_){const f=h(_);if(!f)return;const[y,T]=f,x=i.parsePath(T.pathname+T.search+T.hash),m=y.getAttribute("state");_.preventDefault(),r(x,{resolve:!1,replace:y.hasAttribute("replace"),scroll:!y.hasAttribute("noscroll"),state:m&&JSON.parse(m)})}function c(_){const f=h(_);if(!f)return;const[y,T]=f;o[T.pathname]||i.preloadRoute(T,y.getAttribute("preload")!=="false")}function u(_){const f=h(_);if(!f)return;const[y,T]=f;o[T.pathname]||(o[T.pathname]=setTimeout(()=>{i.preloadRoute(T,y.getAttribute("preload")!=="false"),delete o[T.pathname]},200))}function d(_){const f=h(_);if(!f)return;const[,y]=f;o[y.pathname]&&(clearTimeout(o[y.pathname]),delete o[y.pathname])}function g(_){let f=_.submitter&&_.submitter.hasAttribute("formaction")?_.submitter.formAction:_.target.action;if(!f)return;if(!f.startsWith("action:")){const T=new URL(f);if(f=i.parsePath(T.pathname+T.search),!f.startsWith(e))return}if(_.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const y=ec.get(f);if(y){_.preventDefault();const T=new FormData(_.target);y.call(i,T)}}Il(["click","submit"]),document.addEventListener("click",l),n&&(document.addEventListener("mouseover",u),document.addEventListener("mouseout",d),document.addEventListener("focusin",c),document.addEventListener("touchstart",c)),document.addEventListener("submit",g),Te(()=>{document.removeEventListener("click",l),n&&(document.removeEventListener("mouseover",u),document.removeEventListener("mouseout",d),document.removeEventListener("focusin",c),document.removeEventListener("touchstart",c)),document.removeEventListener("submit",g)})}}function sc(n){const t=n.replace(/^.*?#/,"");if(!t.startsWith("/")){const[,e="/"]=window.location.hash.split("#",2);return"".concat(e,"#").concat(t)}return t}function rc(n){return Zl({get:()=>window.location.hash.slice(1),set({value:t,replace:e,scroll:i,state:s}){e?window.history.replaceState(s,"","#"+t):window.location.hash=t;const r=t.indexOf("#"),o=r>=0?t.slice(r+1):"";tc(o,i)},init:t=>Jl(window,"hashchange",()=>t()),create:ic(n.preload,n.explicitLinks,n.actionBase),utils:{go:t=>window.history.go(t),renderPath:t=>"#".concat(t),parsePath:sc}})(n)}var nc=!!wh,oc=nc?n=>ws()?Te(n):n:Te;function ac(n,t,e,i){return n.addEventListener(t,e,i),oc(n.removeEventListener.bind(n,t,e,i))}function hc(n,t=ws()){let e=0,i,s;return()=>(e++,Te(()=>{e--,queueMicrotask(()=>{!e&&s&&(s(),s=i=void 0)})}),s||ii(r=>i=n(s=r),t),i)}var lc=hc(()=>{const[n,t]=Y(null);return ac(window,"keydown",e=>{t(e),setTimeout(()=>t(null))}),n});function Oi(n){return typeof n=="function"}function wn(n,t){if(!n)throw new Error(t||"Assertion failed")}let Ks={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Enter:"Enter",Last:"l"};const[as,cc]=Y([]),uc=(n={})=>{const t=lc();Ks={...Ks,...n};const e=Object.entries(Ks);return Rt(Xt(ce,(i,s,r=[])=>{var h;let o=i;const a=[];for(;o;)o.states.has("focus")||(o.states.add("focus"),Oi(o.onFocus)&&o.onFocus.call(o,i,s!=null?s:null)),a.push(o),o=(h=o.parent)!=null?h:null;return r.forEach(l=>{a.includes(l)||(l.states.remove("focus"),Oi(l.onBlur)&&l.onBlur.call(l,i,s!=null?s:null))}),cc(a),a},{defer:!0})),Rt(()=>{const i=t();if(i){const s=e.find(([r,o])=>o===i.key);At(()=>{const r=as();for(const o of r){const a=s?s[0]:void 0;if(a){const h=o["on".concat(a)];if(Oi(h)&&h.call(o,i,o)===!0)break}else console.log("Unhandled key event: ".concat(i.key));if(Oi(o.onKeyPress)&&o.onKeyPress.call(o,i,a,o)===!0)break}return!1})}}),as};function dc(n,t){const e=t();let i,s,r,o;Array.isArray(e)?e.length===2?(i=o=e[0],s=r=e[1]):e.length===3?(i=e[0],s=r=e[1],o=e[2]):[i,r,o,s]=e:i=r=o=s=e,n.onBeforeLayout=(a,h)=>{if(h){n.width=n.children.reduce((u,d)=>u+(d.width||0),0)+s+r;const l=n.children[0];l&&(l.x=s,l.marginLeft=s);let c=0;n.children.forEach(u=>{u.y=(u.y||0)+i,u.marginTop=i,c=Math.max(c,u.height||0)}),n.height=c+i+o}}}function fc(n=[]){const t=[];let e;for(e=0;e<n.length;e++){const i=n[e];if(typeof i=="string"&&!i.includes("PAUSE-"))t.push(n[e]);else break}return[t.join(",\b ")].concat(n.slice(e))}function bn(n){return new Promise(t=>{setTimeout(t,n)})}function gc(n,t,e="en-US"){const i=window.speechSynthesis;return new Promise((s,r)=>{const o=new SpeechSynthesisUtterance(n);o.lang=e,o.onend=()=>{s()},o.onerror=a=>{r(a)},t.push(o),i.speak(o)})}function ur(n,t,e=!0){const i=window.speechSynthesis,s=fc(Array.isArray(n)?n:[n]),r=[],o=[];let a=!0;return{series:(async()=>{try{for(;a&&s.length;){const l=await Promise.resolve(s.shift());if(a){if(typeof l=="string"&&l.includes("PAUSE-")){let c=Number(l.split("PAUSE-")[1])*1e3;isNaN(c)&&(c=0),await bn(c)}else if(typeof l=="string"&&l.length){let u=3;for(;a&&u>0;)try{await gc(l,o,t),u=0}catch(d){if(d instanceof SpeechSynthesisErrorEvent)if(d.error==="network")u--,console.warn("Speech synthesis network error. Retries left: ".concat(u)),await bn(500*(3-u));else if(d.error==="canceled"||d.error==="interrupted")u=0;else throw new Error("SpeechSynthesisErrorEvent: ".concat(d.error));else throw d}}else if(typeof l=="function"){const c=ur(l(),t,!1);r.push(c),await c.series}else if(Array.isArray(l)){const c=ur(l,t,!1);r.push(c),await c.series}}else break}}finally{a=!1}})(),get active(){return a},append:l=>{s.push(l)},cancel:()=>{a&&(e&&i.cancel(),r.forEach(l=>{l.cancel()}),a=!1)}}}let Di;function _c(n,t="en-US"){return Di&&Di.cancel(),Di=ur(n,t),Di}var pc=(n,t)=>{let e;const i=()=>clearTimeout(e);return ws()&&Te(i),Object.assign((...r)=>{e!==void 0&&i(),e=setTimeout(()=>n(...r),t)},{clear:i})};let dr,vi=[],Vt,fr=!1;const xc=3e5;function En(n,t){const e=pc(n,t);let i;const s=r=>{i=r,e(r)};return s.flush=()=>{e.clear(),n(i)},s.clear=e.clear,s}function di(n){return n.id||n.name}function mc(n=[]){if(!ft.onFocusChange||!ft.enabled)return;const t=n.every(r=>!r.loading),e=n.filter(r=>!vi.includes(r));if(dr(),!t&&ft.onFocusChange){ft.onFocusChange([]);return}vi=n.slice(0);const i=[],s=e.reduce((r,o)=>(o.announce?(r.push([di(o),"Announce",o.announce]),i.push(o.announce)):o.title?(r.push([di(o),"Title",o.title]),i.push(o.title)):r.push([di(o),"No Announce",""]),r),[]);if(e.reverse().reduce((r,o)=>(o.announceContext?(r.push([di(o),"Context",o.announceContext]),i.push(o.announceContext)):r.push([di(o),"No Context",""]),r),s),ft.debug&&console.table(s),i.length)return ft.speak(i.reduce((r,o)=>r.concat(o),[]))}function yc(n){if(!fr)return Vt=_c(n)}const ft={debug:!1,enabled:!0,cancel:function(){Vt&&Vt.cancel()},clearPrevFocus:function(n=0){vi=vi.slice(0,n),dr()},speak:function(n,{append:t=!1,notification:e=!1}={}){return ft.onFocusChange&&ft.enabled&&(ft.onFocusChange.flush(),t&&Vt&&Vt.active?Vt.append(n):(ft.cancel(),yc(n)),e&&(fr=!0,Vt==null||Vt.series.finally(()=>{fr=!1,ft.refresh()}).catch(console.error))),Vt},refresh:function(n=0){ft.clearPrevFocus(n),ft.onFocusChange&&ft.onFocusChange(At(()=>as()))},setupTimers:function({focusDebounce:n=400,focusChangeTimeout:t=xc}={}){ft.onFocusChange=En(mc,n),dr=En(()=>{vi=[]},t)}},vc=()=>(ft.setupTimers(),Rt(Xt(as,ft.onFocusChange,{defer:!0})),ft);function hs(n){return function(){var r,o;const t=this.children.length,e=this.wrap,i=this.selected;if(n==="right"||n==="down")do if(this.selected=(this.selected||0)%t+1,this.selected>=t){if(!e){this.selected=null;break}this.selected=0}while((r=this.children[this.selected])!=null&&r.skipFocus);else if(n==="left"||n==="up")do if(this.selected=(this.selected||0)%t-1,this.selected<0){if(!e){this.selected=null;break}this.selected=t-1}while((o=this.children[this.selected])!=null&&o.skipFocus);if(this.selected===null)return this.selected=i,!1;const s=this.children[this.selected];if(wn(s instanceof Ne),this.onSelectedChanged&&this.onSelectedChanged.call(this,this,s,this.selected,i),this.plinko&&i!==null){const a=this.children[i];wn(a instanceof Ne);const h=a.selected;s.selected=h}return vo(s),!0}}function ls(n){const t=hs("left"),e=hs("right"),i={display:"flex",justifyContent:"flexStart"};return(()=>{const s=ai("node");return os(s,"onLeft",t),os(s,"onRight",e),Ri(s,St({get selected(){return n.selected||0},get onFocus(){return n.onFocus||(r=>{if(!r||r.selected===null)return;let o=r.children[r.selected];for(;o!=null&&o.skipFocus;)r.selected++,o=r.children[r.selected];o instanceof Ne&&o.setFocus()})},get style(){return n.style||i}},n),!0),Rs(s,()=>n.children),s})()}function Le(n){const t=hs("up"),e=hs("down"),i={display:"flex",flexDirection:"column",justifyContent:"flexStart"};return(()=>{const s=ai("node");return os(s,"onUp",t),os(s,"onDown",e),Ri(s,St({get onFocus(){return n.onFocus||(r=>{if(!r||r.selected===null)return;let o=r.children[r.selected];for(;o!=null&&o.skipFocus;)r.selected++,o=r.children[r.selected];o instanceof Ne&&o.setFocus()})},get selected(){return n.selected||0},get style(){return n.style||i}},n),!0),Rs(s,()=>n.children),s})()}const[Ac,Do]=Y(""),[Sc,gr]=Y(!1);function Tc(){let n,t,e=0;const i=1,s={alpha:i,color:4294967295},r={duration:1e3,easing:"ease-in-out"};return Rt(Xt(Ac,o=>{if(o.startsWith("#")){n.color=o,n.src="",n.alpha=1,e=1,t.alpha=0;return}else n.color=4294967295;if(e===0){n.src=o,e=1;return}if(e===1){t.src=o,e=2,t.alpha=[i],n.alpha=[0];return}e===2&&(n.src=o,e=1,n.alpha=i,t.alpha=0)},{defer:!0})),C(D,{width:1920,height:1080,zIndex:-5,get children(){return[C(D,{ref(o){const a=n;typeof a=="function"?a(o):n=o},animate:!0,animationSettings:r,style:s}),C(D,{ref(o){const a=t;typeof a=="function"?a(o):t=o},animate:!0,animationSettings:r,style:s,alpha:0}),C(D,{get effects(){return{radialGradient:{colors:[O("#3b3b3b"),O("#272727"),O("#181818")],stops:[0,.3,.8],height:800,width:1920,pivot:[.8,0]}}}})]}})}const Cc={display:"flex",flexDirection:"row",justifyContent:"flexStart"},wc={display:"flex",flexDirection:"column",justifyContent:"flexStart"},bc={screenW:1920,screenH:1080,marginX:50,marginY:120,gutterX:24,gutterY:72,focusScale:1.1},Ec={primary:"#141414",focus:"#bdbdbd",container:"#4d4d4d",menuBg:"#2021242e"},Rc={display1:{fontFamily:"Ubuntu",fontSize:72,lineHeight:88,fontStyle:"600",verticalAlign:"middle",textBaseline:"bottom",maxLineSuffix:"..."},display2:{fontFamily:"Ubuntu",fontSize:56,lineHeight:72},headline1:{fontFamily:"Ubuntu",fontSize:36,fontStyle:"600",lineHeight:48,verticalAlign:"middle",textBaseline:"bottom",maxLineSuffix:"..."},headline2:{fontFamily:"Ubuntu",fontSize:32,lineHeight:44},headline3:{fontFamily:"Ubuntu",fontSize:28,lineHeight:40},body1:{fontFamily:"Ubuntu",fontSize:32,lineHeight:40},body2:{fontFamily:"Ubuntu",fontSize:28,lineHeight:34},button1:{fontFamily:"Ubuntu",fontSize:32,lineHeight:40,background:"#ffff"}},Q={flexRow:Cc,flexColumn:wc,layout:bc,color:Ec,typography:Rc};O("#000000"),Q.layout.screenH;const Ic={width:50,height:50,x:0};O("#ffffff"),O("#ff0000");const ki={Column:{...Q.flexColumn,width:320,height:600,y:220,gap:60,zIndex:101,colors:O(Q.color.primary),x:[20,{duration:250,easing:"ease-in-out"}],focus:{x:[Q.layout.marginX,{duration:250,easing:"ease-in-out"}]}},menuLineStyle:{width:50,height:0,x:0,y:58,color:O("#ff0000"),focus:{height:6},active:{}},MenuWrapper:{zIndex:1e3,focus:{width:400,alpha:[1],duration:250,easing:"ease-in-out"},angle:Rl(270),stops:[0,.4,.8],width:100,height:1080,color:O(Q.color.primary)},MenuText:{zIndex:1,fontSize:32,x:86,y:10,height:50,alpha:0,active:{alpha:1}}},Lc="./";function Pc(n){let t;const e=Ls();function i(){this.children.forEach(r=>r.states.add("active")),this.children.selected.setFocus()}function s(){this.selected=0,this.children.forEach(r=>r.states.remove("active"))}return C(D,{get style(){return ki.MenuWrapper},get children(){return[C(Le,St(n,{onFocus:i,onBlur:s,get style(){return ki.Column},animate:!0,get children(){return((n==null?void 0:n.mennuItems)||[]).map(r=>C(D,{get src(){return Lc+"".concat(r.icon)},style:Ic,forwardStates:!0,onEnter:()=>e("".concat(r.path)),get children(){return[C(D,{get style(){return ki.menuLineStyle}}),C(tt,{get style(){return ki.MenuText},get children(){return r.name}})]}}))}})),C(D,{ref(r){const o=t;typeof o=="function"?o(r):t=r}})]}})}const Dr={Page:{width:1920,height:1080},pageWrapper:{x:100},headlineText:{width:1200,height:240,x:360,y:455,contain:"both",fontSize:66,textAlign:"center"},headlineSubText:{width:1920,height:170,x:530,y:655,contain:"both",fontSize:48,textAlign:"center"},itemsContainer:{width:Q.layout.screenW,height:600,y:350,x:0,zIndex:2},FocusRing:{borderRadius:0,width:194,height:286,y:-5,x:-5,zIndex:-1},showHeadline:{x:70,y:20},headlineBlur:{width:1920,height:150,x:0,y:0,zIndex:14,alpha:.9,color:O("#000000")},RowTitle:{height:60,width:400,marginTop:20,fontSize:36,color:O("#f0f0f0"),zIndex:2},Row:{display:"flex",justifyContent:"spaceBetween",height:290,gap:10},Column:{display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:10,width:Q.layout.screenW-2*Q.layout.marginX,x:Q.layout.marginX+Q.layout.gutterX,y:100,zIndex:2},Rect:{width:250,height:100,y:10,x:300,color:O("#0000ff")},peopleBio:{...Q.typography.body1,contain:"both",width:1500,height:400}},cs={width:120,height:40,color:O("#000000"),borderRadius:8,border:{width:2,color:O("#3333ff")},scale:1,focus:{scale:1.1,border:{width:5,color:O("#333333")}}},Fc={color:O("#00A699"),height:8,y:2,x:-4,width:cs.width+8},Bc={fontSize:12,y:12,contain:"width",textAlign:"center",color:O("#F6F6F9"),height:cs.height,width:cs.width},Rn={container:cs,topBar:Fc,text:Bc},In={width:386,height:136,color:O("#715cab"),focus:{color:O("#5a39a2")},disabled:{color:O("#291d43")}};O("#000000");O("#FFFFFF"),In.height,In.width,O("#909090");const zc=[{name:"Home",path:"/",icon:"assets/icon-home.png"},{name:"Search",path:"/search",icon:"assets/icon-search.png"},{name:"TV",path:"/tv",icon:"assets/icon-tivi.png"},{name:"List column",path:"/videos",icon:"assets/icon-video.png"},{name:"List Slider",path:"/list",icon:"assets/icon-list.png"}],Mc=n=>{const t=vc();t.enabled=!1;const e=Ls(),i=Hl();Or();let s,r;const[o,a]=Y(i);return uc({Menu:"m",Escape:"Escape"}),fh(()=>{gr(!0)}),Rt(()=>{a(i.pathname)}),C(D,{ref(h){const l=window.APP;typeof l=="function"?l(h):window.APP=h},onLast:()=>history.back(),onMenu:()=>e("/"),style:{width:1920,height:1080},onLeft:()=>{if(s.states.has("focus")||Sc()==!1&&o()=="/search")return!1;r=ce(),s.setFocus()},onRight:()=>(gr(!1),s.states.has("focus")&&r.setFocus()),plinko:!0,get children(){return[C(Tc,{}),C(D,{get style(){return Dr.pageWrapper},get children(){return n.children}}),C(Pc,{ref(h){const l=s;typeof l=="function"?l(h):s=h},mennuItems:zc})]}})},Oc=new URL("AppCoreExtensions-ea2df8cb.js",import.meta.url).href,Dc=()=>{const n={width:900,height:500,y:350,x:20,gap:25,display:"flex",flexDirection:"column",justifyContent:"flexStart"},t={width:900,height:36,gap:6,display:"flex",flexDirection:"row",justifyContent:"flexStart"},e={fontSize:42},i={width:n.width,fontSize:26,contain:"width"},s={fontSize:26};return C(D,{autofocus:!0,style:n,get children(){return[C(tt,{style:e,children:"Title of the Page"}),C(tt,{style:i,children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer vel tempor tellus. Sed eu leo purus. Vestibulum sollicitudin eget tellus a varius. Phasellus est turpis, volutpat sed blandit sit amet, rutrum sit amet mauris. In dignissim elit orci, a sollicitudin ipsum faucibus et. Quisque vel quam rutrum, faucibus augue sed, scelerisque nunc."}),C(D,{style:t,get children(){return[C(tt,{style:s,children:"Subline Text"}),C(D,{width:28,height:28,src:"/assets/rt-popcorn.png"}),C(tt,{style:s,children:"More Text"})]}})]}})},Ln=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],kc={display:"flex",flexDirection:"column",gap:40,y:0,color:O("#000000"),height:Q.layout.screenH,alpha:1},Uc={display:"flex",flexDirection:"row",justifyContent:"flexStart",gap:16,x:40,zIndex:999,height:Q.layout.screenH},Nc={display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:16,width:540,x:40,zIndex:999},Pn={display:"flex",flexDirection:"row",justifyContent:"spaceBetween",gap:8,height:70,width:500},Hc={color:O("#000000"),alpha:.8,zIndex:998,x:0,y:0},Wc={display:"flex",borderRadius:6,border:{width:0,color:O("#ffffff")},justifyContent:"center",alignItems:"center",gap:6,width:70,height:70,color:O("#2e3743"),focus:{border:{width:4,color:O("#ffffff")},color:O("#000000")}},Qc={fontSize:40},Yc={color:O("#red"),width:500,x:40,height:70,alpha:1,backgroundColor:O("#ffffff"),borderRadius:8,border:{width:4,color:O("#ffffff")},display:"flex",alignItems:"center",justifyContent:"flexStart"},$c={width:500,display:"flex",flexDirection:"column",alignItems:"flexStart",justifyContent:"flexStart",gap:20,x:0},Fn={height:70,width:240,color:O("#2e3743"),display:"flex",alignItems:"center",justifyContent:"center",borderRadius:6,border:{width:0,color:O("#ffffff")},focus:{border:{width:4,color:O("#ffffff")},color:O("#000000")}},Bn={width:70,height:50},Xc={height:10,x:0,y:0},Gc={color:O("#09121a"),y:-160,fontSize:30,x:40,width:Q.layout.screenW-(580+116),height:Q.layout.screenH,zIndex:999,alignItems:"center",justifyContent:"center"},jc={display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:20,width:Q.layout.screenW-(2*Q.layout.marginX+532+(Q.layout.marginX+Q.layout.gutterX)*2),x:48,y:48,zIndex:2},Vc={display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:20},Kc={display:"flex",justifyContent:"center",alignItems:"center"},qs={Thumbnail:{borderRadius:0,width:187,height:294,scale:1,zIndex:2},FocusRing:{borderRadius:0,y:-2,x:-2,zIndex:-1,color:O("#ffffff")}};function qc(n){let t;Rt(Xt(ce,i=>{z(i),setTimeout(()=>{i.heroContent?(t.parent=i.parent,t.alpha=1,t.scale=1,t.x=i.x-1.5,t.y=i.y-1.5,t.width=i.width+1.5,t.height=i.height+1.5,t.createAnimation({scale:1.03}).start()):t.alpha=0},10)},{defer:!0}));function e(){var i;(i=this.children.selected)==null||i.setFocus()}return C(D,St(n,{animate:!0,get style(){return qs.Thumbnail},get children(){return[C(D,St({onFocus:e},n,{animate:!0,get style(){return qs.Thumbnail}})),C(D,{ref(i){const s=t;typeof s=="function"?s(i):t=i},get style(){return qs.FocusRing}})]}}))}function kr(n){const[t,e]=Th(n,["items"]);return C(ls,St(e,{get style(){return Dr.Row},get children(){return C(Me,{get each(){return t.items},children:i=>C(qc,i)})}}))}function Zc(n){return C(D,St(n,{forwardStates:!0,animate:!0,get style(){return Rn.container},get children(){return C(tt,{get style(){return Rn.text},get children(){return n.children}})}}))}function Ur(n){const[t,e]=Y([]),[i,s]=Y(1),[r,o]=Y(!1),[a]=Rr(i,n);return rr(()=>{const h=a();h&&dh(()=>{h.length===0&&o(!0),e(l=>[...l,...h])})}),{pages:t,page:i,setPage:s,setPages:e,end:r,setEnd:o}}const Jc="e9e9d8da18ae29fc430845952232787c",tu="596e02522af6fe40f284e6de58fd0865f2cbaae3",eu="https://api.themoviedb.org/3";let ko,Uo;const iu="w185",su={headers:{"Content-Type":"application/json",Authorization:"Bearer "+tu}};function Ki(n,t=iu){return Uo+t+n}function ru(n,t={}){return ko?_r(n,t):No().then(()=>_r(n,t))}function _r(n,t={}){return fetch(eu+n+(n.includes("?")?"&":"?")+"api_key="+Jc,{...su,...t}).then(e=>e.json())}function No(){return _r("/configuration").then(n=>{var t;return ko=n,Uo=(t=n.images)==null?void 0:t.secure_base_url,n})}const Nr={get:ru,loadConfig:No};function nu(n,t){return n.length>t?n.substring(0,t-3)+"...":n}function Ho(n,t=7){let e=[];for(let i=0,s=n.length;i<s;i+=t)e.push(n.slice(i,i+t));return e}function Wo(n=[]){return n.map(t=>({src:Ki(t.poster_path||t.profile_path),tileSrc:Ki(t.backdrop_path||t.profile_path,"w300"),backdrop:Ki(t.backdrop_path,"w1280"),href:"/entity/".concat(t.media_type||"people","/").concat(t.id),shortTitle:nu(t.title||t.name,30),title:t.title||t.name,data:t,entityInfo:{type:t.media_type||"people",id:t.id},heroContent:{title:t.title||t.name,description:t.overview}}))}let zn=new Map;const Ui=new Map;function ou(n,t){const e="";return async i=>{const s="/search/movie?include_adult=false&page=".concat(i,"&query==").concat(t);if(zn.has(s))return zn.get(s);const r=n;let o=await Nr.get(s).then(a=>{let h=a.results.filter(u=>!u.adult),l=(Ui.has(e)?Ui.get(e):[]).concat(Wo(h)),c=Ho(l,r);return c[c.length-1].length<r?Ui.set(e,c.pop()):Ui.delete(e),c});return console.log(o),o}}const Mn="./";function au(n){let t,e,i,s,r,o,a,h,l;const[c,u]=Y(""),[d,g]=Y(0);let _=lt(()=>Ur(ou(5,c())));Rt(Xt(c,S=>{g(0),_().setPage(1)}));const f=oi(()=>0);function y(){this.states.add("focus")}function T(){this.states.remove("focus")}const x=()=>()=>{u(S=>S+" ")},m=()=>()=>{u(S=>S.slice(0,-1))};function p(S){return()=>{u(A=>A+S)}}const w=()=>{let S=[];for(let E=0;E<Ln.length;E+=6){const F=Ln.slice(E,E+6);S.push(F)}return C(Me,{each:S,children:(E,F)=>C(ls,{style:Pn,autofocus:!1,plinko:!0,get children(){return C(Me,{each:E,children:(L,k)=>C(D,{style:Wc,get onEnter(){return p(L)},animate:!0,onBlur:T,onFocus:y,forwardStates:!0,autofocus:!1,get children(){return C(tt,{style:Qc,children:L})}})})}})})};function R(){var A;(A=this.children.selected)==null||A.setFocus(),g((this.y||0)*-1+24);let S=_().pages().length;this.parent&&(S===0||this.parent.selected&&this.parent.selected>=S-2)&&_().setPage(E=>E+1)}function I(){}return C(D,{ref(S){const A=t;typeof A=="function"?A(S):t=S},animate:!0,style:Hc,autofocus:!0,get children(){return C(D,{ref(S){const A=s;typeof A=="function"?A(S):s=S},animate:!0,style:kc,autofocus:!0,plinko:!0,get children(){return[C(D,{ref(S){const A=e;typeof A=="function"?A(S):e=S},style:Xc,skipFocus:!0}),C(D,{ref(S){const A=e;typeof A=="function"?A(S):e=S},style:Yc,animate:!0,skipFocus:!0,get children(){return C(tt,{get style(){return{color:O("#ffffff"),fontSize:30,marginLeft:20}},get children(){return c()}})}}),C(Le,{style:Uc,ref(S){const A=r;typeof A=="function"?A(S):r=S},autofocus:!0,onDown:()=>{if(a.states.has("focus"))return!1},plinko:!0,get children(){return[C(Le,{style:Nc,ref(S){const A=a;typeof A=="function"?A(S):a=S},onRight:()=>{o.setFocus(),h.setFocus()},onLeft:()=>{gr(!0)},get children(){return[C(ls,{style:Pn,autofocus:!1,get children(){return[C(D,{style:Fn,ref(S){const A=l;typeof A=="function"?A(S):l=S},get onEnter(){return x()},animate:!0,autofocus:!1,get children(){return C(D,{style:Bn,src:Mn+"assets/icon-space.png",forwardStates:!0,animate:!0})}}),C(D,{style:Fn,get onEnter(){return m()},animate:!0,autofocus:!1,get children(){return C(D,{style:Bn,src:Mn+"assets/icon-back-space.png",forwardStates:!0,animate:!0})}})]}}),C(Le,{plinko:!0,style:Vc,get children(){return w()}}),C(Le,{ref(S){const A=i;typeof A=="function"?A(S):i=S},animate:!0,style:$c,forwardStates:!0,get children(){return C(tt,{get style(){return{color:O("#504d4d"),fontSize:30,focus:{color:O("#ffffff")}}}})}})]}}),C(D,{style:Gc,ref(S){const A=o;typeof A=="function"?A(S):o=S},onLeft:()=>{a.setFocus()},get children(){return[C(le,{get when(){return _().pages().length==0},get children(){return C(D,{style:Kc,get children(){return C(tt,{style:{fontSize:40,display:"flex",justifyContent:"center",textAlign:"center"},children:"No Data"})}})}}),C(le,{get when(){return _().pages().length>0},get children(){return C(Le,{ref(S){const A=h;typeof A=="function"?A(S):h=S},animate:!0,get y(){return d()},style:jc,plinko:!0,get children(){return C(Me,{get each(){return _().pages()},children:(S,A)=>C(kr,{get autofocus(){return Ro(()=>!!f(A()))()&&o.states.has("focus")},items:S,onFocus:R,onEnter:I})})}})}})]}})]}})]}})}})}function hu(n){const t=oi(()=>0),[e,i]=Y(0),[s,r]=Y(0);let o;function a(){let m=this.children.selected;s()||(o=ce(),z(m&&m.id),Ja(m.url),i(.9),r(1),_.setFocus())}function h(){th(),i(0),r(0),o.setFocus()}const l=[{title:"Streaming Test",id:"vod",url:"https://live-par-2-cdn-alt.livepush.io/live/bigbuckbunnyclip/index.m3u8",description:"Streaming Implementation"},{title:"Bunny Video",id:"bunny",url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",description:"VoD Implementation"}];function c(m){const p={width:370,height:320,borderRadius:6,scale:1,color:405488895,focus:{scale:1.1,color:4294967295}},[w,R]=Y(4294967295);return C(D,St(m,{onFocus:()=>{R(255)},onBlur:()=>{R(4294967295)},animate:!0,style:p,get children(){return C(D,{x:30,get children(){return[C(tt,{y:30,fontSize:84,get color(){return w()},get children(){return m.index+1}}),C(tt,{y:140,fontSize:42,width:340,height:42,contain:"both",get color(){return w()},get children(){return m.title}}),C(tt,{y:200,fontSize:28,width:330,contain:"width",get color(){return w()},get children(){return m.description}})]}})}}))}const[u,d]=Y(140);function g(m){s()&&_.setFocus()}let _;Rt(Xt(ce,m=>{s()&&_.setFocus()},{defer:!0}));const f=()=>{s()&&sh()},y=()=>{s()&&rh()},T=()=>{s()&&nh()},x=()=>{s()&&oh()};return C(D,{onEscape:h,get children(){return[C(D,{x:120,get children(){return[C(tt,{fontSize:90,x:110,y:40,children:"Videos"}),C(D,{y:140,height:1,width:1800,color:3906468351})]}}),C(ls,{onSelectedChanged:g,onEnter:a,animationSettings:{delay:20,duration:300},animate:!0,get x(){return u()},y:300,width:4400,get style(){return Dr.Row},justifyContent:"flexStart",gap:40,get children(){return[C(Me,{each:l,children:(m,p)=>C(c,St({get skipFocus(){return s()},get autofocus(){return t(p())},get index(){return p()}},m))}),C(D,{y:240,height:1,width:1,color:3906468351,onLeft:f,onRight:y,onUp:T,onDown:x,ref(m){const p=_;typeof p=="function"?p(m):_=m},skipFocus:!0})]}}),C(D,{get alpha(){return e()},get color(){return O("#000000")},zIndex:200})]}})}const lu=()=>C(D,{style:{width:1920,height:1080,color:868483072},get children(){return C(tt,{children:"Not Found"})}});let Zs=new Map;const Ni=new Map;function Qo(n,t){return e=>{const i="/trending/".concat(n,"/week?page=").concat(e);if(Zs.has(i))return Zs.get(i);const s=t||7;let r=Nr.get(i).then(o=>{let a=o.results.filter(c=>!c.adult),h=(Ni.has(n)?Ni.get(n):[]).concat(Wo(a)),l=Ho(h,s);return l[l.length-1].length<s?Ni.set(n,l.pop()):Ni.delete(n),l});return Zs.set(i,r),r}}const Ps=1100,cu={...Q.typography.display2,width:Ps,height:58,contain:"both"},uu=n=>C(tt,St(n,{style:cu,get children(){return n.children}})),du={...Q.typography.body1,width:Ps,height:72,contain:"both"},fu={fontSize:20,lineHeight:20},gu=n=>C(tt,St(n,{style:du,get children(){return n.children}}));function _u(n){return[C(le,{get when(){return(n==null?void 0:n.rtCrit)&&(n==null?void 0:n.rtCrit)!=="0"},get children(){return[C(D,{src:"https://upload.wikimedia.org/wikipedia/commons/b/b6/Tomato-Torrent-Icon.png",title:"Rotten Tomatoes Rating",style:{width:30,height:30,marginRight:-6}}),C(tt,{style:pr,get children(){return n.rtCrit+"%"}})]}}),C(le,{get when(){return(n==null?void 0:n.rtFan)&&(n==null?void 0:n.rtFan)!=="0"},get children(){return[C(D,{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Rotten_Tomatoes_positive_audience.svg/80px-Rotten_Tomatoes_positive_audience.svg.png",title:"Rotten Tomatoes Rating",style:{width:24,height:30,marginRight:-6}}),C(tt,{style:pr,get children(){return n.rtFan+"%"}})]}})]}const pu=n=>(()=>{const t=ai("node");return Io(dc,t,()=>[8,15,13,15]),Ri(t,St(n,{style:{color:"0x00000099",borderRadius:8,border:{width:3,color:"0xffffffff"}}}),!0),Rs(t,C(tt,{style:fu,get children(){return n.children}})),t})(),pr=Q.typography.body2,xu=n=>C(D,{get style(){return{...Q.flexRow,gap:12,width:Ps,height:48}},get children(){return[C(tt,{style:pr,get children(){return n.metaText}}),C(Me,{get each(){return n.badges},children:t=>C(pu,{y:-5,children:t})}),Ro(()=>_u(n.reviews))]}}),Yo=n=>(console.log("badges",n.badges),C(D,St(n,{get style(){return{...Q.flexColumn,width:Ps,height:160,gap:16}},get children(){return[C(uu,{get children(){return n.title}}),C(gu,{get children(){return n.description}}),C(xu,{get metaText(){return n.metaText},get badges(){return n.badges},get reviews(){return n.reviews}})]}})));function mu(n){const t=Math.floor(n/60),e=n%60;return t+"h "+(e<10?"0":"")+e+"m"}function On(n){return n.split("-")[0]}function $o({type:n,id:t}){let e=n==="movie"?{rtCrit:86,rtFan:92}:{};return Nr.get("/".concat(n,"/").concat(t)).then(i=>({backgroundImage:Ki(i.backdrop_path,"original"),heroContent:{title:i.title||i.name,description:i.overview,badges:["HD"],metaText:n==="movie"?mu(i.runtime)+" - "+i.release_date:"".concat(On(i.first_air_date)," - ").concat(On(i.last_air_date)),reviews:e},...i}))}const Dn={Row:{display:"flex",justifyContent:"spaceBetween",height:300},Column:{display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:15,width:Q.layout.screenW-2*Q.layout.marginX,x:Q.layout.marginX+Q.layout.gutterX,y:100,zIndex:2},itemsContainer:{width:Q.layout.screenW,height:600,y:350,x:0,zIndex:2}};function yu(n){console.log(n.type);const t=oi(()=>0);return C(D,{clipping:!0,get style(){return Dn.itemsContainer},get children(){return C(Le,{plinko:!0,announce:"All Trending - Week",animate:!0,get y(){return n.y},get style(){return Dn.Column},get children(){return C(Me,{get each(){return(n==null?void 0:n.data)||[]},children:(e,i)=>C(kr,{get autofocus(){return t(i())},justifyContent:"flexStart",items:e,get onFocus(){return n.onFocus},get onEnter(){return n.onEnter}})})}})}})}const kn={NotifiWrapper:{borderRadius:3,width:250,height:50,scale:1,zIndex:9999,color:O("#ffffff"),alpha:.5,x:0,y:1030},NotifiText:{zIndex:1,fontSize:16,color:O("#ffffff"),height:30,y:15,x:15,break:!0,position:"none"},FocusRing:{borderRadius:0,y:-2,x:-2,zIndex:-1,color:O("#ffffff")}};function vu(n){return Rt(Xt(ce,t=>{z(t),setTimeout(()=>{console.log("elm",t)},10)},{defer:!0})),C(le,{get when(){return n.isOpen},get children(){return C(D,St(n,{animate:!0,get style(){return kn.NotifiWrapper},get children(){return C(tt,{get style(){return kn.NotifiText},get children(){return(n==null?void 0:n.message)||""}})}}))}})}const Au=()=>{const n=Or(),[t,e]=Y(0),[i,s]=Y();Rr(i,$o);const[r,o]=Y({}),a=Ls(),[h,l]=Y(!1);oi(()=>0);let c;const u=lt(()=>Ur(Qo(n.filter||"all",8)));Rt(Xt(ce,f=>{f.backdrop&&Do(f.backdrop),f.heroContent&&o(f.heroContent)},{defer:!0}));function d(){console.log("sgdsjgdisdishdoshdoish"),l(!0)}function g(){var y;(y=this.children.selected)==null||y.setFocus(),e((this.y||0)*-1+24);let f=u().pages().length;this.parent&&(f===0||this.parent.selected&&this.parent.selected>=f-2)&&u().setPage(T=>T+1)}function _(){let f=this.children.selected;z(f&&f.href),a(f.href)}return C(D,{get children(){return[C(le,{get when(){return u().pages().length},get children(){return[C(Yo,St({y:150,x:90},r)),C(yu,{type:"sliderList",onEnter:_,onFocus:g,get data(){return u().pages()},get y(){return t()}})]}}),C(Zc,{autofocus:!0,ref(f){const y=c;typeof y=="function"?y(f):c=f},onRight:()=>{if(c.states.has("focus"))return!1;ce(),c.setFocus()},x:100,onEnter:d,children:"Enter to show notification"}),C(vu,{get isOpen(){return h()},message:"You have an notification! "})]}})},Un={Row:{display:"flex",justifyContent:"spaceBetween",height:290},Column:{display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:10,width:Q.layout.screenW-2*Q.layout.marginX,x:Q.layout.marginX+Q.layout.gutterX,y:100,zIndex:2},itemsContainer:{width:Q.layout.screenW,height:600,y:350,x:0,zIndex:2}};class M{static mergeNumbers(t,e,i){return t*i+e*(1-i)}static rgb(t,e,i){return(t<<16)+(e<<8)+i+255*16777216}static rgba(t,e,i,s){return(t<<16)+(e<<8)+i+(s*255|0)*16777216}static getRgbString(t){let e=(t/65536|0)%256,i=(t/256|0)%256,s=t%256;return"rgb("+e+","+i+","+s+")"}static getRgbaString(t){let e=(t/65536|0)%256,i=(t/256|0)%256,s=t%256,r=(t/16777216|0)/255;return"rgba("+e+","+i+","+s+","+r.toFixed(4)+")"}static getRgbaStringFromArray(t){let e=Math.floor(t[0]*255),i=Math.floor(t[1]*255),s=Math.floor(t[2]*255),r=Math.floor(t[3]*255)/255;return"rgba("+e+","+i+","+s+","+r.toFixed(4)+")"}static getRgbaComponentsNormalized(t){let e=(t/65536|0)%256,i=(t/256|0)%256,s=t%256,r=t/16777216|0;return[e/255,i/255,s/255,r/255]}static getRgbComponentsNormalized(t){let e=(t/65536|0)%256,i=(t/256|0)%256,s=t%256;return[e/255,i/255,s/255]}static getRgbaComponents(t){let e=(t/65536|0)%256,i=(t/256|0)%256,s=t%256,r=t/16777216|0;return[e,i,s,r]}static getArgbNumber(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));let e=((t[3]|0)<<24)+((t[0]|0)<<16)+((t[1]|0)<<8)+(t[2]|0);return e<0&&(e=4294967295+e+1),e}static mergeColors(t,e,i){let s=(t/65536|0)%256,r=(t/256|0)%256,o=t%256,a=t/16777216|0,h=(e/65536|0)%256,l=(e/256|0)%256,c=e%256,u=e/16777216|0,d=s*i+h*(1-i),g=r*i+l*(1-i),_=o*i+c*(1-i),f=a*i+u*(1-i);return Math.round(f)*16777216+Math.round(d)*65536+Math.round(g)*256+Math.round(_)}static mergeMultiColors(t,e){let i=0,s=0,r=0,o=0,a=0,h=t.length;for(let l=0;l<h;l++){let c=(t[l]/65536|0)%256,u=(t[l]/256|0)%256,d=t[l]%256,g=t[l]/16777216|0;i+=c*e[l],s+=u*e[l],r+=d*e[l],o+=g*e[l],a+=e[l]}return a=1/a,Math.round(o*a)*16777216+Math.round(i*a)*65536+Math.round(s*a)*256+Math.round(r*a)}static mergeMultiColorsEqual(t){let e=0,i=0,s=0,r=0,o=0,a=t.length;for(let h=0;h<a;h++){let l=(t[h]/65536|0)%256,c=(t[h]/256|0)%256,u=t[h]%256,d=t[h]/16777216|0;e+=l,i+=c,s+=u,r+=d,o+=1}return o=1/o,Math.round(r*o)*16777216+Math.round(e*o)*65536+Math.round(i*o)*256+Math.round(s*o)}static mergeColorAlpha(t,e){let i=(t/16777216|0)*e|0;return((t>>16&255)*i/255&255)+((t&65280)*i/255&65280)+(((t&255)<<16)*i/255&16711680)+(i<<24)}static rad(t){return t*(Math.PI/180)}static getTimingBezier(t,e,i,s){let r=3*t,o=3*(i-t)-r,a=1-r-o,h=3*e,l=3*(s-e)-h,c=1-h-l;return function(u){if(u>=1)return 1;if(u<=0)return 0;let d=.5,g,_,f;for(let x=0;x<20;x++){if(g=d*(d*(d*a+o)+r),f=u-g,f>-1e-8&&f<1e-8)return d*(d*(d*c+l)+h);if(_=d*(d*(3*a)+2*o)+r,_>1e-10&&_<1e-10)break;d+=f/_}let y=0,T=1;for(let x=0;x<20;x++){if(d=.5*(y+T),g=d*(d*(d*a+o)+r),f=u-g,f>-1e-8&&f<1e-8)return d*(d*(d*c+l)+h);f<0?T=d:y=d}}}static getTimingFunction(t){switch(t){case"linear":return function(i){return i};case"ease":return M.getTimingBezier(.25,.1,.25,1);case"ease-in":return M.getTimingBezier(.42,0,1,1);case"ease-out":return M.getTimingBezier(0,0,.58,1);case"ease-in-out":return M.getTimingBezier(.42,0,.58,1);case"step-start":return function(){return 1};case"step-end":return function(i){return i===1?1:0};default:let e="cubic-bezier(";if(t&&t.indexOf(e)===0){let i=t.substr(e.length,t.length-e.length-1).split(",");if(i.length!==4)return console.warn("[Lightning] Unknown timing function: "+t),function(h){return h};let s=parseFloat(i[0]),r=parseFloat(i[1]),o=parseFloat(i[2]),a=parseFloat(i[3]);return isNaN(s)||isNaN(r)||isNaN(o)||isNaN(a)?(console.warn("[Lightning] Unknown timing function: "+t),function(h){return h}):M.getTimingBezier(s,r,o,a)}else return console.warn("[Lightning] Unknown timing function: "+t),function(i){return i}}}}let b=class Lt{static isFunction(t){return typeof t=="function"}static isNumber(t){return typeof t=="number"}static isInteger(t){return typeof t=="number"&&t%1===0}static isBoolean(t){return t===!0||t===!1}static isString(t){return typeof t=="string"}static clone(t){return Lt.isObjectLiteral(t)||Array.isArray(t)?Lt.getDeepClone(t):t}static cloneObjShallow(t){let e=Object.keys(t),i={};for(let s=0;s<e.length;s++)i[e[s]]=t[e[s]];return i}static merge(t,e){let i=Object.keys(e);for(let s=0;s<i.length;s++)t[i[s]]=e[i[s]];return t}static isObject(t){let e=typeof t;return!!t&&(e==="object"||e==="function")}static isPlainObject(t){return!!t&&typeof t==="object"}static isObjectLiteral(t){return typeof t=="object"&&t&&t.constructor===Object}static getArrayIndex(t,e){return Lt.getModuloIndex(t,e.length)}static getModuloIndex(t,e){if(e===0)return t;for(;t<0;)t+=Math.ceil(-t/e)*e;return t=t%e,t}static getDeepClone(t){let e,i;if(Lt.isFunction(t))return t;if(Array.isArray(t)){i=[];let s=Object.keys(t);for(e=0;e<s.length;e++)i[s[e]]=Lt.getDeepClone(t[s[e]]);return i}else if(Lt.isObject(t)){i={};let s=Object.keys(t);for(e=0;e<s.length;e++)i[s[e]]=Lt.getDeepClone(t[s[e]]);return i}else return t}static equalValues(t,e){return typeof t!=typeof e?!1:Lt.isObjectLiteral(t)?Lt.isObjectLiteral(e)&&Lt.equalObjectLiterals(t,e):Array.isArray(t)?Array.isArray(e)&&Lt.equalArrays(t,e):t===e}static equalObjectLiterals(t,e){let i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(let r=0,o=i.length;r<o;r++){const a=i[r],h=s[r];if(a!==h)return!1;const l=t[a],c=e[h];if(!Lt.equalValues(l,c))return!1}return!0}static equalArrays(t,e){if(t.length!==e.length)return!1;for(let i=0,s=t.length;i<s;i++)if(!this.equalValues(t[i],e[i]))return!1;return!0}static setToArray(t){let e=[];return t.forEach(function(i){e.push(i)}),e}static iteratorToArray(t){let e=[],i=t.next();for(;!i.done;)e.push(i.value),i=t.next();return e}static isUcChar(t){return t>=65&&t<=90}};b.isWeb=typeof window<"u"&&typeof sparkscene>"u";b.isWPE=b.isWeb&&navigator.userAgent.indexOf("WPE")!==-1;b.isSpark=typeof sparkscene<"u";b.isNode=typeof window>"u"||b.isSpark;b.isPS4=b.isWeb&&navigator.userAgent.indexOf("PlayStation 4")!==-1;b.isZiggo=b.isWeb&&(navigator.userAgent.indexOf("EOSSTB")!==-1||navigator.userAgent.indexOf("HZNSTB")!==-1);class xt{static defaultSetter(t,e,i){t[e]=i}static patchObject(t,e){if(!b.isObjectLiteral(e))console.error("[Lightning] Settings must be object literal");else{let i=Object.keys(e);for(let s=0,r=i.length;s<r;s++){let o=i[s];this.patchObjectProperty(t,o,e[o])}}}static patchObjectProperty(t,e,i){let s=t.setSetting||xt.defaultSetter;e.charAt(0)==="_"?e!=="__create"&&console.error("[Lightning] Patch of private property '"+e+"' is not allowed"):e!=="type"&&(b.isFunction(i)&&i.__local&&(i=i.__local(t)),s(t,e,i))}static local(t){t.__local=!0}}class Xo{static getSpacing(t,e,i){const s=e-1;let r,o,a;switch(t){case"flex-start":o=0,a=0;break;case"flex-end":o=i,a=0;break;case"center":o=i/2,a=0;break;case"space-between":o=0,a=Math.max(0,i)/s;break;case"space-around":if(i<0)return this.getSpacing("center",e,i);r=i/(s+1),o=.5*r,a=r;break;case"space-evenly":if(i<0)return this.getSpacing("center",e,i);r=i/(s+2),o=r,a=r;break;case"stretch":o=0,a=0;break;default:throw new Error("Unknown mode: "+t)}return{spacingBefore:o,spacingBetween:a}}}class Su{constructor(t){this._layout=t,this._totalCrossAxisSize=0}get _lines(){return this._layout._lines}init(){this._totalCrossAxisSize=this._getTotalCrossAxisSize()}align(){const e=this._layout.crossAxisSize-this._totalCrossAxisSize,{spacingBefore:i,spacingBetween:s}=this._getSpacing(e),r=this._lines,o=this._layout._flexContainer.alignContent;let a=0;o==="stretch"&&r.length&&e>0&&(a=e/r.length);let h=i;for(let l=0,c=r.length;l<c;l++){const u=h,d=r[l].createItemAligner();let g=r[l].crossAxisLayoutSize+a;d.setCrossAxisLayoutSize(g),d.setCrossAxisLayoutOffset(u),d.align(),d.recursiveResizeOccured&&r[l].setItemPositions(),h+=g,h+=s}}get totalCrossAxisSize(){return this._totalCrossAxisSize}_getTotalCrossAxisSize(){const t=this._lines;let e=0;for(let i=0,s=t.length;i<s;i++){const r=t[i];e+=r.crossAxisLayoutSize}return e}_getSpacing(t){const e=this._layout._flexContainer.alignContent,i=this._lines.length;return Xo.getSpacing(e,i,t)}}class N{static getParentAxisSizeWithPadding(t,e){const s=t.target.getParent();if(s){const r=t.flexParent;return r?this.getAxisLayoutSize(r,e)+this.getTotalPadding(r,e):e?s.w:s.h}else return 0}static getRelAxisSize(t,e){return e?t.funcW?this._allowRelAxisSizeFunction(t,!0)?t.funcW(this.getParentAxisSizeWithPadding(t,!0)):0:t.originalWidth:t.funcH?this._allowRelAxisSizeFunction(t,!1)?t.funcH(this.getParentAxisSizeWithPadding(t,!1)):0:t.originalHeight}static _allowRelAxisSizeFunction(t,e){const i=t.flexParent;return!(i&&i._flex._layout.isAxisFitToContents(e))}static isZeroAxisSize(t,e){return e?!t.originalWidth&&!t.funcW:!t.originalHeight&&!t.funcH}static getAxisLayoutPos(t,e){return e?t.x:t.y}static getAxisLayoutSize(t,e){return e?t.w:t.h}static setAxisLayoutPos(t,e,i){e?t.x=i:t.y=i}static setAxisLayoutSize(t,e,i){e?t.w=i:t.h=i}static getAxisMinSize(t,e){let i=this.getPlainAxisMinSize(t,e),s=0;return t.isFlexItemEnabled()&&(s=t._flexItem._getMinSizeSetting(e)),s>0&&(i=Math.max(i,s)),i}static getPlainAxisMinSize(t,e){return t.isFlexEnabled()?t._flex._layout.getAxisMinSize(e):t.flexItem.shrink!==0?0:this.getRelAxisSize(t,e)}static resizeAxis(t,e,i){t.isFlexEnabled()?t._flex._horizontal===e?t._flex._layout.resizeMainAxis(i):t._flex._layout.resizeCrossAxis(i):this.setAxisLayoutSize(t,e,i)}static getPaddingOffset(t,e){if(t.isFlexEnabled()){const i=t._flex;return e?i.paddingLeft:i.paddingTop}else return 0}static getTotalPadding(t,e){if(t.isFlexEnabled()){const i=t._flex;return e?i.paddingRight+i.paddingLeft:i.paddingTop+i.paddingBottom}else return 0}static getMarginOffset(t,e){const i=t.flexItem;return i?e?i.marginLeft:i.marginTop:0}static getTotalMargin(t,e){const i=t.flexItem;return i?e?i.marginRight+i.marginLeft:i.marginTop+i.marginBottom:0}}class Tu{constructor(t){this._line=t,this._amountRemaining=0,this._shrunkSize=0}shrink(t){this._shrunkSize=0,this._amountRemaining=t;let e=this._getTotalShrinkAmount();if(e){const i=this._line.items;do{let s=this._amountRemaining/e;for(let r=this._line.startIndex;r<=this._line.endIndex;r++){const a=i[r].flexItem,h=a.shrink;if(h>0){let c=h*s;const u=a._getMainAxisMinSize(),d=a._getMainAxisLayoutSize();if(d>u){const g=d-u;c>=g&&(c=g,e-=h);const f=d-c;if(a._resizeMainAxis(f),this._shrunkSize+=c,this._amountRemaining-=c,Math.abs(this._amountRemaining)<1e-5)return}}}}while(e&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalShrinkAmount(){let t=0;const e=this._line.items;for(let i=this._line.startIndex;i<=this._line.endIndex;i++){const r=e[i].flexItem;if(r.shrink){const o=r._getMainAxisMinSize();r._getMainAxisLayoutSize()>o&&(t+=r.shrink)}}return t}getShrunkSize(){return this._shrunkSize}}class Cu{constructor(t){this._line=t,this._amountRemaining=0,this._grownSize=0}grow(t){this._grownSize=0,this._amountRemaining=t;let e=this._getTotalGrowAmount();if(e){const i=this._line.items;do{let s=this._amountRemaining/e;for(let r=this._line.startIndex;r<=this._line.endIndex;r++){const a=i[r].flexItem,h=a.grow;if(h>0){let c=h*s;const u=a._getMainAxisMaxSizeSetting(),d=a._getMainAxisLayoutSize();if(u>0)if(d>=u)c=0;else{const g=u-d;c>=g&&(c=g,e-=h)}if(c>0){const g=d+c;if(a._resizeMainAxis(g),this._grownSize+=c,this._amountRemaining-=c,Math.abs(this._amountRemaining)<1e-5)return}}}}while(e&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalGrowAmount(){let t=0;const e=this._line.items;for(let i=this._line.startIndex;i<=this._line.endIndex;i++){const r=e[i].flexItem;if(r.grow){const o=r._getMainAxisMaxSizeSetting(),a=r._getMainAxisLayoutSize();(o===0||a<o)&&(t+=r.grow)}}return t}getGrownSize(){return this._grownSize}}class wu{constructor(t){this._line=t}get _layout(){return this._line._layout}position(){const{spacingBefore:t,spacingBetween:e}=this._getSpacing();let i=t;const s=this._line.items;for(let r=this._line.startIndex;r<=this._line.endIndex;r++){const o=s[r];o.flexItem._setMainAxisLayoutPos(i),i+=o.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i+=e}}_getSpacing(){const t=this._line._availableSpace;let e=this._layout._flexContainer.justifyContent;const i=this._line.numberOfItems;return Xo.getSpacing(e,i,t)}}class bu{constructor(t){this._line=t,this._crossAxisLayoutSize=0,this._crossAxisLayoutOffset=0,this._alignItemsSetting=null,this._recursiveResizeOccured=!1,this._isCrossAxisFitToContents=!1}get _layout(){return this._line._layout}get _flexContainer(){return this._layout._flexContainer}setCrossAxisLayoutSize(t){this._crossAxisLayoutSize=t}setCrossAxisLayoutOffset(t){this._crossAxisLayoutOffset=t}align(){this._alignItemsSetting=this._flexContainer.alignItems,this._isCrossAxisFitToContents=this._layout.isAxisFitToContents(!this._flexContainer._horizontal),this._recursiveResizeOccured=!1;const t=this._line.items;for(let e=this._line.startIndex;e<=this._line.endIndex;e++){const i=t[e];this._alignItem(i)}}get recursiveResizeOccured(){return this._recursiveResizeOccured}_alignItem(t){const e=t.flexItem;let i=e.alignSelf||this._alignItemsSetting;switch(i==="stretch"&&this._preventStretch(e)&&(i="flex-start"),i!=="stretch"&&!this._isCrossAxisFitToContents&&e._hasRelCrossAxisSize()&&e._resetCrossAxisLayoutSize(),i){case"flex-start":this._alignItemFlexStart(e);break;case"flex-end":this._alignItemFlexEnd(e);break;case"center":this._alignItemFlexCenter(e);break;case"stretch":this._alignItemStretch(e);break}}_alignItemFlexStart(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset)}_alignItemFlexEnd(t){const e=t._getCrossAxisLayoutSizeWithPaddingAndMargin();t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+(this._crossAxisLayoutSize-e))}_alignItemFlexCenter(t){const e=t._getCrossAxisLayoutSizeWithPaddingAndMargin(),i=(this._crossAxisLayoutSize-e)/2;t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+i)}_alignItemStretch(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);const e=t._getMainAxisLayoutSize();let i=this._crossAxisLayoutSize-t._getCrossAxisMargin()-t._getCrossAxisPadding();const s=t._getCrossAxisMinSizeSetting();s>0&&(i=Math.max(i,s));const r=t._getCrossAxisMaxSizeSetting();r>0&&(i=Math.min(i,r)),t._resizeCrossAxis(i),t._getMainAxisLayoutSize()!==e&&(this._recursiveResizeOccured=!0)}_preventStretch(t){const e=t._hasFixedCrossAxisSize(),i=t.alignSelf==="stretch";return e&&!i}}class Eu{constructor(t,e,i,s){this._layout=t,this.items=t.items,this.startIndex=e,this.endIndex=i,this._availableSpace=s}performLayout(){this._setItemSizes(),this.setItemPositions(),this._calcLayoutInfo()}_setItemSizes(){this._availableSpace>0?this._growItemSizes(this._availableSpace):this._availableSpace<0&&this._shrinkItemSizes(-this._availableSpace)}_growItemSizes(t){const e=new Cu(this);e.grow(t),this._availableSpace-=e.getGrownSize()}_shrinkItemSizes(t){const e=new Tu(this);e.shrink(t),this._availableSpace+=e.getShrunkSize()}setItemPositions(){new wu(this).position()}createItemAligner(){return new bu(this)}_calcLayoutInfo(){this._calcCrossAxisMaxLayoutSize()}getMainAxisMinSize(){let t=0;for(let e=this.startIndex;e<=this.endIndex;e++){const i=this.items[e];t+=i.flexItem._getMainAxisMinSizeWithPaddingAndMargin()}return t}get numberOfItems(){return this.endIndex-this.startIndex+1}get crossAxisLayoutSize(){const t=this._layout.isCrossAxisFitToContents()&&!this._layout.resizingCrossAxis;return this._layout.isWrapping()||t?this._crossAxisMaxLayoutSize:this._layout.crossAxisSize}_calcCrossAxisMaxLayoutSize(){this._crossAxisMaxLayoutSize=this._getCrossAxisMaxLayoutSize()}_getCrossAxisMaxLayoutSize(){let t=0;for(let e=this.startIndex;e<=this.endIndex;e++){const i=this.items[e];t=Math.max(t,i.flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin())}return t}}class Ru{constructor(t){this._layout=t,this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}get lines(){return this._lines}get mainAxisMinSize(){return this._mainAxisMinSize===-1&&(this._mainAxisMinSize=this._getMainAxisMinSize()),this._mainAxisMinSize}get crossAxisMinSize(){return this._crossAxisMinSize===-1&&(this._crossAxisMinSize=this._getCrossAxisMinSize()),this._crossAxisMinSize}get mainAxisContentSize(){return this._mainAxisContentSize}layoutLines(){this._setup();const t=this._layout.items,e=this._layout.isWrapping();let i=0,s;const r=t.length;for(s=0;s<r;s++){const o=t[s];this._layoutFlexItem(o);const a=o.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();e&&s>i&&this._curMainAxisPos+a>this._mainAxisSize&&(this._layoutLine(i,s-1),this._curMainAxisPos=0,i=s),this._addToMainAxisPos(a)}i<s&&this._layoutLine(i,s-1)}_layoutFlexItem(t){t.isFlexEnabled()?t.flexLayout.updateTreeLayout():t.flexItem._resetLayoutSize()}_setup(){this._mainAxisSize=this._layout.mainAxisSize,this._curMainAxisPos=0,this._maxMainAxisPos=0,this._lines=[],this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}_addToMainAxisPos(t){this._curMainAxisPos+=t,this._curMainAxisPos>this._maxMainAxisPos&&(this._maxMainAxisPos=this._curMainAxisPos)}_layoutLine(t,e){const i=this._getAvailableMainAxisLayoutSpace(),s=new Eu(this._layout,t,e,i);s.performLayout(),this._lines.push(s),(this._mainAxisContentSize===0||this._curMainAxisPos>this._mainAxisContentSize)&&(this._mainAxisContentSize=this._curMainAxisPos)}_getAvailableMainAxisLayoutSpace(){return!this._layout.resizingMainAxis&&this._layout.isMainAxisFitToContents()?0:this._mainAxisSize-this._curMainAxisPos}_getCrossAxisMinSize(){let t=0;const e=this._layout.items;for(let i=0,s=e.length;i<s;i++){const o=e[i].flexItem._getCrossAxisMinSizeWithPaddingAndMargin();t=Math.max(t,o)}return t}_getMainAxisMinSize(){return this._lines.length===1?this._lines[0].getMainAxisMinSize():this._layout.mainAxisSize}}class us{constructor(t){this._layout=t,this._isReverse=this._flexContainer._reverse,this._horizontalPaddingOffset=this._layout._getHorizontalPaddingOffset(),this._verticalPaddingOffset=this._layout._getVerticalPaddingOffset()}get _flexContainer(){return this._layout._flexContainer}finalize(){const t=this._layout.getParentFlexContainer();t?new us(t._layout)._finalizeItemAndChildren(this._flexContainer.item):(this._finalizeRoot(),this._finalizeItems())}_finalizeRoot(){const t=this._flexContainer.item;let e=N.getAxisLayoutPos(t,!0),i=N.getAxisLayoutPos(t,!1),s=N.getAxisLayoutSize(t,!0),r=N.getAxisLayoutSize(t,!1);s+=this._layout._getHorizontalPadding(),r+=this._layout._getVerticalPadding(),t.clearRecalcFlag(),t.setLayout(e,i,s,r)}_finalizeItems(){const t=this._layout.items;for(let e=0,i=t.length;e<i;e++){const s=t[e],r=this._validateItemCache(s);this._finalizeItem(s),r||this._finalizeItemChildren(s)}}_validateItemCache(t){if(t.recalc===0&&t.isFlexEnabled()){const e=t._flex._layout;if(t.w===t.target.w&&t.h===t.target.h)return!0;{const s=e.crossAxisSize;e.performResizeMainAxis(e.mainAxisSize),e.performResizeCrossAxis(s)}}return!1}_finalizeItemAndChildren(t){this._finalizeItem(t),this._finalizeItemChildren(t)}_finalizeItem(t){this._isReverse&&this._reverseMainAxisLayoutPos(t);let e=N.getAxisLayoutPos(t,!0),i=N.getAxisLayoutPos(t,!1),s=N.getAxisLayoutSize(t,!0),r=N.getAxisLayoutSize(t,!1);e+=this._horizontalPaddingOffset,i+=this._verticalPaddingOffset,t.flex&&(s+=t._flex._layout._getHorizontalPadding(),r+=t._flex._layout._getVerticalPadding());const a=t.flexItem;a&&(e+=a._getHorizontalMarginOffset(),i+=a._getVerticalMarginOffset()),t.clearRecalcFlag(),t.setLayout(e,i,s,r)}_finalizeItemChildren(t){const e=t._flex;e&&new us(e._layout)._finalizeItems()}_reverseMainAxisLayoutPos(t){const e=t.flexItem._getMainAxisLayoutPos()+t.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i=this._layout.mainAxisSize-e;t.flexItem._setMainAxisLayoutPos(i)}}class Iu{constructor(t){this._flexContainer=t,this._lineLayouter=new Ru(this),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._cachedMainAxisSizeAfterLayout=0,this._cachedCrossAxisSizeAfterLayout=0,this._shrunk=!1}get shrunk(){return this._shrunk}get recalc(){return this.item.recalc}layoutTree(){this.item.flexParent!==null?this._updateSubTreeLayout():this.updateTreeLayout(),this.updateItemCoords()}updateTreeLayout(){this.recalc?this._performUpdateLayoutTree():this._performUpdateLayoutTreeFromCache()}_performUpdateLayoutTree(){this._setInitialAxisSizes(),this._layoutAxes(),this._refreshLayoutCache()}_refreshLayoutCache(){this._cachedMainAxisSizeAfterLayout=this.mainAxisSize,this._cachedCrossAxisSizeAfterLayout=this.crossAxisSize}_performUpdateLayoutTreeFromCache(){this.item.funcW||this.item.funcH?(this.item.enableLocalRecalcFlag(),this._performUpdateLayoutTree()):(this.mainAxisSize=this._cachedMainAxisSizeAfterLayout,this.crossAxisSize=this._cachedCrossAxisSizeAfterLayout)}updateItemCoords(){new us(this).finalize()}_updateSubTreeLayout(){const t=this.crossAxisSize;this._layoutMainAxis(),this.performResizeCrossAxis(t)}_setInitialAxisSizes(){this.item.isFlexItemEnabled()?this.item.flexItem._resetLayoutSize():(this.mainAxisSize=this._getMainAxisBasis(),this.crossAxisSize=this._getCrossAxisBasis()),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._shrunk=!1}_layoutAxes(){this._layoutMainAxis(),this._layoutCrossAxis()}_layoutMainAxis(){this._layoutLines(),this._fitMainAxisSizeToContents()}_layoutLines(){this._lineLayouter.layoutLines()}get _lines(){return this._lineLayouter.lines}_fitMainAxisSizeToContents(){this._resizingMainAxis||this.isMainAxisFitToContents()&&(this.mainAxisSize=this._lineLayouter.mainAxisContentSize)}_layoutCrossAxis(){const t=new Su(this);t.init(),this._totalCrossAxisSize=t.totalCrossAxisSize,this._fitCrossAxisSizeToContents(),t.align()}_fitCrossAxisSizeToContents(){this._resizingCrossAxis||this.isCrossAxisFitToContents()&&(this.crossAxisSize=this._totalCrossAxisSize)}isWrapping(){return this._flexContainer.wrap}isAxisFitToContents(t){return this._horizontal===t?this.isMainAxisFitToContents():this.isCrossAxisFitToContents()}isMainAxisFitToContents(){return!this.isWrapping()&&!this._hasFixedMainAxisBasis()}isCrossAxisFitToContents(){return!this._hasFixedCrossAxisBasis()}_hasFixedMainAxisBasis(){return!N.isZeroAxisSize(this.item,this._horizontal)}_hasFixedCrossAxisBasis(){return!N.isZeroAxisSize(this.item,!this._horizontal)}getAxisMinSize(t){return this._horizontal===t?this._getMainAxisMinSize():this._getCrossAxisMinSize()}_getMainAxisMinSize(){return this._lineLayouter.mainAxisMinSize}_getCrossAxisMinSize(){return this._lineLayouter.crossAxisMinSize}resizeMainAxis(t){this.mainAxisSize!==t&&(this.recalc>0?this.performResizeMainAxis(t):this._checkValidCacheMainAxisResize()?(this.mainAxisSize=t,this._fitCrossAxisSizeToContents()):(this.item.enableLocalRecalcFlag(),this.performResizeMainAxis(t)))}_checkValidCacheMainAxisResize(t){return t===this.targetMainAxisSize||!this.isCrossAxisFitToContents()}performResizeMainAxis(t){const e=t<this.mainAxisSize;this._shrunk=e,this.mainAxisSize=t,this._resizingMainAxis=!0,this._layoutAxes(),this._resizingMainAxis=!1}resizeCrossAxis(t){this.crossAxisSize!==t&&(this.recalc>0?this.performResizeCrossAxis(t):this.crossAxisSize=t)}performResizeCrossAxis(t){this.crossAxisSize=t,this._resizingCrossAxis=!0,this._layoutCrossAxis(),this._resizingCrossAxis=!1}get targetMainAxisSize(){return this._horizontal?this.item.target.w:this.item.target.h}get targetCrossAxisSize(){return this._horizontal?this.item.target.h:this.item.target.w}getParentFlexContainer(){return this.item.isFlexItemEnabled()?this.item.flexItem.ctr:null}_getHorizontalPadding(){return N.getTotalPadding(this.item,!0)}_getVerticalPadding(){return N.getTotalPadding(this.item,!1)}_getHorizontalPaddingOffset(){return N.getPaddingOffset(this.item,!0)}_getVerticalPaddingOffset(){return N.getPaddingOffset(this.item,!1)}_getMainAxisBasis(){return N.getRelAxisSize(this.item,this._horizontal)}_getCrossAxisBasis(){return N.getRelAxisSize(this.item,!this._horizontal)}get _horizontal(){return this._flexContainer._horizontal}get _reverse(){return this._flexContainer._reverse}get item(){return this._flexContainer.item}get items(){return this.item.items}get resizingMainAxis(){return this._resizingMainAxis}get resizingCrossAxis(){return this._resizingCrossAxis}get numberOfItems(){return this.items.length}get mainAxisSize(){return N.getAxisLayoutSize(this.item,this._horizontal)}get crossAxisSize(){return N.getAxisLayoutSize(this.item,!this._horizontal)}set mainAxisSize(t){N.setAxisLayoutSize(this.item,this._horizontal,t)}set crossAxisSize(t){N.setAxisLayoutSize(this.item,!this._horizontal,t)}}class Pt{constructor(t){this._item=t,this._layout=new Iu(this),this._horizontal=!0,this._reverse=!1,this._wrap=!1,this._alignItems="stretch",this._justifyContent="flex-start",this._alignContent="flex-start",this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0}get item(){return this._item}_changedDimensions(){this._item.changedDimensions()}_changedContents(){this._item.changedContents()}get direction(){return(this._horizontal?"row":"column")+(this._reverse?"-reverse":"")}set direction(t){this.direction!==t&&(this._horizontal=t==="row"||t==="row-reverse",this._reverse=t==="row-reverse"||t==="column-reverse",this._changedContents())}set wrap(t){this._wrap=t,this._changedContents()}get wrap(){return this._wrap}get alignItems(){return this._alignItems}set alignItems(t){if(this._alignItems!==t){if(Pt.ALIGN_ITEMS.indexOf(t)===-1)throw new Error("Unknown alignItems, options: "+Pt.ALIGN_ITEMS.join(","));this._alignItems=t,this._changedContents()}}get alignContent(){return this._alignContent}set alignContent(t){if(this._alignContent!==t){if(Pt.ALIGN_CONTENT.indexOf(t)===-1)throw new Error("Unknown alignContent, options: "+Pt.ALIGN_CONTENT.join(","));this._alignContent=t,this._changedContents()}}get justifyContent(){return this._justifyContent}set justifyContent(t){if(this._justifyContent!==t){if(Pt.JUSTIFY_CONTENT.indexOf(t)===-1)throw new Error("Unknown justifyContent, options: "+Pt.JUSTIFY_CONTENT.join(","));this._justifyContent=t,this._changedContents()}}set padding(t){this.paddingLeft=t,this.paddingTop=t,this.paddingRight=t,this.paddingBottom=t}get padding(){return this.paddingLeft}set paddingLeft(t){this._paddingLeft=t,this._changedDimensions()}get paddingLeft(){return this._paddingLeft}set paddingTop(t){this._paddingTop=t,this._changedDimensions()}get paddingTop(){return this._paddingTop}set paddingRight(t){this._paddingRight=t,this._changedDimensions()}get paddingRight(){return this._paddingRight}set paddingBottom(t){this._paddingBottom=t,this._changedDimensions()}get paddingBottom(){return this._paddingBottom}patch(t){xt.patchObject(this,t)}}Pt.ALIGN_ITEMS=["flex-start","flex-end","center","stretch"];Pt.ALIGN_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly","stretch"];Pt.JUSTIFY_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly"];class Ci{constructor(t){this._ctr=null,this._item=t,this._grow=0,this._shrink=Ci.SHRINK_AUTO,this._alignSelf=void 0,this._minWidth=0,this._minHeight=0,this._maxWidth=0,this._maxHeight=0,this._marginLeft=0,this._marginTop=0,this._marginRight=0,this._marginBottom=0}get item(){return this._item}get grow(){return this._grow}set grow(t){this._grow!==t&&(this._grow=parseInt(t)||0,this._changed())}get shrink(){return this._shrink===Ci.SHRINK_AUTO?this._getDefaultShrink():this._shrink}_getDefaultShrink(){return this.item.isFlexEnabled()?1:0}set shrink(t){this._shrink!==t&&(this._shrink=parseInt(t)||0,this._changed())}get alignSelf(){return this._alignSelf}set alignSelf(t){if(this._alignSelf!==t){if(t===void 0)this._alignSelf=void 0;else{if(Pt.ALIGN_ITEMS.indexOf(t)===-1)throw new Error("Unknown alignSelf, options: "+Pt.ALIGN_ITEMS.join(","));this._alignSelf=t}this._changed()}}get minWidth(){return this._minWidth}set minWidth(t){this._minWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}get minHeight(){return this._minHeight}set minHeight(t){this._minHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}get maxHeight(){return this._maxHeight}set maxHeight(t){this._maxHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}set margin(t){this.marginLeft=t,this.marginTop=t,this.marginRight=t,this.marginBottom=t}get margin(){return this.marginLeft}set marginLeft(t){this._marginLeft=t,this._changed()}get marginLeft(){return this._marginLeft}set marginTop(t){this._marginTop=t,this._changed()}get marginTop(){return this._marginTop}set marginRight(t){this._marginRight=t,this._changed()}get marginRight(){return this._marginRight}set marginBottom(t){this._marginBottom=t,this._changed()}get marginBottom(){return this._marginBottom}_changed(){this.ctr&&this.ctr._changedContents()}set ctr(t){this._ctr=t}get ctr(){return this._ctr}patch(t){xt.patchObject(this,t)}_resetLayoutSize(){this._resetHorizontalAxisLayoutSize(),this._resetVerticalAxisLayoutSize()}_resetCrossAxisLayoutSize(){this.ctr._horizontal?this._resetVerticalAxisLayoutSize():this._resetHorizontalAxisLayoutSize()}_resetHorizontalAxisLayoutSize(){let t=N.getRelAxisSize(this.item,!0);this._minWidth&&(t=Math.max(this._minWidth,t)),this._maxWidth&&(t=Math.min(this._maxWidth,t)),N.setAxisLayoutSize(this.item,!0,t)}_resetVerticalAxisLayoutSize(){let t=N.getRelAxisSize(this.item,!1);this._minHeight&&(t=Math.max(this._minHeight,t)),this._maxHeight&&(t=Math.min(this._maxHeight,t)),N.setAxisLayoutSize(this.item,!1,t)}_getCrossAxisMinSizeSetting(){return this._getMinSizeSetting(!this.ctr._horizontal)}_getCrossAxisMaxSizeSetting(){return this._getMaxSizeSetting(!this.ctr._horizontal)}_getMainAxisMaxSizeSetting(){return this._getMaxSizeSetting(this.ctr._horizontal)}_getMinSizeSetting(t){return t?this._minWidth:this._minHeight}_getMaxSizeSetting(t){return t?this._maxWidth:this._maxHeight}_getMainAxisMinSize(){return N.getAxisMinSize(this.item,this.ctr._horizontal)}_getCrossAxisMinSize(){return N.getAxisMinSize(this.item,!this.ctr._horizontal)}_getMainAxisLayoutSize(){return N.getAxisLayoutSize(this.item,this.ctr._horizontal)}_getMainAxisLayoutPos(){return N.getAxisLayoutPos(this.item,this.ctr._horizontal)}_setMainAxisLayoutPos(t){return N.setAxisLayoutPos(this.item,this.ctr._horizontal,t)}_setCrossAxisLayoutPos(t){return N.setAxisLayoutPos(this.item,!this.ctr._horizontal,t)}_getCrossAxisLayoutSize(){return N.getAxisLayoutSize(this.item,!this.ctr._horizontal)}_resizeCrossAxis(t){return N.resizeAxis(this.item,!this.ctr._horizontal,t)}_resizeMainAxis(t){return N.resizeAxis(this.item,this.ctr._horizontal,t)}_getMainAxisPadding(){return N.getTotalPadding(this.item,this.ctr._horizontal)}_getCrossAxisPadding(){return N.getTotalPadding(this.item,!this.ctr._horizontal)}_getMainAxisMargin(){return N.getTotalMargin(this.item,this.ctr._horizontal)}_getCrossAxisMargin(){return N.getTotalMargin(this.item,!this.ctr._horizontal)}_getHorizontalMarginOffset(){return N.getMarginOffset(this.item,!0)}_getVerticalMarginOffset(){return N.getMarginOffset(this.item,!1)}_getMainAxisMinSizeWithPaddingAndMargin(){return this._getMainAxisMinSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisMinSizeWithPaddingAndMargin(){return this._getCrossAxisMinSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_getMainAxisLayoutSizeWithPaddingAndMargin(){return this._getMainAxisLayoutSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisLayoutSizeWithPaddingAndMargin(){return this._getCrossAxisLayoutSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_hasFixedCrossAxisSize(){return!N.isZeroAxisSize(this.item,!this.ctr._horizontal)}_hasRelCrossAxisSize(){return!!(this.ctr._horizontal?this.item.funcH:this.item.funcW)}}Ci.SHRINK_AUTO=-1;class Lu{constructor(t){this._target=t,this._recalc=0,this._enabled=!1,this.x=0,this.y=0,this.w=0,this.h=0,this._originalX=0,this._originalY=0,this._originalWidth=0,this._originalHeight=0,this._flex=null,this._flexItem=null,this._flexItemDisabled=!1,this._items=null}get flexLayout(){return this.flex?this.flex._layout:null}layoutFlexTree(){this.isFlexEnabled()&&this.isChanged()&&this.flexLayout.layoutTree()}get target(){return this._target}get flex(){return this._flex}set flex(t){t?(this.isFlexEnabled()||this._enableFlex(),this._flex.patch(t)):this.isFlexEnabled()&&this._disableFlex()}get flexItem(){return this._flexItemDisabled?!1:(this._ensureFlexItem(),this._flexItem)}set flexItem(t){if(t===!1){if(!this._flexItemDisabled){const e=this.flexParent;this._flexItemDisabled=!0,this._checkEnabled(),e&&(e._clearFlexItemsCache(),e.changedContents())}}else if(this._ensureFlexItem(),this._flexItem.patch(t),this._flexItemDisabled){this._flexItemDisabled=!1,this._checkEnabled();const e=this.flexParent;e&&(e._clearFlexItemsCache(),e.changedContents())}}_enableFlex(){this._flex=new Pt(this),this._checkEnabled(),this.changedDimensions(),this._enableChildrenAsFlexItems()}_disableFlex(){this.changedDimensions(),this._flex=null,this._checkEnabled(),this._disableChildrenAsFlexItems()}_enableChildrenAsFlexItems(){const t=this._target._children;if(t)for(let e=0,i=t.length;e<i;e++)t[e].layout._enableFlexItem()}_disableChildrenAsFlexItems(){const t=this._target._children;if(t)for(let e=0,i=t.length;e<i;e++)t[e].layout._disableFlexItem()}_enableFlexItem(){this._ensureFlexItem();const t=this._target._parent._layout;this._flexItem.ctr=t._flex,t.changedContents(),this._checkEnabled()}_disableFlexItem(){this._flexItem&&(this._flexItem.ctr=null),this._checkEnabled(),this._resetOffsets()}_resetOffsets(){this.x=0,this.y=0}_ensureFlexItem(){this._flexItem||(this._flexItem=new Ci(this))}_checkEnabled(){const t=this.isEnabled();this._enabled!==t&&(t?this._enable():this._disable(),this._enabled=t)}_enable(){this._setupTargetForFlex(),this._target.enableFlexLayout()}_disable(){this._restoreTargetToNonFlex(),this._target.disableFlexLayout()}isEnabled(){return this.isFlexEnabled()||this.isFlexItemEnabled()}isFlexEnabled(){return this._flex!==null}isFlexItemEnabled(){return this.flexParent!==null}_restoreTargetToNonFlex(){const t=this._target;t.x=this._originalX,t.y=this._originalY,t.setDimensions(this._originalWidth,this._originalHeight)}_setupTargetForFlex(){const t=this._target;this._originalX=t._x,this._originalY=t._y,this._originalWidth=t._w,this._originalHeight=t._h}setParent(t,e){t&&t.isFlexContainer()&&t._layout._changedChildren(),e&&e.isFlexContainer()&&(this._enableFlexItem(),e._layout._changedChildren()),this._checkEnabled()}get flexParent(){if(this._flexItemDisabled)return null;const t=this._target._parent;return t&&t.isFlexContainer()?t._layout:null}setVisible(t){const e=this.flexParent;e&&e._changedChildren()}get items(){return this._items||(this._items=this._getFlexItems()),this._items}_getFlexItems(){const t=[],e=this._target._children;if(e)for(let i=0,s=e.length;i<s;i++){const r=e[i];r.visible&&r.isFlexItem()&&t.push(r.layout)}return t}_changedChildren(){this._clearFlexItemsCache(),this.changedContents()}_clearFlexItemsCache(){this._items=null}setLayout(t,e,i,s){let r=this._originalX,o=this._originalY;this.funcX&&(r=this.funcX(N.getParentAxisSizeWithPadding(this,!0))),this.funcY&&(o=this.funcY(N.getParentAxisSizeWithPadding(this,!1))),this.isFlexItemEnabled()?this.target.setLayout(t+r,e+o,i,s):this.target.setLayout(r,o,i,s)}changedDimensions(t=!0,e=!0){this._updateRecalc(t,e)}changedContents(){this._updateRecalc()}forceLayout(){this._updateRecalc()}isChanged(){return this._recalc>0}_updateRecalc(t=!1,e=!1){if(this.isFlexEnabled()){const r=this._flex._layout;t=t||r.isAxisFitToContents(!0),e=e||r.isAxisFitToContents(!1)}const i=1+(t?2:0)+(e?4:0),s=this.getNewRecalcFlags(i);this._recalc|=i,s>1?this.flexParent?this.flexParent._updateRecalcBottomUp(i):this._target.triggerLayout():this._target.triggerLayout()}getNewRecalcFlags(t){return 7-this._recalc&t}_updateRecalcBottomUp(t){const e=this._getRecalcFromChangedChildRecalc(t),i=this.getNewRecalcFlags(e);if(this._recalc|=e,i>1){const s=this.flexParent;s?s._updateRecalcBottomUp(e):this._target.triggerLayout()}else this._target.triggerLayout()}_getRecalcFromChangedChildRecalc(t){const e=this._flex._layout,i=e._horizontal?1:2,s=e._horizontal?2:1;t&s||t&i&&e.isWrapping()&&e.isCrossAxisFitToContents()&&(t+=s);let o=e.isAxisFitToContents(!0),a=e.isAxisFitToContents(!1);e.shrunk&&(e._horizontal?o=!0:a=!0);const h=1+(o?2:0)+(a?4:0);return t&h}get recalc(){return this._recalc}clearRecalcFlag(){this._recalc=0}enableLocalRecalcFlag(){this._recalc=1}get originalX(){return this._originalX}setOriginalXWithoutUpdatingLayout(t){this._originalX=t}get originalY(){return this._originalY}setOriginalYWithoutUpdatingLayout(t){this._originalY=t}get originalWidth(){return this._originalWidth}set originalWidth(t){this._originalWidth!==t&&(this._originalWidth=t,this.changedDimensions(!0,!1))}get originalHeight(){return this._originalHeight}set originalHeight(t){this._originalHeight!==t&&(this._originalHeight=t,this.changedDimensions(!1,!0))}get funcX(){return this._target.funcX}get funcY(){return this._target.funcY}get funcW(){return this._target.funcW}get funcH(){return this._target.funcH}}class hi{constructor(t,e=null){this.id=hi.id++,this.manager=t,this.stage=t.stage,this.textures=new Set,this._activeTextureCount=0,this.loader=e,this.lookupId=null,this._cancelCb=null,this.loadingSince=0,this.w=0,this.h=0,this._nativeTexture=null,this.permanent=!1,this.renderInfo=null,this._isResultTexture=!this.loader,this._loadError=null,this._imageRef=null,this._hasAlpha=!1}get hasAlpha(){return this._hasAlpha}get loadError(){return this._loadError}addTexture(t){this.textures.has(t)||this.textures.add(t)}removeTexture(t){this.textures.delete(t)}incActiveTextureCount(){this._activeTextureCount++,this._activeTextureCount===1&&this.becomesUsed()}decActiveTextureCount(){this._activeTextureCount--,this._activeTextureCount===0&&this.becomesUnused()}get isResultTexture(){return this._isResultTexture}set isResultTexture(t){this._isResultTexture=t}forEachEnabledElement(t){this.textures.forEach(e=>{e.elements.forEach(t)})}hasEnabledElements(){return this.textures.size>0}forEachActiveElement(t){this.textures.forEach(e=>{e.elements.forEach(i=>{i.active&&t(i)})})}getRenderWidth(){return this.w}getRenderHeight(){return this.h}allowCleanup(){return!this.permanent&&!this.isUsed()}becomesUsed(){this.load()}becomesUnused(){this.cancel()}cancel(){this.isLoading()&&(this._cancelCb&&(this._cancelCb(this),this._cancelCb=null),this.loadingSince=0)}isLoaded(){return!!this._nativeTexture}isLoading(){return this.loadingSince>0}isError(){return!!this._loadError}reload(){this.free(),this.isUsed()&&this.load()}load(t=!1){this.isResultTexture||!this._nativeTexture&&!this.isLoading()&&(this.loadingSince=new Date().getTime(),this._cancelCb=this.loader((e,i)=>{if(this.isLoading()){if(this._cancelCb=null,this.manager.stage.destroyed)return;if(e)this.onError(e);else if(i&&i.source)if(!this.stage.isUpdatingFrame()&&!t&&i.throttle!==!1){const s=this.stage.textureThrottler;this._cancelCb=s.genericCancelCb,s.add(this,i)}else this.processLoadedSource(i)}},this))}processLoadedSource(t){this.loadingSince=0,this.setSource(t)}setSource(t){const e=t.source;this._hasAlpha=t&&t.hasAlpha||!1,this.w=e.width||t&&t.w||0,this.h=e.height||t&&t.h||0,t&&t.renderInfo&&(this.renderInfo=t.renderInfo),this.permanent=!!t.permanent,t&&t.imageRef&&(this._imageRef=t.imageRef),t&&t.flipTextureY?this._flipTextureY=t.flipTextureY:this._flipTextureY=!1,this._isNativeTexture(e)?(this._nativeTexture=e,this.w=this.w||e.w,this.h=this.h||e.h,this.permanent=t.hasOwnProperty("permanent")?t.permanent:!0):this.manager.uploadTextureSource(this,t),this._loadError=null,this.onLoad()}isUsed(){return this._activeTextureCount>0}onLoad(){this.isUsed()&&this.textures.forEach(t=>{t.onLoad()})}forceRenderUpdate(){this._nativeTexture&&(this._nativeTexture.update=this.stage.frameCounter),this.forEachActiveElement(function(t){t.forceRenderUpdate()})}forceUpdateRenderCoords(){this.forEachActiveElement(function(t){t._updateTextureCoords()})}get nativeTexture(){return this._nativeTexture}clearNativeTexture(){this._nativeTexture=null,this._imageRef=null}replaceNativeTexture(t,e,i){let s=this._nativeTexture;this._nativeTexture=t,this.w=e,this.h=i,!s&&this._nativeTexture&&this.forEachActiveElement(r=>r.onTextureSourceLoaded()),this._nativeTexture||this.forEachActiveElement(r=>r._setDisplayedTexture(null)),this.forEachEnabledElement(r=>r._updateDimensions())}onError(t){this._loadError=t,this.loadingSince=0,console.error("[Lightning] texture load error",t,this.lookupId),this.forEachActiveElement(e=>e.onTextureSourceLoadError(t))}free(){this.isLoaded()&&this.manager.freeTextureSource(this)}_isNativeTexture(t){return b.isNode?t.constructor.name==="WebGLTexture":"WebGLTexture"in window?t instanceof WebGLTexture:!1}}hi.prototype.isTextureSource=!0;hi.id=1;class Go{constructor(t){this._element=t.element,this._core=t,this.ctx=this._core.ctx,this._enabled=!1,this.lazy=!1,this._colorize=!1,this._renderTexture=null,this._renderTextureReused=!1,this._resultTextureSource=null,this._renderOffscreen=!1,this.empty=!1}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._core.updateRenderToTextureEnabled()}get renderOffscreen(){return this._renderOffscreen}set renderOffscreen(t){this._renderOffscreen=t,this._core.setHasRenderUpdates(1),this._core._setRecalc(6)}get colorize(){return this._colorize}set colorize(t){this._colorize!==t&&(this._colorize=t,this._core.setHasRenderUpdates(1))}_getTextureSource(){return this._resultTextureSource||(this._resultTextureSource=new hi(this._element.stage.textureManager),this.updateResultTexture()),this._resultTextureSource}hasResultTexture(){return!!this._resultTextureSource}resultTextureInUse(){return this._resultTextureSource&&this._resultTextureSource.hasEnabledElements()}updateResultTexture(){let t=this.getResultTexture();if(this._resultTextureSource){if(this._resultTextureSource.nativeTexture!==t){let e=t?t.w:0,i=t?t.h:0;this._resultTextureSource.replaceNativeTexture(t,e,i)}this._resultTextureSource.forEachEnabledElement(e=>{e._updateDimensions(),e.core.setHasRenderUpdates(3)})}}mustRenderToTexture(){return this._enabled&&!this.lazy?!0:!!(this._enabled&&this.lazy&&this._core._hasRenderUpdates<3)}deactivate(){this.release()}get renderTextureReused(){return this._renderTextureReused}release(){this.releaseRenderTexture()}releaseRenderTexture(){this._renderTexture&&(this._renderTextureReused||this.ctx.releaseRenderTexture(this._renderTexture),this._renderTexture=null,this._renderTextureReused=!1,this.updateResultTexture())}reuseTextureAsRenderTexture(t){this._renderTexture!==t&&(this.releaseRenderTexture(),this._renderTexture=t,this._renderTextureReused=!0)}hasRenderTexture(){return!!this._renderTexture}getRenderTexture(){return this._renderTexture||(this._renderTexture=this.ctx.allocateRenderTexture(this._core._w,this._core._h),this._renderTextureReused=!1),this._renderTexture}getResultTexture(){return this._renderTexture}}class Se{constructor(t){this._element=t,this.ctx=t.stage.ctx,this._recalc=0,this._parent=null,this._onUpdate=null,this._pRecalc=0,this._worldContext=new Pe,this._hasUpdates=!1,this._localAlpha=1,this._onAfterCalcs=null,this._onAfterUpdate=null,this._localPx=0,this._localPy=0,this._localTa=1,this._localTb=0,this._localTc=0,this._localTd=1,this._isComplex=!1,this._dimsUnknown=!1,this._clipping=!1,this._zSort=!1,this._outOfBounds=0,this._displayedTextureSource=null,this._zContextUsage=0,this._children=null,this._hasRenderUpdates=0,this._zIndexedChildren=null,this._renderContext=this._worldContext,this.renderState=this.ctx.renderState,this._scissor=null,this._shaderOwner=null,this._updateTreeOrder=0,this._colorUl=this._colorUr=this._colorBl=this._colorBr=4294967295,this._x=0,this._y=0,this._w=0,this._h=0,this._optFlags=0,this._funcX=null,this._funcY=null,this._funcW=null,this._funcH=null,this._scaleX=1,this._scaleY=1,this._pivotX=.5,this._pivotY=.5,this._mountX=0,this._mountY=0,this._rotation=0,this._alpha=1,this._visible=!0,this._ulx=0,this._uly=0,this._brx=1,this._bry=1,this._zIndex=0,this._forceZIndexContext=!1,this._zParent=null,this._isRoot=!1,this._zIndexResort=!1,this._shader=null,this._renderToTextureEnabled=!1,this._texturizer=null,this._useRenderToTexture=!1,this._boundsMargin=null,this._recBoundsMargin=null,this._withinBoundsMargin=!1,this._viewport=null,this._clipbox=!0,this.render=this._renderSimple,this._layout=null}get offsetX(){return this._funcX?this._funcX:this.hasFlexLayout()?this._layout.originalX:this._x}set offsetX(t){b.isFunction(t)?this.funcX=t:(this._disableFuncX(),this.hasFlexLayout()?(this.x+=t-this._layout.originalX,this._layout.setOriginalXWithoutUpdatingLayout(t)):this.x=t)}get x(){return this._x}set x(t){t!==this._x&&(this._updateLocalTranslateDelta(t-this._x,0),this._x=t)}get funcX(){return this._optFlags&1?this._funcX:null}set funcX(t){this._funcX!==t&&(this._optFlags|=1,this._funcX=t,this.hasFlexLayout()?(this._layout.setOriginalXWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._x=0,this._triggerRecalcTranslate()))}_disableFuncX(){this._optFlags=this._optFlags&65535-1,this._funcX=null}get offsetY(){return this._funcY?this._funcY:this.hasFlexLayout()?this._layout.originalY:this._y}set offsetY(t){b.isFunction(t)?this.funcY=t:(this._disableFuncY(),this.hasFlexLayout()?(this.y+=t-this._layout.originalY,this._layout.setOriginalYWithoutUpdatingLayout(t)):this.y=t)}get y(){return this._y}set y(t){t!==this._y&&(this._updateLocalTranslateDelta(0,t-this._y),this._y=t)}get funcY(){return this._optFlags&2?this._funcY:null}set funcY(t){this._funcY!==t&&(this._optFlags|=2,this._funcY=t,this.hasFlexLayout()?(this._layout.setOriginalYWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._y=0,this._triggerRecalcTranslate()))}_disableFuncY(){this._optFlags=this._optFlags&65535-2,this._funcY=null}get funcW(){return this._optFlags&4?this._funcW:null}set funcW(t){this._funcW!==t&&(this._optFlags|=4,this._funcW=t,this.hasFlexLayout()?(this._layout._originalWidth=0,this.layout.changedDimensions(!0,!1)):(this._w=0,this._triggerRecalcTranslate()))}disableFuncW(){this._optFlags=this._optFlags&65535-4,this._funcW=null}get funcH(){return this._optFlags&8?this._funcH:null}set funcH(t){this._funcH!==t&&(this._optFlags|=8,this._funcH=t,this.hasFlexLayout()?(this._layout._originalHeight=0,this.layout.changedDimensions(!1,!0)):(this._h=0,this._triggerRecalcTranslate()))}disableFuncH(){this._optFlags=this._optFlags&65535-8,this._funcH=null}get w(){return this._w}getRenderWidth(){return this.hasFlexLayout()?this._layout.originalWidth:this._w}get h(){return this._h}getRenderHeight(){return this.hasFlexLayout()?this._layout.originalHeight:this._h}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX!==t&&(this._scaleX=t,this._updateLocalTransform())}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY!==t&&(this._scaleY=t,this._updateLocalTransform())}get scale(){return this.scaleX}set scale(t){(this._scaleX!==t||this._scaleY!==t)&&(this._scaleX=t,this._scaleY=t,this._updateLocalTransform())}get pivotX(){return this._pivotX}set pivotX(t){this._pivotX!==t&&(this._pivotX=t,this._updateLocalTranslate())}get pivotY(){return this._pivotY}set pivotY(t){this._pivotY!==t&&(this._pivotY=t,this._updateLocalTranslate())}get pivot(){return this._pivotX}set pivot(t){(this._pivotX!==t||this._pivotY!==t)&&(this._pivotX=t,this._pivotY=t,this._updateLocalTranslate())}get mountX(){return this._mountX}set mountX(t){this._mountX!==t&&(this._mountX=t,this._updateLocalTranslate())}get mountY(){return this._mountY}set mountY(t){this._mountY!==t&&(this._mountY=t,this._updateLocalTranslate())}get mount(){return this._mountX}set mount(t){(this._mountX!==t||this._mountY!==t)&&(this._mountX=t,this._mountY=t,this._updateLocalTranslate())}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._updateLocalTransform())}get alpha(){return this._alpha}set alpha(t){if(t=t>1?1:t<1e-14?0:t,this._alpha!==t){let e=this._alpha;this._alpha=t,this._updateLocalAlpha(),e===0!=(t===0)&&this._element._updateEnabledFlag()}}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this._updateLocalAlpha(),this._element._updateEnabledFlag(),this.hasFlexLayout()&&this.layout.setVisible(t))}_updateLocalTransform(){if(this._rotation!==0&&this._rotation%(2*Math.PI)){let t=Math.sin(this._rotation),e=Math.cos(this._rotation);this._setLocalTransform(e*this._scaleX,-t*this._scaleY,t*this._scaleX,e*this._scaleY)}else this._setLocalTransform(this._scaleX,0,0,this._scaleY);this._updateLocalTranslate()}_updateLocalTranslate(){this._recalcLocalTranslate(),this._triggerRecalcTranslate()}_recalcLocalTranslate(){let t=this._pivotX*this._w,e=this._pivotY*this._h,i=this._x-(t*this._localTa+e*this._localTb)+t,s=this._y-(t*this._localTc+e*this._localTd)+e;i-=this._mountX*this._w,s-=this._mountY*this._h,this._localPx=i,this._localPy=s}_updateLocalTranslateDelta(t,e){this._addLocalTranslate(t,e)}_updateLocalAlpha(){this._setLocalAlpha(this._visible?this._alpha:0)}setHasRenderUpdates(t){if(this._worldContext.alpha){let e=this;for(e._hasRenderUpdates=Math.max(t,e._hasRenderUpdates);(e=e._parent)&&e._hasRenderUpdates!==3;)e._hasRenderUpdates=3}}_setRecalc(t){this._recalc|=t,this._setHasUpdates(),this._parent&&this._parent.setHasRenderUpdates(3)}_setHasUpdates(){let t=this;for(;t&&!t._hasUpdates;)t._hasUpdates=!0,t=t._parent}getParent(){return this._parent}setParent(t){if(t!==this._parent){let e=this.isZContext(),i=this._parent;if(this._parent=t,(this._layout||t&&t.isFlexContainer())&&this.layout.setParent(i,t),i&&i.setHasRenderUpdates(3),this._setRecalc(1+2+4),this._parent&&this._parent._setHasUpdates(),this._zIndex===0?this.setZParent(t):this.setZParent(t?t.findZContext():null),e!==this.isZContext()&&(this.isZContext()?this.enableZContext(i.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort(),!this._shader){let s=t&&!t._renderToTextureEnabled?t._shaderOwner:null;s!==this._shaderOwner&&(this.setHasRenderUpdates(1),this._setShaderOwnerRecursive(s))}}}enableZSort(t=!1){!this._zSort&&this._zContextUsage>0&&(this._zSort=!0,t&&this.ctx.forceZSort(this))}addChildAt(t,e){this._children||(this._children=[]),this._children.splice(t,0,e),e.setParent(this)}setChildAt(t,e){this._children||(this._children=[]),this._children[t].setParent(null),this._children[t]=e,e.setParent(this)}removeChildAt(t){let e=this._children[t];this._children.splice(t,1),e.setParent(null)}removeChildren(){if(this._children){for(let t=0,e=this._children.length;t<e;t++)this._children[t].setParent(null);this._children.splice(0),this._zIndexedChildren&&this._zIndexedChildren.splice(0)}}syncChildren(t,e,i){this._children=i;for(let s=0,r=t.length;s<r;s++)t[s].setParent(null);for(let s=0,r=e.length;s<r;s++)e[s].setParent(this)}moveChild(t,e){let i=this._children[t];this._children.splice(t,1),this._children.splice(e,0,i),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}_setLocalTransform(t,e,i,s){this._setRecalc(4),this._localTa=t,this._localTb=e,this._localTc=i,this._localTd=s,this._isComplex=e!==0||i!==0||t<0||s<0}_addLocalTranslate(t,e){this._localPx+=t,this._localPy+=e,this._triggerRecalcTranslate()}_setLocalAlpha(t){!this._worldContext.alpha&&this._parent&&this._parent._worldContext.alpha&&t?this._setRecalc(1+128):this._setRecalc(1),t<1e-14&&(t=0),this._localAlpha=t}setDimensions(t,e,i=this._dimsUnknown){if(this._dimsUnknown=i,this.hasFlexLayout())this._layout.originalWidth=t,this._layout.originalHeight=e;else if(this._w!==t||this._h!==e)return this._updateDimensions(t,e),!0;return!1}_updateDimensions(t,e){(this._w!==t||this._h!==e)&&(this._w=t,this._h=e,this._triggerRecalcTranslate(),this._texturizer&&(this._texturizer.releaseRenderTexture(),this._texturizer.updateResultTexture()),this._updateLocalTranslate())}setTextureCoords(t,e,i,s){this.setHasRenderUpdates(3),this._ulx=t,this._uly=e,this._brx=i,this._bry=s}get displayedTextureSource(){return this._displayedTextureSource}setDisplayedTextureSource(t){this.setHasRenderUpdates(3),this._displayedTextureSource=t}get isRoot(){return this._isRoot}setAsRoot(){this._parent=new Se(this._element),this._parent._hasRenderUpdates=3,this._parent._hasUpdates=!0,this._isRoot=!0,this.ctx.root=this,this._parent._viewport=[0,0,this.ctx.stage.coordsWidth,this.ctx.stage.coordsHeight],this._parent._scissor=this._parent._viewport,this._parent._recBoundsMargin=null,this._setRecalc(1+2+4)}isAncestorOf(t){let e=t;for(;e=e._parent;)if(this===e)return!0;return!1}isZContext(){return this._forceZIndexContext||this._renderToTextureEnabled||this._zIndex!==0||this._isRoot||!this._parent}findZContext(){return this.isZContext()?this:this._parent.findZContext()}setZParent(t){if(this._zParent!==t){if(this._zParent!==null&&(this._zIndex!==0&&this._zParent.decZContextUsage(),this._zParent.enableZSort()),t!==null){let e=t._zContextUsage>0;this._zIndex!==0&&t.incZContextUsage(),t._zContextUsage>0&&(!e&&this._parent===t||t._zIndexedChildren.push(this),t.enableZSort())}this._zParent=t,this._zIndexResort=!0}}incZContextUsage(){if(this._zContextUsage++,this._zContextUsage===1&&(this._zIndexedChildren||(this._zIndexedChildren=[]),this._children)){for(let t=0,e=this._children.length;t<e;t++)this._zIndexedChildren.push(this._children[t]);this._zSort=!1}}decZContextUsage(){this._zContextUsage--,this._zContextUsage===0&&(this._zSort=!1,this._zIndexedChildren.splice(0))}get zIndex(){return this._zIndex}set zIndex(t){if(this._zIndex!==t){this.setHasRenderUpdates(1);let e=this._zParent,i=this.isZContext();t===0&&this._zIndex!==0?this._parent===this._zParent?this._zParent&&this._zParent.decZContextUsage():e=this._parent:t!==0&&this._zIndex===0?(e=this._parent?this._parent.findZContext():null,e===this._zParent&&this._zParent&&(this._zParent.incZContextUsage(),this._zParent.enableZSort())):t!==this._zIndex&&this._zParent&&this._zParent._zContextUsage&&this._zParent.enableZSort(),e!==this._zParent&&this.setZParent(null),this._zIndex=t,e!==this._zParent&&this.setZParent(e),i!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}}get forceZIndexContext(){return this._forceZIndexContext}set forceZIndexContext(t){this.setHasRenderUpdates(1);let e=this.isZContext();this._forceZIndexContext=t,e!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext())}enableZContext(t){t&&t._zContextUsage>0&&this._getZIndexedDescs().forEach(i=>{this.isAncestorOf(i)&&i._zIndex!==0&&i.setZParent(this)})}_getZIndexedDescs(){const t=[];if(this._children)for(let e=0,i=this._children.length;e<i;e++)this._children[e]._getZIndexedDescsRec(t);return t}_getZIndexedDescsRec(t){if(this._zIndex)t.push(this);else if(this._children&&!this.isZContext())for(let e=0,i=this._children.length;e<i;e++)this._children[e]._getZIndexedDescsRec(t)}disableZContext(){if(this._zContextUsage>0){let t=this._parent.findZContext();this._zSort&&this.sortZIndexedChildren(),this._zIndexedChildren.slice().forEach(function(e){e._zIndex!==0&&e.setZParent(t)})}}get colorUl(){return this._colorUl}set colorUl(t){this._colorUl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUl=t)}get colorUr(){return this._colorUr}set colorUr(t){this._colorUr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUr=t)}get colorBl(){return this._colorBl}set colorBl(t){this._colorBl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBl=t)}get colorBr(){return this._colorBr}set colorBr(t){this._colorBr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBr=t)}set onUpdate(t){this._onUpdate=t,this._setRecalc(7)}set onAfterUpdate(t){this._onAfterUpdate=t,this._setRecalc(7)}set onAfterCalcs(t){this._onAfterCalcs=t,this._setRecalc(7)}get shader(){return this._shader}set shader(t){this.setHasRenderUpdates(1);let e=this._shader;if(this._shader=t,!t&&e){let i=this._parent&&!this._parent._renderToTextureEnabled?this._parent._shaderOwner:null;this._setShaderOwnerRecursive(i)}else t&&this._setShaderOwnerRecursive(this)}get activeShader(){return this._shaderOwner?this._shaderOwner.shader:this.renderState.defaultShader}get activeShaderOwner(){return this._shaderOwner}get clipping(){return this._clipping}set clipping(t){this._clipping!==t&&(this._clipping=t,this._setRecalc(1+2))}get clipbox(){return this._clipbox}set clipbox(t){this._clipbox=t}_setShaderOwnerRecursive(t){if(this._shaderOwner=t,this._children&&!this._renderToTextureEnabled)for(let e=0,i=this._children.length;e<i;e++){let s=this._children[e];s._shader||(s._setShaderOwnerRecursive(t),s._hasRenderUpdates=3)}}_setShaderOwnerChildrenRecursive(t){if(this._children)for(let e=0,i=this._children.length;e<i;e++){let s=this._children[e];s._shader||(s._setShaderOwnerRecursive(t),s._hasRenderUpdates=3)}}_hasRenderContext(){return this._renderContext!==this._worldContext}get renderContext(){return this._renderContext}updateRenderToTextureEnabled(){this.texturizer._enabled?this._enableRenderToTexture():(this._disableRenderToTexture(),this._texturizer.releaseRenderTexture())}_enableRenderToTexture(){if(!this._renderToTextureEnabled){let t=this.isZContext();this._renderToTextureEnabled=!0,this._renderContext=new Pe,this._setShaderOwnerChildrenRecursive(null),t||this.enableZContext(this._parent?this._parent.findZContext():null),this.setHasRenderUpdates(3),this._setRecalc(7),this.render=this._renderAdvanced}}_disableRenderToTexture(){this._renderToTextureEnabled&&(this._renderToTextureEnabled=!1,this._setShaderOwnerChildrenRecursive(this._shaderOwner),this._renderContext=this._worldContext,this.isZContext()||this.disableZContext(),this._setRecalc(7),this.setHasRenderUpdates(3),this.render=this._renderSimple)}isWhite(){return this._colorUl===4294967295&&this._colorUr===4294967295&&this._colorBl===4294967295&&this._colorBr===4294967295}hasSimpleTexCoords(){return this._ulx===0&&this._uly===0&&this._brx===1&&this._bry===1}_stashTexCoords(){this._stashedTexCoords=[this._ulx,this._uly,this._brx,this._bry],this._ulx=0,this._uly=0,this._brx=1,this._bry=1}_unstashTexCoords(){this._ulx=this._stashedTexCoords[0],this._uly=this._stashedTexCoords[1],this._brx=this._stashedTexCoords[2],this._bry=this._stashedTexCoords[3],this._stashedTexCoords=null}_stashColors(){this._stashedColors=[this._colorUl,this._colorUr,this._colorBr,this._colorBl],this._colorUl=4294967295,this._colorUr=4294967295,this._colorBr=4294967295,this._colorBl=4294967295}_unstashColors(){this._colorUl=this._stashedColors[0],this._colorUr=this._stashedColors[1],this._colorBr=this._stashedColors[2],this._colorBl=this._stashedColors[3],this._stashedColors=null}isVisible(){return this._localAlpha>1e-14}get outOfBounds(){return this._outOfBounds}set boundsMargin(t){this._boundsMargin=t?t.slice():null,this._triggerRecalcTranslate()}get boundsMargin(){return this._boundsMargin}update(){this._recalc|=this._parent._pRecalc,this._layout&&this._layout.isEnabled()?this._recalc&256&&this._layout.layoutFlexTree():this._recalc&2&&this._optFlags&&this._applyRelativeDimFuncs(),this._onUpdate&&(this._hasUpdates=!0,this._onUpdate(this.element,this));const t=this._parent._worldContext;let e=this._worldContext;const i=t.alpha&&this._localAlpha;if(this._hasUpdates||this._recalc&&i||e.alpha&&!i){let s=this._recalc;s&1&&(!e.alpha&&i&&(this._hasRenderUpdates=3),e.alpha=t.alpha*this._localAlpha,e.alpha<1e-14&&(e.alpha=0)),s&6&&(e.px=t.px+this._localPx*t.ta,e.py=t.py+this._localPy*t.td,t.tb!==0&&(e.px+=this._localPy*t.tb),t.tc!==0&&(e.py+=this._localPx*t.tc)),s&4&&(e.ta=this._localTa*t.ta,e.tb=this._localTd*t.tb,e.tc=this._localTa*t.tc,e.td=this._localTd*t.td,this._isComplex&&(e.ta+=this._localTc*t.tb,e.tb+=this._localTb*t.ta,e.tc+=this._localTc*t.td,e.td+=this._localTb*t.tc));const r=this._parent._renderContext;if(this._parent._hasRenderContext()){const f=this._renderContext===this._worldContext;f&&(this._renderContext=new Pe);const y=this._renderContext;(f||s&1)&&(y.alpha=r.alpha*this._localAlpha,y.alpha<1e-14&&(y.alpha=0)),(f||s&6)&&(y.px=r.px+this._localPx*r.ta,y.py=r.py+this._localPy*r.td,r.tb!==0&&(y.px+=this._localPy*r.tb),r.tc!==0&&(y.py+=this._localPx*r.tc)),f&&(s|=2),(f||s&4)&&(y.ta=this._localTa*r.ta,y.tb=this._localTd*r.tb,y.tc=this._localTa*r.tc,y.td=this._localTd*r.td,this._isComplex&&(y.ta+=this._localTc*r.tb,y.tb+=this._localTb*r.ta,y.tc+=this._localTc*r.td,y.td+=this._localTb*r.tc))}else this._renderContext=this._worldContext;this.ctx.updateTreeOrder===-1?this.ctx.updateTreeOrder=this._updateTreeOrder+1:this._updateTreeOrder=this.ctx.updateTreeOrder++;const o=this._renderToTextureEnabled&&this._texturizer.mustRenderToTexture();this._useRenderToTexture!==o&&(this._recalc|=2+4,s|=2,this._useRenderToTexture||this._texturizer.release()),this._useRenderToTexture=o;const a=this._renderContext,h=this._dimsUnknown?2048:this._w,l=this._dimsUnknown?2048:this._h;let c,u,d,g;const _=a.tb!==0||a.tc!==0||a.ta<0||a.td<0;if(_?(c=Math.min(0,h*a.ta,h*a.ta+l*a.tb,l*a.tb)+a.px,d=Math.max(0,h*a.ta,h*a.ta+l*a.tb,l*a.tb)+a.px,u=Math.min(0,h*a.tc,h*a.tc+l*a.td,l*a.td)+a.py,g=Math.max(0,h*a.tc,h*a.tc+l*a.td,l*a.td)+a.py):(c=a.px,d=a.px+a.ta*h,u=a.py,g=a.py+a.td*l),this._dimsUnknown&&(_||this._localTa<1||this._localTb<1)){const f=this._x*r.ta+this._y*r.tb+r.px,y=this._x*r.tc+this._y*r.td+r.py;f<c&&(c=f),y<u&&(u=y),f>d&&(d=f),y>g&&(g=y)}if(s&6||!this._scissor)if(this._clipping&&a.isSquare()){const f=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(f){const y=Math.max(f[0],c),T=Math.max(f[1],u);this._scissor=[y,T,Math.min(f[2]+f[0],d)-y,Math.min(f[3]+f[1],g)-T]}else this._scissor=[c,u,d-c,g-u]}else this._scissor=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(this._boundsMargin?this._recBoundsMargin=this._boundsMargin:this._recBoundsMargin=this._parent._recBoundsMargin,this._onAfterCalcs&&this._onAfterCalcs(this.element)&&(_?(c=Math.min(0,h*a.ta,h*a.ta+l*a.tb,l*a.tb)+a.px,d=Math.max(0,h*a.ta,h*a.ta+l*a.tb,l*a.tb)+a.px,u=Math.min(0,h*a.tc,h*a.tc+l*a.td,l*a.td)+a.py,g=Math.max(0,h*a.tc,h*a.tc+l*a.td,l*a.td)+a.py):(c=a.px,d=a.px+a.ta*h,u=a.py,g=a.py+a.td*l),this._dimsUnknown&&(_||this._localTa<1||this._localTb<1))){const f=this._x*r.ta+this._y*r.tb+r.px,y=this._x*r.tc+this._y*r.td+r.py;f<c&&(c=f),y<u&&(u=y),f>d&&(d=f),y>g&&(g=y)}if(this._parent._outOfBounds===2)this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin());else if(s&6){this._outOfBounds=0;let f=!0;if((!this._renderToTextureEnabled||!this._texturizer||!this._texturizer.renderOffscreen)&&(this._scissor&&(this._scissor[2]<=0||this._scissor[3]<=0)?this._outOfBounds=2:((this._scissor[0]>d||this._scissor[1]>g||c>this._scissor[0]+this._scissor[2]||u>this._scissor[1]+this._scissor[3])&&(this._outOfBounds=1),this._outOfBounds&&(this._clipping||this._useRenderToTexture||this._clipbox&&h&&l)&&(this._outOfBounds=2)),f=this._outOfBounds===0,f||(this._recBoundsMargin?f=!(d<this._scissor[0]-this._recBoundsMargin[2]||g<this._scissor[1]-this._recBoundsMargin[3]||c>this._scissor[0]+this._scissor[2]+this._recBoundsMargin[0]||u>this._scissor[1]+this._scissor[3]+this._recBoundsMargin[1]):f=!(d<this._scissor[0]-100||g<this._scissor[1]-100||c>this._scissor[0]+this._scissor[2]+100||u>this._scissor[1]+this._scissor[3]+100),f&&this._outOfBounds===2&&(this._outOfBounds=1))),this._withinBoundsMargin!==f)if(this._withinBoundsMargin=f,this._withinBoundsMargin){this._hasUpdates=!0;const y=this._recalc;if(this._recalc=0,this.element._enableWithinBoundsMargin(),this._recalc)return this.update();this._recalc=y}else this.element._disableWithinBoundsMargin()}if(this._useRenderToTexture&&(this._viewport?(this._viewport[2]=h,this._viewport[3]=l):this._viewport=[0,0,h,l]),this._pRecalc=this._recalc&135,this._recalc=0,this._hasUpdates=!1,this._outOfBounds<2){if(this._useRenderToTexture&&(this._worldContext.isIdentity()?this._renderContext=this._worldContext:this._renderContext=Pe.IDENTITY),this._children)for(let f=0,y=this._children.length;f<y;f++)this._children[f].update();this._useRenderToTexture&&(this._renderContext=a)}else if(this._children)for(let f=0,y=this._children.length;f<y;f++)this._children[f]._hasUpdates?this._children[f].update():(this._children[f]._recalc|=this._pRecalc,this._children[f].updateOutOfBounds());this._onAfterUpdate&&this._onAfterUpdate(this.element)}else this.ctx.updateTreeOrder===-1||this._updateTreeOrder>=this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=-1:this.updateTreeOrder()}_applyRelativeDimFuncs(){if(this._optFlags&1){const e=this._funcX(this._parent.w);e!==this._x&&(this._localPx+=e-this._x,this._x=e)}if(this._optFlags&2){const e=this._funcY(this._parent.h);e!==this._y&&(this._localPy+=e-this._y,this._y=e)}let t=!1;if(this._optFlags&4){const e=this._funcW(this._parent.w);e!==this._w&&(this._w=e,t=!0)}if(this._optFlags&8){const e=this._funcH(this._parent.h);e!==this._h&&(this._h=e,t=!0)}t&&(this._recalcLocalTranslate(),this.element.onDimensionsChanged(this._w,this._h))}updateOutOfBounds(){if(this._outOfBounds!==2&&this._renderContext.alpha>0&&(this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin()),this._children))for(let t=0,e=this._children.length;t<e;t++)this._children[t].updateOutOfBounds()}updateTreeOrder(){if(this._localAlpha&&this._outOfBounds!==2&&(this._updateTreeOrder=this.ctx.updateTreeOrder++,this._children))for(let t=0,e=this._children.length;t<e;t++)this._children[t].updateTreeOrder()}_renderSimple(){if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){let t=this.renderState;if(this._outOfBounds===0&&this._displayedTextureSource&&(t.setShader(this.activeShader,this._shaderOwner),t.setScissor(this._scissor),this.renderState.addQuad(this)),this._children)if(this._zContextUsage)for(let e=0,i=this._zIndexedChildren.length;e<i;e++)this._zIndexedChildren[e].render();else for(let e=0,i=this._children.length;e<i;e++)this._children[e]._zIndex===0&&this._children[e].render()}}_renderAdvanced(){const t=this._hasRenderUpdates;if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){let e=this.renderState,i=!0,s,r;if(this._useRenderToTexture){if(this._w===0||this._h===0)return;if(!this._texturizer.hasRenderTexture()||t>=3){if(this.ctx.renderToTextureCount++,e.setShader(e.defaultShader,this),r=e.renderTextureInfo,s={nativeTexture:null,offset:0,w:this._w,h:this._h,empty:!0,cleared:!1,ignore:!1,cache:!1},(this._texturizer.hasResultTexture()||!e.isCachingTexturizer&&t<3)&&(s.cache=!0,e.isCachingTexturizer=!0),this._texturizer.hasResultTexture()||this._texturizer.releaseRenderTexture(),e.setRenderTextureInfo(s),e.setScissor(null),this._displayedTextureSource){let o=this._renderContext;this._renderContext=Pe.IDENTITY,this.renderState.addQuad(this),this._renderContext=o}}else i=!1}else this._outOfBounds===0&&this._displayedTextureSource&&(e.setShader(this.activeShader,this._shaderOwner),e.setScissor(this._scissor),this.renderState.addQuad(this));if(i&&this._children)if(this._zContextUsage)for(let o=0,a=this._zIndexedChildren.length;o<a;o++)this._zIndexedChildren[o].render();else for(let o=0,a=this._children.length;o<a;o++)this._children[o]._zIndex===0&&this._children[o].render();if(this._useRenderToTexture){let o=!1;if(i&&(e.finishedRenderTexture(),this._texturizer.empty=s.empty,s.empty?this._texturizer.releaseRenderTexture():s.nativeTexture?(this._texturizer.reuseTextureAsRenderTexture(s.nativeTexture),s.ignore=!0):(this._texturizer.renderTextureReused&&this._texturizer.releaseRenderTexture(),s.nativeTexture=this._texturizer.getRenderTexture()),e.setRenderTextureInfo(r),o=!0),!this._texturizer.empty){let a=this._texturizer.getResultTexture();if(o&&(a&&(a.update=e.stage.frameCounter),this._texturizer.updateResultTexture()),!this._texturizer.renderOffscreen){e.setShader(this.activeShader,this._shaderOwner),e.setScissor(this._scissor);const h=!s||s.cache;e.setTexturizer(this._texturizer,h),this._stashTexCoords(),this._texturizer.colorize||this._stashColors(),this.renderState.addQuad(this,!0),this._texturizer.colorize||this._unstashColors(),this._unstashTexCoords(),e.setTexturizer(null)}}}s&&s.cache&&(e.isCachingTexturizer=!1)}}get zSort(){return this._zSort}sortZIndexedChildren(){const t=this._zIndexedChildren.length;let e=0;const i=this._zIndexedChildren,s=[];for(let o=0;o<t;o++)i[o]._zParent===this&&(i[o]._zIndexResort?s.push(i[o]):(e!==o&&(i[e]=i[o]),e++));const r=s.length;if(r){for(let a=0;a<r;a++)s[a]._zIndexResort=!1;s.sort(Se.sortZIndexedChildren);const o=e;if(o){i.splice(o),+ +i.sort(Se.sortZIndexedChildren),e=0;let a=0,h=0;const l=[];do{const u=(i[a]._zIndex===s[h]._zIndex?i[a]._updateTreeOrder-s[h]._updateTreeOrder:i[a]._zIndex-s[h]._zIndex)>0?s[h++]:i[a++];if((e===0||l[e-1]!==u)&&(l[e++]=u),a>=o){do{const d=s[h++];(e===0||l[e-1]!==d)&&(l[e++]=d)}while(h<r);break}else if(h>=r){do{const d=i[a++];(e===0||l[e-1]!==d)&&(l[e++]=d)}while(a<o);break}}while(!0);this._zIndexedChildren=l}else{e=0;let a=0;do i[e++]=s[a++];while(a<r);i.length>e&&i.splice(e)}}else i.length>e&&i.splice(e);this._zSort=!1}get localTa(){return this._localTa}get localTb(){return this._localTb}get localTc(){return this._localTc}get localTd(){return this._localTd}get element(){return this._element}get renderUpdates(){return this._hasRenderUpdates}get texturizer(){return this._texturizer||(this._texturizer=new Go(this)),this._texturizer}getCornerPoints(){let t=this._worldContext;return[t.px,t.py,t.px+this._w*t.ta,t.py+this._w*t.tc,t.px+this._w*t.ta+this._h*t.tb,t.py+this._w*t.tc+this._h*t.td,t.px+this._h*t.tb,t.py+this._h*t.td]}getRenderTextureCoords(t,e){let i=this._renderContext;return[i.px+i.ta*t+i.tb*e,i.py+i.tc*t+i.td*e]}getAbsoluteCoords(t,e){let i=this._renderContext;return[i.px+i.ta*t+i.tb*e,i.py+i.tc*t+i.td*e]}collectAtCoord(t,e,i){if(this._renderContext.alpha!==0){if(this.inBound(t,e)&&(this._scissor?this.inScissor()&&i.push(this):i.push(this)),this._children){const s=this._children.length;for(let r=0;r<s;r++)this._children[r].collectAtCoord(t,e,i)}return i.sort(Se.sortZIndexedChildren)}}inBound(t,e){const i=this.getCornerPoints();return t>i[0]&&t<i[2]&&e>i[1]&&e<i[7]}inScissor(){const t=this._scissor,e=this.getCornerPoints();return e[2]>=t[0]&&e[0]<=t[0]+t[2]&&e[7]>=t[1]&&e[1]<=t[1]+t[3]}get layout(){return this._ensureLayout(),this._layout}get flex(){return this._layout?this._layout.flex:null}set flex(t){this.layout.flex=t}get flexItem(){return this._layout?this._layout.flexItem:null}set flexItem(t){this.layout.flexItem=t}isFlexItem(){return!!this._layout&&this._layout.isFlexItemEnabled()}isFlexContainer(){return!!this._layout&&this._layout.isFlexEnabled()}enableFlexLayout(){this._ensureLayout()}_ensureLayout(){this._layout||(this._layout=new Lu(this))}disableFlexLayout(){this._triggerRecalcTranslate()}hasFlexLayout(){return this._layout&&this._layout.isEnabled()}setLayout(t,e,i,s){this.x=t,this.y=e,this._updateDimensions(i,s)}triggerLayout(){this._setRecalc(256)}_triggerRecalcTranslate(){this._setRecalc(2)}}class Pe{constructor(){this.alpha=1,this.px=0,this.py=0,this.ta=1,this.tb=0,this.tc=0,this.td=1}isIdentity(){return this.alpha===1&&this.px===0&&this.py===0&&this.ta===1&&this.tb===0&&this.tc===0&&this.td===1}isSquare(){return this.tb===0&&this.tc===0}}Pe.IDENTITY=new Pe;Se.sortZIndexedChildren=function(n,t){return n._zIndex===t._zIndex?n._updateTreeOrder-t._updateTreeOrder:n._zIndex-t._zIndex};class J{constructor(){this._hasEventListeners=!1}on(t,e){this._hasEventListeners||(this._eventFunction={},this._eventListeners={},this._hasEventListeners=!0),this._eventFunction[t]?this._eventFunction[t]!==J.combiner?(this._eventListeners[t]=[this._eventFunction[t],e],this._eventFunction[t]=J.combiner):this._eventListeners[t].push(e):this._eventFunction[t]=e}once(t,e){const i=(s,r,o)=>{e(s,r,o),this.off(t,i)};i.__originalFunc=e,this.on(t,i)}has(t,e){if(this._hasEventListeners){const i=this._eventFunction[t];if(i){if(i===J.combiner){const s=this._eventListeners[t];for(const r of s)if(r===e||r.__originalFunc==e)return!0}else if(this._eventFunction[t]===e||this._eventFunction[t].__originalFunc===e)return!0}}return!1}off(t,e){if(this._hasEventListeners){const i=this._eventFunction[t];if(i)if(i===J.combiner){const s=this._eventListeners[t];let r=s.indexOf(e);r>=0&&s.splice(r,1),r=s.map(o=>o.__originalFunc).indexOf(e),r>=0&&s.splice(r,1),s.length===1&&(this._eventFunction[t]=s[0],this._eventListeners[t]=void 0)}else(this._eventFunction[t]===e||this._eventFunction[t].__originalFunc===e)&&(this._eventFunction[t]=void 0)}}removeListener(t,e){this.off(t,e)}emit(t,e,i,s){if(this._hasEventListeners){const r=this._eventFunction[t];r&&(r===J.combiner?r(this,t,e,i,s):r(e,i,s))}}listenerCount(t){if(this._hasEventListeners){const e=this._eventFunction[t];if(e)return e===J.combiner?this._eventListeners[t].length:1}return 0}removeAllListeners(t){this._hasEventListeners&&(delete this._eventFunction[t],delete this._eventListeners[t])}}J.combiner=function(n,t,e,i,s){const r=n._eventListeners[t];if(r)for(const o of[...r])o(e,i,s)};J.addAsMixin=function(n){n.prototype.on=J.prototype.on,n.prototype.once=J.prototype.once,n.prototype.has=J.prototype.has,n.prototype.off=J.prototype.off,n.prototype.removeListener=J.prototype.removeListener,n.prototype.emit=J.prototype.emit,n.prototype.listenerCount=J.prototype.listenerCount,n.prototype.removeAllListeners=J.prototype.removeAllListeners};class Ii{constructor(t){this._initialized=!1,this.ctx=t,this._elements=new Set}static create(t,e){let i;if(b.isObjectLiteral(e))e.type?i=t.renderer.createShader(t.ctx,e):i=this.shader,i&&xt.patchObject(i,e);else if(e===null)i=t.ctx.renderState.defaultShader;else if(e===void 0)i=null;else if(e.isShader)t.renderer.isValidShaderType(e.constructor)||(console.error("[Lightning] Invalid shader type"),e=null),i=e;else{console.error("[Lightning] Please specify a shader type.");return}return i}static getWebGL(){}static getC2d(){}addElement(t){this._elements.add(t)}removeElement(t){this._elements.delete(t),this._elements||this.cleanup()}redraw(){this._elements.forEach(t=>{t.setHasRenderUpdates(2)})}patch(t){xt.patchObject(this,t)}useDefault(){return!1}addEmpty(){return!1}cleanup(){}get isShader(){return!0}}class Bt{constructor(t){this.stage=t,this.manager=this.stage.textureManager,this.id=Bt.id++,this.elements=new Set,this._activeCount=0,this._source=null,this._resizeMode=null,this._x=0,this._y=0,this._w=0,this._h=0,this._precision=1,this.mw=0,this.mh=0,this.clipping=!1,this._mustUpdate=!0}get source(){return(this._mustUpdate||this.stage.hasUpdateSourceTexture(this))&&(this._performUpdateSource(!0),this.stage.removeUpdateSourceTexture(this)),this._source}addElement(t){this.elements.has(t)||(this.elements.add(t),this.elements.size===1&&this._source&&this._source.addTexture(this),t.active&&this.incActiveCount())}removeElement(t){this.elements.delete(t)&&(this.elements.size===0&&this._source&&this._source.removeTexture(this),t.active&&this.decActiveCount())}incActiveCount(){this.source&&this._checkForNewerReusableTextureSource(),this._activeCount++,this._activeCount===1&&this.becomesUsed()}decActiveCount(){this.source,this._activeCount--,this._activeCount||this.becomesUnused()}becomesUsed(){this.source&&this.source.incActiveTextureCount()}onLoad(){this._resizeMode&&this._applyResizeMode(),this.elements.forEach(t=>{t.active&&t.onTextureSourceLoaded()})}_checkForNewerReusableTextureSource(){const t=this.source;if(t.isLoaded())this._resizeMode&&this._applyResizeMode();else{const e=this._getReusableTextureSource();e&&e.isLoaded()&&e!==t&&this._replaceTextureSource(e)}}becomesUnused(){this.source&&this.source.decActiveTextureCount()}isUsed(){return this._activeCount>0}_getLookupId(){return null}_getSourceLoader(){throw new Error("Texture.generate must be implemented.")}get isValid(){return this._getIsValid()}_getIsValid(){return!0}_changed(){this.isUsed()?this._updateSource():this._mustUpdate=!0}_updateSource(){this.stage.addUpdateSourceTexture(this)}_performUpdateSource(t=!1){if(t||this.isUsed()){this._mustUpdate=!1;let e=this._getTextureSource();this._replaceTextureSource(e)}}_getTextureSource(){let t=null;if(this._getIsValid()){const e=this._getLookupId();t=this._getReusableTextureSource(e),t||(t=this.manager.getTextureSource(this._getSourceLoader(),e))}return t}_getReusableTextureSource(t=this._getLookupId()){return this._getIsValid()&&t?this.manager.getReusableTextureSource(t):null}_replaceTextureSource(t=null){let e=this._source;if(this._source=t,this.elements.size&&(e&&(this._activeCount&&e.decActiveTextureCount(),e.removeTexture(this),this.text&&!e.isUsed()&&this.manager.freeTextureSource(e)),t&&(t.addTexture(this),this._activeCount&&t.incActiveTextureCount())),this.isUsed())if(t)if(t.isLoaded())this._resizeMode&&this._applyResizeMode(),this.elements.forEach(i=>{i.active&&i._setDisplayedTexture(this)});else{const i=t.loadError;i&&this.elements.forEach(s=>{s.active&&s.onTextureSourceLoadError(i)})}else this.elements.forEach(i=>{i.active&&i._setDisplayedTexture(null)})}load(){this.source&&(this.isLoaded()||this.source.load(!0))}isLoaded(){return this._source&&this._source.isLoaded()}get loadError(){return this._source&&this._source.loadError}free(){this._source&&this._source.free()}set resizeMode({type:t="cover",w:e=0,h:i=0,clipX:s=.5,clipY:r=.5}){this._resizeMode={type:t,w:e,h:i,clipX:s,clipY:r},this.isLoaded()&&this._applyResizeMode()}get resizeMode(){return this._resizeMode}_clearResizeMode(){this._resizeMode=null}_applyResizeMode(){this._resizeMode.type==="cover"?this._applyResizeCover():this._resizeMode.type==="contain"&&this._applyResizeContain(),this._updatePrecision(),this._updateClipping()}_applyResizeCover(){const t=this._resizeMode.w/this._source.w,e=this._resizeMode.h/this._source.h;let i=Math.max(t,e);if(i){if(this._precision=1/i,t&&t<i){const s=this._precision*this._resizeMode.w,r=this._source.w-s;this._x=r*this._resizeMode.clipX,this._w=this._source.w-r}if(e&&e<i){const s=this._precision*this._resizeMode.h,r=this._source.h-s;this._y=r*this._resizeMode.clipY,this._h=this._source.h-r}}}_applyResizeContain(){const t=this._resizeMode.w/this._source.w,e=this._resizeMode.h/this._source.h;let i=t;(!i||e<i)&&(i=e),i&&(this._precision=1/i)}enableClipping(t,e,i,s){this._clearResizeMode(),t*=this._precision,e*=this._precision,i*=this._precision,s*=this._precision,(this._x!==t||this._y!==e||this._w!==i||this._h!==s)&&(this._x=t,this._y=e,this._w=i,this._h=s,this._updateClipping(!0))}disableClipping(){this._clearResizeMode(),(this._x||this._y||this._w||this._h)&&(this._x=0,this._y=0,this._w=0,this._h=0,this._updateClipping())}_updateClipping(){this.clipping=!!(this._x||this._y||this._w||this._h);let t=this;this.elements.forEach(function(e){e.displayedTexture===t&&e.onDisplayedTextureClippingChanged()})}_updatePrecision(){let t=this;this.elements.forEach(function(e){e.displayedTexture===t&&e.onPrecisionChanged()})}getNonDefaults(){let t={};return t.type=this.constructor.name,this.x!==0&&(t.x=this.x),this.y!==0&&(t.y=this.y),this.w!==0&&(t.w=this.w),this.h!==0&&(t.h=this.h),this.precision!==1&&(t.precision=this.precision),t}get px(){return this._x}get py(){return this._y}get pw(){return this._w}get ph(){return this._h}get x(){return this._x/this._precision}set x(t){this._clearResizeMode(),t=t*this._precision,this._x!==t&&(this._x=t,this._updateClipping())}get y(){return this._y/this._precision}set y(t){this._clearResizeMode(),t=t*this._precision,this._y!==t&&(this._y=t,this._updateClipping())}get w(){return this._w/this._precision}set w(t){this._clearResizeMode(),t=t*this._precision,this._w!==t&&(this._w=t,this._updateClipping())}get h(){return this._h/this._precision}set h(t){this._clearResizeMode(),t=t*this._precision,this._h!==t&&(this._h=t,this._updateClipping())}get precision(){return this._precision}set precision(t){this._clearResizeMode(),this._precision!==t&&(this._precision=t,this._updatePrecision())}isAutosizeTexture(){return!0}getRenderWidth(){return this.isAutosizeTexture()?(this._w||(this._source?this._source.getRenderWidth()-this._x:0))/this._precision:0}getRenderHeight(){return this.isAutosizeTexture()?(this._h||(this._source?this._source.getRenderHeight()-this._y:0))/this._precision:0}patch(t){xt.patchObject(this,t)}}Bt.prototype.isTexture=!0;Bt.id=0;class xr extends Bt{constructor(t){super(t),this._src=void 0,this._hasAlpha=!1}get src(){return this._src}set src(t){this._src!==t&&(this._src=t,this._changed())}get hasAlpha(){return this._hasAlpha}set hasAlpha(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._changed())}_getIsValid(){return!!this._src}_getLookupId(){return this._src}_getSourceLoader(){let t=this._src,e=this._hasAlpha;if(this.stage.getOption("srcBasePath")){var i=t.charCodeAt(0);t.indexOf("//")===-1&&(i>=65&&i<=90||i>=97&&i<=122||i==46)&&(t=this.stage.getOption("srcBasePath")+t)}return s=>this.stage.platform.loadSrcTexture({src:t,hasAlpha:e},s)}getNonDefaults(){const t=super.getNonDefaults();return this._src&&(t.src=this._src),t}}function ds(n,t,e,i,s){let r=n;Array.isArray(r)||(r=[r]);let o=[];for(let a=0,h=r.length;a<h;a++){let l=r[a];l===null&&(l=s),l==="serif"||l==="sans-serif"?o.push(l):o.push('"'.concat(l,'"'))}return"".concat(t," ").concat(e*i,"px ").concat(o.join(","))}function jo(n){return n===""||n==="​"}function Nn(n){return jo(n)||n===" "}function Pu(n,t){const e=t.match(n)||[],i=t.split(n)||[];let s=[];for(let r=0;r<i.length;r++)s.push(i[r],e[r]);return s.pop(),s.filter(r=>r!="")}function fs(n,t,e=0){return e?t.split("").reduce((i,s)=>jo(s)?i:i+n.measureText(s).width+e,0):n.measureText(t).width}function Fu(n,t,e,i,s){const r=/ |\u200B/g;let o=t.split(/\r?\n/g),a=[],h=[];for(let l=0;l<o.length;l++){let c=[],u="",d=e-s,g=o[l].split(r),_=o[l].match(r)||[];for(let f=0;f<g.length;f++){const y=_[f-1]||"",T=g[f],x=fs(n,T,i),m=x+fs(n,y,i);f===0||m>d?(f>0&&(c.push(u),u=""),u+=T,d=e-x-(f===0?s:0)):(d-=m,u+=y+T)}c.push(u),u="",a=a.concat(c),l<o.length-1&&h.push(a.length)}return{l:a,n:h}}class Hn{constructor(t,e,i){this._stage=t,this._canvas=e,this._context=this._canvas.getContext("2d"),this._settings=i}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=ds(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace")),this._context.textBaseline=this._settings.textBaseline}_load(){if(b.isWeb&&document.fonts){const t=ds(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch(e=>{console.warn("[Lightning] Font load error",e,t)}).then(()=>{document.fonts.check(t,this._settings.text)||console.warn("[Lightning] Font not found",t)})}catch(e){console.warn("[Lightning] Can't check font loading for "+t)}}}draw(){const t=this._load();return t?t.then(()=>b.isSpark?this._stage.platform.drawText(this):this._draw()):b.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){let t={};const e=this.getPrecision(),i=this._settings.paddingLeft*e,s=this._settings.paddingRight*e,r=this._settings.fontSize*e;let o=this._settings.offsetY===null?null:this._settings.offsetY*e,a=this._settings.lineHeight*e;const h=this._settings.w*e,l=this._settings.h*e;let c=this._settings.wordWrapWidth*e;const u=this._settings.cutSx*e,d=this._settings.cutEx*e,g=this._settings.cutSy*e,_=this._settings.cutEy*e,f=(this._settings.letterSpacing||0)*e,y=this._settings.textIndent*e;this.setFontProperties();let T=h||this._stage.getOption("w"),x=T-i;if(x<10&&(T+=10-x,x=10),c||(c=x),this._settings.textOverflow&&!this._settings.wordWrap){let S;switch(this._settings.textOverflow){case"clip":S="";break;case"ellipsis":S=this._settings.maxLinesSuffix;break;default:S=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,c-y,S)}let m;if(this._settings.wordWrap)m=this.wrapText(this._settings.text,c,f,y);else{m={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};let S=m.l.length;for(let A=0;A<S-1;A++)m.n.push(A)}let p=m.l;if(this._settings.maxLines&&p.length>this._settings.maxLines){let S=p.slice(0,this._settings.maxLines),A=null;if(this._settings.maxLinesSuffix){let V=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,j=this.wrapText(S[S.length-1],c-V,f,y);S[S.length-1]=j.l[0]+this._settings.maxLinesSuffix,A=[j.l.length>1?j.l[1]:""]}else A=[""];let E,F=p.length,L=0,k=m.n.length;for(E=this._settings.maxLines;E<F;E++)A[L]+=(A[L]?" ":"")+p[E],E+1<k&&m.n[E+1]&&L++;t.remainingText=A.join("\n"),t.moreTextLines=!0,p=S}else t.moreTextLines=!1,t.remainingText="";let w=0,R=[];for(let S=0;S<p.length;S++){let A=this.measureText(p[S],f)+(S===0?y:0);R.push(A),w=Math.max(w,A)}t.lineWidths=R,h||(T=w+i+s,x=w),a=a||r;let I;if(l)I=l;else{const S=this._settings.textBaseline!="bottom"?.5*r:0;I=a*(p.length-1)+S+Math.max(a,r)+o}return o===null&&(o=r),t.w=T,t.h=I,t.lines=p,t.precision=e,T||(T=1),I||(I=1),(u||d)&&(T=Math.min(T,d-u)),(g||_)&&(I=Math.min(I,_-g)),t.width=T,t.innerWidth=x,t.height=I,t.fontSize=r,t.cutSx=u,t.cutSy=g,t.cutEx=d,t.cutEy=_,t.lineHeight=a,t.lineWidths=R,t.offsetY=o,t.paddingLeft=i,t.paddingRight=s,t.letterSpacing=f,t.textIndent=y,t}_draw(){const t=this._calculateRenderInfo(),e=this.getPrecision();this._canvas.width=Math.ceil(t.width+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(t.height),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy);let i,s,r=[];for(let a=0,h=t.lines.length;a<h;a++)i=a===0?t.textIndent:0,s=a*t.lineHeight+t.offsetY,this._settings.verticalAlign=="middle"?s+=(t.lineHeight-t.fontSize)/2:this._settings.verticalAlign=="bottom"&&(s+=t.lineHeight-t.fontSize),this._settings.textAlign==="right"?i+=t.innerWidth-t.lineWidths[a]:this._settings.textAlign==="center"&&(i+=(t.innerWidth-t.lineWidths[a])/2),i+=t.paddingLeft,r.push({text:t.lines[a],x:i,y:s,w:t.lineWidths[a]});if(this._settings.highlight){let a=this._settings.highlightColor||0,h=this._settings.highlightHeight*e||t.fontSize*1.5;const l=this._settings.highlightOffset*e,c=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*e:t.paddingLeft,u=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*e:t.paddingRight;this._context.fillStyle=M.getRgbaString(a);for(let d=0;d<r.length;d++){let g=r[d];this._context.fillRect(g.x-c,g.y-t.offsetY+l,g.w+u+c,h)}}let o=null;this._settings.shadow&&(o=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=M.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*e,this._context.shadowOffsetY=this._settings.shadowOffsetY*e,this._context.shadowBlur=this._settings.shadowBlur*e),this._context.fillStyle=M.getRgbaString(this._settings.textColor);for(let a=0,h=r.length;a<h;a++){let l=r[a];if(t.letterSpacing===0)this._context.fillText(l.text,l.x,l.y);else{const c=l.text.split("");let u=l.x;for(let d=0,g=c.length;d<g;d++)this._context.fillText(c[d],u,l.y),u+=this.measureText(c[d],t.letterSpacing)}}o&&(this._context.shadowColor=o[0],this._context.shadowOffsetX=o[1],this._context.shadowOffsetY=o[2],this._context.shadowBlur=o[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),this.renderInfo=t}wrapWord(t,e,i){const s=this.measureText(i),r=t.length,o=this.measureText(t);if(o<=e)return t;let a=Math.floor(e*r/o),h=this.measureText(t.substring(0,a))+s;if(h>e)for(;a>0&&(h=this.measureText(t.substring(0,a))+s,h>e);)a-=1;else for(;a<r;)if(h=this.measureText(t.substring(0,a))+s,h<e)a+=1;else{a-=1;break}return t.substring(0,a)+(e>=s?i:"")}wrapText(t,e,i,s=0){return Fu(this._context,t,e,i,s)}measureText(t,e=0){return fs(this._context,t,e)}}class Wn{constructor(t,e,i){this._stage=t,this._canvas=e,this._context=this._canvas.getContext("2d"),this._settings=i}getPrecision(){return this._settings.precision}setFontProperties(){const t=ds(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));return this._context.font=t,this._context.textBaseline=this._settings.textBaseline,t}_load(){if(b.isWeb&&document.fonts){const t=ds(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch(e=>{console.warn("Font load error",e,t)}).then(()=>{document.fonts.check(t,this._settings.text)||console.warn("Font not found",t)})}catch(e){console.warn("Can't check font loading for "+t)}}}draw(){const t=this._load();return t?t.then(()=>b.isSpark?this._stage.platform.drawText(this):this._draw()):b.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){let t={};const e=this.getPrecision(),i=this._settings.paddingLeft*e,s=this._settings.paddingRight*e,r=this._settings.fontSize*e,o=this._settings.lineHeight*e||r,a=this._settings.w!=0?this._settings.w*e:this._stage.getOption("w"),h=this._settings.wordWrapWidth*e,l=this._settings.cutSx*e,c=this._settings.cutEx*e,u=this._settings.cutSy*e,d=this._settings.cutEy*e,g=this._settings.letterSpacing||0;t.baseFont=this.setFontProperties(),t.w=a,t.width=a,t.text=this._settings.text,t.precision=e,t.fontSize=r,t.fontBaselineRatio=this._settings.fontBaselineRatio,t.lineHeight=o,t.letterSpacing=g,t.textAlign=this._settings.textAlign,t.textColor=this._settings.textColor,t.verticalAlign=this._settings.verticalAlign,t.highlight=this._settings.highlight,t.highlightColor=this._settings.highlightColor,t.highlightHeight=this._settings.highlightHeight,t.highlightPaddingLeft=this._settings.highlightPaddingLeft,t.highlightPaddingRight=this._settings.highlightPaddingRight,t.highlightOffset=this._settings.highlightOffset,t.paddingLeft=this._settings.paddingLeft,t.paddingRight=this._settings.paddingRight,t.maxLines=this._settings.maxLines,t.maxLinesSuffix=this._settings.maxLinesSuffix,t.textOverflow=this._settings.textOverflow,t.wordWrap=this._settings.wordWrap,t.wordWrapWidth=h,t.shadow=this._settings.shadow,t.shadowColor=this._settings.shadowColor,t.shadowOffsetX=this._settings.shadowOffsetX,t.shadowOffsetY=this._settings.shadowOffsetY,t.shadowBlur=this._settings.shadowBlur,t.cutSx=l,t.cutEx=c,t.cutSy=u,t.cutEy=d,t.textIndent=this._settings.textIndent*e,t.wordBreak=this._settings.wordBreak;let _=t.text,f=t.wordWrap&&t.wordWrapWidth||t.width;if(t.textOverflow&&!t.wordWrap){let p;switch(this._settings.textOverflow){case"clip":p="";break;case"ellipsis":p=this._settings.maxLinesSuffix;break;default:p=this._settings.textOverflow}_=this.wrapWord(_,h||t.w,p)}_=this.tokenize(_),_=this.parse(_),_=this.measure(_,g,t.baseFont),t.textIndent&&(_=this.indent(_,t.textIndent)),t.wordBreak&&(_=_.reduce((p,w)=>p.concat(this.wordBreak(w,f,t.baseFont)),[]),this.resetFontStyle());let y=i,T=0;for(const p of _)(t.wordWrap&&y+p.width>f||p.text=="\n")&&(y=i,T+=1),p.lineNo=T,p.text!="\n"&&(p.x=y,y+=p.width);t.lineNum=T+1,this._settings.h?t.h=this._settings.h:t.maxLines&&t.maxLines<t.lineNum?t.h=t.maxLines*t.lineHeight+r/2:t.h=t.lineNum*t.lineHeight+r/2;const x=t.fontBaselineRatio*t.fontSize;let m=0;t.verticalAlign=="top"&&this._context.textBaseline=="alphabetic"?m=-x:t.verticalAlign=="middle"?m=(t.lineHeight-t.fontSize-x)/2:this._settings.verticalAlign=="bottom"&&(m=t.lineHeight-t.fontSize),t.lines=[];for(let p=0;p<t.lineNum;p++)t.lines[p]={width:0,x:0,y:t.lineHeight*p+m,text:[]};for(let p of _)t.lines[p.lineNo].text.push(p);for(const p of t.lines){if(p.text.length==0)continue;const w=p.text[0].text,R=p.text[p.text.length-1].text;w=="\n"&&p.text.shift(),(Nn(R)||R=="\n")&&p.text.pop()}for(let p of t.lines)p.width=p.text.reduce((w,R)=>w+R.width,0);if(t.width=this._settings.w!=0?this._settings.w*e:Math.max(...t.lines.map(p=>p.width))+s,t.w=t.width,t.maxLines&&t.lineNum>t.maxLines&&t.maxLinesSuffix){const p=t.maxLines-1;let w=_.filter(A=>A.lineNo==p),R=t.maxLinesSuffix;R=this.tokenize(R),R=this.parse(R),R=this.measure(R,t.letterSpacing,t.baseFont);for(const A of R)A.lineNo=p,A.x=0,w.push(A);const I=R.length+1;let S=w.reduce((A,E)=>A+E.width,0);for(;(S>t.width||Nn(w[w.length-I].text))&&(w.splice(w.length-I,1),S=w.reduce((A,E)=>A+E.width,0),!(w.length<I)););this.alignLine(w,w[0].x),t.lines[p].text=w,t.lines[p].width=S}if(t.textAlign=="center")for(let p of t.lines)p.x=(t.width-p.width-i)/2;else if(t.textAlign=="right")for(let p of t.lines)p.x=t.width-p.width-i;return t}_draw(){const t=this._calculateRenderInfo(),e=this.getPrecision(),i=t.paddingLeft*e;let s=t.w||t.width;(t.cutSx||t.cutEx)&&(s=Math.min(t.w,t.cutEx-t.cutSx));let r=t.h;if((t.cutSy||t.cutEy)&&(r=Math.min(t.h,t.cutEy-t.cutSy)),this._canvas.width=Math.ceil(s+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(r),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy),t.highlight){const l=t.highlightColor||0,c=t.highlightHeight?t.highlightHeight*e:t.fontSize*1.5,u=t.highlightOffset?t.highlightOffset*e:0,d=t.highlightPaddingLeft!==null?t.highlightPaddingLeft*e:t.paddingLeft,g=t.highlightPaddingRight!==null?t.highlightPaddingRight*e:t.paddingRight;this._context.fillStyle=M.getRgbaString(l);const _=t.maxLines?Math.min(t.maxLines,t.lineNum):t.lineNum;for(let f=0;f<_;f++){const y=t.lines[f];this._context.fillRect(y.x-d+i,y.y+u,y.width+d+g,c)}}let o=null;this._settings.shadow&&(o=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=M.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*e,this._context.shadowOffsetY=this._settings.shadowOffsetY*e,this._context.shadowBlur=this._settings.shadowBlur*e);const a=M.getRgbaString(this._settings.textColor);let h=a;this._context.fillStyle=a;for(const l of t.lines)for(const c of l.text){let u=0;if(c.text!="\n"&&!(t.maxLines&&c.lineNo>=t.maxLines))if(c.color!=h&&(h=c.color,this._context.fillStyle=h),this._context.font=c.fontStyle,c.letters)for(let d of c.letters){const g=t.lines[c.lineNo].x+c.x+u;this._context.fillText(d.text,g,t.lines[c.lineNo].y+t.fontSize),u+=d.width}else{const d=t.lines[c.lineNo].x+c.x;this._context.fillText(c.text,d,t.lines[c.lineNo].y+t.fontSize)}}o&&(this._context.shadowColor=o[0],this._context.shadowOffsetX=o[1],this._context.shadowOffsetY=o[2],this._context.shadowBlur=o[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),t.lines=t.lines.map(l=>l.text.reduce((c,u)=>c+u.text,"")),t.maxLines&&(t.lines=t.lines.slice(0,t.maxLines)),this.renderInfo=t}measureText(t,e=0){return fs(this._context,t,e)}tokenize(t){return Pu(/ |\u200B|\n|<i>|<\/i>|<b>|<\/b>|<color=0[xX][0-9a-fA-F]{8}>|<\/color>/g,t)}parse(t){let e=0,i=0,s=[M.getRgbaString(this._settings.textColor)],r=0;const o=/<color=(0[xX][0-9a-fA-F]{8})>/;return t.map(a=>{if(a=="<i>")e+=1,a="";else if(a=="</i>"&&e>0)e-=1,a="";else if(a=="<b>")i+=1,a="";else if(a=="</b>"&&i>0)i-=1,a="";else if(a=="</color>")s.length>1&&(r-=1,s.pop()),a="";else if(o.test(a)){const h=o.exec(a);s.push(M.getRgbaString(parseInt(h[1]))),r+=1,a=""}return{text:a,italic:e,bold:i,color:s[r]}}).filter(a=>a.text!="")}applyFontStyle(t,e){let i=e;t.bold&&(i="bold "+i),t.italic&&(i="italic "+i),this._context.font=i,t.fontStyle=i}resetFontStyle(t){this._context.font=t}measure(t,e=0,i){for(const s of t)if(this.applyFontStyle(s,i),s.width=this.measureText(s.text,e),e>0){s.letters=s.text.split("").map(r=>({text:r}));for(let r of s.letters)r.width=this.measureText(r.text,e)}return this.resetFontStyle(i),t}indent(t,e){return t.splice(0,0,{text:"",width:e}),t}wrapWord(t,e,i){const s=this.measureText(i),r=t.length,o=this.measureText(t);if(o<=e)return t;let a=Math.floor(e*r/o),h=this.measureText(t.substring(0,a))+s;if(h>e)for(;a>0&&(h=this.measureText(t.substring(0,a))+s,h>e);)a-=1;else for(;a<r;)if(h=this.measureText(t.substring(0,a))+s,h<e)a+=1;else{a-=1;break}return t.substring(0,a)+(e>=s?i:"")}_getBreakIndex(t,e){const i=t.length,s=this.measureText(t);if(s<=e)return{breakIndex:t.length,truncWordWidth:s};let r=Math.floor(e*i/s),o=this.measureText(t.substring(0,r));if(o>e)for(;r>0&&(o=this.measureText(t.substring(0,r)),o>e);)r-=1;else for(;r<i;)if(o=this.measureText(t.substring(0,r)),o<e)r+=1;else{r-=1,o=this.measureText(t.substring(0,r));break}return{breakIndex:r,truncWordWidth:o}}wordBreak(t,e,i){if(!t.text)return t;this.applyFontStyle(t,i);const s=[];let r=t.text;if(t.letters){let o=0,a=[],h=0;for(const l of t.letters)o+l.width>=e?(s.push({...t}),s[s.length-1].text=r.slice(0,h),s[s.length-1].width=o,s[s.length-1].letters=a,r=r.slice(h),o=0,a=[],h=0):(h+=1,a.push(l),o+=l.width);o>0&&(s.push({...t}),s[s.length-1].text=r.slice(0,h),s[s.length-1].width=o,s[s.length-1].letters=a)}else for(;;){const{breakIndex:o,truncWordWidth:a}=this._getBreakIndex(r,e);if(s.push({...t}),s[s.length-1].text=r.slice(0,o),s[s.length-1].width=a,o===r.length)break;r=r.slice(o)}return s}alignLine(t,e=0){let i=0,s=e;for(const r of t)r.text!="\n"&&(r.x=s+i,s=r.x,i=r.width)}}class Fe extends Bt{constructor(t){super(t),this._precision=this.stage.getOption("precision")}static renderer(t,e,i){return this.advancedRenderer?new Wn(t,e,i):new Hn(t,e,i)}get text(){return this._text}set text(t){this._text!==t&&(this._text=""+t,this._changed())}get w(){return this._w}set w(t){this._w!==t&&(this._w=t,this._changed())}get h(){return this._h}set h(t){this._h!==t&&(this._h=t,this._changed())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this._changed())}get fontBaselineRatio(){return this._fontBaselineRatio}set fontBaselineRatio(t){this._fontBaselineRatio!==t&&(this._fontBaselineRatio=t,this._changed())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this._changed())}get fontFace(){return this._fontFace}set fontFace(t){this._fontFace!==t&&(this._fontFace=t,this._changed())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this._changed())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this._changed())}get wordBreak(){return this._wordBreak}set wordBreak(t){this._wordBreak!==t&&(this._wordBreak=t,this._changed())}get textOverflow(){return this._textOverflow}set textOverflow(t){t!=this._textOverflow&&(this._textOverflow=t,this._changed())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this._changed())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this._changed())}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign!==t&&(this._textAlign=t,this._changed())}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._changed())}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY!==t&&(this._offsetY=t,this._changed())}get maxLines(){return this._maxLines}set maxLines(t){this._maxLines!==t&&(this._maxLines=t,this._changed())}get maxLinesSuffix(){return this._maxLinesSuffix}set maxLinesSuffix(t){this._maxLinesSuffix!==t&&(this._maxLinesSuffix=t,this._changed())}get textColor(){return this._textColor}set textColor(t){this._textColor!==t&&(this._textColor=t,this._changed())}get paddingLeft(){return this._paddingLeft}set paddingLeft(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._changed())}get paddingRight(){return this._paddingRight}set paddingRight(t){this._paddingRight!==t&&(this._paddingRight=t,this._changed())}get shadow(){return this._shadow}set shadow(t){this._shadow!==t&&(this._shadow=t,this._changed())}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!==t&&(this._shadowColor=t,this._changed())}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._changed())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._changed())}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._changed())}get highlight(){return this._highlight}set highlight(t){this._highlight!==t&&(this._highlight=t,this._changed())}get highlightHeight(){return this._highlightHeight}set highlightHeight(t){this._highlightHeight!==t&&(this._highlightHeight=t,this._changed())}get highlightColor(){return this._highlightColor}set highlightColor(t){this._highlightColor!==t&&(this._highlightColor=t,this._changed())}get highlightOffset(){return this._highlightOffset}set highlightOffset(t){this._highlightOffset!==t&&(this._highlightOffset=t,this._changed())}get highlightPaddingLeft(){return this._highlightPaddingLeft}set highlightPaddingLeft(t){this._highlightPaddingLeft!==t&&(this._highlightPaddingLeft=t,this._changed())}get highlightPaddingRight(){return this._highlightPaddingRight}set highlightPaddingRight(t){this._highlightPaddingRight!==t&&(this._highlightPaddingRight=t,this._changed())}get cutSx(){return this._cutSx}set cutSx(t){this._cutSx!==t&&(this._cutSx=t,this._changed())}get cutEx(){return this._cutEx}set cutEx(t){this._cutEx!==t&&(this._cutEx=t,this._changed())}get cutSy(){return this._cutSy}set cutSy(t){this._cutSy!==t&&(this._cutSy=t,this._changed())}get cutEy(){return this._cutEy}set cutEy(t){this._cutEy!==t&&(this._cutEy=t,this._changed())}get advancedRenderer(){return this._advancedRenderer}set advancedRenderer(t){this._advancedRenderer!==t&&(this._advancedRenderer=t,this._changed())}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this._changed())}get letterSpacing(){return this._letterSpacing}set textIndent(t){this._textIndent!==t&&(this._textIndent=t,this._changed())}get textIndent(){return this._textIndent}get precision(){return super.precision}set precision(t){this.precision!==t&&(super.precision=t,this._changed())}_getIsValid(){return!!this.text}_getLookupId(){let t=[];return this.w!==0&&t.push("w "+this.w),this.h!==0&&t.push("h "+this.h),this.fontStyle!=="normal"&&t.push("fS"+this.fontStyle),this.fontSize!==40&&t.push("fs"+this.fontSize),this.fontBaselineRatio!==0&&t.push("fb"+this.fontBaselineRatio),this.fontFace!==null&&t.push("ff"+(Array.isArray(this.fontFace)?this.fontFace.join(","):this.fontFace)),this.wordWrap!==!0&&t.push("wr"+(this.wordWrap?1:0)),this.wordWrapWidth!==0&&t.push("ww"+this.wordWrapWidth),this.wordBreak!==!1&&t.push("wb"+this.wordBreak?1:0),this.textOverflow!=""&&t.push("to"+this.textOverflow),this.lineHeight!==null&&t.push("lh"+this.lineHeight),this.textBaseline!=="alphabetic"&&t.push("tb"+this.textBaseline),this.textAlign!=="left"&&t.push("ta"+this.textAlign),this.verticalAlign!=="top"&&t.push("va"+this.verticalAlign),this.offsetY!==null&&t.push("oy"+this.offsetY),this.maxLines!==0&&t.push("ml"+this.maxLines),this.maxLinesSuffix!==".."&&t.push("ms"+this.maxLinesSuffix),t.push("pc"+this.precision),this.textColor!==4294967295&&t.push("co"+this.textColor.toString(16)),this.paddingLeft!==0&&t.push("pl"+this.paddingLeft),this.paddingRight!==0&&t.push("pr"+this.paddingRight),this.shadow!==!1&&t.push("sh"+(this.shadow?1:0)),this.shadowColor!==4278190080&&t.push("sc"+this.shadowColor.toString(16)),this.shadowOffsetX!==0&&t.push("sx"+this.shadowOffsetX),this.shadowOffsetY!==0&&t.push("sy"+this.shadowOffsetY),this.shadowBlur!==5&&t.push("sb"+this.shadowBlur),this.highlight!==!1&&t.push("hL"+(this.highlight?1:0)),this.highlightHeight!==0&&t.push("hh"+this.highlightHeight),this.highlightColor!==4278190080&&t.push("hc"+this.highlightColor.toString(16)),this.highlightOffset!==null&&t.push("ho"+this.highlightOffset),this.highlightPaddingLeft!==null&&t.push("hl"+this.highlightPaddingLeft),this.highlightPaddingRight!==null&&t.push("hr"+this.highlightPaddingRight),this.letterSpacing!==null&&t.push("ls"+this.letterSpacing),this.textIndent!==null&&t.push("ti"+this.textIndent),this.cutSx&&t.push("csx"+this.cutSx),this.cutEx&&t.push("cex"+this.cutEx),this.cutSy&&t.push("csy"+this.cutSy),this.cutEy&&t.push("cey"+this.cutEy),this.advancedRenderer&&t.push("aR"+this.advancedRenderer?1:0),"TX$"+t.join("|")+":"+this.text}_getSourceLoader(){const t=this.cloneArgs(),e=this.stage.gl;return function(i){const s=this.stage.platform.getDrawingCanvas(),r=t.advancedRenderer?new Wn(this.stage,s,t):new Hn(this.stage,s,t),o=r.draw(),a={},h=this.stage.getOption("fontSharp");let l=!1;b.isBoolean(h)?l=h:b.isObject(h)&&(l=this.stage.getRenderPrecision()<=h.precision&&t.fontSize<=h.fontSize),e&&l&&(a[e.TEXTURE_MAG_FILTER]=e.NEAREST),o?o.then(()=>{i(null,Object.assign({renderInfo:r.renderInfo,throttle:!1,texParams:a},this.stage.platform.getTextureOptionsForDrawingCanvas(s)))}).catch(c=>{i(c)}):i(null,Object.assign({renderInfo:r.renderInfo,throttle:!1,texParams:a},this.stage.platform.getTextureOptionsForDrawingCanvas(s)))}}getNonDefaults(){const t=super.getNonDefaults();return this.text!==""&&(t.text=this.text),this.w!==0&&(t.w=this.w),this.h!==0&&(t.h=this.h),this.fontStyle!=="normal"&&(t.fontStyle=this.fontStyle),this.fontSize!==40&&(t.fontSize=this.fontSize),this.fontBaselineRatio!==0&&(t.fontBaselineRatio=this.fontBaselineRatio),this.fontFace!==null&&(t.fontFace=this.fontFace),this.wordWrap!==!0&&(t.wordWrap=this.wordWrap),this.wordWrapWidth!==0&&(t.wordWrapWidth=this.wordWrapWidth),this.wordBreak!==!1&&(t.wordBreak=this.wordBreak),this.textOverflow!=""&&(t.textOverflow=this.textOverflow),this.lineHeight!==null&&(t.lineHeight=this.lineHeight),this.textBaseline!=="alphabetic"&&(t.textBaseline=this.textBaseline),this.textAlign!=="left"&&(t.textAlign=this.textAlign),this.verticalAlign!=="top"&&(t.verticalAlign=this.verticalAlign),this.offsetY!==null&&(t.offsetY=this.offsetY),this.maxLines!==0&&(t.maxLines=this.maxLines),this.maxLinesSuffix!==".."&&(t.maxLinesSuffix=this.maxLinesSuffix),this.precision!==this.stage.getOption("precision")&&(t.precision=this.precision),this.textColor!==4294967295&&(t.textColor=this.textColor),this.paddingLeft!==0&&(t.paddingLeft=this.paddingLeft),this.paddingRight!==0&&(t.paddingRight=this.paddingRight),this.shadow!==!1&&(t.shadow=this.shadow),this.shadowColor!==4278190080&&(t.shadowColor=this.shadowColor),this.shadowOffsetX!==0&&(t.shadowOffsetX=this.shadowOffsetX),this.shadowOffsetY!==0&&(t.shadowOffsetY=this.shadowOffsetY),this.shadowBlur!==5&&(t.shadowBlur=this.shadowBlur),this.highlight!==!1&&(t.highlight=this.highlight),this.highlightHeight!==0&&(t.highlightHeight=this.highlightHeight),this.highlightColor!==4278190080&&(t.highlightColor=this.highlightColor),this.highlightOffset!==0&&(t.highlightOffset=this.highlightOffset),this.highlightPaddingLeft!==0&&(t.highlightPaddingLeft=this.highlightPaddingLeft),this.highlightPaddingRight!==0&&(t.highlightPaddingRight=this.highlightPaddingRight),this.letterSpacing!==0&&(t.letterSpacing=this.letterSpacing),this.textIndent!==0&&(t.textIndent=this.textIndent),this.cutSx&&(t.cutSx=this.cutSx),this.cutEx&&(t.cutEx=this.cutEx),this.cutSy&&(t.cutSy=this.cutSy),this.cutEy&&(t.cutEy=this.cutEy),this.advancedRenderer&&(t.renderer=this.advancedRenderer),t}cloneArgs(){let t={};return t.text=this._text,t.w=this._w,t.h=this._h,t.fontStyle=this._fontStyle,t.fontSize=this._fontSize,t.fontBaselineRatio=this._fontBaselineRatio,t.fontFace=this._fontFace,t.wordWrap=this._wordWrap,t.wordWrapWidth=this._wordWrapWidth,t.wordBreak=this._wordBreak,t.textOverflow=this._textOverflow,t.lineHeight=this._lineHeight,t.textBaseline=this._textBaseline,t.textAlign=this._textAlign,t.verticalAlign=this._verticalAlign,t.offsetY=this._offsetY,t.maxLines=this._maxLines,t.maxLinesSuffix=this._maxLinesSuffix,t.precision=this._precision,t.textColor=this._textColor,t.paddingLeft=this._paddingLeft,t.paddingRight=this._paddingRight,t.shadow=this._shadow,t.shadowColor=this._shadowColor,t.shadowOffsetX=this._shadowOffsetX,t.shadowOffsetY=this._shadowOffsetY,t.shadowBlur=this._shadowBlur,t.highlight=this._highlight,t.highlightHeight=this._highlightHeight,t.highlightColor=this._highlightColor,t.highlightOffset=this._highlightOffset,t.highlightPaddingLeft=this._highlightPaddingLeft,t.highlightPaddingRight=this._highlightPaddingRight,t.letterSpacing=this._letterSpacing,t.textIndent=this._textIndent,t.cutSx=this._cutSx,t.cutEx=this._cutEx,t.cutSy=this._cutSy,t.cutEy=this._cutEy,t.advancedRenderer=this._advancedRenderer,t}}let W=Fe.prototype;W._text="";W._w=0;W._h=0;W._fontStyle="normal";W._fontSize=40;W._fontFace=null;W._wordWrap=!0;W._wordWrapWidth=0;W._wordBreak=!1;W._textOverflow="";W._lineHeight=null;W._textBaseline="alphabetic";W._textAlign="left";W._verticalAlign="top";W._offsetY=null;W._maxLines=0;W._maxLinesSuffix="..";W._textColor=4294967295;W._paddingLeft=0;W._paddingRight=0;W._shadow=!1;W._shadowColor=4278190080;W._shadowOffsetX=0;W._shadowOffsetY=0;W._shadowBlur=5;W._highlight=!1;W._highlightHeight=0;W._highlightColor=4278190080;W._highlightOffset=0;W._highlightPaddingLeft=0;W._highlightPaddingRight=0;W._letterSpacing=0;W._textIndent=0;W._cutSx=0;W._cutEx=0;W._cutSy=0;W._cutEy=0;W._advancedRenderer=!1;W._fontBaselineRatio=0;class Vo extends Bt{constructor(t){super(t),this._textureSource=void 0}get textureSource(){return this._textureSource}set textureSource(t){t!==this._textureSource&&(t.isResultTexture&&(this._precision=this.stage.getRenderPrecision()),this._textureSource=t,this._changed())}_getTextureSource(){return this._textureSource}}class mr extends J{constructor(t,e,i,s){super(),this.manager=t,this._settings=e,this._element=i,this._getter=i.constructor.getGetter(s),this._setter=i.constructor.getSetter(s),this._merger=e.merger,this._merger||(this._merger=i.constructor.getMerger(s)),this._startValue=this._getter(this._element),this._targetValue=this._startValue,this._p=1,this._delayLeft=0}start(t){this._startValue=this._getter(this._element),this.isAttached()?t===this._startValue?this.reset(t,1):(this._targetValue=t,this._p=0,this._delayLeft=this._settings.delay,this.emit("start"),this.add()):(this._targetValue=t,this._p=1,this._updateDrawValue())}finish(){this._p<1&&(this._p=1)}stop(){this.emit("stop"),this.manager.removeActive(this)}pause(){this.stop()}play(){this.manager.addActive(this)}reset(t,e){this.isAttached()?(this._startValue=this._getter(this._element),this._targetValue=t,this._p=e,this.add()):(this._startValue=this._getter(this._element),this._targetValue=t,this._p=1,this._updateDrawValue())}_updateDrawValue(){this._setter(this._element,this.getDrawValue())}add(){this.manager.addActive(this)}isAttached(){return this._element.attached}isRunning(){return this._p<1}progress(t){if(this.isAttached()||(this._p=1),this.p<1){if(this.delayLeft>0)if(this._delayLeft-=t,this.delayLeft<0)t=-this.delayLeft,this._delayLeft=0,this.emit("delayEnd");else return;this._settings.duration==0?this._p=1:this._p+=t/this._settings.duration,this._p>=1&&(this._p=1)}this._updateDrawValue(),this.invokeListeners()}invokeListeners(){this.emit("progress",this.p),this.p===1&&this.emit("finish")}updateTargetValue(t){let e=this._settings.timingFunctionImpl(this.p);e===1?this._targetValue=t:e===0?(this._startValue=this._targetValue,this._targetValue=t):(this._startValue=t-(t-this._targetValue)/(1-e),this._targetValue=t)}getDrawValue(){if(this.p>=1)return this.targetValue;{let t=this._settings._timingFunctionImpl(this.p);return this._merger(this.targetValue,this.startValue,t)}}skipDelay(){this._delayLeft=0}get startValue(){return this._startValue}get targetValue(){return this._targetValue}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get settings(){return this._settings}set settings(t){this._settings=t}}mr.prototype.isTransition=!0;class Ko{constructor(){this._items=[],this._refs={}}get(){return this._items}get first(){return this._items[0]}get last(){return this._items.length?this._items[this._items.length-1]:void 0}add(t){this.addAt(t,this._items.length)}addAt(t,e){if(e>=0&&e<=this._items.length){let i=this._items.indexOf(t);if(i===e)return t;if(b.isObjectLiteral(t)){const s=t;t=this.createItem(s),t.patch(s)}i!=-1?this.setAt(t,e):(t.ref&&(this._refs[t.ref]=t),this._items.splice(e,0,t),this.onAdd(t,e))}else throw new Error("addAt: The index "+e+" is out of bounds "+this._items.length)}replaceByRef(t){if(t.ref){const e=this.getByRef(t.ref);if(!e)throw new Error("replaceByRef: no item found with reference: "+t.ref);this.replace(t,e)}else throw new Error("replaceByRef: no ref specified in item");this.addAt(t,this._items.length)}replace(t,e){const i=this.getIndex(e);if(i===-1)throw new Error("replace: The previous item does not exist");this.setAt(t,i)}setAt(t,e){if(e>=0&&e<=this._items.length){if(b.isObjectLiteral(t)){const s=t;t=this.createItem(s),t.patch(s)}let i=this._items.indexOf(t);if(i!=-1){if(i!==e){const s=i;s!==e&&(this._items.splice(s,1),this._items.splice(e,0,t),this.onMove(t,s,e))}}else if(e<this._items.length){this._items[e].ref&&(this._refs[this._items[e].ref]=void 0);const s=this._items[e];this._items[e]=t,t.ref&&(this._refs[t.ref]=t),this.onSet(t,e,s)}else throw new Error("setAt: The index "+e+" is out of bounds "+this._items.length)}else throw new Error("setAt: The index "+e+" is out of bounds "+this._items.length)}getAt(t){return this._items[t]}getIndex(t){return this._items.indexOf(t)}remove(t){let e=this._items.indexOf(t);e!==-1&&this.removeAt(e)}removeAt(t){if(t>=0&&t<this._items.length){const e=this._items[t];return e.ref&&(this._refs[e.ref]=void 0),this._items.splice(t,1),this.onRemove(e,t),e}else throw new Error("removeAt: The index ".concat(t," is out of bounds ").concat(this._items.length-1))}clear(){if(this._items.length){let e=this._items;this._items=[],this._refs={},this.onSync(e,[],[])}}a(t){if(b.isObjectLiteral(t)){let e=this.createItem(t);return e.patch(t),this.add(e),e}else if(Array.isArray(t)){for(let e=0,i=t.length;e<i;e++)this.a(t[e]);return null}else if(this.isItem(t))return this.add(t),t}get length(){return this._items.length}_getRefs(){return this._refs}getByRef(t){return this._refs[t]}clearRef(t){delete this._refs[t]}setRef(t,e){this._refs[t]=e}patch(t){b.isObjectLiteral(t)?this._setByObject(t):Array.isArray(t)&&this._setByArray(t)}_setByObject(t){let e=this._getRefs(),i=Object.keys(t);for(let s=0,r=i.length;s<r;s++){let o=i[s],a=t[o],h=e[o];if(!h)this.isItem(a)?(a.ref=o,this.add(a)):(h=this.createItem(a),h.ref=o,h.patch(a),this.add(h));else if(this.isItem(a)){if(h!==a){let l=this.getIndex(h);a.ref=o,this.setAt(a,l)}}else h.patch(a)}}_equalsArray(t){let e=!0;if(t.length===this._items.length)for(let i=0,s=this._items.length;i<s&&e;i++)e=e&&this._items[i]===t[i];else e=!1;return e}_setByArray(t){if(this._equalsArray(t))return;for(let s=0,r=this._items.length;s<r;s++)this._items[s].marker=!0;let e,i=[];for(let s=0,r=t.length;s<r;s++){let o=t[s];if(this.isItem(o))o.marker=!1,i.push(o);else{let a=o.ref,h;a&&(e||(e=this._getRefs()),h=e[a]),h?h.marker=!1:h=this.createItem(o),b.isObjectLiteral(o)&&h.patch(o),i.push(h)}}this._setItems(i)}_setItems(t){let e=this._items;this._items=t;let i=e.filter(r=>{let o=r.marker;return delete r.marker,o}),s=t.filter(r=>e.indexOf(r)===-1);if(i.length||s.length){this._refs={};for(let r=0,o=this._items.length;r<o;r++){let a=this._items[r].ref;a&&(this._refs[a]=this._items[r])}}this.onSync(i,s,t)}sort(t){const e=this._items.slice();e.sort(t),this._setByArray(e)}onAdd(t,e){}onRemove(t,e){}onSync(t,e,i){}onSet(t,e,i){}onMove(t,e,i){}createItem(t){throw new Error("ObjectList.createItem must create and return a new object")}isItem(t){return!1}forEach(t){this.get().forEach(t)}}class Bu extends Ko{constructor(t){super(),this._element=t}_connectParent(t){const e=t.parent;if(e&&e!==this._element){const i=t.parent.childList,s=i.getIndex(t);t.ref&&(i._refs[t.ref]=void 0),i._items.splice(s,1),e.core.removeChildAt(s)}t._setParent(this._element)}onAdd(t,e){this._connectParent(t),this._element.core.addChildAt(e,t.core)}onRemove(t,e){t._setParent(null),this._element.core.removeChildAt(e)}onSync(t,e,i){for(let r=0,o=t.length;r<o;r++)t[r]._setParent(null);for(let r=0,o=e.length;r<o;r++)this._connectParent(e[r]);let s=r=>r.core;this._element.core.syncChildren(t.map(s),e.map(s),i.map(s))}onSet(t,e,i){i._setParent(null),this._connectParent(t),this._element.core.setChildAt(e,t.core)}onMove(t,e,i){this._element.core.moveChild(e,i)}createItem(t){return t.type?new t.type(this._element.stage):this._element.stage.createElement()}isItem(t){return t.isElement}}class K{constructor(t){this.stage=t,this.__id=K.id++,this.__start(),this._hasEventListeners=!1,this.__core=new Se(this),this.__ref=null,this.__attached=!1,this.__enabled=!1,this.__active=!1,this.__parent=null,this.__texture=null,this.__displayedTexture=null,this.__tags=null,this.__treeTags=null,this.__tagRoot=!1,this.__childList=null,this._w=0,this._h=0}__start(){}get id(){return this.__id}set ref(t){if(this.__ref!==t){const e=t.charCodeAt(0);b.isUcChar(e)||this._throwError("Ref must start with an upper case character: "+t),this.__ref!==null&&(this.removeTag(this.__ref),this.__parent&&this.__parent.__childList.clearRef(this.__ref)),this.__ref=t,this.__ref&&(this._addTag(this.__ref),this.__parent&&this.__parent.__childList.setRef(this.__ref,this))}}get ref(){return this.__ref}get core(){return this.__core}setAsRoot(){this.__core.setAsRoot(),this._updateAttachedFlag(),this._updateEnabledFlag()}get isRoot(){return this.__core.isRoot}_setParent(t){this.__parent!==t&&(this.__parent&&this._unsetTagsParent(),this.__parent=t,t&&this._setTagsParent(),this._updateAttachedFlag(),this._updateEnabledFlag(),this._updateCollision(),this.isRoot&&t&&this._throwError("Root should not be added as a child! Results are unspecified!"))}getDepth(){let t=0,e=this.__parent;for(;e;)t++,e=e.__parent;return t}getAncestor(t){let e=this;for(;t>0&&e.__parent;)e=e.__parent,t--;return e}getAncestors(){const t=[];let e=this;for(;e;)t.push(e),e=e.__parent;return t}getAncestorAtDepth(t){let e=this.getDepth()-t;return e<0?null:this.getAncestor(e)}isAncestorOf(t){let e=t;for(;e=e.parent;)if(this===e)return!0;return!1}getSharedAncestor(t){let e=this,i=t,s=e.getDepth(),r=i.getDepth();s>r?e=e.getAncestor(s-r):r>s&&(i=i.getAncestor(r-s));do{if(e===i)return e;e=e.__parent,i=i.__parent}while(e&&i);return null}get attached(){return this.__attached}get enabled(){return this.__enabled}get active(){return this.__active}_isAttached(){return this.__parent?this.__parent.__attached:this.stage.root===this}_isEnabled(){return this.__core.visible&&this.__core.alpha>0&&(this.__parent?this.__parent.__enabled:this.stage.root===this)}_isActive(){return this._isEnabled()&&this.withinBoundsMargin}_updateAttachedFlag(){let t=this._isAttached();if(this.__attached!==t){this.__attached=t,t&&this._onSetup();let e=this._children.get();if(e){let i=e.length;if(i>0)for(let s=0;s<i;s++)e[s]._updateAttachedFlag()}t?this._onAttach():this._onDetach()}}_updateEnabledFlag(){let t=this._isEnabled();if(this.__enabled!==t){t?(this._onEnabled(),this._setEnabledFlag()):(this._onDisabled(),this._unsetEnabledFlag());let e=this._children.get();if(e){let i=e.length;if(i>0)for(let s=0;s<i;s++)e[s]._updateEnabledFlag()}}}_setEnabledFlag(){this.__enabled=!0,this._updateDimensions(),this._updateTextureCoords(),this.__texture&&this.__texture.addElement(this),this.withinBoundsMargin&&this._setActiveFlag(),this.__core.shader&&this.__core.shader.addElement(this.__core)}_unsetEnabledFlag(){this.__active&&this._unsetActiveFlag(),this.__texture&&this.__texture.removeElement(this),this.__core.shader&&this.__core.shader.removeElement(this.__core),this._texturizer&&this.texturizer.filters.forEach(t=>t.removeElement(this.__core)),this.__enabled=!1}_setActiveFlag(){this.__active=!0,this.__texture&&this.__texture.incActiveCount(),this.__texture&&this._enableTexture(),this._onActive()}_unsetActiveFlag(){this.__texture&&this.__texture.decActiveCount(),this.__active=!1,this.__texture&&this._disableTexture(),this._hasTexturizer()&&this.texturizer.deactivate(),this._onInactive()}_onSetup(){}_onAttach(){}_onDetach(){}_onEnabled(){}_onDisabled(){}_onActive(){}_onInactive(){}_onResize(){}_getRenderWidth(){return this._w?this._w:this.__displayedTexture?this.__displayedTexture.getRenderWidth():this.__texture?this.__texture.getRenderWidth():0}_getRenderHeight(){return this._h?this._h:this.__displayedTexture?this.__displayedTexture.getRenderHeight():this.__texture?this.__texture.getRenderHeight():0}get renderWidth(){return this.__enabled?this.__core.getRenderWidth():this._getRenderWidth()}get renderHeight(){return this.__enabled?this.__core.getRenderHeight():this._getRenderHeight()}get finalX(){return this.__core.x}get finalY(){return this.__core.y}get finalW(){return this.__core.w}get finalH(){return this.__core.h}textureIsLoaded(){return this.__texture&&this.__texture.isLoaded()}loadTexture(){this.__texture&&(this.__texture.load(),(!this.__texture.isUsed()||!this._isEnabled())&&this._updateDimensions())}_enableTextureError(){const t=this.__texture.loadError;t&&this.emit("txError",t,this.__texture._source)}_enableTexture(){this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):(this._setDisplayedTexture(null),this._enableTextureError())}_disableTexture(){this._setDisplayedTexture(null)}get texture(){return this.__texture}set texture(t){let e;if(b.isObjectLiteral(t))t.type?e=new t.type(this.stage):e=this.texture,e&&xt.patchObject(e,t);else if(!t)e=null;else if(t.isTexture)e=t;else if(t.isTextureSource)e=new Vo(this.stage),e.textureSource=t;else{console.error("[Lightning] Please specify a texture type.");return}const i=this.__texture;e!==i&&(this.__texture=e,this.__texture?this.__enabled&&(this.__texture.addElement(this),this.withinBoundsMargin&&(this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):this._enableTextureError())):this._setDisplayedTexture(null),i&&i!==this.__displayedTexture&&i.removeElement(this),this._updateDimensions())}get displayedTexture(){return this.__displayedTexture}_setDisplayedTexture(t){let e=this.__displayedTexture;e&&t!==e&&this.__texture!==e&&e.removeElement(this);const i=this.__core.displayedTextureSource,s=(t?t._source:null)!==i;this.__displayedTexture=t,this._updateDimensions(),this.__displayedTexture?s&&(this._updateTextureCoords(),this.__core.setDisplayedTextureSource(this.__displayedTexture._source)):this.__core.setDisplayedTextureSource(null),s&&(this.__displayedTexture?(this.stage.removeUpdateSourceTexture(this.__displayedTexture),this.emit("txLoaded",this.__displayedTexture)):this.emit("txUnloaded",this.__displayedTexture))}onTextureSourceLoaded(){this.active&&this._setDisplayedTexture(this.__texture)}onTextureSourceLoadError(t){this.emit("txError",t,this.__texture._source)}forceRenderUpdate(){this.__core.setHasRenderUpdates(3)}onDisplayedTextureClippingChanged(){this._updateDimensions(),this._updateTextureCoords()}onPrecisionChanged(){this._updateDimensions()}onDimensionsChanged(t,e){this.texture instanceof Fe&&(this.texture.w=t,this.texture.h=e,this.w=t,this.h=e)}_updateDimensions(){let t=this._getRenderWidth(),e=this._getRenderHeight(),i=!1;(!t||!e)&&!this.__displayedTexture&&this.__texture&&(t=t||this.__texture.mw,e=e||this.__texture.mh,(!t||!e)&&this.__texture.isAutosizeTexture()&&(i=!0)),this.__core.setDimensions(t,e,i)&&this._onResize()}_updateTextureCoords(){if(this.displayedTexture&&this.displayedTexture._source){let t=this.displayedTexture,e=this.displayedTexture._source,i=0,s=0,r=1,o=1;if(t.clipping){let a=e.getRenderWidth(),h=e.getRenderHeight(),l,c,u,d;l=1/a,c=1/h,t.pw?u=t.pw*l:u=(a-t.px)*l,t.ph?d=t.ph*c:d=(h-t.py)*c,l*=t.px,c*=t.py,i=l,s=c,r=r*u+l,o=o*d+c,i=Math.max(0,i),s=Math.max(0,s),r=Math.min(1,r),o=Math.min(1,o)}if(e._flipTextureY){let a=o;o=s,s=a}this.__core.setTextureCoords(i,s,r,o)}}getCornerPoints(){return this.__core.getCornerPoints()}_unsetTagsParent(){this.__tags&&this.__tags.forEach(i=>{let s=this;for(;(s=s.__parent)&&(s.__treeTags.get(i).delete(this),!s.__tagRoot););});let t=null,e=0;if(this.__treeTags&&!this.__tagRoot&&(t=b.iteratorToArray(this.__treeTags.keys()),e=t.length,e>0))for(let i=0;i<e;i++){let s=this.__treeTags.get(t[i]),r=this;for(;r=r.__parent;){let o=r.__treeTags.get(t[i]);if(s.forEach(function(a){o.delete(a)}),r.__tagRoot)break}}}_setTagsParent(){this.__tags&&this.__tags.forEach(t=>{let e=this;for(;e=e.__parent;){e.__treeTags||(e.__treeTags=new Map);let i=e.__treeTags.get(t);if(i||(i=new Set,e.__treeTags.set(t,i)),i.add(this),e.__tagRoot)break}}),this.__treeTags&&this.__treeTags.size&&(this.__tagRoot||this.__treeTags.forEach((t,e)=>{let i=this;for(;!i.__tagRoot&&(i=i.__parent);){i.__tagRoot,i.__treeTags||(i.__treeTags=new Map);let s=i.__treeTags.get(e);s||(s=new Set,i.__treeTags.set(e,s)),t.forEach(function(r){s.add(r)})}}))}_getByTag(t){if(!this.__treeTags)return[];let e=this.__treeTags.get(t);return e?b.setToArray(e):[]}getTags(){return this.__tags?this.__tags:[]}setTags(t){t=t.reduce((a,h)=>a.concat(h.split(" ")),[]),this.__ref&&t.push(this.__ref);let e,i=t.length,s=[],r=[];for(e=0;e<i;e++)this.hasTag(t[e])||r.push(t[e]);let o=this.tags||[];for(i=o.length,e=0;e<i;e++)t.indexOf(o[e])==-1&&s.push(o[e]);for(e=0;e<s.length;e++)this.removeTag(s[e]);for(e=0;e<r.length;e++)this.addTag(r[e])}addTag(t){if(t.indexOf(" ")===-1)b.isUcChar(t.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(t);else{const e=t.split(" ");for(let i=0,s=e.length;i<s;i++){const r=e[i];b.isUcChar(r.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(r)}}}_addTag(t){if(this.__tags||(this.__tags=[]),this.__tags.indexOf(t)===-1){this.__tags.push(t);let e=this.__parent;if(e)do{e.__treeTags||(e.__treeTags=new Map);let i=e.__treeTags.get(t);i||(i=new Set,e.__treeTags.set(t,i)),i.add(this)}while(!e.__tagRoot&&(e=e.__parent))}}removeTag(t){let e=this.__tags.indexOf(t);if(e!==-1){this.__tags.splice(e,1);let i=this.__parent;if(i)do{let s=i.__treeTags.get(t);s&&s.delete(this)}while(!i.__tagRoot&&(i=i.__parent))}}hasTag(t){return this.__tags&&this.__tags.indexOf(t)!==-1}_tag(t){if(t.indexOf(".")!==-1)return this.mtag(t)[0];if(this.__treeTags){let e=this.__treeTags.get(t);if(e){const i=e.values().next();return i?i.value:void 0}}}get tag(){return this._tag}set tag(t){this.tags=t}mtag(t){if(t.indexOf(".")>=0){let i=t.split("."),s=this._getByTag(i[0]),r=1,o=i.length;for(;s.length&&r<o;){let a=[];for(let h=0,l=s.length;h<l;h++)a=a.concat(s[h]._getByTag(i[r]));s=a,r++}return s}else return this._getByTag(t)}stag(t,e){let i=this.mtag(t),s=i.length;for(let r=0;r<s;r++)xt.patchObject(i[r],e)}get tagRoot(){return this.__tagRoot}set tagRoot(t){this.__tagRoot!==t&&(t?this._unsetTagsParent():this._setTagsParent(),this.__tagRoot=t)}sel(t){const e=this.select(t);if(e.length)return e[0]}select(t){if(t.indexOf(",")!==-1){let e=t.split(","),i=[];for(let s=0;s<e.length;s++)i=i.concat(this._select(e[s]));return i}else return this._select(t)}_select(t){if(t==="")return[this];let e=t.indexOf("."),i=t.indexOf(">");if(e===-1&&i===-1)return this.mtag(t);let s;return i===0?(s=!0,t=t.substr(1)):e===0?(s=!1,t=t.substr(1)):s=!1,this._selectChilds(t,s)}_selectChilds(t,e){const i=t.indexOf("."),s=t.indexOf(">");if(i===-1&&s===-1)if(e){const r=this.getByRef(t);return r?[r]:[]}else return this.mtag(t);if(s===-1||i!==-1&&i<s){let r;const o=t.substr(0,i);if(e){const l=this.getByRef(o);r=l?[l]:[]}else r=this.mtag(o);let a=[];const h=t.substr(i+1);for(let l=0,c=r.length;l<c;l++)a=a.concat(r[l]._selectChilds(h,!1));return a}else{let r;const o=t.substr(0,s);if(e){const l=this.getByRef(o);r=l?[l]:[]}else r=this.mtag(o);let a=[];const h=t.substr(s+1);for(let l=0,c=r.length;l<c;l++)a=a.concat(r[l]._selectChilds(h,!0));return a}}getByRef(t){return this.childList.getByRef(t)}getLocationString(){let t;t=this.__parent?this.__parent._children.getIndex(this):"R";let e=this.getTags(),i=this.__parent?this.__parent.getLocationString():"";return this.ref?i+=":["+t+"]"+this.ref:e.length?i+=":["+t+"]"+e.join(","):i+=":["+t+"]#"+this.id,i}toString(){let t=this.getSettings();return K.getPrettyString(t,"")}static getPrettyString(t,e){let i=t.children;delete t.children;let s=["color","colorUl","colorUr","colorBl","colorBr"],r=JSON.stringify(t,function(o,a){return s.indexOf(o)!==-1?"COLOR["+a.toString(16)+"]":a});if(r=r.replace(/"COLOR\[([a-f0-9]{1,8})\]"/g,"0x$1"),i){let o="";if(b.isObjectLiteral(i)){let a=Object.keys(i);o="";for(let l=0,c=a.length;l<c;l++)o+="\n".concat(e,'  "').concat(a[l],'":'),delete i[a[l]].ref,o+=K.getPrettyString(i[a[l]],e+"  ")+(l<c-1?",":"");let h=r==="{}";r=r.substr(0,r.length-1)+(h?"":",")+o+"\n"+e+"}"}else{let a=i.length;o="[";for(let l=0;l<a;l++)o+=K.getPrettyString(i[l],e+"  ")+(l<a-1?",":"")+"\n";o+=e+"]}";let h=r==="{}";r=r.substr(0,r.length-1)+(h?"":",")+'"children":\n'+e+o+"}"}}return r}getSettings(){let t=this.getNonDefaults(),e=this._children.get();if(e){let i=e.length;if(i){const s=[];let r=!1;for(let o=0;o<i;o++)s.push(e[o].getSettings()),r=r||!e[o].ref;r?t.children=s:(t.children={},s.forEach(o=>{t.children[o.ref]=o}))}}return t.id=this.id,t}getNonDefaults(){let t={};if(this.constructor!==K&&(t.type=this.constructor.name),this.__ref&&(t.ref=this.__ref),this.__tags&&this.__tags.length&&(t.tags=this.__tags),this.x!==0&&(t.x=this.x),this.y!==0&&(t.y=this.y),this.w!==0&&(t.w=this.w),this.h!==0&&(t.h=this.h),this.scaleX===this.scaleY?this.scaleX!==1&&(t.scale=this.scaleX):(this.scaleX!==1&&(t.scaleX=this.scaleX),this.scaleY!==1&&(t.scaleY=this.scaleY)),this.pivotX===this.pivotY?this.pivotX!==.5&&(t.pivot=this.pivotX):(this.pivotX!==.5&&(t.pivotX=this.pivotX),this.pivotY!==.5&&(t.pivotY=this.pivotY)),this.mountX===this.mountY?this.mountX!==0&&(t.mount=this.mountX):(this.mountX!==0&&(t.mountX=this.mountX),this.mountY!==0&&(t.mountY=this.mountY)),this.alpha!==1&&(t.alpha=this.alpha),this.visible||(t.visible=!1),this.rotation!==0&&(t.rotation=this.rotation),this.colorUl===this.colorUr&&this.colorBl===this.colorBr&&this.colorUl===this.colorBl?this.colorUl!==4294967295&&(t.color=this.colorUl.toString(16)):(this.colorUl!==4294967295&&(t.colorUl=this.colorUl.toString(16)),this.colorUr!==4294967295&&(t.colorUr=this.colorUr.toString(16)),this.colorBl!==4294967295&&(t.colorBl=this.colorBl.toString(16)),this.colorBr!==4294967295&&(t.colorBr=this.colorBr.toString(16))),this.zIndex&&(t.zIndex=this.zIndex),this.forceZIndexContext&&(t.forceZIndexContext=!0),this.clipping&&(t.clipping=this.clipping),this.clipbox||(t.clipbox=this.clipbox),this.__texture){let e=this.__texture.getNonDefaults();Object.keys(e).length&&(t.texture=e)}if(this.shader&&b.isFunction(this.shader.getNonDefaults)){let e=this.shader.getNonDefaults();Object.keys(e).length&&(t.shader=e)}return this._hasTexturizer()&&(this.texturizer.enabled&&(t.renderToTexture=this.texturizer.enabled),this.texturizer.lazy&&(t.renderToTextureLazy=this.texturizer.lazy),this.texturizer.colorize&&(t.colorizeResultTexture=this.texturizer.colorize),this.texturizer.renderOffscreen&&(t.renderOffscreen=this.texturizer.renderOffscreen)),t}static getGetter(t){let e=K.PROP_GETTERS.get(t);return e||(e=new Function("obj","return obj."+t),K.PROP_GETTERS.set(t,e)),e}static getSetter(t){let e=K.PROP_SETTERS.get(t);return e||(e=new Function("obj","v","obj."+t+" = v"),K.PROP_SETTERS.set(t,e)),e}get withinBoundsMargin(){return this.__core._withinBoundsMargin}_enableWithinBoundsMargin(){this.__enabled&&this._setActiveFlag()}_disableWithinBoundsMargin(){this.__active&&this._unsetActiveFlag()}set boundsMargin(t){if(!Array.isArray(t)&&t!==null)throw new Error("boundsMargin should be an array of left-top-right-bottom values or null (inherit margin)");this.__core.boundsMargin=t}get boundsMargin(){return this.__core.boundsMargin}get x(){return this.__core.offsetX}set x(t){this.__core.offsetX=t}get y(){return this.__core.offsetY}set y(t){this.__core.offsetY=t}get w(){return this._w}set w(t){b.isFunction(t)?(this._w=0,this.__core.funcW=t):(t=Math.max(t,0),this._w!==t&&(this.__core.disableFuncW(),this._w=t,this._updateDimensions()))}get h(){return this._h}set h(t){b.isFunction(t)?(this._h=0,this.__core.funcH=t):(t=Math.max(t,0),this._h!==t&&(this.__core.disableFuncH(),this._h=t,this._updateDimensions()))}get collision(){return this._collision}set collision(t){this._collision=t}_updateCollision(){this.collision&&this.__parent&&this.__parent.collision===void 0&&(this.__parent.collision=2)}get scaleX(){return this.__core.scaleX}set scaleX(t){this.__core.scaleX=t}get scaleY(){return this.__core.scaleY}set scaleY(t){this.__core.scaleY=t}get scale(){return this.__core.scale}set scale(t){this.__core.scale=t}get pivotX(){return this.__core.pivotX}set pivotX(t){this.__core.pivotX=t}get pivotY(){return this.__core.pivotY}set pivotY(t){this.__core.pivotY=t}get pivot(){return this.__core.pivot}set pivot(t){this.__core.pivot=t}get mountX(){return this.__core.mountX}set mountX(t){this.__core.mountX=t}get mountY(){return this.__core.mountY}set mountY(t){this.__core.mountY=t}get mount(){return this.__core.mount}set mount(t){this.__core.mount=t}get rotation(){return this.__core.rotation}set rotation(t){this.__core.rotation=t}get alpha(){return this.__core.alpha}set alpha(t){this.__core.alpha=t}get visible(){return this.__core.visible}set visible(t){this.__core.visible=t}get colorUl(){return this.__core.colorUl}set colorUl(t){this.__core.colorUl=t}get colorUr(){return this.__core.colorUr}set colorUr(t){this.__core.colorUr=t}get colorBl(){return this.__core.colorBl}set colorBl(t){this.__core.colorBl=t}get colorBr(){return this.__core.colorBr}set colorBr(t){this.__core.colorBr=t}get color(){return this.__core.colorUl}set color(t){(this.colorUl!==t||this.colorUr!==t||this.colorBl!==t||this.colorBr!==t)&&(this.colorUl=t,this.colorUr=t,this.colorBl=t,this.colorBr=t)}get colorTop(){return this.colorUl}set colorTop(t){(this.colorUl!==t||this.colorUr!==t)&&(this.colorUl=t,this.colorUr=t)}get colorBottom(){return this.colorBl}set colorBottom(t){(this.colorBl!==t||this.colorBr!==t)&&(this.colorBl=t,this.colorBr=t)}get colorLeft(){return this.colorUl}set colorLeft(t){(this.colorUl!==t||this.colorBl!==t)&&(this.colorUl=t,this.colorBl=t)}get colorRight(){return this.colorUr}set colorRight(t){(this.colorUr!==t||this.colorBr!==t)&&(this.colorUr=t,this.colorBr=t)}get zIndex(){return this.__core.zIndex}set zIndex(t){this.__core.zIndex=t}get forceZIndexContext(){return this.__core.forceZIndexContext}set forceZIndexContext(t){this.__core.forceZIndexContext=t}get clipping(){return this.__core.clipping}set clipping(t){this.__core.clipping=t}get clipbox(){return this.__core.clipbox}set clipbox(t){this.__core.clipbox=t}get tags(){return this.getTags()}set tags(t){Array.isArray(t)||(t=[t]),this.setTags(t)}set t(t){this.tags=t}get _children(){return this.__childList||(this.__childList=new Bu(this,!1)),this.__childList}get childList(){return this._allowChildrenAccess()||this._throwError("Direct access to children is not allowed in "+this.getLocationString()),this._children}hasChildren(){return this._allowChildrenAccess()&&this.__childList&&this.__childList.length>0}_allowChildrenAccess(){return!0}get children(){return this.childList.get()}set children(t){this.childList.patch(t)}add(t){return this.childList.a(t)}get p(){return this.__parent}get parent(){return this.__parent}get src(){if(this.texture&&this.texture instanceof xr)return this.texture._src}set src(t){const e=new xr(this.stage);e.src=t,this.texture=e}set mw(t){this.texture?(this.texture.mw=t,this._updateDimensions()):this._throwError("Please set mw after setting a texture.")}set mh(t){this.texture?(this.texture.mh=t,this._updateDimensions()):this._throwError("Please set mh after setting a texture.")}get rect(){return this.texture===this.stage.rectangleTexture}set rect(t){t?this.texture=this.stage.rectangleTexture:this.texture=null}enableTextTexture(){return(!this.texture||!(this.texture instanceof Fe))&&(this.texture=new Fe(this.stage),!this.texture.w&&!this.texture.h&&(this.texture.w=this.w,this.texture.h=this.h)),this.texture}get text(){return this.texture&&this.texture instanceof Fe?this.texture:null}set text(t){(!this.texture||!(this.texture instanceof Fe))&&this.enableTextTexture(),b.isString(t)?this.texture.text=t:this.texture.patch(t)}set onUpdate(t){this.__core.onUpdate=t}set onAfterCalcs(t){this.__core.onAfterCalcs=t}set onAfterUpdate(t){this.__core.onAfterUpdate=t}forceUpdate(){this.__core._setHasUpdates()}get shader(){return this.__core.shader}set shader(t){if(b.isObjectLiteral(t)&&!t.type)this.shader&&this.shader.patch(t);else{const e=Ii.create(this.stage,t);this.__enabled&&this.__core.shader&&this.__core.shader.removeElement(this.__core),this.__core.shader=e,this.__enabled&&this.__core.shader&&this.__core.shader.addElement(this.__core)}}_hasTexturizer(){return!!this.__core._texturizer}get renderToTexture(){return this.rtt}set renderToTexture(t){this.rtt=t}get rtt(){return this._hasTexturizer()&&this.texturizer.enabled}set rtt(t){this.texturizer.enabled=t}get rttLazy(){return this._hasTexturizer()&&this.texturizer.lazy}set rttLazy(t){this.texturizer.lazy=t}get renderOffscreen(){return this._hasTexturizer()&&this.texturizer.renderOffscreen}set renderOffscreen(t){this.texturizer.renderOffscreen=t}get colorizeResultTexture(){return this._hasTexturizer()&&this.texturizer.colorize}set colorizeResultTexture(t){this.texturizer.colorize=t}getTexture(){return this.texturizer._getTextureSource()}get texturizer(){return this.__core.texturizer}patch(t){let e=Object.keys(t);for(let i=0,s=e.length;i<s;i++){let r=e[i];const o=t[r],a=r.charCodeAt(0);if(b.isUcChar(a)){const h=this.getByRef(r);if(h)o===void 0?h.parent&&h.parent.childList.remove(h):b.isObjectLiteral(o)?h.patch(o):o.isElement?(o.ref=r,this.childList.replace(o,h)):this._throwError("Unexpected value for path: "+r);else if(o!==void 0){let l;b.isObjectLiteral(o)?(l=this.childList.createItem(o),l.patch(o)):b.isObject(o)&&(l=o),l.isElement&&(l.ref=r),this.childList.a(l)}}else xt.patchObjectProperty(this,r,o)}}_throwError(t){throw new Error(this.constructor.name+" ("+this.getLocationString()+"): "+t)}animation(t){return this.stage.animations.createAnimation(this,t)}transition(t,e=null){return e===null?this._getTransition(t):(this._setTransition(t,e),null)}set transitions(t){Object.keys(t).forEach(i=>{this.transition(i,t[i])})}set smooth(t){Object.keys(t).forEach(i=>{let s=t[i];Array.isArray(s)?this.setSmooth(i,s[0],s[1]):this.setSmooth(i,s)})}fastForward(t){if(this._transitions){let e=this._transitions[t];e&&e.isTransition&&e.finish()}}_getTransition(t){this._transitions||(this._transitions={});let e=this._transitions[t];return e?e.isTransitionSettings&&(e=new mr(this.stage.transitions,e,this,t)):e=new mr(this.stage.transitions,this.stage.transitions.defaultTransitionSettings,this,t),this._transitions[t]=e,e}_setTransition(t,e){if(!e)this._removeTransition(t);else{b.isObjectLiteral(e)&&(e=this.stage.transitions.createSettings(e)),this._transitions||(this._transitions={});let i=this._transitions[t];if(i&&i.isTransition)return i.settings=e,i;this._transitions[t]=e}}_removeTransition(t){this._transitions&&delete this._transitions[t]}getSmooth(t,e){let i=this._getTransition(t);return i&&i.isAttached()?i.targetValue:e}setSmooth(t,e,i){i&&this._setTransition(t,i);let s=this._getTransition(t);return s.start(e),s}get flex(){return this.__core.flex}set flex(t){this.__core.flex=t}get flexItem(){return this.__core.flexItem}set flexItem(t){this.__core.flexItem=t}static isColorProperty(t){return t.toLowerCase().indexOf("color")>=0}static getMerger(t){return K.isColorProperty(t)?M.mergeColors:M.mergeNumbers}toJSON(){const t=["".concat(this.constructor.name)],e={};return e[t]={},this.hasChildren()?K.collectChildren(e[t],this.__childList):e[t]={...K.getProperties(this)},e}static collectChildren(t,e){const i=e;for(let s=0,r=i.length;s<r;s++){const o=i.getAt(s),a="".concat(o.__ref||"Element-".concat(o.id)),h=this.getProperties(o);t[a]={...h},o.hasChildren()&&(t[a].children={},this.collectChildren(t[a].children,o.__childList))}}static getProperties(t){const e={},i=["alpha","active","attached","boundsMargin","color","clipping","enabled","h","id","isComponent","mount","mountY","mountX","pivot","pivotX","pivotY","ref","renderOffscreen","renderToTexture","scale","scaleX","scaleY","state","tag","visible","w","x","y","zIndex","!!flex","!!flexItem","hasFocus()","hasFinalFocus()"];let s=i.length;for(;s--;){let r=i[s];const o=/^!{2}/,a=/\(\)$/;o.test(r)?(r=r.substring(2,r.length),e[r]=!!t[r]):a.test(r)?(r=r.substring(0,r.length-2),typeof t[r]=="function"&&(e[r]=t[r]())):e[r]=t[r]}return{...e,...t.getNonDefaults()}}}J.addAsMixin(K);K.prototype.isElement=1;K.id=1;K.PROP_GETTERS=new Map;K.PROP_SETTERS=new Map;class Ut{constructor(){Ut.setupStateMachine(this)}static setupStateMachine(t){const e=t.constructor,i=Ut.create(e);Object.setPrototypeOf(t,i.prototype),t.constructor=e,t._initStateMachine()}static create(t){if(!t.hasOwnProperty("_sm")){const e=new ae(t);t._sm=e}return t._sm.router}fire(t,...e){if(this._hasMethod(t))return this[t](...e)}_getState(){return this._state.__path}_inState(t,e=this._state.__path){const i=this._sm.getStateByPath(t),s=this._sm.getStateByPath(e),r=i.__level;return Ut._getStateAtLevel(s,r)===i}_hasMember(t){return!!this.constructor.prototype[t]}_hasMethod(t){const e=this.constructor.prototype[t];return!!e&&typeof e=="function"}_setState(t,e){const i=++this._setStateCounter;if(this._setStateId=i,this._state.__path!==t){let s=this._sm._stateMap[t];s||(s=this._sm.getStateByPath(t));const r=this._state,o=s.prototype.$enter!==this._state.prototype.$enter,a=s.prototype.$exit!==this._state.prototype.$exit;if(o||a){const h=Ut._getSharedState(this._state,s),l={newState:s.__path,prevState:r.__path,sharedState:h.__path},c=h.__level;if(a){const u=Ut._getStatesUntilLevel(this._state,c);for(let d=0,g=u.length;d<g;d++)if(this.__setState(u[d]),this._callExit(this._state,e,l),this._setStateId!==i)return}if(o){const u=Ut._getStatesUntilLevel(s,c).reverse();for(let d=0,g=u.length;d<g;d++)if(this.__setState(u[d]),this._callEnter(this._state,e,l),this._setStateId!==i)return}}if(this.__setState(s),this._changedState){const h={newState:s.__path,prevState:r.__path};e?this._changedState(h,...e):this._changedState(h)}if(this._onStateChange){const h={newState:s.__path,prevState:r.__path};this._onStateChange(h)}}}_callEnter(t,e=[],i){const s=!!t.__parent;t.prototype.$enter&&(!s||t.__parent.prototype.$enter!==t.prototype.$enter)&&t.prototype.$enter.apply(this,[i,...e])}_callExit(t,e=[],i){const s=!!t.__parent;t.prototype.$exit&&(!s||t.__parent.prototype.$exit!==t.prototype.$exit)&&t.prototype.$exit.apply(this,[i,...e])}__setState(t){this._state=t,this._stateIndex=t.__index,this.constructor=t}_initStateMachine(){this._state=null,this._stateIndex=0,this._setStateCounter=0,this._sm=this._routedType._sm,this.__setState(this._sm.getStateByPath(""));const t={newState:"",prevState:void 0,sharedState:void 0};this._callEnter(this._state,[],t),this._onStateChange=void 0}_getMostSpecificHandledMember(t){let e=this._state;do{for(let i=0,s=t.length;i<s;i++){const r=t[i];if(e.__parent){const o=ae.getStateMemberAlias(e.__path,r);if(this[o])return r}else if(e.prototype[r])return r}e=e.__parent}while(e)}static _getStatesUntilLevel(t,e){const i=[];for(;t.__level>e;)i.push(t),t=t.__parent;return i}static _getSharedState(t,e){const i=Ut._getAncestorStates(t),s=Ut._getAncestorStates(e),r=Math.min(i.length,s.length);for(let o=0;o<r;o++)if(i[o]!==s[o])return i[o-1];return i[r-1]}static _getAncestorStates(t){const e=[];do e.push(t);while(t=t.__parent);return e.reverse()}static _getStateAtLevel(t,e){if(!(e>t.__level)){for(;e<t.__level;)t=t.__parent;return t}}}class ae{constructor(t){this._type=t,this._router=null,this.init()}get router(){return this._router}init(){this._router=this._createRouter(),this._stateMap=this._getStateMap(),this._addStateMemberDelegatorsToRouter()}_createRouter(){const t=this._type,e=class extends t{constructor(){if(super(...arguments),!this.constructor.hasOwnProperty("_isRouter"))throw new Error("You need to extend ".concat(t.name,".original instead of ").concat(t.name,"."))}};return e._isRouter=!0,e.prototype._routedType=t,e.original=t,this._mixinStateMachineMethods(e),e}_mixinStateMachineMethods(t){const e=Object.getOwnPropertyNames(Ut.prototype);for(let i=0,s=e.length;i<s;i++){const r=e[i];if(r!=="constructor"){const o=Object.getOwnPropertyDescriptor(Ut.prototype,r);Object.defineProperty(t.prototype,r,o)}}}_addStateMemberDelegatorsToRouter(){this._getAllMemberNames().forEach(e=>{this._addMemberRouter(e)})}_addMemberRouter(t){const e=Object.keys(this._stateMap),i=[],s=[];e.forEach((o,a)=>{const h=this._stateMap[o],l=this._getDescriptor(h,t);if(l){i[a]=l;const c=ae.getStateMemberAlias(l._source.__path,t);s[a]=c,this._router.prototype.hasOwnProperty(c)||Object.defineProperty(this._router.prototype,c,l)}else i[a]=null,s[a]=null});let r;switch(i.forEach(o=>{if(o){const a=this._getDescriptorType(o);if(r&&r!==a){console.warn("[Lightning] Member ".concat(t," in ").concat(this._type.name," has inconsistent types."));return}r=a}}),r){case"method":this._addMethodRouter(t,i,s);break;case"getter":this._addGetterSetterRouters(t);break;case"property":console.warn("[Lightning] Fixed properties are not supported; please use a getter instead!");break}}_getDescriptor(t,e,i=()=>!0){let s=t,r=t;do{const o=Object.getOwnPropertyDescriptor(s.prototype,e);if(o&&i(o))return o._source=r,o;s=Object.getPrototypeOf(s),s&&s.hasOwnProperty("__state")&&(r=s)}while(s&&s.prototype)}_getDescriptorType(t){return t.get||t.set?"getter":typeof t.value=="function"?"method":"property"}static _supportsSpread(){if(this.__supportsSpread===void 0){this.__supportsSpread=!1;try{new Function("return [].concat(...arguments);")(),this.__supportsSpread=!0}catch(t){}}return this.__supportsSpread}_addMethodRouter(t,e,i){const s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let r=i[0];const o=ae._supportsSpread();for(let c=1,u=i.length;c<u;c++){const d=i[c];d!==r&&(r?o?s.push("if (i < ".concat(c,') return this["').concat(r,'"](...arguments); else')):s.push("if (i < ".concat(c,') return this["').concat(r,'"].apply(this, arguments); else')):s.push("if (i < ".concat(c,") return ; else"))),r=d}r?o?s.push('return this["'.concat(r,'"](...arguments);')):s.push('return this["'.concat(r,'"].apply(this, arguments);')):s.push(";");const a=s.join("\n"),l={value:new Function([],a)};Object.defineProperty(this._router.prototype,t,l)}_addGetterSetterRouters(t){const e=this._getGetterRouter(t),i=this._getSetterRouter(t),s={get:e,set:i};Object.defineProperty(this._router.prototype,t,s)}_getGetterRouter(t){const e=Object.keys(this._stateMap),i=[];e.forEach((h,l)=>{const c=this._stateMap[h],u=this._getDescriptor(c,t,d=>d.get);if(u){const d=ae.getStateMemberAlias(u._source.__path,t);i[l]=d,this._router.prototype.hasOwnProperty(d)||Object.defineProperty(this._router.prototype,d,u)}else i[l]=null});const s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let r=i[0];for(let h=1,l=i.length;h<l;h++){const c=i[h];c!==r&&(r?s.push("if (i < ".concat(h,') return this["').concat(r,'"]; else')):s.push("if (i < ".concat(h,") return ; else"))),r=c}r?s.push('return this["'.concat(r,'"];')):s.push(";");const o=s.join("\n");return new Function([],o)}_getSetterRouter(t){const e=Object.keys(this._stateMap),i=[];e.forEach((h,l)=>{const c=this._stateMap[h],u=this._getDescriptor(c,t,d=>d.set);if(u){const d=ae.getStateMemberAlias(u._source.__path,t);i[l]=d,this._router.prototype.hasOwnProperty(d)||Object.defineProperty(this._router.prototype,d,u)}else i[l]=null});const s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let r=i[0];for(let h=1,l=i.length;h<l;h++){const c=i[h];c!==r&&(r?s.push("if (i < ".concat(h,') this["').concat(r,'"] = arg; else')):s.push("if (i < ".concat(h,") ; else"))),r=c}r?s.push('this["'.concat(r,'"] = arg;')):s.push(";");const o=s.join("\n");return new Function(["arg"],o)}static getStateMemberAlias(t,e){return"$"+(t?t+".":"")+e}_getAllMemberNames(){const t=this._stateMap,e=Object.keys(t);let i=new Set;return e.forEach(s=>{if(s==="")return;const r=t[s];this._getStateMemberNames(r).forEach(a=>{i.add(a)})}),[...i]}_getStateMemberNames(t){let e=t,i=new Set;const s=this._type===t;do this._getStateMemberNamesForType(e).forEach(o=>{i.add(o)}),e=Object.getPrototypeOf(e);while(e&&e.prototype&&(!e.hasOwnProperty("__state")||s));return i}_getStateMemberNamesForType(t){return Object.getOwnPropertyNames(t.prototype).filter(i=>i!=="constructor"&&!ae._isStateLocalMember(i))}static _isStateLocalMember(t){return t==="$enter"||t==="$exit"}getStateByPath(t){if(this._stateMap[t])return this._stateMap[t];const e=t.split(".");for(;e.pop();){const i=e.join(".");if(this._stateMap[i])return this._stateMap[i]}}_getStateMap(){return this._stateMap||(this._stateMap=this._createStateMap()),this._stateMap}_createStateMap(){const t={};return this._addState(this._type,null,"",t),t}_addState(t,e,i,s){t.__state=!0,t.__name=i,this._addStaticStateProperty(t,e);const r=e?e.__path:"";let o=(r?r+".":"")+i;t.__path=o,t.__level=e?e.__level+1:0,t.__parent=e,t.__index=Object.keys(s).length,s[o]=t;const a=t._states;a&&(e&&e._states===a||t._states().forEach(c=>{const u=ae._getStateName(c);this._addState(c,t,u,s)}))}static _getStateName(t){const e=t.name,i=e.indexOf("$");return i>0?e.substr(0,i):e}_addStaticStateProperty(t,e){e&&(e&&!e.__parent?this._router[t.__name]=t:e[t.__name]=t)}}class at extends K{constructor(t,e){super(t),this.tagRoot=!0,b.isObjectLiteral(e)&&Object.assign(this,e),this.__initialized=!1,this.__firstActive=!1,this.__firstEnable=!1,this.__signals=void 0,this.__passSignals=void 0,this.__construct();const i=this.constructor.getTemplateFunc(this);i.f(this,i.a),this._build()}__start(){Ut.setupStateMachine(this),this._onStateChange=at.prototype.__onStateChange}get state(){return this._getState()}__onStateChange(){this.application&&this.application.updateFocusPath()}_refocus(){this.application&&this.application.updateFocusPath()}static bindProp(t,e=null){return{__propertyBinding:!0,__name:t,__func:e}}__bindProperty(t,e,i){const s=e,r=i,o=Array.isArray(t.__name)?t.__name:[t.__name];for(let a=0;a<o.length;a++){const h=o[a],l=t.__func?t.__func:c=>c[h];this.hasOwnProperty(h)?this["__prop_bindings_".concat(h)].push({__obj:s,__prop:r,__func:l}):(this["__prop_bindings_".concat(h)]=[{__obj:s,__prop:r,__func:l}],Object.defineProperty(this,h,{set:c=>{this["__prop_".concat(h)]=c;for(const{__obj:u,__prop:d,__func:g}of this["__prop_bindings_".concat(h)])u[d]=g(this)},get:()=>this["__prop_".concat(h)]}))}}static getTemplateFunc(t){const e="_templateFunc",i="__has"+e;return this[i]!==this&&(this[i]=this,this[e]=this.parseTemplate(this._template(t))),this[e]}static parseTemplate(t){const e={loc:[],store:[],rid:0};this.parseTemplateRec(t,e,"element");const i=e.loc.join(";\n");return{f:new Function("element","store",i),a:e.store}}static parseTemplateRec(t,e,i){const s=e.store,r=e.loc;Object.keys(t).forEach(a=>{let h=t[a];if(b.isUcChar(a.charCodeAt(0)))if(b.isObjectLiteral(h)){const l="r".concat(a.replace(/[^a-z0-9]/gi,"")+e.rid);let c=h.type?h.type:K;c===K?r.push("var ".concat(l," = element.stage.createElement()")):(s.push(c),r.push("var ".concat(l," = new store[").concat(s.length-1,"](").concat(i,".stage)"))),r.push("".concat(l,'.ref = "').concat(a,'"')),e.rid++,this.parseTemplateRec(h,e,l),r.push("".concat(i,".childList.add(").concat(l,")"))}else b.isObject(h)&&(s.push(h),r.push("".concat(i,".childList.add(store[").concat(s.length-1,"])")));else if(a==="text"){const l=i+"__text";r.push("var ".concat(l," = ").concat(i,".enableTextTexture()")),h.__propertyBinding===!0?(s.push(h),r.push("element.__bindProperty(store[".concat(s.length-1,"], ").concat(i,', "').concat(a,'")'))):this.parseTemplatePropRec(h,e,l)}else if(a==="shader"&&b.isObjectLiteral(h)){const l="".concat(i,'["shader"]');s.push(h),r.push("".concat(i,'["').concat(a,'"] = store[').concat(s.length-1,"]")),this.parsePropertyBindings(h,e,l)}else if(a==="texture"&&b.isObjectLiteral(h)){const l=i+"__texture",c=h.type;c?(s.push(c),r.push("var ".concat(l," = new store[").concat(s.length-1,"](").concat(i,".stage)")),this.parseTemplatePropRec(h,e,l),r.push("".concat(i,'["').concat(a,'"] = ').concat(l))):(r.push("".concat(l," = ").concat(i,".texture")),this.parseTemplatePropRec(h,e,l))}else b.isObjectLiteral(h)&&h.__propertyBinding===!0?(s.push(h),r.push("element.__bindProperty(store[".concat(s.length-1,"], ").concat(i,', "').concat(a,'")'))):b.isNumber(h)?r.push("".concat(i,'["').concat(a,'"] = ').concat(h)):b.isBoolean(h)?r.push("".concat(i,'["').concat(a,'"] = ').concat(h?"true":"false")):b.isObject(h)||Array.isArray(h)?(s.push(h),r.push("".concat(i,'["').concat(a,'"] = store[').concat(s.length-1,"]"))):r.push("".concat(i,'["').concat(a,'"] = ').concat(JSON.stringify(h)))})}static parseTemplatePropRec(t,e,i){const s=e.store,r=e.loc;Object.keys(t).forEach(a=>{if(a!=="type"){const h=t[a];b.isNumber(h)?r.push("".concat(i,'["').concat(a,'"] = ').concat(h)):b.isBoolean(h)?r.push("".concat(i,'["').concat(a,'"] = ').concat(h?"true":"false")):b.isObject(h)&&h.__propertyBinding===!0?(s.push(h),r.push("element.__bindProperty(store[".concat(s.length-1,"], ").concat(i,', "').concat(a,'")'))):b.isObject(h)||Array.isArray(h)?(s.push(h),r.push("".concat(i,'["').concat(a,'"] = store[').concat(s.length-1,"]"))):r.push("".concat(i,'["').concat(a,'"] = ').concat(JSON.stringify(h)))}})}static parsePropertyBindings(t,e,i){const s=e.store,r=e.loc;Object.keys(t).forEach(a=>{if(a!=="type"){const h=t[a];b.isObjectLiteral(h)&&h.__propertyBinding===!0&&(s.push(h),r.push("element.__bindProperty(store[".concat(s.length-1,"], ").concat(i,', "').concat(a,'")')))}})}_onSetup(){this.__initialized||this._setup()}_setup(){}_onAttach(){this.__initialized||(this.__init(),this.__initialized=!0),this._attach()}_attach(){}_onDetach(){this._detach()}_detach(){}_onEnabled(){this.__firstEnable||(this._firstEnable(),this.__firstEnable=!0),this._enable()}_firstEnable(){}_enable(){}_onDisabled(){this._disable()}_disable(){}_onActive(){this.__firstActive||(this._firstActive(),this.__firstActive=!0),this._active()}_firstActive(){}_active(){}_onInactive(){this._inactive()}_inactive(){}get application(){return this.stage.application}__construct(){this._construct()}_construct(){}_build(){}__init(){this._init()}_init(){}_focus(t,e){}_unfocus(t){}_focusChange(t,e){}_getFocused(){return this}_setFocusSettings(t){}_handleFocusSettings(t){}static _template(){return{}}hasFinalFocus(){let t=this.application._focusPath;return t&&t.length&&t[t.length-1]===this}hasFocus(){let t=this.application._focusPath;return t&&t.indexOf(this)>=0}get cparent(){return at.getParent(this)}seekAncestorByType(t){let e=this.cparent;for(;e;){if(e.constructor===t)return e;e=e.cparent}}getSharedAncestorComponent(t){let e=this.getSharedAncestor(t);for(;e&&!e.isComponent;)e=e.parent;return e}get signals(){return this.__signals}set signals(t){b.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals=t}set alterSignals(t){b.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals||(this.__signals={});for(let e in t)t[e]===void 0?delete this.__signals[e]:this.__signals[e]=t}get passSignals(){return this.__passSignals||{}}set passSignals(t){this.__passSignals=Object.assign(this.__passSignals||{},t)}set alterPassSignals(t){b.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__passSignals||(this.__passSignals={});for(let e in t)t[e]===void 0?delete this.__passSignals[e]:this.__passSignals[e]=t}signal(t,...e){return this._signal(t,e)}_signal(t,e){const i=this._getParentSignalHandler();if(i){if(this.__signals){let r=this.__signals[t];if(r===!1)return;if(r){if(r===!0&&(r=t),b.isFunction(r))return r(...e);if(i._hasMethod(r))return i[r](...e)}}let s=this.__passSignals&&this.__passSignals[t];if(s)return s&&s!==!0&&(t=s),i._signal(t,e)}}_getParentSignalHandler(){return this.cparent?this.cparent._getSignalHandler():null}_getSignalHandler(){return this._signalProxy?this.cparent?this.cparent._getSignalHandler():null:this}get _signalProxy(){return!1}fireAncestors(t,...e){if(!t.startsWith("$"))throw new Error("Ancestor event name must be prefixed by dollar sign.");const i=this._getParentSignalHandler();if(i)return i._doFireAncestors(t,e)}_doFireAncestors(t,e){if(this._hasMethod(t))return this.fire(t,...e);{const i=this._getParentSignalHandler();if(i)return i._doFireAncestors(t,e)}}static collectSubComponents(t,e){if(e.hasChildren()){const i=e.__childList;for(let s=0,r=i.length;s<r;s++){const o=i.getAt(s);o.isComponent?t.push(o):at.collectSubComponents(t,o)}}}static getComponent(t){let e=t;for(;e&&!e.isComponent;)e=e.parent;return e}static getParent(t){return at.getComponent(t.parent)}}at.prototype.isComponent=!0;class qo{constructor(t){this.ctx=t,this.quadTextures=[],this.quadElements=[]}get length(){return this.quadTextures.length}reset(){this.quadTextures=[],this.quadElements=[],this.dataLength=0}getElement(t){return this.quadElements[t]._element}getElementCore(t){return this.quadElements[t]}getTexture(t){return this.quadTextures[t]}getTextureWidth(t){let e=this.quadTextures[t];return e.w?e.w:this.quadElements[t]._displayedTextureSource.w}getTextureHeight(t){let e=this.quadTextures[t];return e.h?e.h:this.quadElements[t]._displayedTextureSource.h}}class zu extends qo{constructor(t){super(t);const e=t.stage.getOption("bufferMemory");this.dataLength=0,this.data=new ArrayBuffer(e),this.floats=new Float32Array(this.data),this.uints=new Uint32Array(this.data)}getAttribsDataByteOffset(t){return t*80}getQuadContents(){let t=this.floats,e=this.uints,i=[];for(let s=1;s<=this.length;s++){let r="entry "+s+": ";for(let o=0;o<4;o++){let a=s*20+o*4;r+=t[a]+","+t[a+1]+":"+t[a+2]+","+t[a+3]+"["+e[a+4].toString(16)+"] "}i.push(r)}return i}}class Zo{constructor(t,e,i,s,r,o){this.ctx=t,this.shader=e,this.shaderOwner=i,this.renderTextureInfo=s,this.scissor=r,this.index=o,this.length=0}get quads(){return this.ctx.renderState.quads}getTexture(t){return this.quads.getTexture(this.index+t)}getElementCore(t){return this.quads.getElementCore(this.index+t)}getElement(t){return this.quads.getElement(this.index+t)}getElementWidth(t){return this.getElement(t).renderWidth}getElementHeight(t){return this.getElement(t).renderHeight}getTextureWidth(t){return this.quads.getTextureWidth(this.index+t)}getTextureHeight(t){return this.quads.getTextureHeight(this.index+t)}getRenderWidth(){return this.renderTextureInfo?this.renderTextureInfo.w:this.ctx.stage.w}getRenderHeight(){return this.renderTextureInfo?this.renderTextureInfo.h:this.ctx.stage.h}}class Mu extends Zo{constructor(t,e,i,s,r,o){super(t,e,i,s,r,o),this.extraAttribsDataByteOffset=0}getAttribsDataByteOffset(t){return this.quads.getAttribsDataByteOffset(this.index+t)}getNormalRenderTextureCoords(t,e){let i=this.shaderOwner.getRenderTextureCoords(t,e);return i[0]/=this.getRenderWidth(),i[1]/=this.getRenderHeight(),i[0]=i[0]*2-1,i[1]=1-i[1]*2,i}getProjection(){return this.renderTextureInfo===null?this.ctx.renderExec._projection:this.renderTextureInfo.nativeTexture.projection}}class Jo{constructor(t){this.ctx=t,this.renderState=t.renderState,this.gl=this.ctx.stage.gl}destroy(){this.ctx=null,this.renderState=null,this.gl=null,delete this.ctx,delete this.renderState,delete this.gl}_reset(){this._bindRenderTexture(null),this._setScissor(null),this._clearRenderTexture()}execute(){this._reset();let t=this.renderState.quadOperations,e=0,i=t.length;for(;e<i;)this._processQuadOperation(t[e]),e++}_processQuadOperation(t){t.renderTextureInfo&&t.renderTextureInfo.ignore||(this._setupQuadOperation(t),this._execQuadOperation(t))}_setupQuadOperation(t){}_execQuadOperation(t){let e=t.renderTextureInfo?t.renderTextureInfo.nativeTexture:null;this._renderTexture!==e&&this._bindRenderTexture(e),t.renderTextureInfo&&!t.renderTextureInfo.cleared?(this._setScissor(null),this._clearRenderTexture(),t.renderTextureInfo.cleared=!0,this._setScissor(t.scissor)):this._setScissor(t.scissor),this._renderQuadOperation(t)}_renderQuadOperation(t){}_bindRenderTexture(t){this._renderTexture=t}_clearRenderTexture(t){}_setScissor(t){}}class Ou extends Jo{constructor(t){super(t),this.gl=this.ctx.stage.gl,this.init()}init(){let t=this.gl;this._attribsBuffer=t.createBuffer();let e=Math.floor(this.renderState.quads.data.byteLength/80),i=new Uint16Array(e*6);for(let s=0,r=0;s<e;s+=6,r+=4)i[s]=r,i[s+1]=r+1,i[s+2]=r+2,i[s+3]=r,i[s+4]=r+2,i[s+5]=r+3;this._quadsBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),this._projection=new Float32Array([2/this.ctx.stage.coordsWidth,-2/this.ctx.stage.coordsHeight])}destroy(){super.destroy(),this.gl.deleteBuffer(this._attribsBuffer),this.gl.deleteBuffer(this._quadsBuffer),this.gl=null,delete this.gl}_reset(){super._reset();let t=this.gl;t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._stopShaderProgram(),this._setupBuffers()}_setupBuffers(){let t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer);let e=new Float32Array(this.renderState.quads.data,0,this.renderState.quads.dataLength);t.bindBuffer(t.ARRAY_BUFFER,this._attribsBuffer),t.bufferData(t.ARRAY_BUFFER,e,t.DYNAMIC_DRAW)}_setupQuadOperation(t){super._setupQuadOperation(t),this._useShaderProgram(t.shader,t)}_renderQuadOperation(t){let e=t.shader;(t.length||t.shader.addEmpty())&&(e.beforeDraw(t),e.draw(t),e.afterDraw(t))}_useShaderProgram(t,e){t.hasSameProgram(this._currentShaderProgram)||(this._currentShaderProgram&&this._currentShaderProgram.stopProgram(),t.useProgram(),this._currentShaderProgram=t),t.setupUniforms(e)}_stopShaderProgram(){this._currentShaderProgram&&(this._currentShaderProgram.stopProgram(),this._currentShaderProgram=null)}_bindRenderTexture(t){super._bindRenderTexture(t);let e=this.gl;this._renderTexture?(e.bindFramebuffer(e.FRAMEBUFFER,this._renderTexture.framebuffer),e.viewport(0,0,this._renderTexture.w,this._renderTexture.h)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.ctx.stage.w,this.ctx.stage.h))}_clearRenderTexture(){super._clearRenderTexture();let t=this.gl;if(this._renderTexture)t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT);else{let e=this.ctx.stage.getClearColor();e&&(t.clearColor(e[0]*e[3],e[1]*e[3],e[2]*e[3],e[3]),t.clear(t.COLOR_BUFFER_BIT))}}_setScissor(t){if(super._setScissor(t),this._scissor===t)return;this._scissor=t;let e=this.gl;if(!t)e.disable(e.SCISSOR_TEST);else{e.enable(e.SCISSOR_TEST);let i=this.ctx.stage.getRenderPrecision(),s=t[1];this._renderTexture===null&&(s=this.ctx.stage.h/i-(t[1]+t[3])),e.scissor(Math.round(t[0]*i),Math.round(s*i),Math.round(t[2]*i),Math.round(t[3]*i))}}}class ta{constructor(t){this.ctx=t,this.stage=t.stage,this.defaultShader=this.stage.renderer.getDefaultShader(t),this.renderer=t.stage.renderer,this.quads=this.renderer.createCoreQuadList(t)}reset(){this._renderTextureInfo=null,this._scissor=null,this._shader=null,this._shaderOwner=null,this._realShader=null,this._check=!1,this.quadOperations=[],this._texturizer=null,this._texturizerTemporary=!1,this._quadOperation=null,this.quads.reset(),this._temporaryTexturizers=[],this._isCachingTexturizer=!1}get length(){return this.quads.quadTextures.length}setShader(t,e){(this._shaderOwner!==e||this._realShader!==t)&&(this._realShader=t,t.useDefault()&&(t=this.defaultShader),(this._shader!==t||this._shaderOwner!==e)&&(this._shader=t,this._shaderOwner=e,this._check=!0))}get renderTextureInfo(){return this._renderTextureInfo}setScissor(t){this._scissor!==t&&(t?this._scissor=t:this._scissor=null,this._check=!0)}getScissor(){return this._scissor}setRenderTextureInfo(t){this._renderTextureInfo!==t&&(this._renderTextureInfo=t,this._scissor=null,this._check=!0)}setTexturizer(t,e=!1){this._texturizer=t,this._cacheTexturizer=e}set isCachingTexturizer(t){this._isCachingTexturizer=t}get isCachingTexturizer(){return this._isCachingTexturizer}addQuad(t){this._quadOperation?this._check&&this._hasChanges()&&(this._finishQuadOperation(),this._check=!1):this._createQuadOperation();let e=null;this._texturizer&&(e=this._texturizer.getResultTexture(),this._cacheTexturizer||this._temporaryTexturizers.push(this._texturizer)),e||(e=t._displayedTextureSource.nativeTexture),this._renderTextureInfo&&(this._shader===this.defaultShader&&this._renderTextureInfo.empty?(this._renderTextureInfo.nativeTexture=e,this._renderTextureInfo.offset=this.length):this._renderTextureInfo.nativeTexture=null,this._renderTextureInfo.empty=!1),this.quads.quadTextures.push(e),this.quads.quadElements.push(t),this._quadOperation.length++,this.renderer.addQuad(this,this.quads,this.length-1)}finishedRenderTexture(){this._renderTextureInfo.nativeTexture&&(this._isRenderTextureReusable()||(this._renderTextureInfo.nativeTexture=null))}_isRenderTextureReusable(){const t=this._renderTextureInfo.offset;return this.quads.quadTextures[t].w===this._renderTextureInfo.w&&this.quads.quadTextures[t].h===this._renderTextureInfo.h&&this.renderer.isRenderTextureReusable(this,this._renderTextureInfo)}_hasChanges(){let t=this._quadOperation;return this._shader!==t.shader||this._shaderOwner!==t.shaderOwner||this._renderTextureInfo!==t.renderTextureInfo||this._scissor!==t.scissor&&(this._scissor[0]!==t.scissor[0]||this._scissor[1]!==t.scissor[1]||this._scissor[2]!==t.scissor[2]||this._scissor[3]!==t.scissor[3])}_finishQuadOperation(t=!0){if(this._quadOperation){if((this._quadOperation.length||this._shader.addEmpty())&&(!this._quadOperation.scissor||this._quadOperation.scissor[2]>0&&this._quadOperation.scissor[3]>0)&&this.quadOperations.push(this._quadOperation),this._temporaryTexturizers.length){for(let e=0,i=this._temporaryTexturizers.length;e<i;e++)this._temporaryTexturizers[e].releaseRenderTexture();this._temporaryTexturizers=[]}this._quadOperation=null}t&&this._createQuadOperation()}_createQuadOperation(){this._quadOperation=this.renderer.createCoreQuadOperation(this.ctx,this._shader,this._shaderOwner,this._renderTextureInfo,this._scissor,this.length),this._check=!1}finish(){this._quadOperation&&this._finishQuadOperation(!1),this.renderer.finishRenderState(this)}}class Du{constructor(t,e){this.vertexShaderSource=t,this.fragmentShaderSource=e,this._program=null,this.gl=null,this._uniformLocations=new Map,this._attributeLocations=new Map,this._currentUniformValues={}}compile(t){if(this._program)return;this.gl=t,this._program=t.createProgram();let e=this._glCompile(t.VERTEX_SHADER,this.vertexShaderSource),i=this._glCompile(t.FRAGMENT_SHADER,this.fragmentShaderSource);t.attachShader(this._program,e),t.attachShader(this._program,i),t.linkProgram(this._program),t.getProgramParameter(this._program,t.LINK_STATUS)||(console.error("[Lightning] Error: Could not initialize shader."),console.error("[Lightning] gl.VALIDATE_STATUS",t.getProgramParameter(this._program,t.VALIDATE_STATUS)),console.error("[Lightning] gl.getError()",t.getError()),t.getProgramInfoLog(this._program)!==""&&console.warn("[Lightning] Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(this._program)),t.deleteProgram(this._program),this._program=null),t.deleteShader(e),t.deleteShader(i)}_glCompile(t,e){let i=this.gl.createShader(t);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){console.error("[Lightning]",this.constructor.name,"Type: "+(t===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader")),console.error("[Lightning]",this.gl.getShaderInfoLog(i));let s=0;return console.error("[Lightning]","========== source ==========\n"+e.split("\n").map(r=>""+ ++s+": "+r).join("\n")),null}return i}getUniformLocation(t){let e=this._uniformLocations.get(t);return e===void 0&&(e=this.gl.getUniformLocation(this._program,t),this._uniformLocations.set(t,e)),e}getAttribLocation(t){let e=this._attributeLocations.get(t);return e===void 0&&(e=this.gl.getAttribLocation(this._program,t),this._attributeLocations.set(t,e)),e}destroy(){this._program&&this.gl.deleteProgram(this._program),this._attributeLocations=null,this._currentUniformValues=null,this.fragmentShaderSource=null,this._program=null,this.gl=null,this._uniformLocations=null,this.vertexShaderSource=null,delete this.vertexShaderSource,delete this._program,delete this._currentUniformValues,delete this.fragmentShaderSource,delete this.gl,delete this._uniformLocations,delete this._attributeLocations}get glProgram(){return this._program}get compiled(){return!!this._program}_valueEquals(t,e){if(t.length&&e.length){for(let i=0,s=t.length;i<s;i++)if(t[i]!==e[i])return!1;return!0}else return t===e}_valueClone(t){return t.length?t.slice(0):t}setUniformValue(t,e,i){let s=this._currentUniformValues[t];if(s===void 0||!this._valueEquals(s,e)){let r=this._valueClone(e);this._currentUniformValues[t]=r;let o=this.getUniformLocation(t);o&&(i===this.gl.uniformMatrix2fv||i===this.gl.uniformMatrix3fv||i===this.gl.uniformMatrix4fv?i.call(this.gl,o,!1,r):i.call(this.gl,o,r))}}}class Fs extends Ii{constructor(t){super(t);const e=t.stage;this._program=e.renderer.shaderPrograms.get(this.constructor),this._program||(this._program=new Du(this.constructor.vertexShaderSource,this.constructor.fragmentShaderSource),e.renderer.shaderPrograms.set(this.constructor,this._program)),this.gl=e.gl}get glProgram(){return this._program.glProgram}_init(){this._initialized||(this.initialize(),this._initialized=!0)}initialize(){this._program.compile(this.gl)}get initialized(){return this._initialized}_uniform(t){return this._program.getUniformLocation(t)}_attrib(t){return this._program.getAttribLocation(t)}_setUniform(t,e,i){this._program.setUniformValue(t,e,i)}useProgram(){this._init(),this.gl.useProgram(this.glProgram),this.beforeUsage(),this.enableAttribs()}stopProgram(){this.afterUsage(),this.disableAttribs()}hasSameProgram(t){return t&&(t===this||t._program===this._program)}beforeUsage(){}afterUsage(){}enableAttribs(){}disableAttribs(){}getExtraAttribBytesPerVertex(){return 0}getVertexAttribPointerOffset(t){return t.extraAttribsDataByteOffset-t.index*4*this.getExtraAttribBytesPerVertex()}setExtraAttribsInBuffer(t){}setupUniforms(t){}_getProjection(t){return t.getProjection()}getFlipY(t){return this._getProjection(t)[1]<0}beforeDraw(t){}draw(t){}afterDraw(t){}cleanup(){this._initialized=!1}}let G=class extends Fs{enableAttribs(){let t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,2*4),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),this._attrib("aColor")!==-1&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,4*4),t.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){let t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),this._attrib("aColor")!==-1&&t.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}draw(t){let e=this.gl,i=t.length;if(i){let s=t.getTexture(0),r=0;for(let o=0;o<i;o++){let a=t.getTexture(o);s!==a&&(e.bindTexture(e.TEXTURE_2D,s),e.drawElements(e.TRIANGLES,6*(o-r),e.UNSIGNED_SHORT,(r+t.index)*6*2),s=a,r=o)}e.bindTexture(e.TEXTURE_2D,s),e.drawElements(e.TRIANGLES,6*(i-r),e.UNSIGNED_SHORT,(r+t.index)*6*2)}}};G.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";G.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";class ea{constructor(t){this.stage=t,this._defaultShader=void 0}gc(t){}destroy(){}getDefaultShader(t=this.stage.ctx){return this._defaultShader||(this._defaultShader=this._createDefaultShader(t)),this._defaultShader}_createDefaultShader(t){}isValidShaderType(t){return t.prototype instanceof this._getShaderBaseType()}createShader(t,e){const i=e.type;if(this.isValidShaderType(i)){const s=new i(t);return xt.patchObject(this,e),s}else{const s=this._getShaderAlternative(i);return s?new s(t):(console.warn("[Lightning] Shader has no implementation for render target: "+i.name),this._createDefaultShader(t))}}_getShaderBaseType(){}_getShaderAlternative(t){return this.getDefaultShader()}copyRenderTexture(t,e,i){console.warn("[Lightning] copyRenderTexture not supported by renderer")}}class ia extends ea{constructor(t){super(t),this.shaderPrograms=new Map,this._compressedTextureExtensions={astc:t.gl.getExtension("WEBGL_compressed_texture_astc"),etc1:t.gl.getExtension("WEBGL_compressed_texture_etc1"),s3tc:t.gl.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:t.gl.getExtension("WEBGL_compressed_texture_pvrtc")}}getCompressedTextureExtensions(){return this._compressedTextureExtensions}destroy(){this.shaderPrograms.forEach(t=>t.destroy()),this.shaderPrograms=null,this._compressedTextureExtensions=null,delete this.shaderPrograms,delete this._compressedTextureExtensions}_createDefaultShader(t){return new G(t)}_getShaderBaseType(){return Fs}_getShaderAlternative(t){return t.getWebGL&&t.getWebGL()}createCoreQuadList(t){return new zu(t)}createCoreQuadOperation(t,e,i,s,r,o){return new Mu(t,e,i,s,r,o)}createCoreRenderExecutor(t){return new Ou(t)}createCoreRenderState(t){return new ta(t)}createRenderTexture(t,e,i,s){const r=this.stage.gl,o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i,s,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),o.params={},o.params[r.TEXTURE_MAG_FILTER]=r.LINEAR,o.params[r.TEXTURE_MIN_FILTER]=r.LINEAR,o.params[r.TEXTURE_WRAP_S]=r.CLAMP_TO_EDGE,o.params[r.TEXTURE_WRAP_T]=r.CLAMP_TO_EDGE,o.options={format:r.RGBA,internalFormat:r.RGBA,type:r.UNSIGNED_BYTE},o.framebuffer=r.createFramebuffer(),o.projection=new Float32Array([2/t,2/e]),r.bindFramebuffer(r.FRAMEBUFFER,o.framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0),o}freeRenderTexture(t){let e=this.stage.gl;e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t)}_getBytesPerPixel(t,e){const i=this.stage.gl;if(t===i.RGBA)switch(e){case i.UNSIGNED_BYTE:return 4;case i.UNSIGNED_SHORT_4_4_4_4:return 2;case i.UNSIGNED_SHORT_5_5_5_1:return 2;default:throw new Error("Invalid type specified for GL_RGBA format")}else if(t===i.RGB)switch(e){case i.UNSIGNED_BYTE:return 3;case i.UNSIGNED_BYTE_5_6_5:return 2;default:throw new Error("Invalid type specified for GL_RGB format")}else throw new Error("Invalid format specified in call to _getBytesPerPixel()")}uploadTextureSource(t,e){const i=this.stage.gl,s=e.source;let r=!1;e.renderInfo&&(r=e.renderInfo.compressed||!1);const o={premultiplyAlpha:!0,hasAlpha:!0};e&&e.hasOwnProperty("premultiplyAlpha")&&(o.premultiplyAlpha=e.premultiplyAlpha),e&&e.hasOwnProperty("flipBlueRed")&&(o.flipBlueRed=e.flipBlueRed),e&&e.hasOwnProperty("hasAlpha")&&(o.hasAlpha=e.hasAlpha),o.hasAlpha||(o.premultiplyAlpha=!1),o.texParams=e.texParams||{},o.texOptions=e.texOptions||{};let a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),b.isNode&&i.pixelStorei(i.UNPACK_FLIP_BLUE_RED,!!o.flipBlueRed);const h=o.texParams;if(h[i.TEXTURE_MAG_FILTER]||(h[i.TEXTURE_MAG_FILTER]=i.LINEAR),h[i.TEXTURE_MIN_FILTER]||(h[i.TEXTURE_MIN_FILTER]=i.LINEAR),h[i.TEXTURE_WRAP_S]||(h[i.TEXTURE_WRAP_S]=i.CLAMP_TO_EDGE),h[i.TEXTURE_WRAP_T]||(h[i.TEXTURE_WRAP_T]=i.CLAMP_TO_EDGE),Object.keys(h).forEach(c=>{const u=h[c];i.texParameteri(i.TEXTURE_2D,parseInt(c),u)}),r)return this.stage.platform.uploadCompressedGlTexture(i,t,s),a;const l=o.texOptions;return l.format=l.format||(o.hasAlpha?i.RGBA:i.RGB),l.type=l.type||i.UNSIGNED_BYTE,l.internalFormat=l.internalFormat||l.format,e&&e.imageRef&&(l.imageRef=e.imageRef),this.stage.platform.uploadGlTexture(i,t,s,l),a.params=b.cloneObjShallow(h),a.options=b.cloneObjShallow(l),a.bytesPerPixel=this._getBytesPerPixel(l.format,l.type),a}freeTextureSource(t){this.stage.gl.deleteTexture(t.nativeTexture)}addQuad(t,e,i){let s=i*20;const r=e.quadElements[i];let o=r._renderContext,a=t.quads.floats,h=t.quads.uints;const l=M.mergeColorAlpha;if(o.tb!==0||o.tc!==0)a[s++]=o.px,a[s++]=o.py,a[s++]=r._ulx,a[s++]=r._uly,h[s++]=l(r._colorUl,o.alpha),a[s++]=o.px+r._w*o.ta,a[s++]=o.py+r._w*o.tc,a[s++]=r._brx,a[s++]=r._uly,h[s++]=l(r._colorUr,o.alpha),a[s++]=o.px+r._w*o.ta+r._h*o.tb,a[s++]=o.py+r._w*o.tc+r._h*o.td,a[s++]=r._brx,a[s++]=r._bry,h[s++]=l(r._colorBr,o.alpha),a[s++]=o.px+r._h*o.tb,a[s++]=o.py+r._h*o.td,a[s++]=r._ulx,a[s++]=r._bry,h[s]=l(r._colorBl,o.alpha);else{let c=o.px+r._w*o.ta,u=o.py+r._h*o.td;a[s++]=o.px,a[s++]=o.py,a[s++]=r._ulx,a[s++]=r._uly,h[s++]=l(r._colorUl,o.alpha),a[s++]=c,a[s++]=o.py,a[s++]=r._brx,a[s++]=r._uly,h[s++]=l(r._colorUr,o.alpha),a[s++]=c,a[s++]=u,a[s++]=r._brx,a[s++]=r._bry,h[s++]=l(r._colorBr,o.alpha),a[s++]=o.px,a[s++]=u,a[s++]=r._ulx,a[s++]=r._bry,h[s]=l(r._colorBl,o.alpha)}}isRenderTextureReusable(t,e){let i=t._renderTextureInfo.offset*80/4,s=t.quads.floats,r=t.quads.uints;return s[i]===0&&s[i+1]===0&&s[i+2]===0&&s[i+3]===0&&r[i+4]===4294967295&&s[i+5]===e.w&&s[i+6]===0&&s[i+7]===1&&s[i+8]===0&&r[i+9]===4294967295&&s[i+10]===e.w&&s[i+11]===e.h&&s[i+12]===1&&s[i+13]===1&&r[i+14]===4294967295&&s[i+15]===0&&s[i+16]===e.h&&s[i+17]===0&&s[i+18]===1&&r[i+19]===4294967295}finishRenderState(t){let e=t.length*80;for(let i=0,s=t.quadOperations.length;i<s;i++){t.quadOperations[i].extraAttribsDataByteOffset=e;let r=t.quadOperations[i].shader.getExtraAttribBytesPerVertex()*4*t.quadOperations[i].length;e+=r,r&&t.quadOperations[i].shader.setExtraAttribsInBuffer(t.quadOperations[i],t.quads)}t.quads.dataLength=e}copyRenderTexture(t,e,i){const s=this.stage.gl;s.bindTexture(s.TEXTURE_2D,e),s.bindFramebuffer(s.FRAMEBUFFER,t.framebuffer);const r=t.precision;s.copyTexSubImage2D(s.TEXTURE_2D,0,r*(i.sx||0),r*(i.sy||0),r*(i.x||0),r*(i.y||0),r*(i.w||t.ow),r*(i.h||t.oh))}}class ku extends qo{constructor(t){super(t),this.renderContexts=[],this.modes=[]}setRenderContext(t,e){this.renderContexts[t]=e}setSimpleTc(t,e){e?this.modes[t]|=1:this.modes[t]-=this.modes[t]&1}setWhite(t,e){e?this.modes[t]|=2:this.modes[t]-=this.modes[t]&2}getRenderContext(t){return this.renderContexts[t]}getSimpleTc(t){return this.modes[t]&1}getWhite(t){return this.modes[t]&2}}class Uu extends Zo{getRenderContext(t){return this.quads.getRenderContext(this.index+t)}getSimpleTc(t){return this.quads.getSimpleTc(this.index+t)}getWhite(t){return this.quads.getWhite(this.index+t)}}class Hr extends Jo{init(){this._mainRenderTexture=this.ctx.stage.getCanvas()}_renderQuadOperation(t){let e=t.shader;if(t.length||t.shader.addEmpty()){const i=this._renderTexture||this._mainRenderTexture;e.beforeDraw(t,i),e.draw(t,i),e.afterDraw(t,i)}}_clearRenderTexture(){const t=this._getContext();let e=[0,0,0,0];this._mainRenderTexture.ctx===t&&(e=this.ctx.stage.getClearColor());const i=t.canvas;t.setTransform(1,0,0,1,0,0),!e[0]&&!e[1]&&!e[2]&&!e[3]?t.clearRect(0,0,i.width,i.height):(t.fillStyle=M.getRgbaStringFromArray(e),t.globalCompositeOperation="copy",t.beginPath(),t.rect(0,0,i.width,i.height),t.closePath(),t.fill(),t.globalCompositeOperation="source-over")}_getContext(){return this._renderTexture?this._renderTexture.ctx:this._mainRenderTexture.ctx}_restoreContext(){const t=this._getContext();t.restore(),t.save(),t._scissor=null}_setScissor(t){const e=this._getContext();if(!Hr._equalScissorAreas(e.canvas,e._scissor,t)){this._restoreContext();let i=this.ctx.stage.getRenderPrecision();t&&(e.beginPath(),e.rect(Math.round(t[0]*i),Math.round(t[1]*i),Math.round(t[2]*i),Math.round(t[3]*i)),e.closePath(),e.clip()),e._scissor=t}}static _equalScissorAreas(t,e,i){return e||(e=[0,0,t.width,t.height]),i||(i=[0,0,t.width,t.height]),b.equalValues(e,i)}}class Wr extends Ii{beforeDraw(t){}draw(t){}afterDraw(t){}}class Bs extends Wr{constructor(t){super(t),this._rectangleTexture=t.stage.rectangleTexture.source.nativeTexture,this._tintManager=this.ctx.stage.renderer.tintManager}draw(t,e){const i=e.ctx;let s=t.length;for(let r=0;r<s;r++){const o=t.getTexture(r),a=t.getElementCore(r),h=t.getRenderContext(r),l=t.getWhite(r),c=t.getSimpleTc(r),u=this.ctx.stage.getRenderPrecision();i.setTransform(h.ta*u,h.tc*u,h.tb*u,h.td*u,h.px*u,h.py*u);const d=o===this._rectangleTexture,g={operation:t,target:e,index:r,rect:d};if(d)l?i.fillStyle="white":this._setColorGradient(i,a),i.globalAlpha=h.alpha,this._beforeDrawEl(g),i.fillRect(0,0,a.w,a.h),this._afterDrawEl(g),i.globalAlpha=1;else{i.globalAlpha=h.alpha,this._beforeDrawEl(g);const _=c?0:a._ulx*o.w,f=c?0:a._uly*o.h,y=(c?1:a._brx-a._ulx)*o.w,T=(c?1:a._bry-a._uly)*o.h;if(!l){let m=a._colorUl;(a._colorUl!==a._colorUr||a._colorUr!==a._colorBl||a._colorBr!==a._colorBl)&&(m=M.mergeMultiColorsEqual([a._colorUl,a._colorUr,a._colorBl,a._colorBr]));const p=(m/16777216|0)/255;i.globalAlpha*=p;const w=m&16777215,R=this._tintManager.getTintTexture(o,w);i.fillStyle="white",i.drawImage(R,_,f,y,T,0,0,a.w,a.h)}else i.fillStyle="white",i.drawImage(o,_,f,y,T,0,0,a.w,a.h);this._afterDrawEl(g),i.globalAlpha=1}}}_setColorGradient(t,e,i=e.w,s=e.h,r=!0){let o=e._colorUl,a;e._colorUl===e._colorUr?e._colorBl===e._colorBr&&(e._colorUl===e.colorBl||(a=t.createLinearGradient(0,0,0,s),r?(a.addColorStop(0,M.getRgbaString(e._colorUl)),a.addColorStop(1,M.getRgbaString(e._colorBl))):(a.addColorStop(0,M.getRgbString(e._colorUl)),a.addColorStop(1,M.getRgbString(e._colorBl))))):e._colorUl===e._colorBl&&e._colorUr===e._colorBr&&(a=t.createLinearGradient(0,0,i,0),r?(a.addColorStop(0,M.getRgbaString(e._colorUl)),a.addColorStop(1,M.getRgbaString(e._colorBr))):(a.addColorStop(0,M.getRgbString(e._colorUl)),a.addColorStop(1,M.getRgbString(e._colorBr)))),a?t.fillStyle=a:t.fillStyle=r?M.getRgbaString(o):M.getRgbString(o)}_beforeDrawEl(t){}_afterDrawEl(t){}}class Nu{constructor(t){this.stage=t,this._usedMemory=0,this._cachedNativeTextures=new Set}destroy(){this.gc(!0),this.stage=null,delete this.stage}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}delete(t){if(this._hasCache(t)){const e=this._getCache(t),i=e.memoryUsage;e.clear(),this._cachedNativeTextures.delete(t),this._addMemoryUsage(e.memoryUsage-i)}}getTintTexture(t,e){const i=this.stage.frameCounter;this._cachedNativeTextures.add(t);const s=this._getCache(t),r=s.get(e);if(r.lf=i,r.tx)return t.update>r.u&&this._tintTexture(r.tx,t,e),r.tx;{const o=s.memoryUsage;let a=s.reuseTexture(i);a?a.ctx.clearRect(0,0,a.width,a.height):(a=document.createElement("canvas"),a.width=t.w,a.height=t.h,a.ctx=a.getContext("2d")),this._tintTexture(a,t,e),s.set(e,a,i);const h=s.memoryUsage;return h!==o&&this._addMemoryUsage(h-o),a}}_tintTexture(t,e,i){let s=i.toString(16);for(;s.length<6;)s="0"+s;t.ctx.fillStyle="#"+s,t.ctx.globalCompositeOperation="copy",t.ctx.fillRect(0,0,e.w,e.h),t.ctx.globalCompositeOperation="multiply",t.ctx.drawImage(e,0,0,e.w,e.h,0,0,t.width,t.height),t.ctx.globalCompositeOperation="destination-in",t.ctx.drawImage(e,0,0,e.w,e.h,0,0,t.width,t.height)}_hasCache(t){return!!t._tintCache}_getCache(t){return t._tintCache||(t._tintCache=new Hu(t)),t._tintCache}gc(t=!1){const e=this.stage.frameCounter;let i=0;this._cachedNativeTextures.forEach(s=>{const r=this._getCache(s);if(t)i+=r.memoryUsage,r.clear();else{const o=r.memoryUsage;r.cleanup(e),r.releaseBlancoTextures(),i+=r.memoryUsage-o}}),t&&this._cachedNativeTextures.clear(),i&&this._addMemoryUsage(i)}}class Hu{constructor(t){this._tx=t,this._colors=new Map,this._blancoTextures=null,this._lastCleanupFrame=0,this._memTextures=0}get memoryUsage(){return this._memTextures*this._tx.w*this._tx.h}releaseBlancoTextures(){this._memTextures-=this._blancoTextures.length,this._blancoTextures=[]}clear(){this._blancoTextures=null,this._colors.clear(),this._memTextures=0}get(t){let e=this._colors.get(t);return e||(e={lf:-1,tx:void 0,u:-1},this._colors.set(t,e)),e}set(t,e,i){const s=this.get(t);s.lf=i,s.tx=e,s.u=i,this._memTextures++}cleanup(t){this._lastCleanupFrame!==t&&(this._blancoTextures=[],this._colors.forEach((e,i)=>{e.lf<t-1&&(e.tx&&this._blancoTextures.push(e.tx),this._colors.delete(i))}),this._lastCleanupFrame=t)}reuseTexture(t){if(this.cleanup(t),this._blancoTextures&&this._blancoTextures.length)return this._memTextures--,this._blancoTextures.pop()}}class Wu extends ea{constructor(t){super(t),this.tintManager=new Nu(t),this.setupC2d(this.stage.c2d.canvas)}destroy(){this.tintManager.destroy(),this.tintManager=null,delete this.tintManager}_createDefaultShader(t){return new Bs(t)}_getShaderBaseType(){return Wr}_getShaderAlternative(t){return t.getC2d&&t.getC2d()}createCoreQuadList(t){return new ku(t)}createCoreQuadOperation(t,e,i,s,r,o){return new Uu(t,e,i,s,r,o)}createCoreRenderExecutor(t){return new Hr(t)}createCoreRenderState(t){return new ta(t)}createRenderTexture(t,e,i,s){const r=document.createElement("canvas");return r.width=i,r.height=s,this.setupC2d(r),r}freeRenderTexture(t){this.tintManager.delete(t)}gc(t){this.tintManager.gc(t)}uploadTextureSource(t,e){if(e.source.buffer){const i=document.createElement("canvas");i.width=e.w,i.height=e.h;const s=new ImageData(new Uint8ClampedArray(e.source.buffer),e.w,e.h);return i.getContext("2d").putImageData(s,0,0),i}return e.source}freeTextureSource(t){this.tintManager.delete(t.nativeTexture)}addQuad(t,e,i){const s=e.quadElements[i];e.setRenderContext(i,s._renderContext),e.setWhite(i,s.isWhite()),e.setSimpleTc(i,s.hasSimpleTexCoords())}isRenderTextureReusable(t,e){return!1}finishRenderState(t){}setupC2d(t){const e=t.getContext("2d");t.ctx=e,e._scissor=null,t.ctx.save()}}class Qr extends Fs{enableAttribs(){let t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,2*4),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),this._attrib("aColor")!==-1&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,4*4),t.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){let t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),this._attrib("aColor")!==-1&&t.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}draw(t){let e=this.gl,i=t.length;if(i){let s=t.getTexture(0),r=0;for(let o=0;o<i;o++){let a=t.getTexture(o);if(s!==a){if(s.options&&s.options.imageRef){let h=o>0?o-1:o;const l=this.ctx.stage.getOption("precision");let c=t.getElementCore(h);this.ctx.stage.platform.paint(e,s.options.imageRef,c._worldContext.px*l,c._worldContext.py*l,c._colorUl,c)}else e.bindTexture(e.TEXTURE_2D,s),e.drawElements(e.TRIANGLES,6*(o-r),e.UNSIGNED_SHORT,(r+t.index)*6*2);s=a,r=o}}if(r<i)if(s.options&&s.options.imageRef){const o=this.ctx.stage.getOption("precision");let a=t.getElementCore(r);this.ctx.stage.platform.paint(e,s.options.imageRef,a._worldContext.px*o,a._worldContext.py*o,a._colorUl,a)}else e.bindTexture(e.TEXTURE_2D,s),e.drawElements(e.TRIANGLES,6*(i-r),e.UNSIGNED_SHORT,(r+t.index)*6*2)}}}Qr.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";Qr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";class Qu extends ia{constructor(t){super(t)}_createDefaultShader(t){return new Qr(t)}createCoreRenderExecutor(t){global.beginDrawing();let e=super.createCoreRenderExecutor(t);return global.endDrawing(),e}}class Yu{constructor(t={}){this._items=new Map,this._id=0,this._initWorker()}destroy(){this._worker&&this._worker.terminate(),this._items=null,this._worker=null,delete this._items,delete this._worker}_initWorker(){const t="(".concat(Xu.toString(),")()"),e=new Blob([t.replace('"use strict";',"")]),i=(window.URL?URL:webkitURL).createObjectURL(e,{type:"application/javascript; charset=utf-8"});this._worker=new Worker(i),this._worker.postMessage({type:"config",config:{path:window.location.href,protocol:window.location.protocol}}),this._worker.onmessage=s=>{if(s.data&&s.data.id){const r=s.data.id,o=this._items.get(r);o&&(s.data.type=="data"?this.finish(o,s.data.info):this.error(o,s.data.info))}}}create(t){const e=++this._id,i=new $u(this,e,t);return this._items.set(e,i),this._worker.postMessage({type:"add",id:e,src:t}),i}cancel(t){this._worker.postMessage({type:"cancel",id:t.id}),this._items.delete(t.id)}error(t,e){t.error(e),this._items.delete(t.id)}finish(t,e){t.load(e),this._items.delete(t.id)}}class $u{constructor(t,e,i){this._manager=t,this._id=e,this._src=i,this._onError=null,this._onLoad=null}get id(){return this._id}get src(){return this._src}set onError(t){this._onError=t}set onLoad(t){this._onLoad=t}cancel(){this._manager.cancel(this)}load(t){this._onLoad&&this._onLoad(t)}error(t){this._onError&&this._onError(t)}}const Xu=function(){function n(){this.items=new Map;var e=this;onmessage=function(i){e._receiveMessage(i)}}n.isPathAbsolute=function(e){return/^(?:\/|[a-z]+:\/\/)/.test(e)||e.substr(0,5)=="data:"},n.prototype._receiveMessage=function(e){if(e.data.type==="config"){this.config=e.data.config;var i=this.config.path,s=/#.*?\//;s.test(i)&&(i=i.replace(/#.*$/,""));var r=i.split("/");r.pop(),this._relativeBase=r.join("/")+"/"}else e.data.type==="add"?this.add(e.data.id,e.data.src):e.data.type==="cancel"&&this.cancel(e.data.id)},n.prototype.add=function(e,i){n.isPathAbsolute(i)||(i=this._relativeBase+i),i.substr(0,2)==="//"&&(i=this.config.protocol+i);var s=new t(e,i),r=this;s.onFinish=function(o){r.finish(s,o)},s.onError=function(o){r.error(s,o)},this.items.set(e,s),s.start()},n.prototype.cancel=function(e){var i=this.items.get(e);i&&(i.cancel(),this.items.delete(e))},n.prototype.finish=function(e,{imageBitmap:i,hasAlphaChannel:s}){postMessage({type:"data",id:e.id,info:{imageBitmap:i,hasAlphaChannel:s}},[i]),this.items.delete(e.id)},n.prototype.error=function(e,{type:i,message:s}){postMessage({type:"error",id:e.id,info:{type:i,message:s}}),this.items.delete(e.id)},n.isWPEBrowser=function(){return navigator.userAgent.indexOf("WPE")!==-1};function t(e,i){this._onError=void 0,this._onFinish=void 0,this._id=e,this._src=i,this._xhr=void 0,this._mimeType=void 0,this._canceled=!1}Object.defineProperty(t.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(t.prototype,"onFinish",{get:function(){return this._onFinish},set:function(e){this._onFinish=e}}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e}}),t.prototype.start=function(){this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._src,!0),this._xhr.responseType="blob";var e=this;this._xhr.onerror=function(i){e.error({type:"connection",message:"Connection error"})},this._xhr.onload=function(i){var s=e._xhr.response;e._mimeType=s.type,e._createImageBitmap(s)},this._xhr.send()},t.prototype._createImageBitmap=function(e){var i=this;createImageBitmap(e,{premultiplyAlpha:"premultiply",colorSpaceConversion:"none",imageOrientation:"none"}).then(function(s){i.finish({imageBitmap:s,hasAlphaChannel:i._hasAlphaChannel()})}).catch(function(s){i.error({type:"parse",message:"Error parsing image data"})})},t.prototype._hasAlphaChannel=function(){return n.isWPEBrowser()?!0:this._mimeType.indexOf("image/png")!==-1},t.prototype.cancel=function(){this._canceled||(this._xhr&&this._xhr.abort(),this._canceled=!0)},t.prototype.error=function(e,i){!this._canceled&&this._onError&&this._onError({type:e,message:i})},t.prototype.finish=function(e){!this._canceled&&this._onFinish&&this._onFinish(e)},new n};class Gu{init(t){this.stage=t,this._looping=!1,this._awaitingLoop=!1,this._loopHandler=null,this._idleLoopCounter=0,this._idleLoopDelay=60,this.stage.getOption("useImageWorker")&&(!window.createImageBitmap||!window.Worker?console.warn("[Lightning] Can't use image worker because browser does not have createImageBitmap and Web Worker support"):this._imageWorker=new Yu),this._registerVisibilityChangeHandler()}destroy(){this._imageWorker&&this._imageWorker.destroy(),clearInterval(this._loopHandler),this._removeKeyHandler(),this._removeClickHandler(),this._removeHoverHandler(),this._removeScrollWheelHandler(),this._removeVisibilityChangeHandler(),this.stage=null,delete this.stage}startLoop(){this._looping=!0,this._awaitingLoop||this.loop()}stopLoop(){this._looping=!1}switchLoop(){if(this._idleLoopCounter<this._idleLoopDelay){this._idleLoopCounter++;return}this.stage.ctx.hasRenderUpdates()?this._idleLoopCounter=0:(this.stopLoop(),this._loopHandler=setInterval(()=>{this.stage.updateFrame(),this.stage.idleFrame(),this.stage.ctx.hasRenderUpdates()&&(clearInterval(this._loopHandler),this.startLoop())},1e3/60))}loop(){let t=this,e=function(){t._awaitingLoop=!1,t._looping&&(t.stage.updateFrame(),t.stage.getOption("pauseRafLoopOnIdle")&&t.switchLoop(),t.stage.renderFrame(),requestAnimationFrame(e),t._awaitingLoop=!0)};requestAnimationFrame(e)}uploadCompressedGlTexture(t,e,i,s){const r=i.pvr?i.mipmaps[0]:new DataView(i.mipmaps[0]);t.compressedTexImage2D(t.TEXTURE_2D,0,i.glInternalFormat,i.pixelWidth,i.pixelHeight,0,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)}uploadGlTexture(t,e,i,s){if(i instanceof ImageData||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||window.ImageBitmap&&i instanceof ImageBitmap)t.texImage2D(t.TEXTURE_2D,0,s.internalFormat,s.format,s.type,i);else if(i instanceof HTMLCanvasElement){if(b.isZiggo||this.stage.getOption("forceTxCanvasSource"))t.texImage2D(t.TEXTURE_2D,0,s.internalFormat,s.format,s.type,i);else if(i.width>0&&i.height>0){const r=i.getContext("2d");t.texImage2D(t.TEXTURE_2D,0,s.internalFormat,s.format,s.type,r.getImageData(0,0,i.width,i.height))}}else t.texImage2D(t.TEXTURE_2D,0,s.internalFormat,e.w,e.h,0,s.format,s.type,i)}handleKtxLoad(t,e){var i=this;return function(){var s=this.response,r=new DataView(s),o=3632701469;o!==r.getUint32(0)+r.getUint32(4)+r.getUint32(8)&&t("Parsing failed: identifier ktx mismatch:",e);var a=r.getUint32(12)===16909060,h={glType:r.getUint32(16,a),glTypeSize:r.getUint32(20,a),glFormat:r.getUint32(24,a),glInternalFormat:r.getUint32(28,a),glBaseInternalFormat:r.getUint32(32,a),pixelWidth:r.getUint32(36,a),pixelHeight:r.getUint32(40,a),pixelDepth:r.getUint32(44,a),numberOfArrayElements:r.getUint32(48,a),numberOfFaces:r.getUint32(52,a),numberOfMipmapLevels:r.getUint32(56,a),bytesOfKeyValueData:r.getUint32(60,a),kvps:[],mipmaps:[],get width(){return this.pixelWidth},get height(){return this.pixelHeight}};const l=_=>{const f=[];for(let y in _)f.push(_[y]);return f};Object.values(i.stage.renderer.getCompressedTextureExtensions()).filter(_=>_!=null).map(_=>l(_)).reduce((_,f)=>_.concat(f)).includes(h.glInternalFormat)||console.warn("[Lightning] Unrecognized texture extension format:",e,h.glInternalFormat,i.stage.renderer.getCompressedTextureExtensions());var u=64;u+=h.bytesOfKeyValueData;for(var d=0;d<h.numberOfMipmapLevels;d++){var g=r.getUint32(u);u+=4,h.mipmaps.push(r.buffer.slice(u,g)),u+=g}t(null,{source:h,renderInfo:{src:e,compressed:!0}})}}handlePvrLoad(t,e){return function(){const l=this.response,c=new Int32Array(l,0,13),u=c[12]+52,d=new Uint8Array(l,u);var g={glInternalFormat:36196,pixelWidth:c[7],pixelHeight:c[6],numberOfMipmapLevels:c[11],mipmaps:[],pvr:!0,get width(){return this.pixelWidth},get height(){return this.pixelHeight}};let _=0,f=g.pixelWidth,y=g.pixelHeight;for(var T=0;T<g.numberOfMipmapLevels;T++){const x=(f+3>>2)*(y+3>>2)*8,m=new Uint8Array(l,d.byteOffset+_,x);g.mipmaps.push(m),_+=x,f=f>>1,y=y>>1}t(null,{source:g,renderInfo:{src:e,compressed:!0}})}}loadSrcTexture({src:t,hasAlpha:e},i){let s,r=t.toLowerCase().indexOf(".png")>=0||t.substr(0,21)=="data:image/png;base64",o=t.indexOf(".ktx")>=0,a=t.indexOf(".pvr")>=0;if(o||a){let h=new XMLHttpRequest;h.addEventListener("load",o?this.handleKtxLoad(i,t):this.handlePvrLoad(i,t)),h.open("GET",t),h.responseType="arraybuffer",h.send(),s=function(){h.abort()}}else if(this._imageWorker){const h=this._imageWorker.create(t);h.onError=function(l){return i("Image load error")},h.onLoad=function({imageBitmap:l,hasAlphaChannel:c}){i(null,{source:l,renderInfo:{src:t,compressed:!1},hasAlpha:c,premultiplyAlpha:!0})},s=function(){h.cancel()}}else{let h=new Image;t.substr(0,5)!="data:"&&!b.isPS4&&(h.crossOrigin="Anonymous"),h.onerror=function(l){if(h.src)return i("Image load error")},h.onload=function(){i(null,{source:h,renderInfo:{src:t,compressed:!1},hasAlpha:r||e})},h.src=t,s=function(){h.onerror=null,h.onload=null,h.removeAttribute("src")}}return s}createWebGLContext(t,e){let i=this.stage.getOption("canvas")||document.createElement("canvas");t&&e&&(i.width=t,i.height=e);let s={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1},r=i.getContext("webgl",s)||i.getContext("experimental-webgl",s)||i.getContext("webgl2",s);if(!r)throw new Error("This browser does not support webGL.");return r}createCanvasContext(t,e){let i=this.stage.getOption("canvas")||document.createElement("canvas");t&&e&&(i.width=t,i.height=e);let s=i.getContext("2d");if(!s)throw new Error("This browser does not support 2d canvas.");return s}getHrTime(){return window.performance?window.performance.now():new Date().getTime()}getDrawingCanvas(){return document.createElement("canvas")}getTextureOptionsForDrawingCanvas(t){let e={};return e.source=t,e}nextFrame(t){}registerKeydownHandler(t){this._keydownListener=e=>{t(e)},window.addEventListener("keydown",this._keydownListener)}registerKeyupHandler(t){this._keyupListener=e=>{t(e)},window.addEventListener("keyup",this._keyupListener)}_removeKeyHandler(){this._keydownListener&&window.removeEventListener("keydown",this._keydownListener),this._keyupListener&&window.removeEventListener("keyup",this._keyupListener)}registerClickHandler(t){this._clickListener=e=>{t(e)},window.addEventListener("mousedown",this._clickListener)}_removeClickHandler(){this._clickListener&&window.removeEventListener("mousedown",this._clickListener)}registerHoverHandler(t){this._hoverListener=e=>{t(e)},window.addEventListener("mousemove",this._hoverListener)}_removeHoverHandler(){this._hoverListener&&window.removeEventListener("mousemove",this._hoverListener)}registerScrollWheelHandler(t){this._scrollWheelListener=e=>{t(e)},window.addEventListener("wheel",this._scrollWheelListener)}_removeScrollWheelHandler(){this._scrollWheelListener&&window.removeEventListener("wheel",this._scrollWheelListener)}_registerVisibilityChangeHandler(){this._visibilityChangeHandler=()=>{document.visibilityState==="visible"&&(this.stage.root.core.setHasRenderUpdates(2),this.stage.renderFrame())},document.addEventListener("visibilitychange",this._visibilityChangeHandler)}_removeVisibilityChangeHandler(){this._visibilityChangeHandler&&document.removeEventListener("visibilitychange",this._visibilityChangeHandler)}}class ju{static load(t){return t.platform?t.platform:Gu}}class Qt{static isFunction(t){return typeof t=="function"}static isNumber(t){return typeof t=="number"}static isInteger(t){return typeof t=="number"&&t%1===0}static isBoolean(t){return t===!0||t===!1}static isString(t){return typeof t=="string"}static isObject(t){let e=typeof t;return!!t&&(e=="object"||e=="function")}static isPlainObject(t){return!!t&&typeof t=="object"}static isObjectLiteral(t){return typeof t=="object"&&t&&t.constructor===Object}static getArrayIndex(t,e){return Qt.getModuloIndex(t,e.length)}static equalValues(t,e){return typeof t!=typeof e?!1:Qt.isObjectLiteral(t)?Qt.isObjectLiteral(e)&&Qt.equalObjectLiterals(t,e):Array.isArray(t)?Array.isArray(e)&&Qt.equalArrays(t,e):t===e}static equalObjectLiterals(t,e){let i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(let r=0,o=i.length;r<o;r++){const a=i[r],h=s[r];if(a!==h)return!1;const l=t[a],c=e[h];if(!Qt.equalValues(l,c))return!1}return!0}static equalArrays(t,e){if(t.length!==e.length)return!1;for(let i=0,s=t.length;i<s;i++)if(!this.equalValues(t[i],e[i]))return!1;return!0}}class re{constructor(t,e){this._id=t,this._gl=e,this._program=void 0,this._buffers=new Map,this._framebuffers=new Map,this._renderbuffers=new Map,this._vertexAttribs=new Array(16),this._nonDefaultFlags=new Set,this._settings=new Map,this._textures=new Array(8),this._maxTexture=0,this._activeTexture=e.TEXTURE0,this._pixelStorei=new Array(5)}_getDefaultFlag(t){return t===this._gl.DITHER}setFlag(t,e){const i=this._getDefaultFlag(t);return e===i?this._nonDefaultFlags.delete(t):this._nonDefaultFlags.has(t)?!1:(this._nonDefaultFlags.add(t),!0)}setBuffer(t,e){const i=this._buffers.get(t)!==e;return this._buffers.set(t,e),i&&t===this._gl.ARRAY_BUFFER&&(this._vertexAttribs=[]),i}setFramebuffer(t,e){const i=this._framebuffers.get(t)!==e;return this._framebuffers.set(t,e),i}setRenderbuffer(t,e){const i=this._renderbuffers.get(t)!==e;return this._renderbuffers.set(t,e),i}setProgram(t){const e=this._program!==t;return this._program=t,e}setSetting(t,e){const i=this._settings.get(t),s=!i||!Qt.equalValues(i,e);return this._settings.set(t,e),s}disableVertexAttribArray(t){const e=this._vertexAttribs[t];return e&&e[5]?(e[5]=!1,!0):!1}enableVertexAttribArray(t){const e=this._vertexAttribs[t];if(e){if(!e[0])return e[0]=!0,!0}else return this._vertexAttribs[t]=[0,0,0,0,0,!0],!0;return!1}vertexAttribPointer(t,e){let i=this._vertexAttribs[t],s=!1;return i&&(s=i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]),s?!1:(e[5]=i?i[5]:!1,!0)}setActiveTexture(t){const e=this._activeTexture!==t;return this._activeTexture=t,e}bindTexture(t,e){const i=re._getTextureIndex(this._activeTexture);this._maxTexture=Math.max(this._maxTexture,i+1);const s=this._textures[i],r=re._getTextureTargetIndex(t);return s?s[r]===e?!1:(s[r]=e,!0):e?(this._textures[i]=[],this._textures[i][r]=e,!0):!1}setPixelStorei(t,e){const i=re._getPixelStoreiIndex(t),s=!Qt.equalValues(this._pixelStorei[i],e);return this._pixelStorei[i]=e,s}migrate(t){const e=this;this._migrateFlags(e,t),t._program!==e._program&&this._gl._useProgram(t._program),this._migrateFramebuffers(e,t),this._migrateRenderbuffers(e,t);const i=this._migrateBuffers(e,t);this._migrateAttributes(e,t,i),this._migrateFlags(e,t),this._migrateSettings(e,t),this._migratePixelStorei(e,t),this._migrateTextures(e,t)}_migratePixelStorei(t,e){for(let i=0,s=t._pixelStorei.length;i<s;i++)if(t._pixelStorei[i]!==e._pixelStorei[i]){const r=e._pixelStorei[i]!==void 0?e._pixelStorei[i]:re._getDefaultPixelStoreiByIndex(i);this._gl._pixelStorei(re._getPixelStoreiByIndex(i),r)}}_migrateTextures(t,e){const i=Math.max(t._maxTexture,e._maxTexture);let s=t._activeTexture;for(let r=0;r<i;r++){const o=e._textures[r],a=t._textures[r],h=re._getTextureByIndex(r),l=Math.max(a?a.length:0,o?o.length:0);for(let c=0,u=l;c<u;c++){const d=re._getTextureTargetByIndex(c);s!==h&&(this._gl._activeTexture(h),s=h);const g=o&&o[c]||null;this._gl._bindTexture(d,g)}}e._activeTexture!==s&&this._gl._activeTexture(e._activeTexture)}_migrateBuffers(t,e){return e._buffers.forEach((i,s)=>{t._buffers.get(s)!==i&&this._gl._bindBuffer(s,i)}),t._buffers.forEach((i,s)=>{e._buffers.get(s)===void 0&&this._gl._bindBuffer(s,null)}),e._buffers.get(this._gl.ARRAY_BUFFER)!==t._buffers.get(this._gl.ARRAY_BUFFER)}_migrateFramebuffers(t,e){e._framebuffers.forEach((i,s)=>{t._framebuffers.get(s)!==i&&this._gl._bindFramebuffer(s,i)}),t._framebuffers.forEach((i,s)=>{e._framebuffers.get(s)===void 0&&this._gl._bindFramebuffer(s,null)})}_migrateRenderbuffers(t,e){e._renderbuffers.forEach((i,s)=>{t._renderbuffers.get(s)!==i&&this._gl._bindRenderbuffer(s,i)}),t._renderbuffers.forEach((i,s)=>{e._renderbuffers.get(s)===void 0&&this._gl._bindRenderbuffer(s,null)})}_migrateAttributes(t,e,i){i?e._vertexAttribs.forEach((s,r)=>{s[0]&&this._gl._vertexAttribPointer(r,s[0],s[1],s[2],s[3],s[4]),s[5]&&this._gl._enableVertexAttribArray(r)}):(t._vertexAttribs.forEach((s,r)=>{e._vertexAttribs[r]||this._gl._disableVertexAttribArray(r)}),e._vertexAttribs.forEach((s,r)=>{this._gl._vertexAttribPointer(r,s[0],s[1],s[2],s[4]),s[5]?this._gl._enableVertexAttribArray(r):this._gl._disableVertexAttribArray(r)}))}_migrateSettings(t,e){const i=this.constructor.getDefaultSettings();t._settings.forEach((s,r)=>{const o=r.name||r.xname;if(!e._settings.has(r)){let a=i.get(o);Qt.isFunction(a)&&(a=a(this._gl)),e._settings.set(r,a),r.apply(this._gl,a)}}),e._settings.forEach((s,r)=>{const o=t._settings.get(r);(!o||!Qt.equalValues(o,s))&&r.apply(this._gl,s)})}_migrateFlags(t,e){t._nonDefaultFlags.forEach(i=>{e._nonDefaultFlags.has(i)||(this._getDefaultFlag(i)?this._gl._enable(i):this._gl._disable(i))}),e._nonDefaultFlags.forEach(i=>{t._nonDefaultFlags.has(i)||(this._getDefaultFlag(i)?this._gl._disable(i):this._gl._enable(i))})}static getDefaultSettings(){if(!this._defaultSettings){this._defaultSettings=new Map;const t=this._defaultSettings,e=WebGLRenderingContext.prototype;t.set("viewport",function(i){return[0,0,i.canvas.width,i.canvas.height]}),t.set("scissor",function(i){return[0,0,i.canvas.width,i.canvas.height]}),t.set("blendColor",[0,0,0,0]),t.set("blendEquation",[e.FUNC_ADD]),t.set("blendEquationSeparate",[e.FUNC_ADD,e.FUNC_ADD]),t.set("blendFunc",[e.ONE,e.ZERO]),t.set("blendFuncSeparate",[e.ONE,e.ZERO,e.ONE,e.ZERO]),t.set("clearColor",[0,0,0,0]),t.set("clearDepth",[1]),t.set("clearStencil",[0]),t.set("colorMask",[!0,!0,!0,!0]),t.set("cullFace",[e.BACK]),t.set("depthFunc",[e.LESS]),t.set("depthMask",[!0]),t.set("depthRange",[0,1]),t.set("frontFace",[e.CCW]),t.set("lineWidth",[1]),t.set("polygonOffset",[0,0]),t.set("sampleCoverage",[1,!1]),t.set("stencilFunc",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateFront",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateBack",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateFrontAndBack",[e.ALWAYS,0,1]),t.set("stencilMask",[1]),t.set("_stencilMaskSeparateFront",[1]),t.set("_stencilMaskSeparateBack",[1]),t.set("_stencilMaskSeparateFrontAndBack",[1]),t.set("stencilOp",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateFront",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateBack",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateFrontAndBack",[e.KEEP,e.KEEP,e.KEEP]),t.set("vertexAttrib1f",[]),t.set("vertexAttrib1fv",[]),t.set("vertexAttrib2f",[]),t.set("vertexAttrib2fv",[]),t.set("vertexAttrib3f",[]),t.set("vertexAttrib3fv",[]),t.set("vertexAttrib4f",[]),t.set("vertexAttrib4fv",[])}return this._defaultSettings}static _getTextureTargetIndex(t){switch(t){case 3553:return 0;case 34067:return 1;default:throw new Error("Unknown texture target: "+t)}}static _getTextureTargetByIndex(t){return this._textureTargetIndices||(this._textureTargetIndices=[3553,34067]),this._textureTargetIndices[t]}static _getTextureIndex(t){return t-33984}static _getTextureByIndex(t){return t+33984}static _getPixelStoreiIndex(t){switch(t){case 3333:return 0;case 3317:return 1;case 37440:return 2;case 37441:return 3;case 37443:return 4;case 37445:return 5;default:throw new Error("Unknown pixelstorei: "+t)}}static _getPixelStoreiByIndex(t){return this._pixelStoreiIndices||(this._pixelStoreiIndices=[3333,3317,37440,37441,37443]),this._pixelStoreiIndices[t]}static _getDefaultPixelStoreiByIndex(t){return this._pixelStoreiDefaults||(this._pixelStoreiDefaults=[4,4,!1,!1,WebGLRenderingContext.prototype.BROWSER_DEFAULT_WEBGL]),this._pixelStoreiDefaults[t]}}class Ai{_initStateManager(t="default"){this._states={},this._state=this._getState(t)}_getState(t){return this._states[t]||(this._states[t]=new re(t,this)),this._states[t]}switchState(t="default"){if(this._state._id!==t){const e=this._getState(t);this._state.migrate(e),this._state=e}}$useProgram(t){this._state.setProgram(t)&&this._useProgram(t)}$bindBuffer(t,e){this._state.setBuffer(t,e)&&this._bindBuffer(t,e)}$bindFramebuffer(t,e){this._state.setFramebuffer(t,e)&&this._bindFramebuffer(t,e)}$bindRenderbuffer(t,e){this._state.setRenderbuffer(t,e)&&this._bindRenderbuffer(t,e)}$enable(t){this._state.setFlag(t,!0)&&this._enable(t)}$disable(t){this._state.setFlag(t,!1)&&this._disable(t)}$viewport(t,e,i,s){this._state.setSetting(this._viewport,[t,e,i,s])&&this._viewport(t,e,i,s)}$scissor(t,e,i,s){this._state.setSetting(this._scissor,[t,e,i,s])&&this._scissor(t,e,i,s)}$disableVertexAttribArray(t){this._state.disableVertexAttribArray(t)&&this._disableVertexAttribArray(t)}$enableVertexAttribArray(t){this._state.enableVertexAttribArray(t)&&this._enableVertexAttribArray(t)}$vertexAttribPointer(t,e,i,s,r,o){this._state.vertexAttribPointer(t,[e,i,s,r,o])&&this._vertexAttribPointer(t,e,i,s,r,o)}$activeTexture(t){this._state.setActiveTexture(t)&&this._activeTexture(t)}$bindTexture(t,e){this._state.bindTexture(t,e)&&this._bindTexture(t,e)}$pixelStorei(t,e){this._state.setPixelStorei(t,e)&&this._pixelStorei(t,e)}$stencilFuncSeparate(t,e,i,s){let r;switch(t){case this.FRONT:r=this._stencilFuncSeparateFront;break;case this.BACK:r=this._stencilFuncSeparateBack;break;case this.FRONT_AND_BACK:r=this._stencilFuncSeparateFrontAndBack;break}this._state.setSetting(r,[e,i,s])&&r.apply(this,[e,i,s])}_stencilFuncSeparateFront(t,e,i){this._stencilFuncSeparate(this.FRONT,t,e,i)}_stencilFuncSeparateBack(t,e,i){this._stencilFuncSeparate(this.BACK,t,e,i)}_stencilFuncSeparateFrontAndBack(t,e,i){this._stencilFuncSeparate(this.FRONT_AND_BACK,t,e,i)}$stencilMaskSeparate(t,e){let i;switch(t){case this.FRONT:i=this._stencilMaskSeparateFront;break;case this.BACK:i=this._stencilMaskSeparateBack;break;case this.FRONT_AND_BACK:i=this._stencilMaskSeparateFrontAndBack;break}this._state.setSetting(i,[e])&&i.apply(this,[e])}_stencilMaskSeparateFront(t){this._stencilMaskSeparate(this.FRONT,t)}_stencilMaskSeparateBack(t){this._stencilMaskSeparate(this.BACK,t)}_stencilMaskSeparateFrontAndBack(t){this._stencilMaskSeparate(this.FRONT_AND_BACK,t)}$stencilOpSeparate(t,e,i,s){let r;switch(t){case this.FRONT:r=this._stencilOpSeparateFront;break;case this.BACK:r=this._stencilOpSeparateBack;break;case this.FRONT_AND_BACK:r=this._stencilOpSeparateFrontAndBack;break}this._state.setSetting(r,[e,i,s])&&r.apply(this,[e,i,s])}_stencilOpSeparateFront(t,e,i){this._stencilOpSeparate(this.FRONT,t,e,i)}_stencilOpSeparateBack(t,e,i){this._stencilOpSeparate(this.BACK,t,e,i)}_stencilOpSeparateFrontAndBack(t,e,i){this._stencilOpSeparate(this.FRONT_AND_BACK,t,e,i)}$blendColor(t,e,i,s){this._state.setSetting(this._blendColor,[t,e,i,s])&&this._blendColor(t,e,i,s)}$blendEquation(t){this._state.setSetting(this._blendEquation,[t])&&this._blendEquation(t)}$blendEquationSeparate(t,e){this._state.setSetting(this._blendEquationSeparate,[t,e])&&this._blendEquationSeparate(t,e)}$blendFunc(t,e){this._state.setSetting(this._blendFunc,[t,e])&&this._blendFunc(t,e)}$blendFuncSeparate(t,e,i,s){this._state.setSetting(this._blendFuncSeparate,[t,e,i,s])&&this._blendFuncSeparate(t,e,i,s)}$clearColor(t,e,i,s){this._state.setSetting(this._clearColor,[t,e,i,s])&&this._clearColor(t,e,i,s)}$clearDepth(t){this._state.setSetting(this._clearDepth,[t])&&this._clearDepth(t)}$clearStencil(t){this._state.setSetting(this._clearStencil,[t])&&this._clearStencil(t)}$colorMask(t,e,i,s){this._state.setSetting(this._colorMask,[t,e,i,s])&&this._colorMask(t,e,i,s)}$cullFace(t){this._state.setSetting(this._cullFace,[t])&&this._cullFace(t)}$depthFunc(t){this._state.setSetting(this._depthFunc,[t])&&this._depthFunc(t)}$depthMask(t){this._state.setSetting(this._depthMask,[t])&&this._depthMask(t)}$depthRange(t,e){this._state.setSetting(this._depthRange,[t,e])&&this._depthRange(t,e)}$frontFace(t){this._state.setSetting(this._frontFace,[t])&&this._frontFace(t)}$lineWidth(t){this._state.setSetting(this._lineWidth,[t])&&this._lineWidth(t)}$polygonOffset(t,e){this._state.setSetting(this._polygonOffset,[t,e])&&this._polygonOffset(t,e)}$sampleCoverage(t,e){this._state.setSetting(this._sampleCoverage,[t,e])&&this._sampleCoverage(t,e)}$stencilFunc(t,e,i){this._state.setSetting(this._stencilFunc,[t,e,i])&&this._stencilFunc(t,e,i)}$stencilMask(t){this._state.setSetting(this._stencilMask,[t])&&this._stencilMask(t)}$stencilOp(t,e,i){this._state.setSetting(this._stencilOp,[t,e,i])&&this._stencilOp(t,e,i)}$vertexAttrib1f(t,e){this._state.setSetting(this._vertexAttrib1f,[t,e])&&this._vertexAttrib1f(t,e)}$vertexAttrib1fv(t,e){this._state.setSetting(this._vertexAttrib1fv,[t,e])&&this._vertexAttrib1fv(t,e)}$vertexAttrib2f(t,e,i){this._state.setSetting(this._vertexAttrib2f,[t,e,i])&&this._vertexAttrib2f(t,e,i)}$vertexAttrib2fv(t,e){this._state.setSetting(this._vertexAttrib2fv,[t,e])&&this._vertexAttrib2fv(t,e)}$vertexAttrib3f(t,e,i,s){this._state.setSetting(this._vertexAttrib3f,[t,e,i,s])&&this._vertexAttrib3f(t,e,i,s)}$vertexAttrib3fv(t,e){this._state.setSetting(this._vertexAttrib3fv,[t,e])&&this._vertexAttrib3fv(t,e)}$vertexAttrib4f(t,e,i,s,r){this._state.setSetting(this._vertexAttrib4f,[t,e,i,s,r])&&this._vertexAttrib4f(t,e,i,s,r)}$vertexAttrib4fv(t,e){this._state.setSetting(this._vertexAttrib4fv,[t,e])&&this._vertexAttrib4fv(t,e)}static enable(t,e="default"){const i=Object.getOwnPropertyNames(Ai.prototype);return t.__proto__,i.forEach(s=>{if(s!=="constructor"){const r=Ai.prototype[s];s.charAt(0)==="$"&&(s=s.substr(1)),t[s]!==r&&(t[s]&&(t[s].name||(t[s].xname=s),t["_"+s]=t[s]),t[s]=r)}}),Ai.prototype._initStateManager.call(t,e),t}}const Vu=Ai;class Ku{constructor(t){this.stage=t,this._usedMemory=0,this._uploadedTextureSources=[],this.textureSourceHashmap=new Map}get usedMemory(){return this._usedMemory}destroy(){for(let t=0,e=this._uploadedTextureSources.length;t<e;t++)this._nativeFreeTextureSource(this._uploadedTextureSources[t]);this.textureSourceHashmap.clear(),this._usedMemory=0}getReusableTextureSource(t){return this.textureSourceHashmap.get(t)}getTextureSource(t,e){let i=e?this.textureSourceHashmap.get(e):null;return i||(i=new hi(this,t),e&&(i.lookupId=e,this.textureSourceHashmap.set(e,i))),i}uploadTextureSource(t,e){if(t.isLoaded())return;this._addMemoryUsage(t.w*t.h);const i=this._nativeUploadTextureSource(t,e);t._nativeTexture=i,i.w=t.w,i.h=t.h,i.update=this.stage.frameCounter,this._uploadedTextureSources.push(t),this.addToLookupMap(t),this._updateVramUsage(t,1)}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}_updateVramUsage(t,e){const i=t.nativeTexture;var s;Oe.isWebglSupported()&&t.isLoaded()&&(!i.hasOwnProperty("bytesPerPixel")||isNaN(i.bytesPerPixel)||(s=e*(t.w*t.h*i.bytesPerPixel),this.stage.addVramUsage(s,t.hasAlpha)))}addToLookupMap(t){const e=t.lookupId;e&&(this.textureSourceHashmap.has(e)||this.textureSourceHashmap.set(e,t))}gc(){this.freeUnusedTextureSources(),this._cleanupLookupMap()}freeUnusedTextureSources(){let t=[];for(let e=0,i=this._uploadedTextureSources.length;e<i;e++){let s=this._uploadedTextureSources[e];s.allowCleanup()?this._freeManagedTextureSource(s):t.push(s)}this._uploadedTextureSources=t,this._cleanupLookupMap()}_freeManagedTextureSource(t){t.isLoaded()&&(this._nativeFreeTextureSource(t),this._addMemoryUsage(-t.w*t.h),this._updateVramUsage(t,-1)),t.loadingSince=null}_cleanupLookupMap(){this.textureSourceHashmap.forEach((t,e)=>{!(t.isLoaded()||t.isLoading())&&!t.isUsed()&&this.textureSourceHashmap.delete(e)})}freeTextureSource(t){const e=this._uploadedTextureSources.indexOf(t),i=e!==-1;t.isLoaded()&&(i&&(this._addMemoryUsage(-t.w*t.h),this._uploadedTextureSources.splice(e,1)),this._nativeFreeTextureSource(t)),t.loadingSince=null}_nativeUploadTextureSource(t,e){return this.stage.renderer.uploadTextureSource(t,e)}_nativeFreeTextureSource(t){this.stage.renderer.freeTextureSource(t),t.clearNativeTexture()}}class zs{constructor(t){this.stage=t,this.genericCancelCb=e=>{this._remove(e)},this._sources=[],this._data=[]}destroy(){this._sources=[],this._data=[],this.stage=null,delete this._sources,delete this._data,delete this.stage}processSome(){if(this._sources.length){const t=Date.now();do this._processItem();while(this._sources.length&&Date.now()-t<zs.MAX_UPLOAD_TIME_PER_FRAME)}}_processItem(){const t=this._sources.pop(),e=this._data.pop();t.isLoading()&&t.processLoadedSource(e)}add(t,e){this._sources.push(t),this._data.push(e)}_remove(t){const e=this._sources.indexOf(t);e>=0&&(this._sources.splice(e,1),this._data.splice(e,1))}}zs.MAX_UPLOAD_TIME_PER_FRAME=10;class qu{constructor(t){this.stage=t,this.root=null,this.updateTreeOrder=0,this.renderState=this.stage.renderer.createCoreRenderState(this),this.renderExec=this.stage.renderer.createCoreRenderExecutor(this),this.renderExec.init(),this._usedMemory=0,this._renderTexturePool=[],this._renderTextureId=1,this._zSorts=[],this.renderToTextureCount=0}get usedMemory(){return this._usedMemory}destroy(){this._renderTexturePool.forEach(t=>this._freeRenderTexture(t)),this._usedMemory=0,this.stage=null,this.root=null,this.renderState=null,this.renderExec=null,this._renderTexturePool=null,this._zSorts=null,delete this.stage,delete this.root,delete this.renderState,delete this.renderExec,delete this._renderTexturePool,delete this._zSorts}hasRenderUpdates(){return!!this.root._parent._hasRenderUpdates}render(){this.root._parent._hasRenderUpdates=0,this._render()}update(){this._update(),this.root._hasUpdates&&this._update(),this._performForcedZSorts()}_performForcedZSorts(){if(this._zSorts.length){for(let e=0,i=this._zSorts.length;e<i;e++)this._zSorts[e].zSort&&this._zSorts[e].sortZIndexedChildren();this._zSorts=[]}}_update(){this.updateTreeOrder=0,this.root.update()}_render(){const t=this.stage.getOption("debugFrame");this._fillRenderState(),this.stage.getOption("readPixelsBeforeDraw")&&this._readPixels(),this._performRender(),t&&console.log("[Lightning] RTT Renders in frame: ".concat(this.renderToTextureCount)),this.stage.getOption("readPixelsAfterDraw")&&this.renderToTextureCount>=this.stage.getOption("readPixelsAfterDrawThreshold")&&(t&&console.log("[Lightning] readPixelsAfterDraw behavior triggered"),this._readPixels()),this.renderToTextureCount=0}_readPixels(){const t=new Uint8Array(4),e=this.stage.gl;e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,t)}_fillRenderState(){this.renderState.reset(),this.root.render(),this.renderState.finish()}_performRender(){this.renderExec.execute()}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}allocateRenderTexture(t,e){let i=this.stage.getRenderPrecision(),s=Math.max(1,Math.round(t*i)),r=Math.max(1,Math.round(e*i));const o=this._renderTexturePool.length;for(let h=o-1;h>=0;h--){const l=this._renderTexturePool[h];if(l.w===s&&l.h===r&&l.update!==this.stage.frameCounter)return l.f=this.stage.frameCounter,this._renderTexturePool.splice(h,1),l}const a=this._createRenderTexture(t,e,s,r);return a.precision=i,a}releaseRenderTexture(t){this._renderTexturePool.push(t)}freeUnusedRenderTextures(t=60){let e=this.stage.frameCounter-t;this._renderTexturePool=this._renderTexturePool.filter(i=>i.f<=e?(this._freeRenderTexture(i),!1):!0)}_createRenderTexture(t,e,i,s){this._addMemoryUsage(i*s);const r=this.stage.renderer.createRenderTexture(t,e,i,s);return r.id=this._renderTextureId++,r.f=this.stage.frameCounter,r.ow=t,r.oh=e,r.w=i,r.h=s,r}_freeRenderTexture(t){this.stage.renderer.freeRenderTexture(t),this._addMemoryUsage(-t.w*t.h)}copyRenderTexture(t,e,i){this.stage.renderer.copyRenderTexture(t,e,i)}forceZSort(t){this._zSorts.push(t)}}class yr{constructor(t){this.stage=t,this._timingFunction="ease",this._timingFunctionImpl=M.getTimingFunction(this._timingFunction),this.delay=0,this.duration=.2,this.merger=null}get timingFunction(){return this._timingFunction}set timingFunction(t){this._timingFunction=t,this._timingFunctionImpl=M.getTimingFunction(t)}get timingFunctionImpl(){return this._timingFunctionImpl}patch(t){xt.patchObject(this,t)}}yr.prototype.isTransitionSettings=!0;class Zu{constructor(t){this.stage=t,this.stage.on("frameStart",()=>this.progress()),this.active=new Set,this.defaultTransitionSettings=new yr(this.stage)}progress(){if(this.active.size){let t=this.stage.dt,e=!1;this.active.forEach(function(i){i.progress(t),i.isRunning()||(e=!0)}),e&&(this.active=new Set([...this.active].filter(i=>i.isRunning())))}}createSettings(t){const e=new yr;return xt.patchObject(e,t),e}addActive(t){this.active.add(t)}removeActive(t){this.active.delete(t)}}class it{constructor(){this._clear()}_clear(){this._p=[],this._pe=[],this._idp=[],this._f=[],this._v=[],this._lv=[],this._sm=[],this._s=[],this._ve=[],this._sme=[],this._se=[],this._length=0}parse(t,e){let i,s;b.isObjectLiteral(e)||(e={0:e});let r=.5,o=[];for(let a in e)if(e.hasOwnProperty(a)){let h=e[a];b.isObjectLiteral(h)||(h={v:h});let l=parseFloat(a);a==="sm"?r=h.v:!isNaN(l)&&l>=0&&l<=2&&(h.p=l,h.f=b.isFunction(h.v),h.lv=h.f?h.v(0,0):h.v,o.push(h))}for(o=o.sort(function(a,h){return a.p-h.p}),s=o.length,i=0;i<s;i++){let a=i===s-1;if(!o[i].hasOwnProperty("pe"))o[i].pe=a?o[i].p<=1?1:2:o[i+1].p;else{const h=i<s-1?o[i+1].p:1;o[i].pe>h&&(o[i].pe=h)}o[i].pe===o[i].p?o[i].idp=0:o[i].idp=1/(o[i].pe-o[i].p)}for(i=0;i<s;i++)if(o[i].hasOwnProperty("sm")||(o[i].sm=r),!o[i].hasOwnProperty("s"))if(i===0||i===s-1||o[i].p===1)o[i].s=t?[0,0,0,0]:0;else{const a=o[i-1],h=o[i+1];if(a.p===h.p)o[i].s=t?[0,0,0,0]:0;else if(t){const l=it.getRgbaComponents(h.lv),c=it.getRgbaComponents(a.lv),u=1/(h.p-a.p);o[i].s=[u*(l[0]-c[0]),u*(l[1]-c[1]),u*(l[2]-c[2]),u*(l[3]-c[3])]}else o[i].s=(h.lv-a.lv)/(h.p-a.p)}for(i=0;i<s-1;i++)if(!o[i].f){let a=i===s-1;o[i].hasOwnProperty("ve")||(o[i].ve=a?o[i].lv:o[i+1].lv),b.isNumber(o[i].v)&&b.isNumber(o[i].lv)&&(o[i].hasOwnProperty("sme")||(o[i].sme=a?r:o[i+1].sm),o[i].hasOwnProperty("se")||(o[i].se=a?t?[0,0,0,0]:0:o[i+1].s),t?o[i].v=it.getSplineRgbaValueFunction(o[i].v,o[i].ve,o[i].p,o[i].pe,o[i].sm,o[i].sme,o[i].s,o[i].se):o[i].v=it.getSplineValueFunction(o[i].v,o[i].ve,o[i].p,o[i].pe,o[i].sm,o[i].sme,o[i].s,o[i].se),o[i].f=!0)}for(this.length&&this._clear(),i=0,s=o.length;i<s;i++)this._add(o[i])}_add(t){this._p.push(t.p||0),this._pe.push(t.pe||0),this._idp.push(t.idp||0),this._f.push(t.f||!1),this._v.push(t.hasOwnProperty("v")?t.v:0),this._lv.push(t.lv||0),this._sm.push(t.sm||0),this._s.push(t.s||0),this._ve.push(t.ve||0),this._sme.push(t.sme||0),this._se.push(t.se||0),this._length++}_getItem(t){const e=this._length;if(!e)return-1;if(t<this._p[0])return 0;for(let i=0;i<e;i++)if(this._p[i]<=t&&t<this._pe[i])return i;return e-1}getValue(t){const e=this._getItem(t);if(e!==-1)if(this._f[e]){const i=Math.min(1,Math.max(0,(t-this._p[e])*this._idp[e]));return this._v[e](i)}else return this._v[e]}get length(){return this._length}static getRgbaComponents(t){let e=(t/65536|0)%256,i=(t/256|0)%256,s=t%256,r=t/16777216|0;return[e,i,s,r]}static getSplineValueFunction(t,e,i,s,r,o,a,h){let l=s-i;a*=l,h*=l;let c=it.getSplineHelpers(t,e,r,o,a,h);return c?function(u){return u===0?t:u===1?e:it.calculateSpline(c,u)}:function(u){return u===0?t:u===1?e:e*u+t*(1-u)}}static getSplineRgbaValueFunction(t,e,i,s,r,o,a,h){let l=s-i;a[0]*=l,a[1]*=l,a[2]*=l,a[3]*=l,h[0]*=l,h[1]*=l,h[2]*=l,h[3]*=l;let c=it.getRgbaComponents(t),u=it.getRgbaComponents(e),d=[it.getSplineHelpers(c[0],u[0],r,o,a[0],h[0]),it.getSplineHelpers(c[1],u[1],r,o,a[1],h[1]),it.getSplineHelpers(c[2],u[2],r,o,a[2],h[2]),it.getSplineHelpers(c[3],u[3],r,o,a[3],h[3])];return d[0]?function(g){return g===0?t:g===1?e:it.getArgbNumber([Math.min(255,it.calculateSpline(d[0],g)),Math.min(255,it.calculateSpline(d[1],g)),Math.min(255,it.calculateSpline(d[2],g)),Math.min(255,it.calculateSpline(d[3],g))])}:function(g){return g===0?t:g===1?e:it.mergeColors(e,t,g)}}static getSplineHelpers(t,e,i,s,r,o){if(!i&&!s)return null;let a=i,h=t+r*i,l=1-s,c=e-o*s,u=3*a-3*l+1,d=-6*a+3*l,g=3*a,_=3*h-3*c+e-t,f=3*(c+t)-6*h,y=3*(h-t);return[u,d,g,_,f,y,t]}static calculateSpline(t,e){let i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],h=t[5],l=t[6];if(i===-2&&o===-2&&r===0&&h===0)return e;let c=.5,u,d;for(let f=0;f<20;f++){if(u=c*(c*(c*i+s)+r),d=e-u,d>-1e-8&&d<1e-8)return c*(c*(c*o+a)+h)+l;let y=c*(c*(3*i)+2*s)+r;if(y>1e-10&&y<1e-10)break;c+=d/y}let g=0,_=1;for(let f=0;f<20;f++){if(c=.5*(g+_),u=c*(c*(c*i+s)+r),d=e-u,d>-1e-8&&d<1e-8)return c*(c*(c*o+a)+h)+l;d<0?_=c:g=c}return c}static mergeColors(t,e,i){let s=(t/65536|0)%256,r=(t/256|0)%256,o=t%256,a=t/16777216|0,h=(e/65536|0)%256,l=(e/256|0)%256,c=e%256,u=e/16777216|0,d=s*i+h*(1-i),g=r*i+l*(1-i),_=o*i+c*(1-i),f=a*i+u*(1-i);return Math.round(f)*16777216+Math.round(d)*65536+Math.round(g)*256+Math.round(_)}static getArgbNumber(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));let e=((t[3]|0)<<24)+((t[0]|0)<<16)+((t[1]|0)<<8)+(t[2]|0);return e<0&&(e=4294967295+e+1),e}}class sa{constructor(t){this.animationSettings=t,this._selector="",this._items=new it,this._props=[],this._propSetters=[],this._resetValue=void 0,this._hasResetValue=!1,this._hasColorProperty=void 0}getResetValue(){return this._hasResetValue?this._resetValue:this._items.getValue(0)}apply(t,e,i){const s=this.getAnimatedElements(t);let r=this._items.getValue(e);if(r===void 0||!s.length)return;if(i!==1){let h=this.getResetValue();b.isNumber(r)&&b.isNumber(h)&&(this.hasColorProperty()?r=M.mergeColors(r,h,i):r=M.mergeNumbers(r,h,i))}const o=this._propSetters.length,a=s.length;for(let h=0;h<a;h++)for(let l=0;l<o;l++)this._propSetters[l](s[h],r)}getAnimatedElements(t){return t.select(this._selector)}reset(t){const e=this.getAnimatedElements(t);let i=this.getResetValue();if(i===void 0||!e.length)return;const s=this._propSetters.length,r=e.length;for(let o=0;o<r;o++)for(let a=0;a<s;a++)this._propSetters[a](e[o],i)}set selector(t){this._selector=t}set t(t){this.selector=t}get resetValue(){return this._resetValue}set resetValue(t){this._resetValue=t,this._hasResetValue=t!==void 0}set rv(t){this.resetValue=t}set value(t){this._items.parse(this.hasColorProperty(),t)}set v(t){this.value=t}set properties(t){Array.isArray(t)||(t=[t]),this._props=[],t.forEach(e=>{this._props.push(e),this._propSetters.push(K.getSetter(e))})}set property(t){this._hasColorProperty=void 0,this.properties=t}set p(t){this.properties=t}patch(t){xt.patchObject(this,t)}hasColorProperty(){return this._hasColorProperty===void 0&&(this._hasColorProperty=this._props.length?K.isColorProperty(this._props[0]):!1),this._hasColorProperty}}sa.prototype.isAnimationActionSettings=!0;class bt{constructor(){this._actions=[],this.delay=0,this.duration=1,this.repeat=0,this.repeatOffset=0,this.repeatDelay=0,this.autostop=!1,this.stopMethod=bt.STOP_METHODS.FADE,this._stopTimingFunction="ease",this._stopTimingFunctionImpl=M.getTimingFunction(this._stopTimingFunction),this.stopDuration=0,this.stopDelay=0}get actions(){return this._actions}set actions(t){this._actions=[];for(let e=0,i=t.length;e<i;e++){const s=t[e];if(s.isAnimationActionSettings)this._actions.push(s);else{const r=new sa(this);r.patch(s),this._actions.push(r)}}}apply(t,e,i=1){this._actions.forEach(function(s){s.apply(t,e,i)})}reset(t){this._actions.forEach(function(e){e.reset(t)})}get stopTimingFunction(){return this._stopTimingFunction}set stopTimingFunction(t){this._stopTimingFunction=t,this._stopTimingFunctionImpl=M.getTimingFunction(t)}get stopTimingFunctionImpl(){return this._stopTimingFunctionImpl}patch(t){xt.patchObject(this,t)}}bt.STOP_METHODS={FADE:"fade",REVERSE:"reverse",FORWARD:"forward",IMMEDIATE:"immediate",ONETOTWO:"onetotwo"};class H extends J{constructor(t,e,i){super(),this.manager=t,this._settings=e,this._element=i,this._state=H.STATES.IDLE,this._p=0,this._delayLeft=0,this._repeatsLeft=0,this._stopDelayLeft=0,this._stopP=0}start(){this._element&&this._element.attached?(this._p=0,this._delayLeft=this.settings.delay,this._repeatsLeft=this.settings.repeat,this._state=H.STATES.PLAYING,this.emit("start"),this.checkActive()):console.warn("[Lightning] Element must be attached before starting animation")}play(){this._state===H.STATES.PAUSED?(this._state=H.STATES.PLAYING,this.checkActive(),this.emit("resume")):this._state==H.STATES.STOPPING&&this.settings.stopMethod==bt.STOP_METHODS.REVERSE?(this._state=H.STATES.PLAYING,this.emit("stopContinue")):this._state!=H.STATES.PLAYING&&this._state!=H.STATES.FINISHED&&this.start()}pause(){this._state===H.STATES.PLAYING&&(this._state=H.STATES.PAUSED,this.emit("pause"))}replay(){this._state==H.STATES.FINISHED?this.start():this.play()}skipDelay(){this._delayLeft=0,this._stopDelayLeft=0}finish(){this._state===H.STATES.PLAYING?(this._delayLeft=0,this._p=1):this._state===H.STATES.STOPPING&&(this._stopDelayLeft=0,this._p=0)}stop(){this._state===H.STATES.STOPPED||this._state===H.STATES.IDLE||(this._stopDelayLeft=this.settings.stopDelay||0,this.settings.stopMethod===bt.STOP_METHODS.IMMEDIATE&&!this._stopDelayLeft||this._delayLeft>0?(this._state=H.STATES.STOPPING,this.emit("stop")):(this.settings.stopMethod===bt.STOP_METHODS.FADE&&(this._stopP=0),this._state=H.STATES.STOPPING,this.emit("stop")),this.checkActive())}stopNow(){(this._state!==H.STATES.STOPPED||this._state!==H.STATES.IDLE)&&(this._state=H.STATES.STOPPING,this._p=0,this.emit("stop"),this.reset(),this._state=H.STATES.STOPPED,this.emit("stopFinish"))}isPaused(){return this._state===H.STATES.PAUSED}isPlaying(){return this._state===H.STATES.PLAYING}isStopping(){return this._state===H.STATES.STOPPING}isFinished(){return this._state===H.STATES.FINISHED}checkActive(){this.isActive()&&this.manager.addActive(this)}isActive(){return(this._state==H.STATES.PLAYING||this._state==H.STATES.STOPPING)&&this._element&&this._element.attached}progress(t){this._element&&(this._progress(t),this.apply())}_progress(t){if(this._state==H.STATES.STOPPING){this._stopProgress(t);return}if(this._state==H.STATES.PLAYING){if(this._delayLeft>0)if(this._delayLeft-=t,this._delayLeft<0)t=-this._delayLeft,this._delayLeft=0,this.emit("delayEnd");else return;this.settings.duration===0?this._p=1:this.settings.duration>0&&(this._p+=t/this.settings.duration),this._p>=1?this.settings.repeat==-1||this._repeatsLeft>0?(this._repeatsLeft>0&&this._repeatsLeft--,this._p=this.settings.repeatOffset,this.emit("progress",this._p),this.settings.repeatDelay&&(this._delayLeft=this.settings.repeatDelay),this.emit("repeat",this._repeatsLeft)):(this._p=1,this.emit("progress",this._p),this._state=H.STATES.FINISHED,this.emit("finish"),this.settings.autostop&&this.stop()):this.emit("progress",this._p)}}_stopProgress(t){let e=this._getStopDuration();if(this._stopDelayLeft>0)if(this._stopDelayLeft-=t,this._stopDelayLeft<0)t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("stopDelayEnd");else return;this.settings.stopMethod==bt.STOP_METHODS.IMMEDIATE?(this._state=H.STATES.STOPPED,this.emit("stopFinish")):this.settings.stopMethod==bt.STOP_METHODS.REVERSE?(e===0?this._p=0:e>0&&(this._p-=t/e),this._p<=0&&(this._p=0,this._state=H.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==bt.STOP_METHODS.FADE?(this._progressStopTransition(t),this._stopP>=1&&(this._p=0,this._state=H.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==bt.STOP_METHODS.ONETOTWO?this._p<2&&(e===0?this._p=2:e>0&&(this._p<1?this._p+=t/this.settings.duration:this._p+=t/e),this._p>=2?(this._p=2,this._state=H.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p)):this.settings.stopMethod==bt.STOP_METHODS.FORWARD&&this._p<1&&(this.settings.duration==0?this._p=1:this._p+=t/this.settings.duration,this._p>=1?this.settings.stopMethod==bt.STOP_METHODS.FORWARD?(this._p=1,this._state=H.STATES.STOPPED,this.emit("stopFinish")):this._repeatsLeft>0?(this._repeatsLeft--,this._p=0,this.emit("repeat",this._repeatsLeft)):(this._p=1,this._state=H.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p))}_progressStopTransition(t){if(this._stopP<1){if(this._stopDelayLeft>0)if(this._stopDelayLeft-=t,this._stopDelayLeft<0)t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("delayEnd");else return;const e=this._getStopDuration();e==0?this._stopP=1:this._stopP+=t/e,this._stopP>=1&&(this._stopP=1)}}_getStopDuration(){return this.settings.stopDuration||this.settings.duration}apply(){if(this._state===H.STATES.STOPPED)this.reset();else{let t=1;this._state===H.STATES.STOPPING&&this.settings.stopMethod===bt.STOP_METHODS.FADE&&(t=1-this.settings.stopTimingFunctionImpl(this._stopP)),this._settings.apply(this._element,this._p,t)}}reset(){this._settings.reset(this._element)}get state(){return this._state}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get frame(){return Math.round(this._p*this._settings.duration*60)}get settings(){return this._settings}}H.STATES={IDLE:0,PLAYING:1,STOPPING:2,STOPPED:3,FINISHED:4,PAUSED:5};class Ju{constructor(t){this.stage=t,this.stage.on("frameStart",()=>this.progress()),this.active=new Set}progress(){if(this.active.size){let t=this.stage.dt,e=!1;this.active.forEach(function(i){i.isActive()?i.progress(t):e=!0}),e&&(this.active=new Set([...this.active].filter(i=>i.isActive())))}}createAnimation(t,e){return b.isObjectLiteral(e)&&(e=this.createSettings(e)),new H(this,e,t)}createSettings(t){const e=new bt;return xt.patchObject(e,t),e}addActive(t){this.active.add(t)}}class ra extends Bt{_getLookupId(){return"__whitepix"}_getSourceLoader(){return function(t){var e=new Uint8Array([255,255,255,255]);t(null,{source:e,w:1,h:1,permanent:!0})}}isAutosizeTexture(){return!1}}class Oe extends J{constructor(t={}){super(),this._setOptions(t),this._usedMemory=0,this._lastGcFrame=0,this._usedVramAlpha=0,this._usedVramNonAlpha=0;const e=Oe.platform?Oe.platform:ju.load(t);this.platform=new e,this.platform.init&&this.platform.init(this),this.gl=null,this.c2d=null;const i=this.getOption("context");if(i?i.useProgram?this.gl=i:this.c2d=i:b.isWeb&&(!Oe.isWebglSupported()||this.getOption("canvas2d"))?this.c2d=this.platform.createCanvasContext(this.getOption("w"),this.getOption("h")):this.gl=this.platform.createWebGLContext(this.getOption("w"),this.getOption("h")),this.gl&&Vu.enable(this.gl,"lightning"),this._mode=this.gl?0:1,this.getCanvas()){if(this.getOption("devicePixelRatio")!==1){const s=this.getOption("devicePixelRatio");this.getCanvas().style.width=this._options.w/s+"px",this.getCanvas().style.height=this._options.h/s+"px"}this._options.w=this.getCanvas().width,this._options.h=this.getCanvas().height}this._mode===0?b.isSpark?this._renderer=new Qu(this):this._renderer=new ia(this):this._renderer=new Wu(this),this.setClearColor(this.getOption("clearColor")),this.frameCounter=0,this.transitions=new Zu(this),this.animations=new Ju(this),this.textureManager=new Ku(this),this.textureThrottler=new zs(this),this.startTime=0,this.currentTime=0,this.dt=0,this.rectangleTexture=new ra(this),this.rectangleTexture.load(),this.rectangleTexture.source.permanent=!0,this.ctx=new qu(this),this._updateSourceTextures=new Set}get renderer(){return this._renderer}static isWebglSupported(){if(b.isNode)return!0;try{return!!window.WebGLRenderingContext}catch(t){return!1}}get mode(){return this._mode}isWebgl(){return this.mode===0}isC2d(){return this.mode===1}getOption(t){return this._options[t]}_setOptions(t){this._options={};let e=(i,s)=>{let r=t[i];r===void 0?this._options[i]=s:this._options[i]=r};e("canvas",null),e("context",null),e("w",1920),e("h",1080),e("srcBasePath",null),e("memoryPressure",24e6),e("bufferMemory",2e6),e("textRenderIssueMargin",0),e("fontSharp",{precision:.6666666667,fontSize:24}),e("clearColor",[0,0,0,0]),e("defaultFontFace","sans-serif"),e("fixedDt",0),e("useImageWorker",!0),e("autostart",!0),e("precision",1),e("canvas2d",!1),e("platform",null),e("readPixelsBeforeDraw",!1),e("devicePixelRatio",1),e("readPixelsAfterDraw",!1),e("readPixelsAfterDrawThreshold",0),e("debugFrame",!1),e("forceTxCanvasSource",!1),e("pauseRafLoopOnIdle",!1),t.devicePixelRatio!=null&&t.devicePixelRatio!==1&&(this._options.precision*=t.devicePixelRatio,this._options.w*=t.devicePixelRatio,this._options.h*=t.devicePixelRatio)}setApplication(t){this.application=t}init(){this.application.getOption("debug")&&this.platform._imageWorker&&console.log("[Lightning] Using image worker!"),this.application.getOption("debug")&&this.c2d&&console.log("[Lightning] Using canvas2d renderer"),this.application.setAsRoot(),this.getOption("autostart")&&this.platform.startLoop()}destroy(){this.platform.stopLoop(),this.platform.destroy(),this.ctx.destroy(),this.textureManager.destroy(),this._renderer.destroy(),this.gl?(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)):this.c2d&&this.c2d.clearRect(0,0,this.c2d.canvas.width,this.c2d.canvas.height),this.gl=null,this.c2d=null,this.ctx=null,this._options=null,this.platform=null,this.textureManager=null,this._renderer=null,delete this.gl,delete this.c2d,delete this.ctx,delete this._options,delete this.platform,delete this.textureManager,delete this._renderer}stop(){this.platform.stopLoop()}resume(){this.platform.startLoop()}get root(){return this.application}getCanvas(){return this._mode?this.c2d.canvas:this.gl.canvas}getRenderPrecision(){return this._options.precision}addUpdateSourceTexture(t){this._updatingFrame?t._performUpdateSource():this._updateSourceTextures.add(t)}removeUpdateSourceTexture(t){this._updateSourceTextures&&this._updateSourceTextures.delete(t)}hasUpdateSourceTexture(t){return this._updateSourceTextures&&this._updateSourceTextures.has(t)}_performUpdateSource(){this._updateSourceTextures.size&&(this._updateSourceTextures.forEach(t=>{t._performUpdateSource()}),this._updateSourceTextures=new Set)}_calculateDt(){this.startTime=this.currentTime,this.currentTime=this.platform.getHrTime(),this._options.fixedDt?this.dt=this._options.fixedDt:this.dt=this.startTime?.001*(this.currentTime-this.startTime):.02}updateFrame(){this._calculateDt(),this.emit("frameStart"),this._performUpdateSource(),this.emit("update")}idleFrame(){this.textureThrottler.processSome(),this.emit("frameEnd"),this.frameCounter++}renderFrame(){const t=this.ctx.hasRenderUpdates();this.textureThrottler.processSome(),t&&(this._updatingFrame=!0,this.ctx.update(),this.ctx.render(),this._updatingFrame=!1),this.platform.nextFrame(t),this.emit("frameEnd"),this.frameCounter++}isUpdatingFrame(){return this._updatingFrame}drawFrame(){this.updateFrame(),this.renderFrame()}forceRenderUpdate(){this.root&&this.root.core._parent.setHasRenderUpdates(1)}setClearColor(t){this.forceRenderUpdate(),t===null?this._clearColor=null:Array.isArray(t)?this._clearColor=t:this._clearColor=M.getRgbaComponentsNormalized(t)}getClearColor(){return this._clearColor}createElement(t){return t?this.element(t):new K(this)}createShader(t){return Ii.create(this,t)}element(t){if(t.isElement)return t;let e;return t.type?e=new t.type(this):e=new K(this),e.patch(t),e}c(t){return this.element(t)}get w(){return this._options.w}get h(){return this._options.h}get coordsWidth(){return this.w/this._options.precision}get coordsHeight(){return this.h/this._options.precision}addMemoryUsage(t){this._usedMemory+=t,this._lastGcFrame!==this.frameCounter&&this._usedMemory>this.getOption("memoryPressure")&&(this.gc(!1),this._usedMemory>this.getOption("memoryPressure")-2e6&&this.gc(!0))}get usedMemory(){return this._usedMemory}addVramUsage(t,e){e?this._usedVramAlpha+=t:this._usedVramNonAlpha+=t}get usedVramAlpha(){return this._usedVramAlpha}get usedVramNonAlpha(){return this._usedVramNonAlpha}get usedVram(){return this._usedVramAlpha+this._usedVramNonAlpha}gc(t){if(this._lastGcFrame!==this.frameCounter){this._lastGcFrame=this.frameCounter;const e=this._usedMemory;if(this.gcTextureMemory(t),this.gcRenderTextureMemory(t),this.renderer.gc(t),this.application.getOption("debug")){console.log("[Lightning] GC".concat(t?"[aggressive]":"","! Frame ").concat(this._lastGcFrame," Freed ").concat(((e-this._usedMemory)/1e6).toFixed(2),"MP from GPU memory. Remaining: ").concat((this._usedMemory/1e6).toFixed(2),"MP"));const i=this._usedMemory-this.textureManager.usedMemory-this.ctx.usedMemory;console.log("[Lightning] Textures: ".concat((this.textureManager.usedMemory/1e6).toFixed(2),"MP, Render Textures: ").concat((this.ctx.usedMemory/1e6).toFixed(2),"MP, Renderer caches: ").concat((i/1e6).toFixed(2),"MP"))}}}gcTextureMemory(t=!1){t&&this.ctx.root.visible?(this.ctx.root.visible=!1,this.textureManager.gc(),this.ctx.root.visible=!0):this.textureManager.gc()}gcRenderTextureMemory(t=!1){t&&this.root.visible?(this.root.visible=!1,this.ctx.freeUnusedRenderTextures(0),this.root.visible=!0):this.ctx.freeUnusedRenderTextures(0)}getDrawingCanvas(){return this.platform.getDrawingCanvas()}update(){this.ctx.update()}addServiceProvider(t){b.isSpark&&this.platform.addServiceProvider(t)}getChildrenByPosition(t,e){const i=[];return this.root.core.update(),this.root.core.collectAtCoord(t,e,i),i}}class ye extends at{constructor(t={},e){ye._temp_options=t,ye.booting=!0;const i=new Oe(t.stage);super(i,e),ye.booting=!1,this.__updateFocusCounter=0,this.__keypressTimers=new Map,this.__hoveredChild=null,this.stage.init(),this.updateFocusSettings(),this.__keymap=this.getOption("keys"),this.__keymap&&(this.stage.platform.registerKeydownHandler(s=>{this._receiveKeydown(s)}),this.stage.platform.registerKeyupHandler(s=>{this._receiveKeyup(s)})),this.getOption("enablePointer")&&(this.stage.platform.registerClickHandler(s=>{this._receiveClick(s)}),this.stage.platform.registerHoverHandler(s=>{this._receiveHover(s)}),this.stage.platform.registerScrollWheelHandler(s=>{this._recieveScrollWheel(s)}),this.cursor="default")}getOption(t){return this.__options[t]}_setOptions(t){this.__options={};let e=(i,s)=>{let r=t[i];r===void 0?this.__options[i]=s:this.__options[i]=r};e("debug",!1),e("keys",{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}),e("enablePointer",!1)}__construct(){this.stage.setApplication(this),this._setOptions(ye._temp_options),delete ye._temp_options,super.__construct()}__init(){super.__init(),this.__updateFocus()}updateFocusPath(){this.__updateFocus()}__updateFocus(){const t=this.__updateFocusRec();!ye.booting&&t&&this.updateFocusSettings()}__updateFocusRec(){const t=++this.__updateFocusCounter;this.__updateFocusId=t;const e=this.__getFocusPath(),i=e[e.length-1],s=this._focusPath?this._focusPath[this._focusPath.length-1]:void 0;if(s){let r=Math.min(this._focusPath.length,e.length),o;for(o=0;o<r&&this._focusPath[o]===e[o];o++);if(this._focusPath.length!==e.length||o!==e.length){this.getOption("debug")&&console.log("[Lightning] Focus changed: "+i.getLocationString());for(let a=this._focusPath.length-1;a>=o;a--)if(this._focusPath.pop()._unfocus(i,s),this.__updateFocusId!==t)return!1;for(let a=o,h=e.length;a<h;a++)if(this._focusPath.push(e[a]),this._focusPath[a]._focus(i,s),this.__updateFocusId!==t)return!1;for(let a=0;a<o;a++)this._focusPath[a]._focusChange(i,s)}}else{this._focusPath=[];for(let r=0,o=e.length;r<o;r++)if(this._focusPath.push(e[r]),this._focusPath[r]._focus(i,void 0),this.__updateFocusId!==t)return!1;return!0}return!0}updateFocusSettings(){const t=this._focusPath[this._focusPath.length-1],e={},i=at.prototype._setFocusSettings;for(let r=0,o=this._focusPath.length;r<o;r++)this._focusPath[r]._setFocusSettings!==i&&this._focusPath[r]._setFocusSettings(e);const s=at.prototype._handleFocusSettings;for(let r=0,o=this._focusPath.length;r<o;r++)this._focusPath[r]._handleFocusSettings!==s&&this._focusPath[r]._handleFocusSettings(e,this.__prevFocusSettings,t);this.__prevFocusSettings=e}_handleFocusSettings(t,e,i,s){}__getFocusPath(){const t=[this];let e=this;do{const i=e._getFocused();if(!i||i===e)break;let s=i.cparent;if(s===e)t.push(i);else{const r=[i];do s||e._throwError("Return value for _getFocused must be an attached descendant component but its '"+i.getLocationString()+"'"),r.push(s),s=s.cparent;while(s!==e);for(let o=0,a=r.length;o<a;o++)t.push(r[a-o-1])}e=i}while(!0);return t}get focusPath(){return this._focusPath}focusTopDownEvent(t,...e){const i=this.focusPath,s=i.length;for(let r=0;r<s;r++){const o=i[r]._getMostSpecificHandledMember(t);if(o!==void 0&&i[r][o](...e)!==!1)return!0}return!1}focusBottomUpEvent(t,...e){const i=this.focusPath,s=i.length;for(let r=s-1;r>=0;r--){const o=i[r]._getMostSpecificHandledMember(t);if(o!==void 0&&i[r][o](...e)!==!1)return!0}return!1}_receiveKeydown(t){const e=t,i=this.__keymap[t.keyCode],s=this.focusPath;let r;if(i&&(r=Array.isArray(i)?i:[i]),r)for(let a=0,h=r.length;a<h;a++){const l=this.__keypressTimers.has(r[a]);if(s[s.length-1].longpress&&l)return;this.stage.application.focusTopDownEvent(["_capture".concat(r[a]),"_captureKey"],e)||this.stage.application.focusBottomUpEvent(["_handle".concat(r[a]),"_handleKey"],e)}else this.stage.application.focusTopDownEvent(["_captureKey"],e)||this.stage.application.focusBottomUpEvent(["_handleKey"],e);this.updateFocusPath();const o=s[s.length-1];if(r&&o.longpress)for(let a=0,h=r.length;a<h;a++)this._startLongpressTimer(r[a],o)}_receiveKeyup(t){const e=t,i=this.__keymap[t.keyCode];let s;if(i&&(s=Array.isArray(i)?i:[i]),s)for(let r=0,o=s.length;r<o;r++)this.stage.application.focusTopDownEvent(["_capture".concat(s[r],"Release"),"_captureKeyRelease"],e)||this.stage.application.focusBottomUpEvent(["_handle".concat(s[r],"Release"),"_handleKeyRelease"],e);else this.stage.application.focusTopDownEvent(["_captureKeyRelease"],e)||this.stage.application.focusBottomUpEvent(["_handleKeyRelease"],e);if(this.updateFocusPath(),s)for(let r=0,o=s.length;r<o;r++)this.__keypressTimers.has(s[r])&&(clearTimeout(this.__keypressTimers.get(s[r])),this.__keypressTimers.delete(s[r]))}_startLongpressTimer(t,e){const i=e.longpress,s=t.toLowerCase();if(i[s]){const r=i[s];b.isNumber(r)?this.__keypressTimers.set(t,setTimeout(()=>{this.stage.application.focusTopDownEvent(["_capture".concat(t,"Long"),"_captureKey"],{})||this.stage.application.focusBottomUpEvent(["_handle".concat(t,"Long"),"_handleKey"],{}),this.__keypressTimers.delete(t)},r||500)):e._throwError("config value for longpress must be a number")}}_recieveScrollWheel(t){const e=t,{clientX:i,clientY:s}=e;i<=this.stage.w&&s<=this.stage.h&&(this.fireTopDownScrollWheelHandler("_captureScroll",e)||this.fireBottomUpScrollWheelHandler("_handleScroll",e))}fireTopDownScrollWheelHandler(t,e){let i=this.stage.application.children,s=this._findChildren([],i).reverse(),r=s.length;for(;r--;){const o=s[r];if(o&&o[t])return o._captureScroll(e),!0}return!1}fireBottomUpScrollWheelHandler(t,e){const{clientX:i,clientY:s}=e;let o=this._getTargetChild(i,s);for(;o!==null;){if(o&&o[t])return o._handleScroll(e),!0;o=o.parent}return!1}_receiveClick(t){const e=t,{clientX:i,clientY:s}=e;i<=this.stage.w&&s<=this.stage.h&&this.stage.application.fireBottomUpClickHandler(e)}fireBottomUpClickHandler(t){const{clientX:e,clientY:i}=t,s=this._getTargetChild(e,i),r=this.stage.getRenderPrecision()/this.stage.getOption("devicePixelRatio");let o=s;for(;o!==null;){if(o&&o._handleClick){const{px:a,py:h}=o.core._worldContext,l=a*r,c=h*r,u={x:e-l,y:i-c};if(o._handleClick(s,u)!==!1)break}o=o.parent}}_receiveHover(t){const e=t,{clientX:i,clientY:s}=e;i<=this.stage.w&&s<=this.stage.h&&this.stage.application.fireBottomUpHoverHandler(e)}fireBottomUpHoverHandler(t){const{clientX:e,clientY:i}=t,s=this._getTargetChild(e,i);if(s!==this.__hoveredChild){let r=new Set,o=new Set;if(s&&(o=new Set(s.getAncestors())),this.__hoveredChild){r=new Set(this.__hoveredChild.getAncestors());for(const l of[...r].filter(c=>!o.has(c))){const c=at.getComponent(l);c._handleUnhover&&c._handleUnhover(l),l.parent&&l.parent.cursor&&(this.stage.getCanvas().style.cursor=l.parent.cursor)}}this.__hoveredChild=s;const a=[...o].filter(l=>!r.has(l));for(const l of a){const c=at.getComponent(l);c._handleHover&&c._handleHover(l)}const h=a[0];if(h&&h.cursor&&(this.stage.getCanvas().style.cursor=h.cursor),a.length===0&&s){const l=at.getComponent(s);l._handleHover&&l._handleHover(s)}}}_getTargetChild(t,e){let i=this.stage.application.children,s=this._findChildren([],i),r=this._withinClickableRange(s,t,e);return r.sort((o,a)=>o.zIndex>a.zIndex?1:o.zIndex<a.zIndex?-1:o.id>a.id?1:-1),r.length?r.slice(-1)[0]:null}_findChildren(t,e){let i=e.length;for(;i--;){const s=e[i];s.__active&&s.collision&&(s.collision===!0&&t.push(s),s.hasChildren()&&this._findChildren(t,s.children))}return t}_withinClickableRange(t,e,i){let s=t.length;const r=[];for(;s--;){const o=t[s],a=this.stage.getRenderPrecision()/this.stage.getOption("devicePixelRatio"),h=o.core._worldContext,l=h.px*a,c=h.py*a,u=o.finalW*h.ta*a,d=o.finalH*h.td*a;if(!(l>this.stage.w||c>this.stage.h)){if(o.parent.core._scissor){const g=o.parent.core._scissor.map(_=>_*a);if(!this._testCollision(e,i,...g))continue}this._testCollision(e,i,l,c,u,d)&&r.push(o)}}return r}_testCollision(t,e,i,s,r,o){return t>=i&&t<=i+r&&e>=s&&e<=s+o}destroy(){this._destroyed||(this._destroy(),this.stage.destroy(),this._destroyed=!0)}_destroy(){if(this.stage.setApplication(void 0),this._updateAttachedFlag(),this._updateEnabledFlag(),this.__keypressTimers.size){for(const t of this.__keypressTimers.values())clearTimeout(t);this.__keypressTimers.clear()}}getCanvas(){return this.stage.getCanvas()}}class na extends Bt{constructor(t){super(t),this._factory=void 0,this._lookupId=void 0}set content({factory:t,lookupId:e=void 0}){this._factory=t,this._lookupId=e,this._changed()}_getIsValid(){return!!this._factory}_getLookupId(){return this._lookupId}_getSourceLoader(){const t=this._factory;return e=>t((i,s)=>{if(i)return e(i);e(null,this.stage.platform.getTextureOptionsForDrawingCanvas(s))},this.stage)}}class Si{static getCanvasTexture(t,e){return{type:na,content:{factory:t,lookupId:e}}}static getRoundRect(t,e,i,s,r,o,a){Array.isArray(i)||(i=[i,i,i,i]);let h=(c,u)=>{b.isSpark?u.platform.createRoundRect(c,u,t,e,i,s,r,o,a):c(null,this.createRoundRect(u,t,e,i,s,r,o,a))},l="rect"+[t,e,s,r,o?1:0,a].concat(i).join(",");return Si.getCanvasTexture(h,l)}static createRoundRect(t,e,i,s,r,o,a,h){a===void 0&&(a=!0),r===void 0&&(r=0);let l=t.platform.getDrawingCanvas(),c=l.getContext("2d");c.imageSmoothingEnabled=!0,l.width=e+r+2,l.height=i+r+2,c.beginPath();let u=.5*r+1,d=.5*r+1;return c.moveTo(u+s[0],d),c.lineTo(u+e-s[1],d),c.arcTo(u+e,d,u+e,d+s[1],s[1]),c.lineTo(u+e,d+i-s[2]),c.arcTo(u+e,d+i,u+e-s[2],d+i,s[2]),c.lineTo(u+s[3],d+i),c.arcTo(u,d+i,u,d+i-s[3],s[3]),c.lineTo(u,d+s[0]),c.arcTo(u,d,u+s[0],d,s[0]),c.closePath(),a&&(b.isNumber(h)?c.fillStyle=M.getRgbaString(h):c.fillStyle="white",c.fill()),r&&(b.isNumber(o)?c.strokeStyle=M.getRgbaString(o):c.strokeStyle="white",c.lineWidth=r,c.stroke()),l}static getShadowRect(t,e,i=0,s=5,r=s*2){Array.isArray(i)||(i=[i,i,i,i]);let o=(h,l)=>{b.isSpark?l.platform.createShadowRect(h,l,t,e,i,s,r):h(null,this.createShadowRect(l,t,e,i,s,r))},a="shadow"+[t,e,s,r].concat(i).join(",");return Si.getCanvasTexture(o,a)}static createShadowRect(t,e,i,s,r,o){let a=t.platform.getDrawingCanvas(),h=a.getContext("2d");h.imageSmoothingEnabled=!0,a.width=e+o*2,a.height=i+o*2,h.globalAlpha=.01,h.fillRect(0,0,.01,.01),h.globalAlpha=1,h.shadowColor=M.getRgbaString(4294967295),h.fillStyle=M.getRgbaString(4294967295),h.shadowBlur=r,h.shadowOffsetX=e+10+o,h.shadowOffsetY=o,h.beginPath();const l=-(e+10),c=0;return h.moveTo(l+s[0],c),h.lineTo(l+e-s[1],c),h.arcTo(l+e,c,l+e,c+s[1],s[1]),h.lineTo(l+e,c+i-s[2]),h.arcTo(l+e,c+i,l+e-s[2],c+i,s[2]),h.lineTo(l+s[3],c+i),h.arcTo(l,c+i,l,c+i-s[3],s[3]),h.lineTo(l,c+s[0]),h.arcTo(l,c,l+s[0],c,s[0]),h.closePath(),h.fill(),a}static getSvgTexture(t,e,i){let s=(o,a)=>{b.isSpark?a.platform.createSvg(o,a,t,e,i):this.createSvg(o,a,t,e,i)},r="svg"+[e,i,t].join(",");return Si.getCanvasTexture(s,r)}static createSvg(t,e,i,s,r){let o=e.platform.getDrawingCanvas(),a=o.getContext("2d");a.imageSmoothingEnabled=!0;let h=new Image;h.onload=()=>{o.width=s,o.height=r,a.drawImage(h,0,0,o.width,o.height),t(null,o)},h.onerror=l=>{t(l)},b.isPS4||(h.crossOrigin="Anonymous"),h.src=i}}class Yr{static isMf(t){return b.isFunction(t)&&t.__mf}static mf(t){return t.__mf=!0,t}static merge(t,e){const i=Object.keys(t),s=Object.keys(e);if(!s.length)return t;const r={},o={};for(let c=0,u=s.length;c<u;c++){const d=s[c];r[d]=-1,o[d]=c}for(let c=0,u=i.length;c<u;c++){const d=i[c];r[d]=c,o[d]===void 0&&(o[d]=-1)}const a=i.length,h={};for(let c=0,u=s.length;c<u;c++){const d=s[c],g=r[d];let _=g;for(;--_>=0;){const x=i[_];if(o[x]!==-1)break}for(;++_<g;){const x=i[_];h[x]=t[x]}const f=e[d],y=t[d];let T;this.isMf(f)?T=f(y):!b.isObjectLiteral(y)||!b.isObjectLiteral(f)?T=f:T=Yr.merge(y,f),T!==void 0&&(h[d]=T)}let l=a;for(;--l>=0;){const c=i[l];if(o[c]!==-1)break}for(;++l<a;){const c=i[l];h[c]=t[c]}return h}}class oa extends Ko{constructor(t){super(),this._target=t}onAdd(t,e){this._target.addAt(t,e)}onRemove(t,e){this._target.removeAt(e)}onSync(t,e,i){this._target._setByArray(i)}onSet(t,e){this._target.setAt(t,e)}onMove(t,e,i){this._target.setAt(t,i)}createItem(t){return this._target.createItem(t)}isItem(t){return this._target.isItem(t)}}class aa extends oa{constructor(t,e){super(t),this._wrap=e}wrap(t){let e=this._wrap(t);return t._wrapper=e,e}onAdd(t,e){t=this.wrap(t),super.onAdd(t,e)}onRemove(t,e){super.onRemove(t,e)}onSync(t,e,i){e.forEach(s=>this.wrap(s)),i=i.map(s=>s._wrapper),super.onSync(t,e,i)}onSet(t,e){t=this.wrap(t),super.onSet(t,e)}onMove(t,e,i){super.onMove(t,e,i)}}class ha extends Bt{_getLookupId(){return"__noise"}_getSourceLoader(){const t=this.stage.gl;return function(e){const i=new Uint8Array(65536);for(let r=0;r<128*128*4;r+=4){const o=Math.floor(Math.random()*256);i[r]=o,i[r+1]=o,i[r+2]=o,i[r+3]=255}const s={};t&&(s[t.TEXTURE_WRAP_S]=t.REPEAT,s[t.TEXTURE_WRAP_T]=t.REPEAT,s[t.TEXTURE_MIN_FILTER]=t.NEAREST,s[t.TEXTURE_MAG_FILTER]=t.NEAREST),e(null,{source:i,w:128,h:128,texParams:s})}}}class $r extends Bt{constructor(t){super(t),this._htmlElement=void 0,this._scale=1}set htmlElement(t){this._htmlElement=t,this._changed()}get htmlElement(){return this._htmlElement}set scale(t){this._scale=t,this._changed()}get scale(){return this._scale}set html(t){if(!t)this.htmlElement=void 0;else{const e=document.createElement("div");e.innerHTML="<div>"+t+"</div>",this.htmlElement=e.firstElementChild}}get html(){return this._htmlElement.innerHTML}_getIsValid(){return this.htmlElement}_getLookupId(){return this._scale+":"+this._htmlElement.innerHTML}_getSourceLoader(){const t=this._htmlElement,e=this._scale;return function(i){if(!window.html2canvas)return i(new Error("Please include html2canvas (https://html2canvas.hertzen.com/)"));const s=$r.getPreloadArea();s.appendChild(t),html2canvas(t,{backgroundColor:null,scale:e}).then(function(r){if(s.removeChild(t),r.height===0)return i(new Error("Canvas height is 0"));i(null,{source:r,width:r.width,height:r.height})}).catch(r=>{console.error("[Lightning]",r)})}}static getPreloadArea(){return this._preloadArea||(this._preloadArea=document.createElement("div"),this._preloadArea.attachShadow&&this._preloadArea.attachShadow({mode:"closed"}),this._preloadArea.style.opacity=0,this._preloadArea.style.pointerEvents="none",this._preloadArea.style.position="fixed",this._preloadArea.style.display="block",this._preloadArea.style.top="100vh",this._preloadArea.style.overflow="hidden",document.body.appendChild(this._preloadArea)),this._preloadArea}}class td extends Bt{constructor(t,e){super(t),this._options=e}set options(t){this._options!==t&&(this._options=t,this._changed())}get options(){return this._options}_getIsValid(){return!!this._options}_getSourceLoader(){return t=>{t(null,this._options)}}}class ed extends at{constructor(t){super(t),this._wrapper=super._children.a({}),this._reloadVisibleElements=!1,this._visibleItems=new Set,this._index=0,this._started=!1,this._scrollTransitionSettings=this.stage.transitions.createSettings({}),this._itemSize=100,this._viewportScrollOffset=0,this._itemScrollOffset=0,this._roll=!1,this._rollMin=0,this._rollMax=0,this._progressAnimation=null,this._invertDirection=!1,this._horizontal=!0,this.itemList=new id(this)}_allowChildrenAccess(){return!1}get items(){return this.itemList.get()}set items(t){this.itemList.patch(t)}start(){this._wrapper.transition(this.property,this._scrollTransitionSettings),this._scrollTransition=this._wrapper.transition(this.property),this._scrollTransition.on("progress",t=>this.update()),this.setIndex(0,!0,!0),this._started=!0,this.update()}setIndex(t,e=!1,i=!1){let s=this.length;if(!s)return;if(this.emit("unfocus",this.getElement(this.realIndex),this._index,this.realIndex),i){let a=b.getModuloIndex(t,s),h=b.getModuloIndex(this.index,s),l=a-h;l>.5*s?l-=s:l<-.5*s&&(l+=s),this._index+=l}else this._index=t;(this._roll||this.viewportSize>this._itemSize*s)&&(this._index=b.getModuloIndex(this._index,s));let r=this._horizontal^this._invertDirection?-1:1,o=r*this._index*this._itemSize;if(this._roll){let a,h,l;if(r==1)h=(s-1)*this._itemSize,l=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,h-=l,a=this.viewportSize-(this._itemSize+l),this._rollMin&&(a-=this._rollMin),this._rollMax&&(h+=this._rollMax),o=Math.max(Math.min(o,h),a);else{h=s*this._itemSize-this.viewportSize,l=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,h+=l;let c=l;this._rollMin&&(c-=this._rollMin),this._rollMax&&(h+=this._rollMax),o=Math.min(Math.max(-h,o),-c)}}this._scrollTransition.start(o),e&&this._scrollTransition.finish(),this.emit("focus",this.getElement(this.realIndex),this._index,this.realIndex)}getAxisPosition(){let t=-this._scrollTransition._targetValue,i=-(this._horizontal^this._invertDirection?-1:1)*this._index*this._itemSize;return this._viewportScrollOffset*this.viewportSize+(i-t)}update(){if(!this._started)return;let t=this.length;if(!t)return;let e=this._horizontal^this._invertDirection?-1:1,i=this._horizontal?this._wrapper.x:this._wrapper.y,s=this.viewportSize,r=this._viewportScrollOffset*s-this._itemScrollOffset*this._itemSize;i+=r;let o,a,h,l;e==-1?(o=Math.floor(-i/this._itemSize),h=1-(-i/this._itemSize-o),a=Math.floor((s-i)/this._itemSize),l=(s-i)/this._itemSize-a):(o=Math.ceil(i/this._itemSize),h=1+i/this._itemSize-o,a=Math.ceil((i-s)/this._itemSize),l=a-(i-s)/this._itemSize),(this._roll||s>this._itemSize*t)&&(a>=t&&(a=t-1,l=1),o>=t&&(o=t-1,h=1),a<=-1&&(a=0,l=1),o<=-1&&(o=0,h=1));let c=-e*o*this._itemSize,u;for(let g=o;e==-1?g<=a:g>=a;e==-1?g++:g--){let _=b.getModuloIndex(g,t),f=this.getElement(_);u=f.parent,this._visibleItems.delete(u),this._horizontal?u.x=c+r:u.y=c+r;let y=u.visible;if(u.visible=!0,(!y||this._reloadVisibleElements)&&this.emit("visible",g,_),this._progressAnimation){let T=1;g==o?T=h:g==a&&(T=l),this._progressAnimation.apply(f,T)}c+=this._itemSize}let d=this;this._visibleItems.forEach(function(g){g.visible=!1,d._visibleItems.delete(g)});for(let g=o;e==-1?g<=a:g>=a;e==-1?g++:g--){let _=b.getModuloIndex(g,t);this._visibleItems.add(this.getWrapper(_))}this._reloadVisibleElements=!1}setPrevious(){this.setIndex(this._index-1)}setNext(){this.setIndex(this._index+1)}getWrapper(t){return this._wrapper.children[t]}getElement(t){let e=this._wrapper.children[t];return e?e.children[0]:null}reload(){this._reloadVisibleElements=!0,this.update()}get element(){let t=this._wrapper.children[this.realIndex];return t?t.children[0]:null}get length(){return this._wrapper.children.length}get property(){return this._horizontal?"x":"y"}get viewportSize(){return this._horizontal?this.w:this.h}get index(){return this._index}get realIndex(){return b.getModuloIndex(this._index,this.length)}get itemSize(){return this._itemSize}set itemSize(t){this._itemSize=t,this.update()}get viewportScrollOffset(){return this._viewportScrollOffset}set viewportScrollOffset(t){this._viewportScrollOffset=t,this.update()}get itemScrollOffset(){return this._itemScrollOffset}set itemScrollOffset(t){this._itemScrollOffset=t,this.update()}get scrollTransitionSettings(){return this._scrollTransitionSettings}set scrollTransitionSettings(t){this._scrollTransitionSettings.patch(t)}set scrollTransition(t){this._scrollTransitionSettings.patch(t)}get scrollTransition(){return this._scrollTransition}get progressAnimation(){return this._progressAnimation}set progressAnimation(t){b.isObjectLiteral(t)?this._progressAnimation=this.stage.animations.createSettings(t):this._progressAnimation=t,this.update()}get roll(){return this._roll}set roll(t){this._roll=t,this.update()}get rollMin(){return this._rollMin}set rollMin(t){this._rollMin=t,this.update()}get rollMax(){return this._rollMax}set rollMax(t){this._rollMax=t,this.update()}get invertDirection(){return this._invertDirection}set invertDirection(t){this._started||(this._invertDirection=t)}get horizontal(){return this._horizontal}set horizontal(t){t!==this._horizontal&&(this._started||(this._horizontal=t))}}class id extends aa{constructor(t){let e=i=>{let s=i.stage.createElement();return s.add(i),s.visible=!1,s};super(t._wrapper._children,e),this.list=t}onAdd(t,e){super.onAdd(t,e),this.checkStarted(e)}checkStarted(t){this.list._reloadVisibleElements=!0,this.list._started?(this.list.length===1?this.list.setIndex(0,!0,!0):this.list._index>=this.list.length&&this.list.setIndex(0),this.list.update()):this.list.start()}onRemove(t,e){super.onRemove(t,e);let i=this.list.realIndex;i===e?(i===this.list.length&&i--,i>=0&&this.list.setIndex(i)):i>e&&this.list.setIndex(i-1),this.list._reloadVisibleElements=!0}onSet(t,e){super.onSet(t,e),this.checkStarted(e)}onSync(t,e,i){super.onSync(t,e,i),this.checkStarted(0)}get _signalProxy(){return!0}}class Ms extends G{constructor(t){super(t),this._direction=new Float32Array([1,0]),this._kernelRadius=1}get x(){return this._direction[0]}set x(t){this._direction[0]=t,this.redraw()}get y(){return this._direction[1]}set y(t){this._direction[1]=t,this.redraw()}get kernelRadius(){return this._kernelRadius}set kernelRadius(t){this._kernelRadius=t,this.redraw()}useDefault(){return this._kernelRadius===0}setupUniforms(t){super.setupUniforms(t),this._setUniform("direction",this._direction,this.gl.uniform2fv),this._setUniform("kernelRadius",this._kernelRadius,this.gl.uniform1i);const e=t.getRenderWidth(),i=t.getRenderHeight();this._setUniform("resolution",new Float32Array([e,i]),this.gl.uniform2fv)}}Ms.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 resolution;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 direction;\n    uniform int kernelRadius;\n    \n    vec4 blur1(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3333333333333333) * direction;\n        color += texture2D(image, uv) * 0.29411764705882354;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n        return color; \n    }\n    \n    vec4 blur2(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3846153846) * direction;\n        vec2 off2 = vec2(3.2307692308) * direction;\n        color += texture2D(image, uv) * 0.2270270270;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n        return color;\n    }\n    \n    vec4 blur3(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.411764705882353) * direction;\n        vec2 off2 = vec2(3.2941176470588234) * direction;\n        vec2 off3 = vec2(5.176470588235294) * direction;\n        color += texture2D(image, uv) * 0.1964825501511404;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n        color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n        return color;\n    }    \n\n    void main(void){\n        if (kernelRadius == 1) {\n            gl_FragColor = blur1(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else if (kernelRadius == 2) {\n            gl_FragColor = blur2(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else {\n            gl_FragColor = blur3(uSampler, vTextureCoord, resolution, direction) * vColor;\n        }\n    }\n";class Yt extends G{setupUniforms(t){super.setupUniforms(t);const e=1/t.getTextureWidth(0),i=1/t.getTextureHeight(0);this._setUniform("stepTextureCoord",new Float32Array([e,i]),this.gl.uniform2fv)}}Yt.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 stepTextureCoord;\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec4 vColor;\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoordUl = aTextureCoord - stepTextureCoord;\n        vTextureCoordBr = aTextureCoord + stepTextureCoord;\n        vTextureCoordUr = vec2(vTextureCoordBr.x, vTextureCoordUl.y);\n        vTextureCoordBl = vec2(vTextureCoordUl.x, vTextureCoordBr.y);\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";Yt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = 0.25 * (texture2D(uSampler, vTextureCoordUl) + texture2D(uSampler, vTextureCoordUr) + texture2D(uSampler, vTextureCoordBl) + texture2D(uSampler, vTextureCoordBr));\n        gl_FragColor = color * vColor;\n    }\n";class la extends Bs{constructor(t){super(t),this._kernelRadius=1}get kernelRadius(){return this._kernelRadius}set kernelRadius(t){this._kernelRadius=t,this.redraw()}useDefault(){return this._amount===0}_beforeDrawEl({target:t}){t.ctx.filter="blur("+this._kernelRadius+"px)"}_afterDrawEl({target:t}){t.ctx.filter="none"}}class sd extends at{static _template(){return{}}get wrap(){return this.tag("Wrap")}set content(t){return this.wrap.content=t}get content(){return this.wrap.content}set padding(t){this.wrap._paddingX=t,this.wrap._paddingY=t,this.wrap._updateBlurSize()}set paddingX(t){this.wrap._paddingX=t,this.wrap._updateBlurSize()}set paddingY(t){this.wrap._paddingY=t,this.wrap._updateBlurSize()}set amount(t){return this.wrap.amount=t}get amount(){return this.wrap.amount}_onResize(){this.wrap.w=this.renderWidth,this.wrap.h=this.renderHeight}get _signalProxy(){return!0}_build(){this.patch({Wrap:{type:this.stage.gl?rd:gs}})}}class gs extends at{static _template(){return{forceZIndexContext:!0,rtt:!0,Textwrap:{shader:{type:la},Content:{}}}}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._amount=0,this._paddingX=0,this._paddingY=0}static getSpline(){return this._multiSpline||(this._multiSpline=new it,this._multiSpline.parse(!1,{0:0,.25:1.5,.5:5.5,.75:18,1:39})),this._multiSpline}get content(){return this.sel("Textwrap>Content")}set content(t){this.sel("Textwrap>Content").patch(t,!0)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,e=this.renderHeight,i=this._paddingX,s=this._paddingY;this._wrapper.x=i,this._textwrap.x=-i,this._wrapper.y=s,this._textwrap.y=-s,this._textwrap.w=t+i*2,this._textwrap.h=e+s*2}get amount(){return this._amount}set amount(t){this._amount=t,this._textwrap.shader.kernelRadius=gs._amountToKernelRadius(t)}static _amountToKernelRadius(t){return gs.getSpline().getValue(Math.min(1,t*.25))}get _signalProxy(){return!0}}class rd extends at{static _template(){const t=function(e,i){if(i._recalc&130){const s=i.w,r=i.h;let o=i;do o=o._children[0],o._element.w=s,o._element.h=r;while(o._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,Content:{}},Layers:{L0:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Yt}}},L1:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Yt}}},L2:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Yt}}},L3:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Yt}}}},Result:{shader:{type:ca},visible:!1}}}get _signalProxy(){return!0}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._layers=this.sel("Layers"),this._output=this.sel("Result"),this._amount=0,this._paddingX=0,this._paddingY=0}_buildLayers(){const e=[{x:1,y:0,kernelRadius:1},{x:0,y:1,kernelRadius:1},{x:1.5,y:0,kernelRadius:1},{x:0,y:1.5,kernelRadius:1}].map(i=>Ii.create(this.stage,Object.assign({type:Ms},i)));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[e[0],e[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[e[0],e[1],e[2],e[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[e[0],e[1],e[2],e[3]])}_setLayerTexture(t,e,i){if(!i.length)t.texture=e;else{const s=i.pop(),r=t.stage.c({rtt:!0,shader:s});this._setLayerTexture(r,e,i),t.childList.add(r)}return t}get content(){return this.sel("Textwrap>Content")}set content(t){this.sel("Textwrap>Content").patch(t,!0)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}getLayer(t){return this._layers.sel("L"+t)}getLayerContents(t){return this.getLayer(t).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,e=this.renderHeight,i=this._paddingX,s=this._paddingY,r=t+i*2,o=e+s*2;this._textwrap.w=r,this._wrapper.x=i,this.getLayer(0).w=this.getLayerContents(0).w=r/2,this.getLayer(1).w=this.getLayerContents(1).w=r/4,this.getLayer(2).w=this.getLayerContents(2).w=r/8,this.getLayer(3).w=this.getLayerContents(3).w=r/16,this._output.x=-i,this._textwrap.x=-i,this._output.w=r,this._textwrap.h=o,this._wrapper.y=s,this.getLayer(0).h=this.getLayerContents(0).h=o/2,this.getLayer(1).h=this.getLayerContents(1).h=o/4,this.getLayer(2).h=this.getLayerContents(2).h=o/8,this.getLayer(3).h=this.getLayerContents(3).h=o/16,this._output.y=-s,this._textwrap.y=-s,this._output.h=o,this.w=t,this.h=e}set amount(t){this._amount=t,this._update()}get amount(){return this._amount}_update(){let t=Math.min(4,Math.max(0,this._amount));t===0?(this._textwrap.renderToTexture=!1,this._output.shader.otherTextureSource=null,this._output.visible=!1):(this._textwrap.renderToTexture=!0,this._output.visible=!0,this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3,t<=1?(this._output.texture=this._textwrap.getTexture(),this._output.shader.otherTextureSource=this.getLayer(0).getTexture(),this._output.shader.a=t):t<=2?(this._output.texture=this.getLayer(0).getTexture(),this._output.shader.otherTextureSource=this.getLayer(1).getTexture(),this._output.shader.a=t-1):t<=3?(this._output.texture=this.getLayer(1).getTexture(),this._output.shader.otherTextureSource=this.getLayer(2).getTexture(),this._output.shader.a=t-2):t<=4&&(this._output.texture=this.getLayer(2).getTexture(),this._output.shader.otherTextureSource=this.getLayer(3).getTexture(),this._output.shader.a=t-3))}set shader(t){super.shader=t,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._buildLayers()}}class ca extends G{constructor(t){super(t),this._a=0,this._otherTextureSource=null}get a(){return this._a}set a(t){this._a=t,this.redraw()}set otherTextureSource(t){this._otherTextureSource=t,this.redraw()}setupUniforms(t){super.setupUniforms(t),this._setUniform("a",this._a,this.gl.uniform1f),this._setUniform("uSampler2",1,this.gl.uniform1i)}beforeDraw(t){let e=this._otherTextureSource?this._otherTextureSource.nativeTexture:null,i=this.gl;i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,e),i.activeTexture(i.TEXTURE0)}}ca.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uSampler2;\n    uniform float a;\n    void main(void){\n        if (a == 1.0) {\n            gl_FragColor = texture2D(uSampler2, vTextureCoord) * vColor;\n        } else {\n            gl_FragColor = ((1.0 - a) * texture2D(uSampler, vTextureCoord) + (a * texture2D(uSampler2, vTextureCoord))) * vColor;\n        }\n    }\n";class nd extends at{static _template(){const t=function(e,i){if(i._recalc&130){const s=i.w,r=i.h;let o=i;do o=o._children[0],o._element.w=s,o._element.h=r;while(o._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,BloomBase:{shader:{type:ua},Content:{}}},Layers:{L0:{rtt:!0,onUpdate:t,scale:2,pivot:0,visible:!1,Content:{shader:{type:Yt}}},L1:{rtt:!0,onUpdate:t,scale:4,pivot:0,visible:!1,Content:{shader:{type:Yt}}},L2:{rtt:!0,onUpdate:t,scale:8,pivot:0,visible:!1,Content:{shader:{type:Yt}}},L3:{rtt:!0,onUpdate:t,scale:16,pivot:0,visible:!1,Content:{shader:{type:Yt}}}}}}get _signalProxy(){return!0}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap.Content"),this._layers=this.sel("Layers"),this._amount=0,this._paddingX=0,this._paddingY=0}_build(){const e=[{x:1,y:0,kernelRadius:3},{x:0,y:1,kernelRadius:3},{x:1.5,y:0,kernelRadius:3},{x:0,y:1.5,kernelRadius:3}].map(i=>this.stage.createShader(Object.assign({type:Ms},i)));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[e[0],e[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[e[0],e[1],e[2],e[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[e[0],e[1],e[2],e[3]])}_setLayerTexture(t,e,i){if(!i.length)t.texture=e;else{const s=i.pop(),r=t.stage.c({rtt:!0,shader:s});this._setLayerTexture(r,e,i),t.childList.add(r)}return t}get content(){return this.sel("Textwrap.Content")}set content(t){this.sel("Textwrap.Content").patch(t)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}getLayer(t){return this._layers.sel("L"+t)}getLayerContents(t){return this.getLayer(t).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,e=this.renderHeight,i=this._paddingX,s=this._paddingY,r=t+i*2,o=e+s*2;this._textwrap.w=r,this._wrapper.x=i,this.getLayer(0).w=this.getLayerContents(0).w=r/2,this.getLayer(1).w=this.getLayerContents(1).w=r/4,this.getLayer(2).w=this.getLayerContents(2).w=r/8,this.getLayer(3).w=this.getLayerContents(3).w=r/16,this._textwrap.x=-i,this._textwrap.h=o,this._wrapper.y=s,this.getLayer(0).h=this.getLayerContents(0).h=o/2,this.getLayer(1).h=this.getLayerContents(1).h=o/4,this.getLayer(2).h=this.getLayerContents(2).h=o/8,this.getLayer(3).h=this.getLayerContents(3).h=o/16,this._textwrap.y=-s,this.w=t,this.h=e}set amount(t){this._amount=t,this._update()}get amount(){return this._amount}_update(){let t=Math.min(4,Math.max(0,this._amount));t>0&&(this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3)}set shader(t){super.shader=t,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._build()}}class ua extends G{}ua.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float m = max(max(color.r, color.g), color.b);\n        float c = max(0.0, (m - 0.80)) * 5.0;\n        color = color * c;\n        gl_FragColor = color;\n    }\n";class _s extends at{static _template(){return{ContentWrap:{renderOffscreen:!0,forceZIndexContext:!0,onAfterUpdate:_s._updateDimensions,Content:{}},Scale:{visible:!1}}}constructor(t){super(t),this._smoothScale=1,this._iterations=0}get content(){return this.tag("Content")}set content(t){this.tag("Content").patch(t,!0)}get smoothScale(){return this._smoothScale}set smoothScale(t){if(this._smoothScale!==t){let e=0;for(;t<.5&&e<12;)e++,t=t*2;this.scale=t,this._setIterations(e),this._smoothScale=t}}_setIterations(t){if(this._iterations!==t){const e=this.sel("Scale").childList,i=this.sel("ContentWrap");for(;e.length<t;){const o=e.length===0?i.getTexture():e.last.getTexture();e.a({rtt:!0,renderOffscreen:!0,texture:o})}_s._updateDimensions(this.tag("ContentWrap"),!0);const s=t>0;this.patch({ContentWrap:{renderToTexture:s},Scale:{visible:s}});for(let r=0,o=e.length;r<o;r++)e.getAt(r).patch({visible:r<t,renderOffscreen:r!==t-1});this._iterations=t}}static _updateDimensions(t,e){const i=t.children[0];let s=i.renderWidth,r=i.renderHeight;if(s!==t.w||r!==t.h||e){t.w=s,t.h=r;const o=t.parent.tag("Scale").children;for(let a=0,h=o.length;a<h;a++)s=s*.5,r=r*.5,o[a].w=s,o[a].h=r}}get _signalProxy(){return!0}}class od extends at{static _template(){return{Content:{},Borders:{Top:{rect:!0,visible:!1,mountY:1},Right:{rect:!0,visible:!1},Bottom:{rect:!0,visible:!1},Left:{rect:!0,visible:!1,mountX:1}}}}get _signalProxy(){return!0}constructor(t){super(t),this._borderTop=this.tag("Top"),this._borderRight=this.tag("Right"),this._borderBottom=this.tag("Bottom"),this._borderLeft=this.tag("Left"),this.onAfterUpdate=function(e){const i=e.childList.first;let s=e.core.w||i.renderWidth,r=e.core.h||i.renderHeight;e._borderTop.w=s,e._borderBottom.y=r,e._borderBottom.w=s,e._borderLeft.h=r+e._borderTop.h+e._borderBottom.h,e._borderLeft.y=-e._borderTop.h,e._borderRight.x=s,e._borderRight.h=r+e._borderTop.h+e._borderBottom.h,e._borderRight.y=-e._borderTop.h},this.borderWidth=1}get content(){return this.sel("Content")}set content(t){this.sel("Content").patch(t,!0)}get borderWidth(){return this.borderWidthTop}get borderWidthTop(){return this._borderTop.h}get borderWidthRight(){return this._borderRight.w}get borderWidthBottom(){return this._borderBottom.h}get borderWidthLeft(){return this._borderLeft.w}set borderWidth(t){this.borderWidthTop=t,this.borderWidthRight=t,this.borderWidthBottom=t,this.borderWidthLeft=t}set borderWidthTop(t){this._borderTop.h=t,this._borderTop.visible=t>0}set borderWidthRight(t){this._borderRight.w=t,this._borderRight.visible=t>0}set borderWidthBottom(t){this._borderBottom.h=t,this._borderBottom.visible=t>0}set borderWidthLeft(t){this._borderLeft.w=t,this._borderLeft.visible=t>0}get colorBorder(){return this.colorBorderTop}get colorBorderTop(){return this._borderTop.color}get colorBorderRight(){return this._borderRight.color}get colorBorderBottom(){return this._borderBottom.color}get colorBorderLeft(){return this._borderLeft.color}set colorBorder(t){this.colorBorderTop=t,this.colorBorderRight=t,this.colorBorderBottom=t,this.colorBorderLeft=t}set colorBorderTop(t){this._borderTop.color=t}set colorBorderRight(t){this._borderRight.color=t}set colorBorderBottom(t){this._borderBottom.color=t}set colorBorderLeft(t){this._borderLeft.color=t}get borderTop(){return this._borderTop}set borderTop(t){this.borderTop.patch(t)}get borderRight(){return this._borderRight}set borderRight(t){this.borderRight.patch(t)}get borderBottom(){return this._borderBottom}set borderBottom(t){this.borderBottom.patch(t)}get borderLeft(){return this._borderLeft}set borderLeft(t){this.borderLeft.patch(t)}set borders(t){this.borderTop=t,this.borderLeft=t,this.borderBottom=t,this.borderRight=t}}class Xr extends G{constructor(t){super(t),this._amount=1}static getC2d(){return da}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}setupUniforms(t){super.setupUniforms(t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}Xr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float grayness = 0.2 * color.r + 0.6 * color.g + 0.2 * color.b;\n        gl_FragColor = vec4(amount * vec3(grayness, grayness, grayness) + (1.0 - amount) * color.rgb, color.a);\n    }\n";class da extends Bs{constructor(t){super(t),this._amount=1}static getWebGL(){return Xr}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}_beforeDrawEl({target:t}){t.ctx.filter="grayscale("+this._amount+")"}_afterDrawEl({target:t}){t.ctx.filter="none"}}class Gr extends G{constructor(t){super(t),this._noiseTexture=new ha(t.stage),this._graining=1/256,this._random=!1}set graining(t){this._graining=t,this.redraw()}set random(t){this._random=t,this.redraw()}setExtraAttribsInBuffer(t){this._noiseTexture.load();let e=t.extraAttribsDataByteOffset/4,i=t.quads.floats,s=t.length;for(let r=0;r<s;r++){let o=t.getElementWidth(r)/this._noiseTexture.getRenderWidth(),a=t.getElementHeight(r)/this._noiseTexture.getRenderHeight(),h=0,l=0;if(this._random){if(h=Math.random(),l=Math.random(),o+=h,a+=l,Math.random()<.5){const c=h;h=o,o=c}if(Math.random()<.5){const c=l;l=a,a=c}}i[e]=h,i[e+1]=l,i[e+2]=o,i[e+3]=l,i[e+4]=o,i[e+5]=a,i[e+6]=h,i[e+7]=a,e+=8}}beforeDraw(t){let e=this.gl;e.vertexAttribPointer(this._attrib("aNoiseTextureCoord"),2,e.FLOAT,!1,8,this.getVertexAttribPointerOffset(t));let i=this._noiseTexture.source.nativeTexture;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i),e.activeTexture(e.TEXTURE0)}getExtraAttribBytesPerVertex(){return 8}setupUniforms(t){super.setupUniforms(t),this._setUniform("uNoiseSampler",1,this.gl.uniform1i),this._setUniform("graining",2*this._graining,this.gl.uniform1f)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}useDefault(){return this._graining===0}afterDraw(t){this._random&&this.redraw()}}Gr.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec2 aNoiseTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vNoiseTextureCoord = aNoiseTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";Gr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uNoiseSampler;\n    uniform float graining;\n    void main(void){\n        vec4 noise = texture2D(uNoiseSampler, vNoiseTextureCoord);\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        gl_FragColor = (color * vColor) + graining * (noise.r - 0.5);\n    }\n";class jr extends G{constructor(t){super(t),this._inputValue=0,this._maxDerivative=.01,this._normalizedValue=0,this._offset=0,this._amount=.1,this._aspectRatio=1,this._offsetX=0,this._offsetY=0,this.buckets=100}get aspectRatio(){return this._aspectRatio}set aspectRatio(t){this._aspectRatio=t,this.redraw()}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t,this.redraw()}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t,this.redraw()}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}set inputValue(t){this._inputValue=t}get inputValue(){return this._inputValue}set maxDerivative(t){this._maxDerivative=t}get maxDerivative(){return this._maxDerivative}set buckets(t){t>100&&(console.warn("[Lightning] CircularPushShader: supports max 100 buckets"),t=100),this._buckets=t,this._values=new Uint8Array(this._getValues(t)),this.redraw()}get buckets(){return this._buckets}_getValues(t){const e=[];for(let i=0;i<t;i++)e.push(this._inputValue);return e}progress(t){this._offset+=t*this._buckets;const e=Math.floor(this._offset);this._offset-=e,this._shiftBuckets(e),this.redraw()}_shiftBuckets(t){for(let e=this._buckets-1;e>=0;e--){const i=e-t;i<0?(this._normalizedValue=Math.min(this._normalizedValue+this._maxDerivative,Math.max(this._normalizedValue-this._maxDerivative,this._inputValue)),this._values[e]=255*this._normalizedValue):this._values[e]=this._values[i]}}set offset(t){this._offset=t,this.redraw()}setupUniforms(t){super.setupUniforms(t),this._setUniform("aspectRatio",this._aspectRatio,this.gl.uniform1f),this._setUniform("offsetX",this._offsetX,this.gl.uniform1f),this._setUniform("offsetY",this._offsetY,this.gl.uniform1f),this._setUniform("amount",this._amount,this.gl.uniform1f),this._setUniform("offset",this._offset,this.gl.uniform1f),this._setUniform("buckets",this._buckets,this.gl.uniform1f),this._setUniform("uValueSampler",1,this.gl.uniform1i)}useDefault(){return this._amount===0}beforeDraw(t){const e=this.gl;e.activeTexture(e.TEXTURE1),this._valuesTexture?e.bindTexture(e.TEXTURE_2D,this._valuesTexture):(this._valuesTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._valuesTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),b.isNode&&e.pixelStorei(e.UNPACK_FLIP_BLUE_RED,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this._buckets,1,0,e.ALPHA,e.UNSIGNED_BYTE,this._values),e.activeTexture(e.TEXTURE0)}cleanup(){this._valuesTexture&&this.gl.deleteTexture(this._valuesTexture)}}jr.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    uniform float offsetX;\n    uniform float offsetY;\n    uniform float aspectRatio;\n    varying vec2 vTextureCoord;\n    varying vec2 vPos;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vPos = vTextureCoord * 2.0 - 1.0;\n        vPos.y = vPos.y * aspectRatio;\n        vPos.y = vPos.y + offsetY;\n        vPos.x = vPos.x + offsetX;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";jr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vPos;\n    uniform float amount;\n    uniform float offset;\n    uniform float values[100];\n    uniform float buckets;\n    uniform sampler2D uSampler;\n    uniform sampler2D uValueSampler;\n    void main(void){\n        float l = length(vPos);\n        float m = (l * buckets * 0.678 - offset) / buckets;\n        float f = texture2D(uValueSampler, vec2(m, 0.0)).a * amount;\n        vec2 unit = vPos / l;\n        gl_FragColor = texture2D(uSampler, vTextureCoord - f * unit) * vColor;\n    }\n";class fa extends G{constructor(t){super(t),this._amount=1}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}setupUniforms(t){super.setupUniforms(t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}fa.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        color.rgb = color.rgb * (1.0 - amount) + amount * (1.0 * color.a - color.rgb); \n        gl_FragColor = color * vColor;\n    }\n";class Vr extends G{constructor(t){super(t),this._width=5,this._col=4294967295,this._color=[1,1,1,1]}set width(t){this._width=t,this.redraw()}get color(){return this._col}set color(t){if(this._col!==t){const e=M.getRgbaComponentsNormalized(t);e[0]=e[0]*e[3],e[1]=e[1]*e[3],e[2]=e[2]*e[3],this._color=e,this.redraw(),this._col=t}}useDefault(){return this._width===0||this._col[3]===0}setupUniforms(t){super.setupUniforms(t);let e=this.gl;this._setUniform("color",new Float32Array(this._color),e.uniform4fv)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aCorner"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aCorner"))}setExtraAttribsInBuffer(t){let e=t.extraAttribsDataByteOffset/4,i=t.quads.floats,s=t.length;for(let r=0;r<s;r++){const o=t.getElementCore(r),a=this._width/o.w,h=a/(1-2*a),l=this._width/o.h,c=l/(1-2*l);i[e]=-h,i[e+1]=-c,i[e+2]=1+h,i[e+3]=-c,i[e+4]=1+h,i[e+5]=1+c,i[e+6]=-h,i[e+7]=1+c,e+=8}}beforeDraw(t){let e=this.gl;e.vertexAttribPointer(this._attrib("aCorner"),2,e.FLOAT,!1,8,this.getVertexAttribPointerOffset(t))}getExtraAttribBytesPerVertex(){return 8}}Vr.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aCorner;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vCorner;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vCorner = aCorner;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";Vr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vCorner;\n    uniform vec4 color;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec2 m = min(vCorner, 1.0 - vCorner);\n        float value = step(0.0, min(m.x, m.y));\n        gl_FragColor = mix(color, texture2D(uSampler, vTextureCoord) * vColor, value);\n    }\n";class Kr extends G{constructor(t){super(t),this._size=new Float32Array([4,4])}get x(){return this._size[0]}set x(t){this._size[0]=t,this.redraw()}get y(){return this._size[1]}set y(t){this._size[1]=t,this.redraw()}get size(){return this._size[0]}set size(t){this._size[0]=t,this._size[1]=t,this.redraw()}useDefault(){return this._size[0]===0&&this._size[1]===0}static getWebGLImpl(){return WebGLPixelateShaderImpl}setupUniforms(t){super.setupUniforms(t);let e=this.gl;this._setUniform("size",new Float32Array(this._size),e.uniform2fv)}getExtraAttribBytesPerVertex(){return 8}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aTextureRes"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aTextureRes"))}setExtraAttribsInBuffer(t){let e=t.extraAttribsDataByteOffset/4,i=t.quads.floats,s=t.length;for(let r=0;r<s;r++){let o=t.quads.getTextureWidth(t.index+r),a=t.quads.getTextureHeight(t.index+r);i[e]=o,i[e+1]=a,i[e+2]=o,i[e+3]=a,i[e+4]=o,i[e+5]=a,i[e+6]=o,i[e+7]=a,e+=8}}beforeDraw(t){let e=this.gl;e.vertexAttribPointer(this._attrib("aTextureRes"),2,e.FLOAT,!1,this.getExtraAttribBytesPerVertex(),this.getVertexAttribPointerOffset(t))}}Kr.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aTextureRes;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        vTextureRes = aTextureRes;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";Kr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n\n    uniform vec2 size;\n    uniform sampler2D uSampler;\n    \n    vec2 mapCoord( vec2 coord )\n    {\n        coord *= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 unmapCoord( vec2 coord )\n    {\n        coord /= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 pixelate(vec2 coord, vec2 size)\n    {\n        return floor( coord / size ) * size;\n    }\n    \n    void main(void)\n    {\n        vec2 coord = mapCoord(vTextureCoord);\n        coord = pixelate(coord, size);\n        coord = unmapCoord(coord);\n        gl_FragColor = texture2D(uSampler, coord) * vColor;\n    }\n";class qr extends G{constructor(t){super(t),this._radius=0,this._cutoff=1}set radius(t){this._radius=t,this.redraw()}get radius(){return this._radius}set cutoff(t){this._cutoff=t,this.redraw()}get cutoff(){return this._cutoff}useDefault(){return this._radius===0}setupUniforms(t){super.setupUniforms(t),this._setUniform("radius",2*(this._radius-.5)/t.getRenderWidth(),this.gl.uniform1f),this._setUniform("cutoff",.5*t.getRenderWidth()/this._cutoff,this.gl.uniform1f)}}qr.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 pos;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n        pos = gl_Position.xy;\n    }\n";qr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 pos;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float radius;\n    uniform float cutoff;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        float f = max(0.0, min(1.0, 1.0 - (length(pos) - radius) * cutoff));\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor * f;\n    }\n";class Zr extends G{constructor(t){super(t),this._blend=0,this._radius=[1,1,1,1],this._stroke=0,this._fc=16777215,this._fillColor=this._getNormalizedColor(4294967295),this._strokeColor=this._getNormalizedColor(16777215)}set blend(t){this._blend=Math.min(Math.max(t,0),1)}set radius(t){Array.isArray(t)?t.length===2?this._radius=[t[0],t[1],t[0],t[1]]:t.length===3?this._radius=[t[0],t[1],t[2],this._radius[3]]:t.length===4?this._radius=t:this._radius=[t[0],t[0],t[0],t[0]]:this._radius=[t,t,t,t],this.redraw()}get radius(){return this._radius}set topLeft(t){this._radius[0]=t,this.redraw()}get topLeft(){return this._radius[0]}set topRight(t){this._radius[1]=t,this.redraw()}get topRight(){return this._radius[1]}set bottomRight(t){this._radius[2]=t,this.redraw()}get bottomRight(){return this._radius[2]}set bottomLeft(t){this._radius[3]=t,this.redraw()}get bottomLeft(){return this._radius[4]}set strokeColor(t){this._sc=t,this._strokeColor=this._getNormalizedColor(t),this.redraw()}get strokeColor(){return this._sc}set fillColor(t){this._fc=t,this._fillColor=this._getNormalizedColor(t),this.redraw()}get fillColor(){return this._fc}set stroke(t){this._stroke=t,this.redraw()}get stroke(){return this._stroke}_getNormalizedColor(t){const e=M.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision(),s=this._radius.map(r=>(r+.5)*i);this._setUniform("radius",new Float32Array(s),this.gl.uniform4fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("blend",this._blend,this.gl.uniform1f),this._setUniform("strokeColor",this._strokeColor,this.gl.uniform4fv),this._setUniform("fillColor",this._fillColor,this.gl.uniform4fv),this._setUniform("stroke",this._stroke*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}}Zr.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";Zr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n\n    #define PI 3.14159265359\n\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 radius;\n    uniform float stroke;\n    uniform vec4 strokeColor;\n    uniform vec4 fillColor;\n    uniform float alpha;\n    uniform float fill;\n    uniform float blend;\n    \n    float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    float innerBorderMask(float dist, float width){\n        float alpha1 = clamp(dist + width, 0.0, 1.0);\n        float alpha2 = clamp(dist, 0.0, 1.0);\n        return alpha1 - alpha2;\n    }\n\n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        float r = 0.0;\n        if (vTextureCoord.x < 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[0];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[1];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y >= 0.5) {\n            r = radius[2];\n        } else {\n            r = radius[3];\n        }\n        \n        float b = boxDist(vTextureCoord.xy * resolution - halfRes, halfRes - 0.005, r);\n        vec4 tex = texture2D(uSampler, vTextureCoord) * vColor;\n        vec4 blend = mix(vec4(1.0) * alpha, tex, blend);     \n        vec4 layer1 = mix(vec4(0.0), tex * fillColor, fillMask(b));\n        gl_FragColor = mix(layer1, blend * strokeColor, innerBorderMask(b, stroke));\n    }\n";class ga extends G{constructor(t){super(t),this._fade=[0,0,0,0]}set top(t){this._fade[0]=t,this.redraw()}get top(){return this._fade[0]}set right(t){this._fade[1]=t,this.redraw()}get right(){return this._fade[1]}set bottom(t){this._fade[2]=t,this.redraw()}get bottom(){return this._fade[2]}set left(t){this._fade[3]=t,this.redraw()}get left(){return this._fade[3]}set fade(t){Array.isArray(t)?t.length===2?this._fade=[t[0],t[1],t[0],t[1]]:t.length===3?this._fade=[t[0],t[1],t[2],this._fade[3]]:t.length===4?this._fade=t:this._fade=[t[0],t[0],t[0],t[0]]:this._fade=[t,t,t,t],this.redraw()}get fade(){return this._fade}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision(),s=this._fade.map(r=>r*i);this._setUniform("fade",new Float32Array(s),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}}ga.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 fade;\n    \n    void main() {\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 point = vTextureCoord.xy * resolution.xy;\n        \n        vec2 pos1;\n        vec2 pos2;\n        vec2 d;\n        float c;\n        float t = 0.0;\n             \n        if(fade[0] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x, point.y + fade[0]);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[1] > 0.0) {\n            vec2 pos1 = vec2(point.x - resolution.x - fade[1], vTextureCoord.y);\n            vec2 pos2 = vec2(point.x - resolution.x, vTextureCoord.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[2] > 0.0) {\n            vec2 pos1 = vec2(vTextureCoord.x, point.y - resolution.y - fade[2]);\n            vec2 pos2 = vec2(vTextureCoord.x, point.y - resolution.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[3] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x + fade[3], point.y);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        gl_FragColor = color;\n    }\n";class Jr extends G{constructor(t){super(t),this._magnitude=1.3,this._intensity=.7,this._pivot=[.5,.5]}setupUniforms(t){super.setupUniforms(t),this._setUniform("magnitude",this._magnitude,this.gl.uniform1f),this._setUniform("intensity",this._intensity,this.gl.uniform1f),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this.redraw()}set pivot(t){Array.isArray(t)?this._pivot=t:this._pivot=[t,t],this.redraw()}get pivotX(){return this._pivot[0]}set pivotX(t){this._pivot[0]=t,this.redraw()}get pivotY(){return this._pivot[1]}set pivotY(t){this._pivot[1]=t,this.redraw()}get intensity(){return this._intensity}set intensity(t){this._intensity=t,this.redraw()}get magnitude(){return this._magnitude}set magnitude(t){this._magnitude=t,this.redraw()}}Jr.vertexShaderSource=G.vertexShaderSource;Jr.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float magnitude;\n    uniform float intensity;\n    uniform vec2 pivot;\n\n    void main() {\n        vec2 uv = vTextureCoord.xy - pivot + vec2(0.5);\n        uv.x = clamp(uv.x, 0.0, 1.0);\n        uv.y = clamp(uv.y, 0.0, 1.0);\n   \n        uv *=  1.00 - uv.yx;\n        float vig = uv.x * uv.y * 25.0 * intensity;\n        vig = pow(vig, 0.45 * magnitude);\n        vec4 fragColor = vec4(vig) * vColor;\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * fragColor;\n\n    }\n";class tn extends G{constructor(t){super(t),this._radius=100,this._width=50,this._period=1,this._angle=.5,this._smooth=.005,this._color=4294967295,this._backgroundColor=4278190080,this._time=Date.now()}set radius(t){this._radius=t,this.redraw()}set width(t){this._width=t,this.redraw()}set period(t){this._period=t,this.redraw()}set angle(t){this._angle=t,this.redraw()}set smooth(t){this._smooth=t,this.redraw()}set color(t){this._color=t,this.redraw()}set backgroundColor(t){this._backgroundColor=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner;this._setUniform("iTime",Date.now()-this._time,this.gl.uniform1f);const i=this.ctx.stage.getRenderPrecision();this._setUniform("radius",this._radius*i,this.gl.uniform1f),this._setUniform("width",this._width*i,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("angle",this._angle,this.gl.uniform1f),this._setUniform("smooth",this._smooth,this.gl.uniform1f),this._setUniform("color",new Float32Array(M.getRgbaComponentsNormalized(this._color)),this.gl.uniform4fv),this._setUniform("backgroundColor",new Float32Array(M.getRgbaComponentsNormalized(this._backgroundColor)),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv),this.redraw()}}tn.vertexShaderSource=G.vertexShaderSource;tn.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float iTime;\n    uniform float radius;\n    uniform float width;\n    uniform float period;\n    uniform float angle;\n    uniform float smooth;\n    uniform vec2 resolution;\n\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n\n    float ratio = resolution.y / resolution.x;\n\n    vec2 transpose_pos(vec2 pos) {\n        if (ratio < 1.) {\n            float diff = 0.5 - pos.x;\n            pos.x = 0.5 - diff / ratio;\n        } else {\n            float diff = 0.5 - pos.y;\n            pos.y = 0.5 - diff * ratio;\n        }\n        return pos;\n    }\n\n    float get_angle(vec2 pos) {\n        pos = transpose_pos(pos);\n        float a = atan(pos.y - 0.5, pos.x - 0.5);\n        a = (1.0+a/3.14159)/2.0;\n        \n        return a;\n    }\n\n    float dist(vec2 pos1, vec2 pos2) {\n        pos1 = transpose_pos(pos1);\n        return distance(pos1, pos2);\n    }\n\n    void main()\n    {\n        vec2 fragCoord = vTextureCoord;\n        vec4 fragColor = vColor;\n        \n        vec2 st = vTextureCoord;\n        float pct = dist(st, vec2(0.5));\n\n        float a = get_angle(st);\n        float t = iTime / 1000.0 / period;\n\n        float inner = max((radius - width) / resolution.x, (radius - width) / resolution.y);\n        float outer = max(radius / resolution.x, radius / resolution.y);\n\n        float x1 = mod(t, 1.0);\n        float x2 = mod(t + angle, 1.0);\n\n        if (x1 < x2) {\n            if (a > x1 && a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        } else {\n            if (a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else if (a > x1) {\n                float val = (1.0 - (1.0 + x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (1.0 + x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        }\n\n        float s = smoothstep(inner, inner + smooth + 0.00001, pct) * (1.0 - smoothstep(outer, outer + smooth + 0.00001, pct));\n        gl_FragColor = texture2D(uSampler, fragCoord) * vColor * (1. - s * fragColor.a) + fragColor * s;\n    }\n";class en extends G{constructor(t){super(t),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0}get x(){return this._x}set x(t){this._x=t,this.redraw()}get y(){return this._y}set y(t){this._y=t,this.redraw()}get w(){return this._w}set w(t){this._w=t,this.redraw()}get h(){return this._h}set h(t){this._h=t,this.redraw()}get radius(){return this._radius}set radius(t){this._radius=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}useDefault(){return this._x===0&&this._y===0&&this._w===0&&this._h===0}}en.vertexShaderSource=G.vertexShaderSource;en.fragmentShaderSource="\n   #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float x;\n    uniform float y;\n    uniform float w;\n    uniform float h;\n    uniform vec2 resolution;\n    uniform float radius;\n\n    float roundBox(vec2 p, vec2 b, float r) {\n        float d = length(max(abs(p)-b+r, 0.1))-r;\n        return smoothstep(1.0, 0.0, d);\n    }\n\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n        vec2 size = vec2(w, h) / 2.0;\n        float b = roundBox(pos, size, radius);\n        gl_FragColor = mix(color, vec4(0.0), b) * vColor;\n    }\n";class _a extends G{constructor(t){super(t),this._pivot=[0,0],this._ic=4294967295,this._normalizedIC=this._getNormalizedColor(this._ic),this._oc=16777215,this._normalizedOC=this._getNormalizedColor(this._oc),this._radius=0}set radiusX(t){this.radius=t}get radiusX(){return this._radius}set radiusY(t){this._radiusY=t,this.redraw()}get radiusY(){return this._radiusY}set radius(t){this._radius=t,this.redraw()}set innerColor(t){this._ic=t,this._normalizedIC=this._getNormalizedColor(t),this.redraw()}get innerColor(){return this._ic}set outerColor(t){this._oc=t,this._normalizedOC=this._getNormalizedColor(t),this.redraw()}set color(t){this.innerColor=t}get color(){return this.innerColor}get outerColor(){return this._ic}set x(t){this._x=t,this.redraw()}set y(t){this._y=t,this.redraw()}set pivot(t){Array.isArray(t)&&t.length===2?this._pivot=t:Array.isArray(t)?this._pivot=[t[0],t[1]||t[0]]:this._pivot=[t,t],this.redraw()}get pivot(){return this._pivot[0]}set pivotY(t){this._pivot[1]=t,this.redraw()}get pivotY(){return this._pivot[1]}set pivotX(t){this._pivot[0]=t,this.redraw()}get pivotX(){return this._pivot[0]}_getNormalizedColor(t){const e=M.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner;this._x&&(this._pivot[0]=this._x/e.w),this._y&&(this._pivot[1]=this._y/e.h),this._radius===0&&(this._radius=e.w*.5),this._setUniform("innerColor",this._normalizedIC,this.gl.uniform4fv),this._setUniform("fill",M.getRgbaComponentsNormalized(this._oc)[3],this.gl.uniform1f),this._setUniform("outerColor",this._normalizedOC,this.gl.uniform4fv),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this._setUniform("resolution",new Float32Array([e._w,e._h]),this.gl.uniform2fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("radius",this._radius,this.gl.uniform1f),this._setUniform("radiusY",this._radiusY||this._radius,this.gl.uniform1f)}}_a.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec2 pivot;\n    uniform vec4 innerColor;\n    uniform vec4 outerColor;\n    uniform float radius;\n    uniform float radiusY;\n    uniform float alpha;\n    uniform float fill;\n    uniform float aspectRatio;\n    \n    void main() {\n        vec2 point = vTextureCoord.xy * resolution;\n        vec2 projection = vec2(pivot.x * resolution.x, pivot.y * resolution.y);\n        float d = length((point - projection) / vec2(radius * 2.0, radiusY * 2.0));\n        vec4 color = mix(texture2D(uSampler, vTextureCoord) * vColor, outerColor * alpha, fill);\n        gl_FragColor = mix(innerColor * alpha, color, smoothstep(0.0, 1.0, d));\n    }\n";class sn extends G{constructor(t){super(t),this._strength=.5,this._ambient=.5,this._fudge=.4,this._rx=0,this._ry=0,this._z=0,this._pivotX=NaN,this._pivotY=NaN,this._pivotZ=0,this._lightY=0,this._lightZ=0}setupUniforms(t){super.setupUniforms(t);let e=t.shaderOwner,i=e.element,s=isNaN(this._pivotX)?i.pivotX*e.w:this._pivotX,r=isNaN(this._pivotY)?i.pivotY*e.h:this._pivotY,o=e.getRenderTextureCoords(s,r),a=-Math.atan2(e._renderContext.tc,e._renderContext.ta),h=this.gl;this._setUniform("pivot",new Float32Array([o[0],o[1],this._pivotZ]),h.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,a]),h.uniform3fv),this._setUniform("z",this._z,h.uniform1f),this._setUniform("lightY",this.lightY,h.uniform1f),this._setUniform("lightZ",this.lightZ,h.uniform1f),this._setUniform("strength",this._strength,h.uniform1f),this._setUniform("ambient",this._ambient,h.uniform1f),this._setUniform("fudge",this._fudge,h.uniform1f)}set strength(t){this._strength=t,this.redraw()}get strength(){return this._strength}set ambient(t){this._ambient=t,this.redraw()}get ambient(){return this._ambient}set fudge(t){this._fudge=t,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(t){this._rx=t,this.redraw()}get ry(){return this._ry}set ry(t){this._ry=t,this.redraw()}get z(){return this._z}set z(t){this._z=t,this.redraw()}get pivotX(){return this._pivotX}set pivotX(t){this._pivotX=t+1,this.redraw()}get pivotY(){return this._pivotY}set pivotY(t){this._pivotY=t+1,this.redraw()}get lightY(){return this._lightY}set lightY(t){this._lightY=t,this.redraw()}get pivotZ(){return this._pivotZ}set pivotZ(t){this._pivotZ=t,this.redraw()}get lightZ(){return this._lightZ}set lightZ(t){this._lightZ=t,this.redraw()}useDefault(){return this._rx===0&&this._ry===0&&this._z===0&&this._strength===0&&this._ambient===1}}sn.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float fudge;\n    uniform float strength;\n    uniform float ambient;\n    uniform float z;\n    uniform float lightY;\n    uniform float lightZ;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Set depth perspective\n        float perspective = 1.0 + fudge * pos.z;\n\n        pos.z += lightZ * projection.x;\n\n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, perspective);\n\n        // Correct light source position.\n        pos.y += lightY * abs(projection.y);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";sn.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec3 pos;\n    uniform sampler2D uSampler;\n    uniform float ambient;\n    uniform float strength;\n    void main(void){\n        vec4 rgba = texture2D(uSampler, vTextureCoord);\n        float d = length(pos);\n        float n = 1.0 / max(0.1, d);\n        rgba.rgb = rgba.rgb * (strength * n + ambient);\n        gl_FragColor = rgba * vColor;\n    }\n";class rn extends G{constructor(t){super(t),this._fudge=.2,this._rx=0,this._ry=0,this._z=1}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=e.element,s=i.pivotX*e.w,r=i.pivotY*e.h,o=e.getRenderTextureCoords(s,r),a=-Math.atan2(e._renderContext.tc,e._renderContext.ta),h=this.gl;this._setUniform("pivot",new Float32Array([o[0],o[1],0]),h.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,a]),h.uniform3fv),this._setUniform("z",this._z,h.uniform1f),this._setUniform("fudge",this._fudge,h.uniform1f)}set fudge(t){this._fudge=t,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(t){this._rx=t,this.redraw()}get ry(){return this._ry}set ry(t){this._ry=t,this.redraw()}get z(){return this._z}set z(t){this._z=t,this.redraw()}useDefault(){return this._rx===0&&this._ry===0&&this._z===0}}rn.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float z;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, z);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n";rn.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform vec3 rot;\n    uniform float fudge;\n\n    void main(void) {\n        vec2 coords = vTextureCoord;\n\n        coords.xy -= vec2(0.5);\n        coords.y = coords.y + (sign(rot[0]) * 0.5 - coords.x) * sin(rot[0]) * fudge * coords.y;\n        coords.x = coords.x + (sign(rot[1]) * 0.5 - coords.y) * sin(rot[1]) * fudge * coords.x;\n        coords.xy += vec2(0.5);\n\n        if (coords.x < 0.0 || coords.x > 1.0 || coords.y < 0.0 || coords.y > 1.0) {\n            gl_FragColor = vec4(0.0);\n        } else {\n            gl_FragColor = texture2D(uSampler, coords) * vColor;\n        }\n    }\n";class nn extends G{constructor(t){super(t),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0,this._magnification=.6}get x(){return this._x}set x(t){this._x=t,this.redraw()}get y(){return this._y}set y(t){this._y=t,this.redraw()}get w(){return this._w}set w(t){this._w=t,this.redraw()}get h(){return this._h}set h(t){this._h=t,this.redraw()}get magnification(){return this._magnification}set magnification(t){this._magnification=t,this.redraw()}get radius(){return this._radius}set radius(t){this._radius=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("magnification",this._magnification,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}useDefault(){return this._w===0&&this._h===0}}nn.vertexShaderSource=G.vertexShaderSource;nn.fragmentShaderSource="\n	  #ifdef GL_ES\n		# ifdef GL_FRAGMENT_PRECISION_HIGH\n		precision highp float;\n		# else\n		precision lowp float;\n		# endif\n	  #endif\n\n	  varying vec2 vTextureCoord;\n	  varying vec4 vColor;\n	  uniform sampler2D uSampler;\n	  uniform float x;\n	  uniform float y;\n	  uniform float w;\n	  uniform float h;\n	  uniform vec2 resolution;\n	  uniform float radius;\n	  uniform float magnification;\n  \n	  float roundBox(vec2 p, vec2 b, float r) {\n		  float d = length(max(abs(p)-b+r, 0.1))-r;\n		  return smoothstep(1.0, 0.0, d);\n	  }\n\n	  float inside(vec2 v) {\n		vec2 s = step(vec2(0.0, 0.0), v) - step(vec2(1.0, 1.0), v);\n		return s.x * s.y;   \n      }\n  \n	  void main(void) {\n		vec4 color = texture2D(uSampler, vTextureCoord);\n		vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n		vec2 size = vec2(w, h) / 2.0;\n		float b = roundBox(pos, size, radius);\n		vec2 pos2 = (vTextureCoord.xy * magnification * resolution + vec2(x, y) * magnification) / resolution;\n		gl_FragColor = mix(color, texture2D(uSampler, pos2) * inside(pos2), b) * vColor;\n	  }\n  ";class Li extends G{constructor(t){super(t),this._period=1,this._stroke=0,this._showDot=!0,this._clockwise=!0,this._bc=4278190080,this._normalizedBC=this._getNormalizedColor(this._bc),this._c=4294967295,this._normalizedC=this._getNormalizedColor(this._c)}set radius(t){t===0&&(t=1),this._radius=t}set stroke(t){this._stroke=Math.abs(t)}get stroke(){return this._stroke}set color(t){this._c=t,this._normalizedC=this._getNormalizedColor(t)}get color(){return this._c}set backgroundColor(t){this._bc=t,this._normalizedBC=this._getNormalizedColor(t)}get backgroundColor(){return this._sc}set showDot(t){this._showDot=t}get showDot(){return this._showDot}set clockwise(t){this._clockwise=t}get clockwise(){return this._clockwise}set period(t){this._period=t}get period(){return this._period}_getNormalizedColor(t){const e=M.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this._radius||e._w/2;this._stroke===0&&(this._stroke=i*.33),this._setUniform("resolution",new Float32Array([e._w,e._h]),this.gl.uniform2fv),this._setUniform("color",this._normalizedC,this.gl.uniform4fv),this._setUniform("backgroundColor",this._normalizedBC,this.gl.uniform4fv),this._setUniform("stroke",this._stroke,this.gl.uniform1f),this._setUniform("radius",i,this.gl.uniform1f),this._setUniform("direction",this._clockwise?-1:1,this.gl.uniform1f),this._setUniform("showDot",!!this._showDot,this.gl.uniform1f),this._setUniform("time",Date.now()-Li.spinSync,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),(this._sc!==this._bc||this._stroke!==i*.5)&&this.redraw()}}Li.spinSync=Date.now();Li.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    \n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n    uniform float direction;\n    uniform float radius;\n    uniform float time;\n    uniform float stroke;\n    uniform float showDot;\n    uniform float period;\n    uniform float alpha;\n    \n    float circleDist(vec2 p, float radius){\n        return length(p) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 center = vTextureCoord.xy * resolution - halfRes;\n        \n        float c = max(-circleDist(center, radius - stroke), circleDist(center, radius));\n        float rot = -(time / 1000.0 / period) * 6.0 * direction;\n        center *= mat2(cos(rot), sin(rot), -sin(rot), cos(rot));\n        \n        float a = direction * atan(center.x, center.y) * PI * 0.05 + 0.45;\n        \n        float strokeRad = stroke * 0.5;\n        a = mix(a, max(a, fillMask(circleDist(vec2(center.x, center.y + (radius - strokeRad)), strokeRad))), showDot);\n        vec4 base = mix(vec4(0.0), backgroundColor * alpha, fillMask(c));\n        gl_FragColor = mix(base, color * alpha, fillMask(c) * a);\n    }\n";const pa={Application:ye,Component:at,Base:xt,Utils:b,StageUtils:M,Element:K,Tools:Si,Stage:Oe,ElementCore:Se,ElementTexturizer:Go,Texture:Bt,EventEmitter:J,shaders:{Grayscale:Xr,BoxBlur:Yt,Dithering:Gr,CircularPush:jr,Inversion:fa,LinearBlur:Ms,Outline:Vr,Pixelate:Kr,RadialFilter:qr,RoundedRectangle:Zr,Spinner2:Li,FadeOut:ga,Hole:en,Vignette:Jr,Spinner:tn,RadialGradient:_a,Light3d:sn,Perspective:rn,Magnifier:nn,WebGLShader:Fs,WebGLDefaultShader:G,C2dShader:Wr,C2dDefaultShader:Bs,c2d:{Grayscale:da,Blur:la}},textures:{RectangleTexture:ra,NoiseTexture:ha,TextTexture:Fe,ImageTexture:xr,HtmlTexture:$r,StaticTexture:td,StaticCanvasTexture:na,SourceTexture:Vo},components:{FastBlurComponent:sd,BloomComponent:nd,SmoothScaleComponent:_s,BorderComponent:od,ListComponent:ed},tools:{ObjMerger:Yr,ObjectListProxy:oa,ObjectListWrapper:aa}};b.isWeb&&(window.lng=pa);const De=pa,Qn={},kt={},ad=(n,t)=>{kt[n]&&kt[n].forEach(e=>e(t))},hd=(n={},t)=>{if(n===null)return;const e=t.split(".");for(let i=0;i<e.length;i++)n=n[e[i]]=n[e[i]]!==void 0?n[e[i]]:{};return typeof n=="object"&&n!==null?Object.keys(n).length?n:void 0:n},ze={get(n,t,e=void 0){const i=hd(Qn[n],t);return i!==void 0?i:e},has(n,t){return!!this.get(n,t)},set(n,t){Qn.user[n]=t,ad(n,t)},subscribe(n,t){kt[n]=kt[n]||[],kt[n].push(t)},unsubscribe(n,t){if(t){const e=kt[n]&&kt[n].findIndex(i=>i===t);e>-1&&kt[n].splice(e,1)}else n in kt&&(kt[n]=[])},clearSubscribers(){for(const n of Object.getOwnPropertyNames(kt))delete kt[n]}},ps=/\{\/(.*?)\/([igm]{0,3})\}/g,on=/^[!*$]$/,Yn=/\/:\w+?@@([0-9]+?)@@/,$n=/^\/:/,Os=(n,t="R")=>(ps.test(n)&&(n=n.replace(ps,t)),n),ld=n=>{const t=new Map;return[...Object.keys(n),...Object.getOwnPropertySymbols(n)].forEach(e=>{t.set(e,n[e])}),t},Hi=(n,t)=>{const e={Info:"green",Debug:"gray",Warn:"orange",Error:"red"};return t=Array.from(t),["%c"+(t.length>1&&typeof t[0]=="string"?t.shift():n),"background-color: "+e[n]+"; color: white; padding: 2px 4px; border-radius: 2px",t]},wt={info(){ze.get("platform","log")&&console.log.apply(console,Hi("Info",arguments))},debug(){ze.get("platform","log")&&console.debug.apply(console,Hi("Debug",arguments))},error(){ze.get("platform","log")&&console.error.apply(console,Hi("Error",arguments))},warn(){ze.get("platform","log")&&console.warn.apply(console,Hi("Warn",arguments))}};class cd{constructor(t="",e,i){this._hash=t,this._storeCaller=i,this._register=new Map,this._isCreated=!1,this._isSharedInstance=!1,this._cancelled=!1,this._copiedHistoryState=null,Gt(e)?this._register=ld(e):ie(e)&&(this._storeCaller=e),this._register.set(ct.store,this._storeCaller)}cancel(){wt.debug("[router]:","cancelled ".concat(this._hash)),this._cancelled=!0}get url(){return this._hash}get register(){return this._register}get hash(){return this._hash}set hash(t){this._hash=t}get route(){return this._route}set route(t){this._route=t}get provider(){return this._provider}set provider(t){this._provider=t}get providerType(){return this._providerType}set providerType(t){this._providerType=t}set page(t){this._page=t}get page(){return this._page}set isCreated(t){this._isCreated=t}get isCreated(){return this._isCreated}get isSharedInstance(){return this._isSharedInstance}set isSharedInstance(t){this._isSharedInstance=t}get isCancelled(){return this._cancelled}set copiedHistoryState(t){this._copiedHistoryState=t}get copiedHistoryState(){return this._copiedHistoryState}}class ud{constructor(t={}){let e=["on","before","after"].reduce((i,s)=>mt(t[s])?s:i,void 0);this._cfg=t,e&&(this._provider={type:e,request:t[e]})}get path(){return this._cfg.path}get name(){return this._cfg.name}get component(){return this._cfg.component}get options(){return this._cfg.options}get widgets(){return this._cfg.widgets}get cache(){return this._cfg.cache}get hook(){return this._cfg.hook}get beforeNavigate(){return this._cfg.beforeNavigate}get provider(){return this._provider}}const an=n=>Os(n).split("/").length,dd=n=>{const t=[];for(let[e]of de.entries())an(e)===n&&t.push(e);return t},Ds=n=>{n=n.replace(/^#/,"");const t=/(\/?:?[^/]+)/g,e=dd(an(n)),i=n.match(t)||[];let s=[],r=e.filter(o=>{let a=!0;if(ps.test(o)){const l=o.match(ps);l&&l.length&&(o=l.reduce((c,u)=>{const d=s.length;return c=c.replace(u,"@@".concat(d,"@@")),s.push(u.substring(1,u.length-1)),c},o))}const h=o.match(t)||[];for(let l=0,c=h.length;l<c;l++){const u=h[l],d=i[l];if(Yn.test(u)){const _=Yn.exec(u)[1],f=s[_],y=/\/([^\/]+)\/([igm]{0,3})/.exec(f);if(y&&y.length){const T=y[1],x=y[2];new RegExp("^/".concat(T,"$"),x).test(d)||(a=!1)}}else{if($n.test(u))continue;d&&u.toLowerCase()!==d.toLowerCase()&&(a=!1)}}return a});if(r.length){if(r.indexOf(n)!==-1){const o=r[r.indexOf(n)];return de.get(o)}else if(r=r.sort(o=>$n.test(o)?-1:1),we(r[0]))return de.get(r[0])}return!1},xa=(n="",t)=>{t=Os(t,"");const e=/(\/?:?[\w%\s:.-]+)/g,i=n.match(e)||[],s=t.match(e)||[],r=/^\/:([\w-]+)\/?/;return s.reduce((o,a,h)=>{const l=r.exec(a);return l&&l.length&&o.set(l[1],decodeURIComponent(i[h].replace(/^\//,""))),o},new Map)},ks=(n,t)=>{if(n&&n.hasOwnProperty(t))return n[t]},fd=n=>{if(n.path==="$"){let t={preventStorage:!0};Gt(n.options)&&(t={...n.options,...t}),n.options=t,wi&&(n.after=wi)}return new ud(n)},gd=(n,t,e)=>new cd(n,t,e),_d=n=>{if(!n.to&&!n.name)return!1;const t=pd(n.to||n.name),e=/\/:([\w-]+)\/?/;let i=t;return e.test(t)&&(n.params&&(i=Object.keys(n.params).reduce((r,o)=>r.replace(":".concat(o),n.params[o]),t)),n.query)?"".concat(i).concat(_f(n.query)):i},pd=n=>{for(let[t,e]of de.entries())if(e.name===n)return t;return!1},xd=(n,t)=>{if($e(n)){const s=df();if(s.has(n))n=s.get(n);else return!1}const e=t.register,i=n.options;return e.has("keepAlive")?e.get("keepAlive"):i&&i.keepAlive?i.keepAlive:!1},ri=(n,t=[],e={})=>{un(t)||(t=[t]),t.forEach(i=>{const s="_on".concat(Ma(i));mt(n[s])&&n[s](e)})};let He=null;const md=()=>{if(We)return We.get().reduce((n,t)=>{const e=t.ref.toLowerCase();return n[e]=t,n},{})},yd=(n,t)=>{const e=(n||[]).map(i=>i.toLowerCase());We.forEach(i=>{i.visible=e.indexOf(i.ref.toLowerCase())!==-1,i.visible&&ri(i,["activated"],t)}),q.state==="Widgets"&&He&&!He.visible&&q._setState("")},vd=n=>(n=Ma(n),We.getByRef(n)||!1),Ad=n=>{const t=vd(n);t&&(Sd(t),q.state==="Widgets"?q.reload(He):q._setState("Widgets",[He]))},Xn=()=>{He=null,q._setState("")},ma=()=>He,Sd=n=>{He=n},ya=(n,t)=>n.c({type:t,visible:!1,widgets:md()});let Et=[];const va=n=>{const t=ni();if(!t)return;const i=n.register.get(ct.store),s=Ds(t),r=ks(s.options,"preventStorage");if(ie(i)?i:!r){const a=t.replace(/^\//,""),h=xs(a),l=wd(Ce(),n),c=za();if(h===-1||c.get("storeSameHash"))Et.push({hash:a,state:l});else{const u=Et.splice(h,1)[0];Et.push({hash:u.hash,state:l})}}},xs=n=>{for(let t=0;t<Et.length;t++)if(Et[t].hash===n)return t;return-1},Td=n=>{let t=null;return Et.length&&(n?xs(n)!==-1&&(t=Et[xs(n)].state):t=Et[Et.length-1].state),t},Cd=(n=null,t)=>{if(!Et.length)return;const e=t?xs(t):Et.length-1;e!==-1&&Gt(n)&&(Et[e].state=n)},wd=(n,t)=>{if(t.isSharedInstance){if(t.copiedHistoryState)return t.copiedHistoryState}else if(n&&mt(n.historyState))return n.historyState();return null},Aa=()=>Et.slice(0),Us=(n=[])=>{un(n)&&(Et=n)};class yt extends De.shaders.WebGLDefaultShader{set brightness(t){this._brightness=(t-50)/100,this.redraw()}set contrast(t){this._contrast=(t+50)/100,this.redraw()}set gamma(t){this._gamma=(t+50)/100,this.redraw()}setupUniforms(t){super.setupUniforms(t);const e=this.gl;this._setUniform("colorAdjust",[this._brightness||0,this._contrast||1,this._gamma||1],e.uniform3fv)}}yt.before="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n        \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec3 colorAdjust;\n    \n    const mat3 RGBtoOpponentMat = mat3(0.2814, -0.0971, -0.0930, 0.6938, 0.1458,-0.2529, 0.0638, -0.0250, 0.4665);\n    const mat3 OpponentToRGBMat = mat3(1.1677, 0.9014, 0.7214, -6.4315, 2.5970, 0.1257, -0.5044, 0.0159, 2.0517);    \n";yt.after="    \n    vec3 brightnessContrast(vec3 value, float brightness, float contrast)\n    {\n        return (value - 0.5) * contrast + 0.5 + brightness;\n    }   \n    \n    vec3 updateGamma(vec3 value, float param)\n    {\n        return vec3(pow(abs(value.r), param),pow(abs(value.g), param),pow(abs(value.b), param));\n    } \n       \n    void main(void){\n        vec4 fragColor = texture2D(uSampler, vTextureCoord);        \n        vec4 color = filter(fragColor) * vColor;       \n        \n        vec3 bc = brightnessContrast(color.rgb,colorAdjust[0],colorAdjust[1]);        \n        vec3 ga = updateGamma(bc.rgb, colorAdjust[2]);  \n              \n        gl_FragColor = vec4(ga.rgb, color.a);          \n    }    \n";class bd extends yt{}bd.fragmentShaderSource="\n    ".concat(yt.before,"    \n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.20,  0.99, -0.19, 0.0);\n        vec4 g = vec4( 0.16,  0.79,  0.04, 0.0);\n        vec4 b = vec4( 0.01, -0.01,  1.00, 0.0);\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	\n    }\n    \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= opponentColor.y * 1.5; \n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));      \n    }    \n    ").concat(yt.after," \n");class Ed extends yt{}Ed.fragmentShaderSource="\n    ".concat(yt.before,"\n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.43,  0.72, -0.15, 0.0 );\n        vec4 g = vec4( 0.34,  0.57,  0.09, 0.0 );\n        vec4 b = vec4(-0.02,  0.03,  1.00, 0.0 );\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	\n    }\n       \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= opponentColor.y * 1.5; \n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));    \n    }\n    ").concat(yt.after,"    \n");class Rd extends yt{}Rd.fragmentShaderSource="\n    ".concat(yt.before,"    \n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.97,  0.11, -0.08, 0.0 );\n        vec4 g = vec4( 0.02,  0.82,  0.16, 0.0 );\n        vec4 b = vec4(-0.06,  0.88,  0.18, 0.0 );\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	\n    }   \n    \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= ((3.0 * opponentColor.z) - opponentColor.y) * 0.25;\n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));\n    }   \n    ").concat(yt.after," \n");class Id extends yt{}Id.fragmentShaderSource="\n    ".concat(yt.before,"\n    vec4 filter( vec4 color )\n    {\n        return color;\n    }\n    ").concat(yt.after,"\n");class Ld extends yt{}Ld.fragmentShaderSource="\n    ".concat(yt.before,"\n    vec4 filter( vec4 color )\n    {   \n        float grey = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n        return vec4(vec3(grey, grey, grey), 1.0 ); \n    }\n    ").concat(yt.after,"\n");function Pd(n=[]){const t=[];for(var e=0;e<n.length&&(typeof n[e]=="string"&&!n[e].includes("PAUSE-"));e++)t.push(n[e]);return[t.join(",\b ")].concat(n.slice(e))}function Gn(n){return new Promise(t=>{setTimeout(t,n)})}function Fd(n,t,e="en-US"){const i=window.speechSynthesis;return new Promise((s,r)=>{const o=new SpeechSynthesisUtterance(n);o.lang=e,o.onend=()=>{s()},o.onerror=a=>{r(a)},t.push(o),i.speak(o)})}function vr(n,t,e=!0){const i=window.speechSynthesis,s=Pd(Array.isArray(n)?n:[n]),r=[],o=[];let a=!0;return{series:(async()=>{try{for(;a&&s.length;){const l=await Promise.resolve(s.shift());if(a){if(typeof l=="string"&&l.includes("PAUSE-")){let c=l.split("PAUSE-")[1]*1e3;isNaN(c)&&(c=0),await Gn(c)}else if(typeof l=="string"&&l.length){let u=3;for(;a&&u>0;)try{await Fd(l,o,t),u=0}catch(d){if(d instanceof SpeechSynthesisErrorEvent)if(d.error==="network")u--,console.warn("Speech synthesis network error. Retries left: ".concat(u)),await Gn(500*(3-u));else if(d.error==="canceled"||d.error==="interrupted")u=0;else throw new Error("SpeechSynthesisErrorEvent: ".concat(d.error));else throw d}}else if(typeof l=="function"){const c=vr(l(),t,!1);r.push(c),await c.series}else if(Array.isArray(l)){const c=vr(l,t,!1);r.push(c),await c.series}}else break}}finally{a=!1}})(),get active(){return a},append:l=>{s.push(l)},cancel:()=>{a&&(e&&i.cancel(),r.forEach(l=>{l.cancel()}),a=!1)}}}let Wi;function Bd(n,t){return Wi&&Wi.cancel(),Wi=vr(n,t),Wi}function Qi(n){return n.ref||n.constructor.name}function jn(n,t,e){var i,s,r,o,a;t==null&&(t=100);function h(){var c=Date.now()-o;c<t&&c>=0?i=setTimeout(h,t-c):(i=null,e||(a=n.apply(r,s),r=s=null))}var l=function(){r=this,s=arguments,o=Date.now();var c=e&&!i;return i||(i=setTimeout(h,t)),c&&(a=n.apply(r,s),r=s=null),a};return l.clear=function(){i&&(clearTimeout(i),i=null)},l.flush=function(){i&&(a=n.apply(r,s),r=s=null,clearTimeout(i),i=null)},l}let Ar,Ti=[],pe,Sr=!1;const zd=3e5;function Md(n=[]){if(!Zt.enabled)return;const t=n.every(r=>!r.loading),e=n.filter(r=>!Ti.includes(r));if(Ar(),!t){Zt.onFocusChange();return}Ti=n.slice(0);let i=[],s=e.reduce((r,o)=>(o.announce?(r.push([Qi(o),"Announce",o.announce]),i.push(o.announce)):o.title&&(r.push([Qi(o),"Title",o.title]),i.push(o.title)),r),[]);if(e.reverse().reduce((r,o)=>(o.announceContext?(r.push([Qi(o),"Context",o.announceContext]),i.push(o.announceContext)):r.push([Qi(o),"No Context",""]),r),s),Zt.debug&&console.table(s),i.length)return Zt.speak(i.reduce((r,o)=>r.concat(o),[]))}function Od(n){if(!Sr)return pe=Bd(n)}const Zt={enabled:!0,debug:!1,cancel:function(){pe&&pe.cancel()},clearPrevFocus:function(n=0){Ti=Ti.slice(0,n),Ar()},speak:function(n,{append:t=!1,notification:e=!1}={}){return Zt.enabled&&(Zt.onFocusChange.flush(),t&&pe&&pe.active?pe.append(n):(Zt.cancel(),Od(n)),e&&(Sr=!0,pe.series.finally(()=>{Sr=!1,Zt.refresh()}))),pe},setupTimers:function({focusDebounce:n=400,focusChangeTimeout:t=zd}={}){Zt.onFocusChange=jn(Md,n),Ar=jn(()=>{Ti=[]},t)}};Zt.setupTimers();let Ns,pi,Yi,Js,Vn,ms=(n,t,e)=>{Ns.info("Sending metric",n,t,e)};const Dd={app:["launch","loaded","ready","close"],page:["view","leave"],user:["click","input"],media:["abort","canplay","ended","pause","play","volumechange","waiting","seeking","seeked"]},Sa=(n,t,e,i,s={})=>{s={params:s,message:t,code:e,visible:i},ms(n,"error",s)},Kn=(n,t,e={})=>t.reduce((i,s)=>(i[s]=(r,o={})=>{o={...e,...r?{name:r}:{},...o},ms(n,s,o)},i),{error(i,s,r){Sa(n,i,s,r)},event(i,s){ms(n,i,s)}}),kd=n=>Object.keys(n).reduce((t,e)=>(e==="media"?t[e]=i=>Kn(e,n[e],{url:i}):t[e]=Kn(e,n[e]),t),{error:Sa,event:ms}),Ud=kd(Dd);new Date(new Date-60*5*1e3).toUTCString(),60*30,new Date(new Date-60*20*1e3).toUTCString(),60*45,new Date(new Date-60*10*1e3).toUTCString(),60*60;const Nd=(n,t=null,e=null)=>{let i;if(n&&typeof n=="function")try{i=n.apply(e,t)}catch(s){i=s}else i=n;return i!==null&&typeof i=="object"&&i.then&&typeof i.then=="function"?i:new Promise((s,r)=>{i instanceof Error?r(i):s(i)})},qn={abort:"Abort",canplay:"CanPlay",canplaythrough:"CanPlayThrough",durationchange:"DurationChange",emptied:"Emptied",encrypted:"Encrypted",ended:"Ended",error:"Error",interruptbegin:"InterruptBegin",interruptend:"InterruptEnd",loadeddata:"LoadedData",loadedmetadata:"LoadedMetadata",loadstart:"LoadStart",pause:"Pause",play:"Play",playing:"Playing",progress:"Progress",ratechange:"Ratechange",seeked:"Seeked",seeking:"Seeking",stalled:"Stalled",timeupdate:"TimeUpdate",volumechange:"VolumeChange",waiting:"Waiting"},Hd=(n,t=()=>{})=>{let e=!1;const i=()=>{e===!1&&(t(),e=!0)};return Object.keys(n).reduce((s,r)=>(typeof n[r]=="function"?s[r]=function(){return i(),n[r].apply(n,arguments)}:typeof Object.getOwnPropertyDescriptor(n,r).get=="function"?s.__defineGetter__(r,function(){return i(),Object.getOwnPropertyDescriptor(n,r).get.apply(n)}):typeof Object.getOwnPropertyDescriptor(n,r).set=="function"?s.__defineSetter__(r,function(){return i(),Object.getOwnPropertyDescriptor(n,r).set.sourceObject[r].apply(n,arguments)}):s[r]=n[r],s),{})};let Zn=null;const Wd=(n,t)=>{clearTimeout(Zn),Zn=setTimeout(()=>{n()},t)},Qd=()=>class extends Vn.Component{static _template(){return{Video:{alpha:1,visible:!1,pivot:.5,texture:{type:Vn.textures.StaticTexture,options:{}}}}}set videoEl(t){this._videoEl=t}get videoEl(){return this._videoEl}get videoView(){return this.tag("Video")}get videoTexture(){return this.videoView.texture}get isVisible(){return this.videoView.alpha===1&&this.videoView.visible===!0}_init(){this._createVideoTexture()}_createVideoTexture(){const e=this.stage.gl,i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.videoTexture.options={source:i,w:this.videoEl.width,h:this.videoEl.height},this.videoView.w=this.videoEl.width/this.stage.getRenderPrecision(),this.videoView.h=this.videoEl.height/this.stage.getRenderPrecision()}start(){const t=this.stage;this._lastTime=0,this._updateVideoTexture||(this._updateVideoTexture=()=>{if(this.videoTexture.options.source&&this.videoEl.videoWidth&&this.active){const e=t.gl,i=new Date().getTime(),s=this.videoEl.getVideoPlaybackQuality(),r=s?s.totalVideoFrames:this.videoEl.webkitDecodedFrameCount;if(r?this._lastFrame!==r:this._lastTime<i-30){this._lastTime=i,this._lastFrame=r;try{e.bindTexture(e.TEXTURE_2D,this.videoTexture.options.source),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.videoEl),this._lastFrame=this.videoEl.webkitDecodedFrameCount,this.videoView.visible=!0,this.videoTexture.options.w=this.videoEl.width,this.videoTexture.options.h=this.videoEl.height;const a=this.videoView.w/this.videoView.h,h=this.videoEl.width/this.videoEl.height;a>h?(this.videoView.scaleX=h/a,this.videoView.scaleY=1):(this.videoView.scaleY=a/h,this.videoView.scaleX=1)}catch(a){Ns.error("texImage2d video",a),this.stop()}this.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(t.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}stop(){const t=this.stage;if(t.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoView.visible=!1,this.videoTexture.options.source){const e=t.gl;e.bindTexture(e.TEXTURE_2D,this.videoTexture.options.source),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}}position(t,e){this.videoView.patch({x:e,y:t})}size(t,e){this.videoView.patch({w:t,h:e})}show(){this.videoView.alpha=1}hide(){this.videoView.alpha=0}};let Yd=n=>n,P,xe,xi,si,Tr=1,ne=!1,qi={};const st={adsEnabled:!1,playing:!1,_playingAds:!1,get playingAds(){return this._playingAds},set playingAds(n){this._playingAds!==n&&(this._playingAds=n,Be(n===!0?"AdStart":"AdEnd"))},skipTime:!1,playAfterSeek:null},tr={play(){st.playing=!0},pause(){st.playing=!1},seeked(){st.playAfterSeek===!0&&Ta.play(),st.playAfterSeek=null},abort(){Cr()}},qt=n=>Math.round(Tr*n)+"px",Be=(n,t)=>{si&&(si.fire("$videoPlayer"+n,t,P.currentTime),si.fire("$videoPlayerEvent",n,t,P.currentTime))},$d=(n,t)=>{tr[n]&&typeof tr[n]=="function"&&tr[n].call(null,n,t)};let Zi=null,Ji=null;const Xd=(n,t,e)=>Zi&&typeof Zi=="function"?Zi(n,t,e):new Promise(i=>{n=Yd(n),t.setAttribute("src",n),t.load(),i()}),Gd=n=>Ji&&typeof Ji=="function"?Ji(n):new Promise(t=>{n.removeAttribute("src"),n.load(),t()}),jd=()=>{const n=document.getElementsByTagName("video");if(n&&n.length)return n[0];{const t=document.createElement("video"),e=pi.get("platform","width")?pi.get("platform","width"):1920,i=pi.get("platform","height")?pi.get("platform","height"):1080;return t.setAttribute("id","video-player"),t.setAttribute("width",qt(e)),t.setAttribute("height",qt(i)),t.style.position="absolute",t.style.zIndex="1",t.style.display="none",t.style.visibility="hidden",t.style.top=qt(0),t.style.left=qt(0),t.style.width=qt(e),t.style.height=qt(i),document.body.appendChild(t),t}},Vd=()=>{if(!Yi.tag("VideoTexture")){const n=Yi.stage.c({type:Qd(),ref:"VideoTexture",zIndex:0,videoEl:P});Yi.childList.addAt(n,0)}return Yi.tag("VideoTexture")},Kd=()=>{Ns.info("VideoPlayer","Registering event listeners"),Object.keys(qn).forEach(n=>{const t=e=>{xi&&xi[n]&&typeof xi[n]=="function"&&xi[n]({currentTime:P.currentTime}),$d(n,{videoElement:P,event:e}),Be(qn[n],{videoElement:P,event:e})};qi[n]=t,P.addEventListener(n,t)})},Cr=()=>{Ns.info("VideoPlayer","Deregistering event listeners"),Object.keys(qi).forEach(n=>{P.removeEventListener(n,qi[n])}),qi={}},Ta={consumer(n){si=n},loader(n){Zi=n},unloader(n){Ji=n},position(n=0,t=0){P.style.left=qt(t),P.style.top=qt(n),ne===!0&&xe.position(n,t)},size(n=1920,t=1080){P.style.width=qt(n),P.style.height=qt(t),P.width=parseFloat(P.style.width),P.height=parseFloat(P.style.height),ne===!0&&xe.size(n,t)},area(n=0,t=1920,e=1080,i=0){this.position(n,i),this.size(t-i,e-n)},open(n,t={}){if(this.canInteract)if(xi=Ud.media(n),this.hide(),Cr(),this.src==n)this.clear().then(this.open(n,t));else{const e={enabled:st.adsEnabled,duration:300};t.videoId&&(e.caid=t.videoId),Js.get(e,si).then(i=>{st.playingAds=!0,i.prerolls().then(()=>{st.playingAds=!1,Xd(n,P,t).then(()=>{Kd(),this.show(),this.play()}).catch(s=>{Be("Error",{videoElement:P,event:s}),Be("error",{videoElement:P,event:s})})})})}},reload(){if(!this.canInteract)return;const n=P.getAttribute("src");this.close(),this.open(n)},close(){Js.cancel(),st.playingAds&&(st.playingAds=!1,Js.stop(),setTimeout(()=>{this.close()})),this.canInteract&&(this.clear(),this.hide(),Cr())},clear(){if(this.canInteract)return this.pause(),ne===!0&&xe.stop(),Gd(P).then(()=>{Be("Clear",{videoElement:P})})},play(){this.canInteract&&(ne===!0&&xe.start(),Nd(P.play,null,P).catch(n=>{Be("Error",{videoElement:P,event:n}),Be("error",{videoElement:P,event:n})}))},pause(){this.canInteract&&P.pause()},playPause(){this.canInteract&&(this.playing===!0?this.pause():this.play())},mute(n=!0){this.canInteract&&(P.muted=n)},loop(n=!0){P.loop=n},seek(n){this.canInteract&&this.src&&(st.playAfterSeek===null&&(st.playAfterSeek=!!st.playing),this.pause(),P.currentTime=Math.max(0,Math.min(n,this.duration-.1)))},skip(n){this.canInteract&&this.src&&(st.skipTime=(st.skipTime||P.currentTime)+n,Wd(()=>{this.seek(st.skipTime),st.skipTime=!1},300))},show(){this.canInteract&&(ne===!0?xe.show():(P.style.display="block",P.style.visibility="visible"))},hide(){this.canInteract&&(ne===!0?xe.hide():(P.style.display="none",P.style.visibility="hidden"))},enableAds(n=!0){st.adsEnabled=n},get duration(){return P&&(isNaN(P.duration)?1/0:P.duration)},get currentTime(){return P&&P.currentTime},get muted(){return P&&P.muted},get looped(){return P&&P.loop},get src(){return P&&P.getAttribute("src")},get playing(){return st.playing},get playingAds(){return st.playingAds},get canInteract(){return st.playingAds===!1},get top(){return P&&parseFloat(P.style.top)},get left(){return P&&parseFloat(P.style.left)},get bottom(){return P&&parseFloat(P.style.top-P.style.height)},get right(){return P&&parseFloat(P.style.left-P.style.width)},get width(){return P&&parseFloat(P.style.width)},get height(){return P&&parseFloat(P.style.height)},get visible(){return ne===!0?xe.isVisible:P&&P.style.display==="block"},get adsEnabled(){return st.adsEnabled},get _videoEl(){return P},get _consumer(){return si}};Hd(Ta,()=>{Tr=Tr,P=jd(),ne=pi.get("platform","textureMode",!1),ne===!0&&(P.setAttribute("crossorigin","anonymous"),xe=Vd())});class eg extends De.Component{static _template(){return{rect:!0,color:3137370284,h:40,w:100,x:t=>t-50,y:t=>t-50,mount:1,Text:{w:t=>t,h:t=>t,y:5,x:20,text:{fontSize:22,lineHeight:26}}}}_firstActive(){this.tag("Text").text="APP - v".concat(this.version,"\nSDK - v").concat(this.sdkVersion),this.tag("Text").loadTexture(),this.w=this.tag("Text").renderWidth+40,this.h=this.tag("Text").renderHeight+5}}class ig extends De.Component{static _template(){return{rect:!0,color:4294967295,texture:De.Tools.getRoundRect(80,80,40),h:80,w:80,x:100,y:100,mount:1,Background:{x:3,y:3,texture:De.Tools.getRoundRect(72,72,36),color:4278222848},Counter:{w:t=>t,h:t=>t,y:10,text:{fontSize:32,textAlign:"center"}},Text:{w:t=>t,h:t=>t,y:48,text:{fontSize:15,textAlign:"center",text:"FPS"}}}}_setup(){this.config={log:!1,interval:500,threshold:1,...ze.get("platform","showFps")},this.fps=0,this.lastFps=this.fps-this.config.threshold;const t=()=>{this.fps=~~(1/this.stage.dt)};this.stage.on("frameStart",t),this.stage.off("framestart",t),this.interval=setInterval(this.showFps.bind(this),this.config.interval)}_firstActive(){this.showFps()}_detach(){clearInterval(this.interval)}showFps(){if(Math.abs(this.lastFps-this.fps)<=this.config.threshold)return;this.lastFps=this.fps;let t=4278222848;this.fps<=40&&this.fps>20?t=4294944e3:this.fps<=20&&(t=4294901760),this.tag("Background").setSmooth("color",t),this.tag("Counter").text="".concat(this.fps),this.config.log&&wt.info("FPS",this.fps)}}const U={eventListeners:[],timeouts:[],intervals:[],targets:[]},qd={setTimeout(n,t,...e){const i=setTimeout(()=>{U.timeouts=U.timeouts.filter(s=>s!==i),n.apply(null,e)},t,e);return wt.info("Set Timeout","ID: "+i),U.timeouts.push(i),i},clearTimeout(n){U.timeouts.indexOf(n)>-1?(U.timeouts=U.timeouts.filter(t=>t!==n),wt.info("Clear Timeout","ID: "+n),clearTimeout(n)):wt.error("Clear Timeout","ID "+n+" not found")},clearTimeouts(){U.timeouts.forEach(n=>{this.clearTimeout(n)})},setInterval(n,t,...e){const i=setInterval(()=>{U.intervals.filter(s=>s!==i),n.apply(null,e)},t,e);return wt.info("Set Interval","ID: "+i),U.intervals.push(i),i},clearInterval(n){U.intervals.indexOf(n)>-1?(U.intervals=U.intervals.filter(t=>t!==n),wt.info("Clear Interval","ID: "+n),clearInterval(n)):wt.error("Clear Interval","ID "+n+" not found")},clearIntervals(){U.intervals.forEach(n=>{this.clearInterval(n)})},addEventListener(n,t,e){n.addEventListener(t,e);const i=U.targets.indexOf(n)>-1?U.targets.indexOf(n):U.targets.push(n)-1;U.eventListeners[i]=U.eventListeners[i]||{},U.eventListeners[i][t]=U.eventListeners[i][t]||[],U.eventListeners[i][t].push(e),wt.info("Add eventListener","Target:",n,"Event: "+t,"Handler:",e.toString())},removeEventListener(n,t,e){const i=U.targets.indexOf(n);i>-1&&U.eventListeners[i]&&U.eventListeners[i][t]&&U.eventListeners[i][t].indexOf(e)>-1?(U.eventListeners[i][t]=U.eventListeners[i][t].filter(s=>s!==e),wt.info("Remove eventListener","Target:",n,"Event: "+t,"Handler:",e.toString()),n.removeEventListener(t,e),Object.keys(U.eventListeners[i]).forEach(s=>{U.eventListeners[i][s].length===0&&delete U.eventListeners[i][s]}),Object.keys(U.eventListeners[i]).length===0&&(U.targets.splice(i,1),U.eventListeners.splice(i,1))):wt.error("Remove eventListener","Not found","Target",n,"Event: "+t,"Handler",e.toString())},removeEventListeners(n,t){if(n&&t){const e=U.targets.indexOf(n);e>-1&&U.eventListeners[e][t].forEach(i=>{this.removeEventListener(n,t,i)})}else if(n){const e=U.targets.indexOf(n);e>-1&&Object.keys(U.eventListeners[e]).forEach(i=>{this.removeEventListeners(n,i)})}else Object.keys(U.eventListeners).forEach(e=>{this.removeEventListeners(U.targets[e])})},clear(){this.clearTimeouts(),this.clearIntervals(),this.removeEventListeners(),U.eventListeners=[],U.timeouts=[],U.intervals=[],U.targets=[]}};let Zd,Jn,q,ue,Hs,Ht,We,Ca,wi,wr=!0,wa=async(n,t)=>!0,ba=()=>{},de=new Map,Jt=new Map,Ea=!1,hn=null,Ra,ys,Ia,La;const Jd=n=>{n.pages&&(ue=n.pages.childList),n.widgets&&n.widgets.children&&(We=n.widgets.childList,We.forEach(t=>t.visible=!1)),n._handleBack=t=>{ts(-1),t.preventDefault()}},tf=(n,t)=>{let{appInstance:e,routes:i}=n;t&&ln(t)&&(q=t),q||(q=e||Zd),Jn=q.application,ue=Jn.childList,Hs=q.stage,Ht=gf(),Jd(q),un(i)?ef(n):mt(i)&&(console.warn("[Router]: Calling Router.route() directly is deprecated."),console.warn("Use object config: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration"))},ef=n=>{Ea||sf(n),n.routes.forEach(t=>{const e=dn(t.path);if(we(e))console.error("".concat(e," already exists in routes configuration"));else{const i=fd(t);if(de.set(e,i),i.component){let s=i.component;cn(s)&&(Ht.get("lazyCreate")||(s=ya(Hs,s),ue.a(s))),Jt.set(e,s)}}})},sf=n=>{Ca=n.root,mt(n.boot)&&(wi=n.boot),ie(n.updateHash)&&(wr=n.updateHash),mt(n.beforeEachRoute)&&(wa=n.beforeEachRoute),mt(n.afterEachRoute)&&(ba=n.afterEachRoute),n.bootComponent&&(console.warn("[Router]: Boot Component is now available as a special router: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration?id=special-routes"),console.warn("[Router]: setting { bootComponent } property will be deprecated in a future release"),ln(n.bootComponent)?n.routes.push({path:"$",component:n.bootComponent,after:wi||null,options:{preventStorage:!0}}):console.error("[Router]: ".concat(n.bootComponent," is not a valid boot component"))),n.routes.forEach(t=>{const e=Os(t.path);if(/.*\/:.*?\?$/u.test(e)){const s=t.path.substring(0,t.path.lastIndexOf("/")),r=t.path.substring(0,t.path.lastIndexOf("?"));t.path=r;let o={...t};o.path=s,n.routes.push(o)}}),Ea=!0},Ws=(n,t)=>{Jt.has(n)&&Jt.set(n,t)},Pa=n=>Jt.has(n)?Jt.get(n):null,rf=n=>{Jt.has(n)&&ue.getIndex(Jt.get(n))!==-1&&(ue.remove(Jt.get(n)),Ws(n,Jt.get(n)._routedType||Jt.get(n).constructor))},br=()=>{if(!Ht||!Ht.size)return!1;const n=Ht.get("updateHash");return!(ie(n)&&!n||ie(wr)&&!wr)},nf=n=>{const t=n.hash,e=n.route,i=n.register,s=n.page;ks(e.options,"clearHistory")?Us([]):t&&!on.test(e.path)&&va(n),Ws(e.path,s),n.isSharedInstance||!n.isCreated?ri(s,"changed"):n.isCreated&&ri(s,"mounted"),We&&yd(e.widgets,s),Ce()&&!n.isSharedInstance&&of(hn,n),i.get(ct.historyState)&&mt(s.historyState)&&s.historyState(i.get(ct.historyState)),af(s),Ra=n.hash,ys=e.path;for(let r of Ft.values())r.isCancelled&&r.hash&&Ft.delete(r.hash);ba(n),wt.info("[route]:",e.path),wt.info("[hash]:",t)},of=(n,t)=>{const e=ys,i=t.register,s=Ht.get("lazyDestroy"),r=Ht.get("destroyOnHistoryBack"),o=i.get("keepAlive"),a=i.get(ct.backtrack);let h=!1;a&&(r||s)&&(h=!0),s&&!o&&(h=!0),ys===t.route.path&&(h=!0),h?(Ws(e,n._routedType||n.constructor),ue.remove(n),Ht.get("gcOnUnload")&&Hs.gc()):n.patch({x:0,y:0,scale:1,visible:!1,alpha:1})},ni=()=>Ra,af=n=>{hn=n},Ce=()=>hn,Er=()=>ys,Fa=()=>Ia,hf=n=>{Ia=n},lf=n=>{La=n},cf=()=>La,we=n=>de.has(n),Ba=()=>Ca,uf=()=>wi,za=()=>Ht,df=()=>de,mt=n=>typeof n=="function",Gt=n=>typeof n=="object"&&n!==null,ie=n=>typeof n=="boolean",ln=n=>!!(n instanceof De.Element||cn(n)),cn=n=>n.prototype&&"isComponent"in n.prototype,un=n=>Array.isArray(n),Ma=n=>"".concat(n.charAt(0).toUpperCase()).concat(n.slice(1)),$e=n=>typeof n=="string",ff=n=>{let t;if(mt(n))try{t=n.apply(null)}catch(e){t=e}else t=n;return Gt(t)&&mt(t.then)},dn=(n="")=>n.replace(/^#/,"").replace(/\/+$/,""),gf=()=>{const n=ze.get("platform","router"),t=Gt(n);return["backtrack","gcOnUnload","destroyOnHistoryBack","lazyCreate","lazyDestroy","reuseInstance","autoRestoreRemote","numberNavigation","updateHash","storeSameHash"].reduce((e,i)=>(e.set(i,t?n[i]:ze.get("platform",i)),e),new Map)},fn=(n=ni())=>{const t=Of();(n==="$"||!n)&&t&&$e(t)&&(n=t);let e="";const s=/([?&].*)/.exec(n),r={};if(document.location&&document.location.search&&(e=document.location.search),s&&s.length){let o=s[1];e?(o=o.replace(/^\?/,""),e="".concat(e,"&").concat(o)):e=o}if(e){const o=new URLSearchParams(e);for(const[a,h]of o.entries())r[a]=h;return r}else return!1},_f=n=>Gt(n)?"?"+Object.keys(n).map(t=>"".concat(t,"=").concat(n[t])).join("&"):"",ct={route:Symbol("route"),hash:Symbol("hash"),store:Symbol("store"),fromHistory:Symbol("fromHistory"),expires:Symbol("expires"),resume:Symbol("resume"),backtrack:Symbol("backtrack"),historyState:Symbol("historyState"),queryParams:Symbol("queryParams")},pf={on:n=>(lf(q.state||""),q._setState("Loading"),er(n)),before:n=>er(n),after:n=>{try{er(n,!0)}catch(t){}return Promise.resolve()}},er=(n,t)=>{const e=n.route,i=e.provider,s=e.cache?e.cache*1e3:0,r=Oa(n);return i.request(n.page,{...r}).then(()=>{n.page[ct.expires]=Date.now()+s,t&&ri(n.page,"dataProvided")}).catch(o=>{throw n.page[ct.expires]=Date.now(),o})},Oa=({page:n,route:t,hash:e,register:i=new Map})=>{const s=xa(e,t.path),r=fn(e),o=new Map([...s,...i]),a={};for(let[h,l]of o)a[h]=l;if(r&&(a[ct.queryParams]=r),i.size){const h={};for(let[l,c]of i)h[l]=c;n.persist=h}return n.params=a,ri(n,["urlParams"],a),a},xf=n=>{if(!n[ct.expires])return!1;const t=n[ct.expires];return Date.now()>=t},to=n=>we(n)?!!de.get(n).provider:!1,mf=n=>{if(we(n.path)){const{provider:t}=de.get(n.path);return{type:t.type,provider:t.request}}},yf=(n,t)=>new Promise(e=>{n.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),n.transition("alpha").on("finish",()=>{t&&(t.visible=!1),e()})}),vf=(n,t)=>new Promise(e=>{n.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),t&&t.patch({smooth:{alpha:[0,{duration:.5,delay:.3}]}}),n.transition("alpha").on("finish",()=>{e()})}),Qs=(n,t,e,i)=>{const s=n==="x"?1920:1080;return new Promise(r=>{e.patch({["".concat(n)]:t?s*-1:s,visible:!0,smooth:{["".concat(n)]:[0,{duration:.4,delay:.2}]}}),i&&i.patch({["".concat(n)]:0,smooth:{["".concat(n)]:[t?s:s*-1,{duration:.4,delay:.2}]}}),e.transition(n).on("finish",()=>{r()})})},Af=(n,t)=>Qs("y",0,n,t),Sf=(n,t)=>Qs("y",1,n,t),Tf=(n,t)=>Qs("x",0,n,t),Cf=(n,t)=>Qs("x",1,n,t),eo={fade:yf,crossFade:vf,up:Af,down:Sf,left:Tf,right:Cf},wf=(n,t=null)=>{const e=n.pageTransition||n.easing,i=!!(n.smoothIn||n.smoothInOut||e),s=za().get("disableTransitions");if(n.easing&&console.warn("easing() method is deprecated and will be removed. Use pageTransition()"),!i||s)return n.visible=!0,t&&(t.visible=!1),Promise.resolve();if(e){let r;try{r=e.call(n,n,t)}catch(o){r="crossFade"}if(ff(r))return r;if($e(r)){const o=eo[r];if(o)return o(n,t)}if(n.smoothIn){const o=(a,h,l={})=>new Promise(c=>{n.visible=!0,n.setSmooth(a,h,l),n.transition(a).on("finish",()=>{c()})});return n.smoothIn({pageIn:n,smooth:o})}}return eo.crossFade(n,t)},io=async n=>{let t=!1;try{if(n=await bf(n),n&&!n.isCancelled?(q.state==="Loading"&&(cf()==="Widgets"?q._setState("Widgets",[ma()]):q._setState("")),!n.isSharedInstance&&!n.isCancelled&&await wf(n.page,Ce())):t=!0,t||n.isCancelled)wt.debug("[router]:","Rejected ".concat(n.hash," because route to ").concat(Fa()," started")),n.isCreated&&!n.isSharedInstance&&ue.remove(n.page);else return nf(n),n.page}catch(e){if(!e.route)console.error(e);else if(!t){const{route:i}=e;ks(i.options,"clearHistory")?Us([]):on.test(i.path)||va(e),e.isCreated&&!e.isSharedInstance&&ue.remove(e.page),Ef(e)}}},bf=async n=>{const t=n.route,e=n.hash,i=n.register;let s=Pa(t.path),r=cn(s),o=!1;if(!r&&!i.get(ct.backtrack)&&(Rf(t)||(s=s.constructor,r=!0)),r)n.page=ya(Hs,s),ue.a(n.page),to(t.path)&&(o=!0),n.isCreated=!0;else{n.page=s,to(t.path)&&(xf(s)||s[ct.hash]!==e)&&(o=!0);let a=Ce()&&Ce()[ct.route];t.path===a&&(n.isSharedInstance=!0,mt(n.page.historyState)&&(n.copiedHistoryState=n.page.historyState()))}n.page[ct.hash]=e,n.page[ct.route]=t.path;try{if(o){const{type:a,provider:h}=mf(t);return n.provider=h,n.providerType=a,await pf[a](n),e!==Fa()?!1:(n.providerType!=="after"&&ri(n.page,"dataProvided"),n)}else return Oa(n),n}catch(a){return n.error=a,Promise.reject(n)}},Ef=n=>{n&&n.error?console.error(n.error):n&&wt.error(n),n.page&&we("!")&&ht("!",{request:n},!1)},Rf=n=>{const t=ks(n.options,"reuseInstance"),e=Ht.get("reuseInstance");return ie(t)?t:!(ie(e)&&e===!1)};class If extends De.Component{static _template(){return{Pages:{forceZIndexContext:!0},Loading:{rect:!0,w:1920,h:1080,color:4278190080,visible:!1,zIndex:99,Label:{mount:.5,x:960,y:540,text:{text:"Loading.."}}}}}static _states(){return[class extends this{$enter(){this.tag("Loading").visible=!0}$exit(){this.tag("Loading").visible=!1}},class extends this{$enter(e,i){this._widget=i,this._refocus()}_getFocused(){return this._widget}reload(e){this._widget=e,this._refocus()}_handleKey(){const e=Ht.get("autoRestoreRemote");(!ie(e)||e===!0)&&so.focusPage()}}]}get pages(){return this.tag("Pages")}get widgets(){return this.tag("Widgets")}_handleBack(){}_getFocused(){return so.getActivePage()}}let Ft=new Map,ir="",he="";const Lf=(n,t)=>{tf(n,t),kf(),Pf()},Pf=()=>{let n=(Ys()||"").replace(/^#/,"");const t="$",e=fn(n),i=uf(),s=Ba(),r=n.indexOf(t)!==-1;on.test(n)&&n!==t&&(n=""),he=r?s:n||s;const o=()=>{!n&&s?$e(s)?ht(s):mt(s)&&s().then(a=>{Gt(a)?ht(a.path,a.params):ht(a)}):(vs(n),As().then(()=>{q._refocus()}).catch(a=>{console.error(a)}))};if(we(t)){if(n&&!r&&!Ds(n)){ht("*",{failedHash:n});return}ht(t,{resume:he,reload:t===n},!1)}else mt(i)?i(e).then(()=>{o()}).catch(a=>{Ff(a)}):o()},Ff=n=>{we("!")?ht("!",{request:{error:n}}):console.error(n)},ht=(n,t={},e)=>{if(Gt(n)&&(n=_d(n),!n))return;let i=Ys();!br()&&ir&&(i=ir),i.replace(/^#/,"")!==n?(vs(n,t,e),br()?Df(n):(ir=n,As(n).then(()=>{q._refocus()}).catch(s=>{console.error(s)}))):t.reload&&(vs(n,t,e),As(n).then(()=>{q._refocus()}).catch(s=>{console.error(s)}))},vs=(n,t={},e)=>{if(n=dn(n),!Ft.has(n)){for(let s of Ft.values())s.cancel();const i=gd(n,t,e);return Ft.set(decodeURIComponent(n),i),i}return!1},As=async n=>{const t=dn(n||Ys()),e=decodeURIComponent(t);let i=Ft.get(e);!i&&!Ft.size&&(i=vs(t));const s=Ds(t);if(!s){we("*")?ht("*",{failedHash:t}):console.error("Unable to navigate to: ".concat(t));return}i.hash=t,i.route=s;let r=await wa(ni(),i);if(r&&s.beforeNavigate&&(r=await s.beforeNavigate(ni(),i)),ie(r)){if(r)return Bf(i)}else if(i.cancel(),Ft.delete(e),$e(r))ht(r);else if(Gt(r)){let o=!0;ie(r.store)&&(o=r.store),ht(r.path,r.params,o)}},Bf=n=>{const t=n.hash,e=n.route,i=decodeURIComponent(t);if(hf(t),e.path){const s=Pa(e.path);if(mt(e.hook)){const r=xa(t,e.path),o={};for(const a of r.keys())o[a]=r.get(a);e.hook(q,{...o})}if(s){const r=Ce();if(r){const o=xd(Er(),n);r&&e.path===Er()&&!o&&r._setState("")}ln(s)?io(n).then(()=>{q._refocus(),Ft.delete(i)}):s().then(o=>o.default).then(o=>(Ws(e.path,o),io(n))).then(()=>{q._refocus(),Ft.delete(i)})}else Ft.delete(i)}},ts=(n=0)=>{if(!n||isNaN(n))return!1;const t=Aa();if(n=Math.abs(n),t.length){const e=t.splice(t.length-n,n)[0];return Us(t),ht(e.hash,{[ct.backtrack]:!0,[ct.historyState]:e.state},!1)}else if(Ht.get("backtrack")){const e=/(\/:?[\w%\s-]+)$/;let i=Os(Ys()),s=an(i);if(s>1){for(;s--;)if(i=i.replace(e,""),Ds(i))return ht(i,{[ct.backtrack]:!0},!1)}}return n>t.length?mt(q._handleAppClose)?q._handleAppClose():q.application.closeApp():!1},zf=()=>{$e(he)?(ht(he,!1),he=""):mt(he)?he().then(n=>{he="",Gt(n)?ht(n.path,n.params):ht(n)}):console.warn("[Router]: resume() called but no hash found")},Mf=()=>{if(!Da()){const n=ni();ht(n,{reload:!0},!1)}},Da=()=>{if(Ft.size){let n=!1;for(let t of Ft.values())t.isCancelled||(n=!0);return n}return!1},Of=()=>he;let Ys=()=>document.location.hash,Df=n=>{document.location.hash=n};const kf=()=>{qd.addEventListener(window,"hashchange",async()=>{if(br())try{await As()}catch(n){console.error(n)}})},Uf=()=>{const n=Ba();$e(n)?ht(n):mt(n)&&n().then(t=>{Gt(t)?ht(t.path,t.params):ht(t)})},Nf=n=>{rf(n)},so={startRouter:Lf,navigate:ht,resume:zf,step:ts,go:ts,back:ts.bind(null,-1),activePage:Ce,getActivePage(){return Ce()},deletePage:Nf,getActiveRoute:Er,getActiveHash:ni,focusWidget:Ad,getActiveWidget:ma,restoreFocus:Xn,isNavigating:Da,getHistory:Aa,setHistory:Us,getHistoryState:Td,replaceHistoryState:Cd,getQueryStringParams:fn,reload:Mf,symbols:ct,App:If,focusPage:Xn,root:Uf,setupRoutes(){console.warn("Router: setupRoutes is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},on(){console.warn("Router.on() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},before(){console.warn("Router.before() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},after(){console.warn("Router.after() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")}};function Hf(n){console.log(n.type);const t=oi(()=>0),[e,i]=Y(n.x);function s(r){console.log("row",r),r.selected===0?i(90):i(r.selected*-r.children[0]._width+10)}return C(D,{clipping:!0,get style(){return Un.itemsContainer},get children(){return C(kr,{animate:!0,gap:10,get x(){return e()},get y(){return n.y},width:4400,get style(){return Un.Row},justifyContent:"flexStart",get autofocus(){return t(0)},onSelectedChanged:s,get items(){return n.data},get onFocus(){return n.onFocus},get onEnter(){return n.onEnter}})}})}const Wf=()=>{const n=Or();Y(0);const[t,e]=Y();Rr(t,$o);const[i,s]=Y({}),r=Ls();oi(()=>0);const o=lt(()=>Ur(Qo(n.filter||"all",8)));Rt(Xt(ce,h=>{h.backdrop&&Do(h.backdrop),h.heroContent&&s(h.heroContent)},{defer:!0}));function a(){let h=this.children.selected;z(h&&h.href),r(h.href)}return C(le,{get when(){return o().pages().length},get children(){return[C(Yo,St({y:200,x:90},i)),C(Hf,{x:90,y:50,onEnter:a,get data(){return[...o().pages()[0]]}})]}})};Ae.debug=!1;Ae.fontSettings.fontFamily="Ubuntu";Ae.fontSettings.color=4294967295;El(()=>C(Tl,{options:{coreExtensionModule:Oc,threadXCoreWorkerUrl:void 0,deviceLogicalPixelRatio:.5,appWidth:1920,appHeight:1080},get children(){return C(rc,{root:Mc,get children(){return[C(Xe,{path:"/",component:Dc}),C(Xe,{path:"/search",component:au}),C(Xe,{path:"/videos",component:Au}),C(Xe,{path:"/tv",component:hu}),C(Xe,{path:"/*all",component:lu}),C(Xe,{path:"/list",component:Wf})]}})}}));export{Yf as __vite_legacy_guard};
//# sourceMappingURL=index-70f5d1f7.js.map
