!function(){function t(e,n,i,r){return t="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,n,i){var r,s=o(t,e);if(s){if((r=Object.getOwnPropertyDescriptor(s,e)).set)return r.set.call(i,n),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(i,e)){if(!r.writable)return!1;r.value=n,Object.defineProperty(i,e,r)}else k(i,e,n);return!0},t(e,n,i,r)}function e(e,n,i,r,o){if(!t(e,n,i,r||e)&&o)throw new TypeError("failed to set property");return i}function n(t){var e="function"==typeof Map?new Map:void 0;return n=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return i(t,arguments,g(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),h(n,t)},n(t)}function i(t,e,n){return i=A()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&h(r,n.prototype),r},i.apply(null,arguments)}function r(){return r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=o(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},r.apply(this,arguments)}function o(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}function s(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */s=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function c(t,e,n,i){var o=e&&e.prototype instanceof _?e:_,s=Object.create(o.prototype),a=new R(i||[]);return r(s,"_invoke",{value:S(t,n,a)}),s}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var d="suspendedStart",A="suspendedYield",g="executing",p="completed",v={};function _(){}function y(){}function x(){}var m={};h(m,a,(function(){return this}));var k=Object.getPrototypeOf,T=k&&k(k(M([])));T&&T!==n&&i.call(T,a)&&(m=T);var b=x.prototype=_.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function n(r,o,s,a){var u=f(t[r],t,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==typeof h&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,a)}))}a(u.arg)}var o;r(this,"_invoke",{value:function(t,i){function r(){return new e((function(e,r){n(t,i,e,r)}))}return o=o?o.then(r,r):r()}})}function S(e,n,i){var r=d;return function(o,s){if(r===g)throw new Error("Generator is already running");if(r===p){if("throw"===o)throw s;return{value:t,done:!0}}for(i.method=o,i.arg=s;;){var a=i.delegate;if(a){var u=E(a,i);if(u){if(u===v)continue;return u}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===d)throw r=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=g;var l=f(e,n,i);if("normal"===l.type){if(r=i.done?p:A,l.arg===v)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=p,i.method="throw",i.arg=l.arg)}}}function E(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var o=f(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return y.prototype=x,r(b,"constructor",{value:x,configurable:!0}),r(x,"constructor",{value:y,configurable:!0}),y.displayName=h(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},w(C.prototype),h(C.prototype,u,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var s=new C(c(t,n,i,r),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},w(b),h(b,l,"Generator"),h(b,a,(function(){return this})),h(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=M,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return a.type="throw",a.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var u=i.call(s,"catchLoc"),l=i.call(s,"finallyLoc");if(u&&l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;L(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:M(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),v}},e}function a(t,e,n,i,r,o,s){try{var a=t[o](s),u=a.value}catch(l){return void n(l)}a.done?e(u):Promise.resolve(u).then(i,r)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){a(o,i,r,s,u,"next",t)}function u(t){a(o,i,r,s,u,"throw",t)}s(void 0)}))}}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function c(t){var e=A();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return f(this,n)}}function f(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return d(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,T(i.key),i)}}function v(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||C(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){k(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function k(t,e,n){return(e=T(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function T(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function b(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,s,a=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(a.push(i.value),a.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return a}}(t,e)||C(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=C(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function C(t,e){if(t){if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}System.register(["./CoreExtension-legacy-d4467ac1.js"],(function(t,i){"use strict";var o,a,h,A,p,x,T,C,S,E,I,L,R,M,P,z,B,O,D,F,N,U,j;return{setters:[function(t){o=t.a,a=t.E,h=t.g,A=t.m,p=t.b,x=t.i,T=t.c,C=t.d,S=t.T,E=t.e,I=t.f,L=t.h,R=t.j,M=t.S,P=t.k,z=t.B,B=t.l,O=t.n,D=t.o,F=t.W,N=t.p,U=t.q,j=t.C}],execute:function(){var t,H,W,Q,G=document.createElement("style");G.textContent="*,html{padding:0;margin:0;box-sizing:border-box}#app{width:max-content;height:max-content;overflow:hidden;line-height:0}#player{top:20px;right:0;left:0;width:80%;margin:0 auto}#player{position:absolute;display:block}video{position:relative;float:left;width:100%;object-fit:inherit;background:transparent url(data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEA2ADYAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCAIRA6wDAREAAhEBAxEB/8QAHQABAAICAwEBAAAAAAAAAAAAAAYHBAUBAgMICf/EAEUQAQABAgMBCgsFBwMFAQAAAAABAgMEBREHBhIhMTVFdIOywhMUFTJBUXGBkaGxImFyweEjJVJUc5LRM2JjJEOCouLw/8QAHQEBAAIDAQEBAQAAAAAAAAAAAAYHBAUIAwIBCf/EAEQRAQABAQMGCQkGBgICAwAAAAABAgMEBQcRITFxwRITMzVBQnOBsgYURFGDkaGxwhUiMnLR4SNSU2GCkiXwYqJj4vH/2gAMAwEAAhEDEQA/APzUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYmx2/4HH46J82uLdE6+ud9p9PmjeNRnoo79zoDJJacXeL1n1TwI8eZbe9j1Qh2d1Dmj1G9j1QZzNHqN7HqgzmaPUb2PVBnM0eo3seqDOZo9TresW79qu1coiqiumaaqZjjieN9U1TTMVRrh5WtjZ29nVZWkZ6aomJj1xOiXzhneWV5Nm+LwVeuti5NETPpj0T740lZlhaxb2VNpHTD+feM4dXhGIW9wtNdnVMbY6J74zSwXu04AAC6fEMN/L2v7IQPjK/5pdpeYXT+lT/rH6HiGG/l7X9kHGV/zSeYXT+lT/rH6HiGG/l7X9kHGV/zSeYXT+lT/rH6HiGG/l7X9kHGV/zSeYXT+lT/AKx+h4hhv5e1/ZBxlf8ANJ5hdP6VP+sfoeIYb+Xtf2QcZX/NJ5hdP6VP+sforzaBaos53apt0U0U+ApnSmNI86pJsNqmqxmZnp/Rz1lBsrOxxWimzpimOLjVGbrVIy2ysgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE32a6xTmU0zpVHgpifv8AtI/ivUz/AN9y78mmeIvk06/4f1rkwmIjF4a1ejirpidPUhldPAqml1Zd7WLeyptY6Yer5ZAAAACo9seTeL5nhcyop+xiKPB3Jj+Knin3x2UxwW34VnVYz0ae6f8AvxcsZWsJ4i/WOJ0RotI4NX5qdXvp0f4q7SRQYAAC8Ffu4AAAAAFcbReXbXR6e1UlOF8jO3dDnHKLzvR2ceKpFm3VaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnGzPnLq++j+LdTv3LwyZ+mez+tZu5rE60X8LM8NurfU+yf1+qLXinVV63R2C22emuwnqznjZP7/Nu2GkoAAACO7QMm8tblsZbpp312zHh7ftp4fnGse9ssOt+IvNMzqnRPegHl1hP2xgNvZUxnrojh07adM++nPHeoFYbhsAABeCv3cAAAAACuNovLtro9PaqSnC+RnbuhzjlF53o7OPFUizbqtAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATjZnzl1ffR/Fup37l4ZM/TPZ/WnOCxPiWb4e5PBRX+zq9k/ro0FVPDs5j1Lyu1t5tfKK51Tonv8A3zJe1KwQAAACY1jSR+TGfRL533W5P5C3RY3BxGlumvfW/wAE8NPynT3LJudt5xYU2nT07XA/lThP2JjF4uURmpirPT+WdNPuic22GnZiKgALwV+7gAAAAAVxtF5dtdHp7VSU4XyM7d0OccovO9HZx4qkWbdVoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcbM+cur76P4t1O/cvDJn6Z7P60wx1G/sz64aOic0rlvNPCoS3KcZ4/l1i9r9qqnSr8UcE/Nq7WjgVzSn9wvHnV2otemY07Y0Sy3kzwAAAFYbZsm4MFmlFPrw9yfnT3vkleCW/4rGdsb9zm7K5hOi74tRH/hV8Zp+qPcq5KnNoAC8Ffu4AAAAAFcbReXbXR6e1UlOF8jO3dDnHKLzvR2ceKpFm3VaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnGzPnLq++j+LdTv3LwyZ+mez+tNrlO+omGgjRK7a4z0zDM3IYreXcTg6p/5KPpP5PO9054iuGy8n7fg1Wl2nbHynckzWpoAAAA1O6vJ4z3c9jcHEa3K7czb/HHDT84ZlztvN7em06NyLeU+ExjWD3i5RGeqqnPT+aNNPxjNsfO0xpOk8ErJcDTExOaXA/AF4K/dwAAAAAK42i8u2uj09qpKcL5Gdu6HOOUXnejs48VSLNuq0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABONmfOXV99H8W6nfuXhkz9M9n9acTwwj68GFZxPk3NsPiNdKIq0r/DPBL3mnjLOaWvsrbzO+UW3Rn07J0SnrRrTAAAAAUHtBybyLupxdumne2b0+Ht+yrj+E6x7lh4dbcfdqZnXGj3OHPLvCfsjHrezpjNRX9+nZVr91WeO5G2yV+AvBX7uAAAAABXG0Xl210entVJThfIzt3Q5xyi870dnHiqRZt1WgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJxsz5y6vvo/i3U79y8Mmfpns/rThH14MDMrW+ol72c5msvdGelLdzuN8eyixXM610R4Ov2x+mktXeKOBaTCe4RefOrnRVOuNE7Y/bNLZMduQAAAFebYsm8YyrDZjRT9vDV+DrmP4KuL4Tp8UkwW24NpVZT0/OP2ULlZwnzi4WOJ0Rpsp4NX5atXuqzR/kqJMXKwC8InVX7uAAAAABXG0Xl210entVJThfIzt3Q5xyi870dnHiqRZt1WgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJxsz5y6vvo/i3U79y8Mmfpns/rThH14PHE0b6iX3TOlj21Oel77jsZ4DHX8JVP2bsb+mPvjj+X0fN7o4VEVx0MvyevHF29d2nVVpjbH7fJL2pWAAAAAws6y2jOMpxeCr82/bmjWfRPon3TpL3sLWbC1ptI6JafF8OoxbD7e42mq0pmNk9E905pfOF+zXhr1y1cp3ty3VNNVM+iYnSYWZTVFURVGqX8+raxru9rVY2sZqqZmJj1TGiXm+niu+mdVfu3olyPoAAABXG0Xl210entVJThfIzt3Q5xyi870dnHiqRZt1WgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJxsz5y6vvo/i3U79y8Mmfpns/rThH14OtyNaX7D4rjPDVeHqy/MLOJp47dcTP3x6Y+DKzcZRNM9LSxazdLzRbx1Z//fgsaiuLlFNVM601RrE+uGgmM05pW9TVFdMVU6pcvx9AAAAKP2pZN5L3UXL1FOlrGUxejT+Liq+ca+9PMJt+Nu8Uzrp0fo4zylYT9m47Xb0R9y3jhxt1VfHT3oe3KqF20SgEu26Zd349QAAAFcbReXbXR6e1UlOF8jO3dDnHKLzvR2ceKpFm3VaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnGzPnLq++j+LdTv3LwyZ+mez+tOEfXgTGsD8lq8xtaxMsqzlpr3RnhKtyWO8byiiiqda7E+Dn2ej5fRrL3RwLTP606wG88fc4pnXRo/T4fJumGkYAAACE7Wcn8obnIxdFOt3B17/wD8J4Kvyn3N7g9vxdvwJ1VfNTmVHCfP8Fi+UR96wnP/AIzoq3T3KVThx+um1VrCBzDtaidD3idYebKAAAAVxtF5dtdHp7VSU4XyM7d0OccovO9HZx4qkWbdVoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcbM+cur76P4t1O/cvDJn6Z7P604R9eADExlGtEvWiWDb054em5HGeKZvVYqnSi/TpH4o4Y/MvVHDs+F6ntgF44i+TYzqrj4xpjem7SrLAAAAeWMwtvHYS9hrsb61eom3VH3TGkvuiubOqK6dcMS93azvt3tLtbRnpriaZ2TGaXzbmWBuZZmGIwl3/UsXKrdX36Tpqs2ytItaItKdUv574hcrTDr3a3O2/FZ1TTPdOb461tYevWIQqqHX9lUzKJ1h4s+lyPoAABXG0Xl210entVJThfIzt3Q5xyi870dnHiqRZt1WgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJxsz5y6vvo/i3U79y8Mmfpns/rThH14APK/TrTL6p1vC0jPDTXa68Jird6jgrt1RVHtiWZERVTNM9LQV1VWFrTa0a6Zz+5ZWGv04rD2r1HmXKYqj3o9VTNNU0yuOxtabezptaNVURPvej5ewAAACnNr2TeJZ7ax1FOlvF0fan/AH08E/Le/NNcGt+MsZs510/KXJWVbCfNMVoxCiPu21On81OaJ98cH4t/hq+JqaoWxY1NhbljS2tEvR+PUAABXG0Xl210entVJThfIzt3Q5xyi870dnHiqRZt1WgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJxsz5y6vvo/i3U79y8Mmfpns/rThH14AOtyNYfsPirU1OOt8bLolpLzQk+4rG+Hy2rD1T9uxVpH4Z4Y+erW3yjg18L1pr5OXnjbtNjOuifhOmN6QsBLAAAAEV2l5P5W3K4iqmnW9hf29HsjzvlM/Bt8LtuJvMROqrR+nxVllEwn7UwC1qpjPXZffju/F/wCszO2IR3C3GZVDS2NTaWatYYtTdWc54ZEPNlAAAK42i8u2uj09qpKcL5Gdu6HOOUXnejs48VSLNuq0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABONmfOXV99H8W6nfuXhkz9M9n9acI+vABxVxD8nUwcXRrEsiiWst6c5uYxniOd0UzOlF79nPt9Hz+peaOHZT/Z94LePNb9TTOqvR+nxT9olqAAAAOK6KblFVFURVTVGkxPph+xMxOeHxXRTaUzRXGeJ0SrXFYacuzG/h54qK9I++PR8khpq4yiKvWp23sZul5rsJ6J+HR8Gdhq9YeNUNjY1MynieDPjU5H0AArjaLy7a6PT2qkpwvkZ27oc45Red6OzjxVIs26rQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE42Z85dX30fxbqd+5eGTP0z2f1pwj68AAGNiKdaZelMsO1pzw1GJibdcV0zpVTOsTHoll06dEtFaxNFXCp1wsfLcZGPwFjER/3KYmfun0x8UftKOBXNK4LneIvV3oto60fHp+LJebMAAAAQ/dtg/BYnD4umOCuPB1e2OL5a/BtrnXnpmiVfeUl24FrReaenRO2NXw+TVYW5wQyaoaKwqbK3OrGlt6Jd349AAFcbReXbXR6e1UlOF8jO3dDnHKLzvR2ceKpFm3VaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnGzPnLq++j+LdTv3LwyZ+mez+tOEfXgAA87saxL6h41w1eLt8bKplprelIdw+N31i/hKp4bdW/p9k8fz+rAvtGmK46Ut8mrzwrOu7VdXTGydfx+aTtamoAAADXboMD5Qym/biNa4jf0e2OH9PeyLvXwLSJajFbt53c66I1xpjbH/cyBYO5xN3XCrbCtuLFWtMMSpvrOdD2fDIAAVxtF5dtdHp7VSU4XyM7d0OccovO9HZx4qkWbdVoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcbM+cur76P4t1O/cvDJn6Z7P604R9eAADrXBD5qhg4qjjZFMtZbUvLJsdGV5vZvVzvbUzvK59Gk//AKJ9z7taONs5pjW8Lhe6bhe6bauc1Oqdk/pr7lio+t8AAAABXObYTybnF+zEaUTVvqPZPD+nuSCyq4yzipUN/u/md9rso1Z88bJ0/sysLXrDyrhl2NWeGZHE8WwAAVxtF5dtdHp7VSU4XyM7d0OccovO9HZx4qkWbdVoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcbM+cur76P4t1O/cvDJn6Z7P604R9eAABPEPyWLfp1h60yw7WnQ0GfUaZdi5/4qvo2F3n+JTthDcepzYdeJ/8ACr5SsDcfnHl3c5gsXNW+uzRvLn46eCfjpr72ivtj5veKqOjo2LU8k8W+2sFu98mc9Uxmq/NTon35s+yW5YSXAAAAIru4wWtGHxlMcNM+Dq9nHH5/Fs7lXrolB/KW7fds7zT0aJ+cb/e02BuaxDMrhG7tU2VM8DFbenU5H0ArjaLy7a6PT2qkpwvkZ27oc45Red6OzjxVIs26rQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE42Z85dX30fxbqd+5eGTP0z2f1pwj68AAAHldp1iX1Dwrhot0FH7rxn9Kv6S2F2n+LTthEMfp/wCMvP5KvlJsZzje3MblddXBVHh7cT6+CKu78JeuN2GeKbaNk7mhyR4twa7xhNc6/v0/CKvpnulaSJulwAAAGLmuCjMMuv4eeOun7Ovonjj5vWyr4uuKmBfrvF7u1dj640bej4q8wVc01b2eCYnSYb6uOlU13qmJzS3VqdYYUpDROeHd+PQBXG0Xl210entVJThfIzt3Q5xyi870dnHiqRZt1WgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJxsz5y6vvo/i3U79y8Mmfpns/rThH14AAAOtcP2HxVDTboaP3Tjf6Nf0lnXaf4tG2EU8oKf+LvP5KvDKv9y+bzkWf4LG66UW7kRX+CeCr5TKTXux84sKrP1/Poc5eTeKzguL3e/Z9FNX3vyzoq+Ez3vouJiqImJ1ieGJhWup35ExVGeNQPoAAABAN0GE8n55d0jSi7+0p9/H89W9sKuHZR/bQqrFbv5rf6s2qr70d+v452Rhq9aYeVUaWRY1Z4e74ZQCuNovLtro9PaqSnC+RnbuhzjlF53o7OPFUizbqtAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATjZnzl1ffR/Fup37l4ZM/TPZ/WnCPrwAAAcVRwD8lqt0NP7mx39CvsyzLtP8ajbCM+UEf8VevyV+GVSpo5GX3s7znyzuVwlVVWt6xHi9z208Xy0V9iVhxN5qiNU6ff8Au7e8gcW+1sAsaqpz12f3Kv8AHV76c07UlatYoAAACObtcF4XA2sVTH2rNWk/hn9dGwudeaqaPWiHlHduHYU3iNdE/Cf3zNHgLm+pZlpCL3arPDPh4NoArjaLy7a6PT2qkpwvkZ27oc45Red6OzjxVIs26rQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE42Z85dX30fxbqd+5eGTP0z2f1pwj68AAAAGs3QR+5Mf/Qr7Msq7ctRthHPKCP8Aib12dfhlUSbOQlg7Hs48VzjEZdXV9jFUb+iP99P+Y1+CO41YcOyptY6vyn917ZJ8W82xG1w2ufu2sZ4/NT+tOf3Qt9DHVoAAADyxeGpxmFu2K/NuUzTP3PuiqaKoqjoY94sabxZVWVWqqMyvcHvrF6u1XGldFU01R6phva81UZ4VNd4qsq5s69cTmbamdYYjeRqcj6VxtF5dtdHp7VSU4XyM7d0OccovO9HZx4qkWbdVoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcbM+cur76P4t1O/cvDJn6Z7P604R9eAAAADXboY/cmP8A6FfZlk3bl6NsI/5Qc03rs6/DKoE3cfszKMxryjNMLjbfn2LkV6euInhj3xwPG2sotrOqznphtcKxC0wq/WN+s9dnVE7c06Y740PpDD36MVh7V61VvrdymK6avXExrCsqqZoqmmdcP6D2FvZ3mxot7Kc9NURMT64mM8PR8vcAAABCt02E8TzrwsRpRfjfe+OCfyn3tzd6uHZZvUrbGrDze/cZGqvT39P697tZq31EPmY0v2znPDu+XqrjaLy7a6PT2qkpwvkZ27oc45Red6OzjxVIs26rQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE42Z85dX30fxbqd+5eGTP0z2f1pwj68AAAAGBug5DzDo9fZlk3bl6NsfNoMf5ovfZ1+GVPJu4+AXdsqzjynuYow9dWt3B1TanXj3vHTP5e5BcXsOKvHDjVVp/V2Rkyxb7RwOm71z9+wng/466fhoj8qZNItsAAABpN1uD8ZyvwtMfbsVb/AN3FP+fczLrXwa+D60bx678ddOMjXROfu6f17mgwNzfW4Z1pGaUTu1XCpZTyZquNovLtro9PaqSnC+RnbuhzjlF53o7OPFUizbqtAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATjZnzl1ffR/Fup37l4ZM/TPZ/WnCPrwAAAAYGf8hZh0evsyybty1G2Pm0OP80Xvs6/DKnk3cegJrsoznydul8Wrq0tYyibfDxb+OGn8497R4vYcbd+HGunT3dK38mGLfZ+N+a1zmot44P+Uaad8d660GdiAAAAOt23Tet12641oqiaZj1xL9ieDOeHxXRTaUzRVqnQgeHtVYPFXsPX51uqafb97d1TFdMVR0qtsqKrvbVWFWumczOeDZK42i8u2uj09qpKcL5Gdu6HOOUXnejs48VSLNuq0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABONmfOXV99H8W6nfuXhkz9M9n9acI+vAAAABgZ/wAhZh0evsyybty1G2Pm0OP80Xvs6/DKnk3cegPXC4m5gsVZxFqd7dtVxXTPqmJ1h8V0xXTNNWqWTdrxaXS3ovFjOaqiYqjbE54fSWV4+3muXYbGWvMv26bkR6tY4lZW1nNjaVWc9D+hGG36zxO5WN9svw2lMVe+NXdqZLybIAAABFN0+G8WzO1iaY0pvU6Vfij9NPg2l2q4VnNM9CCY3YcTeqbeNVUZp2x+3yeVM6xD9Y0aYVxtF5dtdHp7VSU4XyM7d0OcsovO9HZx4qkWbdVoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcbM+cur76P4t1O/cvDJn6Z7P604R9eAAAADAz/AJCzDo9fZlk3blqNsfNocf5ovfZ1+GVPJu49AAXFsfznxvJL+Arq1uYSvWmP9lXD9d98YQvGrDgW0WsaqvnDrHJRi3nWF2mHVz96xnPH5as8/Crhe+E+R5eQAAADWbosH43ld3SNa7X7Sn3cfy1ZN3r4FpH92lxe7+cXSrNrp0x3ftnR7DV7+zTLOqjNKIWNXCoiVebReXbXR6e1Uk+F8jO3dDnfKLzvR2ceKpFm3VaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnGzPnLq++j+LdTv3LwyZ+mez+tOEfXgAAAAwM/5CzDo9fZlk3blqNsfNocf5ovfZ1+GVPJu49AASnZvnPkfdVht9VpZxP8A09fv83/2iGqxOx467VZtcaf+9yycnuLfZWP2PCnNRa/cn/L8P/tEd2de6v3bQAAABMaxpPDBqfmtDJw84LF4jDeiir7P4Z4Y+Tb8Lh0xUrqbLza2rsPVOjZ0fBXe0Xl210entVJPhfIzt3Q50yi870dnHiqRZt1WgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJxsz5y6vvo/i3U79y8Mmfpns/rThH14AAAAMDP+Qsw6PX2ZZN25ajbHzaHH+aL32dfhlTybuPQAHNNU0VRVTMxVE6xMeiX5MZ9EvqmqaKoqpnNMPo3c3m0Z5kWCx0TG+u24mvT0VRwVR8YlWt6seItqrP1T8Oh3/5PYpTjWFXe/wAa66Yz/mjRVHviWyYqRAAAANBuiw28xVjExHBXHg6vbxx+bOsKs9M0opi9jwbWi3jp0T843qn2i8u2uj09qpMML5Gdu6HLOUXnejs48VSLNuq0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABONmfOXV99H8W6nfuXhkz9M9n9acI+vAAAABgZ/yFmHR6+zLJu3LUbY+bQ4/wA0Xvs6/DKnk3cegAALW2NZx4TD43LK6uG3Ph7cfdPBV89PiiWN2Oaqm2jp0TudN5I8W4djeMKrnTTPDp2Toq905p75WUi7ogAAABi5nhvG8DdoiNatN9T7Y4YelnVwaolg32x4+wqojXrjbCktok655Zn14entVJ1hnIzt3Q47yiTnxazn/wCOnxVIs26rgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE12cX7ViMxm7cotxPg+GuqI/iaHFKaquBwYz69y6cnFvY2EXybauKY+5rmI/n9aVXt0WWWPPx+H9lNyKvo09N1t6tVE+5att5RYRYfjvVHdVE/LOw7u7fJ7fFiprn1U26v8PeMPvE9X4w09r5b4FZ6rfPspq/TMxbm0PLKPNoxFz2URH1l7RhlvOuYhqrTKHhFH4aa6tkRvqhjV7ScNHmYO7V+KqI/y9YwqvpqhrbTKTc45O71TtmI/Vj17S/4cv8Aje/+XpGE+uv4fuwK8pf8l099f/1YeYbQL2Owd/D+J0UU3aJomrfzMxrGnqe9lhtNnXFfC1NPiGUC3v11tbr5vFMV0zTn4Uzmzxm9UIm3KpwAAG03N5/e3NZtax1imLlVETTNuqdIqiY00n6+5i3m703qymzqSPyfxy38nsQoxCwjhTTniYnVMTGbNPz2wm1G2rER52VWp9l6Y/JopwOjotPguOnLBeY/Hc6Z/wA5j6ZZFvbZTPn5RMffTiNe685wKei0+H7s6zyxUzylxzbLTP8ARDLtbaMvn/Vy/E0fgmmr84eM4Ha9FcfFtLLK9hs8rdq42TTPzmGbZ2vZFd86nF2vx2on6TLwqwa8xqzT3/s3FjlV8n7T8UWlO2mN1Us+xtL3OX+DyhFE+qu1XHz00Y9WF3unqfGG7sconkzbaPOs0/3prj48HN8Wxw+63JcVp4PNcJMz6JvUxPwmWNVc7xRrs59yQWHlTgd55K+2f+9MT7pmJVHtPi3G6WPBV03LU2aZpqomJjSaqkwwrP5v96NOf9HLeUubOcbibGqKqeBGaYnPH4qvUiLcqoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAf//Z) 50% 50% / cover no-repeat}.controls{position:absolute;z-index:999;float:left;overflow:hidden;width:100%;height:100%;margin:0;padding:0;opacity:0;background:transparent}.controls button,.controls .dropbtn{overflow:hidden;cursor:pointer;text-align:center;white-space:nowrap;text-indent:-99999px;text-overflow:ellipsis;border:none;background:transparent;background-repeat:no-repeat;background-size:contain;-webkit-appearance:none;-moz-appearance:none}.controls button:focus,.controls .dropbtn:focus{outline:none}.controls button::-moz-focus-inner{border:0}.controls button[data-state=back]{position:absolute;top:92%;left:44%;width:40px;height:40px;margin:-25px}.controls button[data-state=next]{position:absolute;top:92%;left:56%;width:40px;height:40px;margin:-25px}.controls button[data-state=max]{position:absolute;top:92%;right:10%;width:40px;height:40px;margin:-25px}#time{position:absolute;top:89%;left:5%;font-weight:700;color:#fff}#time span{font-weight:700;color:#fff}.controls button[data-state=play],.controls button[data-state=pause]{position:absolute;top:92%;left:50%;width:40px;height:40px;margin:-25px}@media (max-width: 568px){.controls button[data-state=play],.controls button[data-state=pause]{width:25px;height:25px;margin:-12.5px}}.controls button[data-state=mute],.controls button[data-state=unmute]{position:absolute;top:30px;right:75px;width:30px;height:30px;margin:-15px}@media (max-width: 568px){.controls button[data-state=mute],.controls button[data-state=unmute]{width:15px;height:15px;margin:-7.5px}}@media (max-width: 568px){.controls button[data-state=mute],.controls button[data-state=unmute]{top:15px;right:37.5px}}.controls .dropbtn{position:absolute;width:30px;height:30px;margin:-15px}@media (max-width: 568px){.controls .dropbtn{width:15px;height:15px;margin:-7.5px}}.controls .dropdown{position:absolute;top:30px;right:30px;display:inline-block}@media (max-width: 568px){.controls .dropdown{top:15px;right:15px}}.controls .dropdown-content{font-size:10px;position:absolute;z-index:1;top:15px;right:-24px;display:none;overflow:auto;background-color:#000}@media (max-width: 568px){.controls .dropdown-content{font-size:6px;top:7.5px;right:-12px}}.controls .dropdown-content a{display:block;padding:.8em 1em;cursor:pointer;text-decoration:none;color:#fff}.controls .show{display:block}.controls .progress{position:absolute;top:77%;width:100%;margin:0;padding:0;cursor:pointer}.controls .progress progress{width:90%;opacity:.5;margin:auto;display:block}.controls button:focus{border:2px solid #000}.controls progress:focus{border:2px solid #000}.controls button[data-state=max]{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPg0KPHN2ZyB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik0yIDlWNi41QzIgNC4wMSA0LjAxIDIgNi41IDJIOSIgc3Ryb2tlPSIjMjkyRDMyIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+DQo8cGF0aCBvcGFjaXR5PSIwLjQiIGQ9Ik0xNSAySDE3LjVDMTkuOTkgMiAyMiA0LjAxIDIyIDYuNVY5IiBzdHJva2U9IiMyOTJEMzIiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4NCjxwYXRoIGQ9Ik0yMiAxNlYxNy41QzIyIDE5Ljk5IDE5Ljk5IDIyIDE3LjUgMjJIMTYiIHN0cm9rZT0iIzI5MkQzMiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPg0KPHBhdGggb3BhY2l0eT0iMC40IiBkPSJNOSAyMkg2LjVDNC4wMSAyMiAyIDE5Ljk5IDIgMTcuNVYxNSIgc3Ryb2tlPSIjMjkyRDMyIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+DQo8L3N2Zz4=)}.controls button[data-state=back]{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPg0KPHN2ZyB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIG9wYWNpdHk9IjAuNCIgZD0iTTkuNTM5MDYgMTUuOTJWMTAuNTgwMUw4LjAzOTA2IDEyLjI1MDEiIHN0cm9rZT0iIzI5MkQzMiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPg0KPHBhdGggZD0iTTEwLjAxOTUgNC40Njk5N0wxMS45OTk1IDIiIHN0cm9rZT0iIzI5MkQzMiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPg0KPHBhdGggZD0iTTQuOTA5MzkgNy43OTk3NEMzLjc5OTM5IDkuMjc5NzQgMy4xMDkzOCAxMS4xMDk3IDMuMTA5MzggMTMuMTA5N0MzLjEwOTM4IDE4LjAxOTcgNy4wODkzOSAyMS45OTk4IDExLjk5OTQgMjEuOTk5OEMxNi45MDk0IDIxLjk5OTggMjAuODg5NCAxOC4wMTk3IDIwLjg4OTQgMTMuMTA5N0MyMC44ODk0IDguMTk5NzQgMTYuOTA5NCA0LjIxOTczIDExLjk5OTQgNC4yMTk3M0MxMS4zMTk0IDQuMjE5NzMgMTAuNjU5NCA0LjMwOTc4IDEwLjAxOTQgNC40NTk3OCIgc3Ryb2tlPSIjMjkyRDMyIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+DQo8cGF0aCBvcGFjaXR5PSIwLjQiIGQ9Ik0xNCAxMC41ODAxQzE1LjEgMTAuNTgwMSAxNiAxMS40ODAxIDE2IDEyLjU4MDFWMTMuOTMwMUMxNiAxNS4wMzAxIDE1LjEgMTUuOTMwMSAxNCAxNS45MzAxQzEyLjkgMTUuOTMwMSAxMiAxNS4wMzAxIDEyIDEzLjkzMDFWMTIuNTgwMUMxMiAxMS40NzAxIDEyLjkgMTAuNTgwMSAxNCAxMC41ODAxWiIgc3Ryb2tlPSIjMjkyRDMyIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+DQo8L3N2Zz4=)}.controls button[data-state=next]{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPg0KPHN2ZyB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik0xMy45OCA0LjQ2OTk3TDEyIDIiIHN0cm9rZT0iIzI5MkQzMiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPg0KPHBhdGggZD0iTTE5LjA4OTQgNy43OTk3NEMyMC4xOTk0IDkuMjc5NzQgMjAuODg5NCAxMS4xMDk3IDIwLjg4OTQgMTMuMTA5N0MyMC44ODk0IDE4LjAxOTcgMTYuOTA5NCAyMS45OTk4IDExLjk5OTQgMjEuOTk5OEM3LjA4OTM5IDIxLjk5OTggMy4xMDkzOCAxOC4wMTk3IDMuMTA5MzggMTMuMTA5N0MzLjEwOTM4IDguMTk5NzQgNy4wODkzOSA0LjIxOTczIDExLjk5OTQgNC4yMTk3M0MxMi42Nzk0IDQuMjE5NzMgMTMuMzM5NCA0LjMwOTc4IDEzLjk3OTQgNC40NTk3OCIgc3Ryb2tlPSIjMjkyRDMyIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+DQo8cGF0aCBvcGFjaXR5PSIwLjQiIGQ9Ik05LjUzOTA2IDE1LjkyVjEwLjU4MDFMOC4wMzkwNiAxMi4yNTAxIiBzdHJva2U9IiMyOTJEMzIiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4NCjxwYXRoIG9wYWNpdHk9IjAuNCIgZD0iTTE0IDEwLjU4MDFDMTUuMSAxMC41ODAxIDE2IDExLjQ4MDEgMTYgMTIuNTgwMVYxMy45MzAxQzE2IDE1LjAzMDEgMTUuMSAxNS45MzAxIDE0IDE1LjkzMDFDMTIuOSAxNS45MzAxIDEyIDE1LjAzMDEgMTIgMTMuOTMwMVYxMi41ODAxQzEyIDExLjQ3MDEgMTIuOSAxMC41ODAxIDE0IDEwLjU4MDFaIiBzdHJva2U9IiMyOTJEMzIiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4NCjwvc3ZnPg==)}.controls button[data-state=play]{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDgwMCA4MDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDgwMCA4MDAiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnIGlkPSJMYXllcl8xIj48cGF0aCBkPSJNNzcxLjksNDAwYzAsMjA1LjMtMTY2LjYsMzcxLjktMzcxLjksMzcxLjlTMjguMSw2MDUuMywyOC4xLDQwMFMxOTQuNywyOC4xLDQwMCwyOC4xICAgUzc3MS45LDE5NC43LDc3MS45LDQwMHoiIGZpbGw9IiM0REI2QUMiLz48L2c+PGcgaWQ9IkxheWVyXzIiPjxnPjxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMTYiIHgxPSIzMjMuMyIgeDI9IjMyMy4zIiB5MT0iMjM1LjkiIHkyPSI1NjQuMSIvPjxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMTYiIHgxPSIzMjMuMyIgeDI9IjU1MC40IiB5MT0iMjM1LjkiIHkyPSI0MDAiLz48bGluZSBmaWxsPSJub25lIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjE2IiB4MT0iNTUwLjQiIHgyPSIzMjMuMyIgeTE9IjQwMCIgeTI9IjU2NC4xIi8+PC9nPjwvZz48L3N2Zz4=)}.controls button[data-state=pause]{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUxMiA1MTIiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48bGluZWFyR3JhZGllbnQgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGlkPSJTVkdJRF8xXyIgeDE9IjI1NiIgeDI9IjI1NiIgeTE9IjUxMiIgeTI9Ii05LjA5NDk0N2UtMDEzIj48c3RvcCBvZmZzZXQ9IjAiIHN0eWxlPSJzdG9wLWNvbG9yOiNGODU3QTYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRjU4NTgiLz48L2xpbmVhckdyYWRpZW50PjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgZmlsbD0idXJsKCNTVkdJRF8xXykiIHI9IjI1NiIvPjxnPjxwYXRoIGQ9Ik0yMTMuMiwxMjloLTU5LjFjLTkuMiwwLTE2LjYsNy41LTE2LjYsMTYuNnYyMjAuN2MwLDkuMiw3LjUsMTYuNiwxNi42LDE2LjZoNTkuMWM5LjIsMCwxNi42LTcuNSwxNi42LTE2LjYgICBWMTQ1LjdDMjI5LjksMTM2LjUsMjIyLjQsMTI5LDIxMy4yLDEyOXogTTIxNy40LDM2Ni4zYzAsMi4zLTEuOSw0LjItNC4yLDQuMmgtNTkuMWMtMi4zLDAtNC4yLTEuOS00LjItNC4yVjE0NS43ICAgYzAtMi4zLDEuOS00LjIsNC4yLTQuMmg1OS4xYzIuMywwLDQuMiwxLjksNC4yLDQuMlYzNjYuM3oiIGZpbGw9IiNGRkZGRkYiLz48cGF0aCBkPSJNMzU3LjgsMTI5aC01OS4xYy05LjIsMC0xNi42LDcuNS0xNi42LDE2LjZ2MjIwLjdjMCw5LjIsNy41LDE2LjYsMTYuNiwxNi42aDU5LjFjOS4yLDAsMTYuNi03LjUsMTYuNi0xNi42ICAgVjE0NS43QzM3NC41LDEzNi41LDM2NywxMjksMzU3LjgsMTI5eiBNMzYyLDM2Ni4zYzAsMi4zLTEuOSw0LjItNC4yLDQuMmgtNTkuMWMtMi4zLDAtNC4yLTEuOS00LjItNC4yVjE0NS43ICAgYzAtMi4zLDEuOS00LjIsNC4yLTQuMmg1OS4xYzIuMywwLDQuMiwxLjksNC4yLDQuMlYzNjYuM3oiIGZpbGw9IiNGRkZGRkYiLz48L2c+PC9zdmc+)}.controls button[data-state=mute]{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEyOCAxMjg7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjggMTI4IiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPjxnPjxjaXJjbGUgY3g9IjY0IiBjeT0iNjQiIHI9IjY0Ii8+PC9nPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik02MC41LDM4TDM4LDUySDI4Yy0yLjIsMC00LDEuOC00LDR2MTZjMCwyLjIsMS44LDQsNCw0aDEwbDIyLjUsMTRjMC42LDAuNSwxLjUsMCwxLjUtMC44VjM4LjggIEM2MiwzOC4xLDYxLjIsMzcuNiw2MC41LDM4eiIvPjxnPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik04Ny43LDk2LjhsLTEuMy0xLjVjLTAuNC0wLjQtMC4zLTEsMC4xLTEuNEM5NS4xLDg2LjMsMTAwLDc1LjUsMTAwLDY0YzAtMTEuOC01LjEtMjIuOS0xNC4xLTMwLjUgICBjLTAuMi0wLjEtMC41LTAuNC0wLjktMC43cy0wLjUtMC45LTAuMi0xLjNsMS4xLTEuN2MwLjMtMC41LDEtMC42LDEuNC0wLjJjMC41LDAuNCwxLDAuOCwxLDAuOEM5OC4zLDM4LjgsMTA0LDUxLDEwNCw2NCAgIGMwLDEyLjYtNS40LDI0LjYtMTQuOCwzM0M4OC43LDk3LjMsODguMSw5Ny4zLDg3LjcsOTYuOHoiLz48L2c+PGc+PHBhdGggY2xhc3M9InN0MCIgZD0iTTc5LjEsODguM2wtMS4yLTEuNmMtMC4zLTAuNC0wLjMtMSwwLjItMS40Qzg0LjQsODAsODgsNzIuMyw4OCw2NHMtMy42LTE2LTEwLTIxLjNjLTAuNC0wLjMtMC41LTEtMC4yLTEuNCAgIGwxLjItMS42YzAuMy0wLjQsMS0wLjUsMS40LTAuMkM4Ny44LDQ1LjcsOTIsNTQuNSw5Miw2NHMtNC4yLDE4LjMtMTEuNSwyNC40QzgwLjEsODguOCw3OS41LDg4LjcsNzkuMSw4OC4zeiIvPjwvZz48Zz48cGF0aCBjbGFzcz0ic3QwIiBkPSJNNjkuNiw3OC4yYy0wLjQtMC40LTAuMy0xLjEsMC4xLTEuNGM0LTMuMSw2LjMtNy44LDYuMy0xMi43YzAtNS4xLTIuMy05LjgtNi4zLTEyLjdjLTAuNC0wLjMtMC41LTEtMC4yLTEuNCAgIGwxLjMtMS41YzAuMy0wLjQsMC45LTAuNSwxLjQtMC4yQzc3LjEsNTEuOCw4MCw1Ny43LDgwLDY0YzAsNi4xLTIuOSwxMS45LTcuNywxNS44Yy0wLjQsMC4zLTEsMC4zLTEuNC0wLjFMNjkuNiw3OC4yeiIvPjwvZz48L3N2Zz4=)}.controls button[data-state=unmute]{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAMNUlEQVR4Xu2dO5IUSRJAo08wsyeY5gQwJ5jeEzRSqwUKGjaMhoAZhYCANIwhIdEjYijsCXY4Ac0JtpcLLJygxl5tRVtWVmbGx90jI7I6zcraMPIX7i88/BMZceKWd/zknDt1zp055350zt3bNZG//Dvm+Oacu9qdyF/+/Zdz7to599+YG7RyzkkrLzrxnr/slI3CU5Sc23QPB0Dw+5R7oxquaxEAevj93Q+l13AAwsfdrykL0QoAXukPOia9BsUPvQNDxmUrMNQOwMo5h9Jr6emp0GEZgOHP1AtLnV8jAD84557sFI8zt4QD5xEQXjvnvtfUoJoA8IpH+bHeek2yjHkXHEggqAaEGgA4BsX34agGhLkBYIxf7+L2mB60tHMYGmj/bD7CXADg1TMmturcaYOIs4izWzyEnAOA5zvqtYW4hPthDV6UbEhJAOj1JEt8arZkO1t6FnkEEl1FrEEpABjr8XyX6t1rA4aTSDRk7huUAOD3XWO0hXQM98NPemjZUEsACO9wbmow+b6ih9fNb+og+cSvW0m01EHo3rw7zrJJAskKgLu78X6OTB7QITRfvv0SknDg/2mLLy8D8xyRC9DiF0jbctBUCwAQGMIvNd4zXvpKHM816SkdyWHZgMBXJEu2k+eqQqANQCnld5X+L2EPl15+XhAG2q0KgSYATMygJ1r2CEwh0QTOkXVPTwUDy0AyB+/deujjOSoRghYA1j1/9pRpIg0lUtz4I+LhQAMAS+W3pvg+J5YgqAwHUgDMlP/48ePrN2/eQHltpj7RGDhf7STNq32IIZAAQMMIt1THu7t377rLy0t37942fXB5cnJimgjR1sjE/egs+C7aeRGsZHZHkQDwWbsxz58/d+v1QUdZEgTwYVEMoyP+nANzLgDvdh5vzjNHr1mtVtveP3C0CAEWEpox0/0Kn0WiLCttnAMAjs2gljRoWAgE5AaQESHxWInXIlWeHB6mAkBJF3NjGeu7hiEYmugSqvFrWlOsDf5AdCk5FQD1cX/MajQIwa+73t7vHCEAEIFmxTTJH0gBwMJ5mRw1GoEg5N3HAIAcNIfW2Ge6WAAwbaEyqoYLcHCPiiGIje+jlaEMAeF5cCiIBeDfM5VBt0BUCAF1D5y8mBxICgCawwGV0X+GemUMAJqmKfQ+tYeI9HqKUXjbsUcqANxXyzEMRgUhAEyyfbGS6583syXohnYpTcgBgPtrWN1gljAEQHHHLyTZGSCQfsOQC4BW55t8/hQAvAAEiWL+d+/euSdPnrjv3/VqOgUhGAvtQpx2/z8XAO5BhOFXKkl5ZvdccgP4KoMKmAJA3Pt9bv/q6sqdnZ21BEEotEtRhgQAniPWw0Q2cjQMFPd+qnoo3h+NQBAb2pUEQMMfGLUCYxZATN3nz599SbcVCFJCu9IAaAwFg5ZoDID/RMa4Y4JYbzYbvyjC3jkVWoKc0K40ABpDAfq403/xIQCkcf9N6LHZbAbvVREEJT5Zk/oAXmcaUcFBXmAIAGn8ufeQSiGQhnZzWACeKe2cB9nBPgDSnP+gmakMAvybksvQaFkAD510eN6rEfQBIO4l1Zl7jKYea4Dgw4cP3y4uLkR5jQzBaAMgtQLA/4dvRx8ASb1/sPd3BVYDBEw5e/iw6DxTbQAQqcQK7M0X6AIgNf97ZI31lCOEwAIAqRW4GQa6AEjM/2S6sQ/DkUFgAYA0UXfTWbsASLz/5BmpRwSBBQD0KUnJ+CYa6AKwyXBw/CV8sZq8avaRQGAFAJlLFJl7bHXvAZDcLOj8Tb3hEUBgBYDUGdx2Wg+AJPefbP6PzCewBEAym3j7Xh4AyfjPShniRRoWbAksAWCWEmsy5BxbP8AD8D/BxI/QrKLol1soBJYAINtc343I7R8oTxL/R808jSbg/zOAN0PfB5YsICkni6wBkFjvUwCQOIAWjduMTflqFAILGXX7lMR/OwMAyQ1Uxv+ehdiatAVBYA2AxA9YA4DEk4z6+iRlCOiOaQuBwBoAyRD+GgAkY4iaA9iBZM+pWQAE1gBIHMG/JAAkfYWaYAUOvNrGISgBQG4VdwtAbgioHgHsIBkMaxqGoAQAuVb8GwDkxpFMHPktoWfHnjr6Po1CUAKAbD9OAoBVwyaBbBACKzmphILNAdBgiHgLQKztn/IB+vdoyBLcAmABQEOW4BYAKwAageAWAEsAaoHg48eP7sGDB0NfQN8CYA1ALRCMFKtuASgBQMUQLBaA4omgGJBqiA56lqAEAKJEUBOp4Bjl+3Mqg6AEAKJUcO7FxYpBKcqvDYLz8/P1169frfcDFhWDcgFA1ubl4Bzl1wTBbpGns5OTE71Vsg6FklvP2VYDs8eP3SoiweVIE5WY25jBx9QwHBhDIJ4QUuWUsERoJk9fOATiKWHVTQrVVP4RDAeSDrydFCoxIRaTQlSHgC5MC7UEEh9uOy2cIzcUtHAEzQCoJVmk7BPkyuvmwxDkIqFIe2p4boOiR44FWQLJ+L/3aZhkHBF/HNrTnDkAC7IEkghu7+NQiSMo+jx8oNsWAWAhEEjWCtr7PBx5SASftUDEiM2WvEf0MLCA6EDSaW98t9mWiJnQFA2THHytRKEqejm4Rn0C9SViii0SJdFu5LUsooRvgoMadTQGgckiUZJ8AEKOWiYuSht6JyWtAN4QBCbLxCH23KoS12o7g1oY+D18ATR4NAKBxPkbXSgS4UiGAa4P7lIV1IDdCdG7gFQOgbT3Ty4VKx0GarUCXayi9gGqGAJJ70cOk4tFc4IkK1i7FfAgRC0XXyEE0t4fXC4eAUkfEtyrzs7KJ985uBdgLRA8e/bs/suXL1FgzG6lY4KI2jCCi6VmpsQ8uGRtj1wQ3DKmBgiePn367dWrV9G5jYG2Rm8Zw7WS2oB/NvvYf9HSUoH7TIaMc0JwfX3t7tw52O4nVSSDnXJsTp800cDLWU0aTW14yvmT28bNBQF7Ln76lLwUc7fdydvGaVmBloaCrsBGQ8bSEJyenroXL8STikf1MDWrV8MKINTWhoJgyFgSghTzNXJu9taxWlagpahgSIaDIWNDEExa4dC8fo296lr1B/owHISMDUAQ7HwhADTyAl6Q2jOHFKxj8i0O6gqVQxBMzccAgJSk2UEvaasPSpM1KbxgL2SsFIKoGduxAEhrBF15B6kUKqfk5Tf5kgohiFrGNxYALYfQK2dJEBAyYtnOKoIgOvxOAQDlSeYL9HvmUoYD365tlXG1Wv1Yar+DEVOXlIBLBYChgAdIctLd916CY9htD/J5vVqt7s8EATE/eZfoD3ZTAdCMCrzgAIpZxZafT5f0C3jW+aNHjy7fvn170FEsNr3oNC55aM0BgOdJZqQOKYN4lQmcLRWPQlD98P79+/XFxcXBVDTlLWlEYXYuANr+gG9EtPMSkn4t/9/fCGu9Xmvk9vvNSxr3uxdLANDKEg41BlO2GGsABFdXV5esI/jli3qzgtm+qc4gAYD7EgKRcNByCrvvijUgUmjdN5gsMQstFU4f/lM2VVIArCGAbkD4UyiouS5neh3vL5nGNfbuYuVzYw0ArCHg/q2BYKl45KGifE0ASkDgQWBYIH9Q29CAqcd3weu36PFdS5Ac7o2ZES0L4O9v6RN020APYM9cfuJ9i4XjA2ViQlh+Fr5Qv92iMb/fVm0ASlmCMRhwSK0tAz0dJZRSum+rmtnXCgOnOg6WgN5pbQqH3gEIiIv5i++Q7SHvbk5baAdKJ83K39KHWaLMwgJ44dBTUAJCm/sACHoQguQ3daBsfpjzWt7dLFVuCYAXsmQdm7nBmfv55sWyEgAgRMKipFU75pb8zM/HWhFNmOc/SgGAPCmV4hfUYFZn1u/k4xmucDCjS7qSxpQEwL+nxmdnkjbXfG3xYtgcAHhrwPg2h0ddIwA4yyR3ivT6EmFgrJCtU6ax7zHXebOnuOeyAF2B+2oZTo91Jm0uRfefi5OHUzx7tbMGALp5AyBYMgjVKN4LvSYA+iAwJs6RSbSwEph6fJ7Ze3y/cTUC0H1HfARAaNVZxLlD8ebxfC61tQPg20UOgdgYGGrPIxDHo3RyHsW9+lQQWgGg2y4PA0DUYhno6b48Xb3SawoDU4EdOp8PNQHBV+usIwkcOV9tRPGitVs0BCC5R4sWINReLIQv33YregwdsXB4JfMsX0n05eWmenhIWH8D9nKGg9Me8hEAAAAASUVORK5CYII=)}.controls .btn-settings{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEyOCAxMjg7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjggMTI4IiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPjxjaXJjbGUgY3g9IjY0IiBjeT0iNjQiIHI9IjY0Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMyw1N2gtOS4xYy0wLjUsMC0wLjgtMC4zLTEtMC43Yy0wLjctMi42LTEuNy01LTMtNy4zYy0wLjItMC40LTAuMi0wLjksMC4xLTEuMmw2LjQtNi40YzAuNC0wLjQsMC40LTEsMC0xLjQgIEw4OCwzMS41Yy0wLjQtMC40LTEtMC40LTEuNCwwbC02LjQsNi40Yy0wLjMsMC4zLTAuOCwwLjQtMS4yLDAuMmMtMi4zLTEuMy00LjctMi4zLTcuMy0zYy0wLjQtMC4xLTAuNy0wLjUtMC43LTFWMjUgIGMwLTAuNi0wLjQtMS0xLTFINThjLTAuNiwwLTEsMC40LTEsMXY5LjFjMCwwLjUtMC4zLDAuOC0wLjcsMWMtMi42LDAuNy01LDEuNy03LjMsM2MtMC40LDAuMi0wLjksMC4yLTEuMi0wLjEgIGMtMS40LTEuNC00LjktNC45LTYuNC02LjRjLTAuNC0wLjQtMS0wLjQtMS40LDBMMzEuNSw0MGMtMC40LDAuNC0wLjQsMSwwLDEuNGw2LjQsNi40YzAuMywwLjMsMC40LDAuOCwwLjIsMS4yICBjLTEuMywyLjMtMi4zLDQuNy0zLDcuM2MtMC4xLDAuNC0wLjUsMC43LTEsMC43SDI1Yy0wLjYsMC0xLDAuNC0xLDF2MTJjMCwwLjYsMC40LDEsMSwxaDkuMWMwLjUsMCwwLjgsMC4zLDEsMC43ICBjMC43LDIuNiwxLjcsNSwzLDcuM2MwLjIsMC40LDAuMiwwLjktMC4xLDEuMmMtMS40LDEuNC00LjksNC45LTYuNCw2LjRjLTAuNCwwLjQtMC40LDEsMCwxLjRsOC41LDguNWMwLjQsMC40LDEsMC40LDEuNCwwbDYuNC02LjQgIGMwLjMtMC4zLDAuOC0wLjQsMS4yLTAuMmMyLjMsMS4zLDQuNywyLjMsNy4zLDNDNTYuOCw5Myw1Nyw5My41LDU3LDk0djljMCwwLjYsMC41LDEsMS4xLDFoMTJjMC42LDAsMC45LTAuNCwwLjktMXYtOSAgYzAtMC41LDAuNC0wLjksMC44LTEuMWMyLjYtMC43LDUtMS43LDcuMy0zYzAuNC0wLjIsMC45LTAuMiwxLjIsMC4xYzEuNCwxLjQsNC45LDQuOSw2LjQsNi40YzAuNCwwLjQsMSwwLjQsMS40LDBsOC41LTguNSAgYzAuNC0wLjQsMC40LTEsMC0xLjRsLTYuNC02LjRjLTAuMy0wLjMtMC40LTAuOC0wLjItMS4yYzEuMy0yLjMsMi4zLTQuNiwzLTcuMmMwLjEtMC40LDAuNS0wLjcsMS0wLjdoOS4xYzAuNSwwLjEsMC45LTAuNCwwLjktMVY1OCAgQzEwNCw1Ny40LDEwMy42LDU3LDEwMyw1N3ogTTY0LDgyYy05LjksMC0xOC04LjEtMTgtMThzOC4xLTE4LDE4LTE4czE4LDguMSwxOCwxOFM3My45LDgyLDY0LDgyeiIvPjwvc3ZnPg==)}.display-control{opacity:1;background:transparent}.show{display:block}.active{background:green}#live-indicator{display:flex;align-items:center;position:absolute;top:89%;left:5%}#red-dot{height:10px;width:10px;background-color:red;border-radius:50%;display:inline-block;margin-right:5px}#live-text{font-size:16px;font-weight:700;color:#fff}.display_none{display:none!important}.quality:focus{background-color:#53a653}\n",document.head.appendChild(G);function Y(){var t=document.getElementById("player"),e=document.getElementById("video"),n=document.getElementById("video-controls"),i=document.getElementById("playpause"),r=document.getElementById("mute"),o=document.getElementById("max"),s=document.getElementById("back"),a=document.getElementById("next"),u=document.getElementById("current-time"),l=document.getElementById("end-time"),h=document.getElementById("progress"),c=document.getElementById("progress-bar"),f=e.getAttribute("data-src"),d=0;if(e.controls=!1,Hls.isSupported()){var A=new Hls;A.loadSource(f),A.attachMedia(e),A.on(Hls.Events.MANIFEST_PARSED,(function(){e.hidden=!1,e.play(),function(t){var e=document.getElementById("quality-btn"),n=document.getElementById("quality");e.addEventListener("click",(function(t){u(),n.classList.toggle("show")}));var i=t.levels;console.log(i);for(;n.firstChild;)n.removeChild(n.firstChild);var r=document.createElement("a");r.setAttribute("data-value",-1),r.setAttribute("class","quality"),r.setAttribute("tabindex","0"),r.setAttribute("id","quality-0"),r.text="Auto",n.appendChild(r);for(var o=0;o<i.length;o++){var s=document.createElement("a");s.setAttribute("data-value",o),s.setAttribute("class","quality"),s.setAttribute("tabindex","0"),s.setAttribute("id","quality-"+(o+1)),s.text=(i[o].name||i[o].height)+"p",n.appendChild(s)}var a=document.querySelectorAll("#quality a");function u(e){for(var n=0;n<a.length;n++)e||n!=t.currentLevel+1?a[n].classList.remove("active"):t.autoLevelEnabled?(a[0].classList.add("active"),a[n].classList.remove("active")):a[n].classList.add("active");if(e){var i=parseInt(this.getAttribute("data-value"));t.currentLevel=i,this.classList.add("active")}}for(o=0;o<a.length;o++)a[o].addEventListener("mousedown",u)}(A),setTimeout((function(){i.focus()}),500)})),A.on(Hls.Events.LEVEL_LOADED,(function(t,e){var n,i;0===d&&1===(d=(e.details||{}).live?1:2)&&(n=document.getElementById("time"),i=document.getElementById("live-indicator"),n.className="display_none",i.className="",i.setAttribute("data-type","live"))}))}function g(t){"playpause"==t?e.paused||e.ended?(i.setAttribute("data-state","play"),n.classList.add("display-control")):i.setAttribute("data-state","pause"):"mute"==t&&r.setAttribute("data-state",e.muted?"unmute":"mute")}i.addEventListener("click",(function(t){e.paused||e.ended?e.play():e.pause()})),r.addEventListener("click",(function(t){e.muted=!e.muted,g("mute")})),h.addEventListener("click",(function(n){var i=(n.pageX-(this.offsetLeft+this.offsetParent.offsetLeft+t.offsetLeft))/this.offsetWidth;e.currentTime=i*e.duration,u.innerHTML=X(e.currentTime)})),o.addEventListener("click",(function(t){var e,n,i;e=document.getElementById("player"),n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n-e.offsetWidth>40||i-e.offsetHeight>40?(e.style.width="100%",e.style.top="0"):(e.style.width="80%",e.style.top="20px")})),s.addEventListener("click",(function(t){e.currentTime=Math.max(e.currentTime-10,0),u.innerHTML=X(e.currentTime)})),a.addEventListener("click",(function(t){e.currentTime=Math.min(e.currentTime+10,e.duration),u.innerHTML=X(e.currentTime)})),e.addEventListener("loadedmetadata",(function(){var t=Math.min(e.currentTime,e.duration);e.currentTime=t,u.innerHTML=X(e.currentTime),l.innerHTML=X(e.duration)})),e.addEventListener("play",(function(){g("playpause")}),!1),e.addEventListener("pause",(function(){g("playpause")}),!1),e.addEventListener("timeupdate",(function(){h.getAttribute("max")||h.setAttribute("max",e.duration),h.value=e.currentTime,u.innerHTML=X(e.currentTime),c.style.width=Math.floor(e.currentTime/e.duration*100)+"%"}))}function X(t){var e=Math.floor(t/3600),n=Math.floor(t%3600/60),i=Math.floor(t%60),r="";return e>0&&(r+="".concat(e.toString().padStart(2,"0"),":")),r+="".concat(n.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"))}function V(t){var e=t||"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8";document.getElementById("video").setAttribute("data-src",e),document.getElementById("video-controls"),document.getElementById("video"),document.getElementById("player"),Y()}function Z(){var t,e,n,i,r=document.getElementById("video");r.hidden=!0,r.pause(),t=document.getElementById("time"),(e=document.getElementById("live-indicator")).className="display_none",t.className="",e.setAttribute("data-type","video"),document.getElementById("quality").className="dropdown-content",n=document.getElementById("player"),i=n.cloneNode(!0),n.parentNode.replaceChild(i,n)}function q(t){var e=t.match(/quality-(\d+)/);return e&&e[1]?parseInt(e[1],10):null}document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("app"),e=document.createElement("div");e.id="player",e.innerHTML='<video id="video" tabindex="0" poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArwAAAEsCAYAAAAhNGCdAAAAAXNSR0IArs4c6QAAELlJREFUeF7t1kERAAAIAkHpX9oeN2sDFh/sHAECBAgQIECAAIGwwMLZRCNAgAABAgQIECBwBq8nIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAAYPXDxAgQIAAAQIECKQFDN50vcIRIECAAAECBAgYvH6AAAECBAgQIEAgLWDwpusVjgABAgQIECBAwOD1AwQIECBAgAABAmkBgzddr3AECBAgQIAAAQIGrx8gQIAAAQIECBBICxi86XqFI0CAAAECBAgQMHj9AAECBAgQIECAQFrA4E3XKxwBAgQIECBAgIDB6wcIECBAgAABAgTSAgZvul7hCBAgQIAAAQIEDF4/QIAAAQIECBAgkBYweNP1CkeAAAECBAgQIGDw+gECBAgQIECAAIG0gMGbrlc4AgQIECBAgAABg9cPECBAgAABAgQIpAUM3nS9whEgQIAAAQIECBi8foAAAQIECBAgQCAtYPCm6xWOAAECBAgQIEDA4PUDBAgQIECAAAECaQGDN12vcAQIECBAgAABAgavHyBAgAABAgQIEEgLGLzpeoUjQIAAAQIECBAweP0AAQIECBAgQIBAWsDgTdcrHAECBAgQIECAgMHrBwgQIECAAAECBNICBm+6XuEIECBAgAABAgQMXj9AgAABAgQIECCQFjB40/UKR4AAAQIECBAgYPD6AQIECBAgQIAAgbSAwZuuVzgCBAgQIECAAAGD1w8QIECAAAECBAikBQzedL3CESBAgAABAgQIGLx+gAABAgQIECBAIC1g8KbrFY4AAQIECBAgQMDg9QMECBAgQIAAAQJpAYM3Xa9wBAgQIECAAAECBq8fIECAAAECBAgQSAsYvOl6hSNAgAABAgQIEDB4/QABAgQIECBAgEBawOBN1yscAQIECBAgQICAwesHCBAgQIAAAQIE0gIGb7pe4QgQIECAAAECBAxeP0CAAAECBAgQIJAWMHjT9QpHgAABAgQIECBg8PoBAgQIECBAgACBtIDBm65XOAIECBAgQIAAgQf4tAEt5FxRQwAAAABJRU5ErkJggg==" hidden></video><div id="video-controls" class="controls display-control"><button id="playpause" tabindex="0" type="button" data-state="play">Play/Pause</button><button id="back" tabindex="0" type="button" data-state="back"></button><button id="next" tabindex="0" type="button" data-state="next"></button><button id="max" tabindex="0" type="button" data-state="max"></button><button id="mute" type="button" data-state="mute">Mute/Unmute</button><div class="dropdown"><button id="quality-btn" class="dropbtn btn-settings"></button><div id="quality" class="dropdown-content"></div></div><div data-type="video" id="live-indicator" class="display_none"><span id="red-dot"></span><span id="live-text">Live</span></div><div id="time"><span id="current-time">10:11</span>/<span id="end-time">11:23</span></div><div class="progress"><progress id="progress" tabindex="0" value="0" min="0"><span id="progress-bar"></span></progress></div></div>'.trim(),t.parentNode.insertBefore(e,t.nextSibling)}));var K,J=function(t,e){return t===e},$=Symbol("solid-proxy"),tt=Symbol("solid-track"),et={equals:J},nt=Bt,it=1,rt=2,ot={owned:null,cleanups:null,context:null,owner:null},st={},at=null,ut=null,lt=null,ht=null,ct=null,ft=0;function dt(t,e){var n=lt,i=at,r=0===t.length,o=void 0===e?i:e,s=r?ot:{owned:null,cleanups:null,context:o?o.context:null,owner:o},a=r?t:function(){return t((function(){return mt((function(){return Nt(s)}))}))};at=s,lt=null;try{return zt(a,!0)}finally{lt=n,at=i}}function At(t,e){var n={value:t,observers:null,observerSlots:null,comparator:(e=e?Object.assign({},et,e):et).equals||void 0};return[It.bind(n),function(t){return"function"==typeof t&&(t=t(n.value)),Lt(n,t)}]}function gt(t,e,n){Rt(Mt(t,e,!0,it))}function pt(t,e,n){Rt(Mt(t,e,!1,it))}function vt(t,e,n){nt=Ot;var i=Mt(t,e,!1,it),r=K&&St(K);r&&(i.suspense=r),n&&n.render||(i.user=!0),ct?ct.push(i):Rt(i)}function _t(t,e,n){n=n?Object.assign({},et,n):et;var i=Mt(t,e,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=n.equals||void 0,Rt(i),It.bind(i)}function yt(t,e,n){var i,r,o;2===arguments.length&&"object"==typeof e||1===arguments.length?(i=!0,r=t,o=e||{}):(i=t,r=e,o=n||{});var s=null,a=st,u=!1,l="initialValue"in o,h="function"==typeof i&&_t(i),c=new Set,f=b((o.storage||At)(o.initialValue),2),d=f[0],A=f[1],g=b(At(void 0),2),p=g[0],v=g[1],_=b(At(void 0,{equals:!1}),2),y=_[0],x=_[1],m=b(At(l?"ready":"unresolved"),2),k=m[0],T=m[1];function C(t,e,n,i){return s===t&&(s=null,void 0!==i&&(l=!0),t!==a&&e!==a||!o.onHydrated||queueMicrotask((function(){return o.onHydrated(i,{value:e})})),a=st,function(t,e){zt((function(){void 0===e&&A((function(){return t})),T(void 0!==e?"errored":l?"ready":"unresolved"),v(e);var n,i=w(c.keys());try{for(i.s();!(n=i.n()).done;){n.value.decrement()}}catch(e){i.e(e)}finally{i.f()}c.clear()}),!1)}(e,n)),e}function S(){var t=K,e=d(),n=p();if(void 0!==n&&!s)throw n;return lt&&!lt.user&&t&&gt((function(){y(),s&&(t.resolved||c.has(t)||(t.increment(),c.add(t)))})),e}function E(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!1===t||!u){u=!1;var e=h?h():i;if(null!=e&&!1!==e){var n,o=a!==st?a:mt((function(){return r(e,{value:d(),refetching:t})}));return(n=o)&&"object"==typeof n&&"then"in n?(s=o,"value"in o?("success"===o.status?C(s,o.value,void 0,e):C(s,void 0,void 0,e),o):(u=!0,queueMicrotask((function(){return u=!1})),zt((function(){T(l?"refreshing":"pending"),x()}),!1),o.then((function(t){return C(o,t,void 0,e)}),(function(t){return C(o,void 0,Ut(t),e)})))):(C(s,o,void 0,e),o)}C(s,mt(d))}}return Object.defineProperties(S,{state:{get:function(){return k()}},error:{get:function(){return p()}},loading:{get:function(){var t=k();return"pending"===t||"refreshing"===t}},latest:{get:function(){if(!l)return S();var t=p();if(t&&!s)throw t;return d()}}}),h?gt((function(){return E(!1)})):E(!1),[S,{refetch:E,mutate:A}]}function xt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J,n=new Map,i=Mt((function(i){var r,o=t(),s=w(n.entries());try{for(s.s();!(r=s.n()).done;){var a=b(r.value,2),u=a[0],l=a[1];if(e(u,o)!==e(u,i)){var h,c=w(l.values());try{for(c.s();!(h=c.n()).done;){var f=h.value;f.state=it,f.pure?ht.push(f):ct.push(f)}}catch(d){c.e(d)}finally{c.f()}}}}catch(d){s.e(d)}finally{s.f()}return o}),void 0,!0,it);return Rt(i),function(t){var r,o=lt;o&&((r=n.get(t))?r.add(o):n.set(t,r=new Set([o])),Tt((function(){r.delete(o),!r.size&&n.delete(t)})));return e(t,i.value)}}function mt(t){if(null===lt)return t();var e=lt;lt=null;try{return t()}finally{lt=e}}function kt(t,e,n){var i,r=Array.isArray(t),o=n&&n.defer;return function(n){var s;if(r){s=Array(t.length);for(var a=0;a<t.length;a++)s[a]=t[a]()}else s=t();if(!o){var u=mt((function(){return e(s,i,n)}));return i=s,u}o=!1}}function Tt(t){return null===at||(null===at.cleanups?at.cleanups=[t]:at.cleanups.push(t)),t}function bt(){return at}function wt(t){var e=lt,n=at;return Promise.resolve().then((function(){lt=e,at=n,zt(t,!1),lt=at=null}))}function Ct(t,e){var n=Symbol("context");return{id:n,Provider:Wt(n),defaultValue:t}}function St(t){return at&&at.context&&void 0!==at.context[t.id]?at.context[t.id]:t.defaultValue}function Et(t){var e=_t(t),n=_t((function(){return Ht(e())}));return n.toArray=function(){var t=n();return Array.isArray(t)?t:null!=t?[t]:[]},n}function It(){var t=this;if(this.sources&&this.state)if(this.state===it)Rt(this);else{var e=ht;ht=null,zt((function(){return Dt(t)}),!1),ht=e}if(lt){var n=this.observers?this.observers.length:0;lt.sources?(lt.sources.push(this),lt.sourceSlots.push(n)):(lt.sources=[this],lt.sourceSlots=[n]),this.observers?(this.observers.push(lt),this.observerSlots.push(lt.sources.length-1)):(this.observers=[lt],this.observerSlots=[lt.sources.length-1])}return this.value}function Lt(t,e,n){var i=t.value;return t.comparator&&t.comparator(i,e)||(t.value=e,t.observers&&t.observers.length&&zt((function(){for(var e=0;e<t.observers.length;e+=1){var n=t.observers[e],i=ut&&ut.running;i&&ut.disposed.has(n),(i?n.tState:n.state)||(n.pure?ht.push(n):ct.push(n),n.observers&&Ft(n)),i||(n.state=it)}if(ht.length>1e6)throw ht=[],new Error}),!1)),e}function Rt(t){if(t.fn){Nt(t);var e=ft;!function(t,e,n){var i,r=at,o=lt;lt=at=t;try{i=t.fn(e)}catch(s){return t.pure&&(t.state=it,t.owned&&t.owned.forEach(Nt),t.owned=null),t.updatedAt=n+1,jt(s)}finally{lt=o,at=r}(!t.updatedAt||t.updatedAt<=n)&&(null!=t.updatedAt&&"observers"in t?Lt(t,i):t.value=i,t.updatedAt=n)}(t,t.value,e)}}function Mt(t,e,n){var i={fn:t,state:arguments.length>3&&void 0!==arguments[3]?arguments[3]:it,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:at,context:at?at.context:null,pure:n};return null===at||at!==ot&&(at.owned?at.owned.push(i):at.owned=[i]),i}function Pt(t){if(0!==t.state){if(t.state===rt)return Dt(t);if(t.suspense&&mt(t.suspense.inFallback))return t.suspense.effects.push(t);for(var e=[t];(t=t.owner)&&(!t.updatedAt||t.updatedAt<ft);)t.state&&e.push(t);for(var n=e.length-1;n>=0;n--)if((t=e[n]).state===it)Rt(t);else if(t.state===rt){var i=ht;ht=null,zt((function(){return Dt(t,e[0])}),!1),ht=i}}}function zt(t,e){if(ht)return t();var n=!1;e||(ht=[]),ct?n=!0:ct=[],ft++;try{var i=t();return function(t){ht&&(Bt(ht),ht=null);if(t)return;var e=ct;ct=null,e.length&&zt((function(){return nt(e)}),!1)}(n),i}catch(r){n||(ct=null),ht=null,jt(r)}}function Bt(t){for(var e=0;e<t.length;e++)Pt(t[e])}function Ot(t){var e,n=0;for(e=0;e<t.length;e++){var i=t[e];i.user?t[n++]=i:Pt(i)}for(e=0;e<n;e++)Pt(t[e])}function Dt(t,e){t.state=0;for(var n=0;n<t.sources.length;n+=1){var i=t.sources[n];if(i.sources){var r=i.state;r===it?i!==e&&(!i.updatedAt||i.updatedAt<ft)&&Pt(i):r===rt&&Dt(i,e)}}}function Ft(t){for(var e=0;e<t.observers.length;e+=1){var n=t.observers[e];n.state||(n.state=rt,n.pure?ht.push(n):ct.push(n),n.observers&&Ft(n))}}function Nt(t){var e;if(t.sources)for(;t.sources.length;){var n=t.sources.pop(),i=t.sourceSlots.pop(),r=n.observers;if(r&&r.length){var o=r.pop(),s=n.observerSlots.pop();i<r.length&&(o.sourceSlots[s]=i,r[i]=o,n.observerSlots[i]=s)}}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Nt(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Ut(t){return t instanceof Error?t:new Error("string"==typeof t?t:"Unknown error",{cause:t})}function jt(t){throw Ut(t)}function Ht(t){if("function"==typeof t&&!t.length)return Ht(t());if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++){var i=Ht(t[n]);Array.isArray(i)?e.push.apply(e,i):e.push(i)}return e}return t}function Wt(t,e){return function(e){var n;return pt((function(){return n=mt((function(){return at.context=m(m({},at.context),{},k({},t,e.value)),Et((function(){return e.children}))}))}),void 0),n}}var Qt=Symbol("fallback");function Gt(t){for(var e=0;e<t.length;e++)t[e]()}function Yt(t,e){return mt((function(){return t(e||{})}))}function Xt(){return!0}var Vt={get:function(t,e,n){return e===$?n:t.get(e)},has:function(t,e){return e===$||t.has(e)},set:Xt,deleteProperty:Xt,getOwnPropertyDescriptor:function(t,e){return{configurable:!0,enumerable:!0,get:function(){return t.get(e)},set:Xt,deleteProperty:Xt}},ownKeys:function(t){return t.keys()}};function Zt(t){return(t="function"==typeof t?t():t)?t:{}}function qt(){for(var t=0,e=this.length;t<e;++t){var n=this[t]();if(void 0!==n)return n}}function Kt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=!1,r=0;r<e.length;r++){var o=e[r];i=i||!!o&&$ in o,e[r]="function"==typeof o?(i=!0,_t(o)):o}if(i)return new Proxy({get:function(t){for(var n=e.length-1;n>=0;n--){var i=Zt(e[n])[t];if(void 0!==i)return i}},has:function(t){for(var n=e.length-1;n>=0;n--)if(t in Zt(e[n]))return!0;return!1},keys:function(){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,y(Object.keys(Zt(e[n]))));return y(new Set(t))}},Vt);for(var s={},a={},u=new Set,l=e.length-1;l>=0;l--){var h=e[l];if(h)for(var c=Object.getOwnPropertyNames(h),f=function(){var t=c[d];if("__proto__"===t||"constructor"===t)return 1;var e=Object.getOwnPropertyDescriptor(h,t);if(u.has(t)){var n=a[t];n?e.get?n.push(e.get.bind(h)):void 0!==e.value&&n.push((function(){return e.value})):void 0===s[t]&&(s[t]=e.value)}else e.get?(u.add(t),Object.defineProperty(s,t,{enumerable:!0,configurable:!0,get:qt.bind(a[t]=[e.get.bind(h)])})):(void 0!==e.value&&u.add(t),s[t]=e.value)},d=0,A=c.length;d<A;d++)f()}return s}var Jt=function(t){return"Stale read from <".concat(t,">.")};function $t(t){var e="fallback"in t&&{fallback:function(){return t.fallback}};return _t(function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[],r=[],o=[],s=0,a=e.length>1?[]:null;return Tt((function(){return Gt(o)})),function(){var u,l,h=t()||[];return h[tt],mt((function(){var t,e,f,d,A,g,p,v,_,y=h.length;if(0===y)0!==s&&(Gt(o),o=[],i=[],r=[],s=0,a&&(a=[])),n.fallback&&(i=[Qt],r[0]=dt((function(t){return o[0]=t,n.fallback()})),s=1);else if(0===s){for(r=new Array(y),l=0;l<y;l++)i[l]=h[l],r[l]=dt(c);s=y}else{for(f=new Array(y),d=new Array(y),a&&(A=new Array(y)),g=0,p=Math.min(s,y);g<p&&i[g]===h[g];g++);for(p=s-1,v=y-1;p>=g&&v>=g&&i[p]===h[v];p--,v--)f[v]=r[p],d[v]=o[p],a&&(A[v]=a[p]);for(t=new Map,e=new Array(v+1),l=v;l>=g;l--)_=h[l],u=t.get(_),e[l]=void 0===u?-1:u,t.set(_,l);for(u=g;u<=p;u++)_=i[u],void 0!==(l=t.get(_))&&-1!==l?(f[l]=r[u],d[l]=o[u],a&&(A[l]=a[u]),l=e[l],t.set(_,l)):o[u]();for(l=g;l<y;l++)l in f?(r[l]=f[l],o[l]=d[l],a&&(a[l]=A[l],a[l](l))):r[l]=dt(c);r=r.slice(0,s=y),i=h.slice(0)}return r}));function c(t){if(o[l]=t,a){var n=b(At(l),2),i=n[0],r=n[1];return a[l]=r,e(h[l],i)}return e(h[l])}}}((function(){return t.each}),t.children,e||void 0))}function te(t){var e=t.keyed,n=_t((function(){return t.when}),void 0,{equals:function(t,n){return e?t===n:!t==!n}});return _t((function(){var i=n();if(i){var r=t.children;return"function"==typeof r&&r.length>0?mt((function(){return r(e?i:function(){if(!mt(n))throw Jt("Show");return t.when})})):r}return t.fallback}),void 0,void 0)}var ee,ne=b(At(null),2),ie=ne[0],re=ne[1],oe=v((function t(e){_(this,t),k(this,"releaseCallback",void 0),this.releaseCallback=e})),se=function(t){l(n,t);var e=c(n);function n(t,i){var r,o,s;return _(this,n),k(d(s=e.call(this,t)),"textureMap",new Map),k(d(s),"zeroReferenceTextureSet",new Set),k(d(s),"options",void 0),s.options={textureCleanupIntervalMs:null!==(r=i.textureCleanupIntervalMs)&&void 0!==r?r:1e4,textureCleanupAgeThreadholdMs:null!==(o=i.textureCleanupAgeThreadholdMs)&&void 0!==o?o:6e4},setInterval((function(){var t,e=Date.now(),n=s.options.textureCleanupAgeThreadholdMs,i=w(s.zeroReferenceTextureSet);try{for(i.s();!(t=i.n()).done;){var r=t.value;e-r.lastUpdate>n&&(s.releaseCallback(r.id),s.textureMap.delete(r.id),s.zeroReferenceTextureSet.delete(r))}}catch(o){i.e(o)}finally{i.f()}}),s.options.textureCleanupIntervalMs),s}return v(n,[{key:"registerTexture",value:function(t){var e,n=null===(e=t.options)||void 0===e?void 0:e.id;if(o(n,"Texture must have an id to be registered"),!this.textureMap.has(n)){var i={id:n,nodeRefCount:0,lastUpdate:Date.now()};this.textureMap.set(n,i),this.zeroReferenceTextureSet.add(i)}}},{key:"incrementTextureRefCount",value:function(t){var e,n=null===(e=t.options)||void 0===e?void 0:e.id;o(n,"Texture must have an id to be registered");var i=this.textureMap.get(n);i||(this.registerTexture(t),i=this.textureMap.get(n)),o(i,"Texture must have been registered"),"SubTexture"===t.txType&&this.incrementTextureRefCount(t.props.texture),i.nodeRefCount++,i.lastUpdate=Date.now(),this.zeroReferenceTextureSet.has(i)&&this.zeroReferenceTextureSet.delete(i)}},{key:"decrementTextureRefCount",value:function(t){var e,n=null===(e=t.options)||void 0===e?void 0:e.id;o(n,"Texture must have an id to be registered");var i=this.textureMap.get(n);o(i,"Texture must have been registered"),i.nodeRefCount--,i.lastUpdate=Date.now(),0===i.nodeRefCount&&this.zeroReferenceTextureSet.add(i),"SubTexture"===t.txType&&this.decrementTextureRefCount(t.props.texture)}}]),n}(oe),ae=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),k(d(i=e.call(this,t)),"registry",void 0),i.registry=new FinalizationRegistry(t),i}return v(n,[{key:"registerTexture",value:function(t){var e,n;o(null===(e=t.options)||void 0===e?void 0:e.id,"Texture must have an ID to be registered"),this.registry.register(t,null===(n=t.options)||void 0===n?void 0:n.id)}},{key:"incrementTextureRefCount",value:function(){}},{key:"decrementTextureRefCount",value:function(){}}]),n}(oe),ue=function(t){l(i,t);var e,n=c(i);function i(t,e,r){var o,s,a;_(this,i),k(d(a=n.call(this)),"root",null),k(d(a),"driver",void 0),k(d(a),"canvas",void 0),k(d(a),"settings",void 0),k(d(a),"nodes",new Map),k(d(a),"nextTextureId",1),k(d(a),"textureTracker",void 0);var u={appWidth:t.appWidth||1920,appHeight:t.appHeight||1080,deviceLogicalPixelRatio:t.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:t.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:null!==(o=t.clearColor)&&void 0!==o?o:0,coreExtensionModule:t.coreExtensionModule||null,experimental_FinalizationRegistryTextureUsageTracker:null!==(s=t.experimental_FinalizationRegistryTextureUsageTracker)&&void 0!==s&&s,textureCleanupOptions:t.textureCleanupOptions||{},fpsUpdateInterval:t.fpsUpdateInterval||0};a.settings=u;var l=u.appWidth,h=u.appHeight,c=u.deviceLogicalPixelRatio,f=u.devicePhysicalPixelRatio,A=function(t){a.driver.releaseTexture(t)},g=u.experimental_FinalizationRegistryTextureUsageTracker&&"function"==typeof FinalizationRegistry;a.textureTracker=g?new ae(A):new se(A,a.settings.textureCleanupOptions);var p=l*c,v=h*c;a.driver=r;var y,x=document.createElement("canvas");if(a.canvas=x,x.width=p*f,x.height=v*f,x.style.width="".concat(p,"px"),x.style.height="".concat(v,"px"),!(y="string"==typeof e?document.getElementById(e):e))throw new Error("Could not find target element");return r.onCreateNode=function(t){a.nodes.set(t.id,t)},r.onBeforeDestroyNode=function(t){a.nodes.delete(t.id)},r.onFpsUpdate=function(t){a.emit("fpsUpdate",t)},y.appendChild(x),a}return v(i,[{key:"init",value:(e=u(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.driver.init(this,this.settings,this.canvas);case 2:this.root=this.driver.getRootNode();case 3:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"createNode",value:function(t){return this.driver.createNode(this.resolveNodeDefaults(t))}},{key:"createTextNode",value:function(t){var e,n,i,r,o,s,a,u,l,h,c,f,d,A;return this.driver.createTextNode(m(m({},this.resolveNodeDefaults(t)),{},{text:null!==(e=t.text)&&void 0!==e?e:"",textRendererOverride:null!==(n=t.textRendererOverride)&&void 0!==n?n:null,fontSize:null!==(i=t.fontSize)&&void 0!==i?i:16,fontFamily:null!==(r=t.fontFamily)&&void 0!==r?r:"sans-serif",fontStyle:null!==(o=t.fontStyle)&&void 0!==o?o:"normal",fontWeight:null!==(s=t.fontWeight)&&void 0!==s?s:"normal",fontStretch:null!==(a=t.fontStretch)&&void 0!==a?a:"normal",textAlign:null!==(u=t.textAlign)&&void 0!==u?u:"left",contain:null!==(l=t.contain)&&void 0!==l?l:"none",scrollable:null!==(h=t.scrollable)&&void 0!==h&&h,scrollY:null!==(c=t.scrollY)&&void 0!==c?c:0,offsetY:null!==(f=t.offsetY)&&void 0!==f?f:0,letterSpacing:null!==(d=t.letterSpacing)&&void 0!==d?d:0,debug:null!==(A=t.debug)&&void 0!==A?A:{}}))}},{key:"resolveNodeDefaults",value:function(t){var e,n,i,r,o,s,a,u,l,h,c,f,d,A,g,p,v,_,y,x,m,k,T,b,w,C,S,E,I,L,R,M,P,z,B,O,D,F,N,U,j,H,W,Q,G,Y=null!==(e=t.color)&&void 0!==e?e:4294967295,X=null!==(n=null!==(i=null!==(r=t.colorTl)&&void 0!==r?r:t.colorTop)&&void 0!==i?i:t.colorLeft)&&void 0!==n?n:Y,V=null!==(o=null!==(s=null!==(a=t.colorTr)&&void 0!==a?a:t.colorTop)&&void 0!==s?s:t.colorRight)&&void 0!==o?o:Y,Z=null!==(u=null!==(l=null!==(h=t.colorBl)&&void 0!==h?h:t.colorBottom)&&void 0!==l?l:t.colorLeft)&&void 0!==u?u:Y,q=null!==(c=null!==(f=null!==(d=t.colorBr)&&void 0!==d?d:t.colorBottom)&&void 0!==f?f:t.colorRight)&&void 0!==c?c:Y;return{x:null!==(A=t.x)&&void 0!==A?A:0,y:null!==(g=t.y)&&void 0!==g?g:0,width:null!==(p=t.width)&&void 0!==p?p:0,height:null!==(v=t.height)&&void 0!==v?v:0,alpha:null!==(_=t.alpha)&&void 0!==_?_:1,clipping:null!==(y=t.clipping)&&void 0!==y&&y,color:Y,colorTop:null!==(x=t.colorTop)&&void 0!==x?x:Y,colorBottom:null!==(m=t.colorBottom)&&void 0!==m?m:Y,colorLeft:null!==(k=t.colorLeft)&&void 0!==k?k:Y,colorRight:null!==(T=t.colorRight)&&void 0!==T?T:Y,colorBl:Z,colorBr:q,colorTl:X,colorTr:V,zIndex:null!==(b=t.zIndex)&&void 0!==b?b:0,zIndexLocked:null!==(w=t.zIndexLocked)&&void 0!==w?w:0,parent:null!==(C=t.parent)&&void 0!==C?C:null,texture:null!==(S=t.texture)&&void 0!==S?S:null,shader:null!==(E=t.shader)&&void 0!==E?E:null,src:null!==(I=t.src)&&void 0!==I?I:"",scale:null!==(L=t.scale)&&void 0!==L?L:null,scaleX:null!==(R=null!==(M=t.scaleX)&&void 0!==M?M:t.scale)&&void 0!==R?R:1,scaleY:null!==(P=null!==(z=t.scaleY)&&void 0!==z?z:t.scale)&&void 0!==P?P:1,mount:null!==(B=t.mount)&&void 0!==B?B:0,mountX:null!==(O=null!==(D=t.mountX)&&void 0!==D?D:t.mount)&&void 0!==O?O:0,mountY:null!==(F=null!==(N=t.mountY)&&void 0!==N?N:t.mount)&&void 0!==F?F:0,pivot:null!==(U=t.pivot)&&void 0!==U?U:.5,pivotX:null!==(j=null!==(H=t.pivotX)&&void 0!==H?H:t.pivot)&&void 0!==j?j:.5,pivotY:null!==(W=null!==(Q=t.pivotY)&&void 0!==Q?Q:t.pivot)&&void 0!==W?W:.5,rotation:null!==(G=t.rotation)&&void 0!==G?G:0}}},{key:"destroyNode",value:function(t){return this.driver.destroyNode(t)}},{key:"createTexture",value:function(t,e,n){var i=this.nextTextureId++,r={descType:"texture",txType:t,props:e,options:m(m({},n),{},{id:i})};return this.textureTracker.registerTexture(r),r}},{key:"createShader",value:function(t,e){return{descType:"shader",shType:t,props:e}}},{key:"getNodeById",value:function(t){return this.nodes.get(t)||null}},{key:"toggleFreeze",value:function(){throw new Error("Not implemented")}},{key:"advanceFrame",value:function(){throw new Error("Not implemented")}},{key:"rerender",value:function(){throw new Error("Not implemented")}}]),i}(a),le=function(t){l(n,t);var e=c(n);function n(t,i,r){var o;return _(this,n),k(d(o=e.call(this)),"node",void 0),k(d(o),"props",void 0),k(d(o),"settings",void 0),k(d(o),"propStartValues",{}),k(d(o),"restoreValues",{}),k(d(o),"progress",0),k(d(o),"timingFunction",void 0),k(d(o),"propsList",void 0),o.node=t,o.props=i,o.settings=r,o.propStartValues={},o.propsList=Object.keys(i),o.propsList.forEach((function(e){o.propStartValues[e]=t[e]})),o.timingFunction=function(t){return t},r.easing&&"string"==typeof r.easing&&(o.timingFunction=h(r.easing)),o}return v(n,[{key:"reset",value:function(){this.progress=0,this.update(0)}},{key:"restore",value:function(){var t=this;this.reset(),Object.keys(this.props).forEach((function(e){t.node[e]=t.propStartValues[e]}))}},{key:"reverse",value:function(){var t=this;this.progress=0,Object.keys(this.props).forEach((function(e){var n=t.props[e],i=t.propStartValues[e];t.props[e]=i,t.propStartValues[e]=n})),this.settings.loop||(this.settings.stopMethod=!1)}},{key:"applyEasing",value:function(t,e,n){return(this.timingFunction(t)||t)*(n-e)+e}},{key:"update",value:function(t){var e=this.settings,n=e.duration,i=e.loop,r=e.easing,o=e.stopMethod;if(n)if(this.progress+=t/n,this.progress>1&&(this.progress=i?0:1,o))this.emit("finished",{});else{for(var s=0;s<this.propsList.length;s++){var a=this.propsList[s],u=this.props[a],l=this.propStartValues[a],h=u;if(-1===a.indexOf("color"))this.node[a]=r?this.applyEasing(this.progress,l,h):l+(h-l)*this.progress;else{if(l===h){this.node[a]=l;continue}if(r){var c=this.timingFunction(this.progress)||this.progress,f=A(l,h,c);this.node[a]=f;continue}this.node[a]=A(l,h,this.progress)}}1===this.progress&&this.emit("finished",{})}else this.emit("finished",{})}}]),n}(a),he=function(){function t(e,n){_(this,t),k(this,"manager",void 0),k(this,"animation",void 0),k(this,"stoppedPromise",null),k(this,"stoppedResolve",null),k(this,"state",void 0),this.manager=e,this.animation=n,this.state="stopped"}return v(t,[{key:"start",value:function(){return this.makeStoppedPromise(),this.animation.once("finished",this.finished.bind(this)),this.manager.activeAnimations.has(this.animation)||this.manager.registerAnimation(this.animation),this.state="running",this}},{key:"stop",value:function(){return this.manager.unregisterAnimation(this.animation),null!==this.stoppedResolve&&(this.stoppedResolve(),this.stoppedResolve=null),this.animation.reset(),this.state="stopped",this}},{key:"pause",value:function(){return this.manager.unregisterAnimation(this.animation),this.state="paused",this}},{key:"restore",value:function(){return this.stoppedResolve=null,this.animation.restore(),this}},{key:"waitUntilStopped",value:function(){this.makeStoppedPromise();var t=this.stoppedPromise;return o(t),t}},{key:"makeStoppedPromise",value:function(){var t=this;null===this.stoppedResolve&&(this.stoppedPromise=new Promise((function(e){t.stoppedResolve=e})))}},{key:"finished",value:function(){o(this.stoppedResolve);var t=this.animation.settings,e=t.loop;if("reverse"===t.stopMethod)return this.animation.reverse(),void this.start();this.stoppedResolve(),this.stoppedResolve=null,e||this.manager.unregisterAnimation(this.animation)}}]),t}(),ce=function(){function t(e){_(this,t),k(this,"data",void 0),e?(this.data=new Float32Array(9),this.data[0]=e[0],this.data[3]=e[3],this.data[6]=e[6],this.data[1]=e[1],this.data[4]=e[4],this.data[7]=e[7],this.data[2]=e[2],this.data[5]=e[5],this.data[8]=e[8]):this.data=new Float32Array(9)}return v(t,[{key:"translate",value:function(t,e){return this.data[6]=this.data[0]*t+this.data[3]*e+this.data[6],this.data[7]=this.data[1]*t+this.data[4]*e+this.data[7],this}},{key:"scale",value:function(t,e){return this.data[0]=this.data[0]*t,this.data[3]=this.data[3]*e,this.data[1]=this.data[1]*t,this.data[4]=this.data[4]*e,this}},{key:"rotate",value:function(t){if(0===t||!(t%Math.PI*2))return this;var e=Math.cos(t),n=Math.sin(t),i=this.data[0]*e+this.data[3]*n,r=this.data[3]*e-this.data[0]*n,o=this.data[1]*e+this.data[4]*n,s=this.data[4]*e-this.data[1]*n;return this.data[0]=i,this.data[3]=r,this.data[1]=o,this.data[4]=s,this}},{key:"multiply",value:function(e){return t.multiply(this,e,this)}},{key:"tx",get:function(){return this.data[6]}},{key:"ty",get:function(){return this.data[7]}},{key:"ta",get:function(){return this.data[0]}},{key:"tb",get:function(){return this.data[3]}},{key:"tc",get:function(){return this.data[1]}},{key:"td",get:function(){return this.data[4]}},{key:"transformPoint",value:function(t,e){return[this.data[0]*t+this.data[3]*e+this.data[6],this.data[1]*t+this.data[4]*e+this.data[1]]}}],[{key:"temp",get:function(){return fe}},{key:"multiply",value:function(e,n,i){var r=e.data[0]*n.data[0]+e.data[3]*n.data[1]+e.data[6]*n.data[2],o=e.data[0]*n.data[3]+e.data[3]*n.data[4]+e.data[6]*n.data[5],s=e.data[0]*n.data[6]+e.data[3]*n.data[7]+e.data[6]*n.data[8],a=e.data[1]*n.data[0]+e.data[4]*n.data[1]+e.data[7]*n.data[2],u=e.data[1]*n.data[3]+e.data[4]*n.data[4]+e.data[7]*n.data[5],l=e.data[1]*n.data[6]+e.data[4]*n.data[7]+e.data[7]*n.data[8],h=e.data[2]*n.data[0]+e.data[5]*n.data[1]+e.data[8]*n.data[2],c=e.data[2]*n.data[3]+e.data[5]*n.data[4]+e.data[8]*n.data[5],f=e.data[2]*n.data[6]+e.data[5]*n.data[7]+e.data[8]*n.data[8];return i||(i=new t),i.data[0]=r,i.data[3]=o,i.data[6]=s,i.data[1]=a,i.data[4]=u,i.data[7]=l,i.data[2]=h,i.data[5]=c,i.data[8]=f,i}},{key:"identity",value:function(e){return e||(e=new t),e.data[0]=1,e.data[3]=0,e.data[6]=0,e.data[1]=0,e.data[4]=1,e.data[7]=0,e.data[2]=0,e.data[5]=0,e.data[8]=1,e}},{key:"translate",value:function(e,n,i){return i||(i=new t),i.data[0]=1,i.data[3]=0,i.data[6]=e,i.data[1]=0,i.data[4]=1,i.data[7]=n,i.data[2]=0,i.data[5]=0,i.data[8]=1,i}},{key:"scale",value:function(e,n,i){return i||(i=new t),i.data[0]=e,i.data[3]=0,i.data[6]=0,i.data[1]=0,i.data[4]=n,i.data[7]=0,i.data[2]=0,i.data[5]=0,i.data[8]=1,i}},{key:"rotate",value:function(e,n){var i=Math.cos(e),r=Math.sin(e);return n||(n=new t),n.data[0]=i,n.data[3]=-r,n.data[6]=0,n.data[1]=r,n.data[4]=i,n.data[7]=0,n.data[2]=0,n.data[5]=0,n.data[8]=1,n}},{key:"copy",value:function(e,n,i){return n||(n=new t),n.data[0]=e.data[0],n.data[1]=e.data[1],n.data[2]=e.data[2],n.data[3]=e.data[3],n.data[4]=e.data[4],n.data[5]=e.data[5],n.data[6]=e.data[6],n.data[7]=e.data[7],n.data[8]=e.data[8],n}}]),t}(),fe=new ce;!function(t){t[t.Children=1]="Children",t[t.ScaleRotate=2]="ScaleRotate",t[t.Local=4]="Local",t[t.Global=8]="Global",t[t.Clipping=16]="Clipping",t[t.CalculatedZIndex=32]="CalculatedZIndex",t[t.ZIndexSortedChildren=64]="ZIndexSortedChildren",t[t.PremultipliedColors=128]="PremultipliedColors",t[t.WorldAlpha=256]="WorldAlpha",t[t.None=0]="None",t[t.All=511]="All"}(ee||(ee={}));var de=function(t){l(n,t);var e=c(n);function n(t,i){var r;return _(this,n),k(d(r=e.call(this)),"stage",void 0),k(d(r),"children",[]),k(d(r),"props",void 0),k(d(r),"updateType",ee.All),k(d(r),"globalTransform",void 0),k(d(r),"scaleRotateTransform",void 0),k(d(r),"localTransform",void 0),k(d(r),"clippingRect",null),k(d(r),"isRenderable",!1),k(d(r),"parentClippingRect",null),k(d(r),"worldAlpha",1),k(d(r),"premultipliedColorTl",0),k(d(r),"premultipliedColorTr",0),k(d(r),"premultipliedColorBl",0),k(d(r),"premultipliedColorBr",0),k(d(r),"calcZIndex",0),k(d(r),"isComplex",!1),k(d(r),"onTextureLoaded",(function(t,e){r.stage.requestRender(),r.emit("loaded",{type:"texture",dimensions:e})})),k(d(r),"onTextureFailed",(function(t,e){r.emit("failed",{type:"texture",error:e})})),r.stage=t,r.props=m(m({},i),{},{parent:null}),r.parent=i.parent,r.updateScaleRotateTransform(),r}return v(n,[{key:"loadTexture",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.props.texture&&this.unloadTexture();var r=this.stage.txManager.loadTexture(t,e,i);this.props.texture=r,this.props.textureOptions=i,this.checkIsRenderable(),queueMicrotask((function(){"loaded"===r.state?n.onTextureLoaded(r,r.dimensions):"failed"===r.state&&n.onTextureFailed(r,r.error),r.on("loaded",n.onTextureLoaded),r.on("failed",n.onTextureFailed)}))}},{key:"unloadTexture",value:function(){this.props.texture&&(this.props.texture.off("loaded",this.onTextureLoaded),this.props.texture.off("failed",this.onTextureFailed)),this.props.texture=null,this.props.textureOptions=null,this.checkIsRenderable()}},{key:"loadShader",value:function(t,e){var n=this.stage.renderer.getShaderManager();o(n);var i=n.loadShader(t,e),r=i.shader,s=i.props;this.props.shader=r,this.props.shaderProps=s,this.checkIsRenderable()}},{key:"setUpdateType",value:function(t){this.updateType|=t;var e=this.props.parent;!e||e.updateType&ee.Children||e.setUpdateType(ee.Children)}},{key:"sortChildren",value:function(){this.children.sort((function(t,e){return t.calcZIndex-e.calcZIndex}))}},{key:"updateScaleRotateTransform",value:function(){this.scaleRotateTransform=ce.rotate(this.props.rotation,this.scaleRotateTransform).scale(this.props.scaleX,this.props.scaleY)}},{key:"updateLocalTransform",value:function(){o(this.scaleRotateTransform);var t=this.props.pivotX*this.props.width,e=this.props.pivotY*this.props.height,n=this.props.mountX*this.props.width,i=this.props.mountY*this.props.height;this.localTransform=ce.translate(t-n+this.props.x,e-i+this.props.y,this.localTransform).multiply(this.scaleRotateTransform).translate(-t,-e),this.setUpdateType(ee.Global)}},{key:"update",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.updateType&ee.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(ee.Local)),this.updateType&ee.Local&&(this.updateLocalTransform(),this.setUpdateType(ee.Global));var i=this.props.parent,r=ee.None;this.updateType&ee.Global&&(o(this.localTransform),this.globalTransform=ce.copy((null==i?void 0:i.globalTransform)||this.localTransform,this.globalTransform),i&&this.globalTransform.multiply(this.localTransform),this.setUpdateType(ee.Clipping|ee.Children),r|=ee.Global),this.updateType&ee.Clipping&&(this.calculateClippingRect(n),this.checkIsRenderable(),this.setUpdateType(ee.Children),r|=ee.Clipping),this.updateType&ee.WorldAlpha&&(this.worldAlpha=i?i.worldAlpha*this.props.alpha:this.props.alpha,this.setUpdateType(ee.Children|ee.PremultipliedColors),r|=ee.WorldAlpha),this.updateType&ee.PremultipliedColors&&(this.premultipliedColorTl=p(this.props.colorTl,this.worldAlpha,!0),this.premultipliedColorTr=p(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=p(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=p(this.props.colorBr,this.worldAlpha,!0),this.checkIsRenderable(),this.setUpdateType(ee.Children),r|=ee.PremultipliedColors),i&&this.updateType&ee.CalculatedZIndex&&(this.calculateZIndex(),i.setUpdateType(ee.ZIndexSortedChildren)),this.updateType&ee.Children&&this.children.length&&this.children.forEach((function(n){n.setUpdateType(r),0!==n.updateType&&n.update(t,e.clippingRect)})),this.updateType&ee.ZIndexSortedChildren&&this.sortChildren(),this.updateType=0}},{key:"checkIsRenderable",value:function(){var t=this;if(this.props.texture)return this.isRenderable=!0;if(this.props.shader)return this.isRenderable=!0;if(this.props.clipping)return this.isRenderable=!0;return["color","colorTop","colorBottom","colorLeft","colorRight","colorTl","colorTr","colorBl","colorBr"].some((function(e){return 0!==t.props[e]}))?this.isRenderable=!0:this.isRenderable=!1}},{key:"calculateClippingRect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(o(this.globalTransform),this.parentClippingRect!==t||!this.clippingRect){var e=this.globalTransform,n=0!==e.tb||0!==e.tc,i=this.props.clipping&&!n?{x:e.tx,y:e.ty,width:this.width*e.ta,height:this.height*e.td}:null;t&&i?i=x(t,i):t&&(i=t),this.parentClippingRect=t,this.clippingRect=i}}},{key:"calculateZIndex",value:function(){var t,e,n=this.props,i=n.zIndex||0,r=(null===(t=n.parent)||void 0===t?void 0:t.zIndex)||0,o=i;null!==(e=n.parent)&&void 0!==e&&e.zIndexLocked&&(o=i<r?i:r),this.calcZIndex=o}},{key:"renderQuads",value:function(t){var e=this.props,n=e.width,i=e.height,r=e.texture,s=e.textureOptions,a=e.shader,u=e.shaderProps,l=this.premultipliedColorTl,h=this.premultipliedColorTr,c=this.premultipliedColorBl,f=this.premultipliedColorBr,d=this.zIndex,A=this.worldAlpha,g=this.globalTransform,p=this.clippingRect;o(g),t.addQuad({width:n,height:i,colorTl:l,colorTr:h,colorBl:c,colorBr:f,texture:r,textureOptions:s,zIndex:d,shader:a,shaderProps:u,alpha:A,clippingRect:p,tx:g.tx,ty:g.ty,ta:g.ta,tb:g.tb,tc:g.tc,td:g.td})}},{key:"id",get:function(){return this.props.id}},{key:"x",get:function(){return this.props.x},set:function(t){this.props.x!==t&&(this.props.x=t,this.setUpdateType(ee.Local))}},{key:"absX",get:function(){var t,e;return this.props.x+((null===(t=this.props.parent)||void 0===t?void 0:t.absX)||(null===(e=this.props.parent)||void 0===e||null===(e=e.globalTransform)||void 0===e?void 0:e.tx)||0)}},{key:"absY",get:function(){var t,e;return this.props.y+(null!==(t=null===(e=this.props.parent)||void 0===e?void 0:e.absY)&&void 0!==t?t:0)}},{key:"y",get:function(){return this.props.y},set:function(t){this.props.y!==t&&(this.props.y=t,this.setUpdateType(ee.Local))}},{key:"width",get:function(){return this.props.width},set:function(t){this.props.width!==t&&(this.props.width=t,this.setUpdateType(ee.Local))}},{key:"height",get:function(){return this.props.height},set:function(t){this.props.height!==t&&(this.props.height=t,this.setUpdateType(ee.Local))}},{key:"scale",get:function(){return this.scaleX},set:function(t){this.scaleX=t,this.scaleY=t}},{key:"scaleX",get:function(){return this.props.scaleX},set:function(t){this.props.scaleX!==t&&(this.props.scaleX=t,this.setUpdateType(ee.ScaleRotate))}},{key:"scaleY",get:function(){return this.props.scaleY},set:function(t){this.props.scaleY!==t&&(this.props.scaleY=t,this.setUpdateType(ee.ScaleRotate))}},{key:"mount",get:function(){return this.props.mount},set:function(t){this.props.mountX===t&&this.props.mountY===t||(this.props.mountX=t,this.props.mountY=t,this.props.mount=t,this.setUpdateType(ee.Local))}},{key:"mountX",get:function(){return this.props.mountX},set:function(t){this.props.mountX!==t&&(this.props.mountX=t,this.setUpdateType(ee.Local))}},{key:"mountY",get:function(){return this.props.mountY},set:function(t){this.props.mountY!==t&&(this.props.mountY=t,this.setUpdateType(ee.Local))}},{key:"pivot",get:function(){return this.props.pivot},set:function(t){this.props.pivotX===t&&this.props.pivotY===t||(this.props.pivotX=t,this.props.pivotY=t,this.props.pivot=t,this.setUpdateType(ee.Local))}},{key:"pivotX",get:function(){return this.props.pivotX},set:function(t){this.props.pivotX!==t&&(this.props.pivotX=t,this.setUpdateType(ee.Local))}},{key:"pivotY",get:function(){return this.props.pivotY},set:function(t){this.props.pivotY!==t&&(this.props.pivotY=t,this.setUpdateType(ee.Local))}},{key:"rotation",get:function(){return this.props.rotation},set:function(t){this.props.rotation!==t&&(this.props.rotation=t,this.setUpdateType(ee.ScaleRotate))}},{key:"alpha",get:function(){return this.props.alpha},set:function(t){this.props.alpha=t,this.setUpdateType(ee.PremultipliedColors|ee.WorldAlpha)}},{key:"clipping",get:function(){return this.props.clipping},set:function(t){this.props.clipping=t,this.setUpdateType(ee.Clipping)}},{key:"color",get:function(){return this.props.color},set:function(t){this.props.colorTl===t&&this.props.colorTr===t&&this.props.colorBl===t&&this.props.colorBr===t||(this.colorTl=t,this.colorTr=t,this.colorBl=t,this.colorBr=t),this.props.color=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"colorTop",get:function(){return this.props.colorTop},set:function(t){this.props.colorTl===t&&this.props.colorTr===t||(this.colorTl=t,this.colorTr=t),this.props.colorTop=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"colorBottom",get:function(){return this.props.colorBottom},set:function(t){this.props.colorBl===t&&this.props.colorBr===t||(this.colorBl=t,this.colorBr=t),this.props.colorBottom=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"colorLeft",get:function(){return this.props.colorLeft},set:function(t){this.props.colorTl===t&&this.props.colorBl===t||(this.colorTl=t,this.colorBl=t),this.props.colorLeft=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"colorRight",get:function(){return this.props.colorRight},set:function(t){this.props.colorTr===t&&this.props.colorBr===t||(this.colorTr=t,this.colorBr=t),this.props.colorRight=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"colorTl",get:function(){return this.props.colorTl},set:function(t){this.props.colorTl=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"colorTr",get:function(){return this.props.colorTr},set:function(t){this.props.colorTr=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"colorBl",get:function(){return this.props.colorBl},set:function(t){this.props.colorBl=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"colorBr",get:function(){return this.props.colorBr},set:function(t){this.props.colorBr=t,this.setUpdateType(ee.PremultipliedColors)}},{key:"zIndexLocked",get:function(){return this.props.zIndexLocked||0},set:function(t){this.props.zIndexLocked=t,this.setUpdateType(ee.CalculatedZIndex|ee.Children),this.children.forEach((function(t){t.setUpdateType(ee.CalculatedZIndex)}))}},{key:"zIndex",get:function(){return this.props.zIndex},set:function(t){this.props.zIndex=t,this.setUpdateType(ee.CalculatedZIndex|ee.Children),this.children.forEach((function(t){t.setUpdateType(ee.CalculatedZIndex)}))}},{key:"parent",get:function(){return this.props.parent},set:function(t){var e=this.props.parent;if(e!==t){if(this.props.parent=t,e){var n=e.children.indexOf(this);o(-1!==n,"CoreNode.parent: Node not found in old parent's children!"),e.children.splice(n,1)}t&&(t.children.push(this),this.setUpdateType(ee.All),t.setUpdateType(ee.Children|ee.ZIndexSortedChildren)),this.updateScaleRotateTransform()}}}]),n}(a),Ae=1;function ge(){return Ae++}var pe=function(t){l(n,t);var e=c(n);function n(t,i,r,o){var s,a;return _(this,n),k(d(a=e.call(this)),"rendererMain",void 0),k(d(a),"stage",void 0),k(d(a),"id",void 0),k(d(a),"coreNode",void 0),k(d(a),"_children",[]),k(d(a),"_src",""),k(d(a),"_parent",null),k(d(a),"_texture",null),k(d(a),"_shader",null),k(d(a),"onTextureLoaded",(function(t,e){a.emit("loaded",e)})),k(d(a),"onTextureFailed",(function(t,e){a.emit("failed",e)})),a.rendererMain=i,a.stage=r,a.id=null!==(s=null==o?void 0:o.id)&&void 0!==s?s:ge(),a.coreNode=o||new de(a.stage,{id:a.id,x:t.x,y:t.y,width:t.width,height:t.height,alpha:t.alpha,clipping:t.clipping,color:t.color,colorTop:t.colorTop,colorBottom:t.colorBottom,colorLeft:t.colorLeft,colorRight:t.colorRight,colorTl:t.colorTl,colorTr:t.colorTr,colorBl:t.colorBl,colorBr:t.colorBr,zIndex:t.zIndex,zIndexLocked:t.zIndexLocked,scaleX:t.scaleX,scaleY:t.scaleY,mountX:t.mountX,mountY:t.mountY,mount:t.mount,pivot:t.pivot,pivotX:t.pivotX,pivotY:t.pivotY,rotation:t.rotation,parent:null,shader:null,shaderProps:null,texture:null,textureOptions:null}),a.coreNode.on("loaded",a.onTextureLoaded),a.coreNode.on("failed",a.onTextureFailed),a.parent=t.parent,a.shader=t.shader,a.texture=t.texture,a.src=t.src,a}return v(n,[{key:"x",get:function(){return this.coreNode.x},set:function(t){this.coreNode.x=t}},{key:"y",get:function(){return this.coreNode.y},set:function(t){this.coreNode.y=t}},{key:"width",get:function(){return this.coreNode.width},set:function(t){this.coreNode.width=t}},{key:"height",get:function(){return this.coreNode.height},set:function(t){this.coreNode.height=t}},{key:"alpha",get:function(){return this.coreNode.alpha},set:function(t){this.coreNode.alpha=t}},{key:"clipping",get:function(){return this.coreNode.clipping},set:function(t){this.coreNode.clipping=t}},{key:"color",get:function(){return this.coreNode.color},set:function(t){this.coreNode.color=t}},{key:"colorTop",get:function(){return this.coreNode.colorTop},set:function(t){this.coreNode.colorTop=t}},{key:"colorBottom",get:function(){return this.coreNode.colorBottom},set:function(t){this.coreNode.colorBottom=t}},{key:"colorLeft",get:function(){return this.coreNode.colorLeft},set:function(t){this.coreNode.colorLeft=t}},{key:"colorRight",get:function(){return this.coreNode.colorRight},set:function(t){this.coreNode.colorRight=t}},{key:"colorTl",get:function(){return this.coreNode.colorTl},set:function(t){this.coreNode.colorTl=t}},{key:"colorTr",get:function(){return this.coreNode.colorTr},set:function(t){this.coreNode.colorTr=t}},{key:"colorBl",get:function(){return this.coreNode.colorBl},set:function(t){this.coreNode.colorBl=t}},{key:"colorBr",get:function(){return this.coreNode.colorBr},set:function(t){this.coreNode.colorBr=t}},{key:"scale",get:function(){return this.scaleX!==this.scaleY?null:this.coreNode.scaleX},set:function(t){null!==t&&(this.coreNode.scaleX=t,this.coreNode.scaleY=t)}},{key:"scaleX",get:function(){return this.coreNode.scaleX},set:function(t){this.coreNode.scaleX=t}},{key:"scaleY",get:function(){return this.coreNode.scaleY},set:function(t){this.coreNode.scaleY=t}},{key:"mount",get:function(){return this.coreNode.mount},set:function(t){this.coreNode.mount=t}},{key:"mountX",get:function(){return this.coreNode.mountX},set:function(t){this.coreNode.mountX=t}},{key:"mountY",get:function(){return this.coreNode.mountY},set:function(t){this.coreNode.mountY=t}},{key:"pivot",get:function(){return this.coreNode.pivot},set:function(t){this.coreNode.pivot=t}},{key:"pivotX",get:function(){return this.coreNode.pivotX},set:function(t){this.coreNode.pivotX=t}},{key:"pivotY",get:function(){return this.coreNode.pivotY},set:function(t){this.coreNode.pivotY=t}},{key:"rotation",get:function(){return this.coreNode.rotation},set:function(t){this.coreNode.rotation=t}},{key:"parent",get:function(){return this._parent},set:function(t){var e,n=this._parent;if(this._parent=t,this.coreNode.parent=null!==(e=null==t?void 0:t.coreNode)&&void 0!==e?e:null,n){var i=n.children.indexOf(this);o(-1!==i,"MainOnlyNode.parent: Node not found in old parent's children!"),n.children.splice(i,1)}t&&t.children.push(this)}},{key:"children",get:function(){return this._children}},{key:"zIndex",get:function(){return this.coreNode.zIndex},set:function(t){this.coreNode.zIndex=t}},{key:"zIndexLocked",get:function(){return this.coreNode.zIndexLocked},set:function(t){this.coreNode.zIndexLocked=t}},{key:"src",get:function(){return this._src},set:function(t){this._src!==t&&(this._src=t,this.texture=t?this.rendererMain.createTexture("ImageTexture",{src:t}):null)}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this.rendererMain.textureTracker.decrementTextureRefCount(this._texture),t&&this.rendererMain.textureTracker.incrementTextureRefCount(t),this._texture=t,t?this.coreNode.loadTexture(t.txType,t.props,t.options):this.coreNode.unloadTexture())}},{key:"shader",get:function(){return this._shader},set:function(t){this._shader!==t&&(this._shader=t,t&&this.coreNode.loadShader(t.shType,t.props))}},{key:"destroy",value:function(){this.emit("beforeDestroy",{}),this.parent=null,this.texture=null,this.emit("afterDestroy",{}),this.removeAllListeners()}},{key:"flush",value:function(){}},{key:"animate",value:function(t,e){var n=new le(this.coreNode,t,e);return new he(this.stage.animationManager,n)}}]),n}(a),ve=(t=function(t){l(n,t);var e=c(n);function n(t){return _(this,n),e.call(this,{renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}return v(n,[{key:"bindTextures",value:function(t){var e=this.gl;e.getParameter(e.TEXTURE_BINDING_2D)!==t[0].ctxTexture&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t[0].ctxTexture))}}]),n}(T),k(t,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",fragment:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    "}),t),_e=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),k(d(i=e.call(this,{renderer:t,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]})),"supportsIndexedTextures",!0),i}return v(n,[{key:"bindTextures",value:function(t){var e=this.renderer,n=this.gl;if(t.length>e.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error("DefaultShaderBatched: Cannot bind more than ".concat(e.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS," textures"));t.forEach((function(t,e){n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,t.ctxTexture)}));var i=Array.from(Array(t.length).keys());this.setUniform("u_textures[0]",i)}}]),n}(T);k(_e,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",fragment:function(t){return"\n      #define txUnits ".concat(t,"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[").concat(t,"], int idx, vec2 uv) {\n        ").concat(Array.from(Array(t).keys()).map((function(t){return"\n          ".concat(0!==t?"else ":"","if (idx == ").concat(t,") {\n            return texture2D(textures[").concat(t,"], uv);\n          }\n        ")})).join(""),"\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    ")}});var ye=function(){function t(e){_(this,t),k(this,"priority",1),k(this,"name",""),k(this,"ref",void 0),k(this,"target",void 0),k(this,"passParameters",""),k(this,"declaredUniforms",""),k(this,"uniformInfo",{});var n=e.ref,i=e.target,r=e.props,o=void 0===r?{}:r;this.ref=n,this.target=i;var s={},a=[],u="",l=this.constructor.uniforms||{};for(var h in l){var c=l[h],f=c.type,d="".concat(n,"_").concat(h),A="";c.size&&(A="[".concat(c.size(o),"]")),a.push(d),u+="uniform ".concat(f," ").concat(d).concat(A,";"),s[h]={name:d,uniform:l[h].method}}this.passParameters=a.join(","),this.declaredUniforms=u,this.uniformInfo=s}return v(t,null,[{key:"getEffectKey",value:function(t){return""}},{key:"getMethodParameters",value:function(t,e){var n=[];for(var i in t){var r=t[i],o="";r.size&&(o="[".concat(r.size(e),"]")),n.push("".concat(r.type," ").concat(i).concat(o))}return n.join(",")}},{key:"resolveDefaults",value:function(t){return{}}},{key:"makeEffectKey",value:function(t){return!1}}]),t}();k(ye,"uniforms",{}),k(ye,"methods",void 0),k(ye,"onShaderMask",void 0),k(ye,"onColorize",void 0),k(ye,"onEffectMask",void 0);var xe=function(t){l(n,t);var e=c(n);function n(t,i,r){var o;_(this,n);var s=n.createShader(i,r);return k(d(o=e.call(this,{renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"}].concat(y(s.uniforms)),shaderSources:{vertex:s.vertex,fragment:s.fragment}})),"effects",[]),o.effects=s.effects,o}return v(n,[{key:"bindTextures",value:function(t){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t[0].ctxTexture)}},{key:"bindProps",value:function(t){var e,n=this,i=this.renderer.shManager.getRegisteredEffects();null===(e=t.effects)||void 0===e||e.forEach((function(t,e){var r,o=n.effects[e],s=i[o.name],a=null!==(r=t.props)&&void 0!==r?r:{},u=o.uniformInfo;Object.keys(a).forEach((function(t){var e=s.uniforms[t],i=u[t],r=e.validator?e.validator(a[t],a):a[t];Array.isArray(r)&&(r=new Float32Array(r)),n.setUniform(i.name,r)}))}))}}],[{key:"createShader",value:function(t,e){var i={},r={},o="",s=[],a=[],u=t.effects.map((function(t){var n=e[t.type],r=n.getEffectKey(t.props||{});i[r]=i[r]?++i[r]:1;var u=i[r];1===u&&a.push({key:r,type:t.type,props:t.props});var l=new n({ref:"".concat(r).concat(1===u?"":u),target:r,props:t.props});return o+=l.declaredUniforms,s.push.apply(s,y(Object.values(l.uniformInfo))),l})),l="";null==a||a.forEach((function(t){var i,o=e[t.type],s=o.resolveDefaults(null!==(i=t.props)&&void 0!==i?i:{}),a=[];for(var u in o.methods){var h=u,c=o.methods[u];r[u]&&r[u]!==c&&(h=n.resolveMethodDuplicate(u,c,r)),r[h]=c.replace("function",h),a.push({m:u,cm:h})}var f=o.onShaderMask instanceof Function?o.onShaderMask(s):o.onShaderMask,d=o.onColorize instanceof Function?o.onColorize(s):o.onColorize,A=o.onEffectMask instanceof Function?o.onEffectMask(s):o.onEffectMask;a.forEach((function(t){var e=t.m,n=t.cm,i=new RegExp("\\$".concat(e),"g");f&&(f=f.replace(i,n)),d&&(d=d.replace(i,n)),A&&(A=A.replace(i,n))}));var g=o.getMethodParameters(o.uniforms,s),p=g.length>0?", ".concat(g):"";f&&(l+="\n        float fx_".concat(t.key,"_onShaderMask(float shaderMask ").concat(p,") {\n          ").concat(f,"\n        }\n        ")),d&&(l+="\n          vec4 fx_".concat(t.key,"_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(p,") {\n            ").concat(d,"\n          }\n        ")),A&&(l+="\n          vec4 fx_".concat(t.key,"_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(p,") {\n            ").concat(A,"\n          }\n        "))}));var h="";for(var c in r)h+=r[c];for(var f="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",d="\n\n    ",A=0;A<u.length;A++){var g=u[A],p=g.passParameters.length>0?", ".concat(g.passParameters):"",v=e[g.name];v.onShaderMask&&(d+="\n        shaderMask = fx_".concat(g.target,"_onShaderMask(shaderMask ").concat(p,");\n        ")),v.onColorize&&(d+="\n        maskColor = fx_".concat(g.target,"_onColorize(shaderMask, maskColor, shaderColor").concat(p,");\n        ")),v.onEffectMask&&(f="fx_".concat(g.target,"_onEffectMask(shaderMask, maskColor, shaderColor").concat(p,")"));var _=u[A+1];(void 0===_||e[_.name].onEffectMask)&&(d+="\n          shaderColor = ".concat(f,";\n        "))}return{effects:u,uniforms:s,fragment:n.fragment(o,h,l,d),vertex:n.vertex()}}},{key:"resolveMethodDuplicate",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t+(i>0?i:"");return n[r]&&n[r]!==e?this.resolveMethodDuplicate(t,e,n,++i):r}},{key:"resolveDefaults",value:function(t,e){var n;return{effects:(null!==(n=t.effects)&&void 0!==n?n:[]).map((function(t){return{type:t.type,props:e[t.type].resolveDefaults(t.props||{})}})),$dimensions:{width:0,height:0},$alpha:0}}},{key:"makeCacheKey",value:function(t,e){var n,i="";return null===(n=t.effects)||void 0===n||n.forEach((function(t){var n=e[t.type].getEffectKey(t.props||{});i+=",".concat(n)})),"DynamicShader".concat(i)}}]),n}(T);k(xe,"z$__type__Props",void 0),k(xe,"vertex",(function(){return"\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  "})),k(xe,"fragment",(function(t,e,n,i){return"\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    ".concat(t,"\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n\n    ").concat(e,"\n\n    ").concat(n,"\n\n    void main() {\n      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ").concat(i,"\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  ")}));var me=function(t){l(n,t);var e=c(n);function n(t){return _(this,n),e.call(this,{renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}return v(n,[{key:"bindTextures",value:function(t){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t[0].ctxTexture)}},{key:"bindProps",value:function(t){this.setUniform("u_radius",t.radius)}},{key:"canBatchShaderProps",value:function(t,e){return t.radius===e.radius&&t.$dimensions.width===e.$dimensions.width&&t.$dimensions.height===e.$dimensions.height}}],[{key:"resolveDefaults",value:function(t){return{radius:t.radius||10,$dimensions:{width:0,height:0}}}}]),n}(T);k(me,"z$__type__Props",void 0),k(me,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",fragment:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    "});var ke=new Float32Array([1,0,0,0,1,0,0,0,1]),Te=function(t){l(n,t);var e=c(n);function n(t){return _(this,n),e.call(this,{renderer:t,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}return v(n,[{key:"bindTextures",value:function(t){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t[0].ctxTexture)}},{key:"bindProps",value:function(t){var e=n.resolveDefaults(t);for(var i in e)if("transform"===i)this.setUniform("u_transform",!1,e[i]);else if("scrollY"===i)this.setUniform("u_scrollY",e[i]);else if("color"===i){var r=C(e.color);this.setUniform("u_color",r)}else"size"===i?this.setUniform("u_size",e[i]):"distanceRange"===i?this.setUniform("u_distanceRange",e[i]):"debug"===i&&this.setUniform("u_debug",e[i]?1:0)}}],[{key:"resolveDefaults",value:function(){var t,e,n,i,r,o,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{transform:null!==(t=s.transform)&&void 0!==t?t:ke,scrollY:null!==(e=s.scrollY)&&void 0!==e?e:0,color:null!==(n=s.color)&&void 0!==n?n:4294967295,size:null!==(i=s.size)&&void 0!==i?i:16,distanceRange:null!==(r=s.distanceRange)&&void 0!==r?r:1,debug:null!==(o=s.debug)&&void 0!==o&&o}}}]),n}(T);k(Te,"shaderSources",{vertex:"\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n        gl_Position = vec4((transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1), 0, 1);\n        v_texcoord = a_textureCoordinate;\n      }\n    ",fragment:"\n      precision highp float;\n\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    "});var be=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","radius"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"radius"}},{key:"resolveDefaults",value:function(t){var e;return{radius:null!==(e=t.radius)&&void 0!==e?e:10}}}]),n}(ye);k(be,"z$__type__Props",void 0),k(be,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",validator:function(t){var e=t;return Array.isArray(e)?2===e.length?e=[e[0],e[1],e[0],e[1]]:3===e.length?e=[e[0],e[1],e[2],e[0]]:4!==e.length&&(e=[e[0],e[0],e[0],e[0]]):"number"==typeof e&&(e=[e,e,e,e]),e}}}),k(be,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",boxDist:"\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    "}),k(be,"onShaderMask","\n  vec2 halfDimensions = u_dimensions * 0.5;\n  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);\n  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);\n  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);\n  "),k(be,"onEffectMask","\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  ");var we=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","border"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"border"}},{key:"resolveDefaults",value:function(t){var e,n;return{width:null!==(e=t.width)&&void 0!==e?e:10,color:null!==(n=t.color)&&void 0!==n?n:4294967295}}}]),n}(ye);k(we,"z$__type__Props",void 0),k(we,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:function(t){return C(t)},method:"uniform4fv",type:"vec4"}}),k(we,"onEffectMask","\n  float mask = clamp(shaderMask + width, 0.0, 1.0) - clamp(shaderMask, 0.0, 1.0);\n  return mix(shaderColor, maskColor, mask);\n  "),k(we,"onColorize","\n    return color;\n  ");var Ce=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","linearGradient"),t}return v(n,null,[{key:"getEffectKey",value:function(t){return"linearGradient".concat(t.colors.length)}},{key:"resolveDefaults",value:function(t){var e,n,i=null!==(e=t.colors)&&void 0!==e?e:[4278190080,4294967295],r=t.stops;if(!r){r=[];for(var o=i.length-1,s=0;s<i.length;s++)r.push(s*(1/o))}return{colors:i,stops:r,angle:null!==(n=t.angle)&&void 0!==n?n:0}}}]),n}(ye);k(Ce,"z$__type__Props",void 0),k(Ce,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:function(t){return t.map((function(t){return C(t)})).reduce((function(t,e){return t.concat(e)}),[])},size:function(t){return t.colors.length},method:"uniform4fv",type:"vec4"},stops:{value:[],validator:function(t,e){var n,i=null!==(n=e.colors)&&void 0!==n?n:[],r=t,o=t;if(0===r.length||r&&r.length!==i.length){for(var s=0;s<i.length;s++)r[s]?(o[s]=r[s],void 0===r[s-1]&&void 0!==o[s-2]&&(o[s-1]=o[s-2]+(r[s]-o[s-2])/2)):o[s]=s*(1/(i.length-1));r=o}return o},size:function(t){return t.colors.length},method:"uniform1fv",type:"float"}}),k(Ce,"methods",{fromLinear:"\n      vec4 function(vec4 linearRGB) {\n        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n        vec4 lower = linearRGB * vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",toLinear:"\n      vec4 function(vec4 sRGB) {\n        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));\n        vec4 lower = sRGB/vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",calcPoint:"\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    "}),k(Ce,"ColorLoop",(function(t){for(var e="",n=2;n<t;n++)e+="colorOut = mix(colorOut, colors[".concat(n,"], clamp((dist - stops[").concat(n-1,"]) / (stops[").concat(n,"] - stops[").concat(n-1,"]), 0.0, 1.0));");return e})),k(Ce,"onColorize",(function(t){var e=t.colors.length||1;return"\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));\n      for(int i = 1; i < ".concat(e,"-1; i++) {\n        stopCalc = (dist - stops[i]) / (stops[i + 1] - stops[i]);\n        colorOut = mix(colorOut, colors[i + 1], clamp(stopCalc, 0.0, 1.0));\n      }\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ")}));var Se=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","grayscale"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"grayscale"}}]),n}(ye);k(Se,"onColorize","\n    vec3 color = pow(maskColor.rgb, vec3(2.0));\n    float gray = dot(color, vec3(0.2126, 0.7152, 0.0722));\n    float gammaGray = sqrt(gray);\n    return vec4(gammaGray, gammaGray, gammaGray, 1.0);\n  ");var Ee=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","borderRight"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"borderRight"}},{key:"resolveDefaults",value:function(t){var e,n;return{width:null!==(e=t.width)&&void 0!==e?e:10,color:null!==(n=t.color)&&void 0!==n?n:4294967295}}}]),n}(ye);k(Ee,"z$__type__Props",void 0),k(Ee,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:function(t){return C(t)},method:"uniform4fv",type:"vec4"}}),k(Ee,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),k(Ee,"onEffectMask","\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),k(Ee,"onColorize","\n    return color;\n  ");var Ie=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","borderTop"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"borderTop"}},{key:"resolveDefaults",value:function(t){var e,n;return{width:null!==(e=t.width)&&void 0!==e?e:10,color:null!==(n=t.color)&&void 0!==n?n:4294967295}}}]),n}(ye);k(Ie,"z$__type__Props",void 0),k(Ie,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:function(t){return C(t)},method:"uniform4fv",type:"vec4"}}),k(Ie,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),k(Ie,"onEffectMask","\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),k(Ie,"onColorize","\n    return color;\n  ");var Le=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","borderBottom"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"borderBottom"}},{key:"resolveDefaults",value:function(t){var e,n;return{width:null!==(e=t.width)&&void 0!==e?e:10,color:null!==(n=t.color)&&void 0!==n?n:4294967295}}}]),n}(ye);k(Le,"z$__type__Props",void 0),k(Le,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:function(t){return C(t)},method:"uniform4fv",type:"vec4"}}),k(Le,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),k(Le,"onEffectMask","\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),k(Le,"onColorize","\n    return color;\n  ");var Re=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","borderLeft"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"borderLeft"}},{key:"resolveDefaults",value:function(t){var e,n;return{width:null!==(e=t.width)&&void 0!==e?e:10,color:null!==(n=t.color)&&void 0!==n?n:4294967295}}}]),n}(ye);k(Re,"z$__type__Props",void 0),k(Re,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:function(t){return C(t)},method:"uniform4fv",type:"vec4"}}),k(Re,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),k(Re,"onEffectMask","\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),k(Re,"onColorize","\n    return color;\n  ");var Me=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","glitch"),t}return v(n,null,[{key:"getEffectKey",value:function(t){return"glitch"}},{key:"resolveDefaults",value:function(t){var e,n,i,r,o;return{amplitude:null!==(e=t.amplitude)&&void 0!==e?e:.2,narrowness:null!==(n=t.narrowness)&&void 0!==n?n:4,blockiness:null!==(i=t.blockiness)&&void 0!==i?i:2,minimizer:null!==(r=t.minimizer)&&void 0!==r?r:8,time:null!==(o=t.time)&&void 0!==o?o:Date.now()}}}]),n}(ye);k(Me,"z$__type__Props",void 0),k(Me,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",validator:function(t){return(Date.now()-t)%1e3},type:"float"}}),k(Me,"methods",{rand:"\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    ",noise:"\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    ",fbm:"\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    "}),k(Me,"onColorize","\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  ");var Pe=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","fadeOut"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"fadeOut"}},{key:"resolveDefaults",value:function(t){var e;return{fade:null!==(e=t.fade)&&void 0!==e?e:10}}}]),n}(ye);k(Pe,"z$__type__Props",void 0),k(Pe,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:function(t){var e=t;return Array.isArray(e)?2===e.length?e=[e[0],e[1],e[0],e[1]]:3===e.length?e=[e[0],e[1],e[2],e[0]]:4!==e.length&&(e=[e[0],e[0],e[0],e[0]]):"number"==typeof e&&(e=[e,e,e,e]),e}}}),k(Pe,"onColorize","\n  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  ");var ze=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","radialGradient"),t}return v(n,null,[{key:"getEffectKey",value:function(t){return"radialGradient".concat(t.colors.length)}},{key:"resolveDefaults",value:function(t){var e,n,i,r,o,s=null!==(e=t.colors)&&void 0!==e?e:[4278190080,4294967295],a=t.stops;if(!a){a=[];for(var u=s.length-1,l=0;l<s.length;l++)a.push(l*(1/u))}return{colors:s,stops:a,width:null!==(n=t.width)&&void 0!==n?n:0,height:null!==(i=null!==(r=t.height)&&void 0!==r?r:t.width)&&void 0!==i?i:0,pivot:null!==(o=t.pivot)&&void 0!==o?o:[.5,.5]}}}]),n}(ye);k(ze,"z$__type__Props",void 0),k(ze,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:function(t){return t.map((function(t){return C(t)})).reduce((function(t,e){return t.concat(e)}),[])},size:function(t){return t.colors.length},method:"uniform4fv",type:"vec4"},stops:{value:[],validator:function(t,e){var n,i=null!==(n=e.colors)&&void 0!==n?n:[],r=t,o=t;if(0===r.length||r&&r.length!==i.length){for(var s=0;s<i.length;s++)r[s]?(o[s]=r[s],void 0===r[s-1]&&void 0!==o[s-2]&&(o[s-1]=o[s-2]+(r[s]-o[s-2])/2)):o[s]=s*(1/(i.length-1));r=o}return o},size:function(t){return t.colors.length},method:"uniform1fv",type:"float"}}),k(ze,"onColorize",(function(t){var e=t.colors.length||1;return"\n      vec2 point = v_textureCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = mix(colors[0], colors[1], stopCalc);\n      for(int i = 1; i < ".concat(e,"-1; i++) {\n        stopCalc = (dist - stops[i]) / (stops[i + 1] - stops[i]);\n        colorOut = mix(colorOut, colors[i + 1], clamp(stopCalc, 0.0, 1.0));\n      }\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ")}));var Be=function(t){l(n,t);var e=c(n);function n(){var t;_(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return k(d(t=e.call.apply(e,[this].concat(r))),"name","radialProgress"),t}return v(n,null,[{key:"getEffectKey",value:function(){return"radialProgress"}},{key:"resolveDefaults",value:function(t){var e,n,i,r,o,s,a;return{width:null!==(e=t.width)&&void 0!==e?e:10,progress:null!==(n=t.progress)&&void 0!==n?n:.5,offset:null!==(i=t.offset)&&void 0!==i?i:0,range:null!==(r=t.range)&&void 0!==r?r:2*Math.PI,rounded:null!==(o=t.rounded)&&void 0!==o&&o,radius:null!==(s=t.radius)&&void 0!==s?s:1,color:null!==(a=t.color)&&void 0!==a?a:4294967295}}}]),n}(ye);k(Be,"z$__type__Props",void 0),k(Be,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:function(t){return t?1:0}},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,validator:function(t){return C(t)},method:"uniform4fv",type:"vec4"}}),k(Be,"methods",{rotateUV:"\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    ",drawDot:"\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    "}),k(Be,"onEffectMask","\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  "),k(Be,"onColorize","\n    return color;\n  ");var Oe=function(){function t(){_(this,t),k(this,"shCache",new Map),k(this,"shConstructors",{}),k(this,"attachedShader",null),k(this,"effectConstructors",{}),k(this,"renderer",void 0),this.registerShaderType("DefaultShader",ve),this.registerShaderType("DefaultShaderBatched",_e),this.registerShaderType("RoundedRectangle",me),this.registerShaderType("DynamicShader",xe),this.registerShaderType("SdfShader",Te),this.registerEffectType("border",we),this.registerEffectType("borderBottom",Le),this.registerEffectType("borderLeft",Re),this.registerEffectType("borderRight",Ee),this.registerEffectType("borderTop",Ie),this.registerEffectType("fadeOut",Pe),this.registerEffectType("linearGradient",Ce),this.registerEffectType("radialGradient",ze),this.registerEffectType("grayscale",Se),this.registerEffectType("glitch",Me),this.registerEffectType("radius",be),this.registerEffectType("radialProgress",Be)}return v(t,[{key:"registerShaderType",value:function(t,e){this.shConstructors[t]=e}},{key:"registerEffectType",value:function(t,e){this.effectConstructors[t]=e}},{key:"getRegisteredEffects",value:function(){return this.effectConstructors}},{key:"getRegisteredShaders",value:function(){return this.shConstructors}},{key:"loadShader",value:function(t,e){if(!this.renderer)throw new Error("Renderer is not been defined");var n=this.shConstructors[t];if(!n)throw new Error('Shader type "'.concat(t,'" is not registered'));if("DynamicShader"===t)return this.loadDynamicShader(e);var i=n.resolveDefaults(e),r=n.makeCacheKey(i)||n.name;if(r&&this.shCache.has(r))return{shader:this.shCache.get(r),props:i};var o=new n(this.renderer,e);return r&&this.shCache.set(r,o),{shader:o,props:i}}},{key:"loadDynamicShader",value:function(t){if(!this.renderer)throw new Error("Renderer is not been defined");var e=xe.resolveDefaults(t,this.effectConstructors),n=xe.makeCacheKey(e,this.effectConstructors);if(n&&this.shCache.has(n))return{shader:this.shCache.get(n),props:e};var i=new xe(this.renderer,t,this.effectConstructors);return n&&this.shCache.set(n,i),{shader:i,props:e}}},{key:"useShader",value:function(t){this.attachedShader!==t&&(this.attachedShader&&this.attachedShader.detach(),t.attach(),this.attachedShader=t)}}]),t}(),De=function(){function t(){_(this,t),k(this,"activeAnimations",new Set)}return v(t,[{key:"registerAnimation",value:function(t){this.activeAnimations.add(t)}},{key:"unregisterAnimation",value:function(t){this.activeAnimations.delete(t)}},{key:"update",value:function(t){this.activeAnimations.forEach((function(e){e.update(t)}))}}]),t}(),Fe=(H=function(t){l(i,t);var e,n=c(i);function i(t,e){var r;return _(this,i),k(d(r=n.call(this,t)),"props",void 0),r.props=i.resolveDefaults(e),r}return v(i,[{key:"getTextureData",value:(e=u(s().mark((function t(){var e,n,i,r,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.props,n=e.src,i=e.premultiplyAlpha,n){t.next=3;break}return t.abrupt("return",{data:null});case 3:if(!(n instanceof ImageData)){t.next=5;break}return t.abrupt("return",{data:n,premultiplyAlpha:i});case 5:return t.next=7,fetch(n);case 7:return r=t.sent,t.next=10,r.blob();case 10:return o=t.sent,t.next=13,createImageBitmap(o,{premultiplyAlpha:i?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"});case 13:return t.t0=t.sent,t.abrupt("return",{data:t.t0});case 15:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}],[{key:"makeCacheKey",value:function(t){var e=i.resolveDefaults(t);return!(e.src instanceof ImageData)&&"ImageTexture,".concat(e.src,",").concat(e.premultiplyAlpha)}},{key:"resolveDefaults",value:function(t){var e,n;return{src:null!==(e=t.src)&&void 0!==e?e:"",premultiplyAlpha:null===(n=t.premultiplyAlpha)||void 0===n||n}}}]),i}(S),k(H,"z$__type__Props",void 0),H),Ne=(W=function(t){l(i,t);var e,n=c(i);function i(t,e){var r;return _(this,i),k(d(r=n.call(this,t)),"props",void 0),r.props=i.resolveDefaults(e),r}return v(i,[{key:"getTextureData",value:(e=u(s().mark((function t(){var e,n,i,r,o,a,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=this.props,n=e.width,i=e.height,r=n*i*4,o=new Uint8ClampedArray(r),a=0;a<r;a+=4)u=Math.floor(256*Math.random()),o[a]=u,o[a+1]=u,o[a+2]=u,o[a+3]=255;return t.abrupt("return",{data:new ImageData(o,n,i)});case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}],[{key:"makeCacheKey",value:function(t){var e=i.resolveDefaults(t);return"NoiseTexture,".concat(e.width,",").concat(e.height,",").concat(e.cacheId)}},{key:"resolveDefaults",value:function(t){var e,n,i;return{width:null!==(e=t.width)&&void 0!==e?e:128,height:null!==(n=t.height)&&void 0!==n?n:128,cacheId:null!==(i=t.cacheId)&&void 0!==i?i:0}}}]),i}(S),k(W,"z$__type__Props",void 0),W),Ue=function(){function t(){_(this,t),k(this,"usedMemory",0),k(this,"txConstructors",{}),k(this,"textureKeyCache",new Map),k(this,"textureIdCache",new Map),k(this,"ctxTextureCache",new WeakMap),k(this,"textureRefCountMap",new WeakMap),k(this,"renderer",void 0),this.registerTextureType("ImageTexture",Fe),this.registerTextureType("ColorTexture",E),this.registerTextureType("NoiseTexture",Ne),this.registerTextureType("SubTexture",I)}return v(t,[{key:"registerTextureType",value:function(t,e){this.txConstructors[t]=e}},{key:"loadTexture",value:function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.txConstructors[t];if(!r)throw new Error('Texture type "'.concat(t,'" is not registered'));if(void 0!==(null==i?void 0:i.id)&&this.textureIdCache.has(i.id)&&(n=this.textureIdCache.get(i.id)),!n){var o,s=null==i?void 0:i.id,a=null!==(o=null==i?void 0:i.cacheKey)&&void 0!==o?o:r.makeCacheKey(e);n=a&&this.textureKeyCache.has(a)?this.textureKeyCache.get(a):new r(this,e),s&&this.addTextureIdToCache(s,a,n)}null!=i&&i.preload&&this.getCtxTexture(n).load();return n}},{key:"addTextureIdToCache",value:function(t,e,n){var i=this.textureIdCache,r=this.textureRefCountMap;i.set(t,n),r.has(n)?r.get(n).count++:(r.set(n,{cacheKey:e,count:1}),e&&this.textureKeyCache.set(e,n))}},{key:"removeTextureIdFromCache",value:function(t){var e=this.textureIdCache,n=this.textureRefCountMap,i=e.get(t);if(i&&(e.delete(t),n.has(i))){var r=n.get(i);o(r),r.count--,0===r.count&&(n.delete(i),r.cacheKey&&this.textureKeyCache.delete(r.cacheKey))}}},{key:"getDebugInfo",value:function(){return{keyCacheSize:this.textureKeyCache.size,idCacheSize:this.textureIdCache.size}}},{key:"getCtxTexture",value:function(t){if(this.ctxTextureCache.has(t))return this.ctxTextureCache.get(t);var e=this.renderer.createCtxTexture(t);return this.ctxTextureCache.set(t,e),e}}]),t}(),je=function(){function t(e){_(this,t),k(this,"textRenderers",void 0),this.textRenderers=e}return v(t,[{key:"addFontFace",value:function(t){for(var e in this.textRenderers){var n=this.textRenderers[e];n&&n.isFontFaceSupported(t)&&n.addFontFace(t)}}}],[{key:"resolveFontFace",value:function(t,e){return t.reduce((function(t,n){if(t)return t;var i=n[e.fontFamily];if(i){var r,o=new Set(i),s=w(o);try{for(s.s();!(r=s.n()).done;){var a=r.value;a.descriptors.stretch===e.fontStretch&&a.descriptors.style===e.fontStyle&&a.descriptors.weight===e.fontWeight||o.delete(a)}}catch(u){s.e(u)}finally{s.f()}return o.values().next().value}}),void 0)||[][0]}}]),t}(),He={x:function(t,e){t.props.x=e},y:function(t,e){t.props.y=e},width:function(t,e){t.props.width=e},height:function(t,e){t.props.height=e},color:function(t,e){t.props.color=e},zIndex:function(t,e){t.props.zIndex=e},fontFamily:function(t,e){t.props.fontFamily=e},fontWeight:function(t,e){t.props.fontWeight=e},fontStyle:function(t,e){t.props.fontStyle=e},fontStretch:function(t,e){t.props.fontStretch=e},fontSize:function(t,e){t.props.fontSize=e},text:function(t,e){t.props.text=e},textAlign:function(t,e){t.props.textAlign=e},contain:function(t,e){t.props.contain=e},offsetY:function(t,e){t.props.offsetY=e},scrollable:function(t,e){t.props.scrollable=e},scrollY:function(t,e){t.props.scrollY=e},letterSpacing:function(t,e){t.props.letterSpacing=e},debug:function(t,e){t.props.debug=e}},We=function(){function t(e){_(this,t),k(this,"stage",void 0),k(this,"set",void 0),this.stage=e;var n=m(m({},He),this.getPropertySetters());this.set=Object.freeze(Object.fromEntries(Object.entries(n).map((function(t){var e=b(t,2),n=e[0],i=e[1];return[n,function(t,e){t.props[n]!==e&&i(t,e)}]}))))}return v(t,[{key:"setStatus",value:function(t,e,n){t.status!==e&&(t.status=e,t.emitter.emit(e,n))}},{key:"scheduleUpdateState",value:function(t){var e=this;t.updateScheduled||(t.updateScheduled=!0,queueMicrotask((function(){t.updateScheduled=!1,e.updateState(t)})))}}]),t}();var Qe=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_(this,t),k(this,"iterator",void 0),k(this,"peekBuffer",[]),k(this,"_lastIndex",void 0),this.iterator=e,this.iterator=e,this._lastIndex=n-1,this.peekBuffer=[]}return v(t,[{key:"next",value:function(){var t=this.peekBuffer.length>0?this.peekBuffer.pop():this.iterator.next();return t.done?this._lastIndex=-1:this._lastIndex++,t}},{key:"peek",value:function(){if(this.peekBuffer.length>0)return this.peekBuffer[0];var t=this.iterator.next();return this.peekBuffer.push(t),t}},{key:"lastIndex",get:function(){return this._lastIndex}}]),t}();function Ge(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s().mark((function n(){var i,r;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=e;case 1:if(!(i<t.length)){n.next=10;break}if(void 0!==(r=t.codePointAt(i))){n.next=5;break}throw new Error("Invalid Unicode code point");case 5:return n.next=7,r;case 7:i+=r<=65535?1:2,n.next=1;break;case 10:case"end":return n.stop()}}),n)}))()}function Ye(t,e,n,i,r,s,a,u,l,h,c,f,d,A,g,p){o(A,"Font face must be loaded"),o(A.loaded,"Font face must be loaded"),o(A.data,"Font face must be loaded"),o(A.shaper,"Font face must be loaded");for(var v,_=A.data.info.size,y=u/_,x=s/y,m=l/y,k=f[t],T=(null==k?void 0:k.codepointIndex)||0,b=(null==k?void 0:k.maxX)||0,C=(null==k?void 0:k.maxY)||0,S=e,E=n,I=0,L={codepointIndex:-1,bufferOffset:-1,xStart:-1},R=A.shaper,M={letterSpacing:m},P=R.shapeText(M,new Qe(Ge(i,T),T)),z=-1,B=[],O=a/y,D=function(t,e,n){var i,r=0,o=w(n.shapeText(e,new Qe(Ge(t,0),0)));try{for(o.s();!(i=o.n()).done;){var s=i.value;s.mapped&&(r+=s.xAdvance)}}catch(a){o.e(a)}finally{o.f()}return r}("...",M,R),F=!0;F;){for(var N="both"!==c||p||E+_+_<=O,U=N?x:x-D,j=0;(v=P.next())&&!v.done;){var H=v.value;if(t===f.length)f.push({codepointIndex:H.cluster,maxY:C,maxX:b});else if(t>f.length)throw new Error("Unexpected lineCache length");if(32===H.codepoint||10===H.codepoint?-1!==L.codepointIndex&&(L.codepointIndex=-1,j=S):-1===L.codepointIndex&&(L.codepointIndex=H.cluster,L.bufferOffset=I,L.xStart=j),H.mapped){var W=S+H.xOffset+H.width;if("none"!==c&&W>=U&&-1!==L.codepointIndex&&L.codepointIndex<H.cluster&&L.xStart>0){if(N){P=R.shapeText(M,new Qe(Ge(i,L.codepointIndex),L.codepointIndex)),I=L.bufferOffset;break}P=R.shapeText(M,new Qe(Ge("...",0),0)),S=L.xStart,I=L.bufferOffset}else{var Q=S+H.xOffset,G=E+H.yOffset,Y=!d||E+_>=d.y1/y,X=!d||E<=d.y2/y;if(Y&&X){-1===z&&(z=I);var V=A.getAtlasEntry(H.glyphId),Z=V.x/A.data.common.scaleW,q=V.y/A.data.common.scaleH,K=V.width/A.data.common.scaleW,J=V.height/A.data.common.scaleH;h[I++]=Q,h[I++]=G,h[I++]=Z,h[I++]=q,h[I++]=Q+H.width,h[I++]=G,h[I++]=Z+K,h[I++]=q,h[I++]=Q,h[I++]=G+H.height,h[I++]=Z,h[I++]=q+J,h[I++]=Q+H.width,h[I++]=G+H.height,h[I++]=Z+K,h[I++]=q+J}C=Math.max(C,G+H.height),S+=H.xAdvance,b=Math.max(b,S)}}else if(10===H.codepoint)break}-1!==z&&(B.push({bufferStart:z,bufferEnd:I}),z=-1),S=0,E+=_,t++,L.codepointIndex=-1,j=0,!g&&"both"===c&&d&&E>d.y2/y||v&&v.done?F=!1:"both"!==c||p||N||(F=!1)}if("center"===r)for(var $="none"===c?b:x,tt=0;tt<B.length;tt++)for(var et=B[tt],nt=($-(h[et.bufferEnd-4]-h[et.bufferStart]))/2,it=et.bufferStart;it<et.bufferEnd;it+=4)h[it]+=nt;else if("right"===r)for(var rt="none"===c?b:x,ot=0;ot<B.length;ot++)for(var st=B[ot],at=rt-(st.bufferEnd===st.bufferStart?0:h[st.bufferEnd-4]-h[st.bufferStart]),ut=st.bufferStart;ut<st.bufferEnd;ut+=4)h[ut]+=at;return o(v),{bufferNumFloats:I,bufferNumQuads:I/16,layoutNumCharacters:v.done?i.length-T:v.value.cluster-T+1,fullyProcessed:!!v.done,maxX:b,maxY:C}}var Xe=R(0,0,0,0),Ve=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),k(d(i=e.call(this,t)),"ssdfFontFamilies",{}),k(d(i),"msdfFontFamilies",{}),k(d(i),"sdfShader",void 0),k(d(i),"rendererBounds",void 0),i.sdfShader=i.stage.shManager.loadShader("SdfShader").shader,i.rendererBounds={x1:0,y1:0,x2:i.stage.options.appWidth,y2:i.stage.options.appHeight},i}return v(n,[{key:"getPropertySetters",value:function(){var t=this;return{fontFamily:function(e,n){e.props.fontFamily=n,e.trFontFace=void 0,t.invalidateLayoutCache(e)},fontWeight:function(e,n){e.props.fontWeight=n,e.trFontFace=void 0,t.invalidateLayoutCache(e)},fontStyle:function(e,n){e.props.fontStyle=n,e.trFontFace=void 0,t.invalidateLayoutCache(e)},fontStretch:function(e,n){e.props.fontStretch=n,e.trFontFace=void 0,t.invalidateLayoutCache(e)},fontSize:function(e,n){e.props.fontSize=n,t.invalidateLayoutCache(e)},text:function(e,n){e.props.text=n,t.invalidateLayoutCache(e)},textAlign:function(e,n){e.props.textAlign=n,t.invalidateLayoutCache(e)},color:function(t,e){t.props.color=e},x:function(e,n){e.props.x=n,t.invalidateVisibleWindowCache(e)},y:function(e,n){e.props.y=n,t.invalidateVisibleWindowCache(e)},contain:function(e,n){e.props.contain=n,t.invalidateLayoutCache(e)},width:function(e,n){e.props.width=n,t.invalidateLayoutCache(e)},height:function(e,n){e.props.height=n,t.invalidateLayoutCache(e)},offsetY:function(e,n){e.props.offsetY=n,t.invalidateLayoutCache(e)},scrollable:function(e,n){e.props.scrollable=n,t.invalidateLayoutCache(e)},scrollY:function(e,n){e.props.scrollY=n,t.scheduleUpdateState(e)},letterSpacing:function(e,n){e.props.letterSpacing=n,t.invalidateLayoutCache(e)},debug:function(t,e){t.props.debug=e}}}},{key:"canRenderFont",value:function(t){var e=t.fontFamily;return e in this.ssdfFontFamilies||e in this.msdfFontFamilies||"$$SDF_FAILURE_TEST$$"===e}},{key:"isFontFaceSupported",value:function(t){return t instanceof M}},{key:"addFontFace",value:function(t){o(t instanceof M);var e=t.fontFamily,n="ssdf"===t.type?this.ssdfFontFamilies:"msdf"===t.type?this.msdfFontFamilies:void 0;if(n){var i=n[e];i||(i=new Set,n[e]=i),i.add(t)}else console.warn("Invalid font face type: ".concat(t.type))}},{key:"createState",value:function(t){return{props:t,status:"initialState",updateScheduled:!1,emitter:new a,lineCache:[],forceFullLayoutCalc:!1,renderWindow:void 0,visibleWindow:{x1:0,y1:0,x2:0,y2:0,valid:!1},bufferNumFloats:0,bufferNumQuads:0,vertexBuffer:void 0,webGlBuffers:null,bufferUploaded:!1,textH:void 0,textW:void 0,distanceRange:0,trFontFace:void 0,debugData:{updateCount:0,layoutCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,drawCount:0,bufferSize:0}}}},{key:"updateState",value:function(t){var e=this,n=t.trFontFace,i=t.textH,r=t.lineCache,s=t.debugData,a=t.forceFullLayoutCalc;if(s.updateCount++,"initialState"===t.status&&this.setStatus(t,"loading"),!n&&(n=this.resolveFontFace(t.props),t.trFontFace=n,!n)){var u="SdfTextRenderer: Could not resolve font face for family: '".concat(t.props.fontFamily,"'");return console.error(u),void this.setStatus(t,"failed",new Error(u))}if(n.loaded){o(n.data,"Font face data should be loaded");var l=t.props,h=l.text,c=l.fontSize,f=l.x,d=l.y,A=l.contain,g=l.width,p=l.height,v=l.scrollable,_="both"===A&&v?t.props.scrollY:0,y=t.renderWindow,x=n.data.info.size,m=c/x;t.distanceRange=m*n.data.distanceField.distanceRange;var k=24*h.length,T=t.vertexBuffer;(!T||T.length<k)&&(T=new Float32Array(2*k));var b=t.visibleWindow;if(!b.valid){var w=R(f,d,"none"!==A?f+g:1/0,"both"===A?d+p:1/0,Xe);P(this.rendererBounds,w,t.visibleWindow),b.valid=!0}if(!a&&y){if(f+y.x1<=b.x1&&f+y.x2>=b.x2&&d-_+y.y1<=b.y1&&d-_+y.y2>=b.y2)return void this.setStatus(t,"loaded");y=t.renderWindow=void 0,this.setStatus(t,"loading")}var C=t.props,S=C.offsetY,E=C.textAlign;if(!y){var I=b.y2-b.y1;y=function(t,e,n,i,r,o){var s=i*r,a=o.x1-t,u=o.y1-e;return L(o)?{x1:a,y1:u+n-s,x2:a+(o.x2-o.x1),y2:u+n+(o.y2-o.y1)+s}:{x1:0,y1:0,x2:0,y2:0}}(f,d,_,x,Math.ceil(I/x),b)}var M=function(t,e,n,i,r,o,s){var a=0;r&&(a=Math.min(Math.max(Math.floor(r.y1/t),0),o.length));var u=e/n+a*i;if(!(s&&u>=s/n))return{x:0,y:u,lineIndex:a}}(c,S,m,x,y,r,i);if(M){var z=t.props.letterSpacing,B=Ye(M.lineIndex,M.x,M.y,h,E,g,p,c,z,T,A,r,y,n,a,v);t.bufferUploaded=!1,t.bufferNumFloats=B.bufferNumFloats,t.bufferNumQuads=B.bufferNumQuads,t.vertexBuffer=T,t.renderWindow=y,s.lastLayoutNumCharacters=B.layoutNumCharacters,s.bufferSize=T.byteLength,B.fullyProcessed&&(t.textW=B.maxX*m,t.textH=B.maxY*m),this.setStatus(t,"loaded")}else this.setStatus(t,"loaded")}else n.once("loaded",(function(){e.scheduleUpdateState(t)}))}},{key:"renderQuads",value:function(t,e,n,i){var r,s;if(t.vertexBuffer){performance.now();var a=this.stage.renderer;this.stage.options;var u=t.props,l=u.fontSize,h=u.color,c=u.contain,f=u.scrollable,d=u.zIndex,A=u.debug,g="both"===c&&f?t.props.scrollY:0,p=t.textW,v=void 0===p?0:p,_=t.textH,y=void 0===_?0:_,x=t.distanceRange,m=t.vertexBuffer,k=t.bufferUploaded,T=t.trFontFace,b=t.webGlBuffers;if(!b){var w=a.gl,C=4*Float32Array.BYTES_PER_ELEMENT,S=w.createBuffer();o(S),t.webGlBuffers=new z([{buffer:S,attributes:{a_position:{name:"a_position",size:2,type:w.FLOAT,normalized:!1,stride:C,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:w.FLOAT,normalized:!1,stride:C,offset:2*Float32Array.BYTES_PER_ELEMENT}}}]),t.bufferUploaded=!1,o(t.webGlBuffers),b=t.webGlBuffers}if(!k){var E,I,L=a.gl,R=null!==(E=null===(I=b)||void 0===I?void 0:I.getBuffer("a_textureCoordinate"))&&void 0!==E?E:null;L.bindBuffer(L.ARRAY_BUFFER,R),L.bufferData(L.ARRAY_BUFFER,m,L.STATIC_DRAW),t.bufferUploaded=!0}o(T);var M=new B(a.gl,a.options,b,this.sdfShader,{transform:e.data,color:O(h,i),size:l/((null===(r=T.data)||void 0===r?void 0:r.info.size)||0),scrollY:g,distanceRange:x,debug:A.sdfShaderDebug},i,n,{height:y,width:v},0,d),P=null===(s=t.trFontFace)||void 0===s?void 0:s.texture;o(P);var D=this.stage.txManager.getCtxTexture(P);M.addTexture(D),M.length=t.bufferNumFloats,M.numQuads=t.bufferNumQuads,a.addRenderOp(M)}}},{key:"resolveFontFace",value:function(t){return je.resolveFontFace([this.msdfFontFamilies,this.ssdfFontFamilies],t)}},{key:"invalidateVisibleWindowCache",value:function(t){t.visibleWindow.valid=!1,this.scheduleUpdateState(t)}},{key:"invalidateLayoutCache",value:function(t){t.visibleWindow.valid=!1,t.renderWindow=void 0,t.textH=void 0,t.textW=void 0,t.lineCache=[],this.setStatus(t,"loading"),this.scheduleUpdateState(t)}}]),n}(We),Ze=function(){function t(e,n){_(this,t),k(this,"_canvas",void 0),k(this,"_context",void 0),k(this,"_settings",void 0),k(this,"renderInfo",void 0),this._canvas=e,this._context=n,this._settings=this.mergeDefaults({})}return v(t,[{key:"settings",get:function(){return this._settings},set:function(t){this._settings=this.mergeDefaults(t)}},{key:"getPrecision",value:function(){return this._settings.precision}},{key:"setFontProperties",value:function(){this._context.font=this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}},{key:"_getFontSetting",value:function(){for(var t=[this._settings.fontFace],e=[],n=0,i=t.length;n<i;n++)"serif"===t[n]||"sans-serif"===t[n]?e.push(t[n]):e.push('"'.concat(t[n],'"'));return"".concat(this._settings.fontStyle," ").concat(this._settings.fontSize*this.getPrecision(),"px ").concat(e.join(","))}},{key:"_load",value:function(){var t=this;if(document.fonts){var e=this._getFontSetting();try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch((function(t){console.warn("[Lightning] Font load error",t,e)})).then((function(){document.fonts.check(e,t._settings.text)||console.warn("[Lightning] Font not found",e)}))}catch(n){console.warn("[Lightning] Can't check font loading for "+e)}}}},{key:"calculateRenderInfo",value:function(){var t={},e=this.getPrecision(),n=this._settings.paddingLeft*e,i=this._settings.paddingRight*e,r=this._settings.fontSize*e,o=null===this._settings.offsetY?null:this._settings.offsetY*e,s=(this._settings.lineHeight||r)*e,a=this._settings.w*e,u=this._settings.h*e,l=this._settings.wordWrapWidth*e,h=this._settings.cutSx*e,c=this._settings.cutEx*e,f=this._settings.cutSy*e,d=this._settings.cutEy*e,A=(this._settings.letterSpacing||0)*e,g=this._settings.textIndent*e;this.setFontProperties();var p,v=a||2048/this.getPrecision(),_=v-n;if(_<10&&(v+=10-_,_=10),l||(l=_),this._settings.textOverflow&&!this._settings.wordWrap){var y;switch(this._settings.textOverflow){case"clip":y="";break;case"ellipsis":y=this._settings.maxLinesSuffix;break;default:y=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,l-g,y)}if(this._settings.wordWrap)p=this.wrapText(this._settings.text,l,A,g);else for(var x=(p={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]}).l.length,m=0;m<x-1;m++)p.n.push(m);var k=p.l;if(this._settings.maxLines&&k.length>this._settings.maxLines){var T,b=k.slice(0,this._settings.maxLines),w=null;if(this._settings.maxLinesSuffix){var C=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,S=this.wrapText(b[b.length-1],l-C,A,g);b[b.length-1]="".concat(S.l[0]).concat(this._settings.maxLinesSuffix),w=[S.l.length>1?S.l[1]:""]}else w=[""];var E=k.length,I=0,L=p.n.length;for(T=this._settings.maxLines;T<E;T++)w[I]+="".concat(w[I]?" ":"").concat(k[T]),T+1<L&&p.n[T+1]&&I++;t.remainingText=w.join("\n"),t.moreTextLines=!0,k=b}else t.moreTextLines=!1,t.remainingText="";for(var R,M=0,P=[],z=0;z<k.length;z++){var B=this.measureText(k[z],A)+(0===z?g:0);P.push(B),M=Math.max(M,B)}if(t.lineWidths=P,a||(v=M+n+i,_=M),s=s||r,u)R=u;else{var O="bottom"!=this._settings.textBaseline?.5*r:0;R=s*(k.length-1)+O+Math.max(s,r)+(o||0)}return null===o&&(o=r),t.w=v,t.h=R,t.lines=k,t.precision=e,v||(v=1),R||(R=1),(h||c)&&(v=Math.min(v,c-h)),(f||d)&&(R=Math.min(R,d-f)),t.width=v,t.innerWidth=_,t.height=R,t.fontSize=r,t.cutSx=h,t.cutSy=f,t.cutEx=c,t.cutEy=d,t.lineHeight=s,t.lineWidths=P,t.offsetY=o,t.paddingLeft=n,t.paddingRight=i,t.letterSpacing=A,t.textIndent=g,t}},{key:"draw",value:function(t,e){var n,i,r=this.getPrecision(),o=(null==e?void 0:e.lines)||t.lines,s=(null==e?void 0:e.lineWidths)||t.lineWidths,a=e?e.lines.length*t.lineHeight:t.height;this._canvas.width=Math.min(Math.ceil(t.width+this._settings.textRenderIssueMargin),2048),this._canvas.height=Math.min(Math.ceil(a),2048),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy);for(var u=[],l=0,h=o.length;l<h;l++)n=0===l?t.textIndent:0,i=l*t.lineHeight+t.offsetY,"middle"==this._settings.verticalAlign?i+=(t.lineHeight-t.fontSize)/2:"bottom"==this._settings.verticalAlign&&(i+=t.lineHeight-t.fontSize),"right"===this._settings.textAlign?n+=t.innerWidth-s[l]:"center"===this._settings.textAlign&&(n+=(t.innerWidth-s[l])/2),n+=t.paddingLeft,u.push({text:o[l],x:n,y:i,w:s[l]});if(this._settings.highlight){var c=this._settings.highlightColor,f=this._settings.highlightHeight*r||1.5*t.fontSize,d=this._settings.highlightOffset*r,A=null!==this._settings.highlightPaddingLeft?this._settings.highlightPaddingLeft*r:t.paddingLeft,g=null!==this._settings.highlightPaddingRight?this._settings.highlightPaddingRight*r:t.paddingRight;this._context.fillStyle=D(c);for(var p=0;p<u.length;p++){var v=u[p];this._context.fillRect(v.x-A,v.y-t.offsetY+d,v.w+g+A,f)}}var _=null;this._settings.shadow&&(_=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=D(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*r,this._context.shadowOffsetY=this._settings.shadowOffsetY*r,this._context.shadowBlur=this._settings.shadowBlur*r),this._context.fillStyle=D(this._settings.textColor);for(var y=0,x=u.length;y<x;y++){var m=u[y];if(0===t.letterSpacing)this._context.fillText(m.text,m.x,m.y);else for(var k=m.text.split(""),T=m.x,b=0,w=k.length;b<w;b++)this._context.fillText(k[b],T,m.y),T+=this.measureText(k[b],t.letterSpacing)}_&&(this._context.shadowColor=_[0],this._context.shadowOffsetX=_[1],this._context.shadowOffsetY=_[2],this._context.shadowBlur=_[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),this.renderInfo=t}},{key:"wrapWord",value:function(t,e,n){var i=this._context.measureText(n).width,r=t.length,o=this._context.measureText(t).width;if(o<=e)return t;var s=Math.floor(e*r/o),a=this._context.measureText(t.substring(0,s)).width+i;if(a>e)for(;s>0&&(a=this._context.measureText(t.substring(0,s)).width+i)>e;)s-=1;else for(;s<r;){if(!((a=this._context.measureText(t.substring(0,s)).width+i)<e)){s-=1;break}s+=1}return t.substring(0,s)+(e>=i?n:"")}},{key:"wrapText",value:function(t,e,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.split(/\r?\n/g),o=[],s=[],a=0;a<r.length;a++){for(var u=[],l="",h=e-i,c=r[a].split(" "),f=0;f<c.length;f++){var d=this.measureText(c[f],n),A=d+this.measureText(" ",n);0===f||A>h?(f>0&&(u.push(l),l=""),l+=c[f],h=e-d-(0===f?i:0)):(h-=A,l+=" ".concat(c[f]))}u.push(l),l="",o=o.concat(u),a<r.length-1&&s.push(o.length)}return{l:o,n:s}}},{key:"measureText",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return n?t.split("").reduce((function(t,i){return t+e._context.measureText(i).width+n}),0):this._context.measureText(t).width}},{key:"mergeDefaults",value:function(t){return m({text:"",w:0,h:0,fontStyle:"normal",fontSize:40,fontFace:null,wordWrap:!0,wordWrapWidth:0,wordBreak:!1,textOverflow:"",lineHeight:null,textBaseline:"alphabetic",textAlign:"left",verticalAlign:"top",offsetY:null,maxLines:0,maxLinesSuffix:"..",textColor:[1,1,1,1],paddingLeft:0,paddingRight:0,shadow:!1,shadowColor:[0,0,0,1],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,highlight:!1,highlightHeight:0,highlightColor:[0,0,0,1],highlightOffset:0,highlightPaddingLeft:0,highlightPaddingRight:0,letterSpacing:0,textIndent:0,cutSx:0,cutEx:0,cutSy:0,cutEy:0,advancedRenderer:!1,fontBaselineRatio:0,precision:1,textRenderIssueMargin:0},t)}}]),t}(),qe="undefined"==typeof self?globalThis:self,Ke=(null===(Q=qe.document)||void 0===Q?void 0:Q.fonts)||qe.fonts;var Je=R(0,0,0,0),$e=function(t){l(n,t);var e=c(n);function n(t){var i;_(this,n),k(d(i=e.call(this,t)),"canvas",void 0),k(d(i),"context",void 0),k(d(i),"rendererBounds",void 0),"undefined"!=typeof OffscreenCanvas?i.canvas=new OffscreenCanvas(0,0):i.canvas=document.createElement("canvas");var r=i.canvas.getContext("2d");return r||(i.canvas=document.createElement("canvas"),r=i.canvas.getContext("2d")),o(r),i.context=r,i.rendererBounds={x1:0,y1:0,x2:i.stage.options.appWidth,y2:i.stage.options.appHeight},i}return v(n,[{key:"getPropertySetters",value:function(){var t=this;return{fontFamily:function(e,n){e.props.fontFamily=n,e.fontInfo=void 0,t.invalidateLayoutCache(e)},fontWeight:function(e,n){e.props.fontWeight=n,e.fontInfo=void 0,t.invalidateLayoutCache(e)},fontStyle:function(e,n){e.props.fontStyle=n,e.fontInfo=void 0,t.invalidateLayoutCache(e)},fontStretch:function(e,n){e.props.fontStretch=n,e.fontInfo=void 0,t.invalidateLayoutCache(e)},fontSize:function(e,n){e.props.fontSize=n,e.fontInfo=void 0,t.invalidateLayoutCache(e)},text:function(e,n){e.props.text=n,t.invalidateLayoutCache(e)},textAlign:function(e,n){e.props.textAlign=n,t.invalidateLayoutCache(e)},color:function(e,n){e.props.color=n,t.invalidateLayoutCache(e)},x:function(e,n){e.props.x=n,t.invalidateVisibleWindowCache(e)},y:function(e,n){e.props.y=n,t.invalidateVisibleWindowCache(e)},contain:function(e,n){e.props.contain=n,t.invalidateLayoutCache(e)},width:function(e,n){e.props.width=n,t.invalidateLayoutCache(e)},height:function(e,n){e.props.height=n,t.invalidateLayoutCache(e)},offsetY:function(e,n){e.props.offsetY=n,t.invalidateLayoutCache(e)},scrollY:function(t,e){t.props.scrollY=e},letterSpacing:function(e,n){e.props.letterSpacing=n,t.invalidateLayoutCache(e)}}}},{key:"canRenderFont",value:function(t){return!0}},{key:"isFontFaceSupported",value:function(t){return t instanceof F}},{key:"addFontFace",value:function(t){o(t instanceof F),Ke.add(t.fontFace)}},{key:"createState",value:function(t){return{props:t,status:"initialState",updateScheduled:!1,emitter:new a,canvasPages:void 0,lightning2TextRenderer:new Ze(this.canvas,this.context),renderWindow:void 0,visibleWindow:{x1:0,y1:0,x2:0,y2:0,valid:!1},renderInfo:void 0,forceFullLayoutCalc:!1,textW:0,textH:0,fontInfo:void 0,fontFaceLoadedHandler:void 0,debugData:{updateCount:0,layoutCount:0,drawCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,bufferSize:0}}}},{key:"updateState",value:function(t){if("initialState"===t.status&&this.setStatus(t,"loading"),!t.fontInfo){var e=(n=t.props,i=n.fontFamily,r=n.fontStyle,o=n.fontWeight,s=n.fontStretch,a=n.fontSize,[r,o,s,"".concat(a,"px"),i].join(" "));if(t.fontInfo={cssString:e,loaded:!1},!t.fontInfo.loaded)return void Ke.load(e).then(this.onFontLoaded.bind(this,t,e)).catch(this.onFontLoadError.bind(this,t,e))}var n,i,r,o,s,a;if(t.fontInfo.loaded){t.renderInfo||(t.lightning2TextRenderer.settings={text:t.props.text,textAlign:t.props.textAlign,fontFace:t.props.fontFamily,fontSize:t.props.fontSize,fontStyle:[t.props.fontStretch,t.props.fontStyle,t.props.fontWeight].join(" "),textColor:C(t.props.color),offsetY:t.props.fontSize+t.props.offsetY,wordWrap:"none"!==t.props.contain,wordWrapWidth:"none"===t.props.contain?void 0:t.props.width,letterSpacing:t.props.letterSpacing},t.renderInfo=t.lightning2TextRenderer.calculateRenderInfo(),t.textH=t.renderInfo.lineHeight*t.renderInfo.lines.length,t.textW=t.renderInfo.width,t.renderWindow=void 0);var u=t.props,l=u.x,h=u.y,c=u.width,f=u.height,d=u.scrollY,A=u.contain,g=t.visibleWindow,p=t.renderWindow,v=t.canvasPages;if(!g.valid){var _=R(l,h,"none"!==A?l+c:1/0,"both"===A?h+f:1/0,Je);P(this.rendererBounds,_,g),g.valid=!0}var y=g.y2-g.y1,x=Math.ceil(y/t.renderInfo.lineHeight);if(0===y)return v=void 0,p=void 0,void this.setStatus(t,"loaded");if(p&&v){var m=l+p.x1,k=h-d+p.y1,T=l+p.x2,b=h-d+p.y2;if(m<=g.x1&&T>=g.x2&&k<=g.y1&&b>=g.y2)return void this.setStatus(t,"loaded");b<g.y2?(p.y1+=x*t.renderInfo.lineHeight,p.y2+=x*t.renderInfo.lineHeight,v.push(v.shift()),v[2].lineNumStart=v[1].lineNumStart+x,v[2].lineNumEnd=v[2].lineNumStart+x,v[2].valid=!1):k>g.y1&&(p.y1-=x*t.renderInfo.lineHeight,p.y2-=x*t.renderInfo.lineHeight,v.unshift(v.pop()),v[0].lineNumStart=v[1].lineNumStart-x,v[0].lineNumEnd=v[0].lineNumStart+x,v[0].valid=!1)}else{var S,E,I,L=t.renderInfo.lineHeight*x,M=Math.ceil(d/L),z=M*x,B=z-x,O=z+x;v=[{texture:null===(S=v)||void 0===S?void 0:S[0].texture,lineNumStart:B,lineNumEnd:B+x,valid:!1},{texture:null===(E=v)||void 0===E?void 0:E[1].texture,lineNumStart:z,lineNumEnd:z+x,valid:!1},{texture:null===(I=v)||void 0===I?void 0:I[2].texture,lineNumStart:O,lineNumEnd:O+x,valid:!1}],t.canvasPages=v;var D=M*L;p={x1:0,y1:D-L,x2:c,y2:D+2*L}}t.renderWindow=p,performance.now();var F,N=w(v);try{for(N.s();!(F=N.n()).done;){var U=F.value;U.valid||(U.lineNumStart<0?(U.texture=this.stage.txManager.loadTexture("ImageTexture",{src:""}),U.valid=!0):(t.lightning2TextRenderer.draw(t.renderInfo,{lines:t.renderInfo.lines.slice(U.lineNumStart,U.lineNumEnd),lineWidths:t.renderInfo.lineWidths.slice(U.lineNumStart,U.lineNumEnd)}),0!==this.canvas.width&&0!==this.canvas.height&&(U.texture=this.stage.txManager.loadTexture("ImageTexture",{src:this.context.getImageData(0,0,this.canvas.width,this.canvas.height)},{preload:!0})),U.valid=!0))}}catch(j){N.e(j)}finally{N.f()}this.setStatus(t,"loaded")}}},{key:"renderQuads",value:function(t,e,n,i){var r=this.stage,s=t.canvasPages,a=t.textW,u=void 0===a?0:a,l=t.textH,h=void 0===l?0:l,c=t.renderWindow;if(s&&c){var f=t.props,d=f.x,A=f.y,g=f.scrollY,v=f.contain,_=f.width,y=f.height,m={x:d,y:A,width:"none"!==v?_:u,height:"both"===v?y:h};x({x:0,y:0,width:r.options.appWidth,height:r.options.appHeight},m),o(s,"canvasPages is not defined"),o(c,"renderWindow is not defined");var k,T,b,w,C,S,E=(c.y2-c.y1)/3,I=t.props,L=I.zIndex,R=I.color,M=i*N(R),P=p(4294967295,M);if(s[0].valid)this.stage.renderer.addQuad({alpha:M,clippingRect:n,colorBl:P,colorBr:P,colorTl:P,colorTr:P,width:(null===(k=s[0].texture)||void 0===k||null===(k=k.dimensions)||void 0===k?void 0:k.width)||0,height:(null===(T=s[0].texture)||void 0===T||null===(T=T.dimensions)||void 0===T?void 0:T.height)||0,texture:s[0].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:L,tx:e.tx,ty:e.ty-g+c.y1,ta:e.ta,tb:e.tb,tc:e.tc,td:e.td});if(s[1].valid)this.stage.renderer.addQuad({alpha:M,clippingRect:n,colorBl:P,colorBr:P,colorTl:P,colorTr:P,width:(null===(b=s[1].texture)||void 0===b||null===(b=b.dimensions)||void 0===b?void 0:b.width)||0,height:(null===(w=s[1].texture)||void 0===w||null===(w=w.dimensions)||void 0===w?void 0:w.height)||0,texture:s[1].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:L,tx:e.tx,ty:e.ty-g+c.y1+E,ta:e.ta,tb:e.tb,tc:e.tc,td:e.td});if(s[2].valid)this.stage.renderer.addQuad({alpha:M,clippingRect:n,colorBl:P,colorBr:P,colorTl:P,colorTr:P,width:(null===(C=s[2].texture)||void 0===C||null===(C=C.dimensions)||void 0===C?void 0:C.width)||0,height:(null===(S=s[2].texture)||void 0===S||null===(S=S.dimensions)||void 0===S?void 0:S.height)||0,texture:s[2].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:L,tx:e.tx,ty:e.ty-g+c.y1+E+E,ta:e.ta,tb:e.tb,tc:e.tc,td:e.td})}}},{key:"invalidateVisibleWindowCache",value:function(t){t.visibleWindow.valid=!1,this.setStatus(t,"loading"),this.scheduleUpdateState(t)}},{key:"invalidateLayoutCache",value:function(t){t.renderInfo=void 0,this.setStatus(t,"loading"),this.scheduleUpdateState(t)}},{key:"onFontLoaded",value:function(t,e){var n;e===(null===(n=t.fontInfo)||void 0===n?void 0:n.cssString)&&t.fontInfo&&(t.fontInfo.loaded=!0,this.scheduleUpdateState(t))}},{key:"onFontLoadError",value:function(t,e,n){var i;e===(null===(i=t.fontInfo)||void 0===i?void 0:i.cssString)&&t.fontInfo&&(t.fontInfo.loaded=!0,console.error("CanvasTextRenderer: Error loading font '".concat(t.fontInfo.cssString,"'"),n),this.scheduleUpdateState(t))}}]),n}(We),tn=function(t){l(n,t);var e=c(n);function n(t){var i;_(this,n),k(d(i=e.call(this)),"options",void 0),k(d(i),"animationManager",void 0),k(d(i),"txManager",void 0),k(d(i),"fontManager",void 0),k(d(i),"textRenderers",void 0),k(d(i),"shManager",void 0),k(d(i),"renderer",void 0),k(d(i),"root",void 0),k(d(i),"deltaTime",0),k(d(i),"lastFrameTime",0),k(d(i),"currentFrameTime",0),k(d(i),"fpsNumFrames",0),k(d(i),"fpsElapsedTime",0),k(d(i),"renderRequested",!1),i.options=t;var r=t.canvas,s=t.clearColor,a=t.rootId,u=t.debug,l=t.appWidth,h=t.appHeight;i.txManager=new Ue,i.shManager=new Oe,i.animationManager=new De,null!=u&&u.monitorTextureCache&&setInterval((function(){o(i.txManager);var t=i.txManager.getDebugInfo();console.log("Texture ID Cache Size: ",t.idCacheSize),console.log("Texture Key Cache Size: ",t.keyCacheSize)}),1e3),i.renderer=new U({stage:d(i),canvas:r,pixelRatio:t.devicePhysicalPixelRatio*t.deviceLogicalPixelRatio,clearColor:null!=s?s:4278190080,bufferMemory:2e6,txManager:i.txManager,shManager:i.shManager}),i.txManager.renderer=i.renderer,i.textRenderers={canvas:new $e(d(i)),sdf:new Ve(d(i))},i.fontManager=new je(i.textRenderers);var c=new de(d(i),{id:a,x:0,y:0,width:l,height:h,alpha:1,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:null,shader:null,shaderProps:null});return i.root=c,function(t){requestAnimationFrame((function e(){t.updateAnimations(),t.hasSceneUpdates()?(t.drawFrame(),requestAnimationFrame(e)):setTimeout(e,16.666666666666668)}))}(d(i)),i}return v(n,[{key:"updateAnimations",value:function(){var t=this.animationManager;this.root&&(this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=performance?performance.now():Date.now(),this.deltaTime=this.lastFrameTime?this.currentFrameTime-this.lastFrameTime:100/6,t.update(this.deltaTime))}},{key:"hasSceneUpdates",value:function(){return!!this.root.updateType||this.renderRequested}},{key:"drawFrame",value:function(){var t=this.renderer,e=this.renderRequested;0!==this.root.updateType&&this.root.update(this.deltaTime),null==t||t.reset(),this.addQuads(this.root),null==t||t.render(),e&&(this.renderRequested=!1);var n=this.options.fpsUpdateInterval;if(n&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=n)){var i=Math.round(1e3*this.fpsNumFrames/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.emit("fpsUpdate",i)}}},{key:"addQuads",value:function(t){o(this.renderer&&t.globalTransform),t.isRenderable&&t.renderQuads(this.renderer);for(var e=0;e<t.children.length;e++){var n=t.children[e];n&&(0!==(null==n?void 0:n.worldAlpha)&&this.addQuads(n))}}},{key:"requestRender",value:function(){this.renderRequested=!0}},{key:"resolveTextRenderer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!1;if(e){var i=this.textRenderers[e];i?i.canRenderFont(t)||(console.warn("Cannot use override text renderer '".concat(e,"' for font"),t),e=null,n=!0):(console.warn("Text renderer override '".concat(e,"' not found.")),e=null,n=!0)}if(!e){for(var r=0,s=Object.entries(this.textRenderers);r<s.length;r++){var a=b(s[r],2),u=a[0],l=a[1];if("canvas"!==u&&l.canRenderFont(t)){e=u;break}}e||(e="canvas")}n&&console.warn("Falling back to text renderer ".concat(String(e)));var h=this.textRenderers[e];return o(h,"resolvedTextRenderer undefined"),h}}]),n}(a),en=function(t){l(n,t);var e=c(n);function n(t,i){var r;_(this,n),k(d(r=e.call(this,t,i)),"textRenderer",void 0),k(d(r),"trState",void 0),k(d(r),"_textRendererOverride",null),k(d(r),"onTextLoaded",(function(){var t=d(r).contain,e=r.trState.props.width,n=r.trState.props.height,i=r.trState.textW||0,o=r.trState.textH||0;"both"===t?(r.props.width=e,r.props.height=n):"width"===t?(r.props.width=e,r.props.height=o):"none"===t&&(r.props.width=i,r.props.height=o),r.updateLocalTransform(),r.stage.requestRender(),r.emit("loaded",{type:"text",dimensions:{width:r.trState.textW||0,height:r.trState.textH||0}})})),k(d(r),"onTextFailed",(function(t,e){r.emit("failed",{type:"text",error:e})})),r._textRendererOverride=i.textRendererOverride;var o=r.resolveTextRendererAndState({x:r.absX,y:r.absY,width:i.width,height:i.height,textAlign:i.textAlign,color:i.color,zIndex:i.zIndex,contain:i.contain,scrollable:i.scrollable,scrollY:i.scrollY,offsetY:i.offsetY,letterSpacing:i.letterSpacing,debug:i.debug,fontFamily:i.fontFamily,fontSize:i.fontSize,fontStretch:i.fontStretch,fontStyle:i.fontStyle,fontWeight:i.fontWeight,text:i.text},void 0),s=o.resolvedTextRenderer,a=o.textRendererState;return r.textRenderer=s,r.trState=a,r}return v(n,[{key:"width",get:function(){return this.trState.props.width},set:function(t){this.textRenderer.set.width(this.trState,t)}},{key:"height",get:function(){return this.trState.props.height},set:function(t){this.textRenderer.set.height(this.trState,t)}},{key:"color",get:function(){return this.trState.props.color},set:function(t){this.textRenderer.set.color(this.trState,t)}},{key:"text",get:function(){return this.trState.props.text},set:function(t){this.textRenderer.set.text(this.trState,t),this.checkIsRenderable()}},{key:"textRendererOverride",get:function(){return this._textRendererOverride},set:function(t){this._textRendererOverride=t;var e=this.resolveTextRendererAndState(this.trState.props,this.trState),n=e.resolvedTextRenderer,i=e.textRendererState;this.textRenderer=n,this.trState=i}},{key:"fontSize",get:function(){return this.trState.props.fontSize},set:function(t){this.textRenderer.set.fontSize(this.trState,t)}},{key:"fontFamily",get:function(){return this.trState.props.fontFamily},set:function(t){this.textRenderer.set.fontFamily(this.trState,t)}},{key:"fontStretch",get:function(){return this.trState.props.fontStretch},set:function(t){this.textRenderer.set.fontStretch(this.trState,t)}},{key:"fontStyle",get:function(){return this.trState.props.fontStyle},set:function(t){this.textRenderer.set.fontStyle(this.trState,t)}},{key:"fontWeight",get:function(){return this.trState.props.fontWeight},set:function(t){this.textRenderer.set.fontWeight(this.trState,t)}},{key:"textAlign",get:function(){return this.trState.props.textAlign},set:function(t){this.textRenderer.set.textAlign(this.trState,t)}},{key:"contain",get:function(){return this.trState.props.contain},set:function(t){this.textRenderer.set.contain(this.trState,t)}},{key:"scrollable",get:function(){return this.trState.props.scrollable},set:function(t){this.textRenderer.set.scrollable(this.trState,t)}},{key:"scrollY",get:function(){return this.trState.props.scrollY},set:function(t){this.textRenderer.set.scrollY(this.trState,t)}},{key:"offsetY",get:function(){return this.trState.props.offsetY},set:function(t){this.textRenderer.set.offsetY(this.trState,t)}},{key:"letterSpacing",get:function(){return this.trState.props.letterSpacing},set:function(t){this.textRenderer.set.letterSpacing(this.trState,t)}},{key:"debug",get:function(){return this.trState.props.debug},set:function(t){this.textRenderer.set.debug(this.trState,t)}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(g(n.prototype),"update",this).call(this,t,e),o(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}},{key:"checkIsRenderable",value:function(){return!!r(g(n.prototype),"checkIsRenderable",this).call(this)||(""!==this.trState.props.text?this.isRenderable=!0:this.isRenderable=!1)}},{key:"renderQuads",value:function(t){o(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha)}},{key:"resolveTextRendererAndState",value:function(t,e){var n=this.stage.resolveTextRenderer(t,this._textRendererOverride),i=n.createState(t);return e&&["loading","loaded","failed"].forEach((function(t){e.emitter.off(t)})),i.emitter.on("loaded",this.onTextLoaded),i.emitter.on("failed",this.onTextFailed),n.scheduleUpdateState(i),{resolvedTextRenderer:n,textRendererState:i}}}]),n}(de),nn=function(t){l(n,t);var e=c(n);function n(t,i,r){return _(this,n),e.call(this,t,i,r,new en(r,{id:ge(),x:t.x,y:t.y,width:t.width,height:t.height,alpha:t.alpha,clipping:t.clipping,color:t.color,colorTop:t.colorTop,colorBottom:t.colorBottom,colorLeft:t.colorLeft,colorRight:t.colorRight,colorTl:t.colorTl,colorTr:t.colorTr,colorBl:t.colorBl,colorBr:t.colorBr,zIndex:t.zIndex,zIndexLocked:t.zIndexLocked,scaleX:t.scaleX,scaleY:t.scaleY,mountX:t.mountX,mountY:t.mountY,mount:t.mount,pivot:t.pivot,pivotX:t.pivotX,pivotY:t.pivotY,rotation:t.rotation,text:t.text,fontSize:t.fontSize,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontStretch:t.fontStretch,fontStyle:t.fontStyle,contain:t.contain,scrollable:t.scrollable,letterSpacing:t.letterSpacing,textAlign:t.textAlign,scrollY:t.scrollY,offsetY:t.offsetY,textRendererOverride:t.textRendererOverride,debug:t.debug,parent:null,texture:null,textureOptions:null,shader:null,shaderProps:null}))}return v(n,[{key:"text",get:function(){return this.coreNode.text},set:function(t){this.coreNode.text=t}},{key:"textRendererOverride",get:function(){return this.coreNode.textRendererOverride},set:function(t){this.coreNode.textRendererOverride=t}},{key:"fontSize",get:function(){return this.coreNode.fontSize},set:function(t){this.coreNode.fontSize=t}},{key:"fontFamily",get:function(){return this.coreNode.fontFamily},set:function(t){this.coreNode.fontFamily=t}},{key:"fontWeight",get:function(){return this.coreNode.fontWeight},set:function(t){this.coreNode.fontWeight=t}},{key:"fontStretch",get:function(){return this.coreNode.fontStretch},set:function(t){this.coreNode.fontStretch=t}},{key:"fontStyle",get:function(){return this.coreNode.fontStyle},set:function(t){this.coreNode.fontStyle=t}},{key:"textAlign",get:function(){return this.coreNode.textAlign},set:function(t){this.coreNode.textAlign=t}},{key:"contain",get:function(){return this.coreNode.contain},set:function(t){this.coreNode.contain=t}},{key:"scrollable",get:function(){return this.coreNode.scrollable},set:function(t){this.coreNode.scrollable=t}},{key:"scrollY",get:function(){return this.coreNode.scrollY},set:function(t){this.coreNode.scrollY=t}},{key:"offsetY",get:function(){return this.coreNode.offsetY},set:function(t){this.coreNode.offsetY=t}},{key:"letterSpacing",get:function(){return this.coreNode.letterSpacing},set:function(t){this.coreNode.letterSpacing=t}},{key:"debug",get:function(){return this.coreNode.debug},set:function(t){this.coreNode.debug=t}}]),n}(pe),rn=function(t,e,n){return t()};function on(t,e){return sn.apply(this,arguments)}function sn(){return sn=u(s().mark((function t(e,n){var r,o,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("Loading core extension",e),t.next=4,rn((function(){return i.import(e)}),void 0,i.meta.url);case 4:r=t.sent,t.next=12;break;case 7:return t.prev=7,t.t0=t.catch(0),console.error("The core extension module at '".concat(e,"' could not be loaded.")),console.error(t.t0),t.abrupt("return");case 12:if(r.default){t.next=15;break}return console.error("The core extension module at '".concat(e,"' does not have a default export.")),t.abrupt("return");case 15:if(o=r.default,!(o.prototype instanceof j)){t.next=29;break}return a=new o,t.prev=18,t.next=21,a.run(n);case 21:t.next=27;break;case 23:t.prev=23,t.t1=t.catch(18),console.error("The core extension at '".concat(e,"' threw an error.")),console.error(t.t1);case 27:t.next=30;break;case 29:console.error("The core extension at '".concat(e,"' does not extend CoreExtension."));case 30:case"end":return t.stop()}}),t,null,[[0,7],[18,23]])}))),sn.apply(this,arguments)}var an,un,ln=function(){function t(){_(this,t),k(this,"root",null),k(this,"stage",null),k(this,"rendererMain",null)}var e;return v(t,[{key:"init",value:(e=u(s().mark((function t(e,n,i){var r,a=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.stage=new tn({rootId:ge(),appWidth:n.appWidth,appHeight:n.appHeight,deviceLogicalPixelRatio:n.deviceLogicalPixelRatio,devicePhysicalPixelRatio:n.devicePhysicalPixelRatio,clearColor:n.clearColor,canvas:i,fpsUpdateInterval:n.fpsUpdateInterval,debug:{monitorTextureCache:!1}}),this.rendererMain=e,o(this.stage.root),r=new pe(e.resolveNodeDefaults({}),this.rendererMain,this.stage,this.stage.root),this.root=r,r.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,r)),this.onCreateNode(r),!n.coreExtensionModule){t.next=10;break}return t.next=10,on(n.coreExtensionModule,this.stage);case 10:this.stage.on("fpsUpdate",(function(t,e){a.onFpsUpdate(e)}));case 11:case"end":return t.stop()}}),t,this)}))),function(t,n,i){return e.apply(this,arguments)})},{key:"createNode",value:function(t){o(this.rendererMain),o(this.stage);var e=new pe(t,this.rendererMain,this.stage);return e.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,e)),this.onCreateNode(e),e}},{key:"createTextNode",value:function(t){o(this.rendererMain),o(this.stage);var e=new nn(t,this.rendererMain,this.stage);return e.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,e)),this.onCreateNode(e),e}},{key:"destroyNode",value:function(t){t.destroy()}},{key:"releaseTexture",value:function(t){var e=this.stage;o(e),e.txManager.removeTextureIdFromCache(t)}},{key:"getRootNode",value:function(){return o(this.root),this.root}},{key:"onCreateNode",value:function(t){throw new Error("Method not implemented.")}},{key:"onBeforeDestroyNode",value:function(t){throw new Error("Method not implemented.")}},{key:"onFpsUpdate",value:function(t){throw new Error("Method not implemented.")}}]),t}();function hn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new ln;return an=new ue(t,t.rootId||"app",e),un=an.createShader.bind(an),an}var cn=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this))._parent=t,i}return v(n,[{key:"selected",get:function(){return this[this._parent.selected||0]}},{key:"firstChild",get:function(){return this[0]}},{key:"insert",value:function(t,e){if(e){var n=this.indexOf(e);this.splice(n,0,t)}else this.push(t);t.parent=this._parent,this._parent._isDirty=!0}},{key:"remove",value:function(t){var e=this.indexOf(t);e>=0&&this.splice(e,1)}}]),n}(n(Array));i.meta.env={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1,LEGACY:!0}||{MODE:"development"};var fn={debug:!1,animationSettings:{duration:250,easing:"ease-in-out"},fontSettings:{fontFamily:"Ubuntu",fontSize:100}};function dn(t){return"function"==typeof t}function An(t){return Array.isArray(t)}var gn=function(t){l(n,t);var e=c(n);function n(t){var i,r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_(this,n);var s=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];i=e.call.apply(e,[r].concat(n))};return An(o)?s.apply(void 0,y(o)):"string"==typeof o?s(o):s.apply(void 0,y(Object.entries(o).filter((function(t){var e=b(t,2);e[0];return e[1]})).map((function(t){return b(t,1)[0]})))),i.onChange=t,f(i,d(i))}return v(n,[{key:"has",value:function(t){return this.indexOf(t)>=0}},{key:"is",value:function(t){return this.indexOf(t)>=0}},{key:"add",value:function(t){this.push(t),this.onChange()}},{key:"toggle",value:function(t){this.has(t)?this.remove(t):this.add(t)}},{key:"remove",value:function(t){var e=this.indexOf(t);e>=0&&(this.splice(e,1),this.onChange())}}]),n}(n(Array));var pn=fn.animationSettings;function vn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{set:function(e){"number"==typeof e&&(e={width:e,color:255}),this.effects=m(m({},this.effects||{}),k({},"border".concat(t),e)),this["_border".concat(t)]=e},get:function(){return this["_border".concat(t)]}}}var _n=["alpha","color","colorTop","colorRight","colorLeft","colorBottom","colorTl","colorTr","colorBl","colorBr","height","fontSize","lineHeight","mount","mountX","mountY","pivot","pivotX","pivotY","rotation","scale","width","worldX","worldY","x","y","zIndex","zIndexLocked"],yn=["clipping","contain","fontFamily","src","text","textAlign","texture","maxLines","maxLinesSuffix","textBaseline","textOverflow","verticalAlign","wordWrap"],xn=function(t){l(n,t);var e=c(n);function n(t){var i;_(this,n),(i=e.call(this)).lng=null,i._parent=null,i.name=t,i.rendered=!1,i.autofocus=!1,i._renderProps={x:0,y:0},i.children=new cn(d(i));var r,o=w(_n);try{var s=function(){var t=r.value;Object.defineProperty(d(i),t,{get:function(){return this["_".concat(t)]||this.lng&&this.lng[t]},set:function(e){var n;this["_".concat(t)]=An(n=e)?n[0]:n,this._sendToLightningAnimatable(t,e)}})};for(o.s();!(r=o.n()).done;)s()}catch(h){o.e(h)}finally{o.f()}var a,u=w(yn);try{var l=function(){var t=a.value;Object.defineProperty(d(i),t,{get:function(){return this["_".concat(t)]||this.lng&&this.lng[t]},set:function(e){this["_".concat(t)]=e,this._sendToLightning(t,e)}})};for(u.s();!(a=u.n()).done;)l()}catch(h){u.e(h)}finally{u.f()}return Object.defineProperties(d(i),{borderRadius:{set:function(t){this._borderRadius=t,this.effects=m(m({},this.effects||{}),{radius:{radius:t}})},get:function(){return this._borderRadius}},border:vn(),borderLeft:vn("Left"),borderRight:vn("Right"),borderTop:vn("Top"),borderBottom:vn("Bottom")}),Object.defineProperties(d(i),{linearGradient:{set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._linearGradient=t,this.effects=m(m({},this.effects||{}),{linearGradient:t})},get:function(){return this._linearGradient}}}),i}return v(n,[{key:"effects",get:function(){return this._effects},set:function(t){this._effects=t,this.shader=function(t){for(var e=[],n=0,i=Object.entries(t);n<i.length;n++){var r=b(i[n],2),o=r[0],s=r[1];e.push({type:o,props:s})}return un("DynamicShader",{effects:e})}(t)}},{key:"parent",get:function(){return this._parent},set:function(t){var e;(this._parent=t,this.rendered&&this.lng)&&(this.lng.parent=null!==(e=null==t?void 0:t.lng)&&void 0!==e?e:null)}},{key:"shader",get:function(){return this._shader},set:function(t){An(t)?this._shader=un.apply(void 0,y(t)):this._shader=t,this._sendToLightning("shader",this._shader)}},{key:"_sendToLightningAnimatable",value:function(t,e){if(this.rendered&&this.lng){if(An(e))return this.createAnimation(k({},t,e[0]),e[1]).start();if(this._animate)return this.createAnimation(k({},t,e)).start();this.lng[t]=e}else An(e)&&(e=e[0]),this._renderProps[t]=e}},{key:"_sendToLightning",value:function(t,e){this.rendered&&this.lng?this.lng[t]=e:this._renderProps[t]=e}},{key:"createAnimation",value:function(t,e){return o(this.lng,"Node must be rendered before animating"),this.lng.animate(t,e||this.animationSettings)}},{key:"setFocus",value:function(){this.rendered?re(this):this.autofocus=!0}},{key:"isTextNode",value:function(){return"text"===this.name}},{key:"_resizeOnTextLoad",value:function(){var t=this;this.lng.once("loaded",(function(e,n){if("text"===n.type){var i=n.dimensions;t.width=i.width,t.height=i.height,t.parent.updateLayout(t,i)}}))}},{key:"getText",value:function(){return this.children.map((function(t){return t.text})).join("")}},{key:"destroy",value:function(){this.lng&&an.destroyNode(this.lng)}},{key:"style",get:function(){return this._style},set:function(t){for(var e in t)"animate"===e&&(e="_animate"),this[e]||(this[e]=t[e]);this._style=t}},{key:"hasChildren",get:function(){return this.children.length>0}},{key:"states",get:function(){return this._states=this._states||new gn(this._stateChanged.bind(this)),this._states},set:function(t){this._states=new gn(this._stateChanged.bind(this),t),this.rendered&&this._stateChanged()}},{key:"animationSettings",get:function(){return this._animationSettings||pn},set:function(t){this._animationSettings=t}},{key:"updateLayout",value:function(t,e){if(this.hasChildren){var n;if(dn(this.onBeforeLayout)&&this.onBeforeLayout.call(this,t,e),"flex"===this.display)if(function(t){for(var e=[],n=0;n<t.children.length;n++){var i=t.children[n];if("TextNode"!==i.name){if("text"===i.name&&!i.width&&!i.height)return!1;e.push(i)}}var r=e.length,s="row"===(t.flexDirection||"row"),a=s?"width":"height",u=s?"height":"width",l=s?"marginLeft":"marginTop",h=s?"marginRight":"marginBottom",c=s?"x":"y",f=s?"y":"x",d=t[a]||0,A=t[u]||0,g=t.gap||0,p=t.justifyContent||"flexStart",v=t.alignItems,_=0;["center","spaceBetween","spaceEvenly"].includes(p)&&(_=e.reduce((function(t,e){return t+(e[a]||0)}),0));var y=A&&v?function(t){"flexStart"===v?t[f]=0:"center"===v?t[f]=(A-(t[u]||0))/2:"flexEnd"===v&&(t[f]=A-(t[u]||0))}:function(t){return t};if("flexStart"===p){var x=0;if(e.forEach((function(t){t[c]=x+(t[l]||0),x+=(t[a]||0)+g+(t[l]||0)+(t[h]||0),y(t)})),t._autosized){var m=x-g;if(m!==t[a])return t[a]=m,!0}}else if("flexEnd"===p)for(var k=d,T=r-1;T>=0;T--){var b=e[T];o(b),b[c]=k-(b[a]||0)-(b[h]||0),k-=(b[a]||0)+g+(b[l]||0)+(b[h]||0),y(b)}else if("center"===p){var w=(d-(_+g*(r-1)))/2;e.forEach((function(t){t[c]=w,w+=(t[a]||0)+g,y(t)}))}else if("spaceBetween"===p){var C=(d-_)/(r-1),S=0;e.forEach((function(t){t[c]=S,S+=(t[a]||0)+C,y(t)}))}else if("spaceEvenly"===p){var E=(d-_)/(r+1),I=E;e.forEach((function(t){t[c]=I,I+=(t[a]||0)+E,y(t)}))}return!1}(this))null===(n=this.parent)||void 0===n||n.updateLayout();dn(this.onLayout)&&this.onLayout.call(this,t,e)}}},{key:"_stateChanged",value:function(){var t,e=this;if(this.states,this.forwardStates){var n=this.states.slice();this.children.forEach((function(t){return t.states=n}))}var i=(null===(t=fn.stateMapperHook)||void 0===t?void 0:t.call(fn,this,this.states))||this.states;if(this._undoStates||this.style&&function(t,e){var n,i=w(e);try{for(i.s();!(n=i.n()).done;)if(n.value in t)return!0}catch(r){i.e(r)}finally{i.f()}return!1}(this.style,i)){this._undoStates=this._undoStates||{};for(var r={},o=0,s=Object.entries(this._undoStates);o<s.length;o++){var a=b(s[o],2),u=a[0],l=a[1];i.includes(u)||(r=m(m({},r),l))}var h=i.reduce((function(t,n){var i=e.style[n];return i&&(t=m(m({},t),i),e._undoStates&&!e._undoStates[n]&&(e._undoStates[n]={},Object.keys(i).forEach((function(t){e._undoStates[n][t]=e[t]})))),t}),{});Object.assign(this,m(m({},r),h))}}},{key:"render",value:function(){var t=this,e=this.parent;e._isDirty&&(e.updateLayout(),e._isDirty=!1),t.updateLayout(),this.states.length&&this._stateChanged();var n=t._renderProps;e.lng&&(n.parent=e.lng),t.isTextNode()?((n=m(m(m({},fn.fontSettings),n),{},{text:t.getText()})).contain&&(n.width||(n.width=(e.width||0)-n.x-(n.marginRight||0),t._width=n.width,t._autosized=!0),n.height||"both"!==n.contain||(n.height=(e.height||0)-n.y-(n.marginBottom||0),t._height=n.height,t._autosized=!0)),t.lng=an.createTextNode(n),dn(this.onCreate)&&this.onCreate.call(this,t),dn(t.onLoad)&&t.lng.on("loaded",t.onLoad),t.width&&t.height||(t._autosized=!0,t._resizeOnTextLoad())):(n.src||n.texture||(isNaN(n.width)&&(n.width=(e.width||0)-n.x,t._width=n.width,t._autosized=!0),isNaN(n.height)&&(n.height=(e.height||0)-n.y,t._height=n.height,t._autosized=!0),n.color||(t._color=n.color=0)),t.lng=an.createNode(n),t.onFail&&t.lng.on("failed",t.onFail),t.onLoad&&t.lng.on("loaded",t.onLoad),dn(this.onCreate)&&this.onCreate.call(this,t)),t.rendered=!0,t.autofocus&&t.setFocus(),delete this._renderProps}}]),n}(n(Object)),mn=function(t){return e=Rn("text"),Pn(e,t,!1),e;var e},kn=function(t){return e=Rn("node"),Pn(e,t,!1),e;var e};function Tn(t){"TextNode"!==t.name&&(o(t instanceof xn),t.render(),t.children.forEach((function(t){return Tn(t)})))}var bn=function(t){var e,n,i=hn(t.options),r=i.init();return vt((function(){r.then((function(){o(e),e.lng=i.root,e.children.forEach(Tn),dn(t.onFirstRender)&&t.onFirstRender(e)})).catch(console.error)})),n=Rn("canvas"),"function"==typeof e?On(e,n):e=n,Mn(n,(function(){return t.children})),n};function wn(t){var e=t.createElement,n=t.createTextNode,i=t.isTextNode,r=t.replaceText,o=t.insertNode,s=t.removeNode,a=t.setProperty,u=t.getParentNode,l=t.getFirstChild,h=t.getNextSibling;function c(t,e,n,i){if(void 0===n||i||(i=[]),"function"!=typeof e)return f(t,e,i,n);pt((function(i){return f(t,e(),i,n)}),i)}function f(t,e,s,a,u){for(;"function"==typeof s;)s=s();if(e===s)return s;var h=typeof e,c=void 0!==a;if("string"===h||"number"===h)if("number"===h&&(e=e.toString()),c){var _=s[0];_&&i(_)?r(_,e):_=n(e),s=g(t,s,a,_)}else""!==s&&"string"==typeof s?r(l(t),s=e):(g(t,s,a,n(e)),s=e);else if(null==e||"boolean"===h)s=g(t,s,a);else{if("function"===h)return pt((function(){for(var n=e();"function"==typeof n;)n=n();s=f(t,n,s,a)})),function(){return s};if(Array.isArray(e)){var y=[];if(d(y,e,u))return pt((function(){return s=f(t,y,s,a,!0)})),function(){return s};if(0===y.length){var x=g(t,s,a);if(c)return s=x}else Array.isArray(s)?0===s.length?p(t,y,a):A(t,s,y):null==s||""===s?p(t,y):A(t,c&&s||[l(t)],y);s=y}else{if(Array.isArray(s)){if(c)return s=g(t,s,a,e);g(t,s,null,e)}else null!=s&&""!==s&&l(t)?v(t,e,l(t)):o(t,e);s=e}}return s}function d(t,e,i){for(var r=!1,o=0,s=e.length;o<s;o++){var a=e[o],u=void 0;if(null==a||!0===a||!1===a);else if(Array.isArray(a))r=d(t,a)||r;else if("string"==(u=typeof a)||"number"===u)t.push(n(a));else if("function"===u)if(i){for(;"function"==typeof a;)a=a();r=d(t,Array.isArray(a)?a:[a])||r}else t.push(a),r=!0;else t.push(a)}return r}function A(t,e,n){for(var i=n.length,r=e.length,a=i,u=0,l=0,c=h(e[r-1]),f=null;u<r||l<a;)if(e[u]!==n[l]){for(;e[r-1]===n[a-1];)r--,a--;if(r===u)for(var d=a<i?l?h(n[l-1]):n[a-l]:c;l<a;)o(t,n[l++],d);else if(a===l)for(;u<r;)f&&f.has(e[u])||s(t,e[u]),u++;else if(e[u]===n[a-1]&&n[l]===e[r-1]){var A=h(e[--r]);o(t,n[l++],h(e[u++])),o(t,n[--a],A),e[r]=n[a]}else{if(!f){f=new Map;for(var g=l;g<a;)f.set(n[g],g++)}var p=f.get(e[u]);if(null!=p)if(l<p&&p<a){for(var _=u,y=1,x=void 0;++_<r&&_<a&&null!=(x=f.get(e[_]))&&x===p+y;)y++;if(y>p-l)for(var m=e[u];l<p;)o(t,n[l++],m);else v(t,n[l++],e[u++])}else u++;else s(t,e[u++])}}else u++,l++}function g(t,e,i,r){if(void 0===i){for(var a;a=l(t);)s(t,a);return r&&o(t,r),""}var h=r||n("");if(e.length)for(var c=!1,f=e.length-1;f>=0;f--){var d=e[f];if(h!==d){var A=u(d)===t;c||f?A&&s(t,d):A?v(t,h,d):o(t,h,i)}else c=!0}else o(t,h,i);return[h]}function p(t,e,n){for(var i=0,r=e.length;i<r;i++)o(t,e[i],n)}function v(t,e,n){o(t,e,n),s(t,n)}function _(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e||(e={}),(arguments.length>3?arguments[3]:void 0)||pt((function(){return n.children=f(t,e.children,n.children)})),pt((function(){return e.ref&&e.ref(t)})),pt((function(){for(var i in e)if("children"!==i&&"ref"!==i){var r=e[i];r!==n[i]&&(a(t,i,r,n[i]),n[i]=r)}})),n}return{render:function(t,e){var n;return dt((function(i){n=i,c(e,t())})),n},insert:c,spread:function(t,e,n){"function"==typeof e?pt((function(i){return _(t,e(),i,n)})):_(t,e,void 0,n)},createElement:e,createTextNode:n,insertNode:o,setProp:function(t,e,n,i){return a(t,e,n,i),n},mergeProps:Kt,effect:pt,memo:_t,createComponent:Yt,use:function(t,e,n){return mt((function(){return t(e,n)}))}}}var Cn={createElement:function(t){var e=new xn(t);return an.root&&vt((function(){return e.render()})),e},createTextNode:function(t){return{name:"TextNode",text:t,parent:null}},replaceText:function(t,e){t.text=e;var n=t.parent;o(n),n._autosized&&n._resizeOnTextLoad(),n.text=n.getText()},setProperty:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"animate"!==e?t[e]=n:t._animate=n},insertNode:function(t,e,n){t&&(t.children.insert(e,n),"TextNode"===e.name&&t.isTextNode()&&(t._autosized&&t._resizeOnTextLoad(),t.text=t.getText()))},isTextNode:function(t){return t.isTextNode()},removeNode:function(t,e){t.children.remove(e),e instanceof xn&&e.destroy()},getParentNode:function(t){var e;return null!==(e=t.parent)&&void 0!==e?e:void 0},getFirstChild:function(t){return t.children[0]},getNextSibling:function(t){if(t.parent){var e=t.parent.children||[],n=e.indexOf(t)+1;if(n<e.length)return e[n]}}},Sn=function(t){var e=wn(t);return e.mergeProps=Kt,e}(Cn),En=Sn.render,In=(Sn.effect,Sn.memo),Ln=Sn.createComponent,Rn=Sn.createElement,Mn=(Sn.createTextNode,Sn.insertNode,Sn.insert),Pn=Sn.spread,zn=Sn.setProp,Bn=Sn.mergeProps,On=Sn.use;function Dn(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=e,Number.isInteger(t)?e:"string"==typeof e?e.startsWith("#")?Number(e.replace("#","0x")+(7===e.length?"ff":"")):e.startsWith("0x")?Number(e):Number("0x"+(6===e.length?e+"ff":e)):0}var Fn="_$DX_DELEGATE";function Nn(t){var e="$$".concat(t.type),n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get:function(){return n||document}});n;){var i=n[e];if(i&&!n.disabled){var r=n["".concat(e,"Data")];if(void 0!==r?i.call(n,r,t):i.call(n,t),t.cancelBubble)return}n=n._$host||n.parentNode||n.host}}var Un=/^(?:[a-z0-9]+:)?\/\//i,jn=/^\/+|(\/)\/+$/g;function Hn(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.replace(jn,"$1");return n?e||/^[?#]/.test(n)?n:"/"+n:""}function Wn(t,e,n){if(!Un.test(e)){var i=Hn(t),r=n&&Hn(n),o="";return((o=!r||e.startsWith("/")?i:0!==r.toLowerCase().indexOf(i.toLowerCase())?i+r:r)||"/")+Hn(e,!o)}}function Qn(t){var e={};return t.searchParams.forEach((function(t,n){e[n]=t})),e}function Gn(t,e,n){var i=b(t.split("/*",2),2),r=i[0],o=i[1],s=r.split("/").filter(Boolean),a=s.length;return function(t){var i=t.split("/").filter(Boolean),r=i.length-a;if(r<0||r>0&&void 0===o&&!e)return null;for(var u={path:a?"":"/",params:{}},l=function(t){return void 0===n?void 0:n[t]},h=0;h<a;h++){var c=s[h],f=i[h],d=":"===c[0],A=d?c.slice(1):c;if(d&&Yn(f,l(A)))u.params[A]=f;else if(d||!Yn(f,c))return null;u.path+="/".concat(f)}if(o){var g=r?i.slice(-r).join("/"):"";if(!Yn(g,l(o)))return null;u.params[o]=g}return u}}function Yn(t,e){var n=function(e){return 0===e.localeCompare(t,void 0,{sensitivity:"base"})};return void 0===e||("string"==typeof e?n(e):"function"==typeof e?e(t):Array.isArray(e)?e.some(n):e instanceof RegExp&&e.test(t))}function Xn(t){var e=new Map,n=bt();return new Proxy({},{get:function(i,r){return e.has(r)||function(t,e){var n=at,i=lt;at=t,lt=null;try{return zt(e,!0)}catch(r){jt(r)}finally{at=n,lt=i}}(n,(function(){return e.set(r,_t((function(){return t()[r]})))})),e.get(r)()},getOwnPropertyDescriptor:function(){return{enumerable:!0,configurable:!0}},ownKeys:function(){return Reflect.ownKeys(t())}})}function Vn(t){var e=/(\/?\:[^\/]+)\?/.exec(t);if(!e)return[t];for(var n=t.slice(0,e.index),i=t.slice(e.index+e[0].length),r=[n,n+=e[1]];e=/^(\/\:[^\/]+)\?/.exec(i);)r.push(n+=e[1]),i=i.slice(e[0].length);return Vn(i).reduce((function(t,e){return[].concat(y(t),y(r.map((function(t){return t+e}))))}),[])}var Zn,qn=Ct(),Kn=Ct(),Jn=function(){return function(t,e){if(null==t)throw new Error(e);return t}(St(qn),"Make sure your app is wrapped in a <Router />")},$n=function(){return Jn().navigatorFactory()},ti=function(){return(St(Kn)||Jn().base).params};function ei(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=t.component,i=t.load,r=t.children,o=t.metadata,s=!r||Array.isArray(r)&&!r.length,a={key:t,component:n,load:i,metadata:o};return ii(t.path).reduce((function(n,i){var r,o,u=w(Vn(i));try{for(u.s();!(r=u.n()).done;){var l=r.value,h=(o=l,Hn(e).replace(/\/*(\*.*)?$/g,"")+Hn(o)),c=s?h:h.split("/*",1)[0];n.push(m(m({},a),{},{originalPath:l,pattern:c,matcher:Gn(c,!s,t.matchFilters)}))}}catch(f){u.e(f)}finally{u.f()}return n}),[])}function ni(t){var e,n,i,r,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{routes:t,score:1e4*(e=t[t.length-1],n=b(e.pattern.split("/*",2),2),i=n[0],r=n[1],o=i.split("/").filter(Boolean),o.reduce((function(t,e){return t+(e.startsWith(":")?2:3)}),o.length-(void 0===r?0:1)))-s,matcher:function(e){for(var n=[],i=t.length-1;i>=0;i--){var r=t[i],o=r.matcher(e);if(!o)return null;n.unshift(m(m({},o),{},{route:r}))}return n}}}function ii(t){return Array.isArray(t)?t:[t]}function ri(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=ii(t),o=0,s=r.length;o<s;o++){var a=r[o];if(a&&"object"==typeof a){a.hasOwnProperty("path")||(a.path="");var u,l=w(ei(a,e));try{for(l.s();!(u=l.n()).done;){var h=u.value;n.push(h);var c=Array.isArray(a.children)&&0===a.children.length;if(a.children&&!c)ri(a.children,h.pattern,n,i);else{var f=ni(y(n),i.length);i.push(f)}n.pop()}}catch(d){l.e(d)}finally{l.f()}}}return n.length?i:i.sort((function(t,e){return e.score-t.score}))}function oi(t,e){for(var n=0,i=t.length;n<i;n++){var r=t[n].matcher(e);if(r)return r}return[]}function si(t,e){var n,i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=b(t.signal,2),a=o[0],l=o[1],h=t.utils,c=void 0===h?{}:h,f=c.parsePath||function(t){return t},d=c.renderPath||function(t){return t},A=c.beforeLeave||(n=new Set,i=!1,{subscribe:function(t){return n.add(t),function(){return n.delete(t)}},confirm:function(t,e){if(i)return!(i=!1);var r,o={to:t,options:e,defaultPrevented:!1,preventDefault:function(){return o.defaultPrevented=!0}},s=w(n);try{var a=function(){var n=r.value;n.listener(m(m({},o),{},{from:n.location,retry:function(r){r&&(i=!0),n.navigate(t,e)}}))};for(s.s();!(r=s.n()).done;)a()}catch(u){s.e(u)}finally{s.f()}return!o.defaultPrevented}}),g=Wn("",r.base||"");if(void 0===g)throw new Error("".concat(g," is not a valid base path"));g&&!a().value&&l({value:g,replace:!0,scroll:!1});var p=b(At(!1),2),v=p[0],_=p[1],y=function(){var t=u(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return _(!0),t.prev=1,t.next=4,wt(e);case 4:return t.prev=4,_(!1),t.finish(4);case 7:case"end":return t.stop()}}),t,null,[[1,,4,7]])})));return function(e){return t.apply(this,arguments)}}(),x=b(At(a().value),2),k=x[0],T=x[1],C=b(At(a().state),2),S=C[0],E=C[1],I=function(t,e){var n=new URL("http://sar"),i=_t((function(e){var i=t();try{return new URL(i,n)}catch(r){return console.error("Invalid path ".concat(i)),e}}),n,{equals:function(t,e){return t.href===e.href}}),r=_t((function(){return i().pathname})),o=_t((function(){return i().search}),!0),s=_t((function(){return i().hash}));return{get pathname(){return r()},get search(){return o()},get hash(){return s()},get state(){return e()},get key(){return""},query:Xn(kt(o,(function(){return Qn(i())})))}}(k,S),L=[],R=At([]),M={pattern:g,params:{},path:function(){return g},outlet:function(){return null},resolvePath:function(t){return Wn(g,t)}};return pt((function(){var t=a(),e=t.value,n=t.state;mt((function(){e!==k()&&y((function(){Zn="native",T(e),E(n),R[1]([])})).then((function(){Zn=void 0}))}))})),{base:M,location:I,isRouting:v,renderPath:d,parsePath:f,navigatorFactory:function(t){return t=t||St(Kn)||M,function(e,n){return function(t,e,n){mt((function(){if("number"!=typeof e){var i=m({replace:!1,resolve:!0,scroll:!0},n),r=i.replace,o=i.resolve,s=i.scroll,a=i.state,u=o?t.resolvePath(e):Wn("",e);if(void 0===u)throw new Error("Path '".concat(e,"' is not a routable path"));if(L.length>=100)throw new Error("Too many redirects");var h=k();if((u!==h||a!==S())&&A.confirm(u,n)){var f=L.push({value:h,replace:r,scroll:s,state:S()});y((function(){Zn="navigate",T(u),E(a),R[1]([])})).then((function(){var t,e;L.length===f&&(Zn=void 0,t={value:u,state:a},(e=L[0])&&(t.value===e.value&&t.state===e.state||l(m(m({},t),{},{replace:e.replace,scroll:e.scroll})),L.length=0))}))}}else e&&(c.go?A.confirm(e,n)&&c.go(e):console.warn("Router integration does not support relative routing"))}))}(t,e,n)}},beforeLeave:A,preloadRoute:function(t,n){var i=oi(e(),t.pathname),r=Zn;for(var o in Zn="preload",i){var s=i[o],a=s.route,u=s.params;a.component&&a.component.preload&&a.component.preload(),n&&a.load&&a.load({params:u,location:{pathname:t.pathname,search:t.search,hash:t.hash,query:Qn(t),state:null,key:""},intent:"preload"})}Zn=r},submissions:R}}var ai=function(t){return function(e){var n=e.base,i=Et((function(){return e.children})),r=_t((function(){return ri(e.root?{component:e.root,children:i()}:i(),e.base||"")})),o=si(t,r,{base:n});return t.create&&t.create(o),Ln(qn.Provider,{value:o,get children(){return Ln(ui,{routerState:o,get branches(){return r()}})}})}};function ui(t){var e,n=_t((function(){return oi(t.branches,t.routerState.location.pathname)})),i=Xn((function(){for(var t=n(),e={},i=0;i<t.length;i++)Object.assign(e,t[i].params);return e})),r=[],o=_t(kt(n,(function(s,a,u){for(var l=a&&s.length===a.length,h=[],c=function(e){var c=a&&a[e],f=s[e];u&&c&&f.route.key===c.route.key?h[e]=u[e]:(l=!1,r[e]&&r[e](),dt((function(s){r[e]=s,h[e]=function(t,e,n,i,r){var o=t.base,s=t.location,a=i().route,u=a.pattern,l=a.component,h=a.load,c=_t((function(){return i().path}));l&&l.preload&&l.preload();var f=h?h({params:r,location:s,intent:Zn||"initial"}):void 0;return{parent:e,pattern:u,path:c,params:r,outlet:function(){return l?Yt(l,{params:r,location:s,data:f,get children(){return n()}}):n()},resolvePath:function(t){return Wn(o.path(),t,c())}}}(t.routerState,h[e-1]||t.routerState.base,li((function(){return o()[e+1]})),(function(){return n()[e]}),i)})))},f=0,d=s.length;f<d;f++)c(f);return r.splice(s.length).forEach((function(t){return t()})),u&&l?u:(e=h[0],h)})));return Ln(te,{get when(){return o()&&e},keyed:!0,children:function(t){return Ln(Kn.Provider,{value:t,get children(){return t.outlet()}})}})}var li=function(t){return function(){return Ln(te,{get when(){return t()},keyed:!0,children:function(t){return Ln(Kn.Provider,{value:t,get children(){return t.outlet()}})}})}},hi=function(t){var e=Et((function(){return t.children}));return Kt(t,{get children(){return e()}})};function ci(t){var e=!1,n=function(t){return"string"==typeof t?{value:t}:t},i=function(t,e,n){var i=b(t,2),r=i[0],o=i[1];return[e?function(){return e(r())}:r,n?function(t){return o(n(t))}:o]}(At(n(t.get()),{equals:function(t,e){return t.value===e.value}}),void 0,(function(n){return!e&&t.set(n),n}));return t.init&&Tt(t.init((function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.get();e=!0,i[1](n(r)),e=!1}))),ai({signal:i,create:t.create,utils:t.utils})}function fi(t,e){var n=function(t){if("#"===t)return null;try{return document.querySelector(t)}catch(e){return null}}("#".concat(t));n?n.scrollIntoView():e&&window.scrollTo(0,0)}var di=new Map;function Ai(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/_server";return function(i){var r=i.base.path(),o=i.navigatorFactory(i.base),s={};function a(t){if(!(t.defaultPrevented||0!==t.button||t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)){var n=t.composedPath().find((function(t){return t instanceof Node&&"A"===t.nodeName.toUpperCase()}));if(n&&(!e||n.getAttribute("link"))){var i="http://www.w3.org/2000/svg"===n.namespaceURI,o=i?n.href.baseVal:n.href;if(!(i?n.target.baseVal:n.target)&&(o||n.hasAttribute("state"))){var s=(n.getAttribute("rel")||"").split(/\s+/);if(!(n.hasAttribute("download")||s&&s.includes("external"))){var a=i?new URL(o,document.baseURI):new URL(o);if(!(a.origin!==window.location.origin||r&&a.pathname&&!a.pathname.toLowerCase().startsWith(r.toLowerCase())))return[n,a]}}}}}function u(t){var e=a(t);if(e){var n=b(e,2),r=n[0],s=n[1],u=i.parsePath(s.pathname+s.search+s.hash),l=r.getAttribute("state");t.preventDefault(),o(u,{resolve:!1,replace:r.hasAttribute("replace"),scroll:!r.hasAttribute("noscroll"),state:l&&JSON.parse(l)})}}function l(t){var e=a(t);if(e){var n=b(e,2),r=n[0],o=n[1];s[o.pathname]||i.preloadRoute(o,"false"!==r.getAttribute("preload"))}}function h(t){var e=a(t);if(e){var n=b(e,2),r=n[0],o=n[1];s[o.pathname]||(s[o.pathname]=setTimeout((function(){i.preloadRoute(o,"false"!==r.getAttribute("preload")),delete s[o.pathname]}),200))}}function c(t){var e=a(t);if(e){var n=b(e,2)[1];s[n.pathname]&&(clearTimeout(s[n.pathname]),delete s[n.pathname])}}function f(t){var e=t.submitter&&t.submitter.hasAttribute("formaction")?t.submitter.formAction:t.target.action;if(e){if(!e.startsWith("action:")){var r=new URL(e);if(!(e=i.parsePath(r.pathname+r.search)).startsWith(n))return}if("POST"!==t.target.method.toUpperCase())throw new Error("Only POST forms are supported for Actions");var o=di.get(e);if(o){t.preventDefault();var s=new FormData(t.target);o.call(i,s)}}}!function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.document,n=e[Fn]||(e[Fn]=new Set),i=0,r=t.length;i<r;i++){var o=t[i];n.has(o)||(n.add(o),e.addEventListener(o,Nn))}}(["click","submit"]),document.addEventListener("click",u),t&&(document.addEventListener("mouseover",h),document.addEventListener("mouseout",c),document.addEventListener("focusin",l),document.addEventListener("touchstart",l)),document.addEventListener("submit",f),Tt((function(){document.removeEventListener("click",u),t&&(document.removeEventListener("mouseover",h),document.removeEventListener("mouseout",c),document.removeEventListener("focusin",l),document.removeEventListener("touchstart",l)),document.removeEventListener("submit",f)}))}}function gi(t){var e=t.replace(/^.*?#/,"");if(!e.startsWith("/")){var n=b(window.location.hash.split("#",2),2)[1];return"".concat(void 0===n?"/":n,"#").concat(e)}return e}function pi(t){return ci({get:function(){return window.location.hash.slice(1)},set:function(t){var e=t.value,n=t.replace,i=t.scroll,r=t.state;n?window.history.replaceState(r,"","#"+e):window.location.hash=e;var o=e.indexOf("#");fi(o>=0?e.slice(o+1):"",i)},init:function(t){return e=window,n="hashchange",i=function(){return t()},e.addEventListener(n,i),function(){return e.removeEventListener(n,i)};var e,n,i},create:Ai(t.preload,t.explicitLinks,t.actionBase),utils:{go:function(t){return window.history.go(t)},renderPath:function(t){return"#".concat(t)},parsePath:gi}})(t)}var vi=Tt;function _i(t){var e,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bt(),r=0;return function(){return r++,Tt((function(){r--,queueMicrotask((function(){!r&&n&&(n(),n=e=void 0)}))})),n||dt((function(i){return e=t(n=i)}),i),e}}var yi=_i((function(){var t,e,n,i,r=b(At(null),2),o=r[0],s=r[1];return t=window,e="keydown",n=function(t){s(t),setTimeout((function(){return s(null)}))},t.addEventListener(e,n,i),vi(t.removeEventListener.bind(t,e,n,i)),o}));function xi(t){return"function"==typeof t}function mi(t,e){if(!t)throw new Error(e||"Assertion failed")}var ki,Ti={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Enter:"Enter",Last:"l"},bi=b(At([]),2),wi=bi[0],Ci=bi[1];function Si(t,e){var n,i,r,o,s=e();if(Array.isArray(s))if(2===s.length)n=o=s[0],i=r=s[1];else if(3===s.length)n=s[0],i=r=s[1],o=s[2];else{var a=b(s,4);n=a[0],r=a[1],o=a[2],i=a[3]}else n=r=o=i=s;t.onBeforeLayout=function(e,s){if(s){t.width=t.children.reduce((function(t,e){return t+(e.width||0)}),0)+i+r;var a=t.children[0];a&&(a.x=i,a.marginLeft=i);var u=0;t.children.forEach((function(t){t.y=(t.y||0)+n,t.marginTop=n,u=Math.max(u,t.height||0)})),t.height=u+n+o}}}function Ei(t){return new Promise((function(e){setTimeout(e,t)}))}function Ii(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en-US",i=window.speechSynthesis;return new Promise((function(r,o){var s=new SpeechSynthesisUtterance(t);s.lang=n,s.onend=function(){r()},s.onerror=function(t){o(t)},e.push(s),i.speak(s)}))}function Li(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=window.speechSynthesis,r=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[];for(t=0;t<e.length;t++){var i=e[t];if("string"!=typeof i||i.includes("PAUSE-"))break;n.push(e[t])}return[n.join(",\b ")].concat(e.slice(t))}(Array.isArray(t)?t:[t]),o=[],a=[],l=!0;return{series:u(s().mark((function t(){var n,i,u,h,c,f;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0;case 1:if(!l||!r.length){t.next=62;break}return t.next=4,Promise.resolve(r.shift());case 4:if(n=t.sent,l){t.next=9;break}return t.abrupt("break",62);case 9:if("string"!=typeof n||!n.includes("PAUSE-")){t.next=16;break}return i=1e3*Number(n.split("PAUSE-")[1]),isNaN(i)&&(i=0),t.next=14,Ei(i);case 14:t.next=60;break;case 16:if("string"!=typeof n||!n.length){t.next=48;break}h=u=3;case 19:if(!(l&&h>0)){t.next=46;break}return t.prev=20,t.next=23,Ii(n,a,e);case 23:h=0,t.next=44;break;case 26:if(t.prev=26,t.t0=t.catch(20),!(t.t0 instanceof SpeechSynthesisErrorEvent)){t.next=43;break}if("network"!==t.t0.error){t.next=36;break}return h--,console.warn("Speech synthesis network error. Retries left: ".concat(h)),t.next=34,Ei(500*(u-h));case 34:t.next=41;break;case 36:if("canceled"!==t.t0.error&&"interrupted"!==t.t0.error){t.next=40;break}h=0,t.next=41;break;case 40:throw new Error("SpeechSynthesisErrorEvent: ".concat(t.t0.error));case 41:t.next=44;break;case 43:throw t.t0;case 44:t.next=19;break;case 46:t.next=60;break;case 48:if("function"!=typeof n){t.next=55;break}return c=Li(n(),e,!1),o.push(c),t.next=53,c.series;case 53:t.next=60;break;case 55:if(!Array.isArray(n)){t.next=60;break}return f=Li(n,e,!1),o.push(f),t.next=60,f.series;case 60:t.next=1;break;case 62:return t.prev=62,l=!1,t.finish(62);case 65:case"end":return t.stop()}}),t,null,[[0,,62,65],[20,26]])})))(),get active(){return l},append:function(t){r.push(t)},cancel:function(){l&&(n&&i.cancel(),o.forEach((function(t){t.cancel()})),l=!1)}}}function Ri(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";return ki&&ki.cancel(),ki=Li(t,e)}var Mi,Pi,zi=[],Bi=!1;function Oi(t,e){var n,i=function(t,e){var n,i=function(){return clearTimeout(n)};return bt()&&Tt(i),Object.assign((function(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];void 0!==n&&i(),n=setTimeout((function(){return t.apply(void 0,o)}),e)}),{clear:i})}(t,e),r=function(t){n=t,i(t)};return r.flush=function(){i.clear(),t(n)},r.clear=i.clear,r}function Di(t){return t.id||t.name}function Fi(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(Ni.onFocusChange&&Ni.enabled){var e=t.every((function(t){return!t.loading})),n=t.filter((function(t){return!zi.includes(t)}));if(Mi(),e||!Ni.onFocusChange){zi=t.slice(0);var i=[],r=n.reduce((function(t,e){return e.announce?(t.push([Di(e),"Announce",e.announce]),i.push(e.announce)):e.title?(t.push([Di(e),"Title",e.title]),i.push(e.title)):t.push([Di(e),"No Announce",""]),t}),[]);return n.reverse().reduce((function(t,e){return e.announceContext?(t.push([Di(e),"Context",e.announceContext]),i.push(e.announceContext)):t.push([Di(e),"No Context",""]),t}),r),Ni.debug&&console.table(r),i.length?Ni.speak(i.reduce((function(t,e){return t.concat(e)}),[])):void 0}Ni.onFocusChange([])}}var Ni={debug:!1,enabled:!0,cancel:function(){Pi&&Pi.cancel()},clearPrevFocus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;zi=zi.slice(0,t),Mi()},speak:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.append,r=void 0!==i&&i,o=n.notification,s=void 0!==o&&o;Ni.onFocusChange&&Ni.enabled&&(Ni.onFocusChange.flush(),r&&Pi&&Pi.active?Pi.append(t):(Ni.cancel(),function(t){if(!Bi)Pi=Ri(t)}(t)),s&&(Bi=!0,null===(e=Pi)||void 0===e||e.series.finally((function(){Bi=!1,Ni.refresh()})).catch(console.error)));return Pi},refresh:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Ni.clearPrevFocus(t),Ni.onFocusChange&&Ni.onFocusChange(mt((function(){return wi()})))},setupTimers:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.focusDebounce,n=void 0===e?400:e,i=t.focusChangeTimeout,r=void 0===i?3e5:i;Ni.onFocusChange=Oi(Fi,n),Mi=Oi((function(){zi=[]}),r)}};function Ui(t){return function(){var e=this.children.length,n=this.wrap,i=this.selected;if("right"===t||"down"===t)do{var r;if(this.selected=(this.selected||0)%e+1,this.selected>=e){if(!n){this.selected=null;break}this.selected=0}}while(null!==(r=this.children[this.selected])&&void 0!==r&&r.skipFocus);else if("left"===t||"up"===t)do{var o;if(this.selected=(this.selected||0)%e-1,this.selected<0){if(!n){this.selected=null;break}this.selected=e-1}}while(null!==(o=this.children[this.selected])&&void 0!==o&&o.skipFocus);if(null===this.selected)return this.selected=i,!1;var s=this.children[this.selected];if(mi(s instanceof xn),this.onSelectedChanged&&this.onSelectedChanged.call(this,this,s,this.selected,i),this.plinko&&null!==i){var a=this.children[i];mi(a instanceof xn);var u=a.selected;s.selected=u}return re(s),!0}}function ji(t){var e,n=Ui("left"),i=Ui("right"),r={display:"flex",justifyContent:"flexStart"};return e=Rn("node"),zn(e,"onLeft",n),zn(e,"onRight",i),Pn(e,Bn({get selected(){return t.selected||0},get onFocus(){return t.onFocus||function(t){if(t&&null!==t.selected){for(var e=t.children[t.selected];null!==(n=e)&&void 0!==n&&n.skipFocus;){var n;t.selected++,e=t.children[t.selected]}e instanceof xn&&e.setFocus()}}},get style(){return t.style||r}},t),!0),Mn(e,(function(){return t.children})),e}function Hi(t){var e,n=Ui("up"),i=Ui("down"),r={display:"flex",flexDirection:"column",justifyContent:"flexStart"};return e=Rn("node"),zn(e,"onUp",n),zn(e,"onDown",i),Pn(e,Bn({get onFocus(){return t.onFocus||function(t){if(t&&null!==t.selected){for(var e=t.children[t.selected];null!==(n=e)&&void 0!==n&&n.skipFocus;){var n;t.selected++,e=t.children[t.selected]}e instanceof xn&&e.setFocus()}}},get selected(){return t.selected||0},get style(){return t.style||r}},t),!0),Mn(e,(function(){return t.children})),e}var Wi=b(At(""),2),Qi=Wi[0],Gi=Wi[1],Yi=b(At(!1),2),Xi=Yi[0],Vi=Yi[1];function Zi(){var t,e,n=0,i={alpha:1,color:4294967295},r={duration:1e3,easing:"ease-in-out"};return vt(kt(Qi,(function(i){return i.startsWith("#")?(t.color=i,t.src="",t.alpha=1,n=1,void(e.alpha=0)):(t.color=4294967295,0===n?(t.src=i,void(n=1)):1===n?(e.src=i,n=2,e.alpha=[1],void(t.alpha=[0])):void(2===n&&(t.src=i,n=1,t.alpha=1,e.alpha=0)))}),{defer:!0})),Ln(kn,{width:1920,height:1080,zIndex:-5,get children(){return[Ln(kn,{ref:function(e){"function"==typeof t?t(e):t=e},animate:!0,animationSettings:r,style:i}),Ln(kn,{ref:function(t){"function"==typeof e?e(t):e=t},animate:!0,animationSettings:r,style:i,alpha:0}),Ln(kn,{get effects(){return{radialGradient:{colors:[Dn("#3b3b3b"),Dn("#272727"),Dn("#181818")],stops:[0,.3,.8],height:800,width:1920,pivot:[.8,0]}}}})]}})}var qi={display:"flex",flexDirection:"row",justifyContent:"flexStart"},Ki={display:"flex",flexDirection:"column",justifyContent:"flexStart"},Ji={screenW:1920,screenH:1080,marginX:50,marginY:120,gutterX:24,gutterY:72,focusScale:1.1},$i={primary:"#141414",focus:"#bdbdbd",container:"#4d4d4d",menuBg:"#2021242e"},tr={display1:{fontFamily:"Ubuntu",fontSize:72,lineHeight:88,fontStyle:"600",verticalAlign:"middle",textBaseline:"bottom",maxLineSuffix:"..."},display2:{fontFamily:"Ubuntu",fontSize:56,lineHeight:72},headline1:{fontFamily:"Ubuntu",fontSize:36,fontStyle:"600",lineHeight:48,verticalAlign:"middle",textBaseline:"bottom",maxLineSuffix:"..."},headline2:{fontFamily:"Ubuntu",fontSize:32,lineHeight:44},headline3:{fontFamily:"Ubuntu",fontSize:28,lineHeight:40},body1:{fontFamily:"Ubuntu",fontSize:32,lineHeight:40},body2:{fontFamily:"Ubuntu",fontSize:28,lineHeight:34},button1:{fontFamily:"Ubuntu",fontSize:32,lineHeight:40,background:"#ffff"}};Dn("#000000"),Ji.screenH;var er={width:50,height:50,x:0};Dn("#ffffff"),Dn("#ff0000");var nr,ir={Column:m(m({},Ki),{},{width:320,height:600,y:380,gap:20,zIndex:101,colors:Dn($i.primary),x:[20,{duration:250,easing:"ease-in-out"}],focus:{x:[Ji.marginX,{duration:250,easing:"ease-in-out"}]}}),menuLineStyle:{width:50,height:0,x:0,y:58,color:Dn("#ff0000"),focus:{height:6},active:{}},MenuWrapper:{zIndex:1e3,focus:{width:400,alpha:[1],duration:250,easing:"ease-in-out"},angle:(nr=270,nr*Math.PI/180),stops:[0,.4,.8],width:100,height:1080,color:Dn($i.primary)},MenuText:{zIndex:1,fontSize:32,x:116,y:10,height:50,alpha:0,active:{alpha:1}}};function rr(t){var e,n=$n();function i(){this.children.forEach((function(t){return t.states.add("active")})),this.children.selected.setFocus()}function r(){this.selected=0,this.children.forEach((function(t){return t.states.remove("active")}))}return Ln(kn,{get style(){return ir.MenuWrapper},get children(){return[Ln(Hi,Bn(t,{onFocus:i,onBlur:r,get style(){return ir.Column},animate:!0,get children(){return((null==t?void 0:t.mennuItems)||[]).map((function(t){return Ln(kn,{get src(){return"./"+"".concat(t.icon)},style:er,forwardStates:!0,onEnter:function(){return n("".concat(t.path))},get children(){return[Ln(kn,{get style(){return ir.menuLineStyle}}),Ln(mn,{get style(){return ir.MenuText},get children(){return t.name}})]}})}))}})),Ln(kn,{ref:function(t){"function"==typeof e?e(t):e=t}})]}})}var or={Page:{width:1920,height:1080},pageWrapper:{x:100},headlineText:{width:1200,height:240,x:360,y:455,contain:"both",fontSize:66,textAlign:"center"},headlineSubText:{width:1920,height:170,x:530,y:655,contain:"both",fontSize:48,textAlign:"center"},itemsContainer:{width:Ji.screenW,height:600,y:350,x:0,zIndex:2},FocusRing:{borderRadius:0,width:194,height:286,y:-5,x:-5,zIndex:-1},showHeadline:{x:70,y:20},headlineBlur:{width:1920,height:150,x:0,y:0,zIndex:14,alpha:.9,color:Dn("#000000")},RowTitle:{height:60,width:400,marginTop:20,fontSize:36,color:Dn("#f0f0f0"),zIndex:2},Row:{display:"flex",justifyContent:"spaceBetween",height:290,gap:10},Column:{display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:10,width:Ji.screenW-2*Ji.marginX,x:Ji.marginX+Ji.gutterX,y:100,zIndex:2},Rect:{width:250,height:100,y:10,x:300,color:Dn("#0000ff")},peopleBio:m(m({},tr.body1),{},{contain:"both",width:1500,height:400})};Dn("#000000"),Dn("#3333ff"),Dn("#333333");Dn("#00A699"),Dn("#F6F6F9");Dn("#715cab"),Dn("#5a39a2"),Dn("#291d43");Dn("#000000"),Dn("#FFFFFF"),Dn("#909090");var sr=[{name:"Home",path:"/",icon:"assets/icon-home.png"},{name:"Search",path:"/search",icon:"assets/icon-search.png"},{name:"TV",path:"/tv",icon:"assets/icon-tivi.png"},{name:"List column",path:"/videos",icon:"assets/icon-video.png"},{name:"List Slider",path:"/list",icon:"assets/icon-list.png"}],ar=function(t){(Ni.setupTimers(),vt(kt(wi,Ni.onFocusChange,{defer:!0})),Ni).enabled=!1;var e,n,i=$n(),r=Jn().location;ti();var o,s=b(At(r),2),a=s[0],u=s[1];return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=yi();Ti=m(m({},Ti),t);var n=Object.entries(Ti);vt(kt(ie,(function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=t,r=[];i;){var o;i.states.has("focus")||(i.states.add("focus"),xi(i.onFocus)&&i.onFocus.call(i,t,null!=e?e:null)),r.push(i),i=null!==(o=i.parent)&&void 0!==o?o:null}return n.forEach((function(n){r.includes(n)||(n.states.remove("focus"),xi(n.onBlur)&&n.onBlur.call(n,t,null!=e?e:null))})),Ci(r),r}),{defer:!0})),vt((function(){var t=e();if(t){var i=n.find((function(e){var n=b(e,2);return n[0],n[1]===t.key}));mt((function(){var e,n=w(wi());try{for(n.s();!(e=n.n()).done;){var r=e.value,o=i?i[0]:void 0;if(o){var s=r["on".concat(o)];if(xi(s)&&!0===s.call(r,t,r))break}else console.log("Unhandled key event: ".concat(t.key));if(xi(r.onKeyPress)&&!0===r.onKeyPress.call(r,t,o,r))break}}catch(a){n.e(a)}finally{n.f()}return!1}))}}))}({Menu:"m",Escape:"Escape"}),o=function(){Vi(!0)},vt((function(){return mt(o)})),vt((function(){u(r.pathname)})),Ln(kn,{ref:function(t){var e=window.APP;"function"==typeof e?e(t):window.APP=t},onLast:function(){return history.back()},onMenu:function(){return i("/")},style:{width:1920,height:1080},onLeft:function(){if(e.states.has("focus")||0==Xi()&&"/search"==a())return!1;n=ie(),e.setFocus()},onRight:function(){return Vi(!1),e.states.has("focus")&&n.setFocus()},plinko:!0,get children(){return[Ln(Zi,{}),Ln(kn,{get style(){return or.pageWrapper},get children(){return t.children}}),Ln(rr,{ref:function(t){"function"==typeof e?e(t):e=t},mennuItems:sr})]}})},ur=new URL("AppCoreExtensions-legacy-69d424fd.js",i.meta.url).href,lr=function(){var t={width:900,height:500,y:350,x:20,gap:25,display:"flex",flexDirection:"column",justifyContent:"flexStart"},e={width:900,height:36,gap:6,display:"flex",flexDirection:"row",justifyContent:"flexStart"},n={fontSize:42},i={width:t.width,fontSize:26,contain:"width"},r={fontSize:26};return Ln(kn,{autofocus:!0,style:t,get children(){return[Ln(mn,{style:n,children:"Title of the Page"}),Ln(mn,{style:i,children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer vel tempor tellus. Sed eu leo purus. Vestibulum sollicitudin eget tellus a varius. Phasellus est turpis, volutpat sed blandit sit amet, rutrum sit amet mauris. In dignissim elit orci, a sollicitudin ipsum faucibus et. Quisque vel quam rutrum, faucibus augue sed, scelerisque nunc."}),Ln(kn,{style:e,get children(){return[Ln(mn,{style:r,children:"Subline Text"}),Ln(kn,{width:28,height:28,src:"/assets/rt-popcorn.png"}),Ln(mn,{style:r,children:"More Text"})]}})]}})},hr=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],cr={display:"flex",flexDirection:"column",gap:40,y:0,color:Dn("#000000"),height:Ji.screenH,alpha:1},fr={display:"flex",flexDirection:"row",justifyContent:"flexStart",gap:16,x:40,zIndex:999,height:Ji.screenH},dr={display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:16,width:540,x:40,zIndex:999},Ar={display:"flex",flexDirection:"row",justifyContent:"spaceBetween",gap:8,height:70,width:500},gr={color:Dn("#000000"),alpha:.8,zIndex:998,x:0,y:0},pr={display:"flex",borderRadius:6,border:{width:0,color:Dn("#ffffff")},justifyContent:"center",alignItems:"center",gap:6,width:70,height:70,color:Dn("#2e3743"),focus:{border:{width:4,color:Dn("#ffffff")},color:Dn("#000000")}},vr={fontSize:40},_r={color:Dn("#red"),width:500,x:40,height:70,alpha:1,backgroundColor:Dn("#ffffff"),borderRadius:8,border:{width:4,color:Dn("#ffffff")},display:"flex",alignItems:"center",justifyContent:"flexStart"},yr={width:500,display:"flex",flexDirection:"column",alignItems:"flexStart",justifyContent:"flexStart",gap:20,x:0},xr={height:70,width:240,color:Dn("#2e3743"),display:"flex",alignItems:"center",justifyContent:"center",borderRadius:6,border:{width:0,color:Dn("#ffffff")},focus:{border:{width:4,color:Dn("#ffffff")},color:Dn("#000000")}},mr={width:70,height:50},kr={height:10,x:0,y:0},Tr={color:Dn("#09121a"),y:-160,fontSize:30,x:40,width:Ji.screenW-696,height:Ji.screenH,zIndex:999},br={display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:20,width:Ji.screenW-(2*Ji.marginX+580+2*(Ji.marginX+Ji.gutterX)),x:Ji.marginX+Ji.gutterX,y:48,zIndex:2},wr={display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:20},Cr={Thumbnail:{borderRadius:0,width:187,height:294,scale:1,zIndex:2},FocusRing:{borderRadius:0,y:-2,x:-2,zIndex:-1,color:Dn("#ffffff")}};function Sr(t){var e;function n(){var t;null===(t=this.children.selected)||void 0===t||t.setFocus()}return vt(kt(ie,(function(t){o(t),setTimeout((function(){t.heroContent?(e.parent=t.parent,e.alpha=1,e.scale=1,e.x=t.x-1.5,e.y=t.y-1.5,e.width=t.width+1.5,e.height=t.height+1.5,e.createAnimation({scale:1.03}).start()):e.alpha=0}),10)}),{defer:!0})),Ln(kn,Bn(t,{animate:!0,get style(){return Cr.Thumbnail},get children(){return[Ln(kn,Bn({onFocus:n},t,{animate:!0,get style(){return Cr.Thumbnail}})),Ln(kn,{ref:function(t){"function"==typeof e?e(t):e=t},get style(){return Cr.FocusRing}})]}}))}function Er(t){var e=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];if($ in t){var r=new Set(n.length>1?n.flat():n[0]),o=n.map((function(e){return new Proxy({get:function(n){return e.includes(n)?t[n]:void 0},has:function(n){return e.includes(n)&&n in t},keys:function(){return e.filter((function(e){return e in t}))}},Vt)}));return o.push(new Proxy({get:function(e){return r.has(e)?void 0:t[e]},has:function(e){return!r.has(e)&&e in t},keys:function(){return Object.keys(t).filter((function(t){return!r.has(t)}))}},Vt)),o}var s,a={},u=n.map((function(){return{}})),l=w(Object.getOwnPropertyNames(t));try{for(l.s();!(s=l.n()).done;){var h,c=s.value,f=Object.getOwnPropertyDescriptor(t,c),d=!f.get&&!f.set&&f.enumerable&&f.writable&&f.configurable,A=!1,g=0,p=w(n);try{for(p.s();!(h=p.n()).done;)h.value.includes(c)&&(A=!0,d?u[g][c]=f.value:Object.defineProperty(u[g],c,f)),++g}catch(v){p.e(v)}finally{p.f()}A||(d?a[c]=f.value:Object.defineProperty(a,c,f))}}catch(v){l.e(v)}finally{l.f()}return[].concat(y(u),[a])}(t,["items"]),n=b(e,2),i=n[0],r=n[1];return Ln(ji,Bn(r,{get style(){return or.Row},get children(){return Ln($t,{get each(){return i.items},children:function(t){return Ln(Sr,t)}})}}))}function Ir(t){var e=b(At([]),2),n=e[0],i=e[1],r=b(At(1),2),o=r[0],s=r[1],a=b(At(!1),2),u=a[0],l=a[1],h=b(yt(o,t),1)[0];return gt((function(){var t=h();t&&zt((function(){0===t.length&&l(!0),i((function(e){return[].concat(y(e),y(t))}))}),!1)})),{pages:n,page:o,setPage:s,setPages:i,end:u,setEnd:l}}var Lr,Rr,Mr="e9e9d8da18ae29fc430845952232787c",Pr="https://api.themoviedb.org/3",zr="w185",Br={headers:{"Content-Type":"application/json",Authorization:"Bearer 596e02522af6fe40f284e6de58fd0865f2cbaae3"}};function Or(t){return Rr+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:zr)+t}function Dr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(Pr+t+(t.includes("?")?"&":"?")+"api_key="+Mr,m(m({},Br),e)).then((function(t){return t.json()}))}function Fr(){return Dr("/configuration").then((function(t){var e;return Lr=t,Rr=null===(e=t.images)||void 0===e?void 0:e.secure_base_url,t}))}var Nr={get:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Lr?Dr(t,e):Fr().then((function(){return Dr(t,e)}))},loadConfig:Fr};var Ur=new Map,jr=new Map;function Hr(t,e){return function(n){var i="/trending/".concat(t,"/week?page=").concat(n);if(Ur.has(i))return Ur.get(i);var r=e||7,o=Nr.get(i).then((function(e){var n=e.results.filter((function(t){return!t.adult})),i=(jr.has(t)?jr.get(t):[]).concat(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(t){return{src:Or(t.poster_path||t.profile_path),tileSrc:Or(t.backdrop_path||t.profile_path,"w300"),backdrop:Or(t.backdrop_path,"w1280"),href:"/entity/".concat(t.media_type||"people","/").concat(t.id),shortTitle:(e=t.title||t.name,n=30,e.length>n?e.substring(0,n-3)+"...":e),title:t.title||t.name,data:t,entityInfo:{type:t.media_type||"people",id:t.id},heroContent:{title:t.title||t.name,description:t.overview}};var e,n}))}(n)),o=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,n=[],i=0,r=t.length;i<r;i+=e)n.push(t.slice(i,i+e));return n}(i,r);return o[o.length-1].length<r?jr.set(t,o.pop()):jr.delete(t),o}));return Ur.set(i,o),o}}function Wr(t){var e,n,i,r,o,s,a,u,l;$n();var h=b(At(""),2),c=h[0],f=h[1],d=b(At(0),2),A=d[0],g=d[1],p=_t((function(){return Ir(Hr("all",4))})),v=xt((function(){return 0}));function _(){this.states.add("focus")}function y(){this.states.remove("focus")}var x=function(){for(var t=[],e=0;e<hr.length;e+=6){var n=hr.slice(e,e+6);t.push(n)}return Ln($t,{each:t,children:function(t,e){return Ln(ji,{style:Ar,autofocus:!1,plinko:!0,get children(){return Ln($t,{each:t,children:function(t,e){return Ln(kn,{style:pr,get onEnter(){return function(t){return function(){f((function(e){return e+t}))}}(t)},animate:!0,onBlur:y,onFocus:_,forwardStates:!0,autofocus:!1,get children(){return Ln(mn,{style:vr,children:t})}})}})}})}})};function m(){var t;null===(t=this.children.selected)||void 0===t||t.setFocus(),g(-1*(this.y||0)+24);var e=p().pages().length;this.parent&&(0===e||this.parent.selected&&this.parent.selected>=e-2)&&p().setPage((function(t){return t+1}))}function k(){}return Ln(kn,{ref:function(t){"function"==typeof e?e(t):e=t},animate:!0,style:gr,autofocus:!0,get children(){return Ln(kn,{ref:function(t){"function"==typeof r?r(t):r=t},animate:!0,style:cr,autofocus:!0,plinko:!0,get children(){return[Ln(kn,{ref:function(t){"function"==typeof n?n(t):n=t},style:kr,skipFocus:!0}),Ln(kn,{ref:function(t){"function"==typeof n?n(t):n=t},style:_r,animate:!0,skipFocus:!0,get children(){return Ln(mn,{get style(){return{color:Dn("#ffffff"),fontSize:30,marginLeft:20}},get children(){return c()}})}}),Ln(Hi,{style:fr,ref:function(t){"function"==typeof o?o(t):o=t},autofocus:!0,onDown:function(){if(a.states.has("focus"))return!1},plinko:!0,get children(){return[Ln(Hi,{style:dr,ref:function(t){"function"==typeof a?a(t):a=t},onRight:function(){s.setFocus(),u.setFocus()},onLeft:function(){Vi(!0)},get children(){return[Ln(ji,{style:Ar,autofocus:!1,get children(){return[Ln(kn,{style:xr,ref:function(t){"function"==typeof l?l(t):l=t},get onEnter(){return function(){f((function(t){return t+" "}))}},animate:!0,autofocus:!1,get children(){return Ln(kn,{style:mr,src:"./assets/icon-space.png",forwardStates:!0,animate:!0})}}),Ln(kn,{style:xr,get onEnter(){return function(){f((function(t){return t.slice(0,-1)}))}},animate:!0,autofocus:!1,get children(){return Ln(kn,{style:mr,src:"./assets/icon-back-space.png",forwardStates:!0,animate:!0})}})]}}),Ln(Hi,{plinko:!0,style:wr,get children(){return x()}}),Ln(Hi,{ref:function(t){"function"==typeof i?i(t):i=t},animate:!0,style:yr,forwardStates:!0,get children(){return Ln(mn,{get style(){return{color:Dn("#504d4d"),fontSize:30,focus:{color:Dn("#ffffff")}}},children:"Result Search"})}})]}}),Ln(kn,{style:Tr,ref:function(t){"function"==typeof s?s(t):s=t},onLeft:function(){a.setFocus()},get children(){return Ln(Hi,{ref:function(t){"function"==typeof u?u(t):u=t},animate:!0,get y(){return A()},style:br,plinko:!0,get children(){return Ln($t,{get each(){return p().pages()},children:function(t,e){return Ln(Er,{get autofocus(){return In((function(){return!!v(e())}))()&&s.states.has("focus")},items:t,onFocus:m,onEnter:k})}})}})}})]}})]}})}})}function Qr(t){var e,n=xt((function(){return 0})),i=b(At(0),2),r=i[0],s=i[1],a=b(At(0),2),u=a[0],l=a[1];function h(){var t=this.children.selected;u()||(o(t&&t.id),V(t.url),s(.9),l(1),d.setFocus(),e=ie())}var c=[{title:"Streaming Test",id:"vod",url:"https://live-par-2-cdn-alt.livepush.io/live/bigbuckbunnyclip/index.m3u8",description:"Streaming Implementation"},{title:"Bunny Video",id:"bunny",url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",description:"VoD Implementation"}];function f(t){var e=b(At(4294967295),2),n=e[0],i=e[1];return Ln(kn,Bn(t,{onFocus:function(){return i(255)},onBlur:function(){return i(4294967295)},animate:!0,style:{width:370,height:320,borderRadius:6,scale:1,color:405488895,focus:{scale:1.1,color:4294967295}},get children(){return Ln(kn,{x:30,get children(){return[Ln(mn,{y:30,fontSize:84,get color(){return n()},get children(){return t.index+1}}),Ln(mn,{y:140,fontSize:42,width:340,height:42,contain:"both",get color(){return n()},get children(){return t.title}}),Ln(mn,{y:200,fontSize:28,width:330,contain:"width",get color(){return n()},get children(){return t.description}})]}})}}))}var d,A=b(At(140),2),g=A[0];A[1];function p(t){u()&&d.setFocus()}vt(kt(ie,(function(t){u()&&d.setFocus()}),{defer:!0}));var v=function(){var t,e,n;u()&&(t=document.getElementById("video"),e=document.getElementById("live-indicator"),n=document.getElementById("current-time"),"video"===e.getAttribute("data-type")&&(t.currentTime=Math.max(t.currentTime-10,0),n.innerHTML=X(t.currentTime)))},_=function(){var t,e,n;u()&&(t=document.getElementById("video"),e=document.getElementById("live-indicator"),n=document.getElementById("current-time"),"video"===e.getAttribute("data-type")&&(t.currentTime=Math.min(t.currentTime+10,t.duration),n.innerHTML=X(t.currentTime)))},y=function(){u()&&function(){var t=document.activeElement.getAttribute("id");if(t)if("playpause"!==t)if("max"!==t)if("mute"!==t){if("quality-btn"!==t){if(t.includes("quality-")){var e,n=parseInt(q(t),10);(e=document.getElementById("quality-"+(n+1)))&&e.focus()}}else if("dropdown-content show"===(e=document.getElementById("quality")).className){var i=document.getElementById("quality-0");i&&i.focus()}}else document.getElementById("quality-btn").focus();else document.getElementById("mute").focus();else document.getElementById("max").focus();else document.getElementById("playpause").focus()}()},x=function(){u()&&function(){var t=document.activeElement.getAttribute("id");if(t)if("max"!==t)if("mute"!==t)if("quality-btn"!==t){if(t.includes("quality-")){var e=parseInt(q(t),10);0===e?document.getElementById("quality-btn").focus():document.getElementById("quality-"+(e-1)).focus()}}else document.getElementById("mute").focus();else document.getElementById("max").focus();else document.getElementById("playpause").focus();else document.getElementById("playpause").focus()}()};return Ln(kn,{colorTop:1147903743,colorBottom:743406847,onEscape:function(){Z(),s(0),l(0),setTimeout((function(){e.setFocus()}),10)},get children(){return[Ln(kn,{x:120,get children(){return[Ln(mn,{fontSize:90,x:110,y:40,children:"Videos"}),Ln(kn,{y:140,height:1,width:1800,color:3906468351})]}}),Ln(ji,{onSelectedChanged:p,onEnter:h,animationSettings:{delay:20,duration:300},animate:!0,get x(){return g()},y:300,width:4400,get style(){return or.Row},justifyContent:"flexStart",gap:40,get children(){return[Ln($t,{each:c,children:function(t,e){return Ln(f,Bn({get skipFocus(){return u()},get autofocus(){return n(e())},get index(){return e()}},t))}}),Ln(kn,{y:240,height:10,width:10,color:3906468351,onLeft:v,onRight:_,onUp:y,onDown:x,ref:function(t){"function"==typeof d?d(t):d=t},skipFocus:!0})]}}),Ln(kn,{get alpha(){return r()},get color(){return Dn("#000000")},zIndex:200})]}})}var Gr=function(){return Ln(kn,{style:{width:1920,height:1080,color:868483072},get children(){return Ln(mn,{children:"Not Found"})}})},Yr=1100,Xr=m(m({},tr.display2),{},{width:Yr,height:58,contain:"both"}),Vr=function(t){return Ln(mn,Bn(t,{style:Xr,get children(){return t.children}}))},Zr=m(m({},tr.body1),{},{width:Yr,height:72,contain:"both"}),qr={fontSize:20,lineHeight:20},Kr=function(t){return Ln(mn,Bn(t,{style:Zr,get children(){return t.children}}))};var Jr=function(t){return e=Rn("node"),On(Si,e,(function(){return[8,15,13,15]})),Pn(e,Bn(t,{style:{color:"0x00000099",borderRadius:8,border:{width:3,color:"0xffffffff"}}}),!0),Mn(e,Ln(mn,{style:qr,get children(){return t.children}})),e;var e},$r=tr.body2,to=function(t){return Ln(kn,{get style(){return m(m({},qi),{},{gap:12,width:Yr,height:48})},get children(){return[Ln(mn,{style:$r,get children(){return t.metaText}}),Ln($t,{get each(){return t.badges},children:function(t){return Ln(Jr,{y:-5,children:t})}}),In((function(){return e=t.reviews,[Ln(te,{get when(){return(null==e?void 0:e.rtCrit)&&"0"!==(null==e?void 0:e.rtCrit)},get children(){return[Ln(kn,{src:"https://upload.wikimedia.org/wikipedia/commons/b/b6/Tomato-Torrent-Icon.png",title:"Rotten Tomatoes Rating",style:{width:30,height:30,marginRight:-6}}),Ln(mn,{style:$r,get children(){return e.rtCrit+"%"}})]}}),Ln(te,{get when(){return(null==e?void 0:e.rtFan)&&"0"!==(null==e?void 0:e.rtFan)},get children(){return[Ln(kn,{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Rotten_Tomatoes_positive_audience.svg/80px-Rotten_Tomatoes_positive_audience.svg.png",title:"Rotten Tomatoes Rating",style:{width:24,height:30,marginRight:-6}}),Ln(mn,{style:$r,get children(){return e.rtFan+"%"}})]}})];var e}))]}})},eo=function(t){return console.log("badges",t.badges),Ln(kn,Bn(t,{get style(){return m(m({},Ki),{},{width:Yr,height:160,gap:16})},get children(){return[Ln(Vr,{get children(){return t.title}}),Ln(Kr,{get children(){return t.description}}),Ln(to,{get metaText(){return t.metaText},get badges(){return t.badges},get reviews(){return t.reviews}})]}}))};function no(t){return t.split("-")[0]}function io(t){var e=t.type,n=t.id,i="movie"===e?{rtCrit:86,rtFan:92}:{};return Nr.get("/".concat(e,"/").concat(n)).then((function(t){return m({backgroundImage:Or(t.backdrop_path,"original"),heroContent:{title:t.title||t.name,description:t.overview,badges:["HD"],metaText:"movie"===e?(n=t.runtime,r=n%60,Math.floor(n/60)+"h "+(r<10?"0":"")+r+"m - "+t.release_date):"".concat(no(t.first_air_date)," - ").concat(no(t.last_air_date)),reviews:i}},t);var n,r}))}var ro={Row:{display:"flex",justifyContent:"spaceBetween",height:300},Column:{display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:15,width:Ji.screenW-2*Ji.marginX,x:Ji.marginX+Ji.gutterX,y:100,zIndex:2},itemsContainer:{width:Ji.screenW,height:600,y:350,x:0,zIndex:2}};function oo(t){console.log(t.type);var e=xt((function(){return 0}));return Ln(kn,{clipping:!0,get style(){return ro.itemsContainer},get children(){return Ln(Hi,{plinko:!0,announce:"All Trending - Week",animate:!0,get y(){return t.y},get style(){return ro.Column},get children(){return Ln($t,{get each(){return(null==t?void 0:t.data)||[]},children:function(n,i){return Ln(Er,{get autofocus(){return e(i())},justifyContent:"flexStart",items:n,get onFocus(){return t.onFocus},get onEnter(){return t.onEnter}})}})}})}})}var so=function(){var t=ti(),e=b(At(0),2),n=e[0],i=e[1],r=b(At(),2),s=r[0];r[1];yt(s,io);var a=b(At({}),2),u=a[0],l=a[1],h=$n();xt((function(){return 0}));var c=_t((function(){return Ir(Hr(t.filter||"all",8))}));function f(){var t;null===(t=this.children.selected)||void 0===t||t.setFocus(),i(-1*(this.y||0)+24);var e=c().pages().length;this.parent&&(0===e||this.parent.selected&&this.parent.selected>=e-2)&&c().setPage((function(t){return t+1}))}function d(){var t=this.children.selected;o(t&&t.href),h(t.href)}return vt(kt(ie,(function(t){t.backdrop&&Gi(t.backdrop),t.heroContent&&l(t.heroContent)}),{defer:!0})),Ln(te,{get when(){return c().pages().length},get children(){return[Ln(eo,Bn({y:150,x:90},u)),Ln(oo,{type:"sliderList",onEnter:d,onFocus:f,get data(){return c().pages()},get y(){return n()}})]}})},ao={Row:{display:"flex",justifyContent:"spaceBetween",height:290},Column:{display:"flex",flexDirection:"column",justifyContent:"flexStart",gap:10,width:Ji.screenW-2*Ji.marginX,x:Ji.marginX+Ji.gutterX,y:100,zIndex:2},itemsContainer:{width:Ji.screenW,height:600,y:350,x:0,zIndex:2}},uo=function(){function t(){_(this,t)}return v(t,null,[{key:"mergeNumbers",value:function(t,e,n){return t*n+e*(1-n)}},{key:"rgb",value:function(t,e,n){return(t<<16)+(e<<8)+n+4278190080}},{key:"rgba",value:function(t,e,n,i){return(t<<16)+(e<<8)+n+16777216*(255*i|0)}},{key:"getRgbString",value:function(t){return"rgb("+(t/65536|0)%256+","+(t/256|0)%256+","+t%256+")"}},{key:"getRgbaString",value:function(t){return"rgba("+(t/65536|0)%256+","+(t/256|0)%256+","+t%256+","+((t/16777216|0)/255).toFixed(4)+")"}},{key:"getRgbaStringFromArray",value:function(t){return"rgba("+Math.floor(255*t[0])+","+Math.floor(255*t[1])+","+Math.floor(255*t[2])+","+(Math.floor(255*t[3])/255).toFixed(4)+")"}},{key:"getRgbaComponentsNormalized",value:function(t){return[(t/65536|0)%256/255,(t/256|0)%256/255,t%256/255,(t/16777216|0)/255]}},{key:"getRgbComponentsNormalized",value:function(t){return[(t/65536|0)%256/255,(t/256|0)%256/255,t%256/255]}},{key:"getRgbaComponents",value:function(t){return[(t/65536|0)%256,(t/256|0)%256,t%256,t/16777216|0]}},{key:"getArgbNumber",value:function(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));var e=((0|t[3])<<24)+((0|t[0])<<16)+((0|t[1])<<8)+(0|t[2]);return e<0&&(e=4294967295+e+1),e}},{key:"mergeColors",value:function(t,e,n){var i=(t/65536|0)%256*n+(e/65536|0)%256*(1-n),r=(t/256|0)%256*n+(e/256|0)%256*(1-n),o=t%256*n+e%256*(1-n),s=(t/16777216|0)*n+(e/16777216|0)*(1-n);return 16777216*Math.round(s)+65536*Math.round(i)+256*Math.round(r)+Math.round(o)}},{key:"mergeMultiColors",value:function(t,e){for(var n=0,i=0,r=0,o=0,s=0,a=t.length,u=0;u<a;u++){var l=(t[u]/65536|0)%256,h=(t[u]/256|0)%256,c=t[u]%256,f=t[u]/16777216|0;n+=l*e[u],i+=h*e[u],r+=c*e[u],o+=f*e[u],s+=e[u]}return s=1/s,16777216*Math.round(o*s)+65536*Math.round(n*s)+256*Math.round(i*s)+Math.round(r*s)}},{key:"mergeMultiColorsEqual",value:function(t){for(var e=0,n=0,i=0,r=0,o=0,s=t.length,a=0;a<s;a++){e+=(t[a]/65536|0)%256,n+=(t[a]/256|0)%256,i+=t[a]%256,r+=t[a]/16777216|0,o+=1}return o=1/o,16777216*Math.round(r*o)+65536*Math.round(e*o)+256*Math.round(n*o)+Math.round(i*o)}},{key:"mergeColorAlpha",value:function(t,e){var n=(t/16777216|0)*e|0;return((t>>16&255)*n/255&255)+((65280&t)*n/255&65280)+(((255&t)<<16)*n/255&16711680)+(n<<24)}},{key:"rad",value:function(t){return t*(Math.PI/180)}},{key:"getTimingBezier",value:function(t,e,n,i){var r=3*t,o=3*(n-t)-r,s=1-r-o,a=3*e,u=3*(i-e)-a,l=1-a-u;return function(t){if(t>=1)return 1;if(t<=0)return 0;for(var e,n,i=.5,h=0;h<20;h++){if((n=t-i*(i*(i*s+o)+r))>-1e-8&&n<1e-8)return i*(i*(i*l+u)+a);if((e=i*(i*(3*s)+2*o)+r)>1e-10&&e<1e-10)break;i+=n/e}for(var c=0,f=1,d=0;d<20;d++){if((n=t-(i=.5*(c+f))*(i*(i*s+o)+r))>-1e-8&&n<1e-8)return i*(i*(i*l+u)+a);n<0?f=i:c=i}}}},{key:"getTimingFunction",value:function(e){switch(e){case"linear":return function(t){return t};case"ease":return t.getTimingBezier(.25,.1,.25,1);case"ease-in":return t.getTimingBezier(.42,0,1,1);case"ease-out":return t.getTimingBezier(0,0,.58,1);case"ease-in-out":return t.getTimingBezier(.42,0,.58,1);case"step-start":return function(){return 1};case"step-end":return function(t){return 1===t?1:0};default:var n="cubic-bezier(";if(e&&0===e.indexOf(n)){var i=e.substr(13,e.length-13-1).split(",");if(4!==i.length)return console.warn("[Lightning] Unknown timing function: "+e),function(t){return t};var r=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(i[2]),a=parseFloat(i[3]);return isNaN(r)||isNaN(o)||isNaN(s)||isNaN(a)?(console.warn("[Lightning] Unknown timing function: "+e),function(t){return t}):t.getTimingBezier(r,o,s,a)}return console.warn("[Lightning] Unknown timing function: "+e),function(t){return t}}}}]),t}(),lo=function(){function t(){_(this,t)}return v(t,null,[{key:"isFunction",value:function(t){return"function"==typeof t}},{key:"isNumber",value:function(t){return"number"==typeof t}},{key:"isInteger",value:function(t){return"number"==typeof t&&t%1==0}},{key:"isBoolean",value:function(t){return!0===t||!1===t}},{key:"isString",value:function(t){return"string"==typeof t}},{key:"clone",value:function(e){return t.isObjectLiteral(e)||Array.isArray(e)?t.getDeepClone(e):e}},{key:"cloneObjShallow",value:function(t){for(var e=Object.keys(t),n={},i=0;i<e.length;i++)n[e[i]]=t[e[i]];return n}},{key:"merge",value:function(t,e){for(var n=Object.keys(e),i=0;i<n.length;i++)t[n[i]]=e[n[i]];return t}},{key:"isObject",value:function(t){var e=typeof t;return!!t&&("object"===e||"function"===e)}},{key:"isPlainObject",value:function(t){return!!t&&"object"===typeof t}},{key:"isObjectLiteral",value:function(t){return"object"==typeof t&&t&&t.constructor===Object}},{key:"getArrayIndex",value:function(e,n){return t.getModuloIndex(e,n.length)}},{key:"getModuloIndex",value:function(t,e){if(0===e)return t;for(;t<0;)t+=Math.ceil(-t/e)*e;return t%=e}},{key:"getDeepClone",value:function(e){var n,i;if(t.isFunction(e))return e;if(Array.isArray(e)){i=[];var r=Object.keys(e);for(n=0;n<r.length;n++)i[r[n]]=t.getDeepClone(e[r[n]]);return i}if(t.isObject(e)){i={};var o=Object.keys(e);for(n=0;n<o.length;n++)i[o[n]]=t.getDeepClone(e[o[n]]);return i}return e}},{key:"equalValues",value:function(e,n){return typeof e==typeof n&&(t.isObjectLiteral(e)?t.isObjectLiteral(n)&&t.equalObjectLiterals(e,n):Array.isArray(e)?Array.isArray(n)&&t.equalArrays(e,n):e===n)}},{key:"equalObjectLiterals",value:function(e,n){var i=Object.keys(e),r=Object.keys(n);if(i.length!==r.length)return!1;for(var o=0,s=i.length;o<s;o++){var a=i[o],u=r[o];if(a!==u)return!1;var l=e[a],h=n[u];if(!t.equalValues(l,h))return!1}return!0}},{key:"equalArrays",value:function(t,e){if(t.length!==e.length)return!1;for(var n=0,i=t.length;n<i;n++)if(!this.equalValues(t[n],e[n]))return!1;return!0}},{key:"setToArray",value:function(t){var e=[];return t.forEach((function(t){e.push(t)})),e}},{key:"iteratorToArray",value:function(t){for(var e=[],n=t.next();!n.done;)e.push(n.value),n=t.next();return e}},{key:"isUcChar",value:function(t){return t>=65&&t<=90}}]),t}();lo.isWeb="undefined"!=typeof window&&"undefined"==typeof sparkscene,lo.isWPE=lo.isWeb&&-1!==navigator.userAgent.indexOf("WPE"),lo.isSpark="undefined"!=typeof sparkscene,lo.isNode="undefined"==typeof window||lo.isSpark,lo.isPS4=lo.isWeb&&-1!==navigator.userAgent.indexOf("PlayStation 4"),lo.isZiggo=lo.isWeb&&(-1!==navigator.userAgent.indexOf("EOSSTB")||-1!==navigator.userAgent.indexOf("HZNSTB"));var ho=function(){function t(){_(this,t)}return v(t,null,[{key:"defaultSetter",value:function(t,e,n){t[e]=n}},{key:"patchObject",value:function(t,e){if(lo.isObjectLiteral(e))for(var n=Object.keys(e),i=0,r=n.length;i<r;i++){var o=n[i];this.patchObjectProperty(t,o,e[o])}else console.error("[Lightning] Settings must be object literal")}},{key:"patchObjectProperty",value:function(e,n,i){var r=e.setSetting||t.defaultSetter;"_"===n.charAt(0)?"__create"!==n&&console.error("[Lightning] Patch of private property '"+n+"' is not allowed"):"type"!==n&&(lo.isFunction(i)&&i.__local&&(i=i.__local(e)),r(e,n,i))}},{key:"local",value:function(t){t.__local=!0}}]),t}(),co=function(){function t(){_(this,t)}return v(t,null,[{key:"getSpacing",value:function(t,e,n){var i,r,o,s=e-1;switch(t){case"flex-start":case"stretch":r=0,o=0;break;case"flex-end":r=n,o=0;break;case"center":r=n/2,o=0;break;case"space-between":r=0,o=Math.max(0,n)/s;break;case"space-around":if(n<0)return this.getSpacing("center",e,n);r=.5*(i=n/(s+1)),o=i;break;case"space-evenly":if(n<0)return this.getSpacing("center",e,n);r=i=n/(s+2),o=i;break;default:throw new Error("Unknown mode: "+t)}return{spacingBefore:r,spacingBetween:o}}}]),t}(),fo=function(){function t(e){_(this,t),this._layout=e,this._totalCrossAxisSize=0}return v(t,[{key:"_lines",get:function(){return this._layout._lines}},{key:"init",value:function(){this._totalCrossAxisSize=this._getTotalCrossAxisSize()}},{key:"align",value:function(){var t=this._layout.crossAxisSize-this._totalCrossAxisSize,e=this._getSpacing(t),n=e.spacingBefore,i=e.spacingBetween,r=this._lines,o=0;"stretch"===this._layout._flexContainer.alignContent&&r.length&&t>0&&(o=t/r.length);for(var s=n,a=0,u=r.length;a<u;a++){var l=s,h=r[a].createItemAligner(),c=r[a].crossAxisLayoutSize+o;h.setCrossAxisLayoutSize(c),h.setCrossAxisLayoutOffset(l),h.align(),h.recursiveResizeOccured&&r[a].setItemPositions(),s+=c,s+=i}}},{key:"totalCrossAxisSize",get:function(){return this._totalCrossAxisSize}},{key:"_getTotalCrossAxisSize",value:function(){for(var t=this._lines,e=0,n=0,i=t.length;n<i;n++){e+=t[n].crossAxisLayoutSize}return e}},{key:"_getSpacing",value:function(t){var e=this._layout._flexContainer.alignContent,n=this._lines.length;return co.getSpacing(e,n,t)}}]),t}(),Ao=function(){function t(){_(this,t)}return v(t,null,[{key:"getParentAxisSizeWithPadding",value:function(t,e){var n=t.target.getParent();if(n){var i=t.flexParent;return i?this.getAxisLayoutSize(i,e)+this.getTotalPadding(i,e):e?n.w:n.h}return 0}},{key:"getRelAxisSize",value:function(t,e){return e?t.funcW?this._allowRelAxisSizeFunction(t,!0)?t.funcW(this.getParentAxisSizeWithPadding(t,!0)):0:t.originalWidth:t.funcH?this._allowRelAxisSizeFunction(t,!1)?t.funcH(this.getParentAxisSizeWithPadding(t,!1)):0:t.originalHeight}},{key:"_allowRelAxisSizeFunction",value:function(t,e){var n=t.flexParent;return!n||!n._flex._layout.isAxisFitToContents(e)}},{key:"isZeroAxisSize",value:function(t,e){return e?!t.originalWidth&&!t.funcW:!t.originalHeight&&!t.funcH}},{key:"getAxisLayoutPos",value:function(t,e){return e?t.x:t.y}},{key:"getAxisLayoutSize",value:function(t,e){return e?t.w:t.h}},{key:"setAxisLayoutPos",value:function(t,e,n){e?t.x=n:t.y=n}},{key:"setAxisLayoutSize",value:function(t,e,n){e?t.w=n:t.h=n}},{key:"getAxisMinSize",value:function(t,e){var n=this.getPlainAxisMinSize(t,e),i=0;return t.isFlexItemEnabled()&&(i=t._flexItem._getMinSizeSetting(e)),i>0&&(n=Math.max(n,i)),n}},{key:"getPlainAxisMinSize",value:function(t,e){return t.isFlexEnabled()?t._flex._layout.getAxisMinSize(e):0!==t.flexItem.shrink?0:this.getRelAxisSize(t,e)}},{key:"resizeAxis",value:function(t,e,n){t.isFlexEnabled()?t._flex._horizontal===e?t._flex._layout.resizeMainAxis(n):t._flex._layout.resizeCrossAxis(n):this.setAxisLayoutSize(t,e,n)}},{key:"getPaddingOffset",value:function(t,e){if(t.isFlexEnabled()){var n=t._flex;return e?n.paddingLeft:n.paddingTop}return 0}},{key:"getTotalPadding",value:function(t,e){if(t.isFlexEnabled()){var n=t._flex;return e?n.paddingRight+n.paddingLeft:n.paddingTop+n.paddingBottom}return 0}},{key:"getMarginOffset",value:function(t,e){var n=t.flexItem;return n?e?n.marginLeft:n.marginTop:0}},{key:"getTotalMargin",value:function(t,e){var n=t.flexItem;return n?e?n.marginRight+n.marginLeft:n.marginTop+n.marginBottom:0}}]),t}(),go=function(){function t(e){_(this,t),this._line=e,this._amountRemaining=0,this._shrunkSize=0}return v(t,[{key:"shrink",value:function(t){this._shrunkSize=0,this._amountRemaining=t;var e=this._getTotalShrinkAmount();if(e){var n=this._line.items;do{for(var i=this._amountRemaining/e,r=this._line.startIndex;r<=this._line.endIndex;r++){var o=n[r].flexItem,s=o.shrink;if(s>0){var a=s*i,u=o._getMainAxisMinSize(),l=o._getMainAxisLayoutSize();if(l>u){var h=l-u;a>=h&&(a=h,e-=s);var c=l-a;if(o._resizeMainAxis(c),this._shrunkSize+=a,this._amountRemaining-=a,Math.abs(this._amountRemaining)<1e-5)return}}}}while(e&&Math.abs(this._amountRemaining)>1e-5)}}},{key:"_getTotalShrinkAmount",value:function(){for(var t=0,e=this._line.items,n=this._line.startIndex;n<=this._line.endIndex;n++){var i=e[n].flexItem;if(i.shrink){var r=i._getMainAxisMinSize();i._getMainAxisLayoutSize()>r&&(t+=i.shrink)}}return t}},{key:"getShrunkSize",value:function(){return this._shrunkSize}}]),t}(),po=function(){function t(e){_(this,t),this._line=e,this._amountRemaining=0,this._grownSize=0}return v(t,[{key:"grow",value:function(t){this._grownSize=0,this._amountRemaining=t;var e=this._getTotalGrowAmount();if(e){var n=this._line.items;do{for(var i=this._amountRemaining/e,r=this._line.startIndex;r<=this._line.endIndex;r++){var o=n[r].flexItem,s=o.grow;if(s>0){var a=s*i,u=o._getMainAxisMaxSizeSetting(),l=o._getMainAxisLayoutSize();if(u>0)if(l>=u)a=0;else{var h=u-l;a>=h&&(a=h,e-=s)}if(a>0){var c=l+a;if(o._resizeMainAxis(c),this._grownSize+=a,this._amountRemaining-=a,Math.abs(this._amountRemaining)<1e-5)return}}}}while(e&&Math.abs(this._amountRemaining)>1e-5)}}},{key:"_getTotalGrowAmount",value:function(){for(var t=0,e=this._line.items,n=this._line.startIndex;n<=this._line.endIndex;n++){var i=e[n].flexItem;if(i.grow){var r=i._getMainAxisMaxSizeSetting(),o=i._getMainAxisLayoutSize();(0===r||o<r)&&(t+=i.grow)}}return t}},{key:"getGrownSize",value:function(){return this._grownSize}}]),t}(),vo=function(){function t(e){_(this,t),this._line=e}return v(t,[{key:"_layout",get:function(){return this._line._layout}},{key:"position",value:function(){for(var t=this._getSpacing(),e=t.spacingBefore,n=t.spacingBetween,i=e,r=this._line.items,o=this._line.startIndex;o<=this._line.endIndex;o++){var s=r[o];s.flexItem._setMainAxisLayoutPos(i),i+=s.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i+=n}}},{key:"_getSpacing",value:function(){var t=this._line._availableSpace,e=this._layout._flexContainer.justifyContent,n=this._line.numberOfItems;return co.getSpacing(e,n,t)}}]),t}(),_o=function(){function t(e){_(this,t),this._line=e,this._crossAxisLayoutSize=0,this._crossAxisLayoutOffset=0,this._alignItemsSetting=null,this._recursiveResizeOccured=!1,this._isCrossAxisFitToContents=!1}return v(t,[{key:"_layout",get:function(){return this._line._layout}},{key:"_flexContainer",get:function(){return this._layout._flexContainer}},{key:"setCrossAxisLayoutSize",value:function(t){this._crossAxisLayoutSize=t}},{key:"setCrossAxisLayoutOffset",value:function(t){this._crossAxisLayoutOffset=t}},{key:"align",value:function(){this._alignItemsSetting=this._flexContainer.alignItems,this._isCrossAxisFitToContents=this._layout.isAxisFitToContents(!this._flexContainer._horizontal),this._recursiveResizeOccured=!1;for(var t=this._line.items,e=this._line.startIndex;e<=this._line.endIndex;e++){var n=t[e];this._alignItem(n)}}},{key:"recursiveResizeOccured",get:function(){return this._recursiveResizeOccured}},{key:"_alignItem",value:function(t){var e=t.flexItem,n=e.alignSelf||this._alignItemsSetting;switch("stretch"===n&&this._preventStretch(e)&&(n="flex-start"),"stretch"===n||this._isCrossAxisFitToContents||e._hasRelCrossAxisSize()&&e._resetCrossAxisLayoutSize(),n){case"flex-start":this._alignItemFlexStart(e);break;case"flex-end":this._alignItemFlexEnd(e);break;case"center":this._alignItemFlexCenter(e);break;case"stretch":this._alignItemStretch(e)}}},{key:"_alignItemFlexStart",value:function(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset)}},{key:"_alignItemFlexEnd",value:function(t){var e=t._getCrossAxisLayoutSizeWithPaddingAndMargin();t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+(this._crossAxisLayoutSize-e))}},{key:"_alignItemFlexCenter",value:function(t){var e=t._getCrossAxisLayoutSizeWithPaddingAndMargin(),n=(this._crossAxisLayoutSize-e)/2;t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+n)}},{key:"_alignItemStretch",value:function(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);var e=t._getMainAxisLayoutSize(),n=this._crossAxisLayoutSize-t._getCrossAxisMargin()-t._getCrossAxisPadding(),i=t._getCrossAxisMinSizeSetting();i>0&&(n=Math.max(n,i));var r=t._getCrossAxisMaxSizeSetting();r>0&&(n=Math.min(n,r)),t._resizeCrossAxis(n),t._getMainAxisLayoutSize()!==e&&(this._recursiveResizeOccured=!0)}},{key:"_preventStretch",value:function(t){var e=t._hasFixedCrossAxisSize(),n="stretch"===t.alignSelf;return e&&!n}}]),t}(),yo=function(){function t(e,n,i,r){_(this,t),this._layout=e,this.items=e.items,this.startIndex=n,this.endIndex=i,this._availableSpace=r}return v(t,[{key:"performLayout",value:function(){this._setItemSizes(),this.setItemPositions(),this._calcLayoutInfo()}},{key:"_setItemSizes",value:function(){this._availableSpace>0?this._growItemSizes(this._availableSpace):this._availableSpace<0&&this._shrinkItemSizes(-this._availableSpace)}},{key:"_growItemSizes",value:function(t){var e=new po(this);e.grow(t),this._availableSpace-=e.getGrownSize()}},{key:"_shrinkItemSizes",value:function(t){var e=new go(this);e.shrink(t),this._availableSpace+=e.getShrunkSize()}},{key:"setItemPositions",value:function(){new vo(this).position()}},{key:"createItemAligner",value:function(){return new _o(this)}},{key:"_calcLayoutInfo",value:function(){this._calcCrossAxisMaxLayoutSize()}},{key:"getMainAxisMinSize",value:function(){for(var t=0,e=this.startIndex;e<=this.endIndex;e++){t+=this.items[e].flexItem._getMainAxisMinSizeWithPaddingAndMargin()}return t}},{key:"numberOfItems",get:function(){return this.endIndex-this.startIndex+1}},{key:"crossAxisLayoutSize",get:function(){var t=this._layout.isCrossAxisFitToContents()&&!this._layout.resizingCrossAxis;return this._layout.isWrapping()||t?this._crossAxisMaxLayoutSize:this._layout.crossAxisSize}},{key:"_calcCrossAxisMaxLayoutSize",value:function(){this._crossAxisMaxLayoutSize=this._getCrossAxisMaxLayoutSize()}},{key:"_getCrossAxisMaxLayoutSize",value:function(){for(var t=0,e=this.startIndex;e<=this.endIndex;e++){var n=this.items[e];t=Math.max(t,n.flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin())}return t}}]),t}(),xo=function(){function t(e){_(this,t),this._layout=e,this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}return v(t,[{key:"lines",get:function(){return this._lines}},{key:"mainAxisMinSize",get:function(){return-1===this._mainAxisMinSize&&(this._mainAxisMinSize=this._getMainAxisMinSize()),this._mainAxisMinSize}},{key:"crossAxisMinSize",get:function(){return-1===this._crossAxisMinSize&&(this._crossAxisMinSize=this._getCrossAxisMinSize()),this._crossAxisMinSize}},{key:"mainAxisContentSize",get:function(){return this._mainAxisContentSize}},{key:"layoutLines",value:function(){this._setup();var t,e=this._layout.items,n=this._layout.isWrapping(),i=0,r=e.length;for(t=0;t<r;t++){var o=e[t];this._layoutFlexItem(o);var s=o.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();if(n&&t>i)this._curMainAxisPos+s>this._mainAxisSize&&(this._layoutLine(i,t-1),this._curMainAxisPos=0,i=t);this._addToMainAxisPos(s)}i<t&&this._layoutLine(i,t-1)}},{key:"_layoutFlexItem",value:function(t){t.isFlexEnabled()?t.flexLayout.updateTreeLayout():t.flexItem._resetLayoutSize()}},{key:"_setup",value:function(){this._mainAxisSize=this._layout.mainAxisSize,this._curMainAxisPos=0,this._maxMainAxisPos=0,this._lines=[],this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}},{key:"_addToMainAxisPos",value:function(t){this._curMainAxisPos+=t,this._curMainAxisPos>this._maxMainAxisPos&&(this._maxMainAxisPos=this._curMainAxisPos)}},{key:"_layoutLine",value:function(t,e){var n=this._getAvailableMainAxisLayoutSpace(),i=new yo(this._layout,t,e,n);i.performLayout(),this._lines.push(i),(0===this._mainAxisContentSize||this._curMainAxisPos>this._mainAxisContentSize)&&(this._mainAxisContentSize=this._curMainAxisPos)}},{key:"_getAvailableMainAxisLayoutSpace",value:function(){return!this._layout.resizingMainAxis&&this._layout.isMainAxisFitToContents()?0:this._mainAxisSize-this._curMainAxisPos}},{key:"_getCrossAxisMinSize",value:function(){for(var t=0,e=this._layout.items,n=0,i=e.length;n<i;n++){var r=e[n].flexItem._getCrossAxisMinSizeWithPaddingAndMargin();t=Math.max(t,r)}return t}},{key:"_getMainAxisMinSize",value:function(){return 1===this._lines.length?this._lines[0].getMainAxisMinSize():this._layout.mainAxisSize}}]),t}(),mo=function(){function t(e){_(this,t),this._layout=e,this._isReverse=this._flexContainer._reverse,this._horizontalPaddingOffset=this._layout._getHorizontalPaddingOffset(),this._verticalPaddingOffset=this._layout._getVerticalPaddingOffset()}return v(t,[{key:"_flexContainer",get:function(){return this._layout._flexContainer}},{key:"finalize",value:function(){var e=this._layout.getParentFlexContainer();e?new t(e._layout)._finalizeItemAndChildren(this._flexContainer.item):(this._finalizeRoot(),this._finalizeItems())}},{key:"_finalizeRoot",value:function(){var t=this._flexContainer.item,e=Ao.getAxisLayoutPos(t,!0),n=Ao.getAxisLayoutPos(t,!1),i=Ao.getAxisLayoutSize(t,!0),r=Ao.getAxisLayoutSize(t,!1);i+=this._layout._getHorizontalPadding(),r+=this._layout._getVerticalPadding(),t.clearRecalcFlag(),t.setLayout(e,n,i,r)}},{key:"_finalizeItems",value:function(){for(var t=this._layout.items,e=0,n=t.length;e<n;e++){var i=t[e],r=this._validateItemCache(i);this._finalizeItem(i),r||this._finalizeItemChildren(i)}}},{key:"_validateItemCache",value:function(t){if(0===t.recalc&&t.isFlexEnabled()){var e=t._flex._layout;if(t.w===t.target.w&&t.h===t.target.h)return!0;var n=e.crossAxisSize;e.performResizeMainAxis(e.mainAxisSize),e.performResizeCrossAxis(n)}return!1}},{key:"_finalizeItemAndChildren",value:function(t){this._finalizeItem(t),this._finalizeItemChildren(t)}},{key:"_finalizeItem",value:function(t){this._isReverse&&this._reverseMainAxisLayoutPos(t);var e=Ao.getAxisLayoutPos(t,!0),n=Ao.getAxisLayoutPos(t,!1),i=Ao.getAxisLayoutSize(t,!0),r=Ao.getAxisLayoutSize(t,!1);e+=this._horizontalPaddingOffset,n+=this._verticalPaddingOffset,t.flex&&(i+=t._flex._layout._getHorizontalPadding(),r+=t._flex._layout._getVerticalPadding());var o=t.flexItem;o&&(e+=o._getHorizontalMarginOffset(),n+=o._getVerticalMarginOffset()),t.clearRecalcFlag(),t.setLayout(e,n,i,r)}},{key:"_finalizeItemChildren",value:function(e){var n=e._flex;n&&new t(n._layout)._finalizeItems()}},{key:"_reverseMainAxisLayoutPos",value:function(t){var e=t.flexItem._getMainAxisLayoutPos()+t.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),n=this._layout.mainAxisSize-e;t.flexItem._setMainAxisLayoutPos(n)}}]),t}(),ko=function(){function t(e){_(this,t),this._flexContainer=e,this._lineLayouter=new xo(this),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._cachedMainAxisSizeAfterLayout=0,this._cachedCrossAxisSizeAfterLayout=0,this._shrunk=!1}return v(t,[{key:"shrunk",get:function(){return this._shrunk}},{key:"recalc",get:function(){return this.item.recalc}},{key:"layoutTree",value:function(){null!==this.item.flexParent?this._updateSubTreeLayout():this.updateTreeLayout(),this.updateItemCoords()}},{key:"updateTreeLayout",value:function(){this.recalc?this._performUpdateLayoutTree():this._performUpdateLayoutTreeFromCache()}},{key:"_performUpdateLayoutTree",value:function(){this._setInitialAxisSizes(),this._layoutAxes(),this._refreshLayoutCache()}},{key:"_refreshLayoutCache",value:function(){this._cachedMainAxisSizeAfterLayout=this.mainAxisSize,this._cachedCrossAxisSizeAfterLayout=this.crossAxisSize}},{key:"_performUpdateLayoutTreeFromCache",value:function(){this.item.funcW||this.item.funcH?(this.item.enableLocalRecalcFlag(),this._performUpdateLayoutTree()):(this.mainAxisSize=this._cachedMainAxisSizeAfterLayout,this.crossAxisSize=this._cachedCrossAxisSizeAfterLayout)}},{key:"updateItemCoords",value:function(){new mo(this).finalize()}},{key:"_updateSubTreeLayout",value:function(){var t=this.crossAxisSize;this._layoutMainAxis(),this.performResizeCrossAxis(t)}},{key:"_setInitialAxisSizes",value:function(){this.item.isFlexItemEnabled()?this.item.flexItem._resetLayoutSize():(this.mainAxisSize=this._getMainAxisBasis(),this.crossAxisSize=this._getCrossAxisBasis()),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._shrunk=!1}},{key:"_layoutAxes",value:function(){this._layoutMainAxis(),this._layoutCrossAxis()}},{key:"_layoutMainAxis",value:function(){this._layoutLines(),this._fitMainAxisSizeToContents()}},{key:"_layoutLines",value:function(){this._lineLayouter.layoutLines()}},{key:"_lines",get:function(){return this._lineLayouter.lines}},{key:"_fitMainAxisSizeToContents",value:function(){this._resizingMainAxis||this.isMainAxisFitToContents()&&(this.mainAxisSize=this._lineLayouter.mainAxisContentSize)}},{key:"_layoutCrossAxis",value:function(){var t=new fo(this);t.init(),this._totalCrossAxisSize=t.totalCrossAxisSize,this._fitCrossAxisSizeToContents(),t.align()}},{key:"_fitCrossAxisSizeToContents",value:function(){this._resizingCrossAxis||this.isCrossAxisFitToContents()&&(this.crossAxisSize=this._totalCrossAxisSize)}},{key:"isWrapping",value:function(){return this._flexContainer.wrap}},{key:"isAxisFitToContents",value:function(t){return this._horizontal===t?this.isMainAxisFitToContents():this.isCrossAxisFitToContents()}},{key:"isMainAxisFitToContents",value:function(){return!this.isWrapping()&&!this._hasFixedMainAxisBasis()}},{key:"isCrossAxisFitToContents",value:function(){return!this._hasFixedCrossAxisBasis()}},{key:"_hasFixedMainAxisBasis",value:function(){return!Ao.isZeroAxisSize(this.item,this._horizontal)}},{key:"_hasFixedCrossAxisBasis",value:function(){return!Ao.isZeroAxisSize(this.item,!this._horizontal)}},{key:"getAxisMinSize",value:function(t){return this._horizontal===t?this._getMainAxisMinSize():this._getCrossAxisMinSize()}},{key:"_getMainAxisMinSize",value:function(){return this._lineLayouter.mainAxisMinSize}},{key:"_getCrossAxisMinSize",value:function(){return this._lineLayouter.crossAxisMinSize}},{key:"resizeMainAxis",value:function(t){this.mainAxisSize!==t&&(this.recalc>0?this.performResizeMainAxis(t):this._checkValidCacheMainAxisResize()?(this.mainAxisSize=t,this._fitCrossAxisSizeToContents()):(this.item.enableLocalRecalcFlag(),this.performResizeMainAxis(t)))}},{key:"_checkValidCacheMainAxisResize",value:function(t){return t===this.targetMainAxisSize||!this.isCrossAxisFitToContents()}},{key:"performResizeMainAxis",value:function(t){var e=t<this.mainAxisSize;this._shrunk=e,this.mainAxisSize=t,this._resizingMainAxis=!0,this._layoutAxes(),this._resizingMainAxis=!1}},{key:"resizeCrossAxis",value:function(t){this.crossAxisSize!==t&&(this.recalc>0?this.performResizeCrossAxis(t):this.crossAxisSize=t)}},{key:"performResizeCrossAxis",value:function(t){this.crossAxisSize=t,this._resizingCrossAxis=!0,this._layoutCrossAxis(),this._resizingCrossAxis=!1}},{key:"targetMainAxisSize",get:function(){return this._horizontal?this.item.target.w:this.item.target.h}},{key:"targetCrossAxisSize",get:function(){return this._horizontal?this.item.target.h:this.item.target.w}},{key:"getParentFlexContainer",value:function(){return this.item.isFlexItemEnabled()?this.item.flexItem.ctr:null}},{key:"_getHorizontalPadding",value:function(){return Ao.getTotalPadding(this.item,!0)}},{key:"_getVerticalPadding",value:function(){return Ao.getTotalPadding(this.item,!1)}},{key:"_getHorizontalPaddingOffset",value:function(){return Ao.getPaddingOffset(this.item,!0)}},{key:"_getVerticalPaddingOffset",value:function(){return Ao.getPaddingOffset(this.item,!1)}},{key:"_getMainAxisBasis",value:function(){return Ao.getRelAxisSize(this.item,this._horizontal)}},{key:"_getCrossAxisBasis",value:function(){return Ao.getRelAxisSize(this.item,!this._horizontal)}},{key:"_horizontal",get:function(){return this._flexContainer._horizontal}},{key:"_reverse",get:function(){return this._flexContainer._reverse}},{key:"item",get:function(){return this._flexContainer.item}},{key:"items",get:function(){return this.item.items}},{key:"resizingMainAxis",get:function(){return this._resizingMainAxis}},{key:"resizingCrossAxis",get:function(){return this._resizingCrossAxis}},{key:"numberOfItems",get:function(){return this.items.length}},{key:"mainAxisSize",get:function(){return Ao.getAxisLayoutSize(this.item,this._horizontal)},set:function(t){Ao.setAxisLayoutSize(this.item,this._horizontal,t)}},{key:"crossAxisSize",get:function(){return Ao.getAxisLayoutSize(this.item,!this._horizontal)},set:function(t){Ao.setAxisLayoutSize(this.item,!this._horizontal,t)}}]),t}(),To=function(){function t(e){_(this,t),this._item=e,this._layout=new ko(this),this._horizontal=!0,this._reverse=!1,this._wrap=!1,this._alignItems="stretch",this._justifyContent="flex-start",this._alignContent="flex-start",this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0}return v(t,[{key:"item",get:function(){return this._item}},{key:"_changedDimensions",value:function(){this._item.changedDimensions()}},{key:"_changedContents",value:function(){this._item.changedContents()}},{key:"direction",get:function(){return(this._horizontal?"row":"column")+(this._reverse?"-reverse":"")},set:function(t){this.direction!==t&&(this._horizontal="row"===t||"row-reverse"===t,this._reverse="row-reverse"===t||"column-reverse"===t,this._changedContents())}},{key:"wrap",get:function(){return this._wrap},set:function(t){this._wrap=t,this._changedContents()}},{key:"alignItems",get:function(){return this._alignItems},set:function(e){if(this._alignItems!==e){if(-1===t.ALIGN_ITEMS.indexOf(e))throw new Error("Unknown alignItems, options: "+t.ALIGN_ITEMS.join(","));this._alignItems=e,this._changedContents()}}},{key:"alignContent",get:function(){return this._alignContent},set:function(e){if(this._alignContent!==e){if(-1===t.ALIGN_CONTENT.indexOf(e))throw new Error("Unknown alignContent, options: "+t.ALIGN_CONTENT.join(","));this._alignContent=e,this._changedContents()}}},{key:"justifyContent",get:function(){return this._justifyContent},set:function(e){if(this._justifyContent!==e){if(-1===t.JUSTIFY_CONTENT.indexOf(e))throw new Error("Unknown justifyContent, options: "+t.JUSTIFY_CONTENT.join(","));this._justifyContent=e,this._changedContents()}}},{key:"padding",get:function(){return this.paddingLeft},set:function(t){this.paddingLeft=t,this.paddingTop=t,this.paddingRight=t,this.paddingBottom=t}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft=t,this._changedDimensions()}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop=t,this._changedDimensions()}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight=t,this._changedDimensions()}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom=t,this._changedDimensions()}},{key:"patch",value:function(t){ho.patchObject(this,t)}}]),t}();To.ALIGN_ITEMS=["flex-start","flex-end","center","stretch"],To.ALIGN_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly","stretch"],To.JUSTIFY_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly"];var bo=function(){function t(e){_(this,t),this._ctr=null,this._item=e,this._grow=0,this._shrink=t.SHRINK_AUTO,this._alignSelf=void 0,this._minWidth=0,this._minHeight=0,this._maxWidth=0,this._maxHeight=0,this._marginLeft=0,this._marginTop=0,this._marginRight=0,this._marginBottom=0}return v(t,[{key:"item",get:function(){return this._item}},{key:"grow",get:function(){return this._grow},set:function(t){this._grow!==t&&(this._grow=parseInt(t)||0,this._changed())}},{key:"shrink",get:function(){return this._shrink===t.SHRINK_AUTO?this._getDefaultShrink():this._shrink},set:function(t){this._shrink!==t&&(this._shrink=parseInt(t)||0,this._changed())}},{key:"_getDefaultShrink",value:function(){return this.item.isFlexEnabled()?1:0}},{key:"alignSelf",get:function(){return this._alignSelf},set:function(t){if(this._alignSelf!==t){if(void 0===t)this._alignSelf=void 0;else{if(-1===To.ALIGN_ITEMS.indexOf(t))throw new Error("Unknown alignSelf, options: "+To.ALIGN_ITEMS.join(","));this._alignSelf=t}this._changed()}}},{key:"minWidth",get:function(){return this._minWidth},set:function(t){this._minWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}},{key:"minHeight",get:function(){return this._minHeight},set:function(t){this._minHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}},{key:"maxHeight",get:function(){return this._maxHeight},set:function(t){this._maxHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}},{key:"margin",get:function(){return this.marginLeft},set:function(t){this.marginLeft=t,this.marginTop=t,this.marginRight=t,this.marginBottom=t}},{key:"marginLeft",get:function(){return this._marginLeft},set:function(t){this._marginLeft=t,this._changed()}},{key:"marginTop",get:function(){return this._marginTop},set:function(t){this._marginTop=t,this._changed()}},{key:"marginRight",get:function(){return this._marginRight},set:function(t){this._marginRight=t,this._changed()}},{key:"marginBottom",get:function(){return this._marginBottom},set:function(t){this._marginBottom=t,this._changed()}},{key:"_changed",value:function(){this.ctr&&this.ctr._changedContents()}},{key:"ctr",get:function(){return this._ctr},set:function(t){this._ctr=t}},{key:"patch",value:function(t){ho.patchObject(this,t)}},{key:"_resetLayoutSize",value:function(){this._resetHorizontalAxisLayoutSize(),this._resetVerticalAxisLayoutSize()}},{key:"_resetCrossAxisLayoutSize",value:function(){this.ctr._horizontal?this._resetVerticalAxisLayoutSize():this._resetHorizontalAxisLayoutSize()}},{key:"_resetHorizontalAxisLayoutSize",value:function(){var t=Ao.getRelAxisSize(this.item,!0);this._minWidth&&(t=Math.max(this._minWidth,t)),this._maxWidth&&(t=Math.min(this._maxWidth,t)),Ao.setAxisLayoutSize(this.item,!0,t)}},{key:"_resetVerticalAxisLayoutSize",value:function(){var t=Ao.getRelAxisSize(this.item,!1);this._minHeight&&(t=Math.max(this._minHeight,t)),this._maxHeight&&(t=Math.min(this._maxHeight,t)),Ao.setAxisLayoutSize(this.item,!1,t)}},{key:"_getCrossAxisMinSizeSetting",value:function(){return this._getMinSizeSetting(!this.ctr._horizontal)}},{key:"_getCrossAxisMaxSizeSetting",value:function(){return this._getMaxSizeSetting(!this.ctr._horizontal)}},{key:"_getMainAxisMaxSizeSetting",value:function(){return this._getMaxSizeSetting(this.ctr._horizontal)}},{key:"_getMinSizeSetting",value:function(t){return t?this._minWidth:this._minHeight}},{key:"_getMaxSizeSetting",value:function(t){return t?this._maxWidth:this._maxHeight}},{key:"_getMainAxisMinSize",value:function(){return Ao.getAxisMinSize(this.item,this.ctr._horizontal)}},{key:"_getCrossAxisMinSize",value:function(){return Ao.getAxisMinSize(this.item,!this.ctr._horizontal)}},{key:"_getMainAxisLayoutSize",value:function(){return Ao.getAxisLayoutSize(this.item,this.ctr._horizontal)}},{key:"_getMainAxisLayoutPos",value:function(){return Ao.getAxisLayoutPos(this.item,this.ctr._horizontal)}},{key:"_setMainAxisLayoutPos",value:function(t){return Ao.setAxisLayoutPos(this.item,this.ctr._horizontal,t)}},{key:"_setCrossAxisLayoutPos",value:function(t){return Ao.setAxisLayoutPos(this.item,!this.ctr._horizontal,t)}},{key:"_getCrossAxisLayoutSize",value:function(){return Ao.getAxisLayoutSize(this.item,!this.ctr._horizontal)}},{key:"_resizeCrossAxis",value:function(t){return Ao.resizeAxis(this.item,!this.ctr._horizontal,t)}},{key:"_resizeMainAxis",value:function(t){return Ao.resizeAxis(this.item,this.ctr._horizontal,t)}},{key:"_getMainAxisPadding",value:function(){return Ao.getTotalPadding(this.item,this.ctr._horizontal)}},{key:"_getCrossAxisPadding",value:function(){return Ao.getTotalPadding(this.item,!this.ctr._horizontal)}},{key:"_getMainAxisMargin",value:function(){return Ao.getTotalMargin(this.item,this.ctr._horizontal)}},{key:"_getCrossAxisMargin",value:function(){return Ao.getTotalMargin(this.item,!this.ctr._horizontal)}},{key:"_getHorizontalMarginOffset",value:function(){return Ao.getMarginOffset(this.item,!0)}},{key:"_getVerticalMarginOffset",value:function(){return Ao.getMarginOffset(this.item,!1)}},{key:"_getMainAxisMinSizeWithPaddingAndMargin",value:function(){return this._getMainAxisMinSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}},{key:"_getCrossAxisMinSizeWithPaddingAndMargin",value:function(){return this._getCrossAxisMinSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}},{key:"_getMainAxisLayoutSizeWithPaddingAndMargin",value:function(){return this._getMainAxisLayoutSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}},{key:"_getCrossAxisLayoutSizeWithPaddingAndMargin",value:function(){return this._getCrossAxisLayoutSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}},{key:"_hasFixedCrossAxisSize",value:function(){return!Ao.isZeroAxisSize(this.item,!this.ctr._horizontal)}},{key:"_hasRelCrossAxisSize",value:function(){return!!(this.ctr._horizontal?this.item.funcH:this.item.funcW)}}]),t}();bo.SHRINK_AUTO=-1;var wo=function(){function t(e){_(this,t),this._target=e,this._recalc=0,this._enabled=!1,this.x=0,this.y=0,this.w=0,this.h=0,this._originalX=0,this._originalY=0,this._originalWidth=0,this._originalHeight=0,this._flex=null,this._flexItem=null,this._flexItemDisabled=!1,this._items=null}return v(t,[{key:"flexLayout",get:function(){return this.flex?this.flex._layout:null}},{key:"layoutFlexTree",value:function(){this.isFlexEnabled()&&this.isChanged()&&this.flexLayout.layoutTree()}},{key:"target",get:function(){return this._target}},{key:"flex",get:function(){return this._flex},set:function(t){t?(this.isFlexEnabled()||this._enableFlex(),this._flex.patch(t)):this.isFlexEnabled()&&this._disableFlex()}},{key:"flexItem",get:function(){return!this._flexItemDisabled&&(this._ensureFlexItem(),this._flexItem)},set:function(t){if(!1===t){if(!this._flexItemDisabled){var e=this.flexParent;this._flexItemDisabled=!0,this._checkEnabled(),e&&(e._clearFlexItemsCache(),e.changedContents())}}else if(this._ensureFlexItem(),this._flexItem.patch(t),this._flexItemDisabled){this._flexItemDisabled=!1,this._checkEnabled();var n=this.flexParent;n&&(n._clearFlexItemsCache(),n.changedContents())}}},{key:"_enableFlex",value:function(){this._flex=new To(this),this._checkEnabled(),this.changedDimensions(),this._enableChildrenAsFlexItems()}},{key:"_disableFlex",value:function(){this.changedDimensions(),this._flex=null,this._checkEnabled(),this._disableChildrenAsFlexItems()}},{key:"_enableChildrenAsFlexItems",value:function(){var t=this._target._children;if(t)for(var e=0,n=t.length;e<n;e++){t[e].layout._enableFlexItem()}}},{key:"_disableChildrenAsFlexItems",value:function(){var t=this._target._children;if(t)for(var e=0,n=t.length;e<n;e++){t[e].layout._disableFlexItem()}}},{key:"_enableFlexItem",value:function(){this._ensureFlexItem();var t=this._target._parent._layout;this._flexItem.ctr=t._flex,t.changedContents(),this._checkEnabled()}},{key:"_disableFlexItem",value:function(){this._flexItem&&(this._flexItem.ctr=null),this._checkEnabled(),this._resetOffsets()}},{key:"_resetOffsets",value:function(){this.x=0,this.y=0}},{key:"_ensureFlexItem",value:function(){this._flexItem||(this._flexItem=new bo(this))}},{key:"_checkEnabled",value:function(){var t=this.isEnabled();this._enabled!==t&&(t?this._enable():this._disable(),this._enabled=t)}},{key:"_enable",value:function(){this._setupTargetForFlex(),this._target.enableFlexLayout()}},{key:"_disable",value:function(){this._restoreTargetToNonFlex(),this._target.disableFlexLayout()}},{key:"isEnabled",value:function(){return this.isFlexEnabled()||this.isFlexItemEnabled()}},{key:"isFlexEnabled",value:function(){return null!==this._flex}},{key:"isFlexItemEnabled",value:function(){return null!==this.flexParent}},{key:"_restoreTargetToNonFlex",value:function(){var t=this._target;t.x=this._originalX,t.y=this._originalY,t.setDimensions(this._originalWidth,this._originalHeight)}},{key:"_setupTargetForFlex",value:function(){var t=this._target;this._originalX=t._x,this._originalY=t._y,this._originalWidth=t._w,this._originalHeight=t._h}},{key:"setParent",value:function(t,e){t&&t.isFlexContainer()&&t._layout._changedChildren(),e&&e.isFlexContainer()&&(this._enableFlexItem(),e._layout._changedChildren()),this._checkEnabled()}},{key:"flexParent",get:function(){if(this._flexItemDisabled)return null;var t=this._target._parent;return t&&t.isFlexContainer()?t._layout:null}},{key:"setVisible",value:function(t){var e=this.flexParent;e&&e._changedChildren()}},{key:"items",get:function(){return this._items||(this._items=this._getFlexItems()),this._items}},{key:"_getFlexItems",value:function(){var t=[],e=this._target._children;if(e)for(var n=0,i=e.length;n<i;n++){var r=e[n];r.visible&&r.isFlexItem()&&t.push(r.layout)}return t}},{key:"_changedChildren",value:function(){this._clearFlexItemsCache(),this.changedContents()}},{key:"_clearFlexItemsCache",value:function(){this._items=null}},{key:"setLayout",value:function(t,e,n,i){var r=this._originalX,o=this._originalY;this.funcX&&(r=this.funcX(Ao.getParentAxisSizeWithPadding(this,!0))),this.funcY&&(o=this.funcY(Ao.getParentAxisSizeWithPadding(this,!1))),this.isFlexItemEnabled()?this.target.setLayout(t+r,e+o,n,i):this.target.setLayout(r,o,n,i)}},{key:"changedDimensions",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._updateRecalc(t,e)}},{key:"changedContents",value:function(){this._updateRecalc()}},{key:"forceLayout",value:function(){this._updateRecalc()}},{key:"isChanged",value:function(){return this._recalc>0}},{key:"_updateRecalc",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isFlexEnabled()){var n=this._flex._layout;t=t||n.isAxisFitToContents(!0),e=e||n.isAxisFitToContents(!1)}var i=1+(t?2:0)+(e?4:0),r=this.getNewRecalcFlags(i);this._recalc|=i,r>1&&this.flexParent?this.flexParent._updateRecalcBottomUp(i):this._target.triggerLayout()}},{key:"getNewRecalcFlags",value:function(t){return 7-this._recalc&t}},{key:"_updateRecalcBottomUp",value:function(t){var e=this._getRecalcFromChangedChildRecalc(t),n=this.getNewRecalcFlags(e);if(this._recalc|=e,n>1){var i=this.flexParent;i?i._updateRecalcBottomUp(e):this._target.triggerLayout()}else this._target.triggerLayout()}},{key:"_getRecalcFromChangedChildRecalc",value:function(t){var e=this._flex._layout,n=e._horizontal?1:2,i=e._horizontal?2:1;t&i||t&n&&e.isWrapping()&&e.isCrossAxisFitToContents()&&(t+=i);var r=e.isAxisFitToContents(!0),o=e.isAxisFitToContents(!1);return e.shrunk&&(e._horizontal?r=!0:o=!0),t&1+(r?2:0)+(o?4:0)}},{key:"recalc",get:function(){return this._recalc}},{key:"clearRecalcFlag",value:function(){this._recalc=0}},{key:"enableLocalRecalcFlag",value:function(){this._recalc=1}},{key:"originalX",get:function(){return this._originalX}},{key:"setOriginalXWithoutUpdatingLayout",value:function(t){this._originalX=t}},{key:"originalY",get:function(){return this._originalY}},{key:"setOriginalYWithoutUpdatingLayout",value:function(t){this._originalY=t}},{key:"originalWidth",get:function(){return this._originalWidth},set:function(t){this._originalWidth!==t&&(this._originalWidth=t,this.changedDimensions(!0,!1))}},{key:"originalHeight",get:function(){return this._originalHeight},set:function(t){this._originalHeight!==t&&(this._originalHeight=t,this.changedDimensions(!1,!0))}},{key:"funcX",get:function(){return this._target.funcX}},{key:"funcY",get:function(){return this._target.funcY}},{key:"funcW",get:function(){return this._target.funcW}},{key:"funcH",get:function(){return this._target.funcH}}]),t}(),Co=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_(this,t),this.id=t.id++,this.manager=e,this.stage=e.stage,this.textures=new Set,this._activeTextureCount=0,this.loader=n,this.lookupId=null,this._cancelCb=null,this.loadingSince=0,this.w=0,this.h=0,this._nativeTexture=null,this.permanent=!1,this.renderInfo=null,this._isResultTexture=!this.loader,this._loadError=null,this._imageRef=null,this._hasAlpha=!1}return v(t,[{key:"hasAlpha",get:function(){return this._hasAlpha}},{key:"loadError",get:function(){return this._loadError}},{key:"addTexture",value:function(t){this.textures.has(t)||this.textures.add(t)}},{key:"removeTexture",value:function(t){this.textures.delete(t)}},{key:"incActiveTextureCount",value:function(){this._activeTextureCount++,1===this._activeTextureCount&&this.becomesUsed()}},{key:"decActiveTextureCount",value:function(){this._activeTextureCount--,0===this._activeTextureCount&&this.becomesUnused()}},{key:"isResultTexture",get:function(){return this._isResultTexture},set:function(t){this._isResultTexture=t}},{key:"forEachEnabledElement",value:function(t){this.textures.forEach((function(e){e.elements.forEach(t)}))}},{key:"hasEnabledElements",value:function(){return this.textures.size>0}},{key:"forEachActiveElement",value:function(t){this.textures.forEach((function(e){e.elements.forEach((function(e){e.active&&t(e)}))}))}},{key:"getRenderWidth",value:function(){return this.w}},{key:"getRenderHeight",value:function(){return this.h}},{key:"allowCleanup",value:function(){return!this.permanent&&!this.isUsed()}},{key:"becomesUsed",value:function(){this.load()}},{key:"becomesUnused",value:function(){this.cancel()}},{key:"cancel",value:function(){this.isLoading()&&(this._cancelCb&&(this._cancelCb(this),this._cancelCb=null),this.loadingSince=0)}},{key:"isLoaded",value:function(){return!!this._nativeTexture}},{key:"isLoading",value:function(){return this.loadingSince>0}},{key:"isError",value:function(){return!!this._loadError}},{key:"reload",value:function(){this.free(),this.isUsed()&&this.load()}},{key:"load",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isResultTexture||this._nativeTexture||this.isLoading()||(this.loadingSince=(new Date).getTime(),this._cancelCb=this.loader((function(n,i){if(t.isLoading()){if(t._cancelCb=null,t.manager.stage.destroyed)return;if(n)t.onError(n);else if(i&&i.source)if(t.stage.isUpdatingFrame()||e||!1===i.throttle)t.processLoadedSource(i);else{var r=t.stage.textureThrottler;t._cancelCb=r.genericCancelCb,r.add(t,i)}}}),this))}},{key:"processLoadedSource",value:function(t){this.loadingSince=0,this.setSource(t)}},{key:"setSource",value:function(t){var e=t.source;this._hasAlpha=t&&t.hasAlpha||!1,this.w=e.width||t&&t.w||0,this.h=e.height||t&&t.h||0,t&&t.renderInfo&&(this.renderInfo=t.renderInfo),this.permanent=!!t.permanent,t&&t.imageRef&&(this._imageRef=t.imageRef),t&&t.flipTextureY?this._flipTextureY=t.flipTextureY:this._flipTextureY=!1,this._isNativeTexture(e)?(this._nativeTexture=e,this.w=this.w||e.w,this.h=this.h||e.h,this.permanent=!t.hasOwnProperty("permanent")||t.permanent):this.manager.uploadTextureSource(this,t),this._loadError=null,this.onLoad()}},{key:"isUsed",value:function(){return this._activeTextureCount>0}},{key:"onLoad",value:function(){this.isUsed()&&this.textures.forEach((function(t){t.onLoad()}))}},{key:"forceRenderUpdate",value:function(){this._nativeTexture&&(this._nativeTexture.update=this.stage.frameCounter),this.forEachActiveElement((function(t){t.forceRenderUpdate()}))}},{key:"forceUpdateRenderCoords",value:function(){this.forEachActiveElement((function(t){t._updateTextureCoords()}))}},{key:"nativeTexture",get:function(){return this._nativeTexture}},{key:"clearNativeTexture",value:function(){this._nativeTexture=null,this._imageRef=null}},{key:"replaceNativeTexture",value:function(t,e,n){var i=this._nativeTexture;this._nativeTexture=t,this.w=e,this.h=n,!i&&this._nativeTexture&&this.forEachActiveElement((function(t){return t.onTextureSourceLoaded()})),this._nativeTexture||this.forEachActiveElement((function(t){return t._setDisplayedTexture(null)})),this.forEachEnabledElement((function(t){return t._updateDimensions()}))}},{key:"onError",value:function(t){this._loadError=t,this.loadingSince=0,console.error("[Lightning] texture load error",t,this.lookupId),this.forEachActiveElement((function(e){return e.onTextureSourceLoadError(t)}))}},{key:"free",value:function(){this.isLoaded()&&this.manager.freeTextureSource(this)}},{key:"_isNativeTexture",value:function(t){return lo.isNode?"WebGLTexture"===t.constructor.name:"WebGLTexture"in window&&t instanceof WebGLTexture}}]),t}();Co.prototype.isTextureSource=!0,Co.id=1;var So=function(){function t(e){_(this,t),this._element=e.element,this._core=e,this.ctx=this._core.ctx,this._enabled=!1,this.lazy=!1,this._colorize=!1,this._renderTexture=null,this._renderTextureReused=!1,this._resultTextureSource=null,this._renderOffscreen=!1,this.empty=!1}return v(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,this._core.updateRenderToTextureEnabled()}},{key:"renderOffscreen",get:function(){return this._renderOffscreen},set:function(t){this._renderOffscreen=t,this._core.setHasRenderUpdates(1),this._core._setRecalc(6)}},{key:"colorize",get:function(){return this._colorize},set:function(t){this._colorize!==t&&(this._colorize=t,this._core.setHasRenderUpdates(1))}},{key:"_getTextureSource",value:function(){return this._resultTextureSource||(this._resultTextureSource=new Co(this._element.stage.textureManager),this.updateResultTexture()),this._resultTextureSource}},{key:"hasResultTexture",value:function(){return!!this._resultTextureSource}},{key:"resultTextureInUse",value:function(){return this._resultTextureSource&&this._resultTextureSource.hasEnabledElements()}},{key:"updateResultTexture",value:function(){var t=this.getResultTexture();if(this._resultTextureSource){if(this._resultTextureSource.nativeTexture!==t){var e=t?t.w:0,n=t?t.h:0;this._resultTextureSource.replaceNativeTexture(t,e,n)}this._resultTextureSource.forEachEnabledElement((function(t){t._updateDimensions(),t.core.setHasRenderUpdates(3)}))}}},{key:"mustRenderToTexture",value:function(){return!(!this._enabled||this.lazy)||!!(this._enabled&&this.lazy&&this._core._hasRenderUpdates<3)}},{key:"deactivate",value:function(){this.release()}},{key:"renderTextureReused",get:function(){return this._renderTextureReused}},{key:"release",value:function(){this.releaseRenderTexture()}},{key:"releaseRenderTexture",value:function(){this._renderTexture&&(this._renderTextureReused||this.ctx.releaseRenderTexture(this._renderTexture),this._renderTexture=null,this._renderTextureReused=!1,this.updateResultTexture())}},{key:"reuseTextureAsRenderTexture",value:function(t){this._renderTexture!==t&&(this.releaseRenderTexture(),this._renderTexture=t,this._renderTextureReused=!0)}},{key:"hasRenderTexture",value:function(){return!!this._renderTexture}},{key:"getRenderTexture",value:function(){return this._renderTexture||(this._renderTexture=this.ctx.allocateRenderTexture(this._core._w,this._core._h),this._renderTextureReused=!1),this._renderTexture}},{key:"getResultTexture",value:function(){return this._renderTexture}}]),t}(),Eo=function(){function t(e){_(this,t),this._element=e,this.ctx=e.stage.ctx,this._recalc=0,this._parent=null,this._onUpdate=null,this._pRecalc=0,this._worldContext=new Io,this._hasUpdates=!1,this._localAlpha=1,this._onAfterCalcs=null,this._onAfterUpdate=null,this._localPx=0,this._localPy=0,this._localTa=1,this._localTb=0,this._localTc=0,this._localTd=1,this._isComplex=!1,this._dimsUnknown=!1,this._clipping=!1,this._zSort=!1,this._outOfBounds=0,this._displayedTextureSource=null,this._zContextUsage=0,this._children=null,this._hasRenderUpdates=0,this._zIndexedChildren=null,this._renderContext=this._worldContext,this.renderState=this.ctx.renderState,this._scissor=null,this._shaderOwner=null,this._updateTreeOrder=0,this._colorUl=this._colorUr=this._colorBl=this._colorBr=4294967295,this._x=0,this._y=0,this._w=0,this._h=0,this._optFlags=0,this._funcX=null,this._funcY=null,this._funcW=null,this._funcH=null,this._scaleX=1,this._scaleY=1,this._pivotX=.5,this._pivotY=.5,this._mountX=0,this._mountY=0,this._rotation=0,this._alpha=1,this._visible=!0,this._ulx=0,this._uly=0,this._brx=1,this._bry=1,this._zIndex=0,this._forceZIndexContext=!1,this._zParent=null,this._isRoot=!1,this._zIndexResort=!1,this._shader=null,this._renderToTextureEnabled=!1,this._texturizer=null,this._useRenderToTexture=!1,this._boundsMargin=null,this._recBoundsMargin=null,this._withinBoundsMargin=!1,this._viewport=null,this._clipbox=!0,this.render=this._renderSimple,this._layout=null}return v(t,[{key:"offsetX",get:function(){return this._funcX?this._funcX:this.hasFlexLayout()?this._layout.originalX:this._x},set:function(t){lo.isFunction(t)?this.funcX=t:(this._disableFuncX(),this.hasFlexLayout()?(this.x+=t-this._layout.originalX,this._layout.setOriginalXWithoutUpdatingLayout(t)):this.x=t)}},{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._updateLocalTranslateDelta(t-this._x,0),this._x=t)}},{key:"funcX",get:function(){return 1&this._optFlags?this._funcX:null},set:function(t){this._funcX!==t&&(this._optFlags|=1,this._funcX=t,this.hasFlexLayout()?(this._layout.setOriginalXWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._x=0,this._triggerRecalcTranslate()))}},{key:"_disableFuncX",value:function(){this._optFlags=65534&this._optFlags,this._funcX=null}},{key:"offsetY",get:function(){return this._funcY?this._funcY:this.hasFlexLayout()?this._layout.originalY:this._y},set:function(t){lo.isFunction(t)?this.funcY=t:(this._disableFuncY(),this.hasFlexLayout()?(this.y+=t-this._layout.originalY,this._layout.setOriginalYWithoutUpdatingLayout(t)):this.y=t)}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._updateLocalTranslateDelta(0,t-this._y),this._y=t)}},{key:"funcY",get:function(){return 2&this._optFlags?this._funcY:null},set:function(t){this._funcY!==t&&(this._optFlags|=2,this._funcY=t,this.hasFlexLayout()?(this._layout.setOriginalYWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._y=0,this._triggerRecalcTranslate()))}},{key:"_disableFuncY",value:function(){this._optFlags=65533&this._optFlags,this._funcY=null}},{key:"funcW",get:function(){return 4&this._optFlags?this._funcW:null},set:function(t){this._funcW!==t&&(this._optFlags|=4,this._funcW=t,this.hasFlexLayout()?(this._layout._originalWidth=0,this.layout.changedDimensions(!0,!1)):(this._w=0,this._triggerRecalcTranslate()))}},{key:"disableFuncW",value:function(){this._optFlags=65531&this._optFlags,this._funcW=null}},{key:"funcH",get:function(){return 8&this._optFlags?this._funcH:null},set:function(t){this._funcH!==t&&(this._optFlags|=8,this._funcH=t,this.hasFlexLayout()?(this._layout._originalHeight=0,this.layout.changedDimensions(!1,!0)):(this._h=0,this._triggerRecalcTranslate()))}},{key:"disableFuncH",value:function(){this._optFlags=65527&this._optFlags,this._funcH=null}},{key:"w",get:function(){return this._w}},{key:"getRenderWidth",value:function(){return this.hasFlexLayout()?this._layout.originalWidth:this._w}},{key:"h",get:function(){return this._h}},{key:"getRenderHeight",value:function(){return this.hasFlexLayout()?this._layout.originalHeight:this._h}},{key:"scaleX",get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._updateLocalTransform())}},{key:"scaleY",get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._updateLocalTransform())}},{key:"scale",get:function(){return this.scaleX},set:function(t){this._scaleX===t&&this._scaleY===t||(this._scaleX=t,this._scaleY=t,this._updateLocalTransform())}},{key:"pivotX",get:function(){return this._pivotX},set:function(t){this._pivotX!==t&&(this._pivotX=t,this._updateLocalTranslate())}},{key:"pivotY",get:function(){return this._pivotY},set:function(t){this._pivotY!==t&&(this._pivotY=t,this._updateLocalTranslate())}},{key:"pivot",get:function(){return this._pivotX},set:function(t){this._pivotX===t&&this._pivotY===t||(this._pivotX=t,this._pivotY=t,this._updateLocalTranslate())}},{key:"mountX",get:function(){return this._mountX},set:function(t){this._mountX!==t&&(this._mountX=t,this._updateLocalTranslate())}},{key:"mountY",get:function(){return this._mountY},set:function(t){this._mountY!==t&&(this._mountY=t,this._updateLocalTranslate())}},{key:"mount",get:function(){return this._mountX},set:function(t){this._mountX===t&&this._mountY===t||(this._mountX=t,this._mountY=t,this._updateLocalTranslate())}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this._updateLocalTransform())}},{key:"alpha",get:function(){return this._alpha},set:function(t){if(t=t>1?1:t<1e-14?0:t,this._alpha!==t){var e=this._alpha;this._alpha=t,this._updateLocalAlpha(),0===e!=(0===t)&&this._element._updateEnabledFlag()}}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateLocalAlpha(),this._element._updateEnabledFlag(),this.hasFlexLayout()&&this.layout.setVisible(t))}},{key:"_updateLocalTransform",value:function(){if(0!==this._rotation&&this._rotation%(2*Math.PI)){var t=Math.sin(this._rotation),e=Math.cos(this._rotation);this._setLocalTransform(e*this._scaleX,-t*this._scaleY,t*this._scaleX,e*this._scaleY)}else this._setLocalTransform(this._scaleX,0,0,this._scaleY);this._updateLocalTranslate()}},{key:"_updateLocalTranslate",value:function(){this._recalcLocalTranslate(),this._triggerRecalcTranslate()}},{key:"_recalcLocalTranslate",value:function(){var t=this._pivotX*this._w,e=this._pivotY*this._h,n=this._x-(t*this._localTa+e*this._localTb)+t,i=this._y-(t*this._localTc+e*this._localTd)+e;n-=this._mountX*this._w,i-=this._mountY*this._h,this._localPx=n,this._localPy=i}},{key:"_updateLocalTranslateDelta",value:function(t,e){this._addLocalTranslate(t,e)}},{key:"_updateLocalAlpha",value:function(){this._setLocalAlpha(this._visible?this._alpha:0)}},{key:"setHasRenderUpdates",value:function(t){if(this._worldContext.alpha){var e=this;for(e._hasRenderUpdates=Math.max(t,e._hasRenderUpdates);(e=e._parent)&&3!==e._hasRenderUpdates;)e._hasRenderUpdates=3}}},{key:"_setRecalc",value:function(t){this._recalc|=t,this._setHasUpdates(),this._parent&&this._parent.setHasRenderUpdates(3)}},{key:"_setHasUpdates",value:function(){for(var t=this;t&&!t._hasUpdates;)t._hasUpdates=!0,t=t._parent}},{key:"getParent",value:function(){return this._parent}},{key:"setParent",value:function(t){if(t!==this._parent){var e=this.isZContext(),n=this._parent;if(this._parent=t,(this._layout||t&&t.isFlexContainer())&&this.layout.setParent(n,t),n&&n.setHasRenderUpdates(3),this._setRecalc(7),this._parent&&this._parent._setHasUpdates(),0===this._zIndex?this.setZParent(t):this.setZParent(t?t.findZContext():null),e!==this.isZContext()&&(this.isZContext()?this.enableZContext(n.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort(),!this._shader){var i=t&&!t._renderToTextureEnabled?t._shaderOwner:null;i!==this._shaderOwner&&(this.setHasRenderUpdates(1),this._setShaderOwnerRecursive(i))}}}},{key:"enableZSort",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!this._zSort&&this._zContextUsage>0&&(this._zSort=!0,t&&this.ctx.forceZSort(this))}},{key:"addChildAt",value:function(t,e){this._children||(this._children=[]),this._children.splice(t,0,e),e.setParent(this)}},{key:"setChildAt",value:function(t,e){this._children||(this._children=[]),this._children[t].setParent(null),this._children[t]=e,e.setParent(this)}},{key:"removeChildAt",value:function(t){var e=this._children[t];this._children.splice(t,1),e.setParent(null)}},{key:"removeChildren",value:function(){if(this._children){for(var t=0,e=this._children.length;t<e;t++)this._children[t].setParent(null);this._children.splice(0),this._zIndexedChildren&&this._zIndexedChildren.splice(0)}}},{key:"syncChildren",value:function(t,e,n){this._children=n;for(var i=0,r=t.length;i<r;i++)t[i].setParent(null);for(var o=0,s=e.length;o<s;o++)e[o].setParent(this)}},{key:"moveChild",value:function(t,e){var n=this._children[t];this._children.splice(t,1),this._children.splice(e,0,n),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}},{key:"_setLocalTransform",value:function(t,e,n,i){this._setRecalc(4),this._localTa=t,this._localTb=e,this._localTc=n,this._localTd=i,this._isComplex=0!==e||0!==n||t<0||i<0}},{key:"_addLocalTranslate",value:function(t,e){this._localPx+=t,this._localPy+=e,this._triggerRecalcTranslate()}},{key:"_setLocalAlpha",value:function(t){!this._worldContext.alpha&&this._parent&&this._parent._worldContext.alpha&&t?this._setRecalc(129):this._setRecalc(1),t<1e-14&&(t=0),this._localAlpha=t}},{key:"setDimensions",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dimsUnknown;if(this._dimsUnknown=n,this.hasFlexLayout())this._layout.originalWidth=t,this._layout.originalHeight=e;else if(this._w!==t||this._h!==e)return this._updateDimensions(t,e),!0;return!1}},{key:"_updateDimensions",value:function(t,e){this._w===t&&this._h===e||(this._w=t,this._h=e,this._triggerRecalcTranslate(),this._texturizer&&(this._texturizer.releaseRenderTexture(),this._texturizer.updateResultTexture()),this._updateLocalTranslate())}},{key:"setTextureCoords",value:function(t,e,n,i){this.setHasRenderUpdates(3),this._ulx=t,this._uly=e,this._brx=n,this._bry=i}},{key:"displayedTextureSource",get:function(){return this._displayedTextureSource}},{key:"setDisplayedTextureSource",value:function(t){this.setHasRenderUpdates(3),this._displayedTextureSource=t}},{key:"isRoot",get:function(){return this._isRoot}},{key:"setAsRoot",value:function(){this._parent=new t(this._element),this._parent._hasRenderUpdates=3,this._parent._hasUpdates=!0,this._isRoot=!0,this.ctx.root=this,this._parent._viewport=[0,0,this.ctx.stage.coordsWidth,this.ctx.stage.coordsHeight],this._parent._scissor=this._parent._viewport,this._parent._recBoundsMargin=null,this._setRecalc(7)}},{key:"isAncestorOf",value:function(t){for(var e=t;e=e._parent;)if(this===e)return!0;return!1}},{key:"isZContext",value:function(){return this._forceZIndexContext||this._renderToTextureEnabled||0!==this._zIndex||this._isRoot||!this._parent}},{key:"findZContext",value:function(){return this.isZContext()?this:this._parent.findZContext()}},{key:"setZParent",value:function(t){if(this._zParent!==t){if(null!==this._zParent&&(0!==this._zIndex&&this._zParent.decZContextUsage(),this._zParent.enableZSort()),null!==t){var e=t._zContextUsage>0;0!==this._zIndex&&t.incZContextUsage(),t._zContextUsage>0&&((e||this._parent!==t)&&t._zIndexedChildren.push(this),t.enableZSort())}this._zParent=t,this._zIndexResort=!0}}},{key:"incZContextUsage",value:function(){if(this._zContextUsage++,1===this._zContextUsage&&(this._zIndexedChildren||(this._zIndexedChildren=[]),this._children)){for(var t=0,e=this._children.length;t<e;t++)this._zIndexedChildren.push(this._children[t]);this._zSort=!1}}},{key:"decZContextUsage",value:function(){this._zContextUsage--,0===this._zContextUsage&&(this._zSort=!1,this._zIndexedChildren.splice(0))}},{key:"zIndex",get:function(){return this._zIndex},set:function(t){if(this._zIndex!==t){this.setHasRenderUpdates(1);var e=this._zParent,n=this.isZContext();0===t&&0!==this._zIndex?this._parent===this._zParent?this._zParent&&this._zParent.decZContextUsage():e=this._parent:0!==t&&0===this._zIndex?(e=this._parent?this._parent.findZContext():null)===this._zParent&&this._zParent&&(this._zParent.incZContextUsage(),this._zParent.enableZSort()):t!==this._zIndex&&this._zParent&&this._zParent._zContextUsage&&this._zParent.enableZSort(),e!==this._zParent&&this.setZParent(null),this._zIndex=t,e!==this._zParent&&this.setZParent(e),n!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}}},{key:"forceZIndexContext",get:function(){return this._forceZIndexContext},set:function(t){this.setHasRenderUpdates(1);var e=this.isZContext();this._forceZIndexContext=t,e!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext())}},{key:"enableZContext",value:function(t){var e=this;t&&t._zContextUsage>0&&this._getZIndexedDescs().forEach((function(t){e.isAncestorOf(t)&&0!==t._zIndex&&t.setZParent(e)}))}},{key:"_getZIndexedDescs",value:function(){var t=[];if(this._children)for(var e=0,n=this._children.length;e<n;e++)this._children[e]._getZIndexedDescsRec(t);return t}},{key:"_getZIndexedDescsRec",value:function(t){if(this._zIndex)t.push(this);else if(this._children&&!this.isZContext())for(var e=0,n=this._children.length;e<n;e++)this._children[e]._getZIndexedDescsRec(t)}},{key:"disableZContext",value:function(){if(this._zContextUsage>0){var t=this._parent.findZContext();this._zSort&&this.sortZIndexedChildren(),this._zIndexedChildren.slice().forEach((function(e){0!==e._zIndex&&e.setZParent(t)}))}}},{key:"colorUl",get:function(){return this._colorUl},set:function(t){this._colorUl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUl=t)}},{key:"colorUr",get:function(){return this._colorUr},set:function(t){this._colorUr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUr=t)}},{key:"colorBl",get:function(){return this._colorBl},set:function(t){this._colorBl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBl=t)}},{key:"colorBr",get:function(){return this._colorBr},set:function(t){this._colorBr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBr=t)}},{key:"onUpdate",set:function(t){this._onUpdate=t,this._setRecalc(7)}},{key:"onAfterUpdate",set:function(t){this._onAfterUpdate=t,this._setRecalc(7)}},{key:"onAfterCalcs",set:function(t){this._onAfterCalcs=t,this._setRecalc(7)}},{key:"shader",get:function(){return this._shader},set:function(t){this.setHasRenderUpdates(1);var e=this._shader;if(this._shader=t,!t&&e){var n=this._parent&&!this._parent._renderToTextureEnabled?this._parent._shaderOwner:null;this._setShaderOwnerRecursive(n)}else t&&this._setShaderOwnerRecursive(this)}},{key:"activeShader",get:function(){return this._shaderOwner?this._shaderOwner.shader:this.renderState.defaultShader}},{key:"activeShaderOwner",get:function(){return this._shaderOwner}},{key:"clipping",get:function(){return this._clipping},set:function(t){this._clipping!==t&&(this._clipping=t,this._setRecalc(3))}},{key:"clipbox",get:function(){return this._clipbox},set:function(t){this._clipbox=t}},{key:"_setShaderOwnerRecursive",value:function(t){if(this._shaderOwner=t,this._children&&!this._renderToTextureEnabled)for(var e=0,n=this._children.length;e<n;e++){var i=this._children[e];i._shader||(i._setShaderOwnerRecursive(t),i._hasRenderUpdates=3)}}},{key:"_setShaderOwnerChildrenRecursive",value:function(t){if(this._children)for(var e=0,n=this._children.length;e<n;e++){var i=this._children[e];i._shader||(i._setShaderOwnerRecursive(t),i._hasRenderUpdates=3)}}},{key:"_hasRenderContext",value:function(){return this._renderContext!==this._worldContext}},{key:"renderContext",get:function(){return this._renderContext}},{key:"updateRenderToTextureEnabled",value:function(){this.texturizer._enabled?this._enableRenderToTexture():(this._disableRenderToTexture(),this._texturizer.releaseRenderTexture())}},{key:"_enableRenderToTexture",value:function(){if(!this._renderToTextureEnabled){var t=this.isZContext();this._renderToTextureEnabled=!0,this._renderContext=new Io,this._setShaderOwnerChildrenRecursive(null),t||this.enableZContext(this._parent?this._parent.findZContext():null),this.setHasRenderUpdates(3),this._setRecalc(7),this.render=this._renderAdvanced}}},{key:"_disableRenderToTexture",value:function(){this._renderToTextureEnabled&&(this._renderToTextureEnabled=!1,this._setShaderOwnerChildrenRecursive(this._shaderOwner),this._renderContext=this._worldContext,this.isZContext()||this.disableZContext(),this._setRecalc(7),this.setHasRenderUpdates(3),this.render=this._renderSimple)}},{key:"isWhite",value:function(){return 4294967295===this._colorUl&&4294967295===this._colorUr&&4294967295===this._colorBl&&4294967295===this._colorBr}},{key:"hasSimpleTexCoords",value:function(){return 0===this._ulx&&0===this._uly&&1===this._brx&&1===this._bry}},{key:"_stashTexCoords",value:function(){this._stashedTexCoords=[this._ulx,this._uly,this._brx,this._bry],this._ulx=0,this._uly=0,this._brx=1,this._bry=1}},{key:"_unstashTexCoords",value:function(){this._ulx=this._stashedTexCoords[0],this._uly=this._stashedTexCoords[1],this._brx=this._stashedTexCoords[2],this._bry=this._stashedTexCoords[3],this._stashedTexCoords=null}},{key:"_stashColors",value:function(){this._stashedColors=[this._colorUl,this._colorUr,this._colorBr,this._colorBl],this._colorUl=4294967295,this._colorUr=4294967295,this._colorBr=4294967295,this._colorBl=4294967295}},{key:"_unstashColors",value:function(){this._colorUl=this._stashedColors[0],this._colorUr=this._stashedColors[1],this._colorBr=this._stashedColors[2],this._colorBl=this._stashedColors[3],this._stashedColors=null}},{key:"isVisible",value:function(){return this._localAlpha>1e-14}},{key:"outOfBounds",get:function(){return this._outOfBounds}},{key:"boundsMargin",get:function(){return this._boundsMargin},set:function(t){this._boundsMargin=t?t.slice():null,this._triggerRecalcTranslate()}},{key:"update",value:function(){this._recalc|=this._parent._pRecalc,this._layout&&this._layout.isEnabled()?256&this._recalc&&this._layout.layoutFlexTree():2&this._recalc&&this._optFlags&&this._applyRelativeDimFuncs(),this._onUpdate&&(this._hasUpdates=!0,this._onUpdate(this.element,this));var t=this._parent._worldContext,e=this._worldContext,n=t.alpha&&this._localAlpha;if(this._hasUpdates||this._recalc&&n||e.alpha&&!n){var i=this._recalc;1&i&&(!e.alpha&&n&&(this._hasRenderUpdates=3),e.alpha=t.alpha*this._localAlpha,e.alpha<1e-14&&(e.alpha=0)),6&i&&(e.px=t.px+this._localPx*t.ta,e.py=t.py+this._localPy*t.td,0!==t.tb&&(e.px+=this._localPy*t.tb),0!==t.tc&&(e.py+=this._localPx*t.tc)),4&i&&(e.ta=this._localTa*t.ta,e.tb=this._localTd*t.tb,e.tc=this._localTa*t.tc,e.td=this._localTd*t.td,this._isComplex&&(e.ta+=this._localTc*t.tb,e.tb+=this._localTb*t.ta,e.tc+=this._localTc*t.td,e.td+=this._localTb*t.tc));var r=this._parent._renderContext;if(this._parent._hasRenderContext()){var o=this._renderContext===this._worldContext;o&&(this._renderContext=new Io);var s=this._renderContext;(o||1&i)&&(s.alpha=r.alpha*this._localAlpha,s.alpha<1e-14&&(s.alpha=0)),(o||6&i)&&(s.px=r.px+this._localPx*r.ta,s.py=r.py+this._localPy*r.td,0!==r.tb&&(s.px+=this._localPy*r.tb),0!==r.tc&&(s.py+=this._localPx*r.tc)),o&&(i|=2),(o||4&i)&&(s.ta=this._localTa*r.ta,s.tb=this._localTd*r.tb,s.tc=this._localTa*r.tc,s.td=this._localTd*r.td,this._isComplex&&(s.ta+=this._localTc*r.tb,s.tb+=this._localTb*r.ta,s.tc+=this._localTc*r.td,s.td+=this._localTb*r.tc))}else this._renderContext=this._worldContext;-1===this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=this._updateTreeOrder+1:this._updateTreeOrder=this.ctx.updateTreeOrder++;var a=this._renderToTextureEnabled&&this._texturizer.mustRenderToTexture();this._useRenderToTexture!==a&&(this._recalc|=6,i|=2,this._useRenderToTexture||this._texturizer.release()),this._useRenderToTexture=a;var u,l,h,c,f=this._renderContext,d=this._dimsUnknown?2048:this._w,A=this._dimsUnknown?2048:this._h,g=0!==f.tb||0!==f.tc||f.ta<0||f.td<0;if(g?(u=Math.min(0,d*f.ta,d*f.ta+A*f.tb,A*f.tb)+f.px,h=Math.max(0,d*f.ta,d*f.ta+A*f.tb,A*f.tb)+f.px,l=Math.min(0,d*f.tc,d*f.tc+A*f.td,A*f.td)+f.py,c=Math.max(0,d*f.tc,d*f.tc+A*f.td,A*f.td)+f.py):(u=f.px,h=f.px+f.ta*d,l=f.py,c=f.py+f.td*A),this._dimsUnknown&&(g||this._localTa<1||this._localTb<1)){var p=this._x*r.ta+this._y*r.tb+r.px,v=this._x*r.tc+this._y*r.td+r.py;p<u&&(u=p),v<l&&(l=v),p>h&&(h=p),v>c&&(c=v)}if(6&i||!this._scissor)if(this._clipping&&f.isSquare()){var _=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(_){var y=Math.max(_[0],u),x=Math.max(_[1],l);this._scissor=[y,x,Math.min(_[2]+_[0],h)-y,Math.min(_[3]+_[1],c)-x]}else this._scissor=[u,l,h-u,c-l]}else this._scissor=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(this._boundsMargin?this._recBoundsMargin=this._boundsMargin:this._recBoundsMargin=this._parent._recBoundsMargin,this._onAfterCalcs&&this._onAfterCalcs(this.element)&&(g?(u=Math.min(0,d*f.ta,d*f.ta+A*f.tb,A*f.tb)+f.px,h=Math.max(0,d*f.ta,d*f.ta+A*f.tb,A*f.tb)+f.px,l=Math.min(0,d*f.tc,d*f.tc+A*f.td,A*f.td)+f.py,c=Math.max(0,d*f.tc,d*f.tc+A*f.td,A*f.td)+f.py):(u=f.px,h=f.px+f.ta*d,l=f.py,c=f.py+f.td*A),this._dimsUnknown&&(g||this._localTa<1||this._localTb<1))){var m=this._x*r.ta+this._y*r.tb+r.px,k=this._x*r.tc+this._y*r.td+r.py;m<u&&(u=m),k<l&&(l=k),m>h&&(h=m),k>c&&(c=k)}if(2===this._parent._outOfBounds)this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin());else if(6&i){this._outOfBounds=0;var T=!0;if(this._renderToTextureEnabled&&this._texturizer&&this._texturizer.renderOffscreen||(this._scissor&&(this._scissor[2]<=0||this._scissor[3]<=0)?this._outOfBounds=2:((this._scissor[0]>h||this._scissor[1]>c||u>this._scissor[0]+this._scissor[2]||l>this._scissor[1]+this._scissor[3])&&(this._outOfBounds=1),this._outOfBounds&&(this._clipping||this._useRenderToTexture||this._clipbox&&d&&A)&&(this._outOfBounds=2)),(T=0===this._outOfBounds)||(T=this._recBoundsMargin?!(h<this._scissor[0]-this._recBoundsMargin[2]||c<this._scissor[1]-this._recBoundsMargin[3]||u>this._scissor[0]+this._scissor[2]+this._recBoundsMargin[0]||l>this._scissor[1]+this._scissor[3]+this._recBoundsMargin[1]):!(h<this._scissor[0]-100||c<this._scissor[1]-100||u>this._scissor[0]+this._scissor[2]+100||l>this._scissor[1]+this._scissor[3]+100))&&2===this._outOfBounds&&(this._outOfBounds=1)),this._withinBoundsMargin!==T)if(this._withinBoundsMargin=T,this._withinBoundsMargin){this._hasUpdates=!0;var b=this._recalc;if(this._recalc=0,this.element._enableWithinBoundsMargin(),this._recalc)return this.update();this._recalc=b}else this.element._disableWithinBoundsMargin()}if(this._useRenderToTexture&&(this._viewport?(this._viewport[2]=d,this._viewport[3]=A):this._viewport=[0,0,d,A]),this._pRecalc=135&this._recalc,this._recalc=0,this._hasUpdates=!1,this._outOfBounds<2){if(this._useRenderToTexture&&(this._worldContext.isIdentity()?this._renderContext=this._worldContext:this._renderContext=Io.IDENTITY),this._children)for(var w=0,C=this._children.length;w<C;w++)this._children[w].update();this._useRenderToTexture&&(this._renderContext=f)}else if(this._children)for(var S=0,E=this._children.length;S<E;S++)this._children[S]._hasUpdates?this._children[S].update():(this._children[S]._recalc|=this._pRecalc,this._children[S].updateOutOfBounds());this._onAfterUpdate&&this._onAfterUpdate(this.element)}else-1===this.ctx.updateTreeOrder||this._updateTreeOrder>=this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=-1:this.updateTreeOrder()}},{key:"_applyRelativeDimFuncs",value:function(){if(1&this._optFlags){var t=this._funcX(this._parent.w);t!==this._x&&(this._localPx+=t-this._x,this._x=t)}if(2&this._optFlags){var e=this._funcY(this._parent.h);e!==this._y&&(this._localPy+=e-this._y,this._y=e)}var n=!1;if(4&this._optFlags){var i=this._funcW(this._parent.w);i!==this._w&&(this._w=i,n=!0)}if(8&this._optFlags){var r=this._funcH(this._parent.h);r!==this._h&&(this._h=r,n=!0)}n&&(this._recalcLocalTranslate(),this.element.onDimensionsChanged(this._w,this._h))}},{key:"updateOutOfBounds",value:function(){if(2!==this._outOfBounds&&this._renderContext.alpha>0&&(this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin()),this._children))for(var t=0,e=this._children.length;t<e;t++)this._children[t].updateOutOfBounds()}},{key:"updateTreeOrder",value:function(){if(this._localAlpha&&2!==this._outOfBounds&&(this._updateTreeOrder=this.ctx.updateTreeOrder++,this._children))for(var t=0,e=this._children.length;t<e;t++)this._children[t].updateTreeOrder()}},{key:"_renderSimple",value:function(){if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){var t=this.renderState;if(0===this._outOfBounds&&this._displayedTextureSource&&(t.setShader(this.activeShader,this._shaderOwner),t.setScissor(this._scissor),this.renderState.addQuad(this)),this._children)if(this._zContextUsage)for(var e=0,n=this._zIndexedChildren.length;e<n;e++)this._zIndexedChildren[e].render();else for(var i=0,r=this._children.length;i<r;i++)0===this._children[i]._zIndex&&this._children[i].render()}}},{key:"_renderAdvanced",value:function(){var t=this._hasRenderUpdates;if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){var e,n,i=this.renderState,r=!0;if(this._useRenderToTexture){if(0===this._w||0===this._h)return;if(!this._texturizer.hasRenderTexture()||t>=3){if(this.ctx.renderToTextureCount++,i.setShader(i.defaultShader,this),n=i.renderTextureInfo,e={nativeTexture:null,offset:0,w:this._w,h:this._h,empty:!0,cleared:!1,ignore:!1,cache:!1},(this._texturizer.hasResultTexture()||!i.isCachingTexturizer&&t<3)&&(e.cache=!0,i.isCachingTexturizer=!0),this._texturizer.hasResultTexture()||this._texturizer.releaseRenderTexture(),i.setRenderTextureInfo(e),i.setScissor(null),this._displayedTextureSource){var o=this._renderContext;this._renderContext=Io.IDENTITY,this.renderState.addQuad(this),this._renderContext=o}}else r=!1}else 0===this._outOfBounds&&this._displayedTextureSource&&(i.setShader(this.activeShader,this._shaderOwner),i.setScissor(this._scissor),this.renderState.addQuad(this));if(r&&this._children)if(this._zContextUsage)for(var s=0,a=this._zIndexedChildren.length;s<a;s++)this._zIndexedChildren[s].render();else for(var u=0,l=this._children.length;u<l;u++)0===this._children[u]._zIndex&&this._children[u].render();if(this._useRenderToTexture){var h=!1;if(r&&(i.finishedRenderTexture(),this._texturizer.empty=e.empty,e.empty?this._texturizer.releaseRenderTexture():e.nativeTexture?(this._texturizer.reuseTextureAsRenderTexture(e.nativeTexture),e.ignore=!0):(this._texturizer.renderTextureReused&&this._texturizer.releaseRenderTexture(),e.nativeTexture=this._texturizer.getRenderTexture()),i.setRenderTextureInfo(n),h=!0),!this._texturizer.empty){var c=this._texturizer.getResultTexture();if(h&&(c&&(c.update=i.stage.frameCounter),this._texturizer.updateResultTexture()),!this._texturizer.renderOffscreen){i.setShader(this.activeShader,this._shaderOwner),i.setScissor(this._scissor);var f=!e||e.cache;i.setTexturizer(this._texturizer,f),this._stashTexCoords(),this._texturizer.colorize||this._stashColors(),this.renderState.addQuad(this,!0),this._texturizer.colorize||this._unstashColors(),this._unstashTexCoords(),i.setTexturizer(null)}}}e&&e.cache&&(i.isCachingTexturizer=!1)}}},{key:"zSort",get:function(){return this._zSort}},{key:"sortZIndexedChildren",value:function(){for(var e=this._zIndexedChildren.length,n=0,i=this._zIndexedChildren,r=[],o=0;o<e;o++)i[o]._zParent===this&&(i[o]._zIndexResort?r.push(i[o]):(n!==o&&(i[n]=i[o]),n++));var s=r.length;if(s){for(var a=0;a<s;a++)r[a]._zIndexResort=!1;r.sort(t.sortZIndexedChildren);var u=n;if(u){i.splice(u),i.sort(t.sortZIndexedChildren),n=0;for(var l=0,h=0,c=[];;){var f=(i[l]._zIndex===r[h]._zIndex?i[l]._updateTreeOrder-r[h]._updateTreeOrder:i[l]._zIndex-r[h]._zIndex)>0?r[h++]:i[l++];if(0!==n&&c[n-1]===f||(c[n++]=f),l>=u){do{var d=r[h++];0!==n&&c[n-1]===d||(c[n++]=d)}while(h<s);break}if(h>=s){do{var A=i[l++];0!==n&&c[n-1]===A||(c[n++]=A)}while(l<u);break}}this._zIndexedChildren=c}else{n=0;var g=0;do{i[n++]=r[g++]}while(g<s);i.length>n&&i.splice(n)}}else i.length>n&&i.splice(n);this._zSort=!1}},{key:"localTa",get:function(){return this._localTa}},{key:"localTb",get:function(){return this._localTb}},{key:"localTc",get:function(){return this._localTc}},{key:"localTd",get:function(){return this._localTd}},{key:"element",get:function(){return this._element}},{key:"renderUpdates",get:function(){return this._hasRenderUpdates}},{key:"texturizer",get:function(){return this._texturizer||(this._texturizer=new So(this)),this._texturizer}},{key:"getCornerPoints",value:function(){var t=this._worldContext;return[t.px,t.py,t.px+this._w*t.ta,t.py+this._w*t.tc,t.px+this._w*t.ta+this._h*t.tb,t.py+this._w*t.tc+this._h*t.td,t.px+this._h*t.tb,t.py+this._h*t.td]}},{key:"getRenderTextureCoords",value:function(t,e){var n=this._renderContext;return[n.px+n.ta*t+n.tb*e,n.py+n.tc*t+n.td*e]}},{key:"getAbsoluteCoords",value:function(t,e){var n=this._renderContext;return[n.px+n.ta*t+n.tb*e,n.py+n.tc*t+n.td*e]}},{key:"collectAtCoord",value:function(e,n,i){if(0!==this._renderContext.alpha){if(this.inBound(e,n)&&(this._scissor?this.inScissor()&&i.push(this):i.push(this)),this._children)for(var r=this._children.length,o=0;o<r;o++)this._children[o].collectAtCoord(e,n,i);return i.sort(t.sortZIndexedChildren)}}},{key:"inBound",value:function(t,e){var n=this.getCornerPoints();return t>n[0]&&t<n[2]&&e>n[1]&&e<n[7]}},{key:"inScissor",value:function(){var t=this._scissor,e=this.getCornerPoints();return e[2]>=t[0]&&e[0]<=t[0]+t[2]&&e[7]>=t[1]&&e[1]<=t[1]+t[3]}},{key:"layout",get:function(){return this._ensureLayout(),this._layout}},{key:"flex",get:function(){return this._layout?this._layout.flex:null},set:function(t){this.layout.flex=t}},{key:"flexItem",get:function(){return this._layout?this._layout.flexItem:null},set:function(t){this.layout.flexItem=t}},{key:"isFlexItem",value:function(){return!!this._layout&&this._layout.isFlexItemEnabled()}},{key:"isFlexContainer",value:function(){return!!this._layout&&this._layout.isFlexEnabled()}},{key:"enableFlexLayout",value:function(){this._ensureLayout()}},{key:"_ensureLayout",value:function(){this._layout||(this._layout=new wo(this))}},{key:"disableFlexLayout",value:function(){this._triggerRecalcTranslate()}},{key:"hasFlexLayout",value:function(){return this._layout&&this._layout.isEnabled()}},{key:"setLayout",value:function(t,e,n,i){this.x=t,this.y=e,this._updateDimensions(n,i)}},{key:"triggerLayout",value:function(){this._setRecalc(256)}},{key:"_triggerRecalcTranslate",value:function(){this._setRecalc(2)}}]),t}(),Io=function(){function t(){_(this,t),this.alpha=1,this.px=0,this.py=0,this.ta=1,this.tb=0,this.tc=0,this.td=1}return v(t,[{key:"isIdentity",value:function(){return 1===this.alpha&&0===this.px&&0===this.py&&1===this.ta&&0===this.tb&&0===this.tc&&1===this.td}},{key:"isSquare",value:function(){return 0===this.tb&&0===this.tc}}]),t}();Io.IDENTITY=new Io,Eo.sortZIndexedChildren=function(t,e){return t._zIndex===e._zIndex?t._updateTreeOrder-e._updateTreeOrder:t._zIndex-e._zIndex};var Lo=function(){function t(){_(this,t),this._hasEventListeners=!1}return v(t,[{key:"on",value:function(e,n){this._hasEventListeners||(this._eventFunction={},this._eventListeners={},this._hasEventListeners=!0),this._eventFunction[e]?this._eventFunction[e]!==t.combiner?(this._eventListeners[e]=[this._eventFunction[e],n],this._eventFunction[e]=t.combiner):this._eventListeners[e].push(n):this._eventFunction[e]=n}},{key:"once",value:function(t,e){var n=this,i=function i(r,o,s){e(r,o,s),n.off(t,i)};i.__originalFunc=e,this.on(t,i)}},{key:"has",value:function(e,n){if(this._hasEventListeners){var i=this._eventFunction[e];if(i)if(i===t.combiner){var r,o=w(this._eventListeners[e]);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(s===n||s.__originalFunc==n)return!0}}catch(a){o.e(a)}finally{o.f()}}else if(this._eventFunction[e]===n||this._eventFunction[e].__originalFunc===n)return!0}return!1}},{key:"off",value:function(e,n){if(this._hasEventListeners){var i=this._eventFunction[e];if(i)if(i===t.combiner){var r=this._eventListeners[e],o=r.indexOf(n);o>=0&&r.splice(o,1),(o=r.map((function(t){return t.__originalFunc})).indexOf(n))>=0&&r.splice(o,1),1===r.length&&(this._eventFunction[e]=r[0],this._eventListeners[e]=void 0)}else this._eventFunction[e]!==n&&this._eventFunction[e].__originalFunc!==n||(this._eventFunction[e]=void 0)}}},{key:"removeListener",value:function(t,e){this.off(t,e)}},{key:"emit",value:function(e,n,i,r){if(this._hasEventListeners){var o=this._eventFunction[e];o&&(o===t.combiner?o(this,e,n,i,r):o(n,i,r))}}},{key:"listenerCount",value:function(e){if(this._hasEventListeners){var n=this._eventFunction[e];if(n)return n===t.combiner?this._eventListeners[e].length:1}return 0}},{key:"removeAllListeners",value:function(t){this._hasEventListeners&&(delete this._eventFunction[t],delete this._eventListeners[t])}}]),t}();Lo.combiner=function(t,e,n,i,r){var o=t._eventListeners[e];if(o)for(var s=0,a=y(o);s<a.length;s++){(0,a[s])(n,i,r)}},Lo.addAsMixin=function(t){t.prototype.on=Lo.prototype.on,t.prototype.once=Lo.prototype.once,t.prototype.has=Lo.prototype.has,t.prototype.off=Lo.prototype.off,t.prototype.removeListener=Lo.prototype.removeListener,t.prototype.emit=Lo.prototype.emit,t.prototype.listenerCount=Lo.prototype.listenerCount,t.prototype.removeAllListeners=Lo.prototype.removeAllListeners};var Ro=function(){function t(e){_(this,t),this._initialized=!1,this.ctx=e,this._elements=new Set}return v(t,[{key:"addElement",value:function(t){this._elements.add(t)}},{key:"removeElement",value:function(t){this._elements.delete(t),this._elements||this.cleanup()}},{key:"redraw",value:function(){this._elements.forEach((function(t){t.setHasRenderUpdates(2)}))}},{key:"patch",value:function(t){ho.patchObject(this,t)}},{key:"useDefault",value:function(){return!1}},{key:"addEmpty",value:function(){return!1}},{key:"cleanup",value:function(){}},{key:"isShader",get:function(){return!0}}],[{key:"create",value:function(t,e){var n;if(lo.isObjectLiteral(e))(n=e.type?t.renderer.createShader(t.ctx,e):this.shader)&&ho.patchObject(n,e);else if(null===e)n=t.ctx.renderState.defaultShader;else if(void 0===e)n=null;else{if(!e.isShader)return void console.error("[Lightning] Please specify a shader type.");t.renderer.isValidShaderType(e.constructor)||(console.error("[Lightning] Invalid shader type"),e=null),n=e}return n}},{key:"getWebGL",value:function(){}},{key:"getC2d",value:function(){}}]),t}(),Mo=function(){function t(e){_(this,t),this.stage=e,this.manager=this.stage.textureManager,this.id=t.id++,this.elements=new Set,this._activeCount=0,this._source=null,this._resizeMode=null,this._x=0,this._y=0,this._w=0,this._h=0,this._precision=1,this.mw=0,this.mh=0,this.clipping=!1,this._mustUpdate=!0}return v(t,[{key:"source",get:function(){return(this._mustUpdate||this.stage.hasUpdateSourceTexture(this))&&(this._performUpdateSource(!0),this.stage.removeUpdateSourceTexture(this)),this._source}},{key:"addElement",value:function(t){this.elements.has(t)||(this.elements.add(t),1===this.elements.size&&this._source&&this._source.addTexture(this),t.active&&this.incActiveCount())}},{key:"removeElement",value:function(t){this.elements.delete(t)&&(0===this.elements.size&&this._source&&this._source.removeTexture(this),t.active&&this.decActiveCount())}},{key:"incActiveCount",value:function(){this.source&&this._checkForNewerReusableTextureSource(),this._activeCount++,1===this._activeCount&&this.becomesUsed()}},{key:"decActiveCount",value:function(){this.source,this._activeCount--,this._activeCount||this.becomesUnused()}},{key:"becomesUsed",value:function(){this.source&&this.source.incActiveTextureCount()}},{key:"onLoad",value:function(){this._resizeMode&&this._applyResizeMode(),this.elements.forEach((function(t){t.active&&t.onTextureSourceLoaded()}))}},{key:"_checkForNewerReusableTextureSource",value:function(){var t=this.source;if(t.isLoaded())this._resizeMode&&this._applyResizeMode();else{var e=this._getReusableTextureSource();e&&e.isLoaded()&&e!==t&&this._replaceTextureSource(e)}}},{key:"becomesUnused",value:function(){this.source&&this.source.decActiveTextureCount()}},{key:"isUsed",value:function(){return this._activeCount>0}},{key:"_getLookupId",value:function(){return null}},{key:"_getSourceLoader",value:function(){throw new Error("Texture.generate must be implemented.")}},{key:"isValid",get:function(){return this._getIsValid()}},{key:"_getIsValid",value:function(){return!0}},{key:"_changed",value:function(){this.isUsed()?this._updateSource():this._mustUpdate=!0}},{key:"_updateSource",value:function(){this.stage.addUpdateSourceTexture(this)}},{key:"_performUpdateSource",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.isUsed()){this._mustUpdate=!1;var t=this._getTextureSource();this._replaceTextureSource(t)}}},{key:"_getTextureSource",value:function(){var t=null;if(this._getIsValid()){var e=this._getLookupId();(t=this._getReusableTextureSource(e))||(t=this.manager.getTextureSource(this._getSourceLoader(),e))}return t}},{key:"_getReusableTextureSource",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getLookupId();return this._getIsValid()&&t?this.manager.getReusableTextureSource(t):null}},{key:"_replaceTextureSource",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this._source;if(this._source=e,this.elements.size&&(n&&(this._activeCount&&n.decActiveTextureCount(),n.removeTexture(this),this.text&&!n.isUsed()&&this.manager.freeTextureSource(n)),e&&(e.addTexture(this),this._activeCount&&e.incActiveTextureCount())),this.isUsed())if(e)if(e.isLoaded())this._resizeMode&&this._applyResizeMode(),this.elements.forEach((function(e){e.active&&e._setDisplayedTexture(t)}));else{var i=e.loadError;i&&this.elements.forEach((function(t){t.active&&t.onTextureSourceLoadError(i)}))}else this.elements.forEach((function(t){t.active&&t._setDisplayedTexture(null)}))}},{key:"load",value:function(){this.source&&(this.isLoaded()||this.source.load(!0))}},{key:"isLoaded",value:function(){return this._source&&this._source.isLoaded()}},{key:"loadError",get:function(){return this._source&&this._source.loadError}},{key:"free",value:function(){this._source&&this._source.free()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){var e=t.type,n=void 0===e?"cover":e,i=t.w,r=void 0===i?0:i,o=t.h,s=void 0===o?0:o,a=t.clipX,u=void 0===a?.5:a,l=t.clipY,h=void 0===l?.5:l;this._resizeMode={type:n,w:r,h:s,clipX:u,clipY:h},this.isLoaded()&&this._applyResizeMode()}},{key:"_clearResizeMode",value:function(){this._resizeMode=null}},{key:"_applyResizeMode",value:function(){"cover"===this._resizeMode.type?this._applyResizeCover():"contain"===this._resizeMode.type&&this._applyResizeContain(),this._updatePrecision(),this._updateClipping()}},{key:"_applyResizeCover",value:function(){var t=this._resizeMode.w/this._source.w,e=this._resizeMode.h/this._source.h,n=Math.max(t,e);if(n){if(this._precision=1/n,t&&t<n){var i=this._precision*this._resizeMode.w,r=this._source.w-i;this._x=r*this._resizeMode.clipX,this._w=this._source.w-r}if(e&&e<n){var o=this._precision*this._resizeMode.h,s=this._source.h-o;this._y=s*this._resizeMode.clipY,this._h=this._source.h-s}}}},{key:"_applyResizeContain",value:function(){var t=this._resizeMode.w/this._source.w,e=this._resizeMode.h/this._source.h,n=t;(!n||e<n)&&(n=e),n&&(this._precision=1/n)}},{key:"enableClipping",value:function(t,e,n,i){this._clearResizeMode(),t*=this._precision,e*=this._precision,n*=this._precision,i*=this._precision,this._x===t&&this._y===e&&this._w===n&&this._h===i||(this._x=t,this._y=e,this._w=n,this._h=i,this._updateClipping(!0))}},{key:"disableClipping",value:function(){this._clearResizeMode(),(this._x||this._y||this._w||this._h)&&(this._x=0,this._y=0,this._w=0,this._h=0,this._updateClipping())}},{key:"_updateClipping",value:function(){this.clipping=!!(this._x||this._y||this._w||this._h);var t=this;this.elements.forEach((function(e){e.displayedTexture===t&&e.onDisplayedTextureClippingChanged()}))}},{key:"_updatePrecision",value:function(){var t=this;this.elements.forEach((function(e){e.displayedTexture===t&&e.onPrecisionChanged()}))}},{key:"getNonDefaults",value:function(){var t={};return t.type=this.constructor.name,0!==this.x&&(t.x=this.x),0!==this.y&&(t.y=this.y),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),1!==this.precision&&(t.precision=this.precision),t}},{key:"px",get:function(){return this._x}},{key:"py",get:function(){return this._y}},{key:"pw",get:function(){return this._w}},{key:"ph",get:function(){return this._h}},{key:"x",get:function(){return this._x/this._precision},set:function(t){this._clearResizeMode(),t*=this._precision,this._x!==t&&(this._x=t,this._updateClipping())}},{key:"y",get:function(){return this._y/this._precision},set:function(t){this._clearResizeMode(),t*=this._precision,this._y!==t&&(this._y=t,this._updateClipping())}},{key:"w",get:function(){return this._w/this._precision},set:function(t){this._clearResizeMode(),t*=this._precision,this._w!==t&&(this._w=t,this._updateClipping())}},{key:"h",get:function(){return this._h/this._precision},set:function(t){this._clearResizeMode(),t*=this._precision,this._h!==t&&(this._h=t,this._updateClipping())}},{key:"precision",get:function(){return this._precision},set:function(t){this._clearResizeMode(),this._precision!==t&&(this._precision=t,this._updatePrecision())}},{key:"isAutosizeTexture",value:function(){return!0}},{key:"getRenderWidth",value:function(){return this.isAutosizeTexture()?(this._w||(this._source?this._source.getRenderWidth()-this._x:0))/this._precision:0}},{key:"getRenderHeight",value:function(){return this.isAutosizeTexture()?(this._h||(this._source?this._source.getRenderHeight()-this._y:0))/this._precision:0}},{key:"patch",value:function(t){ho.patchObject(this,t)}}]),t}();Mo.prototype.isTexture=!0,Mo.id=0;var Po=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._src=void 0,i._hasAlpha=!1,i}return v(n,[{key:"src",get:function(){return this._src},set:function(t){this._src!==t&&(this._src=t,this._changed())}},{key:"hasAlpha",get:function(){return this._hasAlpha},set:function(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._changed())}},{key:"_getIsValid",value:function(){return!!this._src}},{key:"_getLookupId",value:function(){return this._src}},{key:"_getSourceLoader",value:function(){var t=this,e=this._src,n=this._hasAlpha;if(this.stage.getOption("srcBasePath")){var i=e.charCodeAt(0);-1===e.indexOf("//")&&(i>=65&&i<=90||i>=97&&i<=122||46==i)&&(e=this.stage.getOption("srcBasePath")+e)}return function(i){return t.stage.platform.loadSrcTexture({src:e,hasAlpha:n},i)}}},{key:"getNonDefaults",value:function(){var t=r(g(n.prototype),"getNonDefaults",this).call(this);return this._src&&(t.src=this._src),t}}]),n}(Mo);function zo(t,e,n,i,r){var o=t;Array.isArray(o)||(o=[o]);for(var s=[],a=0,u=o.length;a<u;a++){var l=o[a];null===l&&(l=r),"serif"===l||"sans-serif"===l?s.push(l):s.push('"'.concat(l,'"'))}return"".concat(e," ").concat(n*i,"px ").concat(s.join(","))}function Bo(t){return""===t||"​"===t}function Oo(t){return Bo(t)||" "===t}function Do(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n?e.split("").reduce((function(e,i){return Bo(i)?e:e+t.measureText(i).width+n}),0):t.measureText(e).width}var Fo=function(){function t(e,n,i){_(this,t),this._stage=e,this._canvas=n,this._context=this._canvas.getContext("2d"),this._settings=i}return v(t,[{key:"getPrecision",value:function(){return this._settings.precision}},{key:"setFontProperties",value:function(){this._context.font=zo(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace")),this._context.textBaseline=this._settings.textBaseline}},{key:"_load",value:function(){var t=this;if(lo.isWeb&&document.fonts){var e=zo(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch((function(t){console.warn("[Lightning] Font load error",t,e)})).then((function(){document.fonts.check(e,t._settings.text)||console.warn("[Lightning] Font not found",e)}))}catch(n){console.warn("[Lightning] Can't check font loading for "+e)}}}},{key:"draw",value:function(){var t=this,e=this._load();return e?e.then((function(){return lo.isSpark?t._stage.platform.drawText(t):t._draw()})):lo.isSpark?this._stage.platform.drawText(this):this._draw()}},{key:"_calculateRenderInfo",value:function(){var t={},e=this.getPrecision(),n=this._settings.paddingLeft*e,i=this._settings.paddingRight*e,r=this._settings.fontSize*e,o=null===this._settings.offsetY?null:this._settings.offsetY*e,s=this._settings.lineHeight*e,a=this._settings.w*e,u=this._settings.h*e,l=this._settings.wordWrapWidth*e,h=this._settings.cutSx*e,c=this._settings.cutEx*e,f=this._settings.cutSy*e,d=this._settings.cutEy*e,A=(this._settings.letterSpacing||0)*e,g=this._settings.textIndent*e;this.setFontProperties();var p,v=a||this._stage.getOption("w"),_=v-n;if(_<10&&(v+=10-_,_=10),l||(l=_),this._settings.textOverflow&&!this._settings.wordWrap){var y;switch(this._settings.textOverflow){case"clip":y="";break;case"ellipsis":y=this._settings.maxLinesSuffix;break;default:y=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,l-g,y)}if(this._settings.wordWrap)p=this.wrapText(this._settings.text,l,A,g);else for(var x=(p={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]}).l.length,m=0;m<x-1;m++)p.n.push(m);var k=p.l;if(this._settings.maxLines&&k.length>this._settings.maxLines){var T=k.slice(0,this._settings.maxLines),b=null;if(this._settings.maxLinesSuffix){var w=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,C=this.wrapText(T[T.length-1],l-w,A,g);T[T.length-1]=C.l[0]+this._settings.maxLinesSuffix,b=[C.l.length>1?C.l[1]:""]}else b=[""];var S,E=k.length,I=0,L=p.n.length;for(S=this._settings.maxLines;S<E;S++)b[I]+=(b[I]?" ":"")+k[S],S+1<L&&p.n[S+1]&&I++;t.remainingText=b.join("\n"),t.moreTextLines=!0,k=T}else t.moreTextLines=!1,t.remainingText="";for(var R,M=0,P=[],z=0;z<k.length;z++){var B=this.measureText(k[z],A)+(0===z?g:0);P.push(B),M=Math.max(M,B)}if(t.lineWidths=P,a||(v=M+n+i,_=M),s=s||r,u)R=u;else{var O="bottom"!=this._settings.textBaseline?.5*r:0;R=s*(k.length-1)+O+Math.max(s,r)+o}return null===o&&(o=r),t.w=v,t.h=R,t.lines=k,t.precision=e,v||(v=1),R||(R=1),(h||c)&&(v=Math.min(v,c-h)),(f||d)&&(R=Math.min(R,d-f)),t.width=v,t.innerWidth=_,t.height=R,t.fontSize=r,t.cutSx=h,t.cutSy=f,t.cutEx=c,t.cutEy=d,t.lineHeight=s,t.lineWidths=P,t.offsetY=o,t.paddingLeft=n,t.paddingRight=i,t.letterSpacing=A,t.textIndent=g,t}},{key:"_draw",value:function(){var t,e,n=this._calculateRenderInfo(),i=this.getPrecision();this._canvas.width=Math.ceil(n.width+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(n.height),this.setFontProperties(),n.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(n.cutSx||n.cutSy)&&this._context.translate(-n.cutSx,-n.cutSy);for(var r=[],o=0,s=n.lines.length;o<s;o++)t=0===o?n.textIndent:0,e=o*n.lineHeight+n.offsetY,"middle"==this._settings.verticalAlign?e+=(n.lineHeight-n.fontSize)/2:"bottom"==this._settings.verticalAlign&&(e+=n.lineHeight-n.fontSize),"right"===this._settings.textAlign?t+=n.innerWidth-n.lineWidths[o]:"center"===this._settings.textAlign&&(t+=(n.innerWidth-n.lineWidths[o])/2),t+=n.paddingLeft,r.push({text:n.lines[o],x:t,y:e,w:n.lineWidths[o]});if(this._settings.highlight){var a=this._settings.highlightColor||0,u=this._settings.highlightHeight*i||1.5*n.fontSize,l=this._settings.highlightOffset*i,h=null!==this._settings.highlightPaddingLeft?this._settings.highlightPaddingLeft*i:n.paddingLeft,c=null!==this._settings.highlightPaddingRight?this._settings.highlightPaddingRight*i:n.paddingRight;this._context.fillStyle=uo.getRgbaString(a);for(var f=0;f<r.length;f++){var d=r[f];this._context.fillRect(d.x-h,d.y-n.offsetY+l,d.w+c+h,u)}}var A=null;this._settings.shadow&&(A=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=uo.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*i,this._context.shadowOffsetY=this._settings.shadowOffsetY*i,this._context.shadowBlur=this._settings.shadowBlur*i),this._context.fillStyle=uo.getRgbaString(this._settings.textColor);for(var g=0,p=r.length;g<p;g++){var v=r[g];if(0===n.letterSpacing)this._context.fillText(v.text,v.x,v.y);else for(var _=v.text.split(""),y=v.x,x=0,m=_.length;x<m;x++)this._context.fillText(_[x],y,v.y),y+=this.measureText(_[x],n.letterSpacing)}A&&(this._context.shadowColor=A[0],this._context.shadowOffsetX=A[1],this._context.shadowOffsetY=A[2],this._context.shadowBlur=A[3]),(n.cutSx||n.cutSy)&&this._context.translate(n.cutSx,n.cutSy),this.renderInfo=n}},{key:"wrapWord",value:function(t,e,n){var i=this.measureText(n),r=t.length,o=this.measureText(t);if(o<=e)return t;var s=Math.floor(e*r/o),a=this.measureText(t.substring(0,s))+i;if(a>e)for(;s>0&&(a=this.measureText(t.substring(0,s))+i)>e;)s-=1;else for(;s<r;){if(!((a=this.measureText(t.substring(0,s))+i)<e)){s-=1;break}s+=1}return t.substring(0,s)+(e>=i?n:"")}},{key:"wrapText",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return function(t,e,n,i,r){for(var o=/ |\u200B/g,s=e.split(/\r?\n/g),a=[],u=[],l=0;l<s.length;l++){for(var h=[],c="",f=n-r,d=s[l].split(o),A=s[l].match(o)||[],g=0;g<d.length;g++){var p=A[g-1]||"",v=d[g],_=Do(t,v,i),y=_+Do(t,p,i);0===g||y>f?(g>0&&(h.push(c),c=""),c+=v,f=n-_-(0===g?r:0)):(f-=y,c+=p+v)}h.push(c),c="",a=a.concat(h),l<s.length-1&&u.push(a.length)}return{l:a,n:u}}(this._context,t,e,n,i)}},{key:"measureText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Do(this._context,t,e)}}]),t}(),No=function(){function t(e,n,i){_(this,t),this._stage=e,this._canvas=n,this._context=this._canvas.getContext("2d"),this._settings=i}return v(t,[{key:"getPrecision",value:function(){return this._settings.precision}},{key:"setFontProperties",value:function(){var t=zo(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));return this._context.font=t,this._context.textBaseline=this._settings.textBaseline,t}},{key:"_load",value:function(){var t=this;if(lo.isWeb&&document.fonts){var e=zo(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch((function(t){console.warn("Font load error",t,e)})).then((function(){document.fonts.check(e,t._settings.text)||console.warn("Font not found",e)}))}catch(n){console.warn("Can't check font loading for "+e)}}}},{key:"draw",value:function(){var t=this,e=this._load();return e?e.then((function(){return lo.isSpark?t._stage.platform.drawText(t):t._draw()})):lo.isSpark?this._stage.platform.drawText(this):this._draw()}},{key:"_calculateRenderInfo",value:function(){var t=this,e={},n=this.getPrecision(),i=this._settings.paddingLeft*n,r=this._settings.paddingRight*n,o=this._settings.fontSize*n,s=this._settings.lineHeight*n||o,a=0!=this._settings.w?this._settings.w*n:this._stage.getOption("w"),u=this._settings.wordWrapWidth*n,l=this._settings.cutSx*n,h=this._settings.cutEx*n,c=this._settings.cutSy*n,f=this._settings.cutEy*n,d=this._settings.letterSpacing||0;e.baseFont=this.setFontProperties(),e.w=a,e.width=a,e.text=this._settings.text,e.precision=n,e.fontSize=o,e.fontBaselineRatio=this._settings.fontBaselineRatio,e.lineHeight=s,e.letterSpacing=d,e.textAlign=this._settings.textAlign,e.textColor=this._settings.textColor,e.verticalAlign=this._settings.verticalAlign,e.highlight=this._settings.highlight,e.highlightColor=this._settings.highlightColor,e.highlightHeight=this._settings.highlightHeight,e.highlightPaddingLeft=this._settings.highlightPaddingLeft,e.highlightPaddingRight=this._settings.highlightPaddingRight,e.highlightOffset=this._settings.highlightOffset,e.paddingLeft=this._settings.paddingLeft,e.paddingRight=this._settings.paddingRight,e.maxLines=this._settings.maxLines,e.maxLinesSuffix=this._settings.maxLinesSuffix,e.textOverflow=this._settings.textOverflow,e.wordWrap=this._settings.wordWrap,e.wordWrapWidth=u,e.shadow=this._settings.shadow,e.shadowColor=this._settings.shadowColor,e.shadowOffsetX=this._settings.shadowOffsetX,e.shadowOffsetY=this._settings.shadowOffsetY,e.shadowBlur=this._settings.shadowBlur,e.cutSx=l,e.cutEx=h,e.cutSy=c,e.cutEy=f,e.textIndent=this._settings.textIndent*n,e.wordBreak=this._settings.wordBreak;var A=e.text,g=e.wordWrap&&e.wordWrapWidth||e.width;if(e.textOverflow&&!e.wordWrap){var p;switch(this._settings.textOverflow){case"clip":p="";break;case"ellipsis":p=this._settings.maxLinesSuffix;break;default:p=this._settings.textOverflow}A=this.wrapWord(A,u||e.w,p)}A=this.tokenize(A),A=this.parse(A),A=this.measure(A,d,e.baseFont),e.textIndent&&(A=this.indent(A,e.textIndent)),e.wordBreak&&(A=A.reduce((function(n,i){return n.concat(t.wordBreak(i,g,e.baseFont))}),[]),this.resetFontStyle());var v,_=i,x=0,m=w(A);try{for(m.s();!(v=m.n()).done;){var k=v.value;(e.wordWrap&&_+k.width>g||"\n"==k.text)&&(_=i,x+=1),k.lineNo=x,"\n"!=k.text&&(k.x=_,_+=k.width)}}catch(J){m.e(J)}finally{m.f()}e.lineNum=x+1,this._settings.h?e.h=this._settings.h:e.maxLines&&e.maxLines<e.lineNum?e.h=e.maxLines*e.lineHeight+o/2:e.h=e.lineNum*e.lineHeight+o/2;var T=e.fontBaselineRatio*e.fontSize,b=0;"top"==e.verticalAlign&&"alphabetic"==this._context.textBaseline?b=-T:"middle"==e.verticalAlign?b=(e.lineHeight-e.fontSize-T)/2:"bottom"==this._settings.verticalAlign&&(b=e.lineHeight-e.fontSize),e.lines=[];for(var C=0;C<e.lineNum;C++)e.lines[C]={width:0,x:0,y:e.lineHeight*C+b,text:[]};var S,E=w(A);try{for(E.s();!(S=E.n()).done;){var I=S.value;e.lines[I.lineNo].text.push(I)}}catch(J){E.e(J)}finally{E.f()}var L,R=w(e.lines);try{for(R.s();!(L=R.n()).done;){var M=L.value;if(0!=M.text.length){var P=M.text[0].text,z=M.text[M.text.length-1].text;"\n"==P&&M.text.shift(),(Oo(z)||"\n"==z)&&M.text.pop()}}}catch(J){R.e(J)}finally{R.f()}var B,O=w(e.lines);try{for(O.s();!(B=O.n()).done;){var D=B.value;D.width=D.text.reduce((function(t,e){return t+e.width}),0)}}catch(J){O.e(J)}finally{O.f()}if(e.width=0!=this._settings.w?this._settings.w*n:Math.max.apply(Math,y(e.lines.map((function(t){return t.width}))))+r,e.w=e.width,e.maxLines&&e.lineNum>e.maxLines&&e.maxLinesSuffix){var F=e.maxLines-1,N=A.filter((function(t){return t.lineNo==F})),U=e.maxLinesSuffix;U=this.tokenize(U),U=this.parse(U);var j,H=w(U=this.measure(U,e.letterSpacing,e.baseFont));try{for(H.s();!(j=H.n()).done;){var W=j.value;W.lineNo=F,W.x=0,N.push(W)}}catch(J){H.e(J)}finally{H.f()}for(var Q=U.length+1,G=N.reduce((function(t,e){return t+e.width}),0);(G>e.width||Oo(N[N.length-Q].text))&&(N.splice(N.length-Q,1),G=N.reduce((function(t,e){return t+e.width}),0),!(N.length<Q)););this.alignLine(N,N[0].x),e.lines[F].text=N,e.lines[F].width=G}if("center"==e.textAlign){var Y,X=w(e.lines);try{for(X.s();!(Y=X.n()).done;){var V=Y.value;V.x=(e.width-V.width-i)/2}}catch(J){X.e(J)}finally{X.f()}}else if("right"==e.textAlign){var Z,q=w(e.lines);try{for(q.s();!(Z=q.n()).done;){var K=Z.value;K.x=e.width-K.width-i}}catch(J){q.e(J)}finally{q.f()}}return e}},{key:"_draw",value:function(){var t=this._calculateRenderInfo(),e=this.getPrecision(),n=t.paddingLeft*e,i=t.w||t.width;(t.cutSx||t.cutEx)&&(i=Math.min(t.w,t.cutEx-t.cutSx));var r=t.h;if((t.cutSy||t.cutEy)&&(r=Math.min(t.h,t.cutEy-t.cutSy)),this._canvas.width=Math.ceil(i+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(r),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy),t.highlight){var o=t.highlightColor||0,s=t.highlightHeight?t.highlightHeight*e:1.5*t.fontSize,a=t.highlightOffset?t.highlightOffset*e:0,u=null!==t.highlightPaddingLeft?t.highlightPaddingLeft*e:t.paddingLeft,l=null!==t.highlightPaddingRight?t.highlightPaddingRight*e:t.paddingRight;this._context.fillStyle=uo.getRgbaString(o);for(var h=t.maxLines?Math.min(t.maxLines,t.lineNum):t.lineNum,c=0;c<h;c++){var f=t.lines[c];this._context.fillRect(f.x-u+n,f.y+a,f.width+u+l,s)}}var d=null;this._settings.shadow&&(d=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=uo.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*e,this._context.shadowOffsetY=this._settings.shadowOffsetY*e,this._context.shadowBlur=this._settings.shadowBlur*e);var A=uo.getRgbaString(this._settings.textColor),g=A;this._context.fillStyle=A;var p,v=w(t.lines);try{for(v.s();!(p=v.n()).done;){var _,y=w(p.value.text);try{for(y.s();!(_=y.n()).done;){var x=_.value,m=0;if("\n"!=x.text&&!(t.maxLines&&x.lineNo>=t.maxLines))if(x.color!=g&&(g=x.color,this._context.fillStyle=g),this._context.font=x.fontStyle,x.letters){var k,T=w(x.letters);try{for(T.s();!(k=T.n()).done;){var b=k.value,C=t.lines[x.lineNo].x+x.x+m;this._context.fillText(b.text,C,t.lines[x.lineNo].y+t.fontSize),m+=b.width}}catch(E){T.e(E)}finally{T.f()}}else{var S=t.lines[x.lineNo].x+x.x;this._context.fillText(x.text,S,t.lines[x.lineNo].y+t.fontSize)}}}catch(E){y.e(E)}finally{y.f()}}}catch(E){v.e(E)}finally{v.f()}d&&(this._context.shadowColor=d[0],this._context.shadowOffsetX=d[1],this._context.shadowOffsetY=d[2],this._context.shadowBlur=d[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),t.lines=t.lines.map((function(t){return t.text.reduce((function(t,e){return t+e.text}),"")})),t.maxLines&&(t.lines=t.lines.slice(0,t.maxLines)),this.renderInfo=t}},{key:"measureText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Do(this._context,t,e)}},{key:"tokenize",value:function(t){return function(t,e){for(var n=e.match(t)||[],i=e.split(t)||[],r=[],o=0;o<i.length;o++)r.push(i[o],n[o]);return r.pop(),r.filter((function(t){return""!=t}))}(/ |\u200B|\n|<i>|<\/i>|<b>|<\/b>|<color=0[xX][0-9a-fA-F]{8}>|<\/color>/g,t)}},{key:"parse",value:function(t){var e=0,n=0,i=[uo.getRgbaString(this._settings.textColor)],r=0,o=/<color=(0[xX][0-9a-fA-F]{8})>/;return t.map((function(t){if("<i>"==t)e+=1,t="";else if("</i>"==t&&e>0)e-=1,t="";else if("<b>"==t)n+=1,t="";else if("</b>"==t&&n>0)n-=1,t="";else if("</color>"==t)i.length>1&&(r-=1,i.pop()),t="";else if(o.test(t)){var s=o.exec(t);i.push(uo.getRgbaString(parseInt(s[1]))),r+=1,t=""}return{text:t,italic:e,bold:n,color:i[r]}})).filter((function(t){return""!=t.text}))}},{key:"applyFontStyle",value:function(t,e){var n=e;t.bold&&(n="bold "+n),t.italic&&(n="italic "+n),this._context.font=n,t.fontStyle=n}},{key:"resetFontStyle",value:function(t){this._context.font=t}},{key:"measure",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=w(t);try{for(r.s();!(e=r.n()).done;){var o=e.value;if(this.applyFontStyle(o,i),o.width=this.measureText(o.text,n),n>0){o.letters=o.text.split("").map((function(t){return{text:t}}));var s,a=w(o.letters);try{for(a.s();!(s=a.n()).done;){var u=s.value;u.width=this.measureText(u.text,n)}}catch(l){a.e(l)}finally{a.f()}}}}catch(l){r.e(l)}finally{r.f()}return this.resetFontStyle(i),t}},{key:"indent",value:function(t,e){return t.splice(0,0,{text:"",width:e}),t}},{key:"wrapWord",value:function(t,e,n){var i=this.measureText(n),r=t.length,o=this.measureText(t);if(o<=e)return t;var s=Math.floor(e*r/o),a=this.measureText(t.substring(0,s))+i;if(a>e)for(;s>0&&(a=this.measureText(t.substring(0,s))+i)>e;)s-=1;else for(;s<r;){if(!((a=this.measureText(t.substring(0,s))+i)<e)){s-=1;break}s+=1}return t.substring(0,s)+(e>=i?n:"")}},{key:"_getBreakIndex",value:function(t,e){var n=t.length,i=this.measureText(t);if(i<=e)return{breakIndex:t.length,truncWordWidth:i};var r=Math.floor(e*n/i),o=this.measureText(t.substring(0,r));if(o>e)for(;r>0&&(o=this.measureText(t.substring(0,r)))>e;)r-=1;else for(;r<n;){if(!((o=this.measureText(t.substring(0,r)))<e)){r-=1,o=this.measureText(t.substring(0,r));break}r+=1}return{breakIndex:r,truncWordWidth:o}}},{key:"wordBreak",value:function(t,e,n){if(!t.text)return t;this.applyFontStyle(t,n);var i=[],r=t.text;if(t.letters){var o,s=0,a=[],u=0,l=w(t.letters);try{for(l.s();!(o=l.n()).done;){var h=o.value;s+h.width>=e?(i.push(m({},t)),i[i.length-1].text=r.slice(0,u),i[i.length-1].width=s,i[i.length-1].letters=a,r=r.slice(u),s=0,a=[],u=0):(u+=1,a.push(h),s+=h.width)}}catch(A){l.e(A)}finally{l.f()}s>0&&(i.push(m({},t)),i[i.length-1].text=r.slice(0,u),i[i.length-1].width=s,i[i.length-1].letters=a)}else for(;;){var c=this._getBreakIndex(r,e),f=c.breakIndex,d=c.truncWordWidth;if(i.push(m({},t)),i[i.length-1].text=r.slice(0,f),i[i.length-1].width=d,f===r.length)break;r=r.slice(f)}return i}},{key:"alignLine",value:function(t){var e,n=0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=w(t);try{for(r.s();!(e=r.n()).done;){var o=e.value;"\n"!=o.text&&(o.x=i+n,i=o.x,n=o.width)}}catch(s){r.e(s)}finally{r.f()}}}]),t}(),Uo=function(t){l(i,t);var n=c(i);function i(t){var e;return _(this,i),(e=n.call(this,t))._precision=e.stage.getOption("precision"),e}return v(i,[{key:"text",get:function(){return this._text},set:function(t){this._text!==t&&(this._text=""+t,this._changed())}},{key:"w",get:function(){return this._w},set:function(t){this._w!==t&&(this._w=t,this._changed())}},{key:"h",get:function(){return this._h},set:function(t){this._h!==t&&(this._h=t,this._changed())}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._changed())}},{key:"fontBaselineRatio",get:function(){return this._fontBaselineRatio},set:function(t){this._fontBaselineRatio!==t&&(this._fontBaselineRatio=t,this._changed())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._changed())}},{key:"fontFace",get:function(){return this._fontFace},set:function(t){this._fontFace!==t&&(this._fontFace=t,this._changed())}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this._changed())}},{key:"wordWrapWidth",get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this._changed())}},{key:"wordBreak",get:function(){return this._wordBreak},set:function(t){this._wordBreak!==t&&(this._wordBreak=t,this._changed())}},{key:"textOverflow",get:function(){return this._textOverflow},set:function(t){t!=this._textOverflow&&(this._textOverflow=t,this._changed())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._changed())}},{key:"textBaseline",get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this._changed())}},{key:"textAlign",get:function(){return this._textAlign},set:function(t){this._textAlign!==t&&(this._textAlign=t,this._changed())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._changed())}},{key:"offsetY",get:function(){return this._offsetY},set:function(t){this._offsetY!==t&&(this._offsetY=t,this._changed())}},{key:"maxLines",get:function(){return this._maxLines},set:function(t){this._maxLines!==t&&(this._maxLines=t,this._changed())}},{key:"maxLinesSuffix",get:function(){return this._maxLinesSuffix},set:function(t){this._maxLinesSuffix!==t&&(this._maxLinesSuffix=t,this._changed())}},{key:"textColor",get:function(){return this._textColor},set:function(t){this._textColor!==t&&(this._textColor=t,this._changed())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._changed())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._changed())}},{key:"shadow",get:function(){return this._shadow},set:function(t){this._shadow!==t&&(this._shadow=t,this._changed())}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor!==t&&(this._shadowColor=t,this._changed())}},{key:"shadowOffsetX",get:function(){return this._shadowOffsetX},set:function(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._changed())}},{key:"shadowOffsetY",get:function(){return this._shadowOffsetY},set:function(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._changed())}},{key:"shadowBlur",get:function(){return this._shadowBlur},set:function(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._changed())}},{key:"highlight",get:function(){return this._highlight},set:function(t){this._highlight!==t&&(this._highlight=t,this._changed())}},{key:"highlightHeight",get:function(){return this._highlightHeight},set:function(t){this._highlightHeight!==t&&(this._highlightHeight=t,this._changed())}},{key:"highlightColor",get:function(){return this._highlightColor},set:function(t){this._highlightColor!==t&&(this._highlightColor=t,this._changed())}},{key:"highlightOffset",get:function(){return this._highlightOffset},set:function(t){this._highlightOffset!==t&&(this._highlightOffset=t,this._changed())}},{key:"highlightPaddingLeft",get:function(){return this._highlightPaddingLeft},set:function(t){this._highlightPaddingLeft!==t&&(this._highlightPaddingLeft=t,this._changed())}},{key:"highlightPaddingRight",get:function(){return this._highlightPaddingRight},set:function(t){this._highlightPaddingRight!==t&&(this._highlightPaddingRight=t,this._changed())}},{key:"cutSx",get:function(){return this._cutSx},set:function(t){this._cutSx!==t&&(this._cutSx=t,this._changed())}},{key:"cutEx",get:function(){return this._cutEx},set:function(t){this._cutEx!==t&&(this._cutEx=t,this._changed())}},{key:"cutSy",get:function(){return this._cutSy},set:function(t){this._cutSy!==t&&(this._cutSy=t,this._changed())}},{key:"cutEy",get:function(){return this._cutEy},set:function(t){this._cutEy!==t&&(this._cutEy=t,this._changed())}},{key:"advancedRenderer",get:function(){return this._advancedRenderer},set:function(t){this._advancedRenderer!==t&&(this._advancedRenderer=t,this._changed())}},{key:"letterSpacing",get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this._changed())}},{key:"textIndent",get:function(){return this._textIndent},set:function(t){this._textIndent!==t&&(this._textIndent=t,this._changed())}},{key:"precision",get:function(){return r(g(i.prototype),"precision",this)},set:function(t){this.precision!==t&&(e(g(i.prototype),"precision",t,this,!0),this._changed())}},{key:"_getIsValid",value:function(){return!!this.text}},{key:"_getLookupId",value:function(){var t=[];return 0!==this.w&&t.push("w "+this.w),0!==this.h&&t.push("h "+this.h),"normal"!==this.fontStyle&&t.push("fS"+this.fontStyle),40!==this.fontSize&&t.push("fs"+this.fontSize),0!==this.fontBaselineRatio&&t.push("fb"+this.fontBaselineRatio),null!==this.fontFace&&t.push("ff"+(Array.isArray(this.fontFace)?this.fontFace.join(","):this.fontFace)),!0!==this.wordWrap&&t.push("wr"+(this.wordWrap?1:0)),0!==this.wordWrapWidth&&t.push("ww"+this.wordWrapWidth),!1!==this.wordBreak&&t.push((this.wordBreak,1)),""!=this.textOverflow&&t.push("to"+this.textOverflow),null!==this.lineHeight&&t.push("lh"+this.lineHeight),"alphabetic"!==this.textBaseline&&t.push("tb"+this.textBaseline),"left"!==this.textAlign&&t.push("ta"+this.textAlign),"top"!==this.verticalAlign&&t.push("va"+this.verticalAlign),null!==this.offsetY&&t.push("oy"+this.offsetY),0!==this.maxLines&&t.push("ml"+this.maxLines),".."!==this.maxLinesSuffix&&t.push("ms"+this.maxLinesSuffix),t.push("pc"+this.precision),4294967295!==this.textColor&&t.push("co"+this.textColor.toString(16)),0!==this.paddingLeft&&t.push("pl"+this.paddingLeft),0!==this.paddingRight&&t.push("pr"+this.paddingRight),!1!==this.shadow&&t.push("sh"+(this.shadow?1:0)),4278190080!==this.shadowColor&&t.push("sc"+this.shadowColor.toString(16)),0!==this.shadowOffsetX&&t.push("sx"+this.shadowOffsetX),0!==this.shadowOffsetY&&t.push("sy"+this.shadowOffsetY),5!==this.shadowBlur&&t.push("sb"+this.shadowBlur),!1!==this.highlight&&t.push("hL"+(this.highlight?1:0)),0!==this.highlightHeight&&t.push("hh"+this.highlightHeight),4278190080!==this.highlightColor&&t.push("hc"+this.highlightColor.toString(16)),null!==this.highlightOffset&&t.push("ho"+this.highlightOffset),null!==this.highlightPaddingLeft&&t.push("hl"+this.highlightPaddingLeft),null!==this.highlightPaddingRight&&t.push("hr"+this.highlightPaddingRight),null!==this.letterSpacing&&t.push("ls"+this.letterSpacing),null!==this.textIndent&&t.push("ti"+this.textIndent),this.cutSx&&t.push("csx"+this.cutSx),this.cutEx&&t.push("cex"+this.cutEx),this.cutSy&&t.push("csy"+this.cutSy),this.cutEy&&t.push("cey"+this.cutEy),this.advancedRenderer&&t.push((this.advancedRenderer,1)),"TX$"+t.join("|")+":"+this.text}},{key:"_getSourceLoader",value:function(){var t=this.cloneArgs(),e=this.stage.gl;return function(n){var i=this,r=this.stage.platform.getDrawingCanvas(),o=t.advancedRenderer?new No(this.stage,r,t):new Fo(this.stage,r,t),s=o.draw(),a={},u=this.stage.getOption("fontSharp"),l=!1;if(lo.isBoolean(u))l=u;else if(lo.isObject(u)){l=this.stage.getRenderPrecision()<=u.precision&&t.fontSize<=u.fontSize}e&&l&&(a[e.TEXTURE_MAG_FILTER]=e.NEAREST),s?s.then((function(){n(null,Object.assign({renderInfo:o.renderInfo,throttle:!1,texParams:a},i.stage.platform.getTextureOptionsForDrawingCanvas(r)))})).catch((function(t){n(t)})):n(null,Object.assign({renderInfo:o.renderInfo,throttle:!1,texParams:a},this.stage.platform.getTextureOptionsForDrawingCanvas(r)))}}},{key:"getNonDefaults",value:function(){var t=r(g(i.prototype),"getNonDefaults",this).call(this);return""!==this.text&&(t.text=this.text),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),"normal"!==this.fontStyle&&(t.fontStyle=this.fontStyle),40!==this.fontSize&&(t.fontSize=this.fontSize),0!==this.fontBaselineRatio&&(t.fontBaselineRatio=this.fontBaselineRatio),null!==this.fontFace&&(t.fontFace=this.fontFace),!0!==this.wordWrap&&(t.wordWrap=this.wordWrap),0!==this.wordWrapWidth&&(t.wordWrapWidth=this.wordWrapWidth),!1!==this.wordBreak&&(t.wordBreak=this.wordBreak),""!=this.textOverflow&&(t.textOverflow=this.textOverflow),null!==this.lineHeight&&(t.lineHeight=this.lineHeight),"alphabetic"!==this.textBaseline&&(t.textBaseline=this.textBaseline),"left"!==this.textAlign&&(t.textAlign=this.textAlign),"top"!==this.verticalAlign&&(t.verticalAlign=this.verticalAlign),null!==this.offsetY&&(t.offsetY=this.offsetY),0!==this.maxLines&&(t.maxLines=this.maxLines),".."!==this.maxLinesSuffix&&(t.maxLinesSuffix=this.maxLinesSuffix),this.precision!==this.stage.getOption("precision")&&(t.precision=this.precision),4294967295!==this.textColor&&(t.textColor=this.textColor),0!==this.paddingLeft&&(t.paddingLeft=this.paddingLeft),0!==this.paddingRight&&(t.paddingRight=this.paddingRight),!1!==this.shadow&&(t.shadow=this.shadow),4278190080!==this.shadowColor&&(t.shadowColor=this.shadowColor),0!==this.shadowOffsetX&&(t.shadowOffsetX=this.shadowOffsetX),0!==this.shadowOffsetY&&(t.shadowOffsetY=this.shadowOffsetY),5!==this.shadowBlur&&(t.shadowBlur=this.shadowBlur),!1!==this.highlight&&(t.highlight=this.highlight),0!==this.highlightHeight&&(t.highlightHeight=this.highlightHeight),4278190080!==this.highlightColor&&(t.highlightColor=this.highlightColor),0!==this.highlightOffset&&(t.highlightOffset=this.highlightOffset),0!==this.highlightPaddingLeft&&(t.highlightPaddingLeft=this.highlightPaddingLeft),0!==this.highlightPaddingRight&&(t.highlightPaddingRight=this.highlightPaddingRight),0!==this.letterSpacing&&(t.letterSpacing=this.letterSpacing),0!==this.textIndent&&(t.textIndent=this.textIndent),this.cutSx&&(t.cutSx=this.cutSx),this.cutEx&&(t.cutEx=this.cutEx),this.cutSy&&(t.cutSy=this.cutSy),this.cutEy&&(t.cutEy=this.cutEy),this.advancedRenderer&&(t.renderer=this.advancedRenderer),t}},{key:"cloneArgs",value:function(){var t={};return t.text=this._text,t.w=this._w,t.h=this._h,t.fontStyle=this._fontStyle,t.fontSize=this._fontSize,t.fontBaselineRatio=this._fontBaselineRatio,t.fontFace=this._fontFace,t.wordWrap=this._wordWrap,t.wordWrapWidth=this._wordWrapWidth,t.wordBreak=this._wordBreak,t.textOverflow=this._textOverflow,t.lineHeight=this._lineHeight,t.textBaseline=this._textBaseline,t.textAlign=this._textAlign,t.verticalAlign=this._verticalAlign,t.offsetY=this._offsetY,t.maxLines=this._maxLines,t.maxLinesSuffix=this._maxLinesSuffix,t.precision=this._precision,t.textColor=this._textColor,t.paddingLeft=this._paddingLeft,t.paddingRight=this._paddingRight,t.shadow=this._shadow,t.shadowColor=this._shadowColor,t.shadowOffsetX=this._shadowOffsetX,t.shadowOffsetY=this._shadowOffsetY,t.shadowBlur=this._shadowBlur,t.highlight=this._highlight,t.highlightHeight=this._highlightHeight,t.highlightColor=this._highlightColor,t.highlightOffset=this._highlightOffset,t.highlightPaddingLeft=this._highlightPaddingLeft,t.highlightPaddingRight=this._highlightPaddingRight,t.letterSpacing=this._letterSpacing,t.textIndent=this._textIndent,t.cutSx=this._cutSx,t.cutEx=this._cutEx,t.cutSy=this._cutSy,t.cutEy=this._cutEy,t.advancedRenderer=this._advancedRenderer,t}}],[{key:"renderer",value:function(t,e,n){return this.advancedRenderer?new No(t,e,n):new Fo(t,e,n)}}]),i}(Mo),jo=Uo.prototype;jo._text="",jo._w=0,jo._h=0,jo._fontStyle="normal",jo._fontSize=40,jo._fontFace=null,jo._wordWrap=!0,jo._wordWrapWidth=0,jo._wordBreak=!1,jo._textOverflow="",jo._lineHeight=null,jo._textBaseline="alphabetic",jo._textAlign="left",jo._verticalAlign="top",jo._offsetY=null,jo._maxLines=0,jo._maxLinesSuffix="..",jo._textColor=4294967295,jo._paddingLeft=0,jo._paddingRight=0,jo._shadow=!1,jo._shadowColor=4278190080,jo._shadowOffsetX=0,jo._shadowOffsetY=0,jo._shadowBlur=5,jo._highlight=!1,jo._highlightHeight=0,jo._highlightColor=4278190080,jo._highlightOffset=0,jo._highlightPaddingLeft=0,jo._highlightPaddingRight=0,jo._letterSpacing=0,jo._textIndent=0,jo._cutSx=0,jo._cutEx=0,jo._cutSy=0,jo._cutEy=0,jo._advancedRenderer=!1,jo._fontBaselineRatio=0;var Ho=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._textureSource=void 0,i}return v(n,[{key:"textureSource",get:function(){return this._textureSource},set:function(t){t!==this._textureSource&&(t.isResultTexture&&(this._precision=this.stage.getRenderPrecision()),this._textureSource=t,this._changed())}},{key:"_getTextureSource",value:function(){return this._textureSource}}]),n}(Mo),Wo=function(t){l(n,t);var e=c(n);function n(t,i,r,o){var s;return _(this,n),(s=e.call(this)).manager=t,s._settings=i,s._element=r,s._getter=r.constructor.getGetter(o),s._setter=r.constructor.getSetter(o),s._merger=i.merger,s._merger||(s._merger=r.constructor.getMerger(o)),s._startValue=s._getter(s._element),s._targetValue=s._startValue,s._p=1,s._delayLeft=0,s}return v(n,[{key:"start",value:function(t){this._startValue=this._getter(this._element),this.isAttached()?t===this._startValue?this.reset(t,1):(this._targetValue=t,this._p=0,this._delayLeft=this._settings.delay,this.emit("start"),this.add()):(this._targetValue=t,this._p=1,this._updateDrawValue())}},{key:"finish",value:function(){this._p<1&&(this._p=1)}},{key:"stop",value:function(){this.emit("stop"),this.manager.removeActive(this)}},{key:"pause",value:function(){this.stop()}},{key:"play",value:function(){this.manager.addActive(this)}},{key:"reset",value:function(t,e){this.isAttached()?(this._startValue=this._getter(this._element),this._targetValue=t,this._p=e,this.add()):(this._startValue=this._getter(this._element),this._targetValue=t,this._p=1,this._updateDrawValue())}},{key:"_updateDrawValue",value:function(){this._setter(this._element,this.getDrawValue())}},{key:"add",value:function(){this.manager.addActive(this)}},{key:"isAttached",value:function(){return this._element.attached}},{key:"isRunning",value:function(){return this._p<1}},{key:"progress",value:function(t){if(this.isAttached()||(this._p=1),this.p<1){if(this.delayLeft>0){if(this._delayLeft-=t,!(this.delayLeft<0))return;t=-this.delayLeft,this._delayLeft=0,this.emit("delayEnd")}0==this._settings.duration?this._p=1:this._p+=t/this._settings.duration,this._p>=1&&(this._p=1)}this._updateDrawValue(),this.invokeListeners()}},{key:"invokeListeners",value:function(){this.emit("progress",this.p),1===this.p&&this.emit("finish")}},{key:"updateTargetValue",value:function(t){var e=this._settings.timingFunctionImpl(this.p);1===e?this._targetValue=t:0===e?(this._startValue=this._targetValue,this._targetValue=t):(this._startValue=t-(t-this._targetValue)/(1-e),this._targetValue=t)}},{key:"getDrawValue",value:function(){if(this.p>=1)return this.targetValue;var t=this._settings._timingFunctionImpl(this.p);return this._merger(this.targetValue,this.startValue,t)}},{key:"skipDelay",value:function(){this._delayLeft=0}},{key:"startValue",get:function(){return this._startValue}},{key:"targetValue",get:function(){return this._targetValue}},{key:"p",get:function(){return this._p}},{key:"delayLeft",get:function(){return this._delayLeft}},{key:"element",get:function(){return this._element}},{key:"settings",get:function(){return this._settings},set:function(t){this._settings=t}}]),n}(Lo);Wo.prototype.isTransition=!0;var Qo=function(){function t(){_(this,t),this._items=[],this._refs={}}return v(t,[{key:"get",value:function(){return this._items}},{key:"first",get:function(){return this._items[0]}},{key:"last",get:function(){return this._items.length?this._items[this._items.length-1]:void 0}},{key:"add",value:function(t){this.addAt(t,this._items.length)}},{key:"addAt",value:function(t,e){if(!(e>=0&&e<=this._items.length))throw new Error("addAt: The index "+e+" is out of bounds "+this._items.length);var n=this._items.indexOf(t);if(n===e)return t;if(lo.isObjectLiteral(t)){var i=t;(t=this.createItem(i)).patch(i)}-1!=n?this.setAt(t,e):(t.ref&&(this._refs[t.ref]=t),this._items.splice(e,0,t),this.onAdd(t,e))}},{key:"replaceByRef",value:function(t){if(!t.ref)throw new Error("replaceByRef: no ref specified in item");var e=this.getByRef(t.ref);if(!e)throw new Error("replaceByRef: no item found with reference: "+t.ref);this.replace(t,e),this.addAt(t,this._items.length)}},{key:"replace",value:function(t,e){var n=this.getIndex(e);if(-1===n)throw new Error("replace: The previous item does not exist");this.setAt(t,n)}},{key:"setAt",value:function(t,e){if(!(e>=0&&e<=this._items.length))throw new Error("setAt: The index "+e+" is out of bounds "+this._items.length);if(lo.isObjectLiteral(t)){var n=t;(t=this.createItem(n)).patch(n)}var i=this._items.indexOf(t);if(-1!=i){if(i!==e){var r=i;r!==e&&(this._items.splice(r,1),this._items.splice(e,0,t),this.onMove(t,r,e))}}else{if(!(e<this._items.length))throw new Error("setAt: The index "+e+" is out of bounds "+this._items.length);this._items[e].ref&&(this._refs[this._items[e].ref]=void 0);var o=this._items[e];this._items[e]=t,t.ref&&(this._refs[t.ref]=t),this.onSet(t,e,o)}}},{key:"getAt",value:function(t){return this._items[t]}},{key:"getIndex",value:function(t){return this._items.indexOf(t)}},{key:"remove",value:function(t){var e=this._items.indexOf(t);-1!==e&&this.removeAt(e)}},{key:"removeAt",value:function(t){if(t>=0&&t<this._items.length){var e=this._items[t];return e.ref&&(this._refs[e.ref]=void 0),this._items.splice(t,1),this.onRemove(e,t),e}throw new Error("removeAt: The index ".concat(t," is out of bounds ").concat(this._items.length-1))}},{key:"clear",value:function(){if(this._items.length){var t=this._items;this._items=[],this._refs={},this.onSync(t,[],[])}}},{key:"a",value:function(t){if(lo.isObjectLiteral(t)){var e=this.createItem(t);return e.patch(t),this.add(e),e}if(Array.isArray(t)){for(var n=0,i=t.length;n<i;n++)this.a(t[n]);return null}if(this.isItem(t))return this.add(t),t}},{key:"length",get:function(){return this._items.length}},{key:"_getRefs",value:function(){return this._refs}},{key:"getByRef",value:function(t){return this._refs[t]}},{key:"clearRef",value:function(t){delete this._refs[t]}},{key:"setRef",value:function(t,e){this._refs[t]=e}},{key:"patch",value:function(t){lo.isObjectLiteral(t)?this._setByObject(t):Array.isArray(t)&&this._setByArray(t)}},{key:"_setByObject",value:function(t){for(var e=this._getRefs(),n=Object.keys(t),i=0,r=n.length;i<r;i++){var o=n[i],s=t[o],a=e[o];if(a)if(this.isItem(s)){if(a!==s){var u=this.getIndex(a);s.ref=o,this.setAt(s,u)}}else a.patch(s);else this.isItem(s)?(s.ref=o,this.add(s)):((a=this.createItem(s)).ref=o,a.patch(s),this.add(a))}}},{key:"_equalsArray",value:function(t){var e=!0;if(t.length===this._items.length)for(var n=0,i=this._items.length;n<i&&e;n++)e=e&&this._items[n]===t[n];else e=!1;return e}},{key:"_setByArray",value:function(t){if(!this._equalsArray(t)){for(var e=0,n=this._items.length;e<n;e++)this._items[e].marker=!0;for(var i,r=[],o=0,s=t.length;o<s;o++){var a=t[o];if(this.isItem(a))a.marker=!1,r.push(a);else{var u=a.ref,l=void 0;u&&(i||(i=this._getRefs()),l=i[u]),l?l.marker=!1:l=this.createItem(a),lo.isObjectLiteral(a)&&l.patch(a),r.push(l)}}this._setItems(r)}}},{key:"_setItems",value:function(t){var e=this._items;this._items=t;var n=e.filter((function(t){var e=t.marker;return delete t.marker,e})),i=t.filter((function(t){return-1===e.indexOf(t)}));if(n.length||i.length){this._refs={};for(var r=0,o=this._items.length;r<o;r++){var s=this._items[r].ref;s&&(this._refs[s]=this._items[r])}}this.onSync(n,i,t)}},{key:"sort",value:function(t){var e=this._items.slice();e.sort(t),this._setByArray(e)}},{key:"onAdd",value:function(t,e){}},{key:"onRemove",value:function(t,e){}},{key:"onSync",value:function(t,e,n){}},{key:"onSet",value:function(t,e,n){}},{key:"onMove",value:function(t,e,n){}},{key:"createItem",value:function(t){throw new Error("ObjectList.createItem must create and return a new object")}},{key:"isItem",value:function(t){return!1}},{key:"forEach",value:function(t){this.get().forEach(t)}}]),t}(),Go=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this))._element=t,i}return v(n,[{key:"_connectParent",value:function(t){var e=t.parent;if(e&&e!==this._element){var n=t.parent.childList,i=n.getIndex(t);t.ref&&(n._refs[t.ref]=void 0),n._items.splice(i,1),e.core.removeChildAt(i)}t._setParent(this._element)}},{key:"onAdd",value:function(t,e){this._connectParent(t),this._element.core.addChildAt(e,t.core)}},{key:"onRemove",value:function(t,e){t._setParent(null),this._element.core.removeChildAt(e)}},{key:"onSync",value:function(t,e,n){for(var i=0,r=t.length;i<r;i++)t[i]._setParent(null);for(var o=0,s=e.length;o<s;o++)this._connectParent(e[o]);var a=function(t){return t.core};this._element.core.syncChildren(t.map(a),e.map(a),n.map(a))}},{key:"onSet",value:function(t,e,n){n._setParent(null),this._connectParent(t),this._element.core.setChildAt(e,t.core)}},{key:"onMove",value:function(t,e,n){this._element.core.moveChild(e,n)}},{key:"createItem",value:function(t){return t.type?new t.type(this._element.stage):this._element.stage.createElement()}},{key:"isItem",value:function(t){return t.isElement}}]),n}(Qo),Yo=function(){function t(e){_(this,t),this.stage=e,this.__id=t.id++,this.__start(),this._hasEventListeners=!1,this.__core=new Eo(this),this.__ref=null,this.__attached=!1,this.__enabled=!1,this.__active=!1,this.__parent=null,this.__texture=null,this.__displayedTexture=null,this.__tags=null,this.__treeTags=null,this.__tagRoot=!1,this.__childList=null,this._w=0,this._h=0}return v(t,[{key:"__start",value:function(){}},{key:"id",get:function(){return this.__id}},{key:"ref",get:function(){return this.__ref},set:function(t){if(this.__ref!==t){var e=t.charCodeAt(0);lo.isUcChar(e)||this._throwError("Ref must start with an upper case character: "+t),null!==this.__ref&&(this.removeTag(this.__ref),this.__parent&&this.__parent.__childList.clearRef(this.__ref)),this.__ref=t,this.__ref&&(this._addTag(this.__ref),this.__parent&&this.__parent.__childList.setRef(this.__ref,this))}}},{key:"core",get:function(){return this.__core}},{key:"setAsRoot",value:function(){this.__core.setAsRoot(),this._updateAttachedFlag(),this._updateEnabledFlag()}},{key:"isRoot",get:function(){return this.__core.isRoot}},{key:"_setParent",value:function(t){this.__parent!==t&&(this.__parent&&this._unsetTagsParent(),this.__parent=t,t&&this._setTagsParent(),this._updateAttachedFlag(),this._updateEnabledFlag(),this._updateCollision(),this.isRoot&&t&&this._throwError("Root should not be added as a child! Results are unspecified!"))}},{key:"getDepth",value:function(){for(var t=0,e=this.__parent;e;)t++,e=e.__parent;return t}},{key:"getAncestor",value:function(t){for(var e=this;t>0&&e.__parent;)e=e.__parent,t--;return e}},{key:"getAncestors",value:function(){for(var t=[],e=this;e;)t.push(e),e=e.__parent;return t}},{key:"getAncestorAtDepth",value:function(t){var e=this.getDepth()-t;return e<0?null:this.getAncestor(e)}},{key:"isAncestorOf",value:function(t){for(var e=t;e=e.parent;)if(this===e)return!0;return!1}},{key:"getSharedAncestor",value:function(t){var e=this,n=t,i=e.getDepth(),r=n.getDepth();i>r?e=e.getAncestor(i-r):r>i&&(n=n.getAncestor(r-i));do{if(e===n)return e;e=e.__parent,n=n.__parent}while(e&&n);return null}},{key:"attached",get:function(){return this.__attached}},{key:"enabled",get:function(){return this.__enabled}},{key:"active",get:function(){return this.__active}},{key:"_isAttached",value:function(){return this.__parent?this.__parent.__attached:this.stage.root===this}},{key:"_isEnabled",value:function(){return this.__core.visible&&this.__core.alpha>0&&(this.__parent?this.__parent.__enabled:this.stage.root===this)}},{key:"_isActive",value:function(){return this._isEnabled()&&this.withinBoundsMargin}},{key:"_updateAttachedFlag",value:function(){var t=this._isAttached();if(this.__attached!==t){this.__attached=t,t&&this._onSetup();var e=this._children.get();if(e){var n=e.length;if(n>0)for(var i=0;i<n;i++)e[i]._updateAttachedFlag()}t?this._onAttach():this._onDetach()}}},{key:"_updateEnabledFlag",value:function(){var t=this._isEnabled();if(this.__enabled!==t){t?(this._onEnabled(),this._setEnabledFlag()):(this._onDisabled(),this._unsetEnabledFlag());var e=this._children.get();if(e){var n=e.length;if(n>0)for(var i=0;i<n;i++)e[i]._updateEnabledFlag()}}}},{key:"_setEnabledFlag",value:function(){this.__enabled=!0,this._updateDimensions(),this._updateTextureCoords(),this.__texture&&this.__texture.addElement(this),this.withinBoundsMargin&&this._setActiveFlag(),this.__core.shader&&this.__core.shader.addElement(this.__core)}},{key:"_unsetEnabledFlag",value:function(){var t=this;this.__active&&this._unsetActiveFlag(),this.__texture&&this.__texture.removeElement(this),this.__core.shader&&this.__core.shader.removeElement(this.__core),this._texturizer&&this.texturizer.filters.forEach((function(e){return e.removeElement(t.__core)})),this.__enabled=!1}},{key:"_setActiveFlag",value:function(){this.__active=!0,this.__texture&&this.__texture.incActiveCount(),this.__texture&&this._enableTexture(),this._onActive()}},{key:"_unsetActiveFlag",value:function(){this.__texture&&this.__texture.decActiveCount(),this.__active=!1,this.__texture&&this._disableTexture(),this._hasTexturizer()&&this.texturizer.deactivate(),this._onInactive()}},{key:"_onSetup",value:function(){}},{key:"_onAttach",value:function(){}},{key:"_onDetach",value:function(){}},{key:"_onEnabled",value:function(){}},{key:"_onDisabled",value:function(){}},{key:"_onActive",value:function(){}},{key:"_onInactive",value:function(){}},{key:"_onResize",value:function(){}},{key:"_getRenderWidth",value:function(){return this._w?this._w:this.__displayedTexture?this.__displayedTexture.getRenderWidth():this.__texture?this.__texture.getRenderWidth():0}},{key:"_getRenderHeight",value:function(){return this._h?this._h:this.__displayedTexture?this.__displayedTexture.getRenderHeight():this.__texture?this.__texture.getRenderHeight():0}},{key:"renderWidth",get:function(){return this.__enabled?this.__core.getRenderWidth():this._getRenderWidth()}},{key:"renderHeight",get:function(){return this.__enabled?this.__core.getRenderHeight():this._getRenderHeight()}},{key:"finalX",get:function(){return this.__core.x}},{key:"finalY",get:function(){return this.__core.y}},{key:"finalW",get:function(){return this.__core.w}},{key:"finalH",get:function(){return this.__core.h}},{key:"textureIsLoaded",value:function(){return this.__texture&&this.__texture.isLoaded()}},{key:"loadTexture",value:function(){this.__texture&&(this.__texture.load(),this.__texture.isUsed()&&this._isEnabled()||this._updateDimensions())}},{key:"_enableTextureError",value:function(){var t=this.__texture.loadError;t&&this.emit("txError",t,this.__texture._source)}},{key:"_enableTexture",value:function(){this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):(this._setDisplayedTexture(null),this._enableTextureError())}},{key:"_disableTexture",value:function(){this._setDisplayedTexture(null)}},{key:"texture",get:function(){return this.__texture},set:function(t){var e;if(lo.isObjectLiteral(t))(e=t.type?new t.type(this.stage):this.texture)&&ho.patchObject(e,t);else if(t)if(t.isTexture)e=t;else{if(!t.isTextureSource)return void console.error("[Lightning] Please specify a texture type.");(e=new Ho(this.stage)).textureSource=t}else e=null;var n=this.__texture;e!==n&&(this.__texture=e,this.__texture?this.__enabled&&(this.__texture.addElement(this),this.withinBoundsMargin&&(this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):this._enableTextureError())):this._setDisplayedTexture(null),n&&n!==this.__displayedTexture&&n.removeElement(this),this._updateDimensions())}},{key:"displayedTexture",get:function(){return this.__displayedTexture}},{key:"_setDisplayedTexture",value:function(t){var e=this.__displayedTexture;e&&t!==e&&this.__texture!==e&&e.removeElement(this);var n=this.__core.displayedTextureSource,i=(t?t._source:null)!==n;this.__displayedTexture=t,this._updateDimensions(),this.__displayedTexture?i&&(this._updateTextureCoords(),this.__core.setDisplayedTextureSource(this.__displayedTexture._source)):this.__core.setDisplayedTextureSource(null),i&&(this.__displayedTexture?(this.stage.removeUpdateSourceTexture(this.__displayedTexture),this.emit("txLoaded",this.__displayedTexture)):this.emit("txUnloaded",this.__displayedTexture))}},{key:"onTextureSourceLoaded",value:function(){this.active&&this._setDisplayedTexture(this.__texture)}},{key:"onTextureSourceLoadError",value:function(t){this.emit("txError",t,this.__texture._source)}},{key:"forceRenderUpdate",value:function(){this.__core.setHasRenderUpdates(3)}},{key:"onDisplayedTextureClippingChanged",value:function(){this._updateDimensions(),this._updateTextureCoords()}},{key:"onPrecisionChanged",value:function(){this._updateDimensions()}},{key:"onDimensionsChanged",value:function(t,e){this.texture instanceof Uo&&(this.texture.w=t,this.texture.h=e,this.w=t,this.h=e)}},{key:"_updateDimensions",value:function(){var t=this._getRenderWidth(),e=this._getRenderHeight(),n=!1;t&&e||!this.__displayedTexture&&this.__texture&&(t=t||this.__texture.mw,e=e||this.__texture.mh,t&&e||!this.__texture.isAutosizeTexture()||(n=!0)),this.__core.setDimensions(t,e,n)&&this._onResize()}},{key:"_updateTextureCoords",value:function(){if(this.displayedTexture&&this.displayedTexture._source){var t=this.displayedTexture,e=this.displayedTexture._source,n=0,i=0,r=1,o=1;if(t.clipping){var s,a,u,l,h=e.getRenderWidth(),c=e.getRenderHeight();s=1/h,a=1/c,u=t.pw?t.pw*s:(h-t.px)*s,l=t.ph?t.ph*a:(c-t.py)*a,n=s*=t.px,i=a*=t.py,r=r*u+s,o=o*l+a,n=Math.max(0,n),i=Math.max(0,i),r=Math.min(1,r),o=Math.min(1,o)}if(e._flipTextureY){var f=o;o=i,i=f}this.__core.setTextureCoords(n,i,r,o)}}},{key:"getCornerPoints",value:function(){return this.__core.getCornerPoints()}},{key:"_unsetTagsParent",value:function(){var t=this;this.__tags&&this.__tags.forEach((function(e){for(var n=t;n=n.__parent;){if(n.__treeTags.get(e).delete(t),n.__tagRoot)break}}));var e=null,n=0;if(this.__treeTags&&!this.__tagRoot&&(n=(e=lo.iteratorToArray(this.__treeTags.keys())).length)>0)for(var i=0;i<n;i++)for(var r=this.__treeTags.get(e[i]),o=this,s=function(){var t=o.__treeTags.get(e[i]);if(r.forEach((function(e){t.delete(e)})),o.__tagRoot)return 1};(o=o.__parent)&&!s(););}},{key:"_setTagsParent",value:function(){var t=this;this.__tags&&this.__tags.forEach((function(e){for(var n=t;n=n.__parent;){n.__treeTags||(n.__treeTags=new Map);var i=n.__treeTags.get(e);if(i||(i=new Set,n.__treeTags.set(e,i)),i.add(t),n.__tagRoot)break}})),this.__treeTags&&this.__treeTags.size&&(this.__tagRoot||this.__treeTags.forEach((function(e,n){for(var i=t,r=function(){i.__tagRoot,i.__treeTags||(i.__treeTags=new Map);var t=i.__treeTags.get(n);t||(t=new Set,i.__treeTags.set(n,t)),e.forEach((function(e){t.add(e)}))};!i.__tagRoot&&(i=i.__parent);)r()})))}},{key:"_getByTag",value:function(t){if(!this.__treeTags)return[];var e=this.__treeTags.get(t);return e?lo.setToArray(e):[]}},{key:"getTags",value:function(){return this.__tags?this.__tags:[]}},{key:"setTags",value:function(t){t=t.reduce((function(t,e){return t.concat(e.split(" "))}),[]),this.__ref&&t.push(this.__ref);var e,n=t.length,i=[],r=[];for(e=0;e<n;e++)this.hasTag(t[e])||r.push(t[e]);var o=this.tags||[];for(n=o.length,e=0;e<n;e++)-1==t.indexOf(o[e])&&i.push(o[e]);for(e=0;e<i.length;e++)this.removeTag(i[e]);for(e=0;e<r.length;e++)this.addTag(r[e])}},{key:"addTag",value:function(t){if(-1===t.indexOf(" "))lo.isUcChar(t.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(t);else for(var e=t.split(" "),n=0,i=e.length;n<i;n++){var r=e[n];lo.isUcChar(r.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(r)}}},{key:"_addTag",value:function(t){if(this.__tags||(this.__tags=[]),-1===this.__tags.indexOf(t)){this.__tags.push(t);var e=this.__parent;if(e)do{e.__treeTags||(e.__treeTags=new Map);var n=e.__treeTags.get(t);n||(n=new Set,e.__treeTags.set(t,n)),n.add(this)}while(!e.__tagRoot&&(e=e.__parent))}}},{key:"removeTag",value:function(t){var e=this.__tags.indexOf(t);if(-1!==e){this.__tags.splice(e,1);var n=this.__parent;if(n)do{var i=n.__treeTags.get(t);i&&i.delete(this)}while(!n.__tagRoot&&(n=n.__parent))}}},{key:"hasTag",value:function(t){return this.__tags&&-1!==this.__tags.indexOf(t)}},{key:"_tag",value:function(t){if(-1!==t.indexOf("."))return this.mtag(t)[0];if(this.__treeTags){var e=this.__treeTags.get(t);if(e){var n=e.values().next();return n?n.value:void 0}}}},{key:"tag",get:function(){return this._tag},set:function(t){this.tags=t}},{key:"mtag",value:function(t){if(t.indexOf(".")>=0){for(var e=t.split("."),n=this._getByTag(e[0]),i=1,r=e.length;n.length&&i<r;){for(var o=[],s=0,a=n.length;s<a;s++)o=o.concat(n[s]._getByTag(e[i]));n=o,i++}return n}return this._getByTag(t)}},{key:"stag",value:function(t,e){for(var n=this.mtag(t),i=n.length,r=0;r<i;r++)ho.patchObject(n[r],e)}},{key:"tagRoot",get:function(){return this.__tagRoot},set:function(t){this.__tagRoot!==t&&(t?this._unsetTagsParent():this._setTagsParent(),this.__tagRoot=t)}},{key:"sel",value:function(t){var e=this.select(t);return e.length?e[0]:void 0}},{key:"select",value:function(t){if(-1!==t.indexOf(",")){for(var e=t.split(","),n=[],i=0;i<e.length;i++)n=n.concat(this._select(e[i]));return n}return this._select(t)}},{key:"_select",value:function(t){if(""===t)return[this];var e,n=t.indexOf("."),i=t.indexOf(">");return-1===n&&-1===i?this.mtag(t):(0===i?(e=!0,t=t.substr(1)):0===n?(e=!1,t=t.substr(1)):e=!1,this._selectChilds(t,e))}},{key:"_selectChilds",value:function(t,e){var n=t.indexOf("."),i=t.indexOf(">");if(-1===n&&-1===i){if(e){var r=this.getByRef(t);return r?[r]:[]}return this.mtag(t)}if(-1===i||-1!==n&&n<i){var o,s=t.substr(0,n);if(e){var a=this.getByRef(s);o=a?[a]:[]}else o=this.mtag(s);for(var u=[],l=t.substr(n+1),h=0,c=o.length;h<c;h++)u=u.concat(o[h]._selectChilds(l,!1));return u}var f,d=t.substr(0,i);if(e){var A=this.getByRef(d);f=A?[A]:[]}else f=this.mtag(d);for(var g=[],p=t.substr(i+1),v=0,_=f.length;v<_;v++)g=g.concat(f[v]._selectChilds(p,!0));return g}},{key:"getByRef",value:function(t){return this.childList.getByRef(t)}},{key:"getLocationString",value:function(){var t;t=this.__parent?this.__parent._children.getIndex(this):"R";var e=this.getTags(),n=this.__parent?this.__parent.getLocationString():"";return this.ref?n+=":["+t+"]"+this.ref:e.length?n+=":["+t+"]"+e.join(","):n+=":["+t+"]#"+this.id,n}},{key:"toString",value:function(){var e=this.getSettings();return t.getPrettyString(e,"")}},{key:"getSettings",value:function(){var t=this.getNonDefaults(),e=this._children.get();if(e){var n=e.length;if(n){for(var i=[],r=!1,o=0;o<n;o++)i.push(e[o].getSettings()),r=r||!e[o].ref;r?t.children=i:(t.children={},i.forEach((function(e){t.children[e.ref]=e})))}}return t.id=this.id,t}},{key:"getNonDefaults",value:function(){var e={};if(this.constructor!==t&&(e.type=this.constructor.name),this.__ref&&(e.ref=this.__ref),this.__tags&&this.__tags.length&&(e.tags=this.__tags),0!==this.x&&(e.x=this.x),0!==this.y&&(e.y=this.y),0!==this.w&&(e.w=this.w),0!==this.h&&(e.h=this.h),this.scaleX===this.scaleY?1!==this.scaleX&&(e.scale=this.scaleX):(1!==this.scaleX&&(e.scaleX=this.scaleX),1!==this.scaleY&&(e.scaleY=this.scaleY)),this.pivotX===this.pivotY?.5!==this.pivotX&&(e.pivot=this.pivotX):(.5!==this.pivotX&&(e.pivotX=this.pivotX),.5!==this.pivotY&&(e.pivotY=this.pivotY)),this.mountX===this.mountY?0!==this.mountX&&(e.mount=this.mountX):(0!==this.mountX&&(e.mountX=this.mountX),0!==this.mountY&&(e.mountY=this.mountY)),1!==this.alpha&&(e.alpha=this.alpha),this.visible||(e.visible=!1),0!==this.rotation&&(e.rotation=this.rotation),this.colorUl===this.colorUr&&this.colorBl===this.colorBr&&this.colorUl===this.colorBl?4294967295!==this.colorUl&&(e.color=this.colorUl.toString(16)):(4294967295!==this.colorUl&&(e.colorUl=this.colorUl.toString(16)),4294967295!==this.colorUr&&(e.colorUr=this.colorUr.toString(16)),4294967295!==this.colorBl&&(e.colorBl=this.colorBl.toString(16)),4294967295!==this.colorBr&&(e.colorBr=this.colorBr.toString(16))),this.zIndex&&(e.zIndex=this.zIndex),this.forceZIndexContext&&(e.forceZIndexContext=!0),this.clipping&&(e.clipping=this.clipping),this.clipbox||(e.clipbox=this.clipbox),this.__texture){var n=this.__texture.getNonDefaults();Object.keys(n).length&&(e.texture=n)}if(this.shader&&lo.isFunction(this.shader.getNonDefaults)){var i=this.shader.getNonDefaults();Object.keys(i).length&&(e.shader=i)}return this._hasTexturizer()&&(this.texturizer.enabled&&(e.renderToTexture=this.texturizer.enabled),this.texturizer.lazy&&(e.renderToTextureLazy=this.texturizer.lazy),this.texturizer.colorize&&(e.colorizeResultTexture=this.texturizer.colorize),this.texturizer.renderOffscreen&&(e.renderOffscreen=this.texturizer.renderOffscreen)),e}},{key:"withinBoundsMargin",get:function(){return this.__core._withinBoundsMargin}},{key:"_enableWithinBoundsMargin",value:function(){this.__enabled&&this._setActiveFlag()}},{key:"_disableWithinBoundsMargin",value:function(){this.__active&&this._unsetActiveFlag()}},{key:"boundsMargin",get:function(){return this.__core.boundsMargin},set:function(t){if(!Array.isArray(t)&&null!==t)throw new Error("boundsMargin should be an array of left-top-right-bottom values or null (inherit margin)");this.__core.boundsMargin=t}},{key:"x",get:function(){return this.__core.offsetX},set:function(t){this.__core.offsetX=t}},{key:"y",get:function(){return this.__core.offsetY},set:function(t){this.__core.offsetY=t}},{key:"w",get:function(){return this._w},set:function(t){lo.isFunction(t)?(this._w=0,this.__core.funcW=t):(t=Math.max(t,0),this._w!==t&&(this.__core.disableFuncW(),this._w=t,this._updateDimensions()))}},{key:"h",get:function(){return this._h},set:function(t){lo.isFunction(t)?(this._h=0,this.__core.funcH=t):(t=Math.max(t,0),this._h!==t&&(this.__core.disableFuncH(),this._h=t,this._updateDimensions()))}},{key:"collision",get:function(){return this._collision},set:function(t){this._collision=t}},{key:"_updateCollision",value:function(){this.collision&&this.__parent&&void 0===this.__parent.collision&&(this.__parent.collision=2)}},{key:"scaleX",get:function(){return this.__core.scaleX},set:function(t){this.__core.scaleX=t}},{key:"scaleY",get:function(){return this.__core.scaleY},set:function(t){this.__core.scaleY=t}},{key:"scale",get:function(){return this.__core.scale},set:function(t){this.__core.scale=t}},{key:"pivotX",get:function(){return this.__core.pivotX},set:function(t){this.__core.pivotX=t}},{key:"pivotY",get:function(){return this.__core.pivotY},set:function(t){this.__core.pivotY=t}},{key:"pivot",get:function(){return this.__core.pivot},set:function(t){this.__core.pivot=t}},{key:"mountX",get:function(){return this.__core.mountX},set:function(t){this.__core.mountX=t}},{key:"mountY",get:function(){return this.__core.mountY},set:function(t){this.__core.mountY=t}},{key:"mount",get:function(){return this.__core.mount},set:function(t){this.__core.mount=t}},{key:"rotation",get:function(){return this.__core.rotation},set:function(t){this.__core.rotation=t}},{key:"alpha",get:function(){return this.__core.alpha},set:function(t){this.__core.alpha=t}},{key:"visible",get:function(){return this.__core.visible},set:function(t){this.__core.visible=t}},{key:"colorUl",get:function(){return this.__core.colorUl},set:function(t){this.__core.colorUl=t}},{key:"colorUr",get:function(){return this.__core.colorUr},set:function(t){this.__core.colorUr=t}},{key:"colorBl",get:function(){return this.__core.colorBl},set:function(t){this.__core.colorBl=t}},{key:"colorBr",get:function(){return this.__core.colorBr},set:function(t){this.__core.colorBr=t}},{key:"color",get:function(){return this.__core.colorUl},set:function(t){this.colorUl===t&&this.colorUr===t&&this.colorBl===t&&this.colorBr===t||(this.colorUl=t,this.colorUr=t,this.colorBl=t,this.colorBr=t)}},{key:"colorTop",get:function(){return this.colorUl},set:function(t){this.colorUl===t&&this.colorUr===t||(this.colorUl=t,this.colorUr=t)}},{key:"colorBottom",get:function(){return this.colorBl},set:function(t){this.colorBl===t&&this.colorBr===t||(this.colorBl=t,this.colorBr=t)}},{key:"colorLeft",get:function(){return this.colorUl},set:function(t){this.colorUl===t&&this.colorBl===t||(this.colorUl=t,this.colorBl=t)}},{key:"colorRight",get:function(){return this.colorUr},set:function(t){this.colorUr===t&&this.colorBr===t||(this.colorUr=t,this.colorBr=t)}},{key:"zIndex",get:function(){return this.__core.zIndex},set:function(t){this.__core.zIndex=t}},{key:"forceZIndexContext",get:function(){return this.__core.forceZIndexContext},set:function(t){this.__core.forceZIndexContext=t}},{key:"clipping",get:function(){return this.__core.clipping},set:function(t){this.__core.clipping=t}},{key:"clipbox",get:function(){return this.__core.clipbox},set:function(t){this.__core.clipbox=t}},{key:"tags",get:function(){return this.getTags()},set:function(t){Array.isArray(t)||(t=[t]),this.setTags(t)}},{key:"t",set:function(t){this.tags=t}},{key:"_children",get:function(){return this.__childList||(this.__childList=new Go(this,!1)),this.__childList}},{key:"childList",get:function(){return this._allowChildrenAccess()||this._throwError("Direct access to children is not allowed in "+this.getLocationString()),this._children}},{key:"hasChildren",value:function(){return this._allowChildrenAccess()&&this.__childList&&this.__childList.length>0}},{key:"_allowChildrenAccess",value:function(){return!0}},{key:"children",get:function(){return this.childList.get()},set:function(t){this.childList.patch(t)}},{key:"add",value:function(t){return this.childList.a(t)}},{key:"p",get:function(){return this.__parent}},{key:"parent",get:function(){return this.__parent}},{key:"src",get:function(){return this.texture&&this.texture instanceof Po?this.texture._src:void 0},set:function(t){var e=new Po(this.stage);e.src=t,this.texture=e}},{key:"mw",set:function(t){this.texture?(this.texture.mw=t,this._updateDimensions()):this._throwError("Please set mw after setting a texture.")}},{key:"mh",set:function(t){this.texture?(this.texture.mh=t,this._updateDimensions()):this._throwError("Please set mh after setting a texture.")}},{key:"rect",get:function(){return this.texture===this.stage.rectangleTexture},set:function(t){this.texture=t?this.stage.rectangleTexture:null}},{key:"enableTextTexture",value:function(){return this.texture&&this.texture instanceof Uo||(this.texture=new Uo(this.stage),this.texture.w||this.texture.h||(this.texture.w=this.w,this.texture.h=this.h)),this.texture}},{key:"text",get:function(){return this.texture&&this.texture instanceof Uo?this.texture:null},set:function(t){this.texture&&this.texture instanceof Uo||this.enableTextTexture(),lo.isString(t)?this.texture.text=t:this.texture.patch(t)}},{key:"onUpdate",set:function(t){this.__core.onUpdate=t}},{key:"onAfterCalcs",set:function(t){this.__core.onAfterCalcs=t}},{key:"onAfterUpdate",set:function(t){this.__core.onAfterUpdate=t}},{key:"forceUpdate",value:function(){this.__core._setHasUpdates()}},{key:"shader",get:function(){return this.__core.shader},set:function(t){if(lo.isObjectLiteral(t)&&!t.type)this.shader&&this.shader.patch(t);else{var e=Ro.create(this.stage,t);this.__enabled&&this.__core.shader&&this.__core.shader.removeElement(this.__core),this.__core.shader=e,this.__enabled&&this.__core.shader&&this.__core.shader.addElement(this.__core)}}},{key:"_hasTexturizer",value:function(){return!!this.__core._texturizer}},{key:"renderToTexture",get:function(){return this.rtt},set:function(t){this.rtt=t}},{key:"rtt",get:function(){return this._hasTexturizer()&&this.texturizer.enabled},set:function(t){this.texturizer.enabled=t}},{key:"rttLazy",get:function(){return this._hasTexturizer()&&this.texturizer.lazy},set:function(t){this.texturizer.lazy=t}},{key:"renderOffscreen",get:function(){return this._hasTexturizer()&&this.texturizer.renderOffscreen},set:function(t){this.texturizer.renderOffscreen=t}},{key:"colorizeResultTexture",get:function(){return this._hasTexturizer()&&this.texturizer.colorize},set:function(t){this.texturizer.colorize=t}},{key:"getTexture",value:function(){return this.texturizer._getTextureSource()}},{key:"texturizer",get:function(){return this.__core.texturizer}},{key:"patch",value:function(t){for(var e=Object.keys(t),n=0,i=e.length;n<i;n++){var r=e[n],o=t[r],s=r.charCodeAt(0);if(lo.isUcChar(s)){var a=this.getByRef(r);if(a)void 0===o?a.parent&&a.parent.childList.remove(a):lo.isObjectLiteral(o)?a.patch(o):o.isElement?(o.ref=r,this.childList.replace(o,a)):this._throwError("Unexpected value for path: "+r);else if(void 0!==o){var u=void 0;lo.isObjectLiteral(o)?(u=this.childList.createItem(o)).patch(o):lo.isObject(o)&&(u=o),u.isElement&&(u.ref=r),this.childList.a(u)}}else ho.patchObjectProperty(this,r,o)}}},{key:"_throwError",value:function(t){throw new Error(this.constructor.name+" ("+this.getLocationString()+"): "+t)}},{key:"animation",value:function(t){return this.stage.animations.createAnimation(this,t)}},{key:"transition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===e?this._getTransition(t):(this._setTransition(t,e),null)}},{key:"transitions",set:function(t){var e=this;Object.keys(t).forEach((function(n){e.transition(n,t[n])}))}},{key:"smooth",set:function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n];Array.isArray(i)?e.setSmooth(n,i[0],i[1]):e.setSmooth(n,i)}))}},{key:"fastForward",value:function(t){if(this._transitions){var e=this._transitions[t];e&&e.isTransition&&e.finish()}}},{key:"_getTransition",value:function(t){this._transitions||(this._transitions={});var e=this._transitions[t];return e?e.isTransitionSettings&&(e=new Wo(this.stage.transitions,e,this,t)):e=new Wo(this.stage.transitions,this.stage.transitions.defaultTransitionSettings,this,t),this._transitions[t]=e,e}},{key:"_setTransition",value:function(t,e){if(e){lo.isObjectLiteral(e)&&(e=this.stage.transitions.createSettings(e)),this._transitions||(this._transitions={});var n=this._transitions[t];if(n&&n.isTransition)return n.settings=e,n;this._transitions[t]=e}else this._removeTransition(t)}},{key:"_removeTransition",value:function(t){this._transitions&&delete this._transitions[t]}},{key:"getSmooth",value:function(t,e){var n=this._getTransition(t);return n&&n.isAttached()?n.targetValue:e}},{key:"setSmooth",value:function(t,e,n){n&&this._setTransition(t,n);var i=this._getTransition(t);return i.start(e),i}},{key:"flex",get:function(){return this.__core.flex},set:function(t){this.__core.flex=t}},{key:"flexItem",get:function(){return this.__core.flexItem},set:function(t){this.__core.flexItem=t}},{key:"toJSON",value:function(){var e=["".concat(this.constructor.name)],n={};return n[e]={},this.hasChildren()?t.collectChildren(n[e],this.__childList):n[e]=m({},t.getProperties(this)),n}}],[{key:"getPrettyString",value:function(e,n){var i=e.children;delete e.children;var r=["color","colorUl","colorUr","colorBl","colorBr"],o=JSON.stringify(e,(function(t,e){return-1!==r.indexOf(t)?"COLOR["+e.toString(16)+"]":e}));if(o=o.replace(/"COLOR\[([a-f0-9]{1,8})\]"/g,"0x$1"),i){var s="";if(lo.isObjectLiteral(i)){var a=Object.keys(i);s="";for(var u=0,l=a.length;u<l;u++)s+="\n".concat(n,'  "').concat(a[u],'":'),delete i[a[u]].ref,s+=t.getPrettyString(i[a[u]],n+"  ")+(u<l-1?",":"");var h="{}"===o;o=o.substr(0,o.length-1)+(h?"":",")+s+"\n"+n+"}"}else{var c=i.length;s="[";for(var f=0;f<c;f++)s+=t.getPrettyString(i[f],n+"  ")+(f<c-1?",":"")+"\n";s+=n+"]}";var d="{}"===o;o=o.substr(0,o.length-1)+(d?"":",")+'"children":\n'+n+s+"}"}}return o}},{key:"getGetter",value:function(e){var n=t.PROP_GETTERS.get(e);return n||(n=new Function("obj","return obj."+e),t.PROP_GETTERS.set(e,n)),n}},{key:"getSetter",value:function(e){var n=t.PROP_SETTERS.get(e);return n||(n=new Function("obj","v","obj."+e+" = v"),t.PROP_SETTERS.set(e,n)),n}},{key:"isColorProperty",value:function(t){return t.toLowerCase().indexOf("color")>=0}},{key:"getMerger",value:function(e){return t.isColorProperty(e)?uo.mergeColors:uo.mergeNumbers}},{key:"collectChildren",value:function(t,e){for(var n=e,i=0,r=n.length;i<r;i++){var o=n.getAt(i),s="".concat(o.__ref||"Element-".concat(o.id)),a=this.getProperties(o);t[s]=m({},a),o.hasChildren()&&(t[s].children={},this.collectChildren(t[s].children,o.__childList))}}},{key:"getProperties",value:function(t){for(var e={},n=["alpha","active","attached","boundsMargin","color","clipping","enabled","h","id","isComponent","mount","mountY","mountX","pivot","pivotX","pivotY","ref","renderOffscreen","renderToTexture","scale","scaleX","scaleY","state","tag","visible","w","x","y","zIndex","!!flex","!!flexItem","hasFocus()","hasFinalFocus()"],i=n.length;i--;){var r=n[i];/^!{2}/.test(r)?e[r=r.substring(2,r.length)]=!!t[r]:/\(\)$/.test(r)?"function"==typeof t[r=r.substring(0,r.length-2)]&&(e[r]=t[r]()):e[r]=t[r]}return m(m({},e),t.getNonDefaults())}}]),t}();Lo.addAsMixin(Yo),Yo.prototype.isElement=1,Yo.id=1,Yo.PROP_GETTERS=new Map,Yo.PROP_SETTERS=new Map;var Xo=function(){function t(){_(this,t),t.setupStateMachine(this)}return v(t,[{key:"fire",value:function(t){if(this._hasMethod(t)){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this[t].apply(this,n)}}},{key:"_getState",value:function(){return this._state.__path}},{key:"_inState",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._state.__path,i=this._sm.getStateByPath(e),r=this._sm.getStateByPath(n),o=i.__level;return t._getStateAtLevel(r,o)===i}},{key:"_hasMember",value:function(t){return!!this.constructor.prototype[t]}},{key:"_hasMethod",value:function(t){var e=this.constructor.prototype[t];return!!e&&"function"==typeof e}},{key:"_setState",value:function(e,n){var i=++this._setStateCounter;if(this._setStateId=i,this._state.__path!==e){var r=this._sm._stateMap[e];r||(r=this._sm.getStateByPath(e));var o=this._state,s=r.prototype.$enter!==this._state.prototype.$enter,a=r.prototype.$exit!==this._state.prototype.$exit;if(s||a){var u=t._getSharedState(this._state,r),l={newState:r.__path,prevState:o.__path,sharedState:u.__path},h=u.__level;if(a)for(var c=t._getStatesUntilLevel(this._state,h),f=0,d=c.length;f<d;f++){if(this.__setState(c[f]),this._callExit(this._state,n,l),this._setStateId!==i)return}if(s)for(var A=t._getStatesUntilLevel(r,h).reverse(),g=0,p=A.length;g<p;g++){if(this.__setState(A[g]),this._callEnter(this._state,n,l),this._setStateId!==i)return}}if(this.__setState(r),this._changedState){var v={newState:r.__path,prevState:o.__path};n?this._changedState.apply(this,[v].concat(y(n))):this._changedState(v)}if(this._onStateChange){var _={newState:r.__path,prevState:o.__path};this._onStateChange(_)}}}},{key:"_callEnter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=!!t.__parent;t.prototype.$enter&&(i&&t.__parent.prototype.$enter===t.prototype.$enter||t.prototype.$enter.apply(this,[n].concat(y(e))))}},{key:"_callExit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=!!t.__parent;t.prototype.$exit&&(i&&t.__parent.prototype.$exit===t.prototype.$exit||t.prototype.$exit.apply(this,[n].concat(y(e))))}},{key:"__setState",value:function(t){this._state=t,this._stateIndex=t.__index,this.constructor=t}},{key:"_initStateMachine",value:function(){this._state=null,this._stateIndex=0,this._setStateCounter=0,this._sm=this._routedType._sm,this.__setState(this._sm.getStateByPath(""));var t={newState:"",prevState:void 0,sharedState:void 0};this._callEnter(this._state,[],t),this._onStateChange=void 0}},{key:"_getMostSpecificHandledMember",value:function(t){var e=this._state;do{for(var n=0,i=t.length;n<i;n++){var r=t[n];if(e.__parent){if(this[Vo.getStateMemberAlias(e.__path,r)])return r}else if(e.prototype[r])return r}e=e.__parent}while(e)}}],[{key:"setupStateMachine",value:function(e){var n=e.constructor,i=t.create(n);Object.setPrototypeOf(e,i.prototype),e.constructor=n,e._initStateMachine()}},{key:"create",value:function(t){if(!t.hasOwnProperty("_sm")){var e=new Vo(t);t._sm=e}return t._sm.router}},{key:"_getStatesUntilLevel",value:function(t,e){for(var n=[];t.__level>e;)n.push(t),t=t.__parent;return n}},{key:"_getSharedState",value:function(e,n){for(var i=t._getAncestorStates(e),r=t._getAncestorStates(n),o=Math.min(i.length,r.length),s=0;s<o;s++)if(i[s]!==r[s])return i[s-1];return i[o-1]}},{key:"_getAncestorStates",value:function(t){var e=[];do{e.push(t)}while(t=t.__parent);return e.reverse()}},{key:"_getStateAtLevel",value:function(t,e){if(!(e>t.__level)){for(;e<t.__level;)t=t.__parent;return t}}}]),t}(),Vo=function(){function t(e){_(this,t),this._type=e,this._router=null,this.init()}return v(t,[{key:"router",get:function(){return this._router}},{key:"init",value:function(){this._router=this._createRouter(),this._stateMap=this._getStateMap(),this._addStateMemberDelegatorsToRouter()}},{key:"_createRouter",value:function(){var t=this._type,e=function(e){l(i,e);var n=c(i);function i(){var e;if(_(this,i),!(e=n.apply(this,arguments)).constructor.hasOwnProperty("_isRouter"))throw new Error("You need to extend ".concat(t.name,".original instead of ").concat(t.name,"."));return e}return v(i)}(t);return e._isRouter=!0,e.prototype._routedType=t,e.original=t,this._mixinStateMachineMethods(e),e}},{key:"_mixinStateMachineMethods",value:function(t){for(var e=Object.getOwnPropertyNames(Xo.prototype),n=0,i=e.length;n<i;n++){var r=e[n];if("constructor"!==r){var o=Object.getOwnPropertyDescriptor(Xo.prototype,r);Object.defineProperty(t.prototype,r,o)}}}},{key:"_addStateMemberDelegatorsToRouter",value:function(){var t=this;this._getAllMemberNames().forEach((function(e){t._addMemberRouter(e)}))}},{key:"_addMemberRouter",value:function(e){var n=this,i=Object.keys(this._stateMap),r=[],o=[];i.forEach((function(i,s){var a=n._stateMap[i],u=n._getDescriptor(a,e);if(u){r[s]=u;var l=t.getStateMemberAlias(u._source.__path,e);o[s]=l,n._router.prototype.hasOwnProperty(l)||Object.defineProperty(n._router.prototype,l,u)}else r[s]=null,o[s]=null}));var s=void 0;switch(r.forEach((function(t){if(t){var i=n._getDescriptorType(t);if(s&&s!==i)return void console.warn("[Lightning] Member ".concat(e," in ").concat(n._type.name," has inconsistent types."));s=i}})),s){case"method":this._addMethodRouter(e,r,o);break;case"getter":this._addGetterSetterRouters(e);break;case"property":console.warn("[Lightning] Fixed properties are not supported; please use a getter instead!")}}},{key:"_getDescriptor",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0},i=t,r=t;do{var o=Object.getOwnPropertyDescriptor(i.prototype,e);if(o&&n(o))return o._source=r,o;(i=Object.getPrototypeOf(i))&&i.hasOwnProperty("__state")&&(r=i)}while(i&&i.prototype)}},{key:"_getDescriptorType",value:function(t){return t.get||t.set?"getter":"function"==typeof t.value?"method":"property"}},{key:"_addMethodRouter",value:function(e,n,i){for(var r=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],o=i[0],s=t._supportsSpread(),a=1,u=i.length;a<u;a++){var l=i[a];l!==o&&(o?s?r.push("if (i < ".concat(a,') return this["').concat(o,'"](...arguments); else')):r.push("if (i < ".concat(a,') return this["').concat(o,'"].apply(this, arguments); else')):r.push("if (i < ".concat(a,") return ; else"))),o=l}o?s?r.push('return this["'.concat(o,'"](...arguments);')):r.push('return this["'.concat(o,'"].apply(this, arguments);')):r.push(";");var h=r.join("\n"),c={value:new Function([],h)};Object.defineProperty(this._router.prototype,e,c)}},{key:"_addGetterSetterRouters",value:function(t){var e={get:this._getGetterRouter(t),set:this._getSetterRouter(t)};Object.defineProperty(this._router.prototype,t,e)}},{key:"_getGetterRouter",value:function(e){var n=this,i=Object.keys(this._stateMap),r=[];i.forEach((function(i,o){var s=n._stateMap[i],a=n._getDescriptor(s,e,(function(t){return t.get}));if(a){var u=t.getStateMemberAlias(a._source.__path,e);r[o]=u,n._router.prototype.hasOwnProperty(u)||Object.defineProperty(n._router.prototype,u,a)}else r[o]=null}));for(var o=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],s=r[0],a=1,u=r.length;a<u;a++){var l=r[a];l!==s&&(s?o.push("if (i < ".concat(a,') return this["').concat(s,'"]; else')):o.push("if (i < ".concat(a,") return ; else"))),s=l}s?o.push('return this["'.concat(s,'"];')):o.push(";");var h=o.join("\n");return new Function([],h)}},{key:"_getSetterRouter",value:function(e){var n=this,i=Object.keys(this._stateMap),r=[];i.forEach((function(i,o){var s=n._stateMap[i],a=n._getDescriptor(s,e,(function(t){return t.set}));if(a){var u=t.getStateMemberAlias(a._source.__path,e);r[o]=u,n._router.prototype.hasOwnProperty(u)||Object.defineProperty(n._router.prototype,u,a)}else r[o]=null}));for(var o=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],s=r[0],a=1,u=r.length;a<u;a++){var l=r[a];l!==s&&(s?o.push("if (i < ".concat(a,') this["').concat(s,'"] = arg; else')):o.push("if (i < ".concat(a,") ; else"))),s=l}s?o.push('this["'.concat(s,'"] = arg;')):o.push(";");var h=o.join("\n");return new Function(["arg"],h)}},{key:"_getAllMemberNames",value:function(){var t=this,e=this._stateMap,n=Object.keys(e),i=new Set;return n.forEach((function(n){if(""!==n){var r=e[n];t._getStateMemberNames(r).forEach((function(t){i.add(t)}))}})),y(i)}},{key:"_getStateMemberNames",value:function(t){var e=t,n=new Set,i=this._type===t;do{this._getStateMemberNamesForType(e).forEach((function(t){n.add(t)})),e=Object.getPrototypeOf(e)}while(e&&e.prototype&&(!e.hasOwnProperty("__state")||i));return n}},{key:"_getStateMemberNamesForType",value:function(e){return Object.getOwnPropertyNames(e.prototype).filter((function(e){return"constructor"!==e&&!t._isStateLocalMember(e)}))}},{key:"getStateByPath",value:function(t){if(this._stateMap[t])return this._stateMap[t];for(var e=t.split(".");e.pop();){var n=e.join(".");if(this._stateMap[n])return this._stateMap[n]}}},{key:"_getStateMap",value:function(){return this._stateMap||(this._stateMap=this._createStateMap()),this._stateMap}},{key:"_createStateMap",value:function(){var t={};return this._addState(this._type,null,"",t),t}},{key:"_addState",value:function(e,n,i,r){var o=this;e.__state=!0,e.__name=i,this._addStaticStateProperty(e,n);var s=n?n.__path:"",a=(s?s+".":"")+i;e.__path=a,e.__level=n?n.__level+1:0,e.__parent=n,e.__index=Object.keys(r).length,r[a]=e;var u=e._states;u&&(n&&n._states===u||e._states().forEach((function(n){var i=t._getStateName(n);o._addState(n,e,i,r)})))}},{key:"_addStaticStateProperty",value:function(t,e){e&&(e&&!e.__parent?this._router[t.__name]=t:e[t.__name]=t)}}],[{key:"_supportsSpread",value:function(){if(void 0===this.__supportsSpread){this.__supportsSpread=!1;try{new Function("return [].concat(...arguments);")(),this.__supportsSpread=!0}catch(t){}}return this.__supportsSpread}},{key:"getStateMemberAlias",value:function(t,e){return"$"+(t?t+".":"")+e}},{key:"_isStateLocalMember",value:function(t){return"$enter"===t||"$exit"===t}},{key:"_getStateName",value:function(t){var e=t.name,n=e.indexOf("$");return n>0?e.substr(0,n):e}}]),t}(),Zo=function(t){l(n,t);var e=c(n);function n(t,i){var r;_(this,n),(r=e.call(this,t)).tagRoot=!0,lo.isObjectLiteral(i)&&Object.assign(d(r),i),r.__initialized=!1,r.__firstActive=!1,r.__firstEnable=!1,r.__signals=void 0,r.__passSignals=void 0,r.__construct();var o=r.constructor.getTemplateFunc(d(r));return o.f(d(r),o.a),r._build(),r}return v(n,[{key:"__start",value:function(){Xo.setupStateMachine(this),this._onStateChange=n.prototype.__onStateChange}},{key:"state",get:function(){return this._getState()}},{key:"__onStateChange",value:function(){this.application&&this.application.updateFocusPath()}},{key:"_refocus",value:function(){this.application&&this.application.updateFocusPath()}},{key:"__bindProperty",value:function(t,e,n){for(var i=this,r=e,o=n,s=Array.isArray(t.__name)?t.__name:[t.__name],a=function(){var e=s[u],n=t.__func?t.__func:function(t){return t[e]};i.hasOwnProperty(e)?i["__prop_bindings_".concat(e)].push({__obj:r,__prop:o,__func:n}):(i["__prop_bindings_".concat(e)]=[{__obj:r,__prop:o,__func:n}],Object.defineProperty(i,e,{set:function(t){i["__prop_".concat(e)]=t;var n,r=w(i["__prop_bindings_".concat(e)]);try{for(r.s();!(n=r.n()).done;){var o=n.value,s=o.__obj,a=o.__prop,u=o.__func;s[a]=u(i)}}catch(l){r.e(l)}finally{r.f()}},get:function(){return i["__prop_".concat(e)]}}))},u=0;u<s.length;u++)a()}},{key:"_onSetup",value:function(){this.__initialized||this._setup()}},{key:"_setup",value:function(){}},{key:"_onAttach",value:function(){this.__initialized||(this.__init(),this.__initialized=!0),this._attach()}},{key:"_attach",value:function(){}},{key:"_onDetach",value:function(){this._detach()}},{key:"_detach",value:function(){}},{key:"_onEnabled",value:function(){this.__firstEnable||(this._firstEnable(),this.__firstEnable=!0),this._enable()}},{key:"_firstEnable",value:function(){}},{key:"_enable",value:function(){}},{key:"_onDisabled",value:function(){this._disable()}},{key:"_disable",value:function(){}},{key:"_onActive",value:function(){this.__firstActive||(this._firstActive(),this.__firstActive=!0),this._active()}},{key:"_firstActive",value:function(){}},{key:"_active",value:function(){}},{key:"_onInactive",value:function(){this._inactive()}},{key:"_inactive",value:function(){}},{key:"application",get:function(){return this.stage.application}},{key:"__construct",value:function(){this._construct()}},{key:"_construct",value:function(){}},{key:"_build",value:function(){}},{key:"__init",value:function(){this._init()}},{key:"_init",value:function(){}},{key:"_focus",value:function(t,e){}},{key:"_unfocus",value:function(t){}},{key:"_focusChange",value:function(t,e){}},{key:"_getFocused",value:function(){return this}},{key:"_setFocusSettings",value:function(t){}},{key:"_handleFocusSettings",value:function(t){}},{key:"hasFinalFocus",value:function(){var t=this.application._focusPath;return t&&t.length&&t[t.length-1]===this}},{key:"hasFocus",value:function(){var t=this.application._focusPath;return t&&t.indexOf(this)>=0}},{key:"cparent",get:function(){return n.getParent(this)}},{key:"seekAncestorByType",value:function(t){for(var e=this.cparent;e;){if(e.constructor===t)return e;e=e.cparent}}},{key:"getSharedAncestorComponent",value:function(t){for(var e=this.getSharedAncestor(t);e&&!e.isComponent;)e=e.parent;return e}},{key:"signals",get:function(){return this.__signals},set:function(t){lo.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals=t}},{key:"alterSignals",set:function(t){for(var e in lo.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals||(this.__signals={}),t){void 0===t[e]?delete this.__signals[e]:this.__signals[e]=t}}},{key:"passSignals",get:function(){return this.__passSignals||{}},set:function(t){this.__passSignals=Object.assign(this.__passSignals||{},t)}},{key:"alterPassSignals",set:function(t){for(var e in lo.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__passSignals||(this.__passSignals={}),t){void 0===t[e]?delete this.__passSignals[e]:this.__passSignals[e]=t}}},{key:"signal",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._signal(t,n)}},{key:"_signal",value:function(t,e){var n=this._getParentSignalHandler();if(n){if(this.__signals){var i=this.__signals[t];if(!1===i)return;if(i){if(!0===i&&(i=t),lo.isFunction(i))return i.apply(void 0,y(e));if(n._hasMethod(i))return n[i].apply(n,y(e))}}var r=this.__passSignals&&this.__passSignals[t];if(r)return r&&!0!==r&&(t=r),n._signal(t,e)}}},{key:"_getParentSignalHandler",value:function(){return this.cparent?this.cparent._getSignalHandler():null}},{key:"_getSignalHandler",value:function(){return this._signalProxy?this.cparent?this.cparent._getSignalHandler():null:this}},{key:"_signalProxy",get:function(){return!1}},{key:"fireAncestors",value:function(t){if(!t.startsWith("$"))throw new Error("Ancestor event name must be prefixed by dollar sign.");var e=this._getParentSignalHandler();if(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return e._doFireAncestors(t,i)}}},{key:"_doFireAncestors",value:function(t,e){if(this._hasMethod(t))return this.fire.apply(this,[t].concat(y(e)));var n=this._getParentSignalHandler();return n?n._doFireAncestors(t,e):void 0}}],[{key:"bindProp",value:function(t){return{__propertyBinding:!0,__name:t,__func:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null}}},{key:"getTemplateFunc",value:function(t){var e="_templateFunc",n="__has"+e;return this[n]!==this&&(this[n]=this,this[e]=this.parseTemplate(this._template(t))),this[e]}},{key:"parseTemplate",value:function(t){var e={loc:[],store:[],rid:0};this.parseTemplateRec(t,e,"element");var n=e.loc.join(";\n");return{f:new Function("element","store",n),a:e.store}}},{key:"parseTemplateRec",value:function(t,e,n){var i=this,r=e.store,o=e.loc;Object.keys(t).forEach((function(s){var a=t[s];if(lo.isUcChar(s.charCodeAt(0)))if(lo.isObjectLiteral(a)){var u="r".concat(s.replace(/[^a-z0-9]/gi,"")+e.rid),l=a.type?a.type:Yo;l===Yo?o.push("var ".concat(u," = element.stage.createElement()")):(r.push(l),o.push("var ".concat(u," = new store[").concat(r.length-1,"](").concat(n,".stage)"))),o.push("".concat(u,'.ref = "').concat(s,'"')),e.rid++,i.parseTemplateRec(a,e,u),o.push("".concat(n,".childList.add(").concat(u,")"))}else lo.isObject(a)&&(r.push(a),o.push("".concat(n,".childList.add(store[").concat(r.length-1,"])")));else if("text"===s){var h=n+"__text";o.push("var ".concat(h," = ").concat(n,".enableTextTexture()")),!0===a.__propertyBinding?(r.push(a),o.push("element.__bindProperty(store[".concat(r.length-1,"], ").concat(n,', "').concat(s,'")'))):i.parseTemplatePropRec(a,e,h)}else if("shader"===s&&lo.isObjectLiteral(a)){var c="".concat(n,'["shader"]');r.push(a),o.push("".concat(n,'["').concat(s,'"] = store[').concat(r.length-1,"]")),i.parsePropertyBindings(a,e,c)}else if("texture"===s&&lo.isObjectLiteral(a)){var f=n+"__texture",d=a.type;d?(r.push(d),o.push("var ".concat(f," = new store[").concat(r.length-1,"](").concat(n,".stage)")),i.parseTemplatePropRec(a,e,f),o.push("".concat(n,'["').concat(s,'"] = ').concat(f))):(o.push("".concat(f," = ").concat(n,".texture")),i.parseTemplatePropRec(a,e,f))}else lo.isObjectLiteral(a)&&!0===a.__propertyBinding?(r.push(a),o.push("element.__bindProperty(store[".concat(r.length-1,"], ").concat(n,', "').concat(s,'")'))):lo.isNumber(a)?o.push("".concat(n,'["').concat(s,'"] = ').concat(a)):lo.isBoolean(a)?o.push("".concat(n,'["').concat(s,'"] = ').concat(a?"true":"false")):lo.isObject(a)||Array.isArray(a)?(r.push(a),o.push("".concat(n,'["').concat(s,'"] = store[').concat(r.length-1,"]"))):o.push("".concat(n,'["').concat(s,'"] = ').concat(JSON.stringify(a)))}))}},{key:"parseTemplatePropRec",value:function(t,e,n){var i=e.store,r=e.loc;Object.keys(t).forEach((function(e){if("type"!==e){var o=t[e];lo.isNumber(o)?r.push("".concat(n,'["').concat(e,'"] = ').concat(o)):lo.isBoolean(o)?r.push("".concat(n,'["').concat(e,'"] = ').concat(o?"true":"false")):lo.isObject(o)&&!0===o.__propertyBinding?(i.push(o),r.push("element.__bindProperty(store[".concat(i.length-1,"], ").concat(n,', "').concat(e,'")'))):lo.isObject(o)||Array.isArray(o)?(i.push(o),r.push("".concat(n,'["').concat(e,'"] = store[').concat(i.length-1,"]"))):r.push("".concat(n,'["').concat(e,'"] = ').concat(JSON.stringify(o)))}}))}},{key:"parsePropertyBindings",value:function(t,e,n){var i=e.store,r=e.loc;Object.keys(t).forEach((function(e){if("type"!==e){var o=t[e];lo.isObjectLiteral(o)&&!0===o.__propertyBinding&&(i.push(o),r.push("element.__bindProperty(store[".concat(i.length-1,"], ").concat(n,', "').concat(e,'")')))}}))}},{key:"_template",value:function(){return{}}},{key:"collectSubComponents",value:function(t,e){if(e.hasChildren())for(var i=e.__childList,r=0,o=i.length;r<o;r++){var s=i.getAt(r);s.isComponent?t.push(s):n.collectSubComponents(t,s)}}},{key:"getComponent",value:function(t){for(var e=t;e&&!e.isComponent;)e=e.parent;return e}},{key:"getParent",value:function(t){return n.getComponent(t.parent)}}]),n}(Yo);Zo.prototype.isComponent=!0;var qo=function(){function t(e){_(this,t),this.ctx=e,this.quadTextures=[],this.quadElements=[]}return v(t,[{key:"length",get:function(){return this.quadTextures.length}},{key:"reset",value:function(){this.quadTextures=[],this.quadElements=[],this.dataLength=0}},{key:"getElement",value:function(t){return this.quadElements[t]._element}},{key:"getElementCore",value:function(t){return this.quadElements[t]}},{key:"getTexture",value:function(t){return this.quadTextures[t]}},{key:"getTextureWidth",value:function(t){var e=this.quadTextures[t];return e.w?e.w:this.quadElements[t]._displayedTextureSource.w}},{key:"getTextureHeight",value:function(t){var e=this.quadTextures[t];return e.h?e.h:this.quadElements[t]._displayedTextureSource.h}}]),t}(),Ko=function(t){l(n,t);var e=c(n);function n(t){var i;_(this,n),i=e.call(this,t);var r=t.stage.getOption("bufferMemory");return i.dataLength=0,i.data=new ArrayBuffer(r),i.floats=new Float32Array(i.data),i.uints=new Uint32Array(i.data),i}return v(n,[{key:"getAttribsDataByteOffset",value:function(t){return 80*t}},{key:"getQuadContents",value:function(){for(var t=this.floats,e=this.uints,n=[],i=1;i<=this.length;i++){for(var r="entry "+i+": ",o=0;o<4;o++){var s=20*i+4*o;r+=t[s]+","+t[s+1]+":"+t[s+2]+","+t[s+3]+"["+e[s+4].toString(16)+"] "}n.push(r)}return n}}]),n}(qo),Jo=function(){function t(e,n,i,r,o,s){_(this,t),this.ctx=e,this.shader=n,this.shaderOwner=i,this.renderTextureInfo=r,this.scissor=o,this.index=s,this.length=0}return v(t,[{key:"quads",get:function(){return this.ctx.renderState.quads}},{key:"getTexture",value:function(t){return this.quads.getTexture(this.index+t)}},{key:"getElementCore",value:function(t){return this.quads.getElementCore(this.index+t)}},{key:"getElement",value:function(t){return this.quads.getElement(this.index+t)}},{key:"getElementWidth",value:function(t){return this.getElement(t).renderWidth}},{key:"getElementHeight",value:function(t){return this.getElement(t).renderHeight}},{key:"getTextureWidth",value:function(t){return this.quads.getTextureWidth(this.index+t)}},{key:"getTextureHeight",value:function(t){return this.quads.getTextureHeight(this.index+t)}},{key:"getRenderWidth",value:function(){return this.renderTextureInfo?this.renderTextureInfo.w:this.ctx.stage.w}},{key:"getRenderHeight",value:function(){return this.renderTextureInfo?this.renderTextureInfo.h:this.ctx.stage.h}}]),t}(),$o=function(t){l(n,t);var e=c(n);function n(t,i,r,o,s,a){var u;return _(this,n),(u=e.call(this,t,i,r,o,s,a)).extraAttribsDataByteOffset=0,u}return v(n,[{key:"getAttribsDataByteOffset",value:function(t){return this.quads.getAttribsDataByteOffset(this.index+t)}},{key:"getNormalRenderTextureCoords",value:function(t,e){var n=this.shaderOwner.getRenderTextureCoords(t,e);return n[0]/=this.getRenderWidth(),n[1]/=this.getRenderHeight(),n[0]=2*n[0]-1,n[1]=1-2*n[1],n}},{key:"getProjection",value:function(){return null===this.renderTextureInfo?this.ctx.renderExec._projection:this.renderTextureInfo.nativeTexture.projection}}]),n}(Jo),ts=function(){function t(e){_(this,t),this.ctx=e,this.renderState=e.renderState,this.gl=this.ctx.stage.gl}return v(t,[{key:"destroy",value:function(){this.ctx=null,this.renderState=null,this.gl=null,delete this.ctx,delete this.renderState,delete this.gl}},{key:"_reset",value:function(){this._bindRenderTexture(null),this._setScissor(null),this._clearRenderTexture()}},{key:"execute",value:function(){this._reset();for(var t=this.renderState.quadOperations,e=0,n=t.length;e<n;)this._processQuadOperation(t[e]),e++}},{key:"_processQuadOperation",value:function(t){t.renderTextureInfo&&t.renderTextureInfo.ignore||(this._setupQuadOperation(t),this._execQuadOperation(t))}},{key:"_setupQuadOperation",value:function(t){}},{key:"_execQuadOperation",value:function(t){var e=t.renderTextureInfo?t.renderTextureInfo.nativeTexture:null;this._renderTexture!==e&&this._bindRenderTexture(e),t.renderTextureInfo&&!t.renderTextureInfo.cleared?(this._setScissor(null),this._clearRenderTexture(),t.renderTextureInfo.cleared=!0,this._setScissor(t.scissor)):this._setScissor(t.scissor),this._renderQuadOperation(t)}},{key:"_renderQuadOperation",value:function(t){}},{key:"_bindRenderTexture",value:function(t){this._renderTexture=t}},{key:"_clearRenderTexture",value:function(t){}},{key:"_setScissor",value:function(t){}}]),t}(),es=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t)).gl=i.ctx.stage.gl,i.init(),i}return v(n,[{key:"init",value:function(){var t=this.gl;this._attribsBuffer=t.createBuffer();for(var e=Math.floor(this.renderState.quads.data.byteLength/80),n=new Uint16Array(6*e),i=0,r=0;i<e;i+=6,r+=4)n[i]=r,n[i+1]=r+1,n[i+2]=r+2,n[i+3]=r,n[i+4]=r+2,n[i+5]=r+3;this._quadsBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW),this._projection=new Float32Array([2/this.ctx.stage.coordsWidth,-2/this.ctx.stage.coordsHeight])}},{key:"destroy",value:function(){r(g(n.prototype),"destroy",this).call(this),this.gl.deleteBuffer(this._attribsBuffer),this.gl.deleteBuffer(this._quadsBuffer),this.gl=null,delete this.gl}},{key:"_reset",value:function(){r(g(n.prototype),"_reset",this).call(this);var t=this.gl;t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._stopShaderProgram(),this._setupBuffers()}},{key:"_setupBuffers",value:function(){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer);var e=new Float32Array(this.renderState.quads.data,0,this.renderState.quads.dataLength);t.bindBuffer(t.ARRAY_BUFFER,this._attribsBuffer),t.bufferData(t.ARRAY_BUFFER,e,t.DYNAMIC_DRAW)}},{key:"_setupQuadOperation",value:function(t){r(g(n.prototype),"_setupQuadOperation",this).call(this,t),this._useShaderProgram(t.shader,t)}},{key:"_renderQuadOperation",value:function(t){var e=t.shader;(t.length||t.shader.addEmpty())&&(e.beforeDraw(t),e.draw(t),e.afterDraw(t))}},{key:"_useShaderProgram",value:function(t,e){t.hasSameProgram(this._currentShaderProgram)||(this._currentShaderProgram&&this._currentShaderProgram.stopProgram(),t.useProgram(),this._currentShaderProgram=t),t.setupUniforms(e)}},{key:"_stopShaderProgram",value:function(){this._currentShaderProgram&&(this._currentShaderProgram.stopProgram(),this._currentShaderProgram=null)}},{key:"_bindRenderTexture",value:function(t){r(g(n.prototype),"_bindRenderTexture",this).call(this,t);var e=this.gl;this._renderTexture?(e.bindFramebuffer(e.FRAMEBUFFER,this._renderTexture.framebuffer),e.viewport(0,0,this._renderTexture.w,this._renderTexture.h)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.ctx.stage.w,this.ctx.stage.h))}},{key:"_clearRenderTexture",value:function(){r(g(n.prototype),"_clearRenderTexture",this).call(this);var t=this.gl;if(this._renderTexture)t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT);else{var e=this.ctx.stage.getClearColor();e&&(t.clearColor(e[0]*e[3],e[1]*e[3],e[2]*e[3],e[3]),t.clear(t.COLOR_BUFFER_BIT))}}},{key:"_setScissor",value:function(t){if(r(g(n.prototype),"_setScissor",this).call(this,t),this._scissor!==t){this._scissor=t;var e=this.gl;if(t){e.enable(e.SCISSOR_TEST);var i=this.ctx.stage.getRenderPrecision(),o=t[1];null===this._renderTexture&&(o=this.ctx.stage.h/i-(t[1]+t[3])),e.scissor(Math.round(t[0]*i),Math.round(o*i),Math.round(t[2]*i),Math.round(t[3]*i))}else e.disable(e.SCISSOR_TEST)}}}]),n}(ts),ns=function(){function t(e){_(this,t),this.ctx=e,this.stage=e.stage,this.defaultShader=this.stage.renderer.getDefaultShader(e),this.renderer=e.stage.renderer,this.quads=this.renderer.createCoreQuadList(e)}return v(t,[{key:"reset",value:function(){this._renderTextureInfo=null,this._scissor=null,this._shader=null,this._shaderOwner=null,this._realShader=null,this._check=!1,this.quadOperations=[],this._texturizer=null,this._texturizerTemporary=!1,this._quadOperation=null,this.quads.reset(),this._temporaryTexturizers=[],this._isCachingTexturizer=!1}},{key:"length",get:function(){return this.quads.quadTextures.length}},{key:"setShader",value:function(t,e){this._shaderOwner===e&&this._realShader===t||(this._realShader=t,t.useDefault()&&(t=this.defaultShader),this._shader===t&&this._shaderOwner===e||(this._shader=t,this._shaderOwner=e,this._check=!0))}},{key:"renderTextureInfo",get:function(){return this._renderTextureInfo}},{key:"setScissor",value:function(t){this._scissor!==t&&(this._scissor=t||null,this._check=!0)}},{key:"getScissor",value:function(){return this._scissor}},{key:"setRenderTextureInfo",value:function(t){this._renderTextureInfo!==t&&(this._renderTextureInfo=t,this._scissor=null,this._check=!0)}},{key:"setTexturizer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._texturizer=t,this._cacheTexturizer=e}},{key:"isCachingTexturizer",get:function(){return this._isCachingTexturizer},set:function(t){this._isCachingTexturizer=t}},{key:"addQuad",value:function(t){this._quadOperation?this._check&&this._hasChanges()&&(this._finishQuadOperation(),this._check=!1):this._createQuadOperation();var e=null;this._texturizer&&(e=this._texturizer.getResultTexture(),this._cacheTexturizer||this._temporaryTexturizers.push(this._texturizer)),e||(e=t._displayedTextureSource.nativeTexture),this._renderTextureInfo&&(this._shader===this.defaultShader&&this._renderTextureInfo.empty?(this._renderTextureInfo.nativeTexture=e,this._renderTextureInfo.offset=this.length):this._renderTextureInfo.nativeTexture=null,this._renderTextureInfo.empty=!1),this.quads.quadTextures.push(e),this.quads.quadElements.push(t),this._quadOperation.length++,this.renderer.addQuad(this,this.quads,this.length-1)}},{key:"finishedRenderTexture",value:function(){this._renderTextureInfo.nativeTexture&&(this._isRenderTextureReusable()||(this._renderTextureInfo.nativeTexture=null))}},{key:"_isRenderTextureReusable",value:function(){var t=this._renderTextureInfo.offset;return this.quads.quadTextures[t].w===this._renderTextureInfo.w&&this.quads.quadTextures[t].h===this._renderTextureInfo.h&&this.renderer.isRenderTextureReusable(this,this._renderTextureInfo)}},{key:"_hasChanges",value:function(){var t=this._quadOperation;return this._shader!==t.shader||(this._shaderOwner!==t.shaderOwner||(this._renderTextureInfo!==t.renderTextureInfo||this._scissor!==t.scissor&&(this._scissor[0]!==t.scissor[0]||this._scissor[1]!==t.scissor[1]||this._scissor[2]!==t.scissor[2]||this._scissor[3]!==t.scissor[3])))}},{key:"_finishQuadOperation",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._quadOperation){if((this._quadOperation.length||this._shader.addEmpty())&&(!this._quadOperation.scissor||this._quadOperation.scissor[2]>0&&this._quadOperation.scissor[3]>0)&&this.quadOperations.push(this._quadOperation),this._temporaryTexturizers.length){for(var e=0,n=this._temporaryTexturizers.length;e<n;e++)this._temporaryTexturizers[e].releaseRenderTexture();this._temporaryTexturizers=[]}this._quadOperation=null}t&&this._createQuadOperation()}},{key:"_createQuadOperation",value:function(){this._quadOperation=this.renderer.createCoreQuadOperation(this.ctx,this._shader,this._shaderOwner,this._renderTextureInfo,this._scissor,this.length),this._check=!1}},{key:"finish",value:function(){this._quadOperation&&this._finishQuadOperation(!1),this.renderer.finishRenderState(this)}}]),t}(),is=function(){function t(e,n){_(this,t),this.vertexShaderSource=e,this.fragmentShaderSource=n,this._program=null,this.gl=null,this._uniformLocations=new Map,this._attributeLocations=new Map,this._currentUniformValues={}}return v(t,[{key:"compile",value:function(t){if(!this._program){this.gl=t,this._program=t.createProgram();var e=this._glCompile(t.VERTEX_SHADER,this.vertexShaderSource),n=this._glCompile(t.FRAGMENT_SHADER,this.fragmentShaderSource);t.attachShader(this._program,e),t.attachShader(this._program,n),t.linkProgram(this._program),t.getProgramParameter(this._program,t.LINK_STATUS)||(console.error("[Lightning] Error: Could not initialize shader."),console.error("[Lightning] gl.VALIDATE_STATUS",t.getProgramParameter(this._program,t.VALIDATE_STATUS)),console.error("[Lightning] gl.getError()",t.getError()),""!==t.getProgramInfoLog(this._program)&&console.warn("[Lightning] Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(this._program)),t.deleteProgram(this._program),this._program=null),t.deleteShader(e),t.deleteShader(n)}}},{key:"_glCompile",value:function(t,e){var n=this.gl.createShader(t);if(this.gl.shaderSource(n,e),this.gl.compileShader(n),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)){console.error("[Lightning]",this.constructor.name,"Type: "+(t===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader")),console.error("[Lightning]",this.gl.getShaderInfoLog(n));var i=0;return console.error("[Lightning]","========== source ==========\n"+e.split("\n").map((function(t){return++i+": "+t})).join("\n")),null}return n}},{key:"getUniformLocation",value:function(t){var e=this._uniformLocations.get(t);return void 0===e&&(e=this.gl.getUniformLocation(this._program,t),this._uniformLocations.set(t,e)),e}},{key:"getAttribLocation",value:function(t){var e=this._attributeLocations.get(t);return void 0===e&&(e=this.gl.getAttribLocation(this._program,t),this._attributeLocations.set(t,e)),e}},{key:"destroy",value:function(){this._program&&this.gl.deleteProgram(this._program),this._attributeLocations=null,this._currentUniformValues=null,this.fragmentShaderSource=null,this._program=null,this.gl=null,this._uniformLocations=null,this.vertexShaderSource=null,delete this.vertexShaderSource,delete this._program,delete this._currentUniformValues,delete this.fragmentShaderSource,delete this.gl,delete this._uniformLocations,delete this._attributeLocations}},{key:"glProgram",get:function(){return this._program}},{key:"compiled",get:function(){return!!this._program}},{key:"_valueEquals",value:function(t,e){if(t.length&&e.length){for(var n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}return t===e}},{key:"_valueClone",value:function(t){return t.length?t.slice(0):t}},{key:"setUniformValue",value:function(t,e,n){var i=this._currentUniformValues[t];if(void 0===i||!this._valueEquals(i,e)){var r=this._valueClone(e);this._currentUniformValues[t]=r;var o=this.getUniformLocation(t);if(o)n===this.gl.uniformMatrix2fv||n===this.gl.uniformMatrix3fv||n===this.gl.uniformMatrix4fv?n.call(this.gl,o,!1,r):n.call(this.gl,o,r)}}}]),t}(),rs=function(t){l(n,t);var e=c(n);function n(t){var i;_(this,n),i=e.call(this,t);var r=t.stage;return i._program=r.renderer.shaderPrograms.get(i.constructor),i._program||(i._program=new is(i.constructor.vertexShaderSource,i.constructor.fragmentShaderSource),r.renderer.shaderPrograms.set(i.constructor,i._program)),i.gl=r.gl,i}return v(n,[{key:"glProgram",get:function(){return this._program.glProgram}},{key:"_init",value:function(){this._initialized||(this.initialize(),this._initialized=!0)}},{key:"initialize",value:function(){this._program.compile(this.gl)}},{key:"initialized",get:function(){return this._initialized}},{key:"_uniform",value:function(t){return this._program.getUniformLocation(t)}},{key:"_attrib",value:function(t){return this._program.getAttribLocation(t)}},{key:"_setUniform",value:function(t,e,n){this._program.setUniformValue(t,e,n)}},{key:"useProgram",value:function(){this._init(),this.gl.useProgram(this.glProgram),this.beforeUsage(),this.enableAttribs()}},{key:"stopProgram",value:function(){this.afterUsage(),this.disableAttribs()}},{key:"hasSameProgram",value:function(t){return t&&(t===this||t._program===this._program)}},{key:"beforeUsage",value:function(){}},{key:"afterUsage",value:function(){}},{key:"enableAttribs",value:function(){}},{key:"disableAttribs",value:function(){}},{key:"getExtraAttribBytesPerVertex",value:function(){return 0}},{key:"getVertexAttribPointerOffset",value:function(t){return t.extraAttribsDataByteOffset-4*t.index*this.getExtraAttribBytesPerVertex()}},{key:"setExtraAttribsInBuffer",value:function(t){}},{key:"setupUniforms",value:function(t){}},{key:"_getProjection",value:function(t){return t.getProjection()}},{key:"getFlipY",value:function(t){return this._getProjection(t)[1]<0}},{key:"beforeDraw",value:function(t){}},{key:"draw",value:function(t){}},{key:"afterDraw",value:function(t){}},{key:"cleanup",value:function(){this._initialized=!1}}]),n}(Ro),os=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"enableAttribs",value:function(){var t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),-1!==this._attrib("aColor")&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,16),t.enableVertexAttribArray(this._attrib("aColor")))}},{key:"disableAttribs",value:function(){var t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),-1!==this._attrib("aColor")&&t.disableVertexAttribArray(this._attrib("aColor"))}},{key:"setupUniforms",value:function(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}},{key:"draw",value:function(t){var e=this.gl,n=t.length;if(n){for(var i=t.getTexture(0),r=0,o=0;o<n;o++){var s=t.getTexture(o);i!==s&&(e.bindTexture(e.TEXTURE_2D,i),e.drawElements(e.TRIANGLES,6*(o-r),e.UNSIGNED_SHORT,6*(r+t.index)*2),i=s,r=o)}e.bindTexture(e.TEXTURE_2D,i),e.drawElements(e.TRIANGLES,6*(n-r),e.UNSIGNED_SHORT,6*(r+t.index)*2)}}}]),n}(rs);os.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",os.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";var ss=function(){function t(e){_(this,t),this.stage=e,this._defaultShader=void 0}return v(t,[{key:"gc",value:function(t){}},{key:"destroy",value:function(){}},{key:"getDefaultShader",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stage.ctx;return this._defaultShader||(this._defaultShader=this._createDefaultShader(t)),this._defaultShader}},{key:"_createDefaultShader",value:function(t){}},{key:"isValidShaderType",value:function(t){return t.prototype instanceof this._getShaderBaseType()}},{key:"createShader",value:function(t,e){var n=e.type;if(this.isValidShaderType(n)){var i=new n(t);return ho.patchObject(this,e),i}var r=this._getShaderAlternative(n);return r?new r(t):(console.warn("[Lightning] Shader has no implementation for render target: "+n.name),this._createDefaultShader(t))}},{key:"_getShaderBaseType",value:function(){}},{key:"_getShaderAlternative",value:function(t){return this.getDefaultShader()}},{key:"copyRenderTexture",value:function(t,e,n){console.warn("[Lightning] copyRenderTexture not supported by renderer")}}]),t}(),as=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t)).shaderPrograms=new Map,i._compressedTextureExtensions={astc:t.gl.getExtension("WEBGL_compressed_texture_astc"),etc1:t.gl.getExtension("WEBGL_compressed_texture_etc1"),s3tc:t.gl.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:t.gl.getExtension("WEBGL_compressed_texture_pvrtc")},i}return v(n,[{key:"getCompressedTextureExtensions",value:function(){return this._compressedTextureExtensions}},{key:"destroy",value:function(){this.shaderPrograms.forEach((function(t){return t.destroy()})),this.shaderPrograms=null,this._compressedTextureExtensions=null,delete this.shaderPrograms,delete this._compressedTextureExtensions}},{key:"_createDefaultShader",value:function(t){return new os(t)}},{key:"_getShaderBaseType",value:function(){return rs}},{key:"_getShaderAlternative",value:function(t){return t.getWebGL&&t.getWebGL()}},{key:"createCoreQuadList",value:function(t){return new Ko(t)}},{key:"createCoreQuadOperation",value:function(t,e,n,i,r,o){return new $o(t,e,n,i,r,o)}},{key:"createCoreRenderExecutor",value:function(t){return new es(t)}},{key:"createCoreRenderState",value:function(t){return new ns(t)}},{key:"createRenderTexture",value:function(t,e,n,i){var r=this.stage.gl,o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n,i,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),o.params={},o.params[r.TEXTURE_MAG_FILTER]=r.LINEAR,o.params[r.TEXTURE_MIN_FILTER]=r.LINEAR,o.params[r.TEXTURE_WRAP_S]=r.CLAMP_TO_EDGE,o.params[r.TEXTURE_WRAP_T]=r.CLAMP_TO_EDGE,o.options={format:r.RGBA,internalFormat:r.RGBA,type:r.UNSIGNED_BYTE},o.framebuffer=r.createFramebuffer(),o.projection=new Float32Array([2/t,2/e]),r.bindFramebuffer(r.FRAMEBUFFER,o.framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0),o}},{key:"freeRenderTexture",value:function(t){var e=this.stage.gl;e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t)}},{key:"_getBytesPerPixel",value:function(t,e){var n=this.stage.gl;if(t===n.RGBA)switch(e){case n.UNSIGNED_BYTE:return 4;case n.UNSIGNED_SHORT_4_4_4_4:case n.UNSIGNED_SHORT_5_5_5_1:return 2;default:throw new Error("Invalid type specified for GL_RGBA format")}else{if(t!==n.RGB)throw new Error("Invalid format specified in call to _getBytesPerPixel()");switch(e){case n.UNSIGNED_BYTE:return 3;case n.UNSIGNED_BYTE_5_6_5:return 2;default:throw new Error("Invalid type specified for GL_RGB format")}}}},{key:"uploadTextureSource",value:function(t,e){var n=this.stage.gl,i=e.source,r=!1;e.renderInfo&&(r=e.renderInfo.compressed||!1);var o={premultiplyAlpha:!0,hasAlpha:!0};e&&e.hasOwnProperty("premultiplyAlpha")&&(o.premultiplyAlpha=e.premultiplyAlpha),e&&e.hasOwnProperty("flipBlueRed")&&(o.flipBlueRed=e.flipBlueRed),e&&e.hasOwnProperty("hasAlpha")&&(o.hasAlpha=e.hasAlpha),o.hasAlpha||(o.premultiplyAlpha=!1),o.texParams=e.texParams||{},o.texOptions=e.texOptions||{};var s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),lo.isNode&&n.pixelStorei(n.UNPACK_FLIP_BLUE_RED,!!o.flipBlueRed);var a=o.texParams;if(a[n.TEXTURE_MAG_FILTER]||(a[n.TEXTURE_MAG_FILTER]=n.LINEAR),a[n.TEXTURE_MIN_FILTER]||(a[n.TEXTURE_MIN_FILTER]=n.LINEAR),a[n.TEXTURE_WRAP_S]||(a[n.TEXTURE_WRAP_S]=n.CLAMP_TO_EDGE),a[n.TEXTURE_WRAP_T]||(a[n.TEXTURE_WRAP_T]=n.CLAMP_TO_EDGE),Object.keys(a).forEach((function(t){var e=a[t];n.texParameteri(n.TEXTURE_2D,parseInt(t),e)})),r)return this.stage.platform.uploadCompressedGlTexture(n,t,i),s;var u=o.texOptions;return u.format=u.format||(o.hasAlpha?n.RGBA:n.RGB),u.type=u.type||n.UNSIGNED_BYTE,u.internalFormat=u.internalFormat||u.format,e&&e.imageRef&&(u.imageRef=e.imageRef),this.stage.platform.uploadGlTexture(n,t,i,u),s.params=lo.cloneObjShallow(a),s.options=lo.cloneObjShallow(u),s.bytesPerPixel=this._getBytesPerPixel(u.format,u.type),s}},{key:"freeTextureSource",value:function(t){this.stage.gl.deleteTexture(t.nativeTexture)}},{key:"addQuad",value:function(t,e,n){var i=20*n,r=e.quadElements[n],o=r._renderContext,s=t.quads.floats,a=t.quads.uints,u=uo.mergeColorAlpha;if(0!==o.tb||0!==o.tc)s[i++]=o.px,s[i++]=o.py,s[i++]=r._ulx,s[i++]=r._uly,a[i++]=u(r._colorUl,o.alpha),s[i++]=o.px+r._w*o.ta,s[i++]=o.py+r._w*o.tc,s[i++]=r._brx,s[i++]=r._uly,a[i++]=u(r._colorUr,o.alpha),s[i++]=o.px+r._w*o.ta+r._h*o.tb,s[i++]=o.py+r._w*o.tc+r._h*o.td,s[i++]=r._brx,s[i++]=r._bry,a[i++]=u(r._colorBr,o.alpha),s[i++]=o.px+r._h*o.tb,s[i++]=o.py+r._h*o.td,s[i++]=r._ulx,s[i++]=r._bry,a[i]=u(r._colorBl,o.alpha);else{var l=o.px+r._w*o.ta,h=o.py+r._h*o.td;s[i++]=o.px,s[i++]=o.py,s[i++]=r._ulx,s[i++]=r._uly,a[i++]=u(r._colorUl,o.alpha),s[i++]=l,s[i++]=o.py,s[i++]=r._brx,s[i++]=r._uly,a[i++]=u(r._colorUr,o.alpha),s[i++]=l,s[i++]=h,s[i++]=r._brx,s[i++]=r._bry,a[i++]=u(r._colorBr,o.alpha),s[i++]=o.px,s[i++]=h,s[i++]=r._ulx,s[i++]=r._bry,a[i]=u(r._colorBl,o.alpha)}}},{key:"isRenderTextureReusable",value:function(t,e){var n=80*t._renderTextureInfo.offset/4,i=t.quads.floats,r=t.quads.uints;return 0===i[n]&&0===i[n+1]&&0===i[n+2]&&0===i[n+3]&&4294967295===r[n+4]&&i[n+5]===e.w&&0===i[n+6]&&1===i[n+7]&&0===i[n+8]&&4294967295===r[n+9]&&i[n+10]===e.w&&i[n+11]===e.h&&1===i[n+12]&&1===i[n+13]&&4294967295===r[n+14]&&0===i[n+15]&&i[n+16]===e.h&&0===i[n+17]&&1===i[n+18]&&4294967295===r[n+19]}},{key:"finishRenderState",value:function(t){for(var e=80*t.length,n=0,i=t.quadOperations.length;n<i;n++){t.quadOperations[n].extraAttribsDataByteOffset=e;var r=4*t.quadOperations[n].shader.getExtraAttribBytesPerVertex()*t.quadOperations[n].length;e+=r,r&&t.quadOperations[n].shader.setExtraAttribsInBuffer(t.quadOperations[n],t.quads)}t.quads.dataLength=e}},{key:"copyRenderTexture",value:function(t,e,n){var i=this.stage.gl;i.bindTexture(i.TEXTURE_2D,e),i.bindFramebuffer(i.FRAMEBUFFER,t.framebuffer);var r=t.precision;i.copyTexSubImage2D(i.TEXTURE_2D,0,r*(n.sx||0),r*(n.sy||0),r*(n.x||0),r*(n.y||0),r*(n.w||t.ow),r*(n.h||t.oh))}}]),n}(ss),us=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t)).renderContexts=[],i.modes=[],i}return v(n,[{key:"setRenderContext",value:function(t,e){this.renderContexts[t]=e}},{key:"setSimpleTc",value:function(t,e){e?this.modes[t]|=1:this.modes[t]-=1&this.modes[t]}},{key:"setWhite",value:function(t,e){e?this.modes[t]|=2:this.modes[t]-=2&this.modes[t]}},{key:"getRenderContext",value:function(t){return this.renderContexts[t]}},{key:"getSimpleTc",value:function(t){return 1&this.modes[t]}},{key:"getWhite",value:function(t){return 2&this.modes[t]}}]),n}(qo),ls=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"getRenderContext",value:function(t){return this.quads.getRenderContext(this.index+t)}},{key:"getSimpleTc",value:function(t){return this.quads.getSimpleTc(this.index+t)}},{key:"getWhite",value:function(t){return this.quads.getWhite(this.index+t)}}]),n}(Jo),hs=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"init",value:function(){this._mainRenderTexture=this.ctx.stage.getCanvas()}},{key:"_renderQuadOperation",value:function(t){var e=t.shader;if(t.length||t.shader.addEmpty()){var n=this._renderTexture||this._mainRenderTexture;e.beforeDraw(t,n),e.draw(t,n),e.afterDraw(t,n)}}},{key:"_clearRenderTexture",value:function(){var t=this._getContext(),e=[0,0,0,0];this._mainRenderTexture.ctx===t&&(e=this.ctx.stage.getClearColor());var n=t.canvas;t.setTransform(1,0,0,1,0,0),e[0]||e[1]||e[2]||e[3]?(t.fillStyle=uo.getRgbaStringFromArray(e),t.globalCompositeOperation="copy",t.beginPath(),t.rect(0,0,n.width,n.height),t.closePath(),t.fill(),t.globalCompositeOperation="source-over"):t.clearRect(0,0,n.width,n.height)}},{key:"_getContext",value:function(){return this._renderTexture?this._renderTexture.ctx:this._mainRenderTexture.ctx}},{key:"_restoreContext",value:function(){var t=this._getContext();t.restore(),t.save(),t._scissor=null}},{key:"_setScissor",value:function(t){var e=this._getContext();if(!n._equalScissorAreas(e.canvas,e._scissor,t)){this._restoreContext();var i=this.ctx.stage.getRenderPrecision();t&&(e.beginPath(),e.rect(Math.round(t[0]*i),Math.round(t[1]*i),Math.round(t[2]*i),Math.round(t[3]*i)),e.closePath(),e.clip()),e._scissor=t}}}],[{key:"_equalScissorAreas",value:function(t,e,n){return e||(e=[0,0,t.width,t.height]),n||(n=[0,0,t.width,t.height]),lo.equalValues(e,n)}}]),n}(ts),cs=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"beforeDraw",value:function(t){}},{key:"draw",value:function(t){}},{key:"afterDraw",value:function(t){}}]),n}(Ro),fs=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._rectangleTexture=t.stage.rectangleTexture.source.nativeTexture,i._tintManager=i.ctx.stage.renderer.tintManager,i}return v(n,[{key:"draw",value:function(t,e){for(var n=e.ctx,i=t.length,r=0;r<i;r++){var o=t.getTexture(r),s=t.getElementCore(r),a=t.getRenderContext(r),u=t.getWhite(r),l=t.getSimpleTc(r),h=this.ctx.stage.getRenderPrecision();n.setTransform(a.ta*h,a.tc*h,a.tb*h,a.td*h,a.px*h,a.py*h);var c=o===this._rectangleTexture,f={operation:t,target:e,index:r,rect:c};if(c)u?n.fillStyle="white":this._setColorGradient(n,s),n.globalAlpha=a.alpha,this._beforeDrawEl(f),n.fillRect(0,0,s.w,s.h),this._afterDrawEl(f),n.globalAlpha=1;else{n.globalAlpha=a.alpha,this._beforeDrawEl(f);var d=l?0:s._ulx*o.w,A=l?0:s._uly*o.h,g=(l?1:s._brx-s._ulx)*o.w,p=(l?1:s._bry-s._uly)*o.h;if(!u){var v=s._colorUl;s._colorUl===s._colorUr&&s._colorUr===s._colorBl&&s._colorBr===s._colorBl||(v=uo.mergeMultiColorsEqual([s._colorUl,s._colorUr,s._colorBl,s._colorBr]));var _=(v/16777216|0)/255;n.globalAlpha*=_;var y=16777215&v,x=this._tintManager.getTintTexture(o,y);n.fillStyle="white",n.drawImage(x,d,A,g,p,0,0,s.w,s.h)}else n.fillStyle="white",n.drawImage(o,d,A,g,p,0,0,s.w,s.h);this._afterDrawEl(f),n.globalAlpha=1}}}},{key:"_setColorGradient",value:function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.w,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.h,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=e._colorUl;e._colorUl===e._colorUr?e._colorBl===e._colorBr&&(e._colorUl===e.colorBl||(n=t.createLinearGradient(0,0,0,r),o?(n.addColorStop(0,uo.getRgbaString(e._colorUl)),n.addColorStop(1,uo.getRgbaString(e._colorBl))):(n.addColorStop(0,uo.getRgbString(e._colorUl)),n.addColorStop(1,uo.getRgbString(e._colorBl))))):e._colorUl===e._colorBl&&e._colorUr===e._colorBr&&(n=t.createLinearGradient(0,0,i,0),o?(n.addColorStop(0,uo.getRgbaString(e._colorUl)),n.addColorStop(1,uo.getRgbaString(e._colorBr))):(n.addColorStop(0,uo.getRgbString(e._colorUl)),n.addColorStop(1,uo.getRgbString(e._colorBr)))),t.fillStyle=n||(o?uo.getRgbaString(s):uo.getRgbString(s))}},{key:"_beforeDrawEl",value:function(t){}},{key:"_afterDrawEl",value:function(t){}}]),n}(cs),ds=function(){function t(e){_(this,t),this.stage=e,this._usedMemory=0,this._cachedNativeTextures=new Set}return v(t,[{key:"destroy",value:function(){this.gc(!0),this.stage=null,delete this.stage}},{key:"_addMemoryUsage",value:function(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}},{key:"delete",value:function(t){if(this._hasCache(t)){var e=this._getCache(t),n=e.memoryUsage;e.clear(),this._cachedNativeTextures.delete(t),this._addMemoryUsage(e.memoryUsage-n)}}},{key:"getTintTexture",value:function(t,e){var n=this.stage.frameCounter;this._cachedNativeTextures.add(t);var i=this._getCache(t),r=i.get(e);if(r.lf=n,r.tx)return t.update>r.u&&this._tintTexture(r.tx,t,e),r.tx;var o=i.memoryUsage,s=i.reuseTexture(n);s?s.ctx.clearRect(0,0,s.width,s.height):((s=document.createElement("canvas")).width=t.w,s.height=t.h,s.ctx=s.getContext("2d")),this._tintTexture(s,t,e),i.set(e,s,n);var a=i.memoryUsage;return a!==o&&this._addMemoryUsage(a-o),s}},{key:"_tintTexture",value:function(t,e,n){for(var i=n.toString(16);i.length<6;)i="0"+i;t.ctx.fillStyle="#"+i,t.ctx.globalCompositeOperation="copy",t.ctx.fillRect(0,0,e.w,e.h),t.ctx.globalCompositeOperation="multiply",t.ctx.drawImage(e,0,0,e.w,e.h,0,0,t.width,t.height),t.ctx.globalCompositeOperation="destination-in",t.ctx.drawImage(e,0,0,e.w,e.h,0,0,t.width,t.height)}},{key:"_hasCache",value:function(t){return!!t._tintCache}},{key:"_getCache",value:function(t){return t._tintCache||(t._tintCache=new As(t)),t._tintCache}},{key:"gc",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.stage.frameCounter,i=0;this._cachedNativeTextures.forEach((function(r){var o=t._getCache(r);if(e)i+=o.memoryUsage,o.clear();else{var s=o.memoryUsage;o.cleanup(n),o.releaseBlancoTextures(),i+=o.memoryUsage-s}})),e&&this._cachedNativeTextures.clear(),i&&this._addMemoryUsage(i)}}]),t}(),As=function(){function t(e){_(this,t),this._tx=e,this._colors=new Map,this._blancoTextures=null,this._lastCleanupFrame=0,this._memTextures=0}return v(t,[{key:"memoryUsage",get:function(){return this._memTextures*this._tx.w*this._tx.h}},{key:"releaseBlancoTextures",value:function(){this._memTextures-=this._blancoTextures.length,this._blancoTextures=[]}},{key:"clear",value:function(){this._blancoTextures=null,this._colors.clear(),this._memTextures=0}},{key:"get",value:function(t){var e=this._colors.get(t);return e||(e={lf:-1,tx:void 0,u:-1},this._colors.set(t,e)),e}},{key:"set",value:function(t,e,n){var i=this.get(t);i.lf=n,i.tx=e,i.u=n,this._memTextures++}},{key:"cleanup",value:function(t){var e=this;this._lastCleanupFrame!==t&&(this._blancoTextures=[],this._colors.forEach((function(n,i){n.lf<t-1&&(n.tx&&e._blancoTextures.push(n.tx),e._colors.delete(i))})),this._lastCleanupFrame=t)}},{key:"reuseTexture",value:function(t){if(this.cleanup(t),this._blancoTextures&&this._blancoTextures.length)return this._memTextures--,this._blancoTextures.pop()}}]),t}(),gs=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t)).tintManager=new ds(t),i.setupC2d(i.stage.c2d.canvas),i}return v(n,[{key:"destroy",value:function(){this.tintManager.destroy(),this.tintManager=null,delete this.tintManager}},{key:"_createDefaultShader",value:function(t){return new fs(t)}},{key:"_getShaderBaseType",value:function(){return cs}},{key:"_getShaderAlternative",value:function(t){return t.getC2d&&t.getC2d()}},{key:"createCoreQuadList",value:function(t){return new us(t)}},{key:"createCoreQuadOperation",value:function(t,e,n,i,r,o){return new ls(t,e,n,i,r,o)}},{key:"createCoreRenderExecutor",value:function(t){return new hs(t)}},{key:"createCoreRenderState",value:function(t){return new ns(t)}},{key:"createRenderTexture",value:function(t,e,n,i){var r=document.createElement("canvas");return r.width=n,r.height=i,this.setupC2d(r),r}},{key:"freeRenderTexture",value:function(t){this.tintManager.delete(t)}},{key:"gc",value:function(t){this.tintManager.gc(t)}},{key:"uploadTextureSource",value:function(t,e){if(e.source.buffer){var n=document.createElement("canvas");n.width=e.w,n.height=e.h;var i=new ImageData(new Uint8ClampedArray(e.source.buffer),e.w,e.h);return n.getContext("2d").putImageData(i,0,0),n}return e.source}},{key:"freeTextureSource",value:function(t){this.tintManager.delete(t.nativeTexture)}},{key:"addQuad",value:function(t,e,n){var i=e.quadElements[n];e.setRenderContext(n,i._renderContext),e.setWhite(n,i.isWhite()),e.setSimpleTc(n,i.hasSimpleTexCoords())}},{key:"isRenderTextureReusable",value:function(t,e){return!1}},{key:"finishRenderState",value:function(t){}},{key:"setupC2d",value:function(t){var e=t.getContext("2d");t.ctx=e,e._scissor=null,t.ctx.save()}}]),n}(ss),ps=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"enableAttribs",value:function(){var t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),-1!==this._attrib("aColor")&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,16),t.enableVertexAttribArray(this._attrib("aColor")))}},{key:"disableAttribs",value:function(){var t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),-1!==this._attrib("aColor")&&t.disableVertexAttribArray(this._attrib("aColor"))}},{key:"setupUniforms",value:function(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}},{key:"draw",value:function(t){var e=this.gl,n=t.length;if(n){for(var i=t.getTexture(0),r=0,o=0;o<n;o++){var s=t.getTexture(o);if(i!==s){if(i.options&&i.options.imageRef){var a=o>0?o-1:o,u=this.ctx.stage.getOption("precision"),l=t.getElementCore(a);this.ctx.stage.platform.paint(e,i.options.imageRef,l._worldContext.px*u,l._worldContext.py*u,l._colorUl,l)}else e.bindTexture(e.TEXTURE_2D,i),e.drawElements(e.TRIANGLES,6*(o-r),e.UNSIGNED_SHORT,6*(r+t.index)*2);i=s,r=o}}if(r<n)if(i.options&&i.options.imageRef){var h=this.ctx.stage.getOption("precision"),c=t.getElementCore(r);this.ctx.stage.platform.paint(e,i.options.imageRef,c._worldContext.px*h,c._worldContext.py*h,c._colorUl,c)}else e.bindTexture(e.TEXTURE_2D,i),e.drawElements(e.TRIANGLES,6*(n-r),e.UNSIGNED_SHORT,6*(r+t.index)*2)}}}]),n}(rs);ps.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ps.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";var vs=function(t){l(n,t);var e=c(n);function n(t){return _(this,n),e.call(this,t)}return v(n,[{key:"_createDefaultShader",value:function(t){return new ps(t)}},{key:"createCoreRenderExecutor",value:function(t){global.beginDrawing();var e=r(g(n.prototype),"createCoreRenderExecutor",this).call(this,t);return global.endDrawing(),e}}]),n}(as),_s=function(){function t(){_(this,t),this._items=new Map,this._id=0,this._initWorker()}return v(t,[{key:"destroy",value:function(){this._worker&&this._worker.terminate(),this._items=null,this._worker=null,delete this._items,delete this._worker}},{key:"_initWorker",value:function(){var t=this,e="(".concat(xs.toString(),")()"),n=new Blob([e.replace('"use strict";',"")]),i=(window.URL?URL:webkitURL).createObjectURL(n,{type:"application/javascript; charset=utf-8"});this._worker=new Worker(i),this._worker.postMessage({type:"config",config:{path:window.location.href,protocol:window.location.protocol}}),this._worker.onmessage=function(e){if(e.data&&e.data.id){var n=e.data.id,i=t._items.get(n);i&&("data"==e.data.type?t.finish(i,e.data.info):t.error(i,e.data.info))}}}},{key:"create",value:function(t){var e=++this._id,n=new ys(this,e,t);return this._items.set(e,n),this._worker.postMessage({type:"add",id:e,src:t}),n}},{key:"cancel",value:function(t){this._worker.postMessage({type:"cancel",id:t.id}),this._items.delete(t.id)}},{key:"error",value:function(t,e){t.error(e),this._items.delete(t.id)}},{key:"finish",value:function(t,e){t.load(e),this._items.delete(t.id)}}]),t}(),ys=function(){function t(e,n,i){_(this,t),this._manager=e,this._id=n,this._src=i,this._onError=null,this._onLoad=null}return v(t,[{key:"id",get:function(){return this._id}},{key:"src",get:function(){return this._src}},{key:"onError",set:function(t){this._onError=t}},{key:"onLoad",set:function(t){this._onLoad=t}},{key:"cancel",value:function(){this._manager.cancel(this)}},{key:"load",value:function(t){this._onLoad&&this._onLoad(t)}},{key:"error",value:function(t){this._onError&&this._onError(t)}}]),t}(),xs=function(){function t(){this.items=new Map;var t=this;onmessage=function(e){t._receiveMessage(e)}}function e(t,e){this._onError=void 0,this._onFinish=void 0,this._id=t,this._src=e,this._xhr=void 0,this._mimeType=void 0,this._canceled=!1}t.isPathAbsolute=function(t){return/^(?:\/|[a-z]+:\/\/)/.test(t)||"data:"==t.substr(0,5)},t.prototype._receiveMessage=function(t){if("config"===t.data.type){this.config=t.data.config;var e=this.config.path;/#.*?\//.test(e)&&(e=e.replace(/#.*$/,""));var n=e.split("/");n.pop(),this._relativeBase=n.join("/")+"/"}else"add"===t.data.type?this.add(t.data.id,t.data.src):"cancel"===t.data.type&&this.cancel(t.data.id)},t.prototype.add=function(n,i){t.isPathAbsolute(i)||(i=this._relativeBase+i),"//"===i.substr(0,2)&&(i=this.config.protocol+i);var r=new e(n,i),o=this;r.onFinish=function(t){o.finish(r,t)},r.onError=function(t){o.error(r,t)},this.items.set(n,r),r.start()},t.prototype.cancel=function(t){var e=this.items.get(t);e&&(e.cancel(),this.items.delete(t))},t.prototype.finish=function(t,e){var n=e.imageBitmap,i=e.hasAlphaChannel;postMessage({type:"data",id:t.id,info:{imageBitmap:n,hasAlphaChannel:i}},[n]),this.items.delete(t.id)},t.prototype.error=function(t,e){var n=e.type,i=e.message;postMessage({type:"error",id:t.id,info:{type:n,message:i}}),this.items.delete(t.id)},t.isWPEBrowser=function(){return-1!==navigator.userAgent.indexOf("WPE")},Object.defineProperty(e.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(e.prototype,"onFinish",{get:function(){return this._onFinish},set:function(t){this._onFinish=t}}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t}}),e.prototype.start=function(){this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._src,!0),this._xhr.responseType="blob";var t=this;this._xhr.onerror=function(e){t.error({type:"connection",message:"Connection error"})},this._xhr.onload=function(e){var n=t._xhr.response;t._mimeType=n.type,t._createImageBitmap(n)},this._xhr.send()},e.prototype._createImageBitmap=function(t){var e=this;createImageBitmap(t,{premultiplyAlpha:"premultiply",colorSpaceConversion:"none",imageOrientation:"none"}).then((function(t){e.finish({imageBitmap:t,hasAlphaChannel:e._hasAlphaChannel()})})).catch((function(t){e.error({type:"parse",message:"Error parsing image data"})}))},e.prototype._hasAlphaChannel=function(){return!!t.isWPEBrowser()||-1!==this._mimeType.indexOf("image/png")},e.prototype.cancel=function(){this._canceled||(this._xhr&&this._xhr.abort(),this._canceled=!0)},e.prototype.error=function(t,e){!this._canceled&&this._onError&&this._onError({type:t,message:e})},e.prototype.finish=function(t){!this._canceled&&this._onFinish&&this._onFinish(t)},new t},ms=function(){function t(){_(this,t)}return v(t,[{key:"init",value:function(t){this.stage=t,this._looping=!1,this._awaitingLoop=!1,this._loopHandler=null,this._idleLoopCounter=0,this._idleLoopDelay=60,this.stage.getOption("useImageWorker")&&(window.createImageBitmap&&window.Worker?this._imageWorker=new _s:console.warn("[Lightning] Can't use image worker because browser does not have createImageBitmap and Web Worker support")),this._registerVisibilityChangeHandler()}},{key:"destroy",value:function(){this._imageWorker&&this._imageWorker.destroy(),clearInterval(this._loopHandler),this._removeKeyHandler(),this._removeClickHandler(),this._removeHoverHandler(),this._removeScrollWheelHandler(),this._removeVisibilityChangeHandler(),this.stage=null,delete this.stage}},{key:"startLoop",value:function(){this._looping=!0,this._awaitingLoop||this.loop()}},{key:"stopLoop",value:function(){this._looping=!1}},{key:"switchLoop",value:function(){var t=this;this._idleLoopCounter<this._idleLoopDelay?this._idleLoopCounter++:this.stage.ctx.hasRenderUpdates()?this._idleLoopCounter=0:(this.stopLoop(),this._loopHandler=setInterval((function(){t.stage.updateFrame(),t.stage.idleFrame(),t.stage.ctx.hasRenderUpdates()&&(clearInterval(t._loopHandler),t.startLoop())}),1e3/60))}},{key:"loop",value:function(){var t=this;requestAnimationFrame((function e(){t._awaitingLoop=!1,t._looping&&(t.stage.updateFrame(),t.stage.getOption("pauseRafLoopOnIdle")&&t.switchLoop(),t.stage.renderFrame(),requestAnimationFrame(e),t._awaitingLoop=!0)}))}},{key:"uploadCompressedGlTexture",value:function(t,e,n,i){var r=n.pvr?n.mipmaps[0]:new DataView(n.mipmaps[0]);t.compressedTexImage2D(t.TEXTURE_2D,0,n.glInternalFormat,n.pixelWidth,n.pixelHeight,0,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)}},{key:"uploadGlTexture",value:function(t,e,n,i){if(n instanceof ImageData||n instanceof HTMLImageElement||n instanceof HTMLVideoElement||window.ImageBitmap&&n instanceof ImageBitmap)t.texImage2D(t.TEXTURE_2D,0,i.internalFormat,i.format,i.type,n);else if(n instanceof HTMLCanvasElement){if(lo.isZiggo||this.stage.getOption("forceTxCanvasSource"))t.texImage2D(t.TEXTURE_2D,0,i.internalFormat,i.format,i.type,n);else if(n.width>0&&n.height>0){var r=n.getContext("2d");t.texImage2D(t.TEXTURE_2D,0,i.internalFormat,i.format,i.type,r.getImageData(0,0,n.width,n.height))}}else t.texImage2D(t.TEXTURE_2D,0,i.internalFormat,e.w,e.h,0,i.format,i.type,n)}},{key:"handleKtxLoad",value:function(t,e){var n=this;return function(){var i=this.response,r=new DataView(i);3632701469!==r.getUint32(0)+r.getUint32(4)+r.getUint32(8)&&t("Parsing failed: identifier ktx mismatch:",e);var o=16909060===r.getUint32(12),s={glType:r.getUint32(16,o),glTypeSize:r.getUint32(20,o),glFormat:r.getUint32(24,o),glInternalFormat:r.getUint32(28,o),glBaseInternalFormat:r.getUint32(32,o),pixelWidth:r.getUint32(36,o),pixelHeight:r.getUint32(40,o),pixelDepth:r.getUint32(44,o),numberOfArrayElements:r.getUint32(48,o),numberOfFaces:r.getUint32(52,o),numberOfMipmapLevels:r.getUint32(56,o),bytesOfKeyValueData:r.getUint32(60,o),kvps:[],mipmaps:[],get width(){return this.pixelWidth},get height(){return this.pixelHeight}};Object.values(n.stage.renderer.getCompressedTextureExtensions()).filter((function(t){return null!=t})).map((function(t){return function(t){var e=[];for(var n in t)e.push(t[n]);return e}(t)})).reduce((function(t,e){return t.concat(e)})).includes(s.glInternalFormat)||console.warn("[Lightning] Unrecognized texture extension format:",e,s.glInternalFormat,n.stage.renderer.getCompressedTextureExtensions());var a=64;a+=s.bytesOfKeyValueData;for(var u=0;u<s.numberOfMipmapLevels;u++){var l=r.getUint32(a);a+=4,s.mipmaps.push(r.buffer.slice(a,l)),a+=l}t(null,{source:s,renderInfo:{src:e,compressed:!0}})}}},{key:"handlePvrLoad",value:function(t,e){return function(){for(var n=this.response,i=new Int32Array(n,0,13),r=i[12]+52,o=new Uint8Array(n,r),s={glInternalFormat:36196,pixelWidth:i[7],pixelHeight:i[6],numberOfMipmapLevels:i[11],mipmaps:[],pvr:!0,get width(){return this.pixelWidth},get height(){return this.pixelHeight}},a=0,u=s.pixelWidth,l=s.pixelHeight,h=0;h<s.numberOfMipmapLevels;h++){var c=(u+3>>2)*(l+3>>2)*8,f=new Uint8Array(n,o.byteOffset+a,c);s.mipmaps.push(f),a+=c,u>>=1,l>>=1}t(null,{source:s,renderInfo:{src:e,compressed:!0}})}}},{key:"loadSrcTexture",value:function(t,e){var n=t.src,i=t.hasAlpha,r=void 0,o=n.toLowerCase().indexOf(".png")>=0||"data:image/png;base64"==n.substr(0,21),s=n.indexOf(".ktx")>=0,a=n.indexOf(".pvr")>=0;if(s||a){var u=new XMLHttpRequest;u.addEventListener("load",s?this.handleKtxLoad(e,n):this.handlePvrLoad(e,n)),u.open("GET",n),u.responseType="arraybuffer",u.send(),r=function(){u.abort()}}else if(this._imageWorker){var l=this._imageWorker.create(n);l.onError=function(t){return e("Image load error")},l.onLoad=function(t){var i=t.imageBitmap,r=t.hasAlphaChannel;e(null,{source:i,renderInfo:{src:n,compressed:!1},hasAlpha:r,premultiplyAlpha:!0})},r=function(){l.cancel()}}else{var h=new Image;"data:"==n.substr(0,5)||lo.isPS4||(h.crossOrigin="Anonymous"),h.onerror=function(t){if(h.src)return e("Image load error")},h.onload=function(){e(null,{source:h,renderInfo:{src:n,compressed:!1},hasAlpha:o||i})},h.src=n,r=function(){h.onerror=null,h.onload=null,h.removeAttribute("src")}}return r}},{key:"createWebGLContext",value:function(t,e){var n=this.stage.getOption("canvas")||document.createElement("canvas");t&&e&&(n.width=t,n.height=e);var i={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1},r=n.getContext("webgl",i)||n.getContext("experimental-webgl",i)||n.getContext("webgl2",i);if(!r)throw new Error("This browser does not support webGL.");return r}},{key:"createCanvasContext",value:function(t,e){var n=this.stage.getOption("canvas")||document.createElement("canvas");t&&e&&(n.width=t,n.height=e);var i=n.getContext("2d");if(!i)throw new Error("This browser does not support 2d canvas.");return i}},{key:"getHrTime",value:function(){return window.performance?window.performance.now():(new Date).getTime()}},{key:"getDrawingCanvas",value:function(){return document.createElement("canvas")}},{key:"getTextureOptionsForDrawingCanvas",value:function(t){var e={};return e.source=t,e}},{key:"nextFrame",value:function(t){}},{key:"registerKeydownHandler",value:function(t){this._keydownListener=function(e){t(e)},window.addEventListener("keydown",this._keydownListener)}},{key:"registerKeyupHandler",value:function(t){this._keyupListener=function(e){t(e)},window.addEventListener("keyup",this._keyupListener)}},{key:"_removeKeyHandler",value:function(){this._keydownListener&&window.removeEventListener("keydown",this._keydownListener),this._keyupListener&&window.removeEventListener("keyup",this._keyupListener)}},{key:"registerClickHandler",value:function(t){this._clickListener=function(e){t(e)},window.addEventListener("mousedown",this._clickListener)}},{key:"_removeClickHandler",value:function(){this._clickListener&&window.removeEventListener("mousedown",this._clickListener)}},{key:"registerHoverHandler",value:function(t){this._hoverListener=function(e){t(e)},window.addEventListener("mousemove",this._hoverListener)}},{key:"_removeHoverHandler",value:function(){this._hoverListener&&window.removeEventListener("mousemove",this._hoverListener)}},{key:"registerScrollWheelHandler",value:function(t){this._scrollWheelListener=function(e){t(e)},window.addEventListener("wheel",this._scrollWheelListener)}},{key:"_removeScrollWheelHandler",value:function(){this._scrollWheelListener&&window.removeEventListener("wheel",this._scrollWheelListener)}},{key:"_registerVisibilityChangeHandler",value:function(){var t=this;this._visibilityChangeHandler=function(){"visible"===document.visibilityState&&(t.stage.root.core.setHasRenderUpdates(2),t.stage.renderFrame())},document.addEventListener("visibilitychange",this._visibilityChangeHandler)}},{key:"_removeVisibilityChangeHandler",value:function(){this._visibilityChangeHandler&&document.removeEventListener("visibilitychange",this._visibilityChangeHandler)}}]),t}(),ks=function(){function t(){_(this,t)}return v(t,null,[{key:"load",value:function(t){return t.platform?t.platform:ms}}]),t}(),Ts=function(){function t(){_(this,t)}return v(t,null,[{key:"isFunction",value:function(t){return"function"==typeof t}},{key:"isNumber",value:function(t){return"number"==typeof t}},{key:"isInteger",value:function(t){return"number"==typeof t&&t%1==0}},{key:"isBoolean",value:function(t){return!0===t||!1===t}},{key:"isString",value:function(t){return"string"==typeof t}},{key:"isObject",value:function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}},{key:"isPlainObject",value:function(t){return!!t&&"object"==typeof t}},{key:"isObjectLiteral",value:function(t){return"object"==typeof t&&t&&t.constructor===Object}},{key:"getArrayIndex",value:function(e,n){return t.getModuloIndex(e,n.length)}},{key:"equalValues",value:function(e,n){return typeof e==typeof n&&(t.isObjectLiteral(e)?t.isObjectLiteral(n)&&t.equalObjectLiterals(e,n):Array.isArray(e)?Array.isArray(n)&&t.equalArrays(e,n):e===n)}},{key:"equalObjectLiterals",value:function(e,n){var i=Object.keys(e),r=Object.keys(n);if(i.length!==r.length)return!1;for(var o=0,s=i.length;o<s;o++){var a=i[o],u=r[o];if(a!==u)return!1;var l=e[a],h=n[u];if(!t.equalValues(l,h))return!1}return!0}},{key:"equalArrays",value:function(t,e){if(t.length!==e.length)return!1;for(var n=0,i=t.length;n<i;n++)if(!this.equalValues(t[n],e[n]))return!1;return!0}}]),t}(),bs=function(){function t(e,n){_(this,t),this._id=e,this._gl=n,this._program=void 0,this._buffers=new Map,this._framebuffers=new Map,this._renderbuffers=new Map,this._vertexAttribs=new Array(16),this._nonDefaultFlags=new Set,this._settings=new Map,this._textures=new Array(8),this._maxTexture=0,this._activeTexture=n.TEXTURE0,this._pixelStorei=new Array(5)}return v(t,[{key:"_getDefaultFlag",value:function(t){return t===this._gl.DITHER}},{key:"setFlag",value:function(t,e){return e===this._getDefaultFlag(t)?this._nonDefaultFlags.delete(t):!this._nonDefaultFlags.has(t)&&(this._nonDefaultFlags.add(t),!0)}},{key:"setBuffer",value:function(t,e){var n=this._buffers.get(t)!==e;return this._buffers.set(t,e),n&&t===this._gl.ARRAY_BUFFER&&(this._vertexAttribs=[]),n}},{key:"setFramebuffer",value:function(t,e){var n=this._framebuffers.get(t)!==e;return this._framebuffers.set(t,e),n}},{key:"setRenderbuffer",value:function(t,e){var n=this._renderbuffers.get(t)!==e;return this._renderbuffers.set(t,e),n}},{key:"setProgram",value:function(t){var e=this._program!==t;return this._program=t,e}},{key:"setSetting",value:function(t,e){var n=this._settings.get(t),i=!n||!Ts.equalValues(n,e);return this._settings.set(t,e),i}},{key:"disableVertexAttribArray",value:function(t){var e=this._vertexAttribs[t];return!(!e||!e[5])&&(e[5]=!1,!0)}},{key:"enableVertexAttribArray",value:function(t){var e=this._vertexAttribs[t];return e?!e[0]&&(e[0]=!0,!0):(this._vertexAttribs[t]=[0,0,0,0,0,!0],!0)}},{key:"vertexAttribPointer",value:function(t,e){var n=this._vertexAttribs[t],i=!1;return n&&(i=n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]),!i&&(e[5]=!!n&&n[5],!0)}},{key:"setActiveTexture",value:function(t){var e=this._activeTexture!==t;return this._activeTexture=t,e}},{key:"bindTexture",value:function(e,n){var i=t._getTextureIndex(this._activeTexture);this._maxTexture=Math.max(this._maxTexture,i+1);var r=this._textures[i],o=t._getTextureTargetIndex(e);return r?r[o]!==n&&(r[o]=n,!0):!!n&&(this._textures[i]=[],this._textures[i][o]=n,!0)}},{key:"setPixelStorei",value:function(e,n){var i=t._getPixelStoreiIndex(e),r=!Ts.equalValues(this._pixelStorei[i],n);return this._pixelStorei[i]=n,r}},{key:"migrate",value:function(t){var e=this;this._migrateFlags(e,t),t._program!==e._program&&this._gl._useProgram(t._program),this._migrateFramebuffers(e,t),this._migrateRenderbuffers(e,t);var n=this._migrateBuffers(e,t);this._migrateAttributes(e,t,n),this._migrateFlags(e,t),this._migrateSettings(e,t),this._migratePixelStorei(e,t),this._migrateTextures(e,t)}},{key:"_migratePixelStorei",value:function(e,n){for(var i=0,r=e._pixelStorei.length;i<r;i++)if(e._pixelStorei[i]!==n._pixelStorei[i]){var o=void 0!==n._pixelStorei[i]?n._pixelStorei[i]:t._getDefaultPixelStoreiByIndex(i);this._gl._pixelStorei(t._getPixelStoreiByIndex(i),o)}}},{key:"_migrateTextures",value:function(e,n){for(var i=Math.max(e._maxTexture,n._maxTexture),r=e._activeTexture,o=0;o<i;o++)for(var s=n._textures[o],a=e._textures[o],u=t._getTextureByIndex(o),l=0,h=Math.max(a?a.length:0,s?s.length:0);l<h;l++){var c=t._getTextureTargetByIndex(l);r!==u&&(this._gl._activeTexture(u),r=u);var f=s&&s[l]||null;this._gl._bindTexture(c,f)}n._activeTexture!==r&&this._gl._activeTexture(n._activeTexture)}},{key:"_migrateBuffers",value:function(t,e){var n=this;return e._buffers.forEach((function(e,i){t._buffers.get(i)!==e&&n._gl._bindBuffer(i,e)})),t._buffers.forEach((function(t,i){void 0===e._buffers.get(i)&&n._gl._bindBuffer(i,null)})),e._buffers.get(this._gl.ARRAY_BUFFER)!==t._buffers.get(this._gl.ARRAY_BUFFER)}},{key:"_migrateFramebuffers",value:function(t,e){var n=this;e._framebuffers.forEach((function(e,i){t._framebuffers.get(i)!==e&&n._gl._bindFramebuffer(i,e)})),t._framebuffers.forEach((function(t,i){void 0===e._framebuffers.get(i)&&n._gl._bindFramebuffer(i,null)}))}},{key:"_migrateRenderbuffers",value:function(t,e){var n=this;e._renderbuffers.forEach((function(e,i){t._renderbuffers.get(i)!==e&&n._gl._bindRenderbuffer(i,e)})),t._renderbuffers.forEach((function(t,i){void 0===e._renderbuffers.get(i)&&n._gl._bindRenderbuffer(i,null)}))}},{key:"_migrateAttributes",value:function(t,e,n){var i=this;n?e._vertexAttribs.forEach((function(t,e){t[0]&&i._gl._vertexAttribPointer(e,t[0],t[1],t[2],t[3],t[4]),t[5]&&i._gl._enableVertexAttribArray(e)})):(t._vertexAttribs.forEach((function(t,n){e._vertexAttribs[n]||i._gl._disableVertexAttribArray(n)})),e._vertexAttribs.forEach((function(t,e){i._gl._vertexAttribPointer(e,t[0],t[1],t[2],t[4]),t[5]?i._gl._enableVertexAttribArray(e):i._gl._disableVertexAttribArray(e)})))}},{key:"_migrateSettings",value:function(t,e){var n=this,i=this.constructor.getDefaultSettings();t._settings.forEach((function(t,r){var o=r.name||r.xname;if(!e._settings.has(r)){var s=i.get(o);Ts.isFunction(s)&&(s=s(n._gl)),e._settings.set(r,s),r.apply(n._gl,s)}})),e._settings.forEach((function(e,i){var r=t._settings.get(i);r&&Ts.equalValues(r,e)||i.apply(n._gl,e)}))}},{key:"_migrateFlags",value:function(t,e){var n=this;t._nonDefaultFlags.forEach((function(t){e._nonDefaultFlags.has(t)||(n._getDefaultFlag(t)?n._gl._enable(t):n._gl._disable(t))})),e._nonDefaultFlags.forEach((function(e){t._nonDefaultFlags.has(e)||(n._getDefaultFlag(e)?n._gl._disable(e):n._gl._enable(e))}))}}],[{key:"getDefaultSettings",value:function(){if(!this._defaultSettings){this._defaultSettings=new Map;var t=this._defaultSettings,e=WebGLRenderingContext.prototype;t.set("viewport",(function(t){return[0,0,t.canvas.width,t.canvas.height]})),t.set("scissor",(function(t){return[0,0,t.canvas.width,t.canvas.height]})),t.set("blendColor",[0,0,0,0]),t.set("blendEquation",[e.FUNC_ADD]),t.set("blendEquationSeparate",[e.FUNC_ADD,e.FUNC_ADD]),t.set("blendFunc",[e.ONE,e.ZERO]),t.set("blendFuncSeparate",[e.ONE,e.ZERO,e.ONE,e.ZERO]),t.set("clearColor",[0,0,0,0]),t.set("clearDepth",[1]),t.set("clearStencil",[0]),t.set("colorMask",[!0,!0,!0,!0]),t.set("cullFace",[e.BACK]),t.set("depthFunc",[e.LESS]),t.set("depthMask",[!0]),t.set("depthRange",[0,1]),t.set("frontFace",[e.CCW]),t.set("lineWidth",[1]),t.set("polygonOffset",[0,0]),t.set("sampleCoverage",[1,!1]),t.set("stencilFunc",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateFront",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateBack",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateFrontAndBack",[e.ALWAYS,0,1]),t.set("stencilMask",[1]),t.set("_stencilMaskSeparateFront",[1]),t.set("_stencilMaskSeparateBack",[1]),t.set("_stencilMaskSeparateFrontAndBack",[1]),t.set("stencilOp",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateFront",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateBack",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateFrontAndBack",[e.KEEP,e.KEEP,e.KEEP]),t.set("vertexAttrib1f",[]),t.set("vertexAttrib1fv",[]),t.set("vertexAttrib2f",[]),t.set("vertexAttrib2fv",[]),t.set("vertexAttrib3f",[]),t.set("vertexAttrib3fv",[]),t.set("vertexAttrib4f",[]),t.set("vertexAttrib4fv",[])}return this._defaultSettings}},{key:"_getTextureTargetIndex",value:function(t){switch(t){case 3553:return 0;case 34067:return 1;default:throw new Error("Unknown texture target: "+t)}}},{key:"_getTextureTargetByIndex",value:function(t){return this._textureTargetIndices||(this._textureTargetIndices=[3553,34067]),this._textureTargetIndices[t]}},{key:"_getTextureIndex",value:function(t){return t-33984}},{key:"_getTextureByIndex",value:function(t){return t+33984}},{key:"_getPixelStoreiIndex",value:function(t){switch(t){case 3333:return 0;case 3317:return 1;case 37440:return 2;case 37441:return 3;case 37443:return 4;case 37445:return 5;default:throw new Error("Unknown pixelstorei: "+t)}}},{key:"_getPixelStoreiByIndex",value:function(t){return this._pixelStoreiIndices||(this._pixelStoreiIndices=[3333,3317,37440,37441,37443]),this._pixelStoreiIndices[t]}},{key:"_getDefaultPixelStoreiByIndex",value:function(t){return this._pixelStoreiDefaults||(this._pixelStoreiDefaults=[4,4,!1,!1,WebGLRenderingContext.prototype.BROWSER_DEFAULT_WEBGL]),this._pixelStoreiDefaults[t]}}]),t}(),ws=function(){function t(){_(this,t)}return v(t,[{key:"_initStateManager",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this._states={},this._state=this._getState(t)}},{key:"_getState",value:function(t){return this._states[t]||(this._states[t]=new bs(t,this)),this._states[t]}},{key:"switchState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if(this._state._id!==t){var e=this._getState(t);this._state.migrate(e),this._state=e}}},{key:"$useProgram",value:function(t){this._state.setProgram(t)&&this._useProgram(t)}},{key:"$bindBuffer",value:function(t,e){this._state.setBuffer(t,e)&&this._bindBuffer(t,e)}},{key:"$bindFramebuffer",value:function(t,e){this._state.setFramebuffer(t,e)&&this._bindFramebuffer(t,e)}},{key:"$bindRenderbuffer",value:function(t,e){this._state.setRenderbuffer(t,e)&&this._bindRenderbuffer(t,e)}},{key:"$enable",value:function(t){this._state.setFlag(t,!0)&&this._enable(t)}},{key:"$disable",value:function(t){this._state.setFlag(t,!1)&&this._disable(t)}},{key:"$viewport",value:function(t,e,n,i){this._state.setSetting(this._viewport,[t,e,n,i])&&this._viewport(t,e,n,i)}},{key:"$scissor",value:function(t,e,n,i){this._state.setSetting(this._scissor,[t,e,n,i])&&this._scissor(t,e,n,i)}},{key:"$disableVertexAttribArray",value:function(t){this._state.disableVertexAttribArray(t)&&this._disableVertexAttribArray(t)}},{key:"$enableVertexAttribArray",value:function(t){this._state.enableVertexAttribArray(t)&&this._enableVertexAttribArray(t)}},{key:"$vertexAttribPointer",value:function(t,e,n,i,r,o){this._state.vertexAttribPointer(t,[e,n,i,r,o])&&this._vertexAttribPointer(t,e,n,i,r,o)}},{key:"$activeTexture",value:function(t){this._state.setActiveTexture(t)&&this._activeTexture(t)}},{key:"$bindTexture",value:function(t,e){this._state.bindTexture(t,e)&&this._bindTexture(t,e)}},{key:"$pixelStorei",value:function(t,e){this._state.setPixelStorei(t,e)&&this._pixelStorei(t,e)}},{key:"$stencilFuncSeparate",value:function(t,e,n,i){var r;switch(t){case this.FRONT:r=this._stencilFuncSeparateFront;break;case this.BACK:r=this._stencilFuncSeparateBack;break;case this.FRONT_AND_BACK:r=this._stencilFuncSeparateFrontAndBack}this._state.setSetting(r,[e,n,i])&&r.apply(this,[e,n,i])}},{key:"_stencilFuncSeparateFront",value:function(t,e,n){this._stencilFuncSeparate(this.FRONT,t,e,n)}},{key:"_stencilFuncSeparateBack",value:function(t,e,n){this._stencilFuncSeparate(this.BACK,t,e,n)}},{key:"_stencilFuncSeparateFrontAndBack",value:function(t,e,n){this._stencilFuncSeparate(this.FRONT_AND_BACK,t,e,n)}},{key:"$stencilMaskSeparate",value:function(t,e){var n;switch(t){case this.FRONT:n=this._stencilMaskSeparateFront;break;case this.BACK:n=this._stencilMaskSeparateBack;break;case this.FRONT_AND_BACK:n=this._stencilMaskSeparateFrontAndBack}this._state.setSetting(n,[e])&&n.apply(this,[e])}},{key:"_stencilMaskSeparateFront",value:function(t){this._stencilMaskSeparate(this.FRONT,t)}},{key:"_stencilMaskSeparateBack",value:function(t){this._stencilMaskSeparate(this.BACK,t)}},{key:"_stencilMaskSeparateFrontAndBack",value:function(t){this._stencilMaskSeparate(this.FRONT_AND_BACK,t)}},{key:"$stencilOpSeparate",value:function(t,e,n,i){var r;switch(t){case this.FRONT:r=this._stencilOpSeparateFront;break;case this.BACK:r=this._stencilOpSeparateBack;break;case this.FRONT_AND_BACK:r=this._stencilOpSeparateFrontAndBack}this._state.setSetting(r,[e,n,i])&&r.apply(this,[e,n,i])}},{key:"_stencilOpSeparateFront",value:function(t,e,n){this._stencilOpSeparate(this.FRONT,t,e,n)}},{key:"_stencilOpSeparateBack",value:function(t,e,n){this._stencilOpSeparate(this.BACK,t,e,n)}},{key:"_stencilOpSeparateFrontAndBack",value:function(t,e,n){this._stencilOpSeparate(this.FRONT_AND_BACK,t,e,n)}},{key:"$blendColor",value:function(t,e,n,i){this._state.setSetting(this._blendColor,[t,e,n,i])&&this._blendColor(t,e,n,i)}},{key:"$blendEquation",value:function(t){this._state.setSetting(this._blendEquation,[t])&&this._blendEquation(t)}},{key:"$blendEquationSeparate",value:function(t,e){this._state.setSetting(this._blendEquationSeparate,[t,e])&&this._blendEquationSeparate(t,e)}},{key:"$blendFunc",value:function(t,e){this._state.setSetting(this._blendFunc,[t,e])&&this._blendFunc(t,e)}},{key:"$blendFuncSeparate",value:function(t,e,n,i){this._state.setSetting(this._blendFuncSeparate,[t,e,n,i])&&this._blendFuncSeparate(t,e,n,i)}},{key:"$clearColor",value:function(t,e,n,i){this._state.setSetting(this._clearColor,[t,e,n,i])&&this._clearColor(t,e,n,i)}},{key:"$clearDepth",value:function(t){this._state.setSetting(this._clearDepth,[t])&&this._clearDepth(t)}},{key:"$clearStencil",value:function(t){this._state.setSetting(this._clearStencil,[t])&&this._clearStencil(t)}},{key:"$colorMask",value:function(t,e,n,i){this._state.setSetting(this._colorMask,[t,e,n,i])&&this._colorMask(t,e,n,i)}},{key:"$cullFace",value:function(t){this._state.setSetting(this._cullFace,[t])&&this._cullFace(t)}},{key:"$depthFunc",value:function(t){this._state.setSetting(this._depthFunc,[t])&&this._depthFunc(t)}},{key:"$depthMask",value:function(t){this._state.setSetting(this._depthMask,[t])&&this._depthMask(t)}},{key:"$depthRange",value:function(t,e){this._state.setSetting(this._depthRange,[t,e])&&this._depthRange(t,e)}},{key:"$frontFace",value:function(t){this._state.setSetting(this._frontFace,[t])&&this._frontFace(t)}},{key:"$lineWidth",value:function(t){this._state.setSetting(this._lineWidth,[t])&&this._lineWidth(t)}},{key:"$polygonOffset",value:function(t,e){this._state.setSetting(this._polygonOffset,[t,e])&&this._polygonOffset(t,e)}},{key:"$sampleCoverage",value:function(t,e){this._state.setSetting(this._sampleCoverage,[t,e])&&this._sampleCoverage(t,e)}},{key:"$stencilFunc",value:function(t,e,n){this._state.setSetting(this._stencilFunc,[t,e,n])&&this._stencilFunc(t,e,n)}},{key:"$stencilMask",value:function(t){this._state.setSetting(this._stencilMask,[t])&&this._stencilMask(t)}},{key:"$stencilOp",value:function(t,e,n){this._state.setSetting(this._stencilOp,[t,e,n])&&this._stencilOp(t,e,n)}},{key:"$vertexAttrib1f",value:function(t,e){this._state.setSetting(this._vertexAttrib1f,[t,e])&&this._vertexAttrib1f(t,e)}},{key:"$vertexAttrib1fv",value:function(t,e){this._state.setSetting(this._vertexAttrib1fv,[t,e])&&this._vertexAttrib1fv(t,e)}},{key:"$vertexAttrib2f",value:function(t,e,n){this._state.setSetting(this._vertexAttrib2f,[t,e,n])&&this._vertexAttrib2f(t,e,n)}},{key:"$vertexAttrib2fv",value:function(t,e){this._state.setSetting(this._vertexAttrib2fv,[t,e])&&this._vertexAttrib2fv(t,e)}},{key:"$vertexAttrib3f",value:function(t,e,n,i){this._state.setSetting(this._vertexAttrib3f,[t,e,n,i])&&this._vertexAttrib3f(t,e,n,i)}},{key:"$vertexAttrib3fv",value:function(t,e){this._state.setSetting(this._vertexAttrib3fv,[t,e])&&this._vertexAttrib3fv(t,e)}},{key:"$vertexAttrib4f",value:function(t,e,n,i,r){this._state.setSetting(this._vertexAttrib4f,[t,e,n,i,r])&&this._vertexAttrib4f(t,e,n,i,r)}},{key:"$vertexAttrib4fv",value:function(t,e){this._state.setSetting(this._vertexAttrib4fv,[t,e])&&this._vertexAttrib4fv(t,e)}}],[{key:"enable",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",i=Object.getOwnPropertyNames(t.prototype);return e.__proto__,i.forEach((function(n){if("constructor"!==n){var i=t.prototype[n];"$"===n.charAt(0)&&(n=n.substr(1)),e[n]!==i&&(e[n]&&(e[n].name||(e[n].xname=n),e["_"+n]=e[n]),e[n]=i)}})),t.prototype._initStateManager.call(e,n),e}}]),t}(),Cs=ws,Ss=function(){function t(e){_(this,t),this.stage=e,this._usedMemory=0,this._uploadedTextureSources=[],this.textureSourceHashmap=new Map}return v(t,[{key:"usedMemory",get:function(){return this._usedMemory}},{key:"destroy",value:function(){for(var t=0,e=this._uploadedTextureSources.length;t<e;t++)this._nativeFreeTextureSource(this._uploadedTextureSources[t]);this.textureSourceHashmap.clear(),this._usedMemory=0}},{key:"getReusableTextureSource",value:function(t){return this.textureSourceHashmap.get(t)}},{key:"getTextureSource",value:function(t,e){var n=e?this.textureSourceHashmap.get(e):null;return n||(n=new Co(this,t),e&&(n.lookupId=e,this.textureSourceHashmap.set(e,n))),n}},{key:"uploadTextureSource",value:function(t,e){if(!t.isLoaded()){this._addMemoryUsage(t.w*t.h);var n=this._nativeUploadTextureSource(t,e);t._nativeTexture=n,n.w=t.w,n.h=t.h,n.update=this.stage.frameCounter,this._uploadedTextureSources.push(t),this.addToLookupMap(t),this._updateVramUsage(t,1)}}},{key:"_addMemoryUsage",value:function(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}},{key:"_updateVramUsage",value:function(t,e){var n,i=t.nativeTexture;Fs.isWebglSupported()&&t.isLoaded()&&i.hasOwnProperty("bytesPerPixel")&&!isNaN(i.bytesPerPixel)&&(n=e*(t.w*t.h*i.bytesPerPixel),this.stage.addVramUsage(n,t.hasAlpha))}},{key:"addToLookupMap",value:function(t){var e=t.lookupId;e&&(this.textureSourceHashmap.has(e)||this.textureSourceHashmap.set(e,t))}},{key:"gc",value:function(){this.freeUnusedTextureSources(),this._cleanupLookupMap()}},{key:"freeUnusedTextureSources",value:function(){for(var t=[],e=0,n=this._uploadedTextureSources.length;e<n;e++){var i=this._uploadedTextureSources[e];i.allowCleanup()?this._freeManagedTextureSource(i):t.push(i)}this._uploadedTextureSources=t,this._cleanupLookupMap()}},{key:"_freeManagedTextureSource",value:function(t){t.isLoaded()&&(this._nativeFreeTextureSource(t),this._addMemoryUsage(-t.w*t.h),this._updateVramUsage(t,-1)),t.loadingSince=null}},{key:"_cleanupLookupMap",value:function(){var t=this;this.textureSourceHashmap.forEach((function(e,n){e.isLoaded()||e.isLoading()||e.isUsed()||t.textureSourceHashmap.delete(n)}))}},{key:"freeTextureSource",value:function(t){var e=this._uploadedTextureSources.indexOf(t),n=-1!==e;t.isLoaded()&&(n&&(this._addMemoryUsage(-t.w*t.h),this._uploadedTextureSources.splice(e,1)),this._nativeFreeTextureSource(t)),t.loadingSince=null}},{key:"_nativeUploadTextureSource",value:function(t,e){return this.stage.renderer.uploadTextureSource(t,e)}},{key:"_nativeFreeTextureSource",value:function(t){this.stage.renderer.freeTextureSource(t),t.clearNativeTexture()}}]),t}(),Es=function(){function t(e){var n=this;_(this,t),this.stage=e,this.genericCancelCb=function(t){n._remove(t)},this._sources=[],this._data=[]}return v(t,[{key:"destroy",value:function(){this._sources=[],this._data=[],this.stage=null,delete this._sources,delete this._data,delete this.stage}},{key:"processSome",value:function(){if(this._sources.length){var e=Date.now();do{this._processItem()}while(this._sources.length&&Date.now()-e<t.MAX_UPLOAD_TIME_PER_FRAME)}}},{key:"_processItem",value:function(){var t=this._sources.pop(),e=this._data.pop();t.isLoading()&&t.processLoadedSource(e)}},{key:"add",value:function(t,e){this._sources.push(t),this._data.push(e)}},{key:"_remove",value:function(t){var e=this._sources.indexOf(t);e>=0&&(this._sources.splice(e,1),this._data.splice(e,1))}}]),t}();Es.MAX_UPLOAD_TIME_PER_FRAME=10;var Is=function(){function t(e){_(this,t),this.stage=e,this.root=null,this.updateTreeOrder=0,this.renderState=this.stage.renderer.createCoreRenderState(this),this.renderExec=this.stage.renderer.createCoreRenderExecutor(this),this.renderExec.init(),this._usedMemory=0,this._renderTexturePool=[],this._renderTextureId=1,this._zSorts=[],this.renderToTextureCount=0}return v(t,[{key:"usedMemory",get:function(){return this._usedMemory}},{key:"destroy",value:function(){var t=this;this._renderTexturePool.forEach((function(e){return t._freeRenderTexture(e)})),this._usedMemory=0,this.stage=null,this.root=null,this.renderState=null,this.renderExec=null,this._renderTexturePool=null,this._zSorts=null,delete this.stage,delete this.root,delete this.renderState,delete this.renderExec,delete this._renderTexturePool,delete this._zSorts}},{key:"hasRenderUpdates",value:function(){return!!this.root._parent._hasRenderUpdates}},{key:"render",value:function(){this.root._parent._hasRenderUpdates=0,this._render()}},{key:"update",value:function(){this._update(),this.root._hasUpdates&&this._update(),this._performForcedZSorts()}},{key:"_performForcedZSorts",value:function(){if(this._zSorts.length){for(var t=0,e=this._zSorts.length;t<e;t++)this._zSorts[t].zSort&&this._zSorts[t].sortZIndexedChildren();this._zSorts=[]}}},{key:"_update",value:function(){this.updateTreeOrder=0,this.root.update()}},{key:"_render",value:function(){var t=this.stage.getOption("debugFrame");this._fillRenderState(),this.stage.getOption("readPixelsBeforeDraw")&&this._readPixels(),this._performRender(),t&&console.log("[Lightning] RTT Renders in frame: ".concat(this.renderToTextureCount)),this.stage.getOption("readPixelsAfterDraw")&&this.renderToTextureCount>=this.stage.getOption("readPixelsAfterDrawThreshold")&&(t&&console.log("[Lightning] readPixelsAfterDraw behavior triggered"),this._readPixels()),this.renderToTextureCount=0}},{key:"_readPixels",value:function(){var t=new Uint8Array(4),e=this.stage.gl;e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,t)}},{key:"_fillRenderState",value:function(){this.renderState.reset(),this.root.render(),this.renderState.finish()}},{key:"_performRender",value:function(){this.renderExec.execute()}},{key:"_addMemoryUsage",value:function(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}},{key:"allocateRenderTexture",value:function(t,e){for(var n=this.stage.getRenderPrecision(),i=Math.max(1,Math.round(t*n)),r=Math.max(1,Math.round(e*n)),o=this._renderTexturePool.length-1;o>=0;o--){var s=this._renderTexturePool[o];if(s.w===i&&s.h===r&&s.update!==this.stage.frameCounter)return s.f=this.stage.frameCounter,this._renderTexturePool.splice(o,1),s}var a=this._createRenderTexture(t,e,i,r);return a.precision=n,a}},{key:"releaseRenderTexture",value:function(t){this._renderTexturePool.push(t)}},{key:"freeUnusedRenderTextures",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,n=this.stage.frameCounter-e;this._renderTexturePool=this._renderTexturePool.filter((function(e){return!(e.f<=n)||(t._freeRenderTexture(e),!1)}))}},{key:"_createRenderTexture",value:function(t,e,n,i){this._addMemoryUsage(n*i);var r=this.stage.renderer.createRenderTexture(t,e,n,i);return r.id=this._renderTextureId++,r.f=this.stage.frameCounter,r.ow=t,r.oh=e,r.w=n,r.h=i,r}},{key:"_freeRenderTexture",value:function(t){this.stage.renderer.freeRenderTexture(t),this._addMemoryUsage(-t.w*t.h)}},{key:"copyRenderTexture",value:function(t,e,n){this.stage.renderer.copyRenderTexture(t,e,n)}},{key:"forceZSort",value:function(t){this._zSorts.push(t)}}]),t}(),Ls=function(){function t(e){_(this,t),this.stage=e,this._timingFunction="ease",this._timingFunctionImpl=uo.getTimingFunction(this._timingFunction),this.delay=0,this.duration=.2,this.merger=null}return v(t,[{key:"timingFunction",get:function(){return this._timingFunction},set:function(t){this._timingFunction=t,this._timingFunctionImpl=uo.getTimingFunction(t)}},{key:"timingFunctionImpl",get:function(){return this._timingFunctionImpl}},{key:"patch",value:function(t){ho.patchObject(this,t)}}]),t}();Ls.prototype.isTransitionSettings=!0;var Rs=function(){function t(e){var n=this;_(this,t),this.stage=e,this.stage.on("frameStart",(function(){return n.progress()})),this.active=new Set,this.defaultTransitionSettings=new Ls(this.stage)}return v(t,[{key:"progress",value:function(){if(this.active.size){var t=this.stage.dt,e=!1;this.active.forEach((function(n){n.progress(t),n.isRunning()||(e=!0)})),e&&(this.active=new Set(y(this.active).filter((function(t){return t.isRunning()}))))}}},{key:"createSettings",value:function(t){var e=new Ls;return ho.patchObject(e,t),e}},{key:"addActive",value:function(t){this.active.add(t)}},{key:"removeActive",value:function(t){this.active.delete(t)}}]),t}(),Ms=function(){function t(){_(this,t),this._clear()}return v(t,[{key:"_clear",value:function(){this._p=[],this._pe=[],this._idp=[],this._f=[],this._v=[],this._lv=[],this._sm=[],this._s=[],this._ve=[],this._sme=[],this._se=[],this._length=0}},{key:"parse",value:function(e,n){var i,r;lo.isObjectLiteral(n)||(n={0:n});var o=.5,s=[];for(var a in n)if(n.hasOwnProperty(a)){var u=n[a];lo.isObjectLiteral(u)||(u={v:u});var l=parseFloat(a);"sm"===a?o=u.v:!isNaN(l)&&l>=0&&l<=2&&(u.p=l,u.f=lo.isFunction(u.v),u.lv=u.f?u.v(0,0):u.v,s.push(u))}for(r=(s=s.sort((function(t,e){return t.p-e.p}))).length,i=0;i<r;i++){var h=i===r-1;if(s[i].hasOwnProperty("pe")){var c=i<r-1?s[i+1].p:1;s[i].pe>c&&(s[i].pe=c)}else s[i].pe=h?s[i].p<=1?1:2:s[i+1].p;s[i].pe===s[i].p?s[i].idp=0:s[i].idp=1/(s[i].pe-s[i].p)}for(i=0;i<r;i++)if(s[i].hasOwnProperty("sm")||(s[i].sm=o),!s[i].hasOwnProperty("s"))if(0===i||i===r-1||1===s[i].p)s[i].s=e?[0,0,0,0]:0;else{var f=s[i-1],d=s[i+1];if(f.p===d.p)s[i].s=e?[0,0,0,0]:0;else if(e){var A=t.getRgbaComponents(d.lv),g=t.getRgbaComponents(f.lv),p=1/(d.p-f.p);s[i].s=[p*(A[0]-g[0]),p*(A[1]-g[1]),p*(A[2]-g[2]),p*(A[3]-g[3])]}else s[i].s=(d.lv-f.lv)/(d.p-f.p)}for(i=0;i<r-1;i++)if(!s[i].f){var v=i===r-1;s[i].hasOwnProperty("ve")||(s[i].ve=v?s[i].lv:s[i+1].lv),lo.isNumber(s[i].v)&&lo.isNumber(s[i].lv)&&(s[i].hasOwnProperty("sme")||(s[i].sme=v?o:s[i+1].sm),s[i].hasOwnProperty("se")||(s[i].se=v?e?[0,0,0,0]:0:s[i+1].s),s[i].v=e?t.getSplineRgbaValueFunction(s[i].v,s[i].ve,s[i].p,s[i].pe,s[i].sm,s[i].sme,s[i].s,s[i].se):t.getSplineValueFunction(s[i].v,s[i].ve,s[i].p,s[i].pe,s[i].sm,s[i].sme,s[i].s,s[i].se),s[i].f=!0)}for(this.length&&this._clear(),i=0,r=s.length;i<r;i++)this._add(s[i])}},{key:"_add",value:function(t){this._p.push(t.p||0),this._pe.push(t.pe||0),this._idp.push(t.idp||0),this._f.push(t.f||!1),this._v.push(t.hasOwnProperty("v")?t.v:0),this._lv.push(t.lv||0),this._sm.push(t.sm||0),this._s.push(t.s||0),this._ve.push(t.ve||0),this._sme.push(t.sme||0),this._se.push(t.se||0),this._length++}},{key:"_getItem",value:function(t){var e=this._length;if(!e)return-1;if(t<this._p[0])return 0;for(var n=0;n<e;n++)if(this._p[n]<=t&&t<this._pe[n])return n;return e-1}},{key:"getValue",value:function(t){var e=this._getItem(t);if(-1!==e){if(this._f[e]){var n=Math.min(1,Math.max(0,(t-this._p[e])*this._idp[e]));return this._v[e](n)}return this._v[e]}}},{key:"length",get:function(){return this._length}}],[{key:"getRgbaComponents",value:function(t){return[(t/65536|0)%256,(t/256|0)%256,t%256,t/16777216|0]}},{key:"getSplineValueFunction",value:function(e,n,i,r,o,s,a,u){var l=r-i;a*=l,u*=l;var h=t.getSplineHelpers(e,n,o,s,a,u);return h?function(i){return 0===i?e:1===i?n:t.calculateSpline(h,i)}:function(t){return 0===t?e:1===t?n:n*t+e*(1-t)}}},{key:"getSplineRgbaValueFunction",value:function(e,n,i,r,o,s,a,u){var l=r-i;a[0]*=l,a[1]*=l,a[2]*=l,a[3]*=l,u[0]*=l,u[1]*=l,u[2]*=l,u[3]*=l;var h=t.getRgbaComponents(e),c=t.getRgbaComponents(n),f=[t.getSplineHelpers(h[0],c[0],o,s,a[0],u[0]),t.getSplineHelpers(h[1],c[1],o,s,a[1],u[1]),t.getSplineHelpers(h[2],c[2],o,s,a[2],u[2]),t.getSplineHelpers(h[3],c[3],o,s,a[3],u[3])];return f[0]?function(i){return 0===i?e:1===i?n:t.getArgbNumber([Math.min(255,t.calculateSpline(f[0],i)),Math.min(255,t.calculateSpline(f[1],i)),Math.min(255,t.calculateSpline(f[2],i)),Math.min(255,t.calculateSpline(f[3],i))])}:function(i){return 0===i?e:1===i?n:t.mergeColors(n,e,i)}}},{key:"getSplineHelpers",value:function(t,e,n,i,r,o){if(!n&&!i)return null;var s=t+r*n,a=1-i,u=e-o*i;return[3*n-3*a+1,-6*n+3*a,3*n,3*s-3*u+e-t,3*(u+t)-6*s,3*(s-t),t]}},{key:"calculateSpline",value:function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],u=t[6];if(-2===n&&-2===o&&0===r&&0===a)return e;for(var l,h=.5,c=0;c<20;c++){if((l=e-h*(h*(h*n+i)+r))>-1e-8&&l<1e-8)return h*(h*(h*o+s)+a)+u;var f=h*(h*(3*n)+2*i)+r;if(f>1e-10&&f<1e-10)break;h+=l/f}for(var d=0,A=1,g=0;g<20;g++){if((l=e-(h=.5*(d+A))*(h*(h*n+i)+r))>-1e-8&&l<1e-8)return h*(h*(h*o+s)+a)+u;l<0?A=h:d=h}return h}},{key:"mergeColors",value:function(t,e,n){var i=(t/65536|0)%256*n+(e/65536|0)%256*(1-n),r=(t/256|0)%256*n+(e/256|0)%256*(1-n),o=t%256*n+e%256*(1-n),s=(t/16777216|0)*n+(e/16777216|0)*(1-n);return 16777216*Math.round(s)+65536*Math.round(i)+256*Math.round(r)+Math.round(o)}},{key:"getArgbNumber",value:function(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));var e=((0|t[3])<<24)+((0|t[0])<<16)+((0|t[1])<<8)+(0|t[2]);return e<0&&(e=4294967295+e+1),e}}]),t}(),Ps=function(){function t(e){_(this,t),this.animationSettings=e,this._selector="",this._items=new Ms,this._props=[],this._propSetters=[],this._resetValue=void 0,this._hasResetValue=!1,this._hasColorProperty=void 0}return v(t,[{key:"getResetValue",value:function(){return this._hasResetValue?this._resetValue:this._items.getValue(0)}},{key:"apply",value:function(t,e,n){var i=this.getAnimatedElements(t),r=this._items.getValue(e);if(void 0!==r&&i.length){if(1!==n){var o=this.getResetValue();lo.isNumber(r)&&lo.isNumber(o)&&(r=this.hasColorProperty()?uo.mergeColors(r,o,n):uo.mergeNumbers(r,o,n))}for(var s=this._propSetters.length,a=i.length,u=0;u<a;u++)for(var l=0;l<s;l++)this._propSetters[l](i[u],r)}}},{key:"getAnimatedElements",value:function(t){return t.select(this._selector)}},{key:"reset",value:function(t){var e=this.getAnimatedElements(t),n=this.getResetValue();if(void 0!==n&&e.length)for(var i=this._propSetters.length,r=e.length,o=0;o<r;o++)for(var s=0;s<i;s++)this._propSetters[s](e[o],n)}},{key:"selector",set:function(t){this._selector=t}},{key:"t",set:function(t){this.selector=t}},{key:"resetValue",get:function(){return this._resetValue},set:function(t){this._resetValue=t,this._hasResetValue=void 0!==t}},{key:"rv",set:function(t){this.resetValue=t}},{key:"value",set:function(t){this._items.parse(this.hasColorProperty(),t)}},{key:"v",set:function(t){this.value=t}},{key:"properties",set:function(t){var e=this;Array.isArray(t)||(t=[t]),this._props=[],t.forEach((function(t){e._props.push(t),e._propSetters.push(Yo.getSetter(t))}))}},{key:"property",set:function(t){this._hasColorProperty=void 0,this.properties=t}},{key:"p",set:function(t){this.properties=t}},{key:"patch",value:function(t){ho.patchObject(this,t)}},{key:"hasColorProperty",value:function(){return void 0===this._hasColorProperty&&(this._hasColorProperty=!!this._props.length&&Yo.isColorProperty(this._props[0])),this._hasColorProperty}}]),t}();Ps.prototype.isAnimationActionSettings=!0;var zs=function(){function t(){_(this,t),this._actions=[],this.delay=0,this.duration=1,this.repeat=0,this.repeatOffset=0,this.repeatDelay=0,this.autostop=!1,this.stopMethod=t.STOP_METHODS.FADE,this._stopTimingFunction="ease",this._stopTimingFunctionImpl=uo.getTimingFunction(this._stopTimingFunction),this.stopDuration=0,this.stopDelay=0}return v(t,[{key:"actions",get:function(){return this._actions},set:function(t){this._actions=[];for(var e=0,n=t.length;e<n;e++){var i=t[e];if(i.isAnimationActionSettings)this._actions.push(i);else{var r=new Ps(this);r.patch(i),this._actions.push(r)}}}},{key:"apply",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._actions.forEach((function(i){i.apply(t,e,n)}))}},{key:"reset",value:function(t){this._actions.forEach((function(e){e.reset(t)}))}},{key:"stopTimingFunction",get:function(){return this._stopTimingFunction},set:function(t){this._stopTimingFunction=t,this._stopTimingFunctionImpl=uo.getTimingFunction(t)}},{key:"stopTimingFunctionImpl",get:function(){return this._stopTimingFunctionImpl}},{key:"patch",value:function(t){ho.patchObject(this,t)}}]),t}();zs.STOP_METHODS={FADE:"fade",REVERSE:"reverse",FORWARD:"forward",IMMEDIATE:"immediate",ONETOTWO:"onetotwo"};var Bs=function(t){l(n,t);var e=c(n);function n(t,i,r){var o;return _(this,n),(o=e.call(this)).manager=t,o._settings=i,o._element=r,o._state=n.STATES.IDLE,o._p=0,o._delayLeft=0,o._repeatsLeft=0,o._stopDelayLeft=0,o._stopP=0,o}return v(n,[{key:"start",value:function(){this._element&&this._element.attached?(this._p=0,this._delayLeft=this.settings.delay,this._repeatsLeft=this.settings.repeat,this._state=n.STATES.PLAYING,this.emit("start"),this.checkActive()):console.warn("[Lightning] Element must be attached before starting animation")}},{key:"play",value:function(){this._state===n.STATES.PAUSED?(this._state=n.STATES.PLAYING,this.checkActive(),this.emit("resume")):this._state==n.STATES.STOPPING&&this.settings.stopMethod==zs.STOP_METHODS.REVERSE?(this._state=n.STATES.PLAYING,this.emit("stopContinue")):this._state!=n.STATES.PLAYING&&this._state!=n.STATES.FINISHED&&this.start()}},{key:"pause",value:function(){this._state===n.STATES.PLAYING&&(this._state=n.STATES.PAUSED,this.emit("pause"))}},{key:"replay",value:function(){this._state==n.STATES.FINISHED?this.start():this.play()}},{key:"skipDelay",value:function(){this._delayLeft=0,this._stopDelayLeft=0}},{key:"finish",value:function(){this._state===n.STATES.PLAYING?(this._delayLeft=0,this._p=1):this._state===n.STATES.STOPPING&&(this._stopDelayLeft=0,this._p=0)}},{key:"stop",value:function(){this._state!==n.STATES.STOPPED&&this._state!==n.STATES.IDLE&&(this._stopDelayLeft=this.settings.stopDelay||0,this.settings.stopMethod===zs.STOP_METHODS.IMMEDIATE&&!this._stopDelayLeft||this._delayLeft>0?(this._state=n.STATES.STOPPING,this.emit("stop")):(this.settings.stopMethod===zs.STOP_METHODS.FADE&&(this._stopP=0),this._state=n.STATES.STOPPING,this.emit("stop")),this.checkActive())}},{key:"stopNow",value:function(){this._state===n.STATES.STOPPED&&this._state===n.STATES.IDLE||(this._state=n.STATES.STOPPING,this._p=0,this.emit("stop"),this.reset(),this._state=n.STATES.STOPPED,this.emit("stopFinish"))}},{key:"isPaused",value:function(){return this._state===n.STATES.PAUSED}},{key:"isPlaying",value:function(){return this._state===n.STATES.PLAYING}},{key:"isStopping",value:function(){return this._state===n.STATES.STOPPING}},{key:"isFinished",value:function(){return this._state===n.STATES.FINISHED}},{key:"checkActive",value:function(){this.isActive()&&this.manager.addActive(this)}},{key:"isActive",value:function(){return(this._state==n.STATES.PLAYING||this._state==n.STATES.STOPPING)&&this._element&&this._element.attached}},{key:"progress",value:function(t){this._element&&(this._progress(t),this.apply())}},{key:"_progress",value:function(t){if(this._state!=n.STATES.STOPPING){if(this._state==n.STATES.PLAYING){if(this._delayLeft>0){if(this._delayLeft-=t,!(this._delayLeft<0))return;t=-this._delayLeft,this._delayLeft=0,this.emit("delayEnd")}0===this.settings.duration?this._p=1:this.settings.duration>0&&(this._p+=t/this.settings.duration),this._p>=1?-1==this.settings.repeat||this._repeatsLeft>0?(this._repeatsLeft>0&&this._repeatsLeft--,this._p=this.settings.repeatOffset,this.emit("progress",this._p),this.settings.repeatDelay&&(this._delayLeft=this.settings.repeatDelay),this.emit("repeat",this._repeatsLeft)):(this._p=1,this.emit("progress",this._p),this._state=n.STATES.FINISHED,this.emit("finish"),this.settings.autostop&&this.stop()):this.emit("progress",this._p)}}else this._stopProgress(t)}},{key:"_stopProgress",value:function(t){var e=this._getStopDuration();if(this._stopDelayLeft>0){if(this._stopDelayLeft-=t,!(this._stopDelayLeft<0))return;t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("stopDelayEnd")}this.settings.stopMethod==zs.STOP_METHODS.IMMEDIATE?(this._state=n.STATES.STOPPED,this.emit("stopFinish")):this.settings.stopMethod==zs.STOP_METHODS.REVERSE?(0===e?this._p=0:e>0&&(this._p-=t/e),this._p<=0&&(this._p=0,this._state=n.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==zs.STOP_METHODS.FADE?(this._progressStopTransition(t),this._stopP>=1&&(this._p=0,this._state=n.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==zs.STOP_METHODS.ONETOTWO?this._p<2&&(0===e?this._p=2:e>0&&(this._p<1?this._p+=t/this.settings.duration:this._p+=t/e),this._p>=2?(this._p=2,this._state=n.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p)):this.settings.stopMethod==zs.STOP_METHODS.FORWARD&&this._p<1&&(0==this.settings.duration?this._p=1:this._p+=t/this.settings.duration,this._p>=1?this.settings.stopMethod==zs.STOP_METHODS.FORWARD?(this._p=1,this._state=n.STATES.STOPPED,this.emit("stopFinish")):this._repeatsLeft>0?(this._repeatsLeft--,this._p=0,this.emit("repeat",this._repeatsLeft)):(this._p=1,this._state=n.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p))}},{key:"_progressStopTransition",value:function(t){if(this._stopP<1){if(this._stopDelayLeft>0){if(this._stopDelayLeft-=t,!(this._stopDelayLeft<0))return;t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("delayEnd")}var e=this._getStopDuration();0==e?this._stopP=1:this._stopP+=t/e,this._stopP>=1&&(this._stopP=1)}}},{key:"_getStopDuration",value:function(){return this.settings.stopDuration||this.settings.duration}},{key:"apply",value:function(){if(this._state===n.STATES.STOPPED)this.reset();else{var t=1;this._state===n.STATES.STOPPING&&this.settings.stopMethod===zs.STOP_METHODS.FADE&&(t=1-this.settings.stopTimingFunctionImpl(this._stopP)),this._settings.apply(this._element,this._p,t)}}},{key:"reset",value:function(){this._settings.reset(this._element)}},{key:"state",get:function(){return this._state}},{key:"p",get:function(){return this._p}},{key:"delayLeft",get:function(){return this._delayLeft}},{key:"element",get:function(){return this._element}},{key:"frame",get:function(){return Math.round(this._p*this._settings.duration*60)}},{key:"settings",get:function(){return this._settings}}]),n}(Lo);Bs.STATES={IDLE:0,PLAYING:1,STOPPING:2,STOPPED:3,FINISHED:4,PAUSED:5};var Os=function(){function t(e){var n=this;_(this,t),this.stage=e,this.stage.on("frameStart",(function(){return n.progress()})),this.active=new Set}return v(t,[{key:"progress",value:function(){if(this.active.size){var t=this.stage.dt,e=!1;this.active.forEach((function(n){n.isActive()?n.progress(t):e=!0})),e&&(this.active=new Set(y(this.active).filter((function(t){return t.isActive()}))))}}},{key:"createAnimation",value:function(t,e){return lo.isObjectLiteral(e)&&(e=this.createSettings(e)),new Bs(this,e,t)}},{key:"createSettings",value:function(t){var e=new zs;return ho.patchObject(e,t),e}},{key:"addActive",value:function(t){this.active.add(t)}}]),t}(),Ds=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"_getLookupId",value:function(){return"__whitepix"}},{key:"_getSourceLoader",value:function(){return function(t){t(null,{source:new Uint8Array([255,255,255,255]),w:1,h:1,permanent:!0})}}},{key:"isAutosizeTexture",value:function(){return!1}}]),n}(Mo),Fs=function(t){l(n,t);var e=c(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_(this,n),(t=e.call(this))._setOptions(i),t._usedMemory=0,t._lastGcFrame=0,t._usedVramAlpha=0,t._usedVramNonAlpha=0;var r=n.platform?n.platform:ks.load(i);t.platform=new r,t.platform.init&&t.platform.init(d(t)),t.gl=null,t.c2d=null;var o=t.getOption("context");if(o?o.useProgram?t.gl=o:t.c2d=o:!lo.isWeb||n.isWebglSupported()&&!t.getOption("canvas2d")?t.gl=t.platform.createWebGLContext(t.getOption("w"),t.getOption("h")):t.c2d=t.platform.createCanvasContext(t.getOption("w"),t.getOption("h")),t.gl&&Cs.enable(t.gl,"lightning"),t._mode=t.gl?0:1,t.getCanvas()){if(1!==t.getOption("devicePixelRatio")){var s=t.getOption("devicePixelRatio");t.getCanvas().style.width=t._options.w/s+"px",t.getCanvas().style.height=t._options.h/s+"px"}t._options.w=t.getCanvas().width,t._options.h=t.getCanvas().height}return 0===t._mode?lo.isSpark?t._renderer=new vs(d(t)):t._renderer=new as(d(t)):t._renderer=new gs(d(t)),t.setClearColor(t.getOption("clearColor")),t.frameCounter=0,t.transitions=new Rs(d(t)),t.animations=new Os(d(t)),t.textureManager=new Ss(d(t)),t.textureThrottler=new Es(d(t)),t.startTime=0,t.currentTime=0,t.dt=0,t.rectangleTexture=new Ds(d(t)),t.rectangleTexture.load(),t.rectangleTexture.source.permanent=!0,t.ctx=new Is(d(t)),t._updateSourceTextures=new Set,t}return v(n,[{key:"renderer",get:function(){return this._renderer}},{key:"mode",get:function(){return this._mode}},{key:"isWebgl",value:function(){return 0===this.mode}},{key:"isC2d",value:function(){return 1===this.mode}},{key:"getOption",value:function(t){return this._options[t]}},{key:"_setOptions",value:function(t){var e=this;this._options={};var n=function(n,i){var r=t[n];e._options[n]=void 0===r?i:r};n("canvas",null),n("context",null),n("w",1920),n("h",1080),n("srcBasePath",null),n("memoryPressure",24e6),n("bufferMemory",2e6),n("textRenderIssueMargin",0),n("fontSharp",{precision:.6666666667,fontSize:24}),n("clearColor",[0,0,0,0]),n("defaultFontFace","sans-serif"),n("fixedDt",0),n("useImageWorker",!0),n("autostart",!0),n("precision",1),n("canvas2d",!1),n("platform",null),n("readPixelsBeforeDraw",!1),n("devicePixelRatio",1),n("readPixelsAfterDraw",!1),n("readPixelsAfterDrawThreshold",0),n("debugFrame",!1),n("forceTxCanvasSource",!1),n("pauseRafLoopOnIdle",!1),null!=t.devicePixelRatio&&1!==t.devicePixelRatio&&(this._options.precision*=t.devicePixelRatio,this._options.w*=t.devicePixelRatio,this._options.h*=t.devicePixelRatio)}},{key:"setApplication",value:function(t){this.application=t}},{key:"init",value:function(){this.application.getOption("debug")&&this.platform._imageWorker&&console.log("[Lightning] Using image worker!"),this.application.getOption("debug")&&this.c2d&&console.log("[Lightning] Using canvas2d renderer"),this.application.setAsRoot(),this.getOption("autostart")&&this.platform.startLoop()}},{key:"destroy",value:function(){this.platform.stopLoop(),this.platform.destroy(),this.ctx.destroy(),this.textureManager.destroy(),this._renderer.destroy(),this.gl?(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)):this.c2d&&this.c2d.clearRect(0,0,this.c2d.canvas.width,this.c2d.canvas.height),this.gl=null,this.c2d=null,this.ctx=null,this._options=null,this.platform=null,this.textureManager=null,this._renderer=null,delete this.gl,delete this.c2d,delete this.ctx,delete this._options,delete this.platform,delete this.textureManager,delete this._renderer}},{key:"stop",value:function(){this.platform.stopLoop()}},{key:"resume",value:function(){this.platform.startLoop()}},{key:"root",get:function(){return this.application}},{key:"getCanvas",value:function(){return this._mode?this.c2d.canvas:this.gl.canvas}},{key:"getRenderPrecision",value:function(){return this._options.precision}},{key:"addUpdateSourceTexture",value:function(t){this._updatingFrame?t._performUpdateSource():this._updateSourceTextures.add(t)}},{key:"removeUpdateSourceTexture",value:function(t){this._updateSourceTextures&&this._updateSourceTextures.delete(t)}},{key:"hasUpdateSourceTexture",value:function(t){return this._updateSourceTextures&&this._updateSourceTextures.has(t)}},{key:"_performUpdateSource",value:function(){this._updateSourceTextures.size&&(this._updateSourceTextures.forEach((function(t){t._performUpdateSource()})),this._updateSourceTextures=new Set)}},{key:"_calculateDt",value:function(){this.startTime=this.currentTime,this.currentTime=this.platform.getHrTime(),this._options.fixedDt?this.dt=this._options.fixedDt:this.dt=this.startTime?.001*(this.currentTime-this.startTime):.02}},{key:"updateFrame",value:function(){this._calculateDt(),this.emit("frameStart"),this._performUpdateSource(),this.emit("update")}},{key:"idleFrame",value:function(){this.textureThrottler.processSome(),this.emit("frameEnd"),this.frameCounter++}},{key:"renderFrame",value:function(){var t=this.ctx.hasRenderUpdates();this.textureThrottler.processSome(),t&&(this._updatingFrame=!0,this.ctx.update(),this.ctx.render(),this._updatingFrame=!1),this.platform.nextFrame(t),this.emit("frameEnd"),this.frameCounter++}},{key:"isUpdatingFrame",value:function(){return this._updatingFrame}},{key:"drawFrame",value:function(){this.updateFrame(),this.renderFrame()}},{key:"forceRenderUpdate",value:function(){this.root&&this.root.core._parent.setHasRenderUpdates(1)}},{key:"setClearColor",value:function(t){this.forceRenderUpdate(),null===t?this._clearColor=null:Array.isArray(t)?this._clearColor=t:this._clearColor=uo.getRgbaComponentsNormalized(t)}},{key:"getClearColor",value:function(){return this._clearColor}},{key:"createElement",value:function(t){return t?this.element(t):new Yo(this)}},{key:"createShader",value:function(t){return Ro.create(this,t)}},{key:"element",value:function(t){return t.isElement?t:(e=t.type?new t.type(this):new Yo(this),e.patch(t),e);var e}},{key:"c",value:function(t){return this.element(t)}},{key:"w",get:function(){return this._options.w}},{key:"h",get:function(){return this._options.h}},{key:"coordsWidth",get:function(){return this.w/this._options.precision}},{key:"coordsHeight",get:function(){return this.h/this._options.precision}},{key:"addMemoryUsage",value:function(t){this._usedMemory+=t,this._lastGcFrame!==this.frameCounter&&this._usedMemory>this.getOption("memoryPressure")&&(this.gc(!1),this._usedMemory>this.getOption("memoryPressure")-2e6&&this.gc(!0))}},{key:"usedMemory",get:function(){return this._usedMemory}},{key:"addVramUsage",value:function(t,e){e?this._usedVramAlpha+=t:this._usedVramNonAlpha+=t}},{key:"usedVramAlpha",get:function(){return this._usedVramAlpha}},{key:"usedVramNonAlpha",get:function(){return this._usedVramNonAlpha}},{key:"usedVram",get:function(){return this._usedVramAlpha+this._usedVramNonAlpha}},{key:"gc",value:function(t){if(this._lastGcFrame!==this.frameCounter){this._lastGcFrame=this.frameCounter;var e=this._usedMemory;if(this.gcTextureMemory(t),this.gcRenderTextureMemory(t),this.renderer.gc(t),this.application.getOption("debug")){console.log("[Lightning] GC".concat(t?"[aggressive]":"","! Frame ").concat(this._lastGcFrame," Freed ").concat(((e-this._usedMemory)/1e6).toFixed(2),"MP from GPU memory. Remaining: ").concat((this._usedMemory/1e6).toFixed(2),"MP"));var n=this._usedMemory-this.textureManager.usedMemory-this.ctx.usedMemory;console.log("[Lightning] Textures: ".concat((this.textureManager.usedMemory/1e6).toFixed(2),"MP, Render Textures: ").concat((this.ctx.usedMemory/1e6).toFixed(2),"MP, Renderer caches: ").concat((n/1e6).toFixed(2),"MP"))}}}},{key:"gcTextureMemory",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.ctx.root.visible?(this.ctx.root.visible=!1,this.textureManager.gc(),this.ctx.root.visible=!0):this.textureManager.gc()}},{key:"gcRenderTextureMemory",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.root.visible?(this.root.visible=!1,this.ctx.freeUnusedRenderTextures(0),this.root.visible=!0):this.ctx.freeUnusedRenderTextures(0)}},{key:"getDrawingCanvas",value:function(){return this.platform.getDrawingCanvas()}},{key:"update",value:function(){this.ctx.update()}},{key:"addServiceProvider",value:function(t){lo.isSpark&&this.platform.addServiceProvider(t)}},{key:"getChildrenByPosition",value:function(t,e){var n=[];return this.root.core.update(),this.root.core.collectAtCoord(t,e,n),n}}],[{key:"isWebglSupported",value:function(){if(lo.isNode)return!0;try{return!!window.WebGLRenderingContext}catch(t){return!1}}}]),n}(Lo),Ns=function(t){l(n,t);var e=c(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;_(this,n),n._temp_options=i,n.booting=!0;var o=new Fs(i.stage);return t=e.call(this,o,r),n.booting=!1,t.__updateFocusCounter=0,t.__keypressTimers=new Map,t.__hoveredChild=null,t.stage.init(),t.updateFocusSettings(),t.__keymap=t.getOption("keys"),t.__keymap&&(t.stage.platform.registerKeydownHandler((function(e){t._receiveKeydown(e)})),t.stage.platform.registerKeyupHandler((function(e){t._receiveKeyup(e)}))),t.getOption("enablePointer")&&(t.stage.platform.registerClickHandler((function(e){t._receiveClick(e)})),t.stage.platform.registerHoverHandler((function(e){t._receiveHover(e)})),t.stage.platform.registerScrollWheelHandler((function(e){t._recieveScrollWheel(e)})),t.cursor="default"),t}return v(n,[{key:"getOption",value:function(t){return this.__options[t]}},{key:"_setOptions",value:function(t){var e=this;this.__options={};var n=function(n,i){var r=t[n];e.__options[n]=void 0===r?i:r};n("debug",!1),n("keys",{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}),n("enablePointer",!1)}},{key:"__construct",value:function(){this.stage.setApplication(this),this._setOptions(n._temp_options),delete n._temp_options,r(g(n.prototype),"__construct",this).call(this)}},{key:"__init",value:function(){r(g(n.prototype),"__init",this).call(this),this.__updateFocus()}},{key:"updateFocusPath",value:function(){this.__updateFocus()}},{key:"__updateFocus",value:function(){var t=this.__updateFocusRec();!n.booting&&t&&this.updateFocusSettings()}},{key:"__updateFocusRec",value:function(){var t=++this.__updateFocusCounter;this.__updateFocusId=t;var e=this.__getFocusPath(),n=e[e.length-1],i=this._focusPath?this._focusPath[this._focusPath.length-1]:void 0;if(!i){this._focusPath=[];for(var r=0,o=e.length;r<o;r++){if(this._focusPath.push(e[r]),this._focusPath[r]._focus(n,void 0),this.__updateFocusId!==t)return!1}return!0}var s,a=Math.min(this._focusPath.length,e.length);for(s=0;s<a&&this._focusPath[s]===e[s];s++);if(this._focusPath.length!==e.length||s!==e.length){this.getOption("debug")&&console.log("[Lightning] Focus changed: "+n.getLocationString());for(var u=this._focusPath.length-1;u>=s;u--){if(this._focusPath.pop()._unfocus(n,i),this.__updateFocusId!==t)return!1}for(var l=s,h=e.length;l<h;l++){if(this._focusPath.push(e[l]),this._focusPath[l]._focus(n,i),this.__updateFocusId!==t)return!1}for(var c=0;c<s;c++)this._focusPath[c]._focusChange(n,i)}return!0}},{key:"updateFocusSettings",value:function(){for(var t=this._focusPath[this._focusPath.length-1],e={},n=Zo.prototype._setFocusSettings,i=0,r=this._focusPath.length;i<r;i++)this._focusPath[i]._setFocusSettings!==n&&this._focusPath[i]._setFocusSettings(e);for(var o=Zo.prototype._handleFocusSettings,s=0,a=this._focusPath.length;s<a;s++)this._focusPath[s]._handleFocusSettings!==o&&this._focusPath[s]._handleFocusSettings(e,this.__prevFocusSettings,t);this.__prevFocusSettings=e}},{key:"_handleFocusSettings",value:function(t,e,n,i){}},{key:"__getFocusPath",value:function(){for(var t=[this],e=this;;){var n=e._getFocused();if(!n||n===e)break;var i=n.cparent;if(i===e)t.push(n);else{var r=[n];do{i||e._throwError("Return value for _getFocused must be an attached descendant component but its '"+n.getLocationString()+"'"),r.push(i),i=i.cparent}while(i!==e);for(var o=0,s=r.length;o<s;o++)t.push(r[s-o-1])}e=n}return t}},{key:"focusPath",get:function(){return this._focusPath}},{key:"focusTopDownEvent",value:function(t){for(var e=this.focusPath,n=e.length,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];for(var s=0;s<n;s++){var a,u=e[s]._getMostSpecificHandledMember(t);if(void 0!==u)if(!1!==(a=e[s])[u].apply(a,r))return!0}return!1}},{key:"focusBottomUpEvent",value:function(t){for(var e=this.focusPath,n=e.length,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];for(var s=n-1;s>=0;s--){var a,u=e[s]._getMostSpecificHandledMember(t);if(void 0!==u)if(!1!==(a=e[s])[u].apply(a,r))return!0}return!1}},{key:"_receiveKeydown",value:function(t){var e,n=t,i=this.__keymap[t.keyCode],r=this.focusPath;if(i&&(e=Array.isArray(i)?i:[i]),e)for(var o=0,s=e.length;o<s;o++){var a=this.__keypressTimers.has(e[o]);if(r[r.length-1].longpress&&a)return;this.stage.application.focusTopDownEvent(["_capture".concat(e[o]),"_captureKey"],n)||this.stage.application.focusBottomUpEvent(["_handle".concat(e[o]),"_handleKey"],n)}else this.stage.application.focusTopDownEvent(["_captureKey"],n)||this.stage.application.focusBottomUpEvent(["_handleKey"],n);this.updateFocusPath();var u=r[r.length-1];if(e&&u.longpress)for(var l=0,h=e.length;l<h;l++)this._startLongpressTimer(e[l],u)}},{key:"_receiveKeyup",value:function(t){var e,n=t,i=this.__keymap[t.keyCode];if(i&&(e=Array.isArray(i)?i:[i]),e)for(var r=0,o=e.length;r<o;r++)this.stage.application.focusTopDownEvent(["_capture".concat(e[r],"Release"),"_captureKeyRelease"],n)||this.stage.application.focusBottomUpEvent(["_handle".concat(e[r],"Release"),"_handleKeyRelease"],n);else this.stage.application.focusTopDownEvent(["_captureKeyRelease"],n)||this.stage.application.focusBottomUpEvent(["_handleKeyRelease"],n);if(this.updateFocusPath(),e)for(var s=0,a=e.length;s<a;s++)this.__keypressTimers.has(e[s])&&(clearTimeout(this.__keypressTimers.get(e[s])),this.__keypressTimers.delete(e[s]))}},{key:"_startLongpressTimer",value:function(t,e){var n=this,i=e.longpress,r=t.toLowerCase();if(i[r]){var o=i[r];lo.isNumber(o)?this.__keypressTimers.set(t,setTimeout((function(){n.stage.application.focusTopDownEvent(["_capture".concat(t,"Long"),"_captureKey"],{})||n.stage.application.focusBottomUpEvent(["_handle".concat(t,"Long"),"_handleKey"],{}),n.__keypressTimers.delete(t)}),o||500)):e._throwError("config value for longpress must be a number")}}},{key:"_recieveScrollWheel",value:function(t){var e=t,n=e.clientX,i=e.clientY;n<=this.stage.w&&i<=this.stage.h&&(this.fireTopDownScrollWheelHandler("_captureScroll",e)||this.fireBottomUpScrollWheelHandler("_handleScroll",e))}},{key:"fireTopDownScrollWheelHandler",value:function(t,e){for(var n=this.stage.application.children,i=this._findChildren([],n).reverse(),r=i.length;r--;){var o=i[r];if(o&&o[t])return o._captureScroll(e),!0}return!1}},{key:"fireBottomUpScrollWheelHandler",value:function(t,e){for(var n=e.clientX,i=e.clientY,r=this._getTargetChild(n,i);null!==r;){if(r&&r[t])return r._handleScroll(e),!0;r=r.parent}return!1}},{key:"_receiveClick",value:function(t){var e=t,n=e.clientX,i=e.clientY;n<=this.stage.w&&i<=this.stage.h&&this.stage.application.fireBottomUpClickHandler(e)}},{key:"fireBottomUpClickHandler",value:function(t){for(var e=t.clientX,n=t.clientY,i=this._getTargetChild(e,n),r=this.stage.getRenderPrecision()/this.stage.getOption("devicePixelRatio"),o=i;null!==o;){if(o&&o._handleClick){var s=o.core._worldContext,a={x:e-s.px*r,y:n-s.py*r};if(!1!==o._handleClick(i,a))break}o=o.parent}}},{key:"_receiveHover",value:function(t){var e=t,n=e.clientX,i=e.clientY;n<=this.stage.w&&i<=this.stage.h&&this.stage.application.fireBottomUpHoverHandler(e)}},{key:"fireBottomUpHoverHandler",value:function(t){var e=t.clientX,n=t.clientY,i=this._getTargetChild(e,n);if(i!==this.__hoveredChild){var r=new Set,o=new Set;if(i&&(o=new Set(i.getAncestors())),this.__hoveredChild){var s,a=w(y(r=new Set(this.__hoveredChild.getAncestors())).filter((function(t){return!o.has(t)})));try{for(a.s();!(s=a.n()).done;){var u=s.value,l=Zo.getComponent(u);l._handleUnhover&&l._handleUnhover(u),u.parent&&u.parent.cursor&&(this.stage.getCanvas().style.cursor=u.parent.cursor)}}catch(v){a.e(v)}finally{a.f()}}this.__hoveredChild=i;var h,c=y(o).filter((function(t){return!r.has(t)})),f=w(c);try{for(f.s();!(h=f.n()).done;){var d=h.value,A=Zo.getComponent(d);A._handleHover&&A._handleHover(d)}}catch(v){f.e(v)}finally{f.f()}var g=c[0];if(g&&g.cursor&&(this.stage.getCanvas().style.cursor=g.cursor),0===c.length&&i){var p=Zo.getComponent(i);p._handleHover&&p._handleHover(i)}}}},{key:"_getTargetChild",value:function(t,e){var n=this.stage.application.children,i=this._findChildren([],n),r=this._withinClickableRange(i,t,e);return r.sort((function(t,e){return t.zIndex>e.zIndex?1:t.zIndex<e.zIndex?-1:t.id>e.id?1:-1})),r.length?r.slice(-1)[0]:null}},{key:"_findChildren",value:function(t,e){for(var n=e.length;n--;){var i=e[n];i.__active&&i.collision&&(!0===i.collision&&t.push(i),i.hasChildren()&&this._findChildren(t,i.children))}return t}},{key:"_withinClickableRange",value:function(t,e,n){for(var i=this,r=t.length,o=[],s=function(){var s=t[r],a=i.stage.getRenderPrecision()/i.stage.getOption("devicePixelRatio"),u=s.core._worldContext,l=u.px*a,h=u.py*a,c=s.finalW*u.ta*a,f=s.finalH*u.td*a;if(l>i.stage.w||h>i.stage.h)return 0;if(s.parent.core._scissor){var d=s.parent.core._scissor.map((function(t){return t*a}));if(!i._testCollision.apply(i,[e,n].concat(y(d))))return 0}i._testCollision(e,n,l,h,c,f)&&o.push(s)};r--;)s();return o}},{key:"_testCollision",value:function(t,e,n,i,r,o){return t>=n&&t<=n+r&&e>=i&&e<=i+o}},{key:"destroy",value:function(){this._destroyed||(this._destroy(),this.stage.destroy(),this._destroyed=!0)}},{key:"_destroy",value:function(){if(this.stage.setApplication(void 0),this._updateAttachedFlag(),this._updateEnabledFlag(),this.__keypressTimers.size){var t,e=w(this.__keypressTimers.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;clearTimeout(n)}}catch(i){e.e(i)}finally{e.f()}this.__keypressTimers.clear()}}},{key:"getCanvas",value:function(){return this.stage.getCanvas()}}]),n}(Zo),Us=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._factory=void 0,i._lookupId=void 0,i}return v(n,[{key:"content",set:function(t){var e=t.factory,n=t.lookupId,i=void 0===n?void 0:n;this._factory=e,this._lookupId=i,this._changed()}},{key:"_getIsValid",value:function(){return!!this._factory}},{key:"_getLookupId",value:function(){return this._lookupId}},{key:"_getSourceLoader",value:function(){var t=this,e=this._factory;return function(n){return e((function(e,i){if(e)return n(e);n(null,t.stage.platform.getTextureOptionsForDrawingCanvas(i))}),t.stage)}}}]),n}(Mo),js=function(){function t(){_(this,t)}return v(t,null,[{key:"getCanvasTexture",value:function(t,e){return{type:Us,content:{factory:t,lookupId:e}}}},{key:"getRoundRect",value:function(e,n,i,r,o,s,a){var u=this;Array.isArray(i)||(i=[i,i,i,i]);var l="rect"+[e,n,r,o,s?1:0,a].concat(i).join(",");return t.getCanvasTexture((function(t,l){lo.isSpark?l.platform.createRoundRect(t,l,e,n,i,r,o,s,a):t(null,u.createRoundRect(l,e,n,i,r,o,s,a))}),l)}},{key:"createRoundRect",value:function(t,e,n,i,r,o,s,a){void 0===s&&(s=!0),void 0===r&&(r=0);var u=t.platform.getDrawingCanvas(),l=u.getContext("2d");l.imageSmoothingEnabled=!0,u.width=e+r+2,u.height=n+r+2,l.beginPath();var h=.5*r+1,c=.5*r+1;return l.moveTo(h+i[0],c),l.lineTo(h+e-i[1],c),l.arcTo(h+e,c,h+e,c+i[1],i[1]),l.lineTo(h+e,c+n-i[2]),l.arcTo(h+e,c+n,h+e-i[2],c+n,i[2]),l.lineTo(h+i[3],c+n),l.arcTo(h,c+n,h,c+n-i[3],i[3]),l.lineTo(h,c+i[0]),l.arcTo(h,c,h+i[0],c,i[0]),l.closePath(),s&&(lo.isNumber(a)?l.fillStyle=uo.getRgbaString(a):l.fillStyle="white",l.fill()),r&&(lo.isNumber(o)?l.strokeStyle=uo.getRgbaString(o):l.strokeStyle="white",l.lineWidth=r,l.stroke()),u}},{key:"getShadowRect",value:function(e,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*o;Array.isArray(r)||(r=[r,r,r,r]);var a="shadow"+[e,n,o,s].concat(r).join(",");return t.getCanvasTexture((function(t,a){lo.isSpark?a.platform.createShadowRect(t,a,e,n,r,o,s):t(null,i.createShadowRect(a,e,n,r,o,s))}),a)}},{key:"createShadowRect",value:function(t,e,n,i,r,o){var s=t.platform.getDrawingCanvas(),a=s.getContext("2d");a.imageSmoothingEnabled=!0,s.width=e+2*o,s.height=n+2*o,a.globalAlpha=.01,a.fillRect(0,0,.01,.01),a.globalAlpha=1,a.shadowColor=uo.getRgbaString(4294967295),a.fillStyle=uo.getRgbaString(4294967295),a.shadowBlur=r,a.shadowOffsetX=e+10+o,a.shadowOffsetY=o,a.beginPath();var u=-(e+10);return a.moveTo(u+i[0],0),a.lineTo(u+e-i[1],0),a.arcTo(u+e,0,u+e,0+i[1],i[1]),a.lineTo(u+e,0+n-i[2]),a.arcTo(u+e,0+n,u+e-i[2],0+n,i[2]),a.lineTo(u+i[3],0+n),a.arcTo(u,0+n,u,0+n-i[3],i[3]),a.lineTo(u,0+i[0]),a.arcTo(u,0,u+i[0],0,i[0]),a.closePath(),a.fill(),s}},{key:"getSvgTexture",value:function(e,n,i){var r=this,o="svg"+[n,i,e].join(",");return t.getCanvasTexture((function(t,o){lo.isSpark?o.platform.createSvg(t,o,e,n,i):r.createSvg(t,o,e,n,i)}),o)}},{key:"createSvg",value:function(t,e,n,i,r){var o=e.platform.getDrawingCanvas(),s=o.getContext("2d");s.imageSmoothingEnabled=!0;var a=new Image;a.onload=function(){o.width=i,o.height=r,s.drawImage(a,0,0,o.width,o.height),t(null,o)},a.onerror=function(e){t(e)},lo.isPS4||(a.crossOrigin="Anonymous"),a.src=n}}]),t}(),Hs=function(){function t(){_(this,t)}return v(t,null,[{key:"isMf",value:function(t){return lo.isFunction(t)&&t.__mf}},{key:"mf",value:function(t){return t.__mf=!0,t}},{key:"merge",value:function(e,n){var i=Object.keys(e),r=Object.keys(n);if(!r.length)return e;for(var o={},s={},a=0,u=r.length;a<u;a++){var l=r[a];o[l]=-1,s[l]=a}for(var h=0,c=i.length;h<c;h++){var f=i[h];o[f]=h,void 0===s[f]&&(s[f]=-1)}for(var d=i.length,A={},g=0,p=r.length;g<p;g++){for(var v=r[g],_=o[v],y=_;--y>=0;){if(-1!==s[i[y]])break}for(;++y<_;){var x=i[y];A[x]=e[x]}var m=n[v],k=e[v],T=void 0;void 0!==(T=this.isMf(m)?m(k):lo.isObjectLiteral(k)&&lo.isObjectLiteral(m)?t.merge(k,m):m)&&(A[v]=T)}for(var b=d;--b>=0;){if(-1!==s[i[b]])break}for(;++b<d;){var w=i[b];A[w]=e[w]}return A}}]),t}(),Ws=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this))._target=t,i}return v(n,[{key:"onAdd",value:function(t,e){this._target.addAt(t,e)}},{key:"onRemove",value:function(t,e){this._target.removeAt(e)}},{key:"onSync",value:function(t,e,n){this._target._setByArray(n)}},{key:"onSet",value:function(t,e){this._target.setAt(t,e)}},{key:"onMove",value:function(t,e,n){this._target.setAt(t,n)}},{key:"createItem",value:function(t){return this._target.createItem(t)}},{key:"isItem",value:function(t){return this._target.isItem(t)}}]),n}(Qo),Qs=function(t){l(n,t);var e=c(n);function n(t,i){var r;return _(this,n),(r=e.call(this,t))._wrap=i,r}return v(n,[{key:"wrap",value:function(t){var e=this._wrap(t);return t._wrapper=e,e}},{key:"onAdd",value:function(t,e){t=this.wrap(t),r(g(n.prototype),"onAdd",this).call(this,t,e)}},{key:"onRemove",value:function(t,e){r(g(n.prototype),"onRemove",this).call(this,t,e)}},{key:"onSync",value:function(t,e,i){var o=this;e.forEach((function(t){return o.wrap(t)})),i=i.map((function(t){return t._wrapper})),r(g(n.prototype),"onSync",this).call(this,t,e,i)}},{key:"onSet",value:function(t,e){t=this.wrap(t),r(g(n.prototype),"onSet",this).call(this,t,e)}},{key:"onMove",value:function(t,e,i){r(g(n.prototype),"onMove",this).call(this,t,e,i)}}]),n}(Ws),Gs=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"_getLookupId",value:function(){return"__noise"}},{key:"_getSourceLoader",value:function(){var t=this.stage.gl;return function(e){for(var n=new Uint8Array(65536),i=0;i<65536;i+=4){var r=Math.floor(256*Math.random());n[i]=r,n[i+1]=r,n[i+2]=r,n[i+3]=255}var o={};t&&(o[t.TEXTURE_WRAP_S]=t.REPEAT,o[t.TEXTURE_WRAP_T]=t.REPEAT,o[t.TEXTURE_MIN_FILTER]=t.NEAREST,o[t.TEXTURE_MAG_FILTER]=t.NEAREST),e(null,{source:n,w:128,h:128,texParams:o})}}}]),n}(Mo),Ys=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._htmlElement=void 0,i._scale=1,i}return v(n,[{key:"htmlElement",get:function(){return this._htmlElement},set:function(t){this._htmlElement=t,this._changed()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this._changed()}},{key:"html",get:function(){return this._htmlElement.innerHTML},set:function(t){if(t){var e=document.createElement("div");e.innerHTML="<div>"+t+"</div>",this.htmlElement=e.firstElementChild}else this.htmlElement=void 0}},{key:"_getIsValid",value:function(){return this.htmlElement}},{key:"_getLookupId",value:function(){return this._scale+":"+this._htmlElement.innerHTML}},{key:"_getSourceLoader",value:function(){var t=this._htmlElement,e=this._scale;return function(i){if(!window.html2canvas)return i(new Error("Please include html2canvas (https://html2canvas.hertzen.com/)"));var r=n.getPreloadArea();r.appendChild(t),html2canvas(t,{backgroundColor:null,scale:e}).then((function(e){if(r.removeChild(t),0===e.height)return i(new Error("Canvas height is 0"));i(null,{source:e,width:e.width,height:e.height})})).catch((function(t){console.error("[Lightning]",t)}))}}}],[{key:"getPreloadArea",value:function(){return this._preloadArea||(this._preloadArea=document.createElement("div"),this._preloadArea.attachShadow&&this._preloadArea.attachShadow({mode:"closed"}),this._preloadArea.style.opacity=0,this._preloadArea.style.pointerEvents="none",this._preloadArea.style.position="fixed",this._preloadArea.style.display="block",this._preloadArea.style.top="100vh",this._preloadArea.style.overflow="hidden",document.body.appendChild(this._preloadArea)),this._preloadArea}}]),n}(Mo),Xs=function(t){l(n,t);var e=c(n);function n(t,i){var r;return _(this,n),(r=e.call(this,t))._options=i,r}return v(n,[{key:"options",get:function(){return this._options},set:function(t){this._options!==t&&(this._options=t,this._changed())}},{key:"_getIsValid",value:function(){return!!this._options}},{key:"_getSourceLoader",value:function(){var t=this;return function(e){e(null,t._options)}}}]),n}(Mo),Vs=function(t){l(n,t);var e=c(n);function n(t){var i,o;return _(this,n),(o=e.call(this,t))._wrapper=r((i=d(o),g(n.prototype)),"_children",i).a({}),o._reloadVisibleElements=!1,o._visibleItems=new Set,o._index=0,o._started=!1,o._scrollTransitionSettings=o.stage.transitions.createSettings({}),o._itemSize=100,o._viewportScrollOffset=0,o._itemScrollOffset=0,o._roll=!1,o._rollMin=0,o._rollMax=0,o._progressAnimation=null,o._invertDirection=!1,o._horizontal=!0,o.itemList=new Zs(d(o)),o}return v(n,[{key:"_allowChildrenAccess",value:function(){return!1}},{key:"items",get:function(){return this.itemList.get()},set:function(t){this.itemList.patch(t)}},{key:"start",value:function(){var t=this;this._wrapper.transition(this.property,this._scrollTransitionSettings),this._scrollTransition=this._wrapper.transition(this.property),this._scrollTransition.on("progress",(function(e){return t.update()})),this.setIndex(0,!0,!0),this._started=!0,this.update()}},{key:"setIndex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.length;if(i){if(this.emit("unfocus",this.getElement(this.realIndex),this._index,this.realIndex),n){var r=lo.getModuloIndex(t,i)-lo.getModuloIndex(this.index,i);r>.5*i?r-=i:r<-.5*i&&(r+=i),this._index+=r}else this._index=t;(this._roll||this.viewportSize>this._itemSize*i)&&(this._index=lo.getModuloIndex(this._index,i));var o,s,a,u=this._horizontal^this._invertDirection?-1:1,l=u*this._index*this._itemSize;if(this._roll)if(1==u)s=(i-1)*this._itemSize,s-=a=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,o=this.viewportSize-(this._itemSize+a),this._rollMin&&(o-=this._rollMin),this._rollMax&&(s+=this._rollMax),l=Math.max(Math.min(l,s),o);else{s=i*this._itemSize-this.viewportSize,s+=a=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize;var h=a;this._rollMin&&(h-=this._rollMin),this._rollMax&&(s+=this._rollMax),l=Math.min(Math.max(-s,l),-h)}this._scrollTransition.start(l),e&&this._scrollTransition.finish(),this.emit("focus",this.getElement(this.realIndex),this._index,this.realIndex)}}},{key:"getAxisPosition",value:function(){var t=-this._scrollTransition._targetValue,e=-(this._horizontal^this._invertDirection?-1:1)*this._index*this._itemSize;return this._viewportScrollOffset*this.viewportSize+(e-t)}},{key:"update",value:function(){if(this._started){var t=this.length;if(t){var e,n,i,r,o=this._horizontal^this._invertDirection?-1:1,s=this._horizontal?this._wrapper.x:this._wrapper.y,a=this.viewportSize,u=this._viewportScrollOffset*a-this._itemScrollOffset*this._itemSize;s+=u,-1==o?(e=Math.floor(-s/this._itemSize),i=1-(-s/this._itemSize-e),n=Math.floor((a-s)/this._itemSize),r=(a-s)/this._itemSize-n):(e=Math.ceil(s/this._itemSize),i=1+s/this._itemSize-e,r=(n=Math.ceil((s-a)/this._itemSize))-(s-a)/this._itemSize),(this._roll||a>this._itemSize*t)&&(n>=t&&(n=t-1,r=1),e>=t&&(e=t-1,i=1),n<=-1&&(n=0,r=1),e<=-1&&(e=0,i=1));for(var l,h=-o*e*this._itemSize,c=e;-1==o?c<=n:c>=n;-1==o?c++:c--){var f=lo.getModuloIndex(c,t),d=this.getElement(f);l=d.parent,this._visibleItems.delete(l),this._horizontal?l.x=h+u:l.y=h+u;var A=l.visible;if(l.visible=!0,A&&!this._reloadVisibleElements||this.emit("visible",c,f),this._progressAnimation){var g=1;c==e?g=i:c==n&&(g=r),this._progressAnimation.apply(d,g)}h+=this._itemSize}var p=this;this._visibleItems.forEach((function(t){t.visible=!1,p._visibleItems.delete(t)}));for(var v=e;-1==o?v<=n:v>=n;-1==o?v++:v--){var _=lo.getModuloIndex(v,t);this._visibleItems.add(this.getWrapper(_))}this._reloadVisibleElements=!1}}}},{key:"setPrevious",value:function(){this.setIndex(this._index-1)}},{key:"setNext",value:function(){this.setIndex(this._index+1)}},{key:"getWrapper",value:function(t){return this._wrapper.children[t]}},{key:"getElement",value:function(t){var e=this._wrapper.children[t];return e?e.children[0]:null}},{key:"reload",value:function(){this._reloadVisibleElements=!0,this.update()}},{key:"element",get:function(){var t=this._wrapper.children[this.realIndex];return t?t.children[0]:null}},{key:"length",get:function(){return this._wrapper.children.length}},{key:"property",get:function(){return this._horizontal?"x":"y"}},{key:"viewportSize",get:function(){return this._horizontal?this.w:this.h}},{key:"index",get:function(){return this._index}},{key:"realIndex",get:function(){return lo.getModuloIndex(this._index,this.length)}},{key:"itemSize",get:function(){return this._itemSize},set:function(t){this._itemSize=t,this.update()}},{key:"viewportScrollOffset",get:function(){return this._viewportScrollOffset},set:function(t){this._viewportScrollOffset=t,this.update()}},{key:"itemScrollOffset",get:function(){return this._itemScrollOffset},set:function(t){this._itemScrollOffset=t,this.update()}},{key:"scrollTransitionSettings",get:function(){return this._scrollTransitionSettings},set:function(t){this._scrollTransitionSettings.patch(t)}},{key:"scrollTransition",get:function(){return this._scrollTransition},set:function(t){this._scrollTransitionSettings.patch(t)}},{key:"progressAnimation",get:function(){return this._progressAnimation},set:function(t){lo.isObjectLiteral(t)?this._progressAnimation=this.stage.animations.createSettings(t):this._progressAnimation=t,this.update()}},{key:"roll",get:function(){return this._roll},set:function(t){this._roll=t,this.update()}},{key:"rollMin",get:function(){return this._rollMin},set:function(t){this._rollMin=t,this.update()}},{key:"rollMax",get:function(){return this._rollMax},set:function(t){this._rollMax=t,this.update()}},{key:"invertDirection",get:function(){return this._invertDirection},set:function(t){this._started||(this._invertDirection=t)}},{key:"horizontal",get:function(){return this._horizontal},set:function(t){t!==this._horizontal&&(this._started||(this._horizontal=t))}}]),n}(Zo),Zs=function(t){l(n,t);var e=c(n);function n(t){var i;_(this,n);return(i=e.call(this,t._wrapper._children,(function(t){var e=t.stage.createElement();return e.add(t),e.visible=!1,e}))).list=t,i}return v(n,[{key:"onAdd",value:function(t,e){r(g(n.prototype),"onAdd",this).call(this,t,e),this.checkStarted(e)}},{key:"checkStarted",value:function(t){this.list._reloadVisibleElements=!0,this.list._started?(1===this.list.length?this.list.setIndex(0,!0,!0):this.list._index>=this.list.length&&this.list.setIndex(0),this.list.update()):this.list.start()}},{key:"onRemove",value:function(t,e){r(g(n.prototype),"onRemove",this).call(this,t,e);var i=this.list.realIndex;i===e?(i===this.list.length&&i--,i>=0&&this.list.setIndex(i)):i>e&&this.list.setIndex(i-1),this.list._reloadVisibleElements=!0}},{key:"onSet",value:function(t,e){r(g(n.prototype),"onSet",this).call(this,t,e),this.checkStarted(e)}},{key:"onSync",value:function(t,e,i){r(g(n.prototype),"onSync",this).call(this,t,e,i),this.checkStarted(0)}},{key:"_signalProxy",get:function(){return!0}}]),n}(Qs),qs=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._direction=new Float32Array([1,0]),i._kernelRadius=1,i}return v(n,[{key:"x",get:function(){return this._direction[0]},set:function(t){this._direction[0]=t,this.redraw()}},{key:"y",get:function(){return this._direction[1]},set:function(t){this._direction[1]=t,this.redraw()}},{key:"kernelRadius",get:function(){return this._kernelRadius},set:function(t){this._kernelRadius=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._kernelRadius}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t),this._setUniform("direction",this._direction,this.gl.uniform2fv),this._setUniform("kernelRadius",this._kernelRadius,this.gl.uniform1i);var e=t.getRenderWidth(),i=t.getRenderHeight();this._setUniform("resolution",new Float32Array([e,i]),this.gl.uniform2fv)}}]),n}(os);qs.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 resolution;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 direction;\n    uniform int kernelRadius;\n    \n    vec4 blur1(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3333333333333333) * direction;\n        color += texture2D(image, uv) * 0.29411764705882354;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n        return color; \n    }\n    \n    vec4 blur2(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3846153846) * direction;\n        vec2 off2 = vec2(3.2307692308) * direction;\n        color += texture2D(image, uv) * 0.2270270270;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n        return color;\n    }\n    \n    vec4 blur3(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.411764705882353) * direction;\n        vec2 off2 = vec2(3.2941176470588234) * direction;\n        vec2 off3 = vec2(5.176470588235294) * direction;\n        color += texture2D(image, uv) * 0.1964825501511404;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n        color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n        return color;\n    }    \n\n    void main(void){\n        if (kernelRadius == 1) {\n            gl_FragColor = blur1(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else if (kernelRadius == 2) {\n            gl_FragColor = blur2(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else {\n            gl_FragColor = blur3(uSampler, vTextureCoord, resolution, direction) * vColor;\n        }\n    }\n";var Ks=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=1/t.getTextureWidth(0),i=1/t.getTextureHeight(0);this._setUniform("stepTextureCoord",new Float32Array([e,i]),this.gl.uniform2fv)}}]),n}(os);Ks.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 stepTextureCoord;\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec4 vColor;\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoordUl = aTextureCoord - stepTextureCoord;\n        vTextureCoordBr = aTextureCoord + stepTextureCoord;\n        vTextureCoordUr = vec2(vTextureCoordBr.x, vTextureCoordUl.y);\n        vTextureCoordBl = vec2(vTextureCoordUl.x, vTextureCoordBr.y);\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",Ks.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = 0.25 * (texture2D(uSampler, vTextureCoordUl) + texture2D(uSampler, vTextureCoordUr) + texture2D(uSampler, vTextureCoordBl) + texture2D(uSampler, vTextureCoordBr));\n        gl_FragColor = color * vColor;\n    }\n";var Js=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._kernelRadius=1,i}return v(n,[{key:"kernelRadius",get:function(){return this._kernelRadius},set:function(t){this._kernelRadius=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._amount}},{key:"_beforeDrawEl",value:function(t){t.target.ctx.filter="blur("+this._kernelRadius+"px)"}},{key:"_afterDrawEl",value:function(t){t.target.ctx.filter="none"}}]),n}(fs),$s=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"wrap",get:function(){return this.tag("Wrap")}},{key:"content",get:function(){return this.wrap.content},set:function(t){return this.wrap.content=t}},{key:"padding",set:function(t){this.wrap._paddingX=t,this.wrap._paddingY=t,this.wrap._updateBlurSize()}},{key:"paddingX",set:function(t){this.wrap._paddingX=t,this.wrap._updateBlurSize()}},{key:"paddingY",set:function(t){this.wrap._paddingY=t,this.wrap._updateBlurSize()}},{key:"amount",get:function(){return this.wrap.amount},set:function(t){return this.wrap.amount=t}},{key:"_onResize",value:function(){this.wrap.w=this.renderWidth,this.wrap.h=this.renderHeight}},{key:"_signalProxy",get:function(){return!0}},{key:"_build",value:function(){this.patch({Wrap:{type:this.stage.gl?ea:ta}})}}],[{key:"_template",value:function(){return{}}}]),n}(Zo),ta=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._textwrap=i.sel("Textwrap"),i._wrapper=i.sel("Textwrap>Content"),i._amount=0,i._paddingX=0,i._paddingY=0,i}return v(n,[{key:"content",get:function(){return this.sel("Textwrap>Content")},set:function(t){this.sel("Textwrap>Content").patch(t,!0)}},{key:"padding",set:function(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}},{key:"paddingX",set:function(t){this._paddingX=t,this._updateBlurSize()}},{key:"paddingY",set:function(t){this._paddingY=t,this._updateBlurSize()}},{key:"_updateBlurSize",value:function(){var t=this.renderWidth,e=this.renderHeight,n=this._paddingX,i=this._paddingY;this._wrapper.x=n,this._textwrap.x=-n,this._wrapper.y=i,this._textwrap.y=-i,this._textwrap.w=t+2*n,this._textwrap.h=e+2*i}},{key:"amount",get:function(){return this._amount},set:function(t){this._amount=t,this._textwrap.shader.kernelRadius=n._amountToKernelRadius(t)}},{key:"_signalProxy",get:function(){return!0}}],[{key:"_template",value:function(){return{forceZIndexContext:!0,rtt:!0,Textwrap:{shader:{type:Js},Content:{}}}}},{key:"getSpline",value:function(){return this._multiSpline||(this._multiSpline=new Ms,this._multiSpline.parse(!1,{0:0,.25:1.5,.5:5.5,.75:18,1:39})),this._multiSpline}},{key:"_amountToKernelRadius",value:function(t){return n.getSpline().getValue(Math.min(1,.25*t))}}]),n}(Zo),ea=function(t){l(i,t);var n=c(i);function i(t){var e;return _(this,i),(e=n.call(this,t))._textwrap=e.sel("Textwrap"),e._wrapper=e.sel("Textwrap>Content"),e._layers=e.sel("Layers"),e._output=e.sel("Result"),e._amount=0,e._paddingX=0,e._paddingY=0,e}return v(i,[{key:"_signalProxy",get:function(){return!0}},{key:"_buildLayers",value:function(){var t=this,e=[{x:1,y:0,kernelRadius:1},{x:0,y:1,kernelRadius:1},{x:1.5,y:0,kernelRadius:1},{x:0,y:1.5,kernelRadius:1}].map((function(e){return Ro.create(t.stage,Object.assign({type:qs},e))}));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[e[0],e[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[e[0],e[1],e[2],e[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[e[0],e[1],e[2],e[3]])}},{key:"_setLayerTexture",value:function(t,e,n){if(n.length){var i=n.pop(),r=t.stage.c({rtt:!0,shader:i});this._setLayerTexture(r,e,n),t.childList.add(r)}else t.texture=e;return t}},{key:"content",get:function(){return this.sel("Textwrap>Content")},set:function(t){this.sel("Textwrap>Content").patch(t,!0)}},{key:"padding",set:function(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}},{key:"paddingX",set:function(t){this._paddingX=t,this._updateBlurSize()}},{key:"paddingY",set:function(t){this._paddingY=t,this._updateBlurSize()}},{key:"getLayer",value:function(t){return this._layers.sel("L"+t)}},{key:"getLayerContents",value:function(t){return this.getLayer(t).sel("Content")}},{key:"_onResize",value:function(){this._updateBlurSize()}},{key:"_updateBlurSize",value:function(){var t=this.renderWidth,e=this.renderHeight,n=this._paddingX,i=this._paddingY,r=t+2*n,o=e+2*i;this._textwrap.w=r,this._wrapper.x=n,this.getLayer(0).w=this.getLayerContents(0).w=r/2,this.getLayer(1).w=this.getLayerContents(1).w=r/4,this.getLayer(2).w=this.getLayerContents(2).w=r/8,this.getLayer(3).w=this.getLayerContents(3).w=r/16,this._output.x=-n,this._textwrap.x=-n,this._output.w=r,this._textwrap.h=o,this._wrapper.y=i,this.getLayer(0).h=this.getLayerContents(0).h=o/2,this.getLayer(1).h=this.getLayerContents(1).h=o/4,this.getLayer(2).h=this.getLayerContents(2).h=o/8,this.getLayer(3).h=this.getLayerContents(3).h=o/16,this._output.y=-i,this._textwrap.y=-i,this._output.h=o,this.w=t,this.h=e}},{key:"amount",get:function(){return this._amount},set:function(t){this._amount=t,this._update()}},{key:"_update",value:function(){var t=Math.min(4,Math.max(0,this._amount));0===t?(this._textwrap.renderToTexture=!1,this._output.shader.otherTextureSource=null,this._output.visible=!1):(this._textwrap.renderToTexture=!0,this._output.visible=!0,this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3,t<=1?(this._output.texture=this._textwrap.getTexture(),this._output.shader.otherTextureSource=this.getLayer(0).getTexture(),this._output.shader.a=t):t<=2?(this._output.texture=this.getLayer(0).getTexture(),this._output.shader.otherTextureSource=this.getLayer(1).getTexture(),this._output.shader.a=t-1):t<=3?(this._output.texture=this.getLayer(1).getTexture(),this._output.shader.otherTextureSource=this.getLayer(2).getTexture(),this._output.shader.a=t-2):t<=4&&(this._output.texture=this.getLayer(2).getTexture(),this._output.shader.otherTextureSource=this.getLayer(3).getTexture(),this._output.shader.a=t-3))}},{key:"shader",set:function(t){e(g(i.prototype),"shader",t,this,!0),this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}},{key:"_firstActive",value:function(){this._buildLayers()}}],[{key:"_template",value:function(){var t=function(t,e){if(130&e._recalc){var n=e.w,i=e.h,r=e;do{(r=r._children[0])._element.w=n,r._element.h=i}while(r._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,Content:{}},Layers:{L0:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ks}}},L1:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ks}}},L2:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ks}}},L3:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ks}}}},Result:{shader:{type:na},visible:!1}}}}]),i}(Zo),na=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._a=0,i._otherTextureSource=null,i}return v(n,[{key:"a",get:function(){return this._a},set:function(t){this._a=t,this.redraw()}},{key:"otherTextureSource",set:function(t){this._otherTextureSource=t,this.redraw()}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t),this._setUniform("a",this._a,this.gl.uniform1f),this._setUniform("uSampler2",1,this.gl.uniform1i)}},{key:"beforeDraw",value:function(t){var e=this._otherTextureSource?this._otherTextureSource.nativeTexture:null,n=this.gl;n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,e),n.activeTexture(n.TEXTURE0)}}]),n}(os);na.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uSampler2;\n    uniform float a;\n    void main(void){\n        if (a == 1.0) {\n            gl_FragColor = texture2D(uSampler2, vTextureCoord) * vColor;\n        } else {\n            gl_FragColor = ((1.0 - a) * texture2D(uSampler, vTextureCoord) + (a * texture2D(uSampler2, vTextureCoord))) * vColor;\n        }\n    }\n";var ia=function(t){l(i,t);var n=c(i);function i(t){var e;return _(this,i),(e=n.call(this,t))._textwrap=e.sel("Textwrap"),e._wrapper=e.sel("Textwrap.Content"),e._layers=e.sel("Layers"),e._amount=0,e._paddingX=0,e._paddingY=0,e}return v(i,[{key:"_signalProxy",get:function(){return!0}},{key:"_build",value:function(){var t=this,e=[{x:1,y:0,kernelRadius:3},{x:0,y:1,kernelRadius:3},{x:1.5,y:0,kernelRadius:3},{x:0,y:1.5,kernelRadius:3}].map((function(e){return t.stage.createShader(Object.assign({type:qs},e))}));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[e[0],e[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[e[0],e[1],e[2],e[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[e[0],e[1],e[2],e[3]])}},{key:"_setLayerTexture",value:function(t,e,n){if(n.length){var i=n.pop(),r=t.stage.c({rtt:!0,shader:i});this._setLayerTexture(r,e,n),t.childList.add(r)}else t.texture=e;return t}},{key:"content",get:function(){return this.sel("Textwrap.Content")},set:function(t){this.sel("Textwrap.Content").patch(t)}},{key:"padding",set:function(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}},{key:"paddingX",set:function(t){this._paddingX=t,this._updateBlurSize()}},{key:"paddingY",set:function(t){this._paddingY=t,this._updateBlurSize()}},{key:"getLayer",value:function(t){return this._layers.sel("L"+t)}},{key:"getLayerContents",value:function(t){return this.getLayer(t).sel("Content")}},{key:"_onResize",value:function(){this._updateBlurSize()}},{key:"_updateBlurSize",value:function(){var t=this.renderWidth,e=this.renderHeight,n=this._paddingX,i=this._paddingY,r=t+2*n,o=e+2*i;this._textwrap.w=r,this._wrapper.x=n,this.getLayer(0).w=this.getLayerContents(0).w=r/2,this.getLayer(1).w=this.getLayerContents(1).w=r/4,this.getLayer(2).w=this.getLayerContents(2).w=r/8,this.getLayer(3).w=this.getLayerContents(3).w=r/16,this._textwrap.x=-n,this._textwrap.h=o,this._wrapper.y=i,this.getLayer(0).h=this.getLayerContents(0).h=o/2,this.getLayer(1).h=this.getLayerContents(1).h=o/4,this.getLayer(2).h=this.getLayerContents(2).h=o/8,this.getLayer(3).h=this.getLayerContents(3).h=o/16,this._textwrap.y=-i,this.w=t,this.h=e}},{key:"amount",get:function(){return this._amount},set:function(t){this._amount=t,this._update()}},{key:"_update",value:function(){var t=Math.min(4,Math.max(0,this._amount));t>0&&(this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3)}},{key:"shader",set:function(t){e(g(i.prototype),"shader",t,this,!0),this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}},{key:"_firstActive",value:function(){this._build()}}],[{key:"_template",value:function(){var t=function(t,e){if(130&e._recalc){var n=e.w,i=e.h,r=e;do{(r=r._children[0])._element.w=n,r._element.h=i}while(r._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,BloomBase:{shader:{type:ra},Content:{}}},Layers:{L0:{rtt:!0,onUpdate:t,scale:2,pivot:0,visible:!1,Content:{shader:{type:Ks}}},L1:{rtt:!0,onUpdate:t,scale:4,pivot:0,visible:!1,Content:{shader:{type:Ks}}},L2:{rtt:!0,onUpdate:t,scale:8,pivot:0,visible:!1,Content:{shader:{type:Ks}}},L3:{rtt:!0,onUpdate:t,scale:16,pivot:0,visible:!1,Content:{shader:{type:Ks}}}}}}}]),i}(Zo),ra=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n)}(os);ra.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float m = max(max(color.r, color.g), color.b);\n        float c = max(0.0, (m - 0.80)) * 5.0;\n        color = color * c;\n        gl_FragColor = color;\n    }\n";var oa=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._smoothScale=1,i._iterations=0,i}return v(n,[{key:"content",get:function(){return this.tag("Content")},set:function(t){this.tag("Content").patch(t,!0)}},{key:"smoothScale",get:function(){return this._smoothScale},set:function(t){if(this._smoothScale!==t){for(var e=0;t<.5&&e<12;)e++,t*=2;this.scale=t,this._setIterations(e),this._smoothScale=t}}},{key:"_setIterations",value:function(t){if(this._iterations!==t){for(var e=this.sel("Scale").childList,i=this.sel("ContentWrap");e.length<t;){var r=0===e.length?i.getTexture():e.last.getTexture();e.a({rtt:!0,renderOffscreen:!0,texture:r})}n._updateDimensions(this.tag("ContentWrap"),!0);var o=t>0;this.patch({ContentWrap:{renderToTexture:o},Scale:{visible:o}});for(var s=0,a=e.length;s<a;s++)e.getAt(s).patch({visible:s<t,renderOffscreen:s!==t-1});this._iterations=t}}},{key:"_signalProxy",get:function(){return!0}}],[{key:"_template",value:function(){return{ContentWrap:{renderOffscreen:!0,forceZIndexContext:!0,onAfterUpdate:n._updateDimensions,Content:{}},Scale:{visible:!1}}}},{key:"_updateDimensions",value:function(t,e){var n=t.children[0],i=n.renderWidth,r=n.renderHeight;if(i!==t.w||r!==t.h||e){t.w=i,t.h=r;for(var o=t.parent.tag("Scale").children,s=0,a=o.length;s<a;s++)i*=.5,r*=.5,o[s].w=i,o[s].h=r}}}]),n}(Zo),sa=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._borderTop=i.tag("Top"),i._borderRight=i.tag("Right"),i._borderBottom=i.tag("Bottom"),i._borderLeft=i.tag("Left"),i.onAfterUpdate=function(t){var e=t.childList.first,n=t.core.w||e.renderWidth,i=t.core.h||e.renderHeight;t._borderTop.w=n,t._borderBottom.y=i,t._borderBottom.w=n,t._borderLeft.h=i+t._borderTop.h+t._borderBottom.h,t._borderLeft.y=-t._borderTop.h,t._borderRight.x=n,t._borderRight.h=i+t._borderTop.h+t._borderBottom.h,t._borderRight.y=-t._borderTop.h},i.borderWidth=1,i}return v(n,[{key:"_signalProxy",get:function(){return!0}},{key:"content",get:function(){return this.sel("Content")},set:function(t){this.sel("Content").patch(t,!0)}},{key:"borderWidth",get:function(){return this.borderWidthTop},set:function(t){this.borderWidthTop=t,this.borderWidthRight=t,this.borderWidthBottom=t,this.borderWidthLeft=t}},{key:"borderWidthTop",get:function(){return this._borderTop.h},set:function(t){this._borderTop.h=t,this._borderTop.visible=t>0}},{key:"borderWidthRight",get:function(){return this._borderRight.w},set:function(t){this._borderRight.w=t,this._borderRight.visible=t>0}},{key:"borderWidthBottom",get:function(){return this._borderBottom.h},set:function(t){this._borderBottom.h=t,this._borderBottom.visible=t>0}},{key:"borderWidthLeft",get:function(){return this._borderLeft.w},set:function(t){this._borderLeft.w=t,this._borderLeft.visible=t>0}},{key:"colorBorder",get:function(){return this.colorBorderTop},set:function(t){this.colorBorderTop=t,this.colorBorderRight=t,this.colorBorderBottom=t,this.colorBorderLeft=t}},{key:"colorBorderTop",get:function(){return this._borderTop.color},set:function(t){this._borderTop.color=t}},{key:"colorBorderRight",get:function(){return this._borderRight.color},set:function(t){this._borderRight.color=t}},{key:"colorBorderBottom",get:function(){return this._borderBottom.color},set:function(t){this._borderBottom.color=t}},{key:"colorBorderLeft",get:function(){return this._borderLeft.color},set:function(t){this._borderLeft.color=t}},{key:"borderTop",get:function(){return this._borderTop},set:function(t){this.borderTop.patch(t)}},{key:"borderRight",get:function(){return this._borderRight},set:function(t){this.borderRight.patch(t)}},{key:"borderBottom",get:function(){return this._borderBottom},set:function(t){this.borderBottom.patch(t)}},{key:"borderLeft",get:function(){return this._borderLeft},set:function(t){this.borderLeft.patch(t)}},{key:"borders",set:function(t){this.borderTop=t,this.borderLeft=t,this.borderBottom=t,this.borderRight=t}}],[{key:"_template",value:function(){return{Content:{},Borders:{Top:{rect:!0,visible:!1,mountY:1},Right:{rect:!0,visible:!1},Bottom:{rect:!0,visible:!1},Left:{rect:!0,visible:!1,mountX:1}}}}}]),n}(Zo),aa=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._amount=1,i}return v(n,[{key:"amount",get:function(){return this._amount},set:function(t){this._amount=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._amount}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}],[{key:"getC2d",value:function(){return ua}}]),n}(os);aa.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float grayness = 0.2 * color.r + 0.6 * color.g + 0.2 * color.b;\n        gl_FragColor = vec4(amount * vec3(grayness, grayness, grayness) + (1.0 - amount) * color.rgb, color.a);\n    }\n";var ua=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._amount=1,i}return v(n,[{key:"amount",get:function(){return this._amount},set:function(t){this._amount=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._amount}},{key:"_beforeDrawEl",value:function(t){t.target.ctx.filter="grayscale("+this._amount+")"}},{key:"_afterDrawEl",value:function(t){t.target.ctx.filter="none"}}],[{key:"getWebGL",value:function(){return aa}}]),n}(fs),la=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._noiseTexture=new Gs(t.stage),i._graining=1/256,i._random=!1,i}return v(n,[{key:"graining",set:function(t){this._graining=t,this.redraw()}},{key:"random",set:function(t){this._random=t,this.redraw()}},{key:"setExtraAttribsInBuffer",value:function(t){this._noiseTexture.load();for(var e=t.extraAttribsDataByteOffset/4,n=t.quads.floats,i=t.length,r=0;r<i;r++){var o=t.getElementWidth(r)/this._noiseTexture.getRenderWidth(),s=t.getElementHeight(r)/this._noiseTexture.getRenderHeight(),a=0,u=0;if(this._random){if(o+=a=Math.random(),s+=u=Math.random(),Math.random()<.5){var l=a;a=o,o=l}if(Math.random()<.5){var h=u;u=s,s=h}}n[e]=a,n[e+1]=u,n[e+2]=o,n[e+3]=u,n[e+4]=o,n[e+5]=s,n[e+6]=a,n[e+7]=s,e+=8}}},{key:"beforeDraw",value:function(t){var e=this.gl;e.vertexAttribPointer(this._attrib("aNoiseTextureCoord"),2,e.FLOAT,!1,8,this.getVertexAttribPointerOffset(t));var n=this._noiseTexture.source.nativeTexture;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,n),e.activeTexture(e.TEXTURE0)}},{key:"getExtraAttribBytesPerVertex",value:function(){return 8}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t),this._setUniform("uNoiseSampler",1,this.gl.uniform1i),this._setUniform("graining",2*this._graining,this.gl.uniform1f)}},{key:"enableAttribs",value:function(){r(g(n.prototype),"enableAttribs",this).call(this),this.gl.enableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}},{key:"disableAttribs",value:function(){r(g(n.prototype),"disableAttribs",this).call(this),this.gl.disableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}},{key:"useDefault",value:function(){return 0===this._graining}},{key:"afterDraw",value:function(t){this._random&&this.redraw()}}]),n}(os);la.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec2 aNoiseTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vNoiseTextureCoord = aNoiseTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",la.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uNoiseSampler;\n    uniform float graining;\n    void main(void){\n        vec4 noise = texture2D(uNoiseSampler, vNoiseTextureCoord);\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        gl_FragColor = (color * vColor) + graining * (noise.r - 0.5);\n    }\n";var ha=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._inputValue=0,i._maxDerivative=.01,i._normalizedValue=0,i._offset=0,i._amount=.1,i._aspectRatio=1,i._offsetX=0,i._offsetY=0,i.buckets=100,i}return v(n,[{key:"aspectRatio",get:function(){return this._aspectRatio},set:function(t){this._aspectRatio=t,this.redraw()}},{key:"offsetX",get:function(){return this._offsetX},set:function(t){this._offsetX=t,this.redraw()}},{key:"offsetY",get:function(){return this._offsetY},set:function(t){this._offsetY=t,this.redraw()}},{key:"amount",get:function(){return this._amount},set:function(t){this._amount=t,this.redraw()}},{key:"inputValue",get:function(){return this._inputValue},set:function(t){this._inputValue=t}},{key:"maxDerivative",get:function(){return this._maxDerivative},set:function(t){this._maxDerivative=t}},{key:"buckets",get:function(){return this._buckets},set:function(t){t>100&&(console.warn("[Lightning] CircularPushShader: supports max 100 buckets"),t=100),this._buckets=t,this._values=new Uint8Array(this._getValues(t)),this.redraw()}},{key:"_getValues",value:function(t){for(var e=[],n=0;n<t;n++)e.push(this._inputValue);return e}},{key:"progress",value:function(t){this._offset+=t*this._buckets;var e=Math.floor(this._offset);this._offset-=e,this._shiftBuckets(e),this.redraw()}},{key:"_shiftBuckets",value:function(t){for(var e=this._buckets-1;e>=0;e--){var n=e-t;n<0?(this._normalizedValue=Math.min(this._normalizedValue+this._maxDerivative,Math.max(this._normalizedValue-this._maxDerivative,this._inputValue)),this._values[e]=255*this._normalizedValue):this._values[e]=this._values[n]}}},{key:"offset",set:function(t){this._offset=t,this.redraw()}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t),this._setUniform("aspectRatio",this._aspectRatio,this.gl.uniform1f),this._setUniform("offsetX",this._offsetX,this.gl.uniform1f),this._setUniform("offsetY",this._offsetY,this.gl.uniform1f),this._setUniform("amount",this._amount,this.gl.uniform1f),this._setUniform("offset",this._offset,this.gl.uniform1f),this._setUniform("buckets",this._buckets,this.gl.uniform1f),this._setUniform("uValueSampler",1,this.gl.uniform1i)}},{key:"useDefault",value:function(){return 0===this._amount}},{key:"beforeDraw",value:function(t){var e=this.gl;e.activeTexture(e.TEXTURE1),this._valuesTexture?e.bindTexture(e.TEXTURE_2D,this._valuesTexture):(this._valuesTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._valuesTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),lo.isNode&&e.pixelStorei(e.UNPACK_FLIP_BLUE_RED,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this._buckets,1,0,e.ALPHA,e.UNSIGNED_BYTE,this._values),e.activeTexture(e.TEXTURE0)}},{key:"cleanup",value:function(){this._valuesTexture&&this.gl.deleteTexture(this._valuesTexture)}}]),n}(os);ha.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    uniform float offsetX;\n    uniform float offsetY;\n    uniform float aspectRatio;\n    varying vec2 vTextureCoord;\n    varying vec2 vPos;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vPos = vTextureCoord * 2.0 - 1.0;\n        vPos.y = vPos.y * aspectRatio;\n        vPos.y = vPos.y + offsetY;\n        vPos.x = vPos.x + offsetX;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ha.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vPos;\n    uniform float amount;\n    uniform float offset;\n    uniform float values[100];\n    uniform float buckets;\n    uniform sampler2D uSampler;\n    uniform sampler2D uValueSampler;\n    void main(void){\n        float l = length(vPos);\n        float m = (l * buckets * 0.678 - offset) / buckets;\n        float f = texture2D(uValueSampler, vec2(m, 0.0)).a * amount;\n        vec2 unit = vPos / l;\n        gl_FragColor = texture2D(uSampler, vTextureCoord - f * unit) * vColor;\n    }\n";var ca=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._amount=1,i}return v(n,[{key:"amount",get:function(){return this._amount},set:function(t){this._amount=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._amount}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}]),n}(os);ca.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        color.rgb = color.rgb * (1.0 - amount) + amount * (1.0 * color.a - color.rgb); \n        gl_FragColor = color * vColor;\n    }\n";var fa=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._width=5,i._col=4294967295,i._color=[1,1,1,1],i}return v(n,[{key:"width",set:function(t){this._width=t,this.redraw()}},{key:"color",get:function(){return this._col},set:function(t){if(this._col!==t){var e=uo.getRgbaComponentsNormalized(t);e[0]=e[0]*e[3],e[1]=e[1]*e[3],e[2]=e[2]*e[3],this._color=e,this.redraw(),this._col=t}}},{key:"useDefault",value:function(){return 0===this._width||0===this._col[3]}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=this.gl;this._setUniform("color",new Float32Array(this._color),e.uniform4fv)}},{key:"enableAttribs",value:function(){r(g(n.prototype),"enableAttribs",this).call(this),this.gl.enableVertexAttribArray(this._attrib("aCorner"))}},{key:"disableAttribs",value:function(){r(g(n.prototype),"disableAttribs",this).call(this),this.gl.disableVertexAttribArray(this._attrib("aCorner"))}},{key:"setExtraAttribsInBuffer",value:function(t){for(var e=t.extraAttribsDataByteOffset/4,n=t.quads.floats,i=t.length,r=0;r<i;r++){var o=t.getElementCore(r),s=this._width/o.w,a=s/(1-2*s),u=this._width/o.h,l=u/(1-2*u);n[e]=-a,n[e+1]=-l,n[e+2]=1+a,n[e+3]=-l,n[e+4]=1+a,n[e+5]=1+l,n[e+6]=-a,n[e+7]=1+l,e+=8}}},{key:"beforeDraw",value:function(t){var e=this.gl;e.vertexAttribPointer(this._attrib("aCorner"),2,e.FLOAT,!1,8,this.getVertexAttribPointerOffset(t))}},{key:"getExtraAttribBytesPerVertex",value:function(){return 8}}]),n}(os);fa.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aCorner;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vCorner;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vCorner = aCorner;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",fa.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vCorner;\n    uniform vec4 color;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec2 m = min(vCorner, 1.0 - vCorner);\n        float value = step(0.0, min(m.x, m.y));\n        gl_FragColor = mix(color, texture2D(uSampler, vTextureCoord) * vColor, value);\n    }\n";var da=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._size=new Float32Array([4,4]),i}return v(n,[{key:"x",get:function(){return this._size[0]},set:function(t){this._size[0]=t,this.redraw()}},{key:"y",get:function(){return this._size[1]},set:function(t){this._size[1]=t,this.redraw()}},{key:"size",get:function(){return this._size[0]},set:function(t){this._size[0]=t,this._size[1]=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._size[0]&&0===this._size[1]}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=this.gl;this._setUniform("size",new Float32Array(this._size),e.uniform2fv)}},{key:"getExtraAttribBytesPerVertex",value:function(){return 8}},{key:"enableAttribs",value:function(){r(g(n.prototype),"enableAttribs",this).call(this),this.gl.enableVertexAttribArray(this._attrib("aTextureRes"))}},{key:"disableAttribs",value:function(){r(g(n.prototype),"disableAttribs",this).call(this),this.gl.disableVertexAttribArray(this._attrib("aTextureRes"))}},{key:"setExtraAttribsInBuffer",value:function(t){for(var e=t.extraAttribsDataByteOffset/4,n=t.quads.floats,i=t.length,r=0;r<i;r++){var o=t.quads.getTextureWidth(t.index+r),s=t.quads.getTextureHeight(t.index+r);n[e]=o,n[e+1]=s,n[e+2]=o,n[e+3]=s,n[e+4]=o,n[e+5]=s,n[e+6]=o,n[e+7]=s,e+=8}}},{key:"beforeDraw",value:function(t){var e=this.gl;e.vertexAttribPointer(this._attrib("aTextureRes"),2,e.FLOAT,!1,this.getExtraAttribBytesPerVertex(),this.getVertexAttribPointerOffset(t))}}],[{key:"getWebGLImpl",value:function(){return WebGLPixelateShaderImpl}}]),n}(os);da.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aTextureRes;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        vTextureRes = aTextureRes;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",da.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n\n    uniform vec2 size;\n    uniform sampler2D uSampler;\n    \n    vec2 mapCoord( vec2 coord )\n    {\n        coord *= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 unmapCoord( vec2 coord )\n    {\n        coord /= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 pixelate(vec2 coord, vec2 size)\n    {\n        return floor( coord / size ) * size;\n    }\n    \n    void main(void)\n    {\n        vec2 coord = mapCoord(vTextureCoord);\n        coord = pixelate(coord, size);\n        coord = unmapCoord(coord);\n        gl_FragColor = texture2D(uSampler, coord) * vColor;\n    }\n";var Aa=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._radius=0,i._cutoff=1,i}return v(n,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t,this.redraw()}},{key:"cutoff",get:function(){return this._cutoff},set:function(t){this._cutoff=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._radius}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t),this._setUniform("radius",2*(this._radius-.5)/t.getRenderWidth(),this.gl.uniform1f),this._setUniform("cutoff",.5*t.getRenderWidth()/this._cutoff,this.gl.uniform1f)}}]),n}(os);Aa.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 pos;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n        pos = gl_Position.xy;\n    }\n",Aa.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 pos;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float radius;\n    uniform float cutoff;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        float f = max(0.0, min(1.0, 1.0 - (length(pos) - radius) * cutoff));\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor * f;\n    }\n";var ga=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._blend=0,i._radius=[1,1,1,1],i._stroke=0,i._fc=16777215,i._fillColor=i._getNormalizedColor(4294967295),i._strokeColor=i._getNormalizedColor(16777215),i}return v(n,[{key:"blend",set:function(t){this._blend=Math.min(Math.max(t,0),1)}},{key:"radius",get:function(){return this._radius},set:function(t){Array.isArray(t)?2===t.length?this._radius=[t[0],t[1],t[0],t[1]]:3===t.length?this._radius=[t[0],t[1],t[2],this._radius[3]]:4===t.length?this._radius=t:this._radius=[t[0],t[0],t[0],t[0]]:this._radius=[t,t,t,t],this.redraw()}},{key:"topLeft",get:function(){return this._radius[0]},set:function(t){this._radius[0]=t,this.redraw()}},{key:"topRight",get:function(){return this._radius[1]},set:function(t){this._radius[1]=t,this.redraw()}},{key:"bottomRight",get:function(){return this._radius[2]},set:function(t){this._radius[2]=t,this.redraw()}},{key:"bottomLeft",get:function(){return this._radius[4]},set:function(t){this._radius[3]=t,this.redraw()}},{key:"strokeColor",get:function(){return this._sc},set:function(t){this._sc=t,this._strokeColor=this._getNormalizedColor(t),this.redraw()}},{key:"fillColor",get:function(){return this._fc},set:function(t){this._fc=t,this._fillColor=this._getNormalizedColor(t),this.redraw()}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t,this.redraw()}},{key:"_getNormalizedColor",value:function(t){var e=uo.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision(),o=this._radius.map((function(t){return(t+.5)*i}));this._setUniform("radius",new Float32Array(o),this.gl.uniform4fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("blend",this._blend,this.gl.uniform1f),this._setUniform("strokeColor",this._strokeColor,this.gl.uniform4fv),this._setUniform("fillColor",this._fillColor,this.gl.uniform4fv),this._setUniform("stroke",this._stroke*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}}]),n}(os);ga.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ga.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n\n    #define PI 3.14159265359\n\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 radius;\n    uniform float stroke;\n    uniform vec4 strokeColor;\n    uniform vec4 fillColor;\n    uniform float alpha;\n    uniform float fill;\n    uniform float blend;\n    \n    float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    float innerBorderMask(float dist, float width){\n        float alpha1 = clamp(dist + width, 0.0, 1.0);\n        float alpha2 = clamp(dist, 0.0, 1.0);\n        return alpha1 - alpha2;\n    }\n\n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        float r = 0.0;\n        if (vTextureCoord.x < 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[0];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[1];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y >= 0.5) {\n            r = radius[2];\n        } else {\n            r = radius[3];\n        }\n        \n        float b = boxDist(vTextureCoord.xy * resolution - halfRes, halfRes - 0.005, r);\n        vec4 tex = texture2D(uSampler, vTextureCoord) * vColor;\n        vec4 blend = mix(vec4(1.0) * alpha, tex, blend);     \n        vec4 layer1 = mix(vec4(0.0), tex * fillColor, fillMask(b));\n        gl_FragColor = mix(layer1, blend * strokeColor, innerBorderMask(b, stroke));\n    }\n";var pa=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._fade=[0,0,0,0],i}return v(n,[{key:"top",get:function(){return this._fade[0]},set:function(t){this._fade[0]=t,this.redraw()}},{key:"right",get:function(){return this._fade[1]},set:function(t){this._fade[1]=t,this.redraw()}},{key:"bottom",get:function(){return this._fade[2]},set:function(t){this._fade[2]=t,this.redraw()}},{key:"left",get:function(){return this._fade[3]},set:function(t){this._fade[3]=t,this.redraw()}},{key:"fade",get:function(){return this._fade},set:function(t){Array.isArray(t)?2===t.length?this._fade=[t[0],t[1],t[0],t[1]]:3===t.length?this._fade=[t[0],t[1],t[2],this._fade[3]]:4===t.length?this._fade=t:this._fade=[t[0],t[0],t[0],t[0]]:this._fade=[t,t,t,t],this.redraw()}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision(),o=this._fade.map((function(t){return t*i}));this._setUniform("fade",new Float32Array(o),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}}]),n}(os);pa.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 fade;\n    \n    void main() {\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 point = vTextureCoord.xy * resolution.xy;\n        \n        vec2 pos1;\n        vec2 pos2;\n        vec2 d;\n        float c;\n        float t = 0.0;\n             \n        if(fade[0] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x, point.y + fade[0]);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[1] > 0.0) {\n            vec2 pos1 = vec2(point.x - resolution.x - fade[1], vTextureCoord.y);\n            vec2 pos2 = vec2(point.x - resolution.x, vTextureCoord.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[2] > 0.0) {\n            vec2 pos1 = vec2(vTextureCoord.x, point.y - resolution.y - fade[2]);\n            vec2 pos2 = vec2(vTextureCoord.x, point.y - resolution.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[3] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x + fade[3], point.y);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        gl_FragColor = color;\n    }\n";var va=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._magnitude=1.3,i._intensity=.7,i._pivot=[.5,.5],i}return v(n,[{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t),this._setUniform("magnitude",this._magnitude,this.gl.uniform1f),this._setUniform("intensity",this._intensity,this.gl.uniform1f),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this.redraw()}},{key:"pivot",set:function(t){Array.isArray(t)?this._pivot=t:this._pivot=[t,t],this.redraw()}},{key:"pivotX",get:function(){return this._pivot[0]},set:function(t){this._pivot[0]=t,this.redraw()}},{key:"pivotY",get:function(){return this._pivot[1]},set:function(t){this._pivot[1]=t,this.redraw()}},{key:"intensity",get:function(){return this._intensity},set:function(t){this._intensity=t,this.redraw()}},{key:"magnitude",get:function(){return this._magnitude},set:function(t){this._magnitude=t,this.redraw()}}]),n}(os);va.vertexShaderSource=os.vertexShaderSource,va.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float magnitude;\n    uniform float intensity;\n    uniform vec2 pivot;\n\n    void main() {\n        vec2 uv = vTextureCoord.xy - pivot + vec2(0.5);\n        uv.x = clamp(uv.x, 0.0, 1.0);\n        uv.y = clamp(uv.y, 0.0, 1.0);\n   \n        uv *=  1.00 - uv.yx;\n        float vig = uv.x * uv.y * 25.0 * intensity;\n        vig = pow(vig, 0.45 * magnitude);\n        vec4 fragColor = vec4(vig) * vColor;\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * fragColor;\n\n    }\n";var _a=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._radius=100,i._width=50,i._period=1,i._angle=.5,i._smooth=.005,i._color=4294967295,i._backgroundColor=4278190080,i._time=Date.now(),i}return v(n,[{key:"radius",set:function(t){this._radius=t,this.redraw()}},{key:"width",set:function(t){this._width=t,this.redraw()}},{key:"period",set:function(t){this._period=t,this.redraw()}},{key:"angle",set:function(t){this._angle=t,this.redraw()}},{key:"smooth",set:function(t){this._smooth=t,this.redraw()}},{key:"color",set:function(t){this._color=t,this.redraw()}},{key:"backgroundColor",set:function(t){this._backgroundColor=t,this.redraw()}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner;this._setUniform("iTime",Date.now()-this._time,this.gl.uniform1f);var i=this.ctx.stage.getRenderPrecision();this._setUniform("radius",this._radius*i,this.gl.uniform1f),this._setUniform("width",this._width*i,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("angle",this._angle,this.gl.uniform1f),this._setUniform("smooth",this._smooth,this.gl.uniform1f),this._setUniform("color",new Float32Array(uo.getRgbaComponentsNormalized(this._color)),this.gl.uniform4fv),this._setUniform("backgroundColor",new Float32Array(uo.getRgbaComponentsNormalized(this._backgroundColor)),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv),this.redraw()}}]),n}(os);_a.vertexShaderSource=os.vertexShaderSource,_a.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float iTime;\n    uniform float radius;\n    uniform float width;\n    uniform float period;\n    uniform float angle;\n    uniform float smooth;\n    uniform vec2 resolution;\n\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n\n    float ratio = resolution.y / resolution.x;\n\n    vec2 transpose_pos(vec2 pos) {\n        if (ratio < 1.) {\n            float diff = 0.5 - pos.x;\n            pos.x = 0.5 - diff / ratio;\n        } else {\n            float diff = 0.5 - pos.y;\n            pos.y = 0.5 - diff * ratio;\n        }\n        return pos;\n    }\n\n    float get_angle(vec2 pos) {\n        pos = transpose_pos(pos);\n        float a = atan(pos.y - 0.5, pos.x - 0.5);\n        a = (1.0+a/3.14159)/2.0;\n        \n        return a;\n    }\n\n    float dist(vec2 pos1, vec2 pos2) {\n        pos1 = transpose_pos(pos1);\n        return distance(pos1, pos2);\n    }\n\n    void main()\n    {\n        vec2 fragCoord = vTextureCoord;\n        vec4 fragColor = vColor;\n        \n        vec2 st = vTextureCoord;\n        float pct = dist(st, vec2(0.5));\n\n        float a = get_angle(st);\n        float t = iTime / 1000.0 / period;\n\n        float inner = max((radius - width) / resolution.x, (radius - width) / resolution.y);\n        float outer = max(radius / resolution.x, radius / resolution.y);\n\n        float x1 = mod(t, 1.0);\n        float x2 = mod(t + angle, 1.0);\n\n        if (x1 < x2) {\n            if (a > x1 && a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        } else {\n            if (a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else if (a > x1) {\n                float val = (1.0 - (1.0 + x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (1.0 + x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        }\n\n        float s = smoothstep(inner, inner + smooth + 0.00001, pct) * (1.0 - smoothstep(outer, outer + smooth + 0.00001, pct));\n        gl_FragColor = texture2D(uSampler, fragCoord) * vColor * (1. - s * fragColor.a) + fragColor * s;\n    }\n";var ya=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._x=0,i._y=0,i._w=0,i._h=0,i._radius=0,i}return v(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.redraw()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.redraw()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this.redraw()}},{key:"h",get:function(){return this._h},set:function(t){this._h=t,this.redraw()}},{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t,this.redraw()}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}},{key:"useDefault",value:function(){return 0===this._x&&0===this._y&&0===this._w&&0===this._h}}]),n}(os);ya.vertexShaderSource=os.vertexShaderSource,ya.fragmentShaderSource="\n   #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float x;\n    uniform float y;\n    uniform float w;\n    uniform float h;\n    uniform vec2 resolution;\n    uniform float radius;\n\n    float roundBox(vec2 p, vec2 b, float r) {\n        float d = length(max(abs(p)-b+r, 0.1))-r;\n        return smoothstep(1.0, 0.0, d);\n    }\n\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n        vec2 size = vec2(w, h) / 2.0;\n        float b = roundBox(pos, size, radius);\n        gl_FragColor = mix(color, vec4(0.0), b) * vColor;\n    }\n";var xa=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._pivot=[0,0],i._ic=4294967295,i._normalizedIC=i._getNormalizedColor(i._ic),i._oc=16777215,i._normalizedOC=i._getNormalizedColor(i._oc),i._radius=0,i}return v(n,[{key:"radiusX",get:function(){return this._radius},set:function(t){this.radius=t}},{key:"radiusY",get:function(){return this._radiusY},set:function(t){this._radiusY=t,this.redraw()}},{key:"radius",set:function(t){this._radius=t,this.redraw()}},{key:"innerColor",get:function(){return this._ic},set:function(t){this._ic=t,this._normalizedIC=this._getNormalizedColor(t),this.redraw()}},{key:"outerColor",get:function(){return this._ic},set:function(t){this._oc=t,this._normalizedOC=this._getNormalizedColor(t),this.redraw()}},{key:"color",get:function(){return this.innerColor},set:function(t){this.innerColor=t}},{key:"x",set:function(t){this._x=t,this.redraw()}},{key:"y",set:function(t){this._y=t,this.redraw()}},{key:"pivot",get:function(){return this._pivot[0]},set:function(t){Array.isArray(t)&&2===t.length?this._pivot=t:Array.isArray(t)?this._pivot=[t[0],t[1]||t[0]]:this._pivot=[t,t],this.redraw()}},{key:"pivotY",get:function(){return this._pivot[1]},set:function(t){this._pivot[1]=t,this.redraw()}},{key:"pivotX",get:function(){return this._pivot[0]},set:function(t){this._pivot[0]=t,this.redraw()}},{key:"_getNormalizedColor",value:function(t){var e=uo.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner;this._x&&(this._pivot[0]=this._x/e.w),this._y&&(this._pivot[1]=this._y/e.h),0===this._radius&&(this._radius=.5*e.w),this._setUniform("innerColor",this._normalizedIC,this.gl.uniform4fv),this._setUniform("fill",uo.getRgbaComponentsNormalized(this._oc)[3],this.gl.uniform1f),this._setUniform("outerColor",this._normalizedOC,this.gl.uniform4fv),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this._setUniform("resolution",new Float32Array([e._w,e._h]),this.gl.uniform2fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("radius",this._radius,this.gl.uniform1f),this._setUniform("radiusY",this._radiusY||this._radius,this.gl.uniform1f)}}]),n}(os);xa.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec2 pivot;\n    uniform vec4 innerColor;\n    uniform vec4 outerColor;\n    uniform float radius;\n    uniform float radiusY;\n    uniform float alpha;\n    uniform float fill;\n    uniform float aspectRatio;\n    \n    void main() {\n        vec2 point = vTextureCoord.xy * resolution;\n        vec2 projection = vec2(pivot.x * resolution.x, pivot.y * resolution.y);\n        float d = length((point - projection) / vec2(radius * 2.0, radiusY * 2.0));\n        vec4 color = mix(texture2D(uSampler, vTextureCoord) * vColor, outerColor * alpha, fill);\n        gl_FragColor = mix(innerColor * alpha, color, smoothstep(0.0, 1.0, d));\n    }\n";var ma=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._strength=.5,i._ambient=.5,i._fudge=.4,i._rx=0,i._ry=0,i._z=0,i._pivotX=NaN,i._pivotY=NaN,i._pivotZ=0,i._lightY=0,i._lightZ=0,i}return v(n,[{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,i=e.element,o=isNaN(this._pivotX)?i.pivotX*e.w:this._pivotX,s=isNaN(this._pivotY)?i.pivotY*e.h:this._pivotY,a=e.getRenderTextureCoords(o,s),u=-Math.atan2(e._renderContext.tc,e._renderContext.ta),l=this.gl;this._setUniform("pivot",new Float32Array([a[0],a[1],this._pivotZ]),l.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,u]),l.uniform3fv),this._setUniform("z",this._z,l.uniform1f),this._setUniform("lightY",this.lightY,l.uniform1f),this._setUniform("lightZ",this.lightZ,l.uniform1f),this._setUniform("strength",this._strength,l.uniform1f),this._setUniform("ambient",this._ambient,l.uniform1f),this._setUniform("fudge",this._fudge,l.uniform1f)}},{key:"strength",get:function(){return this._strength},set:function(t){this._strength=t,this.redraw()}},{key:"ambient",get:function(){return this._ambient},set:function(t){this._ambient=t,this.redraw()}},{key:"fudge",get:function(){return this._fudge},set:function(t){this._fudge=t,this.redraw()}},{key:"rx",get:function(){return this._rx},set:function(t){this._rx=t,this.redraw()}},{key:"ry",get:function(){return this._ry},set:function(t){this._ry=t,this.redraw()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this.redraw()}},{key:"pivotX",get:function(){return this._pivotX},set:function(t){this._pivotX=t+1,this.redraw()}},{key:"pivotY",get:function(){return this._pivotY},set:function(t){this._pivotY=t+1,this.redraw()}},{key:"lightY",get:function(){return this._lightY},set:function(t){this._lightY=t,this.redraw()}},{key:"pivotZ",get:function(){return this._pivotZ},set:function(t){this._pivotZ=t,this.redraw()}},{key:"lightZ",get:function(){return this._lightZ},set:function(t){this._lightZ=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._rx&&0===this._ry&&0===this._z&&0===this._strength&&1===this._ambient}}]),n}(os);ma.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float fudge;\n    uniform float strength;\n    uniform float ambient;\n    uniform float z;\n    uniform float lightY;\n    uniform float lightZ;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Set depth perspective\n        float perspective = 1.0 + fudge * pos.z;\n\n        pos.z += lightZ * projection.x;\n\n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, perspective);\n\n        // Correct light source position.\n        pos.y += lightY * abs(projection.y);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ma.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec3 pos;\n    uniform sampler2D uSampler;\n    uniform float ambient;\n    uniform float strength;\n    void main(void){\n        vec4 rgba = texture2D(uSampler, vTextureCoord);\n        float d = length(pos);\n        float n = 1.0 / max(0.1, d);\n        rgba.rgb = rgba.rgb * (strength * n + ambient);\n        gl_FragColor = rgba * vColor;\n    }\n";var ka=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._fudge=.2,i._rx=0,i._ry=0,i._z=1,i}return v(n,[{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,i=e.element,o=i.pivotX*e.w,s=i.pivotY*e.h,a=e.getRenderTextureCoords(o,s),u=-Math.atan2(e._renderContext.tc,e._renderContext.ta),l=this.gl;this._setUniform("pivot",new Float32Array([a[0],a[1],0]),l.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,u]),l.uniform3fv),this._setUniform("z",this._z,l.uniform1f),this._setUniform("fudge",this._fudge,l.uniform1f)}},{key:"fudge",get:function(){return this._fudge},set:function(t){this._fudge=t,this.redraw()}},{key:"rx",get:function(){return this._rx},set:function(t){this._rx=t,this.redraw()}},{key:"ry",get:function(){return this._ry},set:function(t){this._ry=t,this.redraw()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this.redraw()}},{key:"useDefault",value:function(){return 0===this._rx&&0===this._ry&&0===this._z}}]),n}(os);ka.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float z;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, z);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ka.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform vec3 rot;\n    uniform float fudge;\n\n    void main(void) {\n        vec2 coords = vTextureCoord;\n\n        coords.xy -= vec2(0.5);\n        coords.y = coords.y + (sign(rot[0]) * 0.5 - coords.x) * sin(rot[0]) * fudge * coords.y;\n        coords.x = coords.x + (sign(rot[1]) * 0.5 - coords.y) * sin(rot[1]) * fudge * coords.x;\n        coords.xy += vec2(0.5);\n\n        if (coords.x < 0.0 || coords.x > 1.0 || coords.y < 0.0 || coords.y > 1.0) {\n            gl_FragColor = vec4(0.0);\n        } else {\n            gl_FragColor = texture2D(uSampler, coords) * vColor;\n        }\n    }\n";var Ta=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._x=0,i._y=0,i._w=0,i._h=0,i._radius=0,i._magnification=.6,i}return v(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.redraw()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.redraw()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this.redraw()}},{key:"h",get:function(){return this._h},set:function(t){this._h=t,this.redraw()}},{key:"magnification",get:function(){return this._magnification},set:function(t){this._magnification=t,this.redraw()}},{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t,this.redraw()}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("magnification",this._magnification,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}},{key:"useDefault",value:function(){return 0===this._w&&0===this._h}}]),n}(os);Ta.vertexShaderSource=os.vertexShaderSource,Ta.fragmentShaderSource="\n\t  #ifdef GL_ES\n\t\t# ifdef GL_FRAGMENT_PRECISION_HIGH\n\t\tprecision highp float;\n\t\t# else\n\t\tprecision lowp float;\n\t\t# endif\n\t  #endif\n\n\t  varying vec2 vTextureCoord;\n\t  varying vec4 vColor;\n\t  uniform sampler2D uSampler;\n\t  uniform float x;\n\t  uniform float y;\n\t  uniform float w;\n\t  uniform float h;\n\t  uniform vec2 resolution;\n\t  uniform float radius;\n\t  uniform float magnification;\n  \n\t  float roundBox(vec2 p, vec2 b, float r) {\n\t\t  float d = length(max(abs(p)-b+r, 0.1))-r;\n\t\t  return smoothstep(1.0, 0.0, d);\n\t  }\n\n\t  float inside(vec2 v) {\n\t\tvec2 s = step(vec2(0.0, 0.0), v) - step(vec2(1.0, 1.0), v);\n\t\treturn s.x * s.y;   \n      }\n  \n\t  void main(void) {\n\t\tvec4 color = texture2D(uSampler, vTextureCoord);\n\t\tvec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n\t\tvec2 size = vec2(w, h) / 2.0;\n\t\tfloat b = roundBox(pos, size, radius);\n\t\tvec2 pos2 = (vTextureCoord.xy * magnification * resolution + vec2(x, y) * magnification) / resolution;\n\t\tgl_FragColor = mix(color, texture2D(uSampler, pos2) * inside(pos2), b) * vColor;\n\t  }\n  ";var ba=function(t){l(n,t);var e=c(n);function n(t){var i;return _(this,n),(i=e.call(this,t))._period=1,i._stroke=0,i._showDot=!0,i._clockwise=!0,i._bc=4278190080,i._normalizedBC=i._getNormalizedColor(i._bc),i._c=4294967295,i._normalizedC=i._getNormalizedColor(i._c),i}return v(n,[{key:"radius",set:function(t){0===t&&(t=1),this._radius=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=Math.abs(t)}},{key:"color",get:function(){return this._c},set:function(t){this._c=t,this._normalizedC=this._getNormalizedColor(t)}},{key:"backgroundColor",get:function(){return this._sc},set:function(t){this._bc=t,this._normalizedBC=this._getNormalizedColor(t)}},{key:"showDot",get:function(){return this._showDot},set:function(t){this._showDot=t}},{key:"clockwise",get:function(){return this._clockwise},set:function(t){this._clockwise=t}},{key:"period",get:function(){return this._period},set:function(t){this._period=t}},{key:"_getNormalizedColor",value:function(t){var e=uo.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,i=this._radius||e._w/2;0===this._stroke&&(this._stroke=.33*i),this._setUniform("resolution",new Float32Array([e._w,e._h]),this.gl.uniform2fv),this._setUniform("color",this._normalizedC,this.gl.uniform4fv),this._setUniform("backgroundColor",this._normalizedBC,this.gl.uniform4fv),this._setUniform("stroke",this._stroke,this.gl.uniform1f),this._setUniform("radius",i,this.gl.uniform1f),this._setUniform("direction",this._clockwise?-1:1,this.gl.uniform1f),this._setUniform("showDot",!!this._showDot,this.gl.uniform1f),this._setUniform("time",Date.now()-n.spinSync,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._sc===this._bc&&this._stroke===.5*i||this.redraw()}}]),n}(os);ba.spinSync=Date.now(),ba.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    \n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n    uniform float direction;\n    uniform float radius;\n    uniform float time;\n    uniform float stroke;\n    uniform float showDot;\n    uniform float period;\n    uniform float alpha;\n    \n    float circleDist(vec2 p, float radius){\n        return length(p) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 center = vTextureCoord.xy * resolution - halfRes;\n        \n        float c = max(-circleDist(center, radius - stroke), circleDist(center, radius));\n        float rot = -(time / 1000.0 / period) * 6.0 * direction;\n        center *= mat2(cos(rot), sin(rot), -sin(rot), cos(rot));\n        \n        float a = direction * atan(center.x, center.y) * PI * 0.05 + 0.45;\n        \n        float strokeRad = stroke * 0.5;\n        a = mix(a, max(a, fillMask(circleDist(vec2(center.x, center.y + (radius - strokeRad)), strokeRad))), showDot);\n        vec4 base = mix(vec4(0.0), backgroundColor * alpha, fillMask(c));\n        gl_FragColor = mix(base, color * alpha, fillMask(c) * a);\n    }\n";var wa={Application:Ns,Component:Zo,Base:ho,Utils:lo,StageUtils:uo,Element:Yo,Tools:js,Stage:Fs,ElementCore:Eo,ElementTexturizer:So,Texture:Mo,EventEmitter:Lo,shaders:{Grayscale:aa,BoxBlur:Ks,Dithering:la,CircularPush:ha,Inversion:ca,LinearBlur:qs,Outline:fa,Pixelate:da,RadialFilter:Aa,RoundedRectangle:ga,Spinner2:ba,FadeOut:pa,Hole:ya,Vignette:va,Spinner:_a,RadialGradient:xa,Light3d:ma,Perspective:ka,Magnifier:Ta,WebGLShader:rs,WebGLDefaultShader:os,C2dShader:cs,C2dDefaultShader:fs,c2d:{Grayscale:ua,Blur:Js}},textures:{RectangleTexture:Ds,NoiseTexture:Gs,TextTexture:Uo,ImageTexture:Po,HtmlTexture:Ys,StaticTexture:Xs,StaticCanvasTexture:Us,SourceTexture:Ho},components:{FastBlurComponent:$s,BloomComponent:ia,SmoothScaleComponent:oa,BorderComponent:sa,ListComponent:Vs},tools:{ObjMerger:Hs,ObjectListProxy:Ws,ObjectListWrapper:Qs}};lo.isWeb&&(window.lng=wa);var Ca=wa,Sa={},Ea=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null!==t){for(var e=(arguments.length>1?arguments[1]:void 0).split("."),n=0;n<e.length;n++)t=t[e[n]]=void 0!==t[e[n]]?t[e[n]]:{};return"object"==typeof t&&null!==t?Object.keys(t).length?t:void 0:t}}(Sa[t],e);return void 0!==i?i:n},Ia=/\{\/(.*?)\/([igm]{0,3})\}/g,La=/^[!*$]$/,Ra=/\/:\w+?@@([0-9]+?)@@/,Ma=/^\/:/,Pa=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"R";return Ia.test(t)&&(t=t.replace(Ia,e)),t},za=function(t,e){return["%c"+((e=Array.from(e)).length>1&&"string"==typeof e[0]?e.shift():t),"background-color: "+{Info:"green",Debug:"gray",Warn:"orange",Error:"red"}[t]+"; color: white; padding: 2px 4px; border-radius: 2px",e]},Ba=function(){Ea("platform","log")&&console.log.apply(console,za("Info",arguments))},Oa=function(){Ea("platform","log")&&console.debug.apply(console,za("Debug",arguments))},Da=function(){Ea("platform","log")&&console.error.apply(console,za("Error",arguments))},Fa=function(){function t(){var e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;_(this,t),this._hash=i,this._storeCaller=o,this._register=new Map,this._isCreated=!1,this._isSharedInstance=!1,this._cancelled=!1,this._copiedHistoryState=null,Dl(r)?this._register=(e=r,n=new Map,[].concat(y(Object.keys(e)),y(Object.getOwnPropertySymbols(e))).forEach((function(t){n.set(t,e[t])})),n):Fl(r)&&(this._storeCaller=r),this._register.set(Vl.store,this._storeCaller)}return v(t,[{key:"cancel",value:function(){Oa("[router]:","cancelled ".concat(this._hash)),this._cancelled=!0}},{key:"url",get:function(){return this._hash}},{key:"register",get:function(){return this._register}},{key:"hash",get:function(){return this._hash},set:function(t){this._hash=t}},{key:"route",get:function(){return this._route},set:function(t){this._route=t}},{key:"provider",get:function(){return this._provider},set:function(t){this._provider=t}},{key:"providerType",get:function(){return this._providerType},set:function(t){this._providerType=t}},{key:"page",get:function(){return this._page},set:function(t){this._page=t}},{key:"isCreated",get:function(){return this._isCreated},set:function(t){this._isCreated=t}},{key:"isSharedInstance",get:function(){return this._isSharedInstance},set:function(t){this._isSharedInstance=t}},{key:"isCancelled",get:function(){return this._cancelled}},{key:"copiedHistoryState",get:function(){return this._copiedHistoryState},set:function(t){this._copiedHistoryState=t}}]),t}(),Na=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_(this,t);var n=["on","before","after"].reduce((function(t,n){return Ol(e[n])?n:t}),void 0);this._cfg=e,n&&(this._provider={type:n,request:e[n]})}return v(t,[{key:"path",get:function(){return this._cfg.path}},{key:"name",get:function(){return this._cfg.name}},{key:"component",get:function(){return this._cfg.component}},{key:"options",get:function(){return this._cfg.options}},{key:"widgets",get:function(){return this._cfg.widgets}},{key:"cache",get:function(){return this._cfg.cache}},{key:"hook",get:function(){return this._cfg.hook}},{key:"beforeNavigate",get:function(){return this._cfg.beforeNavigate}},{key:"provider",get:function(){return this._provider}}]),t}(),Ua=function(t){return Pa(t).split("/").length},ja=function(t){t=t.replace(/^#/,"");var e=/(\/?:?[^/]+)/g,n=function(t){var e,n=[],i=w(Al.entries());try{for(i.s();!(e=i.n()).done;){var r=b(e.value,1)[0];Ua(r)===t&&n.push(r)}}catch(o){i.e(o)}finally{i.f()}return n}(Ua(t)),i=t.match(e)||[],r=[],o=n.filter((function(t){var n=!0;if(Ia.test(t)){var o=t.match(Ia);o&&o.length&&(t=o.reduce((function(t,e){var n=r.length;return t=t.replace(e,"@@".concat(n,"@@")),r.push(e.substring(1,e.length-1)),t}),t))}for(var s=t.match(e)||[],a=0,u=s.length;a<u;a++){var l=s[a],h=i[a];if(Ra.test(l)){var c=Ra.exec(l)[1],f=r[c],d=/\/([^\/]+)\/([igm]{0,3})/.exec(f);if(d&&d.length){var A=d[1],g=d[2];new RegExp("^/".concat(A,"$"),g).test(h)||(n=!1)}}else{if(Ma.test(l))continue;h&&l.toLowerCase()!==h.toLowerCase()&&(n=!1)}}return n}));if(o.length){if(-1!==o.indexOf(t)){var s=o[o.indexOf(t)];return Al.get(s)}if(o=o.sort((function(t){return Ma.test(t)?-1:1})),Rl(o[0]))return Al.get(o[0])}return!1},Ha=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;e=Pa(e,"");var n=/(\/?:?[\w%\s:.-]+)/g,i=t.match(n)||[],r=e.match(n)||[],o=/^\/:([\w-]+)\/?/;return r.reduce((function(t,e,n){var r=o.exec(e);return r&&r.length&&t.set(r[1],decodeURIComponent(i[n].replace(/^\//,""))),t}),new Map)},Wa=function(t,e){if(t&&t.hasOwnProperty(e))return t[e]},Qa=function(t){var e,n=w(Al.entries());try{for(n.s();!(e=n.n()).done;){var i=b(e.value,2),r=i[0];if(i[1].name===t)return r}}catch(o){n.e(o)}finally{n.f()}return!1},Ga=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};jl(e)||(e=[e]),e.forEach((function(e){var i="_on".concat(Hl(e));Ol(t[i])&&t[i](n)}))},Ya=null,Xa=function(){if(nl)return nl.get().reduce((function(t,e){return t[e.ref.toLowerCase()]=e,t}),{})},Va=function(){Ya=null,Ju._setState("")},Za=function(){return Ya},qa=function(t){Ya=t},Ka=function(t,e){return t.c({type:e,visible:!1,widgets:Xa()})},Ja=[],$a=function(t){var e=Cl();if(e){var n=t.register.get(Vl.store),i=ja(e),r=Wa(i.options,"preventStorage");if(Fl(n)?n:!r){var o=e.replace(/^\//,""),s=tu(o),a=eu(El(),t),u=zl();if(-1===s||u.get("storeSameHash"))Ja.push({hash:o,state:a});else{var l=Ja.splice(s,1)[0];Ja.push({hash:l.hash,state:a})}}}},tu=function(t){for(var e=0;e<Ja.length;e++)if(Ja[e].hash===t)return e;return-1},eu=function(t,e){if(e.isSharedInstance){if(e.copiedHistoryState)return e.copiedHistoryState}else if(t&&Ol(t.historyState))return t.historyState();return null},nu=function(){return Ja.slice(0)},iu=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];jl(t)&&(Ja=t)},ru=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"brightness",set:function(t){this._brightness=(t-50)/100,this.redraw()}},{key:"contrast",set:function(t){this._contrast=(t+50)/100,this.redraw()}},{key:"gamma",set:function(t){this._gamma=(t+50)/100,this.redraw()}},{key:"setupUniforms",value:function(t){r(g(n.prototype),"setupUniforms",this).call(this,t);var e=this.gl;this._setUniform("colorAdjust",[this._brightness||0,this._contrast||1,this._gamma||1],e.uniform3fv)}}]),n}(Ca.shaders.WebGLDefaultShader);ru.before="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n        \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec3 colorAdjust;\n    \n    const mat3 RGBtoOpponentMat = mat3(0.2814, -0.0971, -0.0930, 0.6938, 0.1458,-0.2529, 0.0638, -0.0250, 0.4665);\n    const mat3 OpponentToRGBMat = mat3(1.1677, 0.9014, 0.7214, -6.4315, 2.5970, 0.1257, -0.5044, 0.0159, 2.0517);    \n",ru.after="    \n    vec3 brightnessContrast(vec3 value, float brightness, float contrast)\n    {\n        return (value - 0.5) * contrast + 0.5 + brightness;\n    }   \n    \n    vec3 updateGamma(vec3 value, float param)\n    {\n        return vec3(pow(abs(value.r), param),pow(abs(value.g), param),pow(abs(value.b), param));\n    } \n       \n    void main(void){\n        vec4 fragColor = texture2D(uSampler, vTextureCoord);        \n        vec4 color = filter(fragColor) * vColor;       \n        \n        vec3 bc = brightnessContrast(color.rgb,colorAdjust[0],colorAdjust[1]);        \n        vec3 ga = updateGamma(bc.rgb, colorAdjust[2]);  \n              \n        gl_FragColor = vec4(ga.rgb, color.a);          \n    }    \n";var ou=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n)}(ru);ou.fragmentShaderSource="\n    ".concat(ru.before,"    \n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.20,  0.99, -0.19, 0.0);\n        vec4 g = vec4( 0.16,  0.79,  0.04, 0.0);\n        vec4 b = vec4( 0.01, -0.01,  1.00, 0.0);\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }\n    \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= opponentColor.y * 1.5; \n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));      \n    }    \n    ").concat(ru.after," \n");var su=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n)}(ru);su.fragmentShaderSource="\n    ".concat(ru.before,"\n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.43,  0.72, -0.15, 0.0 );\n        vec4 g = vec4( 0.34,  0.57,  0.09, 0.0 );\n        vec4 b = vec4(-0.02,  0.03,  1.00, 0.0 );\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }\n       \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= opponentColor.y * 1.5; \n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));    \n    }\n    ").concat(ru.after,"    \n");var au=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n)}(ru);au.fragmentShaderSource="\n    ".concat(ru.before,"    \n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.97,  0.11, -0.08, 0.0 );\n        vec4 g = vec4( 0.02,  0.82,  0.16, 0.0 );\n        vec4 b = vec4(-0.06,  0.88,  0.18, 0.0 );\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }   \n    \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= ((3.0 * opponentColor.z) - opponentColor.y) * 0.25;\n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));\n    }   \n    ").concat(ru.after," \n");var uu=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n)}(ru);uu.fragmentShaderSource="\n    ".concat(ru.before,"\n    vec4 filter( vec4 color )\n    {\n        return color;\n    }\n    ").concat(ru.after,"\n");var lu,hu,cu=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n)}(ru);function fu(t){return new Promise((function(e){setTimeout(e,t)}))}function du(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en-US",i=window.speechSynthesis;return new Promise((function(r,o){var s=new SpeechSynthesisUtterance(t);s.lang=n,s.onend=function(){r()},s.onerror=function(t){o(t)},e.push(s),i.speak(s)}))}function Au(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=window.speechSynthesis,r=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=[],n=0;n<t.length&&"string"==typeof t[n]&&!t[n].includes("PAUSE-");n++)e.push(t[n]);return[e.join(",\b ")].concat(t.slice(n))}(Array.isArray(t)?t:[t]),o=[],a=[],l=!0;return{series:u(s().mark((function t(){var n,i,u,h,c,f;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0;case 1:if(!l||!r.length){t.next=62;break}return t.next=4,Promise.resolve(r.shift());case 4:if(n=t.sent,l){t.next=9;break}return t.abrupt("break",62);case 9:if("string"!=typeof n||!n.includes("PAUSE-")){t.next=16;break}return i=1e3*n.split("PAUSE-")[1],isNaN(i)&&(i=0),t.next=14,fu(i);case 14:t.next=60;break;case 16:if("string"!=typeof n||!n.length){t.next=48;break}h=u=3;case 19:if(!(l&&h>0)){t.next=46;break}return t.prev=20,t.next=23,du(n,a,e);case 23:h=0,t.next=44;break;case 26:if(t.prev=26,t.t0=t.catch(20),!(t.t0 instanceof SpeechSynthesisErrorEvent)){t.next=43;break}if("network"!==t.t0.error){t.next=36;break}return h--,console.warn("Speech synthesis network error. Retries left: ".concat(h)),t.next=34,fu(500*(u-h));case 34:t.next=41;break;case 36:if("canceled"!==t.t0.error&&"interrupted"!==t.t0.error){t.next=40;break}h=0,t.next=41;break;case 40:throw new Error("SpeechSynthesisErrorEvent: ".concat(t.t0.error));case 41:t.next=44;break;case 43:throw t.t0;case 44:t.next=19;break;case 46:t.next=60;break;case 48:if("function"!=typeof n){t.next=55;break}return c=Au(n(),e,!1),o.push(c),t.next=53,c.series;case 53:t.next=60;break;case 55:if(!Array.isArray(n)){t.next=60;break}return f=Au(n,e,!1),o.push(f),t.next=60,f.series;case 60:t.next=1;break;case 62:return t.prev=62,l=!1,t.finish(62);case 65:case"end":return t.stop()}}),t,null,[[0,,62,65],[20,26]])})))(),get active(){return l},append:function(t){r.push(t)},cancel:function(){l&&(n&&i.cancel(),o.forEach((function(t){t.cancel()})),l=!1)}}}function gu(t,e){return lu&&lu.cancel(),lu=Au(t,e)}function pu(t){return t.ref||t.constructor.name}function vu(t,e,n){var i,r,o,s,a;function u(){var l=Date.now()-s;l<e&&l>=0?i=setTimeout(u,e-l):(i=null,n||(a=t.apply(o,r),o=r=null))}null==e&&(e=100);var l=function(){o=this,r=arguments,s=Date.now();var l=n&&!i;return i||(i=setTimeout(u,e)),l&&(a=t.apply(o,r),o=r=null),a};return l.clear=function(){i&&(clearTimeout(i),i=null)},l.flush=function(){i&&(a=t.apply(o,r),o=r=null,clearTimeout(i),i=null)},l}cu.fragmentShaderSource="\n    ".concat(ru.before,"\n    vec4 filter( vec4 color )\n    {   \n        float grey = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n        return vec4(vec3(grey, grey, grey), 1.0 ); \n    }\n    ").concat(ru.after,"\n");var _u,yu=[],xu=!1;function mu(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(Su.enabled){var e=t.every((function(t){return!t.loading})),n=t.filter((function(t){return!yu.includes(t)}));if(hu(),e){yu=t.slice(0);var i=[],r=n.reduce((function(t,e){return e.announce?(t.push([pu(e),"Announce",e.announce]),i.push(e.announce)):e.title&&(t.push([pu(e),"Title",e.title]),i.push(e.title)),t}),[]);return n.reverse().reduce((function(t,e){return e.announceContext?(t.push([pu(e),"Context",e.announceContext]),i.push(e.announceContext)):t.push([pu(e),"No Context",""]),t}),r),Su.debug&&console.table(r),i.length?Su.speak(i.reduce((function(t,e){return t.concat(e)}),[])):void 0}Su.onFocusChange()}}var ku,Tu,bu,wu,Cu,Su={enabled:!0,debug:!1,cancel:function(){_u&&_u.cancel()},clearPrevFocus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;yu=yu.slice(0,t),hu()},speak:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.append,i=void 0!==n&&n,r=e.notification,o=void 0!==r&&r;return Su.enabled&&(Su.onFocusChange.flush(),i&&_u&&_u.active?_u.append(t):(Su.cancel(),function(t){if(!xu)_u=gu(t)}(t)),o&&(xu=!0,_u.series.finally((function(){xu=!1,Su.refresh()})))),_u},setupTimers:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.focusDebounce,n=void 0===e?400:e,i=t.focusChangeTimeout,r=void 0===i?3e5:i;Su.onFocusChange=vu(mu,n),hu=vu((function(){yu=[]}),r)}};Su.setupTimers();var Eu,Iu=function(t,e,n){ku.info("Sending metric",t,e,n)},Lu=function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};r=m({params:r},{message:e,code:n,visible:i}),Iu(t,"error",r)},Ru=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.reduce((function(e,i){return e[i]=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=m(m(m({},n),e?{name:e}:{}),r),Iu(t,i,r)},e}),{error:function(e,n,i){Lu(t,e,n,i)},event:function(e,n){Iu(t,e,n)}})},Mu=(Eu={app:["launch","loaded","ready","close"],page:["view","leave"],user:["click","input"],media:["abort","canplay","ended","pause","play","volumechange","waiting","seeking","seeked"]},Object.keys(Eu).reduce((function(t,e){return t[e]="media"===e?function(t){return Ru(e,Eu[e],{url:t})}:Ru(e,Eu[e]),t}),{error:Lu,event:Iu}));new Date(new Date-3e5).toUTCString(),new Date(new Date-12e5).toUTCString(),new Date(new Date-6e5).toUTCString();var Pu,zu,Bu,Ou,Du={abort:"Abort",canplay:"CanPlay",canplaythrough:"CanPlayThrough",durationchange:"DurationChange",emptied:"Emptied",encrypted:"Encrypted",ended:"Ended",error:"Error",interruptbegin:"InterruptBegin",interruptend:"InterruptEnd",loadeddata:"LoadedData",loadedmetadata:"LoadedMetadata",loadstart:"LoadStart",pause:"Pause",play:"Play",playing:"Playing",progress:"Progress",ratechange:"Ratechange",seeked:"Seeked",seeking:"Seeking",stalled:"Stalled",timeupdate:"TimeUpdate",volumechange:"VolumeChange",waiting:"Waiting"},Fu=null,Nu=1,Uu=!1,ju={},Hu={adsEnabled:!1,playing:!1,_playingAds:!1,get playingAds(){return this._playingAds},set playingAds(t){this._playingAds!==t&&(this._playingAds=t,Gu(!0===t?"AdStart":"AdEnd"))},skipTime:!1,playAfterSeek:null},Wu={play:function(){Hu.playing=!0},pause:function(){Hu.playing=!1},seeked:function(){!0===Hu.playAfterSeek&&qu.play(),Hu.playAfterSeek=null},abort:function(){Zu()}},Qu=function(t){return Math.round(Nu*t)+"px"},Gu=function(t,e){Ou&&(Ou.fire("$videoPlayer"+t,e,Pu.currentTime),Ou.fire("$videoPlayerEvent",t,e,Pu.currentTime))},Yu=null,Xu=null,Vu=function(){ku.info("VideoPlayer","Registering event listeners"),Object.keys(Du).forEach((function(t){var e=function(e){Bu&&Bu[t]&&"function"==typeof Bu[t]&&Bu[t]({currentTime:Pu.currentTime}),function(t,e){Wu[t]&&"function"==typeof Wu[t]&&Wu[t].call(null,t,e)}(t,{videoElement:Pu,event:e}),Gu(Du[t],{videoElement:Pu,event:e})};ju[t]=e,Pu.addEventListener(t,e)}))},Zu=function(){ku.info("VideoPlayer","Deregistering event listeners"),Object.keys(ju).forEach((function(t){Pu.removeEventListener(t,ju[t])})),ju={}},qu={consumer:function(t){Ou=t},loader:function(t){Yu=t},unloader:function(t){Xu=t},position:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Pu.style.left=Qu(e),Pu.style.top=Qu(t),!0===Uu&&zu.position(t,e)},size:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1920,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1080;Pu.style.width=Qu(t),Pu.style.height=Qu(e),Pu.width=parseFloat(Pu.style.width),Pu.height=parseFloat(Pu.style.height),!0===Uu&&zu.size(t,e)},area:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1920,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1080,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.position(t,i),this.size(e-i,n-t)},open:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.canInteract)if(Bu=Mu.media(t),this.hide(),Zu(),this.src==t)this.clear().then(this.open(t,n));else{var i={enabled:Hu.adsEnabled,duration:300};n.videoId&&(i.caid=n.videoId),wu.get(i,Ou).then((function(i){Hu.playingAds=!0,i.prerolls().then((function(){Hu.playingAds=!1,function(t,e,n){return Yu&&"function"==typeof Yu?Yu(t,e,n):new Promise((function(n){e.setAttribute("src",t),e.load(),n()}))}(t,Pu,n).then((function(){Vu(),e.show(),e.play()})).catch((function(t){Gu("Error",{videoElement:Pu,event:t}),Gu("error",{videoElement:Pu,event:t})}))}))}))}},reload:function(){if(this.canInteract){var t=Pu.getAttribute("src");this.close(),this.open(t)}},close:function(){var t=this;wu.cancel(),Hu.playingAds&&(Hu.playingAds=!1,wu.stop(),setTimeout((function(){t.close()}))),this.canInteract&&(this.clear(),this.hide(),Zu())},clear:function(){if(this.canInteract)return this.pause(),!0===Uu&&zu.stop(),function(t){return Xu&&"function"==typeof Xu?Xu(t):new Promise((function(e){t.removeAttribute("src"),t.load(),e()}))}(Pu).then((function(){Gu("Clear",{videoElement:Pu})}))},play:function(){this.canInteract&&(!0===Uu&&zu.start(),function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t&&"function"==typeof t)try{e=t.apply(i,n)}catch(r){e=r}else e=t;return null!==e&&"object"==typeof e&&e.then&&"function"==typeof e.then?e:new Promise((function(t,n){e instanceof Error?n(e):t(e)}))}(Pu.play,null,Pu).catch((function(t){Gu("Error",{videoElement:Pu,event:t}),Gu("error",{videoElement:Pu,event:t})})))},pause:function(){this.canInteract&&Pu.pause()},playPause:function(){this.canInteract&&(!0===this.playing?this.pause():this.play())},mute:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.canInteract&&(Pu.muted=t)},loop:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Pu.loop=t},seek:function(t){this.canInteract&&this.src&&(null===Hu.playAfterSeek&&(Hu.playAfterSeek=!!Hu.playing),this.pause(),Pu.currentTime=Math.max(0,Math.min(t,this.duration-.1)))},skip:function(t){var e=this;this.canInteract&&this.src&&(Hu.skipTime=(Hu.skipTime||Pu.currentTime)+t,function(t,e){clearTimeout(Fu),Fu=setTimeout((function(){t()}),e)}((function(){e.seek(Hu.skipTime),Hu.skipTime=!1}),300))},show:function(){this.canInteract&&(!0===Uu?zu.show():(Pu.style.display="block",Pu.style.visibility="visible"))},hide:function(){this.canInteract&&(!0===Uu?zu.hide():(Pu.style.display="none",Pu.style.visibility="hidden"))},enableAds:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Hu.adsEnabled=t},get duration(){return Pu&&(isNaN(Pu.duration)?1/0:Pu.duration)},get currentTime(){return Pu&&Pu.currentTime},get muted(){return Pu&&Pu.muted},get looped(){return Pu&&Pu.loop},get src(){return Pu&&Pu.getAttribute("src")},get playing(){return Hu.playing},get playingAds(){return Hu.playingAds},get canInteract(){return!1===Hu.playingAds},get top(){return Pu&&parseFloat(Pu.style.top)},get left(){return Pu&&parseFloat(Pu.style.left)},get bottom(){return Pu&&parseFloat(Pu.style.top-Pu.style.height)},get right(){return Pu&&parseFloat(Pu.style.left-Pu.style.width)},get width(){return Pu&&parseFloat(Pu.style.width)},get height(){return Pu&&parseFloat(Pu.style.height)},get visible(){return!0===Uu?zu.isVisible:Pu&&"block"===Pu.style.display},get adsEnabled(){return Hu.adsEnabled},get _videoEl(){return Pu},get _consumer(){return Ou}};!function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=!1,i=function(){!1===n&&(e(),n=!0)};Object.keys(t).reduce((function(e,n){return"function"==typeof t[n]?e[n]=function(){return i(),t[n].apply(t,arguments)}:"function"==typeof Object.getOwnPropertyDescriptor(t,n).get?e.__defineGetter__(n,(function(){return i(),Object.getOwnPropertyDescriptor(t,n).get.apply(t)})):"function"==typeof Object.getOwnPropertyDescriptor(t,n).set?e.__defineSetter__(n,(function(){return i(),Object.getOwnPropertyDescriptor(t,n).set.sourceObject[n].apply(t,arguments)})):e[n]=t[n],e}),{})}(qu,(function(){Pu=function(){var t=document.getElementsByTagName("video");if(t&&t.length)return t[0];var e=document.createElement("video"),n=Tu.get("platform","width")?Tu.get("platform","width"):1920,i=Tu.get("platform","height")?Tu.get("platform","height"):1080;return e.setAttribute("id","video-player"),e.setAttribute("width",Qu(n)),e.setAttribute("height",Qu(i)),e.style.position="absolute",e.style.zIndex="1",e.style.display="none",e.style.visibility="hidden",e.style.top=Qu(0),e.style.left=Qu(0),e.style.width=Qu(n),e.style.height=Qu(i),document.body.appendChild(e),e}(),!0===(Uu=Tu.get("platform","textureMode",!1))&&(Pu.setAttribute("crossorigin","anonymous"),zu=function(){if(!bu.tag("VideoTexture")){var t=bu.stage.c({type:function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"videoEl",get:function(){return this._videoEl},set:function(t){this._videoEl=t}},{key:"videoView",get:function(){return this.tag("Video")}},{key:"videoTexture",get:function(){return this.videoView.texture}},{key:"isVisible",get:function(){return 1===this.videoView.alpha&&!0===this.videoView.visible}},{key:"_init",value:function(){this._createVideoTexture()}},{key:"_createVideoTexture",value:function(){var t=this.stage.gl,e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.videoTexture.options={source:e,w:this.videoEl.width,h:this.videoEl.height},this.videoView.w=this.videoEl.width/this.stage.getRenderPrecision(),this.videoView.h=this.videoEl.height/this.stage.getRenderPrecision()}},{key:"start",value:function(){var t=this,e=this.stage;this._lastTime=0,this._updateVideoTexture||(this._updateVideoTexture=function(){if(t.videoTexture.options.source&&t.videoEl.videoWidth&&t.active){var n=e.gl,i=(new Date).getTime(),r=t.videoEl.getVideoPlaybackQuality(),o=r?r.totalVideoFrames:t.videoEl.webkitDecodedFrameCount;if(o?t._lastFrame!==o:t._lastTime<i-30){t._lastTime=i,t._lastFrame=o;try{n.bindTexture(n.TEXTURE_2D,t.videoTexture.options.source),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t.videoEl),t._lastFrame=t.videoEl.webkitDecodedFrameCount,t.videoView.visible=!0,t.videoTexture.options.w=t.videoEl.width,t.videoTexture.options.h=t.videoEl.height;var s=t.videoView.w/t.videoView.h,a=t.videoEl.width/t.videoEl.height;s>a?(t.videoView.scaleX=a/s,t.videoView.scaleY=1):(t.videoView.scaleY=s/a,t.videoView.scaleX=1)}catch(u){ku.error("texImage2d video",u),t.stop()}t.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(e.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}},{key:"stop",value:function(){var t=this.stage;if(t.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoView.visible=!1,this.videoTexture.options.source){var e=t.gl;e.bindTexture(e.TEXTURE_2D,this.videoTexture.options.source),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}}},{key:"position",value:function(t,e){this.videoView.patch({x:e,y:t})}},{key:"size",value:function(t,e){this.videoView.patch({w:t,h:e})}},{key:"show",value:function(){this.videoView.alpha=1}},{key:"hide",value:function(){this.videoView.alpha=0}}],[{key:"_template",value:function(){return{Video:{alpha:1,visible:!1,pivot:.5,texture:{type:Cu.textures.StaticTexture,options:{}}}}}}]),n}(Cu.Component),ref:"VideoTexture",zIndex:0,videoEl:Pu});bu.childList.addAt(t,0)}return bu.tag("VideoTexture")}())}));Ca.Component,Ca.Component;var Ku,Ju,$u,tl,el,nl,il,rl,ol,sl,al,ul,ll={eventListeners:[],timeouts:[],intervals:[],targets:[]},hl=(function(t){function e(e,n){return t.apply(this,arguments)}e.toString=function(){return t.toString()}}((function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=setTimeout((function(){ll.timeouts=ll.timeouts.filter((function(t){return t!==o})),t.apply(null,i)}),e,i);return Ba("Set Timeout","ID: "+o),ll.timeouts.push(o),o})),function(t){function e(e){return t.apply(this,arguments)}e.toString=function(){return t.toString()}}((function(t){ll.timeouts.indexOf(t)>-1?(ll.timeouts=ll.timeouts.filter((function(e){return e!==t})),Ba("Clear Timeout","ID: "+t),clearTimeout(t)):Da("Clear Timeout","ID "+t+" not found")})),function(t){function e(e,n){return t.apply(this,arguments)}e.toString=function(){return t.toString()}}((function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=setInterval((function(){ll.intervals.filter((function(t){return t!==o})),t.apply(null,i)}),e,i);return Ba("Set Interval","ID: "+o),ll.intervals.push(o),o})),function(t){function e(e){return t.apply(this,arguments)}e.toString=function(){return t.toString()}}((function(t){ll.intervals.indexOf(t)>-1?(ll.intervals=ll.intervals.filter((function(e){return e!==t})),Ba("Clear Interval","ID: "+t),clearInterval(t)):Da("Clear Interval","ID "+t+" not found")})),function(t,e,n){t.addEventListener(e,n);var i=ll.targets.indexOf(t)>-1?ll.targets.indexOf(t):ll.targets.push(t)-1;ll.eventListeners[i]=ll.eventListeners[i]||{},ll.eventListeners[i][e]=ll.eventListeners[i][e]||[],ll.eventListeners[i][e].push(n),Ba("Add eventListener","Target:",t,"Event: "+e,"Handler:",n.toString())}),cl=!0,fl=function(){var t=u(s().mark((function t(e,n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",!0);case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),dl=function(){},Al=new Map,gl=new Map,pl=!1,vl=null,_l=function(t,e){var n=t.appInstance,i=t.routes;e&&Nl(e)&&(Ju=e),Ju||(Ju=n||undefined),Ku=Ju.application,$u=Ku.childList,tl=Ju.stage,el=Gl(),function(t){t.pages&&($u=t.pages.childList),t.widgets&&t.widgets.children&&(nl=t.widgets.childList).forEach((function(t){return t.visible=!1})),t._handleBack=function(t){_h(-1),t.preventDefault()}}(Ju),jl(i)?yl(t):Ol(i)&&(console.warn("[Router]: Calling Router.route() directly is deprecated."),console.warn("Use object config: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration"))},yl=function(t){pl||xl(t),t.routes.forEach((function(t){var e=Ql(t.path);if(Rl(e))console.error("".concat(e," already exists in routes configuration"));else{var n=function(t){if("$"===t.path){var e={preventStorage:!0};Dl(t.options)&&(e=m(m({},t.options),e)),t.options=e,rl&&(t.after=rl)}return new Na(t)}(t);if(Al.set(e,n),n.component){var i=n.component;Ul(i)&&(el.get("lazyCreate")||(i=Ka(tl,i),$u.a(i))),gl.set(e,i)}}}))},xl=function(t){il=t.root,Ol(t.boot)&&(rl=t.boot),Fl(t.updateHash)&&(cl=t.updateHash),Ol(t.beforeEachRoute)&&(fl=t.beforeEachRoute),Ol(t.afterEachRoute)&&(dl=t.afterEachRoute),t.bootComponent&&(console.warn("[Router]: Boot Component is now available as a special router: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration?id=special-routes"),console.warn("[Router]: setting { bootComponent } property will be deprecated in a future release"),Nl(t.bootComponent)?t.routes.push({path:"$",component:t.bootComponent,after:rl||null,options:{preventStorage:!0}}):console.error("[Router]: ".concat(t.bootComponent," is not a valid boot component"))),t.routes.forEach((function(e){var n=Pa(e.path);if(/(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*\/:(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\?$/.test(n)){var i=e.path.substring(0,e.path.lastIndexOf("/")),r=e.path.substring(0,e.path.lastIndexOf("?"));e.path=r;var o=m({},e);o.path=i,t.routes.push(o)}})),pl=!0},ml=function(t,e){gl.has(t)&&gl.set(t,e)},kl=function(t){return gl.has(t)?gl.get(t):null},Tl=function(){if(!el||!el.size)return!1;var t=el.get("updateHash");return!(Fl(t)&&!t||Fl(cl)&&!cl)},bl=function(t){var e=t.hash,n=t.route,i=t.register,r=t.page;Wa(n.options,"clearHistory")?iu([]):e&&!La.test(n.path)&&$a(t),ml(n.path,r),t.isSharedInstance||!t.isCreated?Ga(r,"changed"):t.isCreated&&Ga(r,"mounted"),nl&&function(t,e){var n=(t||[]).map((function(t){return t.toLowerCase()}));nl.forEach((function(t){t.visible=-1!==n.indexOf(t.ref.toLowerCase()),t.visible&&Ga(t,["activated"],e)})),"Widgets"===Ju.state&&Ya&&!Ya.visible&&Ju._setState("")}(n.widgets,r),El()&&!t.isSharedInstance&&wl(vl,t),i.get(Vl.historyState)&&Ol(r.historyState)&&r.historyState(i.get(Vl.historyState)),Sl(r),ol=t.hash,sl=n.path;var o,s=w(lh.values());try{for(s.s();!(o=s.n()).done;){var a=o.value;a.isCancelled&&a.hash&&lh.delete(a.hash)}}catch(u){s.e(u)}finally{s.f()}dl(t),Ba("[route]:",n.path),Ba("[hash]:",e)},wl=function(t,e){var n=sl,i=e.register,r=el.get("lazyDestroy"),o=el.get("destroyOnHistoryBack"),s=i.get("keepAlive"),a=!1;i.get(Vl.backtrack)&&(o||r)&&(a=!0),r&&!s&&(a=!0),sl===e.route.path&&(a=!0),a?(ml(n,t._routedType||t.constructor),$u.remove(t),el.get("gcOnUnload")&&tl.gc()):t.patch({x:0,y:0,scale:1,visible:!1,alpha:1})},Cl=function(){return ol},Sl=function(t){vl=t},El=function(){return vl},Il=function(){return sl},Ll=function(){return al},Rl=function(t){return Al.has(t)},Ml=function(){return il},Pl=function(){return rl},zl=function(){return el},Bl=function(){return Al},Ol=function(t){return"function"==typeof t},Dl=function(t){return"object"==typeof t&&null!==t},Fl=function(t){return"boolean"==typeof t},Nl=function(t){return!!(t instanceof Ca.Element||Ul(t))},Ul=function(t){return t.prototype&&"isComponent"in t.prototype},jl=function(t){return Array.isArray(t)},Hl=function(t){return"".concat(t.charAt(0).toUpperCase()).concat(t.slice(1))},Wl=function(t){return"string"==typeof t},Ql=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/^#/,"").replace(/\/+$/,"")},Gl=function(){var t=Ea("platform","router"),e=Dl(t);return["backtrack","gcOnUnload","destroyOnHistoryBack","lazyCreate","lazyDestroy","reuseInstance","autoRestoreRemote","numberNavigation","updateHash","storeSameHash"].reduce((function(n,i){return n.set(i,e?t[i]:Ea("platform",i)),n}),new Map)},Yl=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cl(),e=xh();"$"!==t&&t||!e||Wl(e)&&(t=e);var n="",i=/([?&].*)/.exec(t),r={};if(document.location&&document.location.search&&(n=document.location.search),i&&i.length){var o=i[1];n?(o=o.replace(/^\?/,""),n="".concat(n,"&").concat(o)):n=o}if(n){var s,a=w(new URLSearchParams(n).entries());try{for(a.s();!(s=a.n()).done;){var u=b(s.value,2),l=u[0],h=u[1];r[l]=h}}catch(c){a.e(c)}finally{a.f()}return r}return!1},Xl=function(t){return Dl(t)?"?"+Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join("&"):""},Vl={route:Symbol("route"),hash:Symbol("hash"),store:Symbol("store"),fromHistory:Symbol("fromHistory"),expires:Symbol("expires"),resume:Symbol("resume"),backtrack:Symbol("backtrack"),historyState:Symbol("historyState"),queryParams:Symbol("queryParams")},Zl={on:function(t){return function(t){ul=t}(Ju.state||""),Ju._setState("Loading"),ql(t)},before:function(t){return ql(t)},after:function(t){try{ql(t,!0)}catch(e){}return Promise.resolve()}},ql=function(t,e){var n=t.route,i=n.provider,r=n.cache?1e3*n.cache:0,o=Kl(t);return i.request(t.page,m({},o)).then((function(){t.page[Vl.expires]=Date.now()+r,e&&Ga(t.page,"dataProvided")})).catch((function(e){throw t.page[Vl.expires]=Date.now(),e}))},Kl=function(t){var e,n=t.page,i=t.route,r=t.hash,o=t.register,s=void 0===o?new Map:o,a=Ha(r,i.path),u=Yl(r),l={},h=w(new Map([].concat(y(a),y(s))));try{for(h.s();!(e=h.n()).done;){var c=b(e.value,2),f=c[0],d=c[1];l[f]=d}}catch(m){h.e(m)}finally{h.f()}if(u&&(l[Vl.queryParams]=u),s.size){var A,g={},p=w(s);try{for(p.s();!(A=p.n()).done;){var v=b(A.value,2),_=v[0],x=v[1];g[_]=x}}catch(m){p.e(m)}finally{p.f()}n.persist=g}return n.params=l,Ga(n,["urlParams"],l),l},Jl=function(t){if(!t[Vl.expires])return!1;var e=t[Vl.expires];return Date.now()>=e},$l=function(t){return!!Rl(t)&&!!Al.get(t).provider},th=function(t){if(Rl(t.path)){var e=Al.get(t.path).provider;return{type:e.type,provider:e.request}}},eh=function(t,e,n,i){var r="x"===t?1920:1080;return new Promise((function(o){var s,a;(n.patch((k(s={},"".concat(t),e?-1*r:r),k(s,"visible",!0),k(s,"smooth",k({},"".concat(t),[0,{duration:.4,delay:.2}])),s)),i)&&i.patch((k(a={},"".concat(t),0),k(a,"smooth",k({},"".concat(t),[e?r:-1*r,{duration:.4,delay:.2}])),a));n.transition(t).on("finish",(function(){o()}))}))},nh={fade:function(t,e){return new Promise((function(n){t.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),t.transition("alpha").on("finish",(function(){e&&(e.visible=!1),n()}))}))},crossFade:function(t,e){return new Promise((function(n){t.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),e&&e.patch({smooth:{alpha:[0,{duration:.5,delay:.3}]}}),t.transition("alpha").on("finish",(function(){n()}))}))},up:function(t,e){return eh("y",0,t,e)},down:function(t,e){return eh("y",1,t,e)},left:function(t,e){return eh("x",0,t,e)},right:function(t,e){return eh("x",1,t,e)}},ih=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t.pageTransition||t.easing,i=!!(t.smoothIn||t.smoothInOut||n),r=zl().get("disableTransitions");if(t.easing&&console.warn("easing() method is deprecated and will be removed. Use pageTransition()"),!i||r)return t.visible=!0,e&&(e.visible=!1),Promise.resolve();if(n){var o;try{o=n.call(t,t,e)}catch(a){o="crossFade"}if(function(t){var e;if(Ol(t))try{e=t.apply(null)}catch(a){e=a}else e=t;return Dl(e)&&Ol(e.then)}(o))return o;if(Wl(o)){var s=nh[o];if(s)return s(t,e)}if(t.smoothIn){return t.smoothIn({pageIn:t,smooth:function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(r){t.visible=!0,t.setSmooth(e,n,i),t.transition(e).on("finish",(function(){r()}))}))}})}}return nh.crossFade(t,e)},rh=function(){var t=u(s().mark((function t(e){var n,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=!1,t.prev=1,t.next=4,oh(e);case 4:if(!(e=t.sent)||e.isCancelled){t.next=12;break}if("Loading"===Ju.state&&("Widgets"===ul?Ju._setState("Widgets",[Za()]):Ju._setState("")),e.isSharedInstance||e.isCancelled){t.next=10;break}return t.next=10,ih(e.page,El());case 10:t.next=13;break;case 12:n=!0;case 13:if(!n&&!e.isCancelled){t.next=18;break}Oa("[router]:","Rejected ".concat(e.hash," because route to ").concat(Ll()," started")),e.isCreated&&!e.isSharedInstance&&$u.remove(e.page),t.next=20;break;case 18:return bl(e),t.abrupt("return",e.page);case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(1),t.t0.route?n||(i=t.t0.route,Wa(i.options,"clearHistory")?iu([]):La.test(i.path)||$a(t.t0),t.t0.isCreated&&!t.t0.isSharedInstance&&$u.remove(t.t0.page),sh(t.t0)):console.error(t.t0);case 25:case"end":return t.stop()}}),t,null,[[1,22]])})));return function(e){return t.apply(this,arguments)}}(),oh=function(){var t=u(s().mark((function t(e){var n,i,r,o,a,u,l,h,c,f;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.route,i=e.hash,r=e.register,o=kl(n.path),a=Ul(o),u=!1,a||r.get(Vl.backtrack)||ah(n)||(o=o.constructor,a=!0),a?(e.page=Ka(tl,o),$u.a(e.page),$l(n.path)&&(u=!0),e.isCreated=!0):(e.page=o,$l(n.path)&&(Jl(o)||o[Vl.hash]!==i)&&(u=!0),l=El()&&El()[Vl.route],n.path===l&&(e.isSharedInstance=!0,Ol(e.page.historyState)&&(e.copiedHistoryState=e.page.historyState()))),e.page[Vl.hash]=i,e.page[Vl.route]=n.path,t.prev=10,!u){t.next=25;break}return h=th(n),c=h.type,f=h.provider,e.provider=f,e.providerType=c,t.next=17,Zl[c](e);case 17:if(i===Ll()){t.next=21;break}return t.abrupt("return",!1);case 21:return"after"!==e.providerType&&Ga(e.page,"dataProvided"),t.abrupt("return",e);case 23:t.next=27;break;case 25:return Kl(e),t.abrupt("return",e);case 27:t.next=33;break;case 29:return t.prev=29,t.t0=t.catch(10),e.error=t.t0,t.abrupt("return",Promise.reject(e));case 33:case"end":return t.stop()}}),t,null,[[10,29]])})));return function(e){return t.apply(this,arguments)}}(),sh=function(t){t&&t.error?console.error(t.error):t&&Da(t),t.page&&Rl("!")&&Ah("!",{request:t},!1)},ah=function(t){var e=Wa(t.options,"reuseInstance"),n=el.get("reuseInstance");return Fl(e)?e:!(Fl(n)&&!1===n)},uh=function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"pages",get:function(){return this.tag("Pages")}},{key:"widgets",get:function(){return this.tag("Widgets")}},{key:"_handleBack",value:function(){}},{key:"_getFocused",value:function(){return bh.getActivePage()}}],[{key:"_template",value:function(){return{Pages:{forceZIndexContext:!0},Loading:{rect:!0,w:1920,h:1080,color:4278190080,visible:!1,zIndex:99,Label:{mount:.5,x:960,y:540,text:{text:"Loading.."}}}}}},{key:"_states",value:function(){return[function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"$enter",value:function(){this.tag("Loading").visible=!0}},{key:"$exit",value:function(){this.tag("Loading").visible=!1}}]),n}(this),function(t){l(n,t);var e=c(n);function n(){return _(this,n),e.apply(this,arguments)}return v(n,[{key:"$enter",value:function(t,e){this._widget=e,this._refocus()}},{key:"_getFocused",value:function(){return this._widget}},{key:"reload",value:function(t){this._widget=t,this._refocus()}},{key:"_handleKey",value:function(){var t=el.get("autoRestoreRemote");Fl(t)&&!0!==t||bh.focusPage()}}]),n}(this)]}}]),n}(Ca.Component),lh=new Map,hh="",ch="",fh=function(){var t=(mh()||"").replace(/^#/,""),e="$",n=Yl(t),i=Pl(),r=Ml(),o=-1!==t.indexOf(e);La.test(t)&&t!==e&&(t=""),ch=o?r:t||r;var s=function(){!t&&r?Wl(r)?Ah(r):Ol(r)&&r().then((function(t){Dl(t)?Ah(t.path,t.params):Ah(t)})):(gh(t),ph().then((function(){Ju._refocus()})).catch((function(t){console.error(t)})))};if(Rl(e)){if(t&&!o&&!ja(t))return void Ah("*",{failedHash:t});Ah(e,{resume:ch,reload:e===t},!1)}else Ol(i)?i(n).then((function(){s()})).catch((function(t){dh(t)})):s()},dh=function(t){Rl("!")?Ah("!",{request:{error:t}}):console.error(t)},Ah=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(!Dl(t)||(t=function(t){if(!t.to&&!t.name)return!1;var e=Qa(t.to||t.name),n=e;if(/\/:([\w-]+)\/?/.test(e)&&(t.params&&(n=Object.keys(t.params).reduce((function(e,n){return e.replace(":".concat(n),t.params[n])}),e)),t.query))return"".concat(n).concat(Xl(t.query));return n}(t),t)){var i=mh();!Tl()&&hh&&(i=hh),i.replace(/^#/,"")!==t?(gh(t,e,n),Tl()?kh(t):(hh=t,ph(t).then((function(){Ju._refocus()})).catch((function(t){console.error(t)})))):e.reload&&(gh(t,e,n),ph(t).then((function(){Ju._refocus()})).catch((function(t){console.error(t)})))}},gh=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(t=Ql(t),!lh.has(t)){var i,r=w(lh.values());try{for(r.s();!(i=r.n()).done;){i.value.cancel()}}catch(s){r.e(s)}finally{r.f()}var o=function(t,e,n){return new Fa(t,e,n)}(t,e,n);return lh.set(decodeURIComponent(t),o),o}return!1},ph=function(){var t=u(s().mark((function t(e){var n,i,r,o,a,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Ql(e||mh()),i=decodeURIComponent(n),(r=lh.get(i))||lh.size||(r=gh(n)),o=ja(n)){t.next=8;break}return Rl("*")?Ah("*",{failedHash:n}):console.error("Unable to navigate to: ".concat(n)),t.abrupt("return");case 8:return r.hash=n,r.route=o,t.next=12,fl(Cl(),r);case 12:if(!(a=t.sent)||!o.beforeNavigate){t.next=17;break}return t.next=16,o.beforeNavigate(Cl(),r);case 16:a=t.sent;case 17:if(!Fl(a)){t.next=22;break}if(!a){t.next=20;break}return t.abrupt("return",vh(r));case 20:t.next=25;break;case 22:r.cancel(),lh.delete(i),Wl(a)?Ah(a):Dl(a)&&(u=!0,Fl(a.store)&&(u=a.store),Ah(a.path,a.params,u));case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),vh=function(t){var e=t.hash,n=t.route,i=decodeURIComponent(e);if(function(t){al=t}(e),n.path){var r=kl(n.path);if(Ol(n.hook)){var o,s=Ha(e,n.path),a={},u=w(s.keys());try{for(u.s();!(o=u.n()).done;){var l=o.value;a[l]=s.get(l)}}catch(f){u.e(f)}finally{u.f()}n.hook(Ju,m({},a))}if(r){var h=El();if(h){var c=function(t,e){if(Wl(t)){var n=Bl();if(!n.has(t))return!1;t=n.get(t)}var i=e.register,r=t.options;return i.has("keepAlive")?i.get("keepAlive"):!(!r||!r.keepAlive)&&r.keepAlive}(Il(),t);h&&n.path===Il()&&!c&&h._setState("")}Nl(r)?rh(t).then((function(){Ju._refocus(),lh.delete(i)})):r().then((function(t){return t.default})).then((function(e){return ml(n.path,e),rh(t)})).then((function(){Ju._refocus(),lh.delete(i)}))}else lh.delete(i)}},_h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!t||isNaN(t))return!1;var e=nu();if(t=Math.abs(t),e.length){var n,i=e.splice(e.length-t,t)[0];return iu(e),Ah(i.hash,(k(n={},Vl.backtrack,!0),k(n,Vl.historyState,i.state),n),!1)}if(el.get("backtrack")){var r=/(\/:?[\w%\s-]+)$/,o=Pa(mh()),s=Ua(o);if(s>1)for(;s--;)if(o=o.replace(r,""),ja(o))return Ah(o,k({},Vl.backtrack,!0),!1)}return t>e.length&&(Ol(Ju._handleAppClose)?Ju._handleAppClose():Ju.application.closeApp())},yh=function(){if(lh.size){var t,e=!1,n=w(lh.values());try{for(n.s();!(t=n.n()).done;){t.value.isCancelled||(e=!0)}}catch(i){n.e(i)}finally{n.f()}return e}return!1},xh=function(){return ch},mh=function(){return document.location.hash},kh=function(t){document.location.hash=t},Th=function(){hl(window,"hashchange",u(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Tl()){t.next=9;break}return t.prev=1,t.next=4,ph();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.error(t.t0);case 9:case"end":return t.stop()}}),t,null,[[1,6]])}))))},bh={startRouter:function(t,e){_l(t,e),Th(),fh()},navigate:Ah,resume:function(){Wl(ch)?(Ah(ch,!1),ch=""):Ol(ch)?ch().then((function(t){ch="",Dl(t)?Ah(t.path,t.params):Ah(t)})):console.warn("[Router]: resume() called but no hash found")},step:_h,go:_h,back:_h.bind(null,-1),activePage:El,getActivePage:function(){return El()},deletePage:function(t){var e;e=t,gl.has(e)&&-1!==$u.getIndex(gl.get(e))&&($u.remove(gl.get(e)),ml(e,gl.get(e)._routedType||gl.get(e).constructor))},getActiveRoute:Il,getActiveHash:Cl,focusWidget:function(t){var e=function(t){return t=Hl(t),nl.getByRef(t)||!1}(t);e&&(qa(e),"Widgets"===Ju.state?Ju.reload(Ya):Ju._setState("Widgets",[Ya]))},getActiveWidget:Za,restoreFocus:Va,isNavigating:yh,getHistory:nu,setHistory:iu,getHistoryState:function(t){var e=null;Ja.length&&(t?-1!==tu(t)&&(e=Ja[tu(t)].state):e=Ja[Ja.length-1].state);return e},replaceHistoryState:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;if(Ja.length){var n=e?tu(e):Ja.length-1;-1!==n&&Dl(t)&&(Ja[n].state=t)}},getQueryStringParams:Yl,reload:function(){if(!yh()){var t=Cl();Ah(t,{reload:!0},!1)}},symbols:Vl,App:uh,focusPage:Va,root:function(){var t=Ml();Wl(t)?Ah(t):Ol(t)&&t().then((function(t){Dl(t)?Ah(t.path,t.params):Ah(t)}))},setupRoutes:function(){console.warn("Router: setupRoutes is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},on:function(){console.warn("Router.on() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},before:function(){console.warn("Router.before() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},after:function(){console.warn("Router.after() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")}};function wh(t){console.log(t.type);var e=xt((function(){return 0})),n=b(At(t.x),2),i=n[0],r=n[1];function o(t){console.log("row",t),0===t.selected?r(90):r(t.selected*-t.children[0]._width+10)}return Ln(kn,{clipping:!0,get style(){return ao.itemsContainer},get children(){return Ln(Er,{animate:!0,gap:10,get x(){return i()},get y(){return t.y},width:4400,get style(){return ao.Row},justifyContent:"flexStart",get autofocus(){return e(0)},onSelectedChanged:o,get items(){return t.data},get onFocus(){return t.onFocus},get onEnter(){return t.onEnter}})}})}var Ch=function(){var t=ti();At(0);var e=b(At(),2),n=e[0];e[1];yt(n,io);var i=b(At({}),2),r=i[0],s=i[1],a=$n();xt((function(){return 0}));var u=_t((function(){return Ir(Hr(t.filter||"all"))}));function l(){var t=this.children.selected;o(t&&t.href),a(t.href)}return vt(kt(ie,(function(t){t.backdrop&&Gi(t.backdrop),t.heroContent&&s(t.heroContent)}),{defer:!0})),Ln(te,{get when(){return u().pages().length},get children(){return[Ln(eo,Bn({y:150,x:90},r)),Ln(wh,{x:90,onEnter:l,get data(){return y(u().pages()[0])}})]}})};fn.debug=!1,fn.fontSettings.fontFamily="Ubuntu",fn.fontSettings.color=4294967295,En((function(){return Ln(bn,{options:{coreExtensionModule:ur,threadXCoreWorkerUrl:void 0,deviceLogicalPixelRatio:.5,appWidth:1920,appHeight:1080},get children(){return Ln(pi,{root:ar,get children(){return[Ln(hi,{path:"/",component:lr}),Ln(hi,{path:"/search",component:Wr}),Ln(hi,{path:"/videos",component:so}),Ln(hi,{path:"/tv",component:Qr}),Ln(hi,{path:"/*all",component:Gr}),Ln(hi,{path:"/list",component:Ch})]}})}})}))}}}))}();
//# sourceMappingURL=index-legacy-4f2154d9.js.map
