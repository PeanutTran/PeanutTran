{"version":3,"mappings":"8pCAAA,SAASA,IAAU,CAIE,SAAS,eAAe,gBAAgB,EACnD,SAAS,eAAe,OAAO,EAC9B,SAAS,eAAe,QAAQ,CAuC3C,CAEA,SAASC,IAAU,CAGlB,IAAIC,EAAS,SAAS,eAAe,QAAQ,EAC5CC,EAAQ,SAAS,eAAe,OAAO,EACvCC,EAAgB,SAAS,eAAe,gBAAgB,EACxDC,EAAY,SAAS,eAAe,WAAW,EAC/CC,EAAO,SAAS,eAAe,MAAM,EACrCC,EAAa,SAAS,eAAe,KAAK,EAC1CC,EAAW,SAAS,eAAe,MAAM,EACzCC,EAAU,SAAS,eAAe,MAAM,EACxCC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAa,SAAS,eAAe,UAAU,EAC/CC,EAAW,SAAS,eAAe,UAAU,EAC7CC,EAAc,SAAS,eAAe,cAAc,EAEjDC,EAAcX,EAAM,aAAa,UAAU,EAC3CY,EAAU,EAId,GAHAZ,EAAM,SAAW,GAGb,IAAI,cAAe,CACtB,IAAIa,EAAM,IAAI,IACdA,EAAI,WAAWF,CAAW,EAC1BE,EAAI,YAAYb,CAAK,EACrBa,EAAI,GAAG,IAAI,OAAO,gBAAiB,UAAY,CAE9Cb,EAAM,OAAS,GACfA,EAAM,KAAI,EACVc,GAAwBD,CAAG,EAC3B,WAAW,IAAM,CAChBX,EAAU,MAAO,CACjB,EAAE,GAAG,CACT,CAAG,EACDW,EAAI,GAAG,IAAI,OAAO,aAAc,SAAUE,EAAOC,EAAM,CAClDJ,IAAY,KACdI,EAAK,SAAW,IAAI,KAAOJ,EAAU,EAAIA,EAAU,EAChDA,IAAY,GACfK,KAGL,CAAG,CACD,CAGDf,EAAU,iBAAiB,QAAS,SAAUgB,EAAG,CAC5ClB,EAAM,QAAUA,EAAM,MAAOA,EAAM,OAClCA,EAAM,MAAK,CAClB,CAAE,EAEDG,EAAK,iBAAiB,QAAS,SAAUe,EAAG,CAC3ClB,EAAM,MAAQ,CAACA,EAAM,MACrBmB,EAAkB,MAAM,CAC1B,CAAE,EAGDV,EAAS,iBAAiB,QAAS,SAAUS,EAAG,CAC/C,IAAIE,GAAOF,EAAE,OAAS,KAAK,WAAa,KAAK,aAAa,WAAanB,EAAO,aAAe,KAAK,YAClGC,EAAM,YAAcoB,EAAMpB,EAAM,SAChCO,EAAY,UAAYc,GAAcrB,EAAM,WAAW,CACzD,CAAE,EAGD,SAASsB,GAAmB,CAC3B,IAAIC,EAAa,SAAS,eAAe,QAAQ,EAE7CC,EAAQ,OAAO,YACf,SAAS,gBAAgB,aACzB,SAAS,KAAK,YAEdC,EAAS,OAAO,aAChB,SAAS,gBAAgB,cACzB,SAAS,KAAK,aACdD,EAAQD,EAAW,YAAc,IAAOE,EAASF,EAAW,aAAe,IAC9EA,EAAW,MAAM,MAAQ,OACzBA,EAAW,MAAM,IAAM,MAEvBA,EAAW,MAAM,MAAQ,MACzBA,EAAW,MAAM,IAAM,OAExB,CAEDnB,EAAW,iBAAiB,QAAS,SAAUW,EAAO,CACrDO,GACF,CAAE,EAEDjB,EAAS,iBAAiB,QAAS,SAAUU,EAAO,CACnDf,EAAM,YAAc,KAAK,IAAIA,EAAM,YAAc,GAAI,CAAC,EACtDO,EAAY,UAAYc,GAAcrB,EAAM,WAAW,CACzD,CAAE,EAEDM,EAAQ,iBAAiB,QAAS,SAAUS,EAAO,CAClDf,EAAM,YAAc,KAAK,IAAIA,EAAM,YAAc,GAAIA,EAAM,QAAQ,EACnEO,EAAY,UAAYc,GAAcrB,EAAM,WAAW,CACzD,CAAE,EAGDA,EAAM,iBAAiB,iBAAkB,UAAY,CAE9C,IAAI0B,EAAU,KAAK,IAAI1B,EAAM,YAAaA,EAAM,QAAQ,EACxDA,EAAM,YAAc0B,EAC1BnB,EAAY,UAAYc,GAAcrB,EAAM,WAAW,EACvDQ,EAAW,UAAYa,GAAcrB,EAAM,QAAQ,CACrD,CAAE,EAGDA,EAAM,iBAAiB,OAAQ,UAAY,CAC1CmB,EAAkB,WAAW,CAC7B,EAAE,EAAK,EACRnB,EAAM,iBAAiB,QAAS,UAAY,CAC3CmB,EAAkB,WAAW,CAC7B,EAAE,EAAK,EAGRnB,EAAM,iBAAiB,aAAc,UAAY,CAC3CS,EAAS,aAAa,KAAK,GAAGA,EAAS,aAAa,MAAOT,EAAM,QAAQ,EAC9ES,EAAS,MAAQT,EAAM,YACvBO,EAAY,UAAYc,GAAcrB,EAAM,WAAW,EACvDU,EAAY,MAAM,MAAQ,KAAK,MAAOV,EAAM,YAAcA,EAAM,SAAY,GAAG,EAAI,GACrF,CAAE,EAGD,SAASmB,EAAkBQ,EAAM,CAE5BA,GAAQ,YACP3B,EAAM,QAAUA,EAAM,OACzBE,EAAU,aAAa,aAAc,MAAM,EAC3CD,EAAc,UAAU,IAAI,iBAAiB,GAG7CC,EAAU,aAAa,aAAc,OAAO,EAIrCyB,GAAQ,QAChBxB,EAAK,aAAa,aAAcH,EAAM,MAAQ,SAAW,MAAM,CAElE,CACA,CAGA,SAASc,GAAwBD,EAAK,CAErC,IAAIe,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAU,SAAS,eAAe,SAAS,EAC/CD,EAAW,iBAAiB,QAAS,SAAwBb,EAAO,CACnEe,IACAD,EAAQ,UAAU,OAAO,MAAM,CACjC,CAAE,EAGD,IAAIE,EAAYlB,EAAI,OAEpB,IADA,QAAQ,IAAIkB,CAAS,EACdF,EAAQ,YACdA,EAAQ,YAAYA,EAAQ,UAAU,EAEvC,IAAIG,EAAQ,SAAS,cAAc,GAAG,EACtCA,EAAM,aAAa,aAAc,EAAE,EACnCA,EAAM,aAAa,QAAS,SAAS,EACrCA,EAAM,aAAa,WAAY,GAAG,EAClCA,EAAM,aAAa,KAAM,WAAW,EAEpCA,EAAM,KAAO,OACbH,EAAQ,YAAYG,CAAK,EACzB,QAASC,EAAI,EAAGA,EAAIF,EAAU,OAAQE,IAAK,CAC1C,IAAIC,EAAI,SAAS,cAAc,GAAG,EAClCA,EAAE,aAAa,aAAcD,CAAC,EAC9BC,EAAE,aAAa,QAAS,SAAS,EACjCA,EAAE,aAAa,WAAY,GAAG,EAC9BA,EAAE,aAAa,KAAM,YAAcD,EAAI,EAAE,EACzCC,EAAE,MAAQH,EAAUE,CAAC,EAAE,MAAQF,EAAUE,CAAC,EAAE,QAAU,IACtDJ,EAAQ,YAAYK,CAAC,CACrB,CAGD,IAAIC,EAAQ,SAAS,iBAAiB,YAAY,EAElD,SAASL,EAAWM,EAAoB,CACvC,QAASH,EAAI,EAAGA,EAAIE,EAAM,OAAQF,IAE7B,CAACG,GAAsBH,GAAKpB,EAAI,aAAe,EAC7CA,EAAI,kBACPsB,EAAM,CAAC,EAAE,UAAU,IAAI,QAAQ,EAC/BA,EAAMF,CAAC,EAAE,UAAU,OAAO,QAAQ,GAElCE,EAAMF,CAAC,EAAE,UAAU,IAAI,QAAQ,EAGhCE,EAAMF,CAAC,EAAE,UAAU,OAAO,QAAQ,EAGpC,GAAGG,EAAmB,CACrB,IAAIC,EAAU,SAAS,KAAK,aAAa,YAAY,CAAC,EACtDxB,EAAI,aAAewB,EACnB,KAAK,UAAU,IAAI,QAAQ,CAC3B,CAEJ,CACC,QAASJ,EAAI,EAAGA,EAAIE,EAAM,OAAQF,IACjCE,EAAMF,CAAC,EAAE,iBAAiB,YAAaH,CAAU,CACnD,CAEA,SAAST,GAAciB,EAAS,CAC/B,IAAIC,EAAQ,KAAK,MAAMD,EAAU,IAAI,EACjCE,EAAU,KAAK,MAAOF,EAAU,KAAQ,EAAE,EAC1CG,EAAmB,KAAK,MAAMH,EAAU,EAAE,EAE1CI,EAAa,GAEjB,OAAIH,EAAQ,IACXG,GAAc,GAAG,OAAAH,EAAM,SAAU,EAAC,SAAS,EAAG,GAAG,EAAC,MAGnDG,GAAc,GAAG,OAAAF,EAAQ,SAAQ,EAAG,SAAS,EAAG,GAAG,EAAC,KAAI,OAAAC,EAAiB,WAAW,SAAS,EAAG,GAAG,GAE5FC,CACR,CAEO,SAASC,GAAUC,EAAK,CAC9B,IAAIC,EAAMD,GAAO,oDACb5C,EAAQ,SAAS,eAAe,OAAO,EAC3CA,EAAM,aAAa,WAAY6C,CAAG,EAClCC,IACD,CAEO,SAASC,IAAa,CAC5B,IAAI/C,EAAQ,SAAS,eAAe,OAAO,EAC3CA,EAAM,OAAS,GACfA,EAAM,MAAK,EACXgD,KACA,IAAInB,EAAU,SAAS,eAAe,SAAS,EAC/CA,EAAQ,UAAY,mBACpBoB,IACD,CAEA,SAASA,IAAa,CACrB,IAAIC,EAAc,SAAS,eAAe,QAAQ,EAC9CC,EAAcD,EAAY,UAAU,EAAI,EAC5CA,EAAY,WAAW,aAAaC,EAAaD,CAAW,CAC7D,CAEA,SAASjC,IAAuB,CAC/B,IAAImC,EAAO,SAAS,eAAe,MAAM,EACxCC,EAAO,SAAS,eAAe,gBAAgB,EAChDD,EAAK,UAAY,eACjBC,EAAK,UAAY,GACjBA,EAAK,aAAa,YAAa,MAAM,CACtC,CAEO,SAASC,IAAe,CAC9B,IAAItD,EAAQ,SAAS,eAAe,OAAO,EAC3CqD,EAAO,SAAS,eAAe,gBAAgB,EAC/C9C,EAAc,SAAS,eAAe,cAAc,EAChDgD,EAAWF,EAAK,aAAa,WAAW,EACxCE,IAAa,UAChBvD,EAAM,YAAc,KAAK,IAAIA,EAAM,YAAc,GAAI,CAAC,EACtDO,EAAY,UAAYc,GAAcrB,EAAM,WAAW,EAEzD,CAEO,SAASwD,IAAc,CAC7B,IAAIxD,EAAQ,SAAS,eAAe,OAAO,EAC3CqD,EAAO,SAAS,eAAe,gBAAgB,EAC/C9C,EAAc,SAAS,eAAe,cAAc,EAChDgD,EAAWF,EAAK,aAAa,WAAW,EACxCE,IAAa,UAChBvD,EAAM,YAAc,KAAK,IAAIA,EAAM,YAAc,GAAIA,EAAM,QAAQ,EACnEO,EAAY,UAAYc,GAAcrB,EAAM,WAAW,EAEzD,CAEO,SAASyD,IAAa,CAC5B,IAAIC,EAAW,SAAS,cAAc,aAAa,IAAI,EACvD,GAAI,CAACA,EAAU,CACd,IAAIxD,EAAY,SAAS,eAAe,WAAW,EACnDA,EAAU,MAAK,EACf,MACA,CACD,GAAIwD,IAAa,YAAa,CAC7B,IAAIxD,EAAY,SAAS,eAAe,KAAK,EAC7CA,EAAU,MAAK,EACf,MACA,CACD,GAAIwD,IAAa,MAAO,CACvB,IAAIxD,EAAY,SAAS,eAAe,MAAM,EAC9CA,EAAU,MAAK,EACf,MACA,CACD,GAAIwD,IAAa,OAAQ,CACxB,IAAIxD,EAAY,SAAS,eAAe,aAAa,EACrDA,EAAU,MAAK,EACf,MACA,CACD,GAAIwD,IAAa,cAAe,CAC/B,IAAI7B,EAAU,SAAS,eAAe,SAAS,EAC/C,GAAIA,EAAQ,YAAc,wBAAyB,CAClD,IAAI8B,EAAgB,SAAS,eAAe,WAAW,EACnDA,GACHA,EAAc,MAAK,CAEpB,CACD,MACA,CACD,GAAID,EAAS,SAAS,UAAU,EAAG,CAClC,MAAME,EAAM,SAASC,GAAcH,CAAQ,EAAG,EAAE,EAChD,IAAI7B,EAAU,SAAS,eAAe,YAAc+B,EAAM,EAAE,EACxD/B,GACHA,EAAQ,MAAK,EAEd,MACA,CACF,CAEO,SAASiC,IAAe,CAC9B,IAAIJ,EAAW,SAAS,cAAc,aAAa,IAAI,EACvD,GAAI,CAACA,EAAU,CACd,IAAIxD,EAAY,SAAS,eAAe,WAAW,EACnDA,EAAU,MAAK,EACf,MACA,CACD,GAAIwD,IAAa,MAAO,CACvB,IAAIxD,EAAY,SAAS,eAAe,WAAW,EACnDA,EAAU,MAAK,EACf,MACA,CACD,GAAIwD,IAAa,OAAQ,CACxB,IAAIxD,EAAY,SAAS,eAAe,KAAK,EAC7CA,EAAU,MAAK,EACf,MACA,CACD,GAAIwD,IAAa,cAAe,CAC/B,IAAIxD,EAAY,SAAS,eAAe,MAAM,EAC9CA,EAAU,MAAK,EACf,MACA,CACD,GAAIwD,EAAS,SAAS,UAAU,EAAG,CAClC,MAAME,EAAM,SAASC,GAAcH,CAAQ,EAAG,EAAE,EAChD,GAAIE,IAAQ,EAAG,CACd,IAAI/B,EAAU,SAAS,eAAe,aAAa,EACnDA,EAAQ,MAAK,EACb,MACH,KAAS,CACN,IAAIA,EAAU,SAAS,eAAe,YAAc+B,EAAM,EAAE,EAC5D/B,EAAQ,MAAK,EACb,MACA,CACD,CACF,CAEA,SAASgC,GAAcE,EAAK,CACxB,IAAIC,EAAUD,EAAI,MAAM,eAAe,EAEvC,OAAIC,GAAWA,EAAQ,CAAC,EACb,SAASA,EAAQ,CAAC,EAAG,EAAE,EAEvB,IAEf,CAEA,SAAShB,IAAwB,CAChC,IAAII,EAAO,SAAS,eAAe,MAAM,EACxCC,EAAO,SAAS,eAAe,gBAAgB,EAChDA,EAAK,UAAY,eACjBD,EAAK,UAAY,GACjBC,EAAK,aAAa,YAAa,OAAO,CACvC,CAEA,SAASP,IAAU,CAClBjD,KACAC,IACD,CACA,SAASmE,IAAc,CACtB,IAAIC,EAAa,u8BACbC,EAAM,SAAS,eAAe,KAAK,EACnCC,EAAM,SAAS,cAAc,KAAK,EACtCA,EAAI,GAAK,SACTA,EAAI,UAAYF,EAAW,OAC3BC,EAAI,WAAW,aAAaC,EAAKD,EAAI,WAAW,CACjD,CACA,SAAS,iBAAiB,mBAAoBF,EAAU,ECrSxD,MAAMI,GAAU,CAACC,EAAGC,IAAMD,IAAMC,EAC1BC,GAAS,OAAO,aAAa,EAC7BC,GAAS,OAAO,aAAa,EAE7BC,GAAgB,CACpB,OAAQL,EACV,EAEA,IAAIM,GAAaC,GACjB,MAAMC,GAAQ,EACRC,GAAU,EACVC,GAAU,CACd,MAAO,KACP,SAAU,KACV,QAAS,KACT,MAAO,IACT,EACMC,GAAU,GAChB,IAAIC,EAAQ,KACZ,IAAIC,GAAa,KAGbC,EAAW,KACXC,GAAU,KACVC,GAAU,KACVC,GAAY,EAChB,SAASC,GAAWC,EAAIC,EAAe,CACrC,MAAMC,EAAWP,EACfQ,EAAQV,EACRW,EAAUJ,EAAG,SAAW,EACxBK,EAAUJ,IAAkB,OAAYE,EAAQF,EAChDK,EAAOF,EACHb,GACA,CACE,MAAO,KACP,SAAU,KACV,QAASc,EAAUA,EAAQ,QAAU,KACrC,MAAOA,CACR,EACLE,EAAWH,EAAUJ,EAAK,IAAMA,EAAG,IAAMQ,GAAQ,IAAMC,GAAUH,CAAI,CAAC,CAAC,EACzEb,EAAQa,EACRX,EAAW,KACX,GAAI,CACF,OAAOe,GAAWH,EAAU,EAAI,CACpC,QAAY,CACRZ,EAAWO,EACXT,EAAQU,CACT,CACH,CACA,SAASQ,EAAaC,EAAOC,EAAS,CACpCA,EAAUA,EAAU,OAAO,OAAO,CAAE,EAAE3B,GAAe2B,CAAO,EAAI3B,GAChE,MAAM4B,EAAI,CACR,MAAAF,EACA,UAAW,KACX,cAAe,KACf,WAAYC,EAAQ,QAAU,MAClC,EACQE,EAASH,IACT,OAAOA,GAAU,aAEdA,EAAQA,EAAME,EAAE,KAAK,GAErBE,GAAYF,EAAGF,CAAK,GAE7B,MAAO,CAACK,GAAW,KAAKH,CAAC,EAAGC,CAAM,CACpC,CACA,SAASG,GAAelB,EAAIY,EAAOC,EAAS,CAC1C,MAAMM,EAAIC,GAAkBpB,EAAIY,EAAO,GAAMvB,EAAK,EAE7CgC,GAAkBF,CAAC,CAC1B,CACA,SAASG,GAAmBtB,EAAIY,EAAOC,EAAS,CAC9C,MAAMM,EAAIC,GAAkBpB,EAAIY,EAAO,GAAOvB,EAAK,EAE9CgC,GAAkBF,CAAC,CAC1B,CACA,SAASI,GAAavB,EAAIY,EAAOC,EAAS,CACxC1B,GAAaqC,GACb,MAAML,EAAIC,GAAkBpB,EAAIY,EAAO,GAAOvB,EAAK,EACjD,EAAIoC,IAAmBC,GAAWD,EAAe,EAC/C,IAAGN,EAAE,SAAW,IAChB,CAACN,GAAW,CAACA,EAAQ,UAAQM,EAAE,KAAO,IAC1CtB,GAAUA,GAAQ,KAAKsB,CAAC,EAAIE,GAAkBF,CAAC,CACjD,CAoBA,SAASQ,GAAW3B,EAAIY,EAAOC,EAAS,CACtCA,EAAUA,EAAU,OAAO,OAAO,CAAE,EAAE3B,GAAe2B,CAAO,EAAI3B,GAChE,MAAMiC,EAAIC,GAAkBpB,EAAIY,EAAO,GAAM,CAAC,EAC9C,OAAAO,EAAE,UAAY,KACdA,EAAE,cAAgB,KAClBA,EAAE,WAAaN,EAAQ,QAAU,OAI1BQ,GAAkBF,CAAC,EACnBF,GAAW,KAAKE,CAAC,CAC1B,CACA,SAASS,GAAUC,EAAG,CACpB,OAAOA,GAAK,OAAOA,GAAM,UAAY,SAAUA,CACjD,CACA,SAASC,GAAeC,EAASC,EAAUC,EAAU,CACnD,IAAIC,EACAC,EACAtB,EACC,UAAU,SAAW,GAAK,OAAOmB,GAAa,UAAa,UAAU,SAAW,GACnFE,EAAS,GACTC,EAAUJ,EACVlB,EAAUmB,GAAY,KAEtBE,EAASH,EACTI,EAAUH,EACVnB,EAAUoB,GAAY,IAErB,IAACG,EAAK,KACPC,EAAQ7C,GAGR8C,EAAY,GACZC,EAAW,iBAAkB1B,EAC7B2B,EAAU,OAAON,GAAW,YAAcP,GAAWO,CAAM,EAC7D,MAAMO,EAAW,IAAI,IACnB,CAAC7B,EAAO8B,CAAQ,GAAK7B,EAAQ,SAAWF,GAAcE,EAAQ,YAAY,EAC1E,CAAC8B,EAAOC,CAAQ,EAAIjC,EAAa,MAAS,EAC1C,CAACkC,EAAOC,CAAO,EAAInC,EAAa,OAAW,CACzC,OAAQ,EACd,CAAK,EACD,CAACoC,EAAOC,CAAQ,EAAIrC,EAAa4B,EAAW,QAAU,YAAY,EAOpE,SAASU,EAAQC,EAAGrB,EAAGc,EAAOQ,EAAK,CACjC,OAAIf,IAAOc,IACTd,EAAK,KACLe,IAAQ,SAAcZ,EAAW,KAC5BW,IAAMb,GAASR,IAAMQ,IAAUxB,EAAQ,YAC1C,eAAe,IACbA,EAAQ,WAAWsC,EAAK,CACtB,MAAOtB,CACnB,CAAW,CACX,EACMQ,EAAQ7C,GAQD4D,EAAavB,EAAGc,CAAK,GAEvBd,CACR,CACD,SAASuB,EAAavB,EAAGwB,EAAK,CAC5B3C,GAAW,IAAM,CACX2C,IAAQ,QAAWX,EAAS,IAAMb,CAAC,EACvCmB,EAASK,IAAQ,OAAY,UAAYd,EAAW,QAAU,YAAY,EAC1EK,EAASS,CAAG,EACZ,UAAWlC,KAAKsB,EAAS,KAAI,EAAItB,EAAE,YACnCsB,EAAS,MAAK,CACf,EAAE,EAAK,CACT,CACD,SAASa,GAAO,CACd,MAAMnC,EAAIM,GACRI,EAAIjB,EAAO,EACXyC,EAAMV,EAAK,EACb,GAAIU,IAAQ,QAAa,CAACjB,EAAI,MAAMiB,EACpC,OAAI1D,GAAY,CAACA,EAAS,MAAQwB,GAChCD,GAAe,IAAM,CACnB2B,IACIT,IACEjB,EAAE,UACIsB,EAAS,IAAItB,CAAC,IACtBA,EAAE,UAAS,EACXsB,EAAS,IAAItB,CAAC,GAG1B,CAAO,EAEIU,CACR,CACD,SAAS0B,EAAKC,EAAa,GAAM,CAC/B,GAAIA,IAAe,IAASlB,EAAW,OACvCA,EAAY,GACZ,MAAMmB,EAASjB,EAAUA,EAAO,EAAKN,EAErC,GAAIuB,GAAU,MAAQA,IAAW,GAAO,CACtCR,EAAQb,EAAI5B,GAAQI,CAAK,CAAC,EAC1B,MACD,CAED,MAAMsC,EACJb,IAAU7C,GACN6C,EACA7B,GAAQ,IACN2B,EAAQsB,EAAQ,CACd,MAAO7C,EAAO,EACd,WAAA4C,CACd,CAAa,CACb,EACI,OAAK5B,GAAUsB,CAAC,GAIhBd,EAAKc,EACD,UAAWA,GACTA,EAAE,SAAW,UAAWD,EAAQb,EAAIc,EAAE,MAAO,OAAWO,CAAM,EAC7DR,EAAQb,EAAI,OAAW,OAAWqB,CAAM,EACtCP,IAETZ,EAAY,GACZ,eAAe,IAAOA,EAAY,EAAM,EACxC5B,GAAW,IAAM,CACfsC,EAAST,EAAW,aAAe,SAAS,EAC5CO,GACD,EAAE,EAAK,EACDI,EAAE,KACPrB,GAAKoB,EAAQC,EAAGrB,EAAG,OAAW4B,CAAM,EACpC/H,GAAKuH,EAAQC,EAAG,OAAWQ,GAAUhI,CAAC,EAAG+H,CAAM,CACrD,KAlBMR,EAAQb,EAAIc,EAAG,OAAWO,CAAM,EACzBP,EAkBV,CACD,cAAO,iBAAiBI,EAAM,CAC5B,MAAO,CACL,IAAK,IAAMP,EAAO,CACnB,EACD,MAAO,CACL,IAAK,IAAMJ,EAAO,CACnB,EACD,QAAS,CACP,KAAM,CACJ,MAAM7B,EAAIiC,IACV,OAAOjC,IAAM,WAAaA,IAAM,YACjC,CACF,EACD,OAAQ,CACN,KAAM,CACJ,GAAI,CAACyB,EAAU,OAAOe,IACtB,MAAMD,EAAMV,IACZ,GAAIU,GAAO,CAACjB,EAAI,MAAMiB,EACtB,OAAOzC,EAAK,CACb,CACF,CACL,CAAG,EACG4B,EAAStB,GAAe,IAAMqC,EAAK,EAAK,CAAC,EACxCA,EAAK,EAAK,EACR,CACLD,EACA,CACE,QAASC,EACT,OAAQb,CACT,CACL,CACA,CA8BA,SAASiB,GAAezB,EAAQlC,EAAKnB,GAASgC,EAAS,CACrD,MAAM+C,EAAO,IAAI,IACXC,EAAOzC,GACX8B,GAAK,CACH,MAAMrB,EAAIK,IACV,SAAW,CAACiB,EAAKW,CAAG,IAAKF,EAAK,QAAS,EACrC,GAAI5D,EAAGmD,EAAKtB,CAAC,IAAM7B,EAAGmD,EAAKD,CAAC,EAC1B,UAAW/B,KAAK2C,EAAI,SAClB3C,EAAE,MAAQ9B,GACN8B,EAAE,KAAMvB,GAAQ,KAAKuB,CAAC,EACrBtB,GAAQ,KAAKsB,CAAC,EAGzB,OAAOU,CACR,EACD,OACA,GACAxC,EACJ,EACE,OAAAgC,GAAkBwC,CAAI,EACfV,GAAO,CACZ,MAAMjD,EAAWP,EACjB,GAAIO,EAAU,CACZ,IAAI6D,GACCA,EAAIH,EAAK,IAAIT,CAAG,GAAIY,EAAE,IAAI7D,CAAQ,EAClC0D,EAAK,IAAIT,EAAMY,EAAI,IAAI,IAAI,CAAC7D,CAAQ,CAAC,GAC1C8D,GAAU,IAAM,CACdD,EAAE,OAAO7D,CAAQ,EACjB,CAAC6D,EAAE,MAAQH,EAAK,OAAOT,CAAG,CAClC,CAAO,CACF,CACD,OAAOnD,EACLmD,EACiFU,EAAK,KAC5F,CACA,CACA,CACA,SAASI,GAAMjE,EAAI,CACjB,OAAOU,GAAWV,EAAI,EAAK,CAC7B,CACA,SAASQ,GAAQR,EAAI,CACnB,GAAIL,IAAa,KAAM,OAAOK,IAC9B,MAAME,EAAWP,EACjBA,EAAW,KACX,GAAI,CACF,OAAOK,EAAE,CACb,QAAY,CACRL,EAAWO,CACZ,CACH,CACA,SAASgE,GAAGC,EAAMnE,EAAIa,EAAS,CAC7B,MAAMuD,EAAU,MAAM,QAAQD,CAAI,EAClC,IAAIE,EACAC,EAAQzD,GAAWA,EAAQ,MAC/B,OAAO0D,GAAa,CAClB,IAAIC,EACJ,GAAIJ,EAAS,CACXI,EAAQ,MAAML,EAAK,MAAM,EACzB,QAAS1H,EAAI,EAAGA,EAAI0H,EAAK,OAAQ1H,IAAK+H,EAAM/H,CAAC,EAAI0H,EAAK1H,CAAC,EAAC,CAC9D,MAAW+H,EAAQL,IACf,GAAIG,EAAO,CACTA,EAAQ,GACR,MACD,CACD,MAAMG,EAASjE,GAAQ,IAAMR,EAAGwE,EAAOH,EAAWE,CAAS,CAAC,EAC5D,OAAAF,EAAYG,EACLC,CACX,CACA,CACA,SAASC,GAAQ1E,EAAI,CACnBuB,GAAa,IAAMf,GAAQR,CAAE,CAAC,CAChC,CACA,SAASgE,GAAUhE,EAAI,CACrB,OAAIP,IAAU,OACLA,EAAM,WAAa,KAAMA,EAAM,SAAW,CAACO,CAAE,EACjDP,EAAM,SAAS,KAAKO,CAAE,GACpBA,CACT,CAoBA,SAAS2E,IAAW,CAClB,OAAOlF,CACT,CACA,SAASmF,GAAaC,EAAG7E,EAAI,CAC3B,MAAM8E,EAAOrF,EACPsF,EAAepF,EACrBF,EAAQoF,EACRlF,EAAW,KACX,GAAI,CACF,OAAOe,GAAWV,EAAI,EAAI,CAC3B,OAAQqD,EAAK,CACZ2B,GAAY3B,CAAG,CACnB,QAAY,CACR5D,EAAQqF,EACRnF,EAAWoF,CACZ,CACH,CAIA,SAASE,GAAgBjF,EAAI,CAK3B,MAAM+D,EAAIpE,EACJkF,EAAIpF,EACV,OAAO,QAAQ,UAAU,KAAK,IAAM,CAClCE,EAAWoE,EACXtE,EAAQoF,EACR,IAAIK,EAeJ,OAAAxE,GAAWV,EAAI,EAAK,EACpBL,EAAWF,EAAQ,KACZyF,EAAIA,EAAE,KAAO,MACxB,CAAG,CACH,CASA,SAASC,GAAcC,EAAcvE,EAAS,CAC5C,MAAMwE,EAAK,OAAO,SAAS,EAC3B,MAAO,CACL,GAAAA,EACA,SAAUC,GAAeD,CAAE,EAC3B,aAAAD,CACJ,CACA,CACA,SAAS1D,GAAW6D,EAAS,CAC3B,OAAO9F,GAASA,EAAM,SAAWA,EAAM,QAAQ8F,EAAQ,EAAE,IAAM,OAC3D9F,EAAM,QAAQ8F,EAAQ,EAAE,EACxBA,EAAQ,YACd,CACA,SAASC,GAASxF,EAAI,CACpB,MAAMwF,EAAW7D,GAAW3B,CAAE,EACxByF,EAAO9D,GAAW,IAAM+D,GAAgBF,EAAQ,CAAE,CAAC,EACzD,OAAAC,EAAK,QAAU,IAAM,CACnB,MAAMtE,EAAIsE,IACV,OAAO,MAAM,QAAQtE,CAAC,EAAIA,EAAIA,GAAK,KAAO,CAACA,CAAC,EAAI,EACpD,EACSsE,CACT,CACA,IAAIhE,GAsBJ,SAASR,IAAa,CAEpB,GAAI,KAAK,SAA8C,KAAK,MAC1D,GAAuC,KAAK,QAAW5B,GAAOgC,GAAkB,IAAI,MAC/E,CACH,MAAMsE,EAAU/F,GAChBA,GAAU,KACVc,GAAW,IAAMkF,GAAa,IAAI,EAAG,EAAK,EAC1ChG,GAAU+F,CACX,CAEH,GAAIhG,EAAU,CACZ,MAAMkG,EAAQ,KAAK,UAAY,KAAK,UAAU,OAAS,EAClDlG,EAAS,SAIZA,EAAS,QAAQ,KAAK,IAAI,EAC1BA,EAAS,YAAY,KAAKkG,CAAK,IAJ/BlG,EAAS,QAAU,CAAC,IAAI,EACxBA,EAAS,YAAc,CAACkG,CAAK,GAK1B,KAAK,WAIR,KAAK,UAAU,KAAKlG,CAAQ,EAC5B,KAAK,cAAc,KAAKA,EAAS,QAAQ,OAAS,CAAC,IAJnD,KAAK,UAAY,CAACA,CAAQ,EAC1B,KAAK,cAAgB,CAACA,EAAS,QAAQ,OAAS,CAAC,EAKpD,CAED,OAAO,KAAK,KACd,CACA,SAASqB,GAAY6C,EAAMjD,EAAOkF,EAAQ,CACxC,IAAIzF,EAC+EwD,EAAK,MACxF,OAAI,CAACA,EAAK,YAAc,CAACA,EAAK,WAAWxD,EAASO,CAAK,KAQ9CiD,EAAK,MAAQjD,EAChBiD,EAAK,WAAaA,EAAK,UAAU,QACnCnD,GAAW,IAAM,CACf,QAASjE,EAAI,EAAGA,EAAIoH,EAAK,UAAU,OAAQpH,GAAK,EAAG,CACjD,MAAMoI,EAAIhB,EAAK,UAAUpH,CAAC,EACpBsJ,EAAoBrG,IAAcA,GAAW,QAC/CqG,GAAqBrG,GAAW,SAAS,IAAImF,CAAC,GAC9CkB,EAAoB,CAAClB,EAAE,OAAS,CAACA,EAAE,SACjCA,EAAE,KAAMjF,GAAQ,KAAKiF,CAAC,EACrBhF,GAAQ,KAAKgF,CAAC,EACfA,EAAE,WAAWmB,GAAenB,CAAC,GAE9BkB,IAAmBlB,EAAE,MAAQxF,GAEnC,CACD,GAAIO,GAAQ,OAAS,IACnB,MAAAA,GAAU,GAEJ,IAAI,KAEb,EAAE,EAAK,GAGLgB,CACT,CACA,SAASS,GAAkBwC,EAAM,CAC/B,GAAI,CAACA,EAAK,GAAI,OACdpD,GAAUoD,CAAI,EACd,MAAMjG,EAAOkC,GACbmG,GACEpC,EACiFA,EAAK,MACtFjG,CACJ,CAWA,CACA,SAASqI,GAAepC,EAAMjD,EAAOhD,EAAM,CACzC,IAAIsI,EACJ,MAAM/F,EAAQV,EACZS,EAAWP,EACbA,EAAWF,EAAQoE,EACnB,GAAI,CACFqC,EAAYrC,EAAK,GAAGjD,CAAK,CAC1B,OAAQyC,EAAK,CACZ,OAAIQ,EAAK,OAMLA,EAAK,MAAQxE,GACbwE,EAAK,OAASA,EAAK,MAAM,QAAQpD,EAAS,EAC1CoD,EAAK,MAAQ,MAGjBA,EAAK,UAAYjG,EAAO,EACjBoH,GAAY3B,CAAG,CAC1B,QAAY,CACR1D,EAAWO,EACXT,EAAQU,CACT,EACG,CAAC0D,EAAK,WAAaA,EAAK,WAAajG,KACnCiG,EAAK,WAAa,MAAQ,cAAeA,EAC3C7C,GAAY6C,EAAMqC,CAAe,EAI5BrC,EAAK,MAAQqC,EACpBrC,EAAK,UAAYjG,EAErB,CACA,SAASwD,GAAkBpB,EAAImG,EAAMC,EAAMrD,EAAQ1D,GAAOwB,EAAS,CACjE,MAAMM,EAAI,CACR,GAAAnB,EACA,MAAO+C,EACP,UAAW,KACX,MAAO,KACP,QAAS,KACT,YAAa,KACb,SAAU,KACV,MAAOoD,EACP,MAAO1G,EACP,QAASA,EAAQA,EAAM,QAAU,KACjC,KAAA2G,CACJ,EAKE,OAAI3G,IAAU,MACLA,IAAUF,KAKVE,EAAM,MACNA,EAAM,MAAM,KAAK0B,CAAC,EADL1B,EAAM,MAAQ,CAAC0B,CAAC,GAiB/BA,CACT,CACA,SAASkF,GAAOxC,EAAM,CAEpB,GAAuCA,EAAK,QAAW,EAAG,OAC1D,GAAuCA,EAAK,QAAWvE,GAAS,OAAOsG,GAAa/B,CAAI,EACxF,GAAIA,EAAK,UAAYrD,GAAQqD,EAAK,SAAS,UAAU,EAAG,OAAOA,EAAK,SAAS,QAAQ,KAAKA,CAAI,EAC9F,MAAMyC,EAAY,CAACzC,CAAI,EACvB,MAAQA,EAAOA,EAAK,SAAW,CAACA,EAAK,WAAaA,EAAK,UAAY/D,KAE3B+D,EAAK,OAAOyC,EAAU,KAAKzC,CAAI,EAEvE,QAASpH,EAAI6J,EAAU,OAAS,EAAG7J,GAAK,EAAGA,IASzC,GARAoH,EAAOyC,EAAU7J,CAAC,EAQqBoH,EAAK,QAAWxE,GACrDgC,GAAkBwC,CAAI,UACsBA,EAAK,QAAWvE,GAAS,CACrE,MAAMqG,EAAU/F,GAChBA,GAAU,KACVc,GAAW,IAAMkF,GAAa/B,EAAMyC,EAAU,CAAC,CAAC,EAAG,EAAK,EACxD1G,GAAU+F,CACX,CAEL,CACA,SAASjF,GAAWV,EAAImG,EAAM,CAC5B,GAAIvG,GAAS,OAAOI,IACpB,IAAIuG,EAAO,GACNJ,IAAMvG,GAAU,IACjBC,GAAS0G,EAAO,GACf1G,GAAU,GACfC,KACA,GAAI,CACF,MAAM0G,EAAMxG,IACZ,OAAAyG,GAAgBF,CAAI,EACbC,CACR,OAAQnD,EAAK,CACPkD,IAAM1G,GAAU,MACrBD,GAAU,KACVoF,GAAY3B,CAAG,CAChB,CACH,CACA,SAASoD,GAAgBF,EAAM,CAM7B,GALI3G,KAEGR,GAASQ,EAAO,EACrBA,GAAU,MAER2G,EAAM,OAmCV,MAAM7K,EAAImE,GACVA,GAAU,KACNnE,EAAE,QAAQgF,GAAW,IAAMvB,GAAWzD,CAAC,EAAG,EAAK,CAErD,CACA,SAAS0D,GAASsH,EAAO,CACvB,QAASjK,EAAI,EAAGA,EAAIiK,EAAM,OAAQjK,IAAK4J,GAAOK,EAAMjK,CAAC,CAAC,CACxD,CAkBA,SAAS+E,GAAekF,EAAO,CAC7B,IAAIjK,EACFkK,EAAa,EACf,IAAKlK,EAAI,EAAGA,EAAIiK,EAAM,OAAQjK,IAAK,CACjC,MAAMf,EAAIgL,EAAMjK,CAAC,EACZf,EAAE,KACFgL,EAAMC,GAAY,EAAIjL,EADd2K,GAAO3K,CAAC,CAEtB,CAaD,IAAKe,EAAI,EAAGA,EAAIkK,EAAYlK,IAAK4J,GAAOK,EAAMjK,CAAC,CAAC,CAClD,CACA,SAASmJ,GAAa/B,EAAM+C,EAAQ,CAG7B/C,EAAK,MAAQ,EAClB,QAASpH,EAAI,EAAGA,EAAIoH,EAAK,QAAQ,OAAQpH,GAAK,EAAG,CAC/C,MAAMyF,EAAS2B,EAAK,QAAQpH,CAAC,EAC7B,GAAIyF,EAAO,QAAS,CAClB,MAAMa,EAA4Cb,EAAO,MACrDa,IAAU1D,GACR6C,IAAW0E,IAAW,CAAC1E,EAAO,WAAaA,EAAO,UAAYpC,KAChEuG,GAAOnE,CAAM,EACNa,IAAUzD,IAASsG,GAAa1D,EAAQ0E,CAAM,CAC1D,CACF,CACH,CACA,SAASZ,GAAenC,EAAM,CAE5B,QAASpH,EAAI,EAAGA,EAAIoH,EAAK,UAAU,OAAQpH,GAAK,EAAG,CACjD,MAAMoI,EAAIhB,EAAK,UAAUpH,CAAC,EACWoI,EAAE,QAEhCA,EAAE,MAAQvF,GACXuF,EAAE,KAAMjF,GAAQ,KAAKiF,CAAC,EACrBhF,GAAQ,KAAKgF,CAAC,EACnBA,EAAE,WAAamB,GAAenB,CAAC,EAElC,CACH,CACA,SAASpE,GAAUoD,EAAM,CACvB,IAAIpH,EACJ,GAAIoH,EAAK,QACP,KAAOA,EAAK,QAAQ,QAAQ,CAC1B,MAAM3B,EAAS2B,EAAK,QAAQ,IAAK,EAC/BgD,EAAQhD,EAAK,YAAY,IAAK,EAC9BiD,EAAM5E,EAAO,UACf,GAAI4E,GAAOA,EAAI,OAAQ,CACrB,MAAMC,EAAID,EAAI,IAAK,EACjBhG,EAAIoB,EAAO,cAAc,MACvB2E,EAAQC,EAAI,SACdC,EAAE,YAAYjG,CAAC,EAAI+F,EACnBC,EAAID,CAAK,EAAIE,EACb7E,EAAO,cAAc2E,CAAK,EAAI/F,EAEjC,CACF,CAQI,GAAI+C,EAAK,MAAO,CACrB,IAAKpH,EAAIoH,EAAK,MAAM,OAAS,EAAGpH,GAAK,EAAGA,IAAKgE,GAAUoD,EAAK,MAAMpH,CAAC,CAAC,EACpEoH,EAAK,MAAQ,IACd,CACD,GAAIA,EAAK,SAAU,CACjB,IAAKpH,EAAIoH,EAAK,SAAS,OAAS,EAAGpH,GAAK,EAAGA,IAAKoH,EAAK,SAASpH,CAAC,EAAC,EAChEoH,EAAK,SAAW,IACjB,CAEIA,EAAK,MAAQ,CACpB,CAUA,SAASH,GAAUL,EAAK,CACtB,OAAIA,aAAe,MAAcA,EAC1B,IAAI,MAAM,OAAOA,GAAQ,SAAWA,EAAM,gBAAiB,CAChE,MAAOA,CACX,CAAG,CACH,CAQA,SAAS2B,GAAY3B,EAAKlD,EAAQV,EAAO,CAG7B,MADIiE,GAAUL,CAAG,CAU7B,CACA,SAASqC,GAAgBF,EAAU,CACjC,GAAI,OAAOA,GAAa,YAAc,CAACA,EAAS,OAAQ,OAAOE,GAAgBF,EAAQ,CAAE,EACzF,GAAI,MAAM,QAAQA,CAAQ,EAAG,CAC3B,MAAMwB,EAAU,GAChB,QAASvK,EAAI,EAAGA,EAAI+I,EAAS,OAAQ/I,IAAK,CACxC,MAAMgI,EAASiB,GAAgBF,EAAS/I,CAAC,CAAC,EAC1C,MAAM,QAAQgI,CAAM,EAAIuC,EAAQ,KAAK,MAAMA,EAASvC,CAAM,EAAIuC,EAAQ,KAAKvC,CAAM,CAClF,CACD,OAAOuC,CACR,CACD,OAAOxB,CACT,CACA,SAASF,GAAeD,EAAIxE,EAAS,CACnC,OAAO,SAAkBoG,EAAO,CAC9B,IAAIT,EACJ,OAAAlF,GACE,IACGkF,EAAMhG,GAAQ,KACbf,EAAM,QAAU,CACd,GAAGA,EAAM,QACT,CAAC4F,CAAE,EAAG4B,EAAM,KACxB,EACiBzB,GAAS,IAAMyB,EAAM,QAAQ,EACrC,EACH,MACN,EACWT,CACX,CACA,CAyEA,MAAMU,GAAW,OAAO,UAAU,EAClC,SAASC,GAAQC,EAAG,CAClB,QAAS3K,EAAI,EAAGA,EAAI2K,EAAE,OAAQ3K,IAAK2K,EAAE3K,CAAC,GACxC,CACA,SAAS4K,GAASC,EAAMC,EAAO1G,EAAU,GAAI,CAC3C,IAAI2G,EAAQ,CAAE,EACZC,EAAS,CAAE,EACXC,EAAY,CAAE,EACdC,EAAM,EACNC,EAAUL,EAAM,OAAS,EAAI,GAAK,KACpC,OAAAvD,GAAU,IAAMmD,GAAQO,CAAS,CAAC,EAC3B,IAAM,CACX,IAAIG,EAAWP,EAAI,GAAM,CAAE,EACzB7K,EACAqL,EACF,OAAAD,EAAS5I,EAAM,EACRuB,GAAQ,IAAM,CACnB,IAAIuH,EAASF,EAAS,OACpBG,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACF,GAAIT,IAAW,EACTJ,IAAQ,IACVR,GAAQO,CAAS,EACjBA,EAAY,GACZF,EAAQ,GACRC,EAAS,GACTE,EAAM,EACNC,IAAYA,EAAU,KAEpB/G,EAAQ,WACV2G,EAAQ,CAACN,EAAQ,EACjBO,EAAO,CAAC,EAAI1H,GAAW0I,IACrBf,EAAU,CAAC,EAAIe,EACR5H,EAAQ,WAChB,EACD8G,EAAM,WAECA,IAAQ,EAAG,CAEpB,IADAF,EAAS,IAAI,MAAMM,CAAM,EACpBD,EAAI,EAAGA,EAAIC,EAAQD,IACtBN,EAAMM,CAAC,EAAID,EAASC,CAAC,EACrBL,EAAOK,CAAC,EAAI/H,GAAW2I,CAAM,EAE/Bf,EAAMI,CACd,KAAa,CAIL,IAHAG,EAAO,IAAI,MAAMH,CAAM,EACvBI,EAAgB,IAAI,MAAMJ,CAAM,EAChCH,IAAYQ,EAAc,IAAI,MAAML,CAAM,GAExCM,EAAQ,EAAGC,EAAM,KAAK,IAAIX,EAAKI,CAAM,EACrCM,EAAQC,GAAOd,EAAMa,CAAK,IAAMR,EAASQ,CAAK,EAC9CA,IACD,CACD,IACEC,EAAMX,EAAM,EAAGY,EAASR,EAAS,EACjCO,GAAOD,GAASE,GAAUF,GAASb,EAAMc,CAAG,IAAMT,EAASU,CAAM,EACjED,IAAOC,IAEPL,EAAKK,CAAM,EAAId,EAAOa,CAAG,EACzBH,EAAcI,CAAM,EAAIb,EAAUY,CAAG,EACrCV,IAAYQ,EAAYG,CAAM,EAAIX,EAAQU,CAAG,GAI/C,IAFAN,EAAa,IAAI,IACjBC,EAAiB,IAAI,MAAMM,EAAS,CAAC,EAChCT,EAAIS,EAAQT,GAAKO,EAAOP,IAC3BU,EAAOX,EAASC,CAAC,EACjBrL,EAAIuL,EAAW,IAAIQ,CAAI,EACvBP,EAAeH,CAAC,EAAIrL,IAAM,OAAY,GAAKA,EAC3CuL,EAAW,IAAIQ,EAAMV,CAAC,EAExB,IAAKrL,EAAI4L,EAAO5L,GAAK6L,EAAK7L,IACxB+L,EAAOhB,EAAM/K,CAAC,EACdqL,EAAIE,EAAW,IAAIQ,CAAI,EACnBV,IAAM,QAAaA,IAAM,IAC3BI,EAAKJ,CAAC,EAAIL,EAAOhL,CAAC,EAClB0L,EAAcL,CAAC,EAAIJ,EAAUjL,CAAC,EAC9BmL,IAAYQ,EAAYN,CAAC,EAAIF,EAAQnL,CAAC,GACtCqL,EAAIG,EAAeH,CAAC,EACpBE,EAAW,IAAIQ,EAAMV,CAAC,GACjBJ,EAAUjL,CAAC,IAEpB,IAAKqL,EAAIO,EAAOP,EAAIC,EAAQD,IACtBA,KAAKI,GACPT,EAAOK,CAAC,EAAII,EAAKJ,CAAC,EAClBJ,EAAUI,CAAC,EAAIK,EAAcL,CAAC,EAC1BF,IACFA,EAAQE,CAAC,EAAIM,EAAYN,CAAC,EAC1BF,EAAQE,CAAC,EAAEA,CAAC,IAETL,EAAOK,CAAC,EAAI/H,GAAW2I,CAAM,EAEtCjB,EAASA,EAAO,MAAM,EAAIE,EAAMI,CAAM,EACtCP,EAAQK,EAAS,MAAM,CAAC,CACzB,CACD,OAAOJ,CACb,CAAK,EACD,SAASiB,EAAOD,EAAU,CAExB,GADAf,EAAUI,CAAC,EAAIW,EACXb,EAAS,CACX,KAAM,CAAC9G,EAAG6H,CAAG,EAAIhI,EAAamH,CAAC,EAC/B,OAAAF,EAAQE,CAAC,EAAIa,EACNpB,EAAMM,EAASC,CAAC,EAAGhH,CAAC,CAC5B,CACD,OAAOyG,EAAMM,EAASC,CAAC,CAAC,CACzB,CACL,CACA,CAkEA,SAASc,GAAgBC,EAAM5B,EAAO,CAUpC,OAAOzG,GAAQ,IAAMqI,EAAK5B,GAAS,EAAE,CAAC,CACxC,CACA,SAAS6B,IAAS,CAChB,MAAO,EACT,CACA,MAAMC,GAAY,CAChB,IAAIC,EAAGC,EAAUC,EAAU,CACzB,OAAID,IAAajK,GAAekK,EACzBF,EAAE,IAAIC,CAAQ,CACtB,EACD,IAAID,EAAGC,EAAU,CACf,OAAIA,IAAajK,GAAe,GACzBgK,EAAE,IAAIC,CAAQ,CACtB,EACD,IAAKH,GACL,eAAgBA,GAChB,yBAAyBE,EAAGC,EAAU,CACpC,MAAO,CACL,aAAc,GACd,WAAY,GACZ,KAAM,CACJ,OAAOD,EAAE,IAAIC,CAAQ,CACtB,EACD,IAAKH,GACL,eAAgBA,EACtB,CACG,EACD,QAAQE,EAAG,CACT,OAAOA,EAAE,MACV,CACH,EACA,SAASG,GAAcrI,EAAG,CACxB,OAASA,EAAI,OAAOA,GAAM,WAAaA,EAAC,EAAKA,GAAUA,EAAL,CAAE,CACtD,CACA,SAASsI,IAAiB,CACxB,QAAS3M,EAAI,EAAG4M,EAAS,KAAK,OAAQ5M,EAAI4M,EAAQ,EAAE5M,EAAG,CACrD,MAAMoF,EAAI,KAAKpF,CAAC,IAChB,GAAIoF,IAAM,OAAW,OAAOA,CAC7B,CACH,CACA,SAASyH,MAAcC,EAAS,CAC9B,IAAIC,EAAQ,GACZ,QAAS/M,EAAI,EAAGA,EAAI8M,EAAQ,OAAQ9M,IAAK,CACvC,MAAMqE,EAAIyI,EAAQ9M,CAAC,EACnB+M,EAAQA,GAAU,CAAC,CAAC1I,GAAK9B,MAAU8B,EACnCyI,EAAQ9M,CAAC,EAAI,OAAOqE,GAAM,YAAe0I,EAAQ,GAAO7H,GAAWb,CAAC,GAAKA,CAC1E,CACD,GAAI0I,EACF,OAAO,IAAI,MACT,CACE,IAAIP,EAAU,CACZ,QAASxM,EAAI8M,EAAQ,OAAS,EAAG9M,GAAK,EAAGA,IAAK,CAC5C,MAAMoF,EAAIsH,GAAcI,EAAQ9M,CAAC,CAAC,EAAEwM,CAAQ,EAC5C,GAAIpH,IAAM,OAAW,OAAOA,CAC7B,CACF,EACD,IAAIoH,EAAU,CACZ,QAASxM,EAAI8M,EAAQ,OAAS,EAAG9M,GAAK,EAAGA,IACvC,GAAIwM,KAAYE,GAAcI,EAAQ9M,CAAC,CAAC,EAAG,MAAO,GAEpD,MAAO,EACR,EACD,MAAO,CACL,MAAMgN,EAAO,GACb,QAAShN,EAAI,EAAGA,EAAI8M,EAAQ,OAAQ9M,IAClCgN,EAAK,KAAK,GAAG,OAAO,KAAKN,GAAcI,EAAQ9M,CAAC,CAAC,CAAC,CAAC,EACrD,MAAO,CAAC,GAAG,IAAI,IAAIgN,CAAI,CAAC,CACzB,CACF,EACDV,EACN,EAEE,MAAMW,EAAS,GACTC,EAAa,GACbC,EAAU,IAAI,IACpB,QAASnN,EAAI8M,EAAQ,OAAS,EAAG9M,GAAK,EAAGA,IAAK,CAC5C,MAAMyF,EAASqH,EAAQ9M,CAAC,EACxB,GAAI,CAACyF,EAAQ,SACb,MAAM2H,EAAa,OAAO,oBAAoB3H,CAAM,EACpD,QAASzF,EAAI,EAAG4M,EAASQ,EAAW,OAAQpN,EAAI4M,EAAQ5M,IAAK,CAC3D,MAAM0G,EAAM0G,EAAWpN,CAAC,EACxB,GAAI0G,IAAQ,aAAeA,IAAQ,cAAe,SAClD,MAAM2G,EAAO,OAAO,yBAAyB5H,EAAQiB,CAAG,EACxD,GAAI,CAACyG,EAAQ,IAAIzG,CAAG,EACd2G,EAAK,KACPF,EAAQ,IAAIzG,CAAG,EACf,OAAO,eAAeuG,EAAQvG,EAAK,CACjC,WAAY,GACZ,aAAc,GACd,IAAKiG,GAAe,KAAMO,EAAWxG,CAAG,EAAI,CAAC2G,EAAK,IAAI,KAAK5H,CAAM,CAAC,CAAG,CACjF,CAAW,IAEG4H,EAAK,QAAU,QAAWF,EAAQ,IAAIzG,CAAG,EAC7CuG,EAAOvG,CAAG,EAAI2G,EAAK,WAEhB,CACL,MAAMP,EAAUI,EAAWxG,CAAG,EAC1BoG,EACEO,EAAK,IACPP,EAAQ,KAAKO,EAAK,IAAI,KAAK5H,CAAM,CAAC,EACzB4H,EAAK,QAAU,QACxBP,EAAQ,KAAK,IAAMO,EAAK,KAAK,EAEtBJ,EAAOvG,CAAG,IAAM,SAAWuG,EAAOvG,CAAG,EAAI2G,EAAK,MAC1D,CACF,CACF,CACD,OAAOJ,CACT,CACA,SAASK,GAAW9C,KAAUwC,EAAM,CAClC,GAAIzK,MAAUiI,EAAO,CACnB,MAAM+C,EAAU,IAAI,IAAIP,EAAK,OAAS,EAAIA,EAAK,KAAM,EAAGA,EAAK,CAAC,CAAC,EACzDjD,EAAMiD,EAAK,IAAIQ,GACZ,IAAI,MACT,CACE,IAAIhB,EAAU,CACZ,OAAOgB,EAAE,SAAShB,CAAQ,EAAIhC,EAAMgC,CAAQ,EAAI,MACjD,EACD,IAAIA,EAAU,CACZ,OAAOgB,EAAE,SAAShB,CAAQ,GAAKA,KAAYhC,CAC5C,EACD,MAAO,CACL,OAAOgD,EAAE,OAAOhB,GAAYA,KAAYhC,CAAK,CAC9C,CACF,EACD8B,EACR,CACK,EACD,OAAAvC,EAAI,KACF,IAAI,MACF,CACE,IAAIyC,EAAU,CACZ,OAAOe,EAAQ,IAAIf,CAAQ,EAAI,OAAYhC,EAAMgC,CAAQ,CAC1D,EACD,IAAIA,EAAU,CACZ,OAAOe,EAAQ,IAAIf,CAAQ,EAAI,GAAQA,KAAYhC,CACpD,EACD,MAAO,CACL,OAAO,OAAO,KAAKA,CAAK,EAAE,OAAOgD,GAAK,CAACD,EAAQ,IAAIC,CAAC,CAAC,CACtD,CACF,EACDlB,EACD,CACP,EACWvC,CACR,CACD,MAAM0D,EAAc,GACdC,EAAUV,EAAK,IAAI,KAAO,GAAG,EACnC,UAAWW,KAAY,OAAO,oBAAoBnD,CAAK,EAAG,CACxD,MAAM6C,EAAO,OAAO,yBAAyB7C,EAAOmD,CAAQ,EACtDC,EACJ,CAACP,EAAK,KAAO,CAACA,EAAK,KAAOA,EAAK,YAAcA,EAAK,UAAYA,EAAK,aACrE,IAAIE,EAAU,GACVM,EAAc,EAClB,UAAWL,KAAKR,EACVQ,EAAE,SAASG,CAAQ,IACrBJ,EAAU,GACVK,EACKF,EAAQG,CAAW,EAAEF,CAAQ,EAAIN,EAAK,MACvC,OAAO,eAAeK,EAAQG,CAAW,EAAGF,EAAUN,CAAI,GAEhE,EAAEQ,EAECN,IACHK,EACKH,EAAYE,CAAQ,EAAIN,EAAK,MAC9B,OAAO,eAAeI,EAAaE,EAAUN,CAAI,EAExD,CACD,MAAO,CAAC,GAAGK,EAASD,CAAW,CACjC,CA6CA,MAAMK,GAAgBC,GAAQ,oBAAoB,OAAAA,EAAI,MACtD,SAASC,GAAIxD,EAAO,CAClB,MAAMyD,EAAW,aAAczD,GAAS,CACtC,SAAU,IAAMA,EAAM,QAC1B,EACE,OAAOtF,GAAW0F,GAAS,IAAMJ,EAAM,KAAMA,EAAM,SAAUyD,GAAY,MAAS,CAAC,CACrF,CAOA,SAASC,GAAK1D,EAAO,CACnB,MAAM2D,EAAQ3D,EAAM,MACd4D,EAAYlJ,GAAW,IAAMsF,EAAM,KAAM,OAAW,CACxD,OAAQ,CAACnI,EAAGC,IAAO6L,EAAQ9L,IAAMC,EAAI,CAACD,GAAM,CAACC,CACjD,CAAG,EACD,OAAO4C,GACL,IAAM,CACJ,MAAMR,EAAI0J,IACV,GAAI1J,EAAG,CACL,MAAM2J,EAAQ7D,EAAM,SAEpB,OADW,OAAO6D,GAAU,YAAcA,EAAM,OAAS,EAErDtK,GAAQ,IACNsK,EACEF,EACIzJ,EACA,IAAM,CACJ,GAAI,CAACX,GAAQqK,CAAS,EAAG,MAAMN,GAAc,MAAM,EACnD,OAAOtD,EAAM,IACd,CACN,CACF,EACD6D,CACL,CACD,OAAO7D,EAAM,QACd,EACD,OACA,MACJ,CACA,CAiPA,MAAM8D,GAAM,OCxwDC,CAACC,GAAeC,EAAgB,EAC3CtK,EAAiC,IAAI,ECChC,MAAMuK,EAAoB,CAE7B,YAAYC,EAAiB,CAD7BC,EAAA,wBAEI,KAAK,gBAAkBD,CAC1B,CACL,CCHO,MAAME,WAAuCH,EAAoB,CAIpE,YAAYC,EAAiBtK,EAAS,SAClC,MAAMsK,CAAe,EAJzBC,EAAA,kBAAa,IAAI,KACjBA,EAAA,+BAA0B,IAAI,KAC9BA,EAAA,gBAGI,KAAK,QAAU,CACX,0BAA0BE,EAAAzK,EAAQ,2BAAR,KAAAyK,EAAoC,IAC9D,+BAA+BC,EAAA1K,EAAQ,gCAAR,KAAA0K,EAAyC,GACpF,EAGQ,YAAY,IAAM,CACd,MAAMC,EAAM,KAAK,MACXC,EAAc,KAAK,QAAQ,8BACjC,UAAWC,KAAkB,KAAK,wBAC1BF,EAAME,EAAe,WAAaD,IAClC,KAAK,gBAAgBC,EAAe,EAAE,EACtC,KAAK,WAAW,OAAOA,EAAe,EAAE,EACxC,KAAK,wBAAwB,OAAOA,CAAc,EAGtE,EAAW,KAAK,QAAQ,wBAAwB,CAC3C,CACD,gBAAgBC,EAAS,OACrB,MAAMC,GAAYN,EAAAK,EAAQ,UAAR,YAAAL,EAAiB,GAEnC,GADAO,EAAaD,EAAW,0CAA0C,EAC9D,CAAC,KAAK,WAAW,IAAIA,CAAS,EAAG,CACjC,MAAMF,EAAiB,CACnB,GAAIE,EACJ,aAAc,EACd,WAAY,KAAK,IAAK,CACtC,EACY,KAAK,WAAW,IAAIA,EAAWF,CAAc,EAC7C,KAAK,wBAAwB,IAAIA,CAAc,CAClD,CACJ,CACD,yBAAyBC,EAAS,OAC9B,MAAMC,GAAYN,EAAAK,EAAQ,UAAR,YAAAL,EAAiB,GACnCO,EAAaD,EAAW,0CAA0C,EAClE,IAAIF,EAAiB,KAAK,WAAW,IAAIE,CAAS,EAC7CF,IAID,KAAK,gBAAgBC,CAAO,EAC5BD,EAAiB,KAAK,WAAW,IAAIE,CAAS,GAElDC,EAAaH,EAAgB,mCAAmC,EAC5DC,EAAQ,SAAW,cAGnB,KAAK,yBAAyBA,EAAQ,MAAM,OAAO,EAEvDD,EAAe,eACfA,EAAe,WAAa,KAAK,MAC7B,KAAK,wBAAwB,IAAIA,CAAc,GAC/C,KAAK,wBAAwB,OAAOA,CAAc,CAEzD,CACD,yBAAyBC,EAAS,OAC9B,MAAMC,GAAYN,EAAAK,EAAQ,UAAR,YAAAL,EAAiB,GACnCO,EAAaD,EAAW,0CAA0C,EAClE,MAAMF,EAAiB,KAAK,WAAW,IAAIE,CAAS,EACpDC,EAAaH,EAAgB,mCAAmC,EAChEA,EAAe,eACfA,EAAe,WAAa,KAAK,MAC7BA,EAAe,eAAiB,GAChC,KAAK,wBAAwB,IAAIA,CAAc,EAE/CC,EAAQ,SAAW,cAGnB,KAAK,yBAAyBA,EAAQ,MAAM,OAAO,CAE1D,CACL,CC/EO,MAAMG,WAAgDZ,EAAoB,CAE7E,YAAYC,EAAiB,CACzB,MAAMA,CAAe,EAFzBC,EAAA,iBAGI,KAAK,SAAW,IAAI,qBAAqBD,CAAe,CAC3D,CACD,gBAAgBQ,EAAS,SACrBE,GAAaP,EAAAK,EAAQ,UAAR,YAAAL,EAAiB,GAAI,0CAA0C,EAC5E,KAAK,SAAS,SAASK,GAASJ,EAAAI,EAAQ,UAAR,YAAAJ,EAAiB,EAAE,CACtD,CACD,0BAA2B,CAE1B,CACD,0BAA2B,CAE1B,CACL,CCSO,MAAMQ,WAAqBC,EAAa,CAqB3C,YAAYC,EAAUvC,EAAQwC,EAAQ,SAClC,QArBJd,EAAA,YAAO,MACPA,EAAA,eACAA,EAAA,eACAA,EAAA,iBACAA,EAAA,aAAQ,IAAI,KACZA,EAAA,qBAAgB,GAOhBA,EAAA,uBAUI,MAAMe,EAAmB,CACrB,SAAUF,EAAS,UAAY,KAC/B,UAAWA,EAAS,WAAa,KACjC,wBAAyBA,EAAS,yBAA2B,EAC7D,yBAA0BA,EAAS,0BAA4B,OAAO,iBACtE,YAAYX,EAAAW,EAAS,aAAT,KAAAX,EAAuB,EACnC,oBAAqBW,EAAS,qBAAuB,KACrD,sDAAsDV,EAAAU,EAAS,uDAAT,KAAAV,EAAiE,GACvH,sBAAuBU,EAAS,uBAAyB,CAAE,EAC3D,kBAAmBA,EAAS,mBAAqB,CAC7D,EACQ,KAAK,SAAWE,EAChB,KAAM,CAAE,SAAAC,EAAU,UAAAC,EAAW,wBAAAC,EAAyB,yBAAAC,CAAwB,EAAMJ,EAC9EhB,EAAmBS,GAAc,CACnC,KAAK,OAAO,eAAeA,CAAS,CAChD,EACcY,EAAiCL,EAAiB,sDACpD,OAAO,sBAAyB,WACpC,KAAK,eAAiBK,EAChB,IAAIV,GAAwCX,CAAe,EAC3D,IAAIE,GAA+BF,EAAiB,KAAK,SAAS,qBAAqB,EAC7F,MAAMsB,EAAqBL,EAAWE,EAChCI,EAAsBL,EAAYC,EACxC,KAAK,OAASJ,EACd,MAAMS,EAAS,SAAS,cAAc,QAAQ,EAC9C,KAAK,OAASA,EACdA,EAAO,MAAQF,EAAqBF,EACpCI,EAAO,OAASD,EAAsBH,EACtCI,EAAO,MAAM,MAAQ,GAAG,OAAAF,EAAkB,MAC1CE,EAAO,MAAM,OAAS,GAAG,OAAAD,EAAmB,MAC5C,IAAIE,EAOJ,GANI,OAAOlD,GAAW,SAClBkD,EAAW,SAAS,eAAelD,CAAM,EAGzCkD,EAAWlD,EAEX,CAACkD,EACD,MAAM,IAAI,MAAM,+BAA+B,EAGnDV,EAAO,aAAgBrI,GAAS,CAC5B,KAAK,MAAM,IAAIA,EAAK,GAAIA,CAAI,CACxC,EACQqI,EAAO,oBAAuBrI,GAAS,CACnC,KAAK,MAAM,OAAOA,EAAK,EAAE,CACrC,EACQqI,EAAO,YAAeW,GAAQ,CAC1B,KAAK,KAAK,YAAaA,CAAG,CACtC,EACQD,EAAS,YAAYD,CAAM,CAC9B,CAQD,MAAM,MAAO,CACT,MAAM,KAAK,OAAO,KAAK,KAAM,KAAK,SAAU,KAAK,MAAM,EAEvD,KAAK,KAAO,KAAK,OAAO,YAAW,CACtC,CAgBD,WAAW1F,EAAO,CACd,OAAO,KAAK,OAAO,WAAW,KAAK,oBAAoBA,CAAK,CAAC,CAChE,CAeD,eAAeA,EAAO,iCAClB,OAAO,KAAK,OAAO,eAAe,CAC9B,GAAG,KAAK,oBAAoBA,CAAK,EACjC,MAAMqE,EAAArE,EAAM,OAAN,KAAAqE,EAAc,GACpB,sBAAsBC,EAAAtE,EAAM,uBAAN,KAAAsE,EAA8B,KACpD,UAAUuB,EAAA7F,EAAM,WAAN,KAAA6F,EAAkB,GAC5B,YAAYC,EAAA9F,EAAM,aAAN,KAAA8F,EAAoB,aAChC,WAAWC,EAAA/F,EAAM,YAAN,KAAA+F,EAAmB,SAC9B,YAAYC,EAAAhG,EAAM,aAAN,KAAAgG,EAAoB,SAChC,aAAaC,EAAAjG,EAAM,cAAN,KAAAiG,EAAqB,SAClC,WAAWC,EAAAlG,EAAM,YAAN,KAAAkG,EAAmB,OAC9B,SAASC,EAAAnG,EAAM,UAAN,KAAAmG,EAAiB,OAC1B,YAAYC,EAAApG,EAAM,aAAN,KAAAoG,EAAoB,GAChC,SAASC,EAAArG,EAAM,UAAN,KAAAqG,EAAiB,EAC1B,SAASC,EAAAtG,EAAM,UAAN,KAAAsG,EAAiB,EAC1B,eAAeC,EAAAvG,EAAM,gBAAN,KAAAuG,EAAuB,EACtC,OAAOC,EAAAxG,EAAM,QAAN,KAAAwG,EAAe,CAAE,CACpC,CAAS,CACJ,CAYD,oBAAoBxG,EAAO,mHACvB,MAAMyG,GAAQpC,EAAArE,EAAM,QAAN,KAAAqE,EAAe,WACvBqC,GAAUZ,GAAAD,GAAAvB,EAAAtE,EAAM,UAAN,KAAAsE,EAAiBtE,EAAM,WAAvB,KAAA6F,EAAmC7F,EAAM,YAAzC,KAAA8F,EAAsDW,EAChEE,GAAUV,GAAAD,GAAAD,EAAA/F,EAAM,UAAN,KAAA+F,EAAiB/F,EAAM,WAAvB,KAAAgG,EAAmChG,EAAM,aAAzC,KAAAiG,EAAuDQ,EACjEG,GAAUR,GAAAD,GAAAD,EAAAlG,EAAM,UAAN,KAAAkG,EAAiBlG,EAAM,cAAvB,KAAAmG,EAAsCnG,EAAM,YAA5C,KAAAoG,EAAyDK,EACnEI,GAAUN,GAAAD,GAAAD,EAAArG,EAAM,UAAN,KAAAqG,EAAiBrG,EAAM,cAAvB,KAAAsG,EAAsCtG,EAAM,aAA5C,KAAAuG,EAA0DE,EAC1E,MAAO,CACH,GAAGD,EAAAxG,EAAM,IAAN,KAAAwG,EAAW,EACd,GAAGM,EAAA9G,EAAM,IAAN,KAAA8G,EAAW,EACd,OAAOC,EAAA/G,EAAM,QAAN,KAAA+G,EAAe,EACtB,QAAQC,EAAAhH,EAAM,SAAN,KAAAgH,EAAgB,EACxB,OAAOC,EAAAjH,EAAM,QAAN,KAAAiH,EAAe,EACtB,UAAUC,EAAAlH,EAAM,WAAN,KAAAkH,EAAkB,GAC5B,MAAAT,EACA,UAAUU,EAAAnH,EAAM,WAAN,KAAAmH,EAAkBV,EAC5B,aAAaW,EAAApH,EAAM,cAAN,KAAAoH,EAAqBX,EAClC,WAAWY,EAAArH,EAAM,YAAN,KAAAqH,EAAmBZ,EAC9B,YAAYa,EAAAtH,EAAM,aAAN,KAAAsH,EAAoBb,EAChC,QAAAG,EACA,QAAAC,EACA,QAAAH,EACA,QAAAC,EACA,QAAQY,EAAAvH,EAAM,SAAN,KAAAuH,EAAgB,EACxB,cAAcC,GAAAxH,EAAM,eAAN,KAAAwH,GAAsB,EACpC,QAAQC,GAAAzH,EAAM,SAAN,KAAAyH,GAAgB,KACxB,SAASC,GAAA1H,EAAM,UAAN,KAAA0H,GAAiB,KAC1B,QAAQC,GAAA3H,EAAM,SAAN,KAAA2H,GAAgB,KAGxB,KAAKC,GAAA5H,EAAM,MAAN,KAAA4H,GAAa,GAClB,OAAOC,GAAA7H,EAAM,QAAN,KAAA6H,GAAe,KACtB,QAAQC,IAAAC,GAAA/H,EAAM,SAAN,KAAA+H,GAAgB/H,EAAM,QAAtB,KAAA8H,GAA+B,EACvC,QAAQE,IAAAC,GAAAjI,EAAM,SAAN,KAAAiI,GAAgBjI,EAAM,QAAtB,KAAAgI,GAA+B,EACvC,OAAOE,GAAAlI,EAAM,QAAN,KAAAkI,GAAe,EACtB,QAAQC,IAAAC,EAAApI,EAAM,SAAN,KAAAoI,EAAgBpI,EAAM,QAAtB,KAAAmI,GAA+B,EACvC,QAAQE,IAAAC,GAAAtI,EAAM,SAAN,KAAAsI,GAAgBtI,EAAM,QAAtB,KAAAqI,GAA+B,EACvC,OAAOE,GAAAvI,EAAM,QAAN,KAAAuI,GAAe,GACtB,QAAQC,IAAAC,GAAAzI,EAAM,SAAN,KAAAyI,GAAgBzI,EAAM,QAAtB,KAAAwI,GAA+B,GACvC,QAAQE,IAAAC,GAAA3I,EAAM,SAAN,KAAA2I,GAAgB3I,EAAM,QAAtB,KAAA0I,GAA+B,GACvC,UAAUE,GAAA5I,EAAM,WAAN,KAAA4I,GAAkB,CACxC,CACK,CAUD,YAAYhM,EAAM,CACd,OAAO,KAAK,OAAO,YAAYA,CAAI,CACtC,CAgBD,cAAciM,EAAa7I,EAAOpG,EAAS,CACvC,MAAMwE,EAAK,KAAK,gBACVyE,EAAO,CACT,SAAU,UACV,OAAQgG,EACR,MAAA7I,EACA,QAAS,CACL,GAAGpG,EAGH,GAAAwE,CACH,CACb,EACQ,YAAK,eAAe,gBAAgByE,CAAI,EACjCA,CACV,CAcD,aAAaiG,EAAY9I,EAAO,CAC5B,MAAO,CACH,SAAU,SACV,OAAQ8I,EACR,MAAO9I,CACnB,CACK,CAOD,YAAY5B,EAAI,CACZ,OAAO,KAAK,MAAM,IAAIA,CAAE,GAAK,IAChC,CACD,cAAe,CACX,MAAM,IAAI,MAAM,iBAAiB,CACpC,CACD,cAAe,CACX,MAAM,IAAI,MAAM,iBAAiB,CACpC,CAUD,UAAW,CACP,MAAM,IAAI,MAAM,iBAAiB,CACpC,CACL,CCjTO,MAAM2K,WAAsBhE,EAAa,CAS5C,YAAYnI,EAAMoD,EAAOgF,EAAU,CAC/B,QATJb,EAAA,aACAA,EAAA,cACAA,EAAA,iBACAA,EAAA,uBAAkB,IAClBA,EAAA,qBAAgB,IAChBA,EAAA,gBAAW,GACXA,EAAA,uBACAA,EAAA,kBAGI,KAAK,KAAOvH,EACZ,KAAK,MAAQoD,EACb,KAAK,SAAWgF,EAChB,KAAK,gBAAkB,GACvB,KAAK,UAAY,OAAO,KAAKhF,CAAK,EAClC,KAAK,UAAU,QAASmD,GAAa,CACjC,KAAK,gBAAgBA,CAAQ,EAAIvG,EAAKuG,CAAQ,CAC1D,CAAS,EACD,KAAK,eAAkBlF,GAAMA,EACzB+G,EAAS,QAAU,OAAOA,EAAS,QAAW,WAC9C,KAAK,eAAiBgE,GAAkBhE,EAAS,MAAM,EAE9D,CACD,OAAQ,CACJ,KAAK,SAAW,EAChB,KAAK,OAAO,CAAC,CAChB,CACD,SAAU,CACN,KAAK,MAAK,EACV,OAAO,KAAK,KAAK,KAAK,EAAE,QAAS7B,GAAa,CAC1C,KAAK,KAAKA,CAAQ,EAAI,KAAK,gBAAgBA,CAAQ,CAC/D,CAAS,CACJ,CACD,SAAU,CACN,KAAK,SAAW,EAChB,OAAO,KAAK,KAAK,KAAK,EAAE,QAASA,GAAa,CAE1C,MAAM8F,EAAa,KAAK,MAAM9F,CAAQ,EAChC+F,EAAW,KAAK,gBAAgB/F,CAAQ,EAE9C,KAAK,MAAMA,CAAQ,EAAI+F,EACvB,KAAK,gBAAgB/F,CAAQ,EAAI8F,CAC7C,CAAS,EAEI,KAAK,SAAS,OACf,KAAK,SAAS,WAAa,GAElC,CACD,YAAYhN,EAAGpC,EAAGpF,EAAG,CACjB,OAAQ,KAAK,eAAewH,CAAC,GAAKA,IAAMxH,EAAIoF,GAAKA,CACpD,CACD,OAAOsP,EAAI,CACP,KAAM,CAAE,SAAAC,EAAU,KAAAC,EAAM,OAAAC,EAAQ,WAAAC,CAAY,EAAG,KAAK,SACpD,GAAI,CAACH,EAAU,CACX,KAAK,KAAK,WAAY,EAAE,EACxB,MACH,CAED,GADA,KAAK,UAAYD,EAAKC,EAClB,KAAK,SAAW,IAChB,KAAK,SAAWC,EAAO,EAAI,EACvBE,GAAY,CAIZ,KAAK,KAAK,WAAY,EAAE,EACxB,MACH,CAEL,QAAS/T,EAAI,EAAGA,EAAI,KAAK,UAAU,OAAQA,IAAK,CAC5C,MAAM2N,EAAW,KAAK,UAAU3N,CAAC,EAC3BgU,EAAY,KAAK,MAAMrG,CAAQ,EAC/B8F,EAAa,KAAK,gBAAgB9F,CAAQ,EAC1C+F,EAAWM,EACjB,GAAIrG,EAAS,QAAQ,OAAO,IAAM,GAAI,CAElC,GAAI8F,IAAeC,EAAU,CACzB,KAAK,KAAK/F,CAAQ,EAAI8F,EACtB,QACH,CACD,GAAIK,EAAQ,CACR,MAAMG,EAAsB,KAAK,eAAe,KAAK,QAAQ,GAAK,KAAK,SACjEC,EAAmBC,GAAmBV,EAAYC,EAAUO,CAAmB,EACrF,KAAK,KAAKtG,CAAQ,EAAIuG,EACtB,QACH,CACD,KAAK,KAAKvG,CAAQ,EAAIwG,GAAmBV,EAAYC,EAAU,KAAK,QAAQ,EAC5E,QACH,CACD,GAAII,EAAQ,CACR,KAAK,KAAKnG,CAAQ,EAAI,KAAK,YAAY,KAAK,SAAU8F,EAAYC,CAAQ,EAC1E,QACH,CACD,KAAK,KAAK/F,CAAQ,EACd8F,GAAcC,EAAWD,GAAc,KAAK,QACnD,CACG,KAAK,WAAa,GAClB,KAAK,KAAK,WAAY,EAAE,CAE/B,CACL,CCtGO,MAAMW,EAAwB,CAQjC,YAAYC,EAASC,EAAW,CAPhC3F,EAAA,gBACAA,EAAA,kBACAA,EAAA,sBAAiB,MAIjBA,EAAA,sBAAiB,MAMjBA,EAAA,cAJI,KAAK,QAAU0F,EACf,KAAK,UAAYC,EACjB,KAAK,MAAQ,SAChB,CAED,OAAQ,CACJ,YAAK,mBAAkB,EACvB,KAAK,UAAU,KAAK,WAAY,KAAK,SAAS,KAAK,IAAI,CAAC,EAEnD,KAAK,QAAQ,iBAAiB,IAAI,KAAK,SAAS,GACjD,KAAK,QAAQ,kBAAkB,KAAK,SAAS,EAEjD,KAAK,MAAQ,UACN,IACV,CACD,MAAO,CACH,YAAK,QAAQ,oBAAoB,KAAK,SAAS,EAC3C,KAAK,iBAAmB,OACxB,KAAK,eAAc,EACnB,KAAK,eAAiB,MAE1B,KAAK,UAAU,QACf,KAAK,MAAQ,UACN,IACV,CACD,OAAQ,CACJ,YAAK,QAAQ,oBAAoB,KAAK,SAAS,EAC/C,KAAK,MAAQ,SACN,IACV,CACD,SAAU,CACN,YAAK,eAAiB,KACtB,KAAK,UAAU,UACR,IACV,CACD,kBAAmB,CACf,KAAK,mBAAkB,EACvB,MAAMC,EAAU,KAAK,eACrBnF,SAAamF,CAAO,EACbA,CACV,CACD,oBAAqB,CACb,KAAK,iBAAmB,OACxB,KAAK,eAAiB,IAAI,QAASC,GAAY,CAC3C,KAAK,eAAiBA,CACtC,CAAa,EAER,CACD,UAAW,CACPpF,EAAa,KAAK,cAAc,EAEhC,KAAM,CAAE,KAAAyE,EAAM,WAAAE,CAAU,EAAK,KAAK,UAAU,SAC5C,GAAIA,IAAe,UAAW,CAC1B,KAAK,UAAU,UACf,KAAK,MAAK,EACV,MACH,CAED,KAAK,eAAc,EACnB,KAAK,eAAiB,KAClB,CAAAF,GAIJ,KAAK,QAAQ,oBAAoB,KAAK,SAAS,CAClD,CACL,CCvFA,MAAMY,GAAK,EACLC,GAAK,EACLC,GAAK,EACLC,GAAK,EACLC,GAAK,EACLC,GAAK,EACLC,GAAK,EACLC,GAAK,EACLC,GAAK,EAuBJ,MAAMC,EAAS,CAOlB,YAAYC,EAAS,CANrBxG,EAAA,aAOQwG,GAEA,KAAK,KAAO,IAAI,aAAa,CAAC,EAC9B,KAAK,KAAKV,EAAE,EAAIU,EAAQ,CAAC,EACzB,KAAK,KAAKT,EAAE,EAAIS,EAAQ,CAAC,EACzB,KAAK,KAAKR,EAAE,EAAIQ,EAAQ,CAAC,EACzB,KAAK,KAAKP,EAAE,EAAIO,EAAQ,CAAC,EACzB,KAAK,KAAKN,EAAE,EAAIM,EAAQ,CAAC,EACzB,KAAK,KAAKL,EAAE,EAAIK,EAAQ,CAAC,EACzB,KAAK,KAAKJ,EAAE,EAAII,EAAQ,CAAC,EACzB,KAAK,KAAKH,EAAE,EAAIG,EAAQ,CAAC,EACzB,KAAK,KAAKF,EAAE,EAAIE,EAAQ,CAAC,GAGzB,KAAK,KAAO,IAAI,aAAa,CAAC,CAErC,CAWD,WAAW,MAAO,CACd,OAAOC,EACV,CACD,OAAO,SAAS/S,EAAGC,EAAG+S,EAAK,CACvB,MAAMC,EAAKjT,EAAE,KAAKoS,EAAE,EAAInS,EAAE,KAAKmS,EAAE,EAC7BpS,EAAE,KAAKqS,EAAE,EAAIpS,EAAE,KAAKsS,EAAE,EACtBvS,EAAE,KAAKsS,EAAE,EAAIrS,EAAE,KAAKyS,EAAE,EACpBQ,EAAKlT,EAAE,KAAKoS,EAAE,EAAInS,EAAE,KAAKoS,EAAE,EAC7BrS,EAAE,KAAKqS,EAAE,EAAIpS,EAAE,KAAKuS,EAAE,EACtBxS,EAAE,KAAKsS,EAAE,EAAIrS,EAAE,KAAK0S,EAAE,EACpBQ,EAAKnT,EAAE,KAAKoS,EAAE,EAAInS,EAAE,KAAKqS,EAAE,EAC7BtS,EAAE,KAAKqS,EAAE,EAAIpS,EAAE,KAAKwS,EAAE,EACtBzS,EAAE,KAAKsS,EAAE,EAAIrS,EAAE,KAAK2S,EAAE,EACpBQ,EAAKpT,EAAE,KAAKuS,EAAE,EAAItS,EAAE,KAAKmS,EAAE,EAC7BpS,EAAE,KAAKwS,EAAE,EAAIvS,EAAE,KAAKsS,EAAE,EACtBvS,EAAE,KAAKyS,EAAE,EAAIxS,EAAE,KAAKyS,EAAE,EACpBW,EAAKrT,EAAE,KAAKuS,EAAE,EAAItS,EAAE,KAAKoS,EAAE,EAC7BrS,EAAE,KAAKwS,EAAE,EAAIvS,EAAE,KAAKuS,EAAE,EACtBxS,EAAE,KAAKyS,EAAE,EAAIxS,EAAE,KAAK0S,EAAE,EACpBW,EAAKtT,EAAE,KAAKuS,EAAE,EAAItS,EAAE,KAAKqS,EAAE,EAC7BtS,EAAE,KAAKwS,EAAE,EAAIvS,EAAE,KAAKwS,EAAE,EACtBzS,EAAE,KAAKyS,EAAE,EAAIxS,EAAE,KAAK2S,EAAE,EACpBW,EAAKvT,EAAE,KAAK0S,EAAE,EAAIzS,EAAE,KAAKmS,EAAE,EAC7BpS,EAAE,KAAK2S,EAAE,EAAI1S,EAAE,KAAKsS,EAAE,EACtBvS,EAAE,KAAK4S,EAAE,EAAI3S,EAAE,KAAKyS,EAAE,EACpBc,EAAKxT,EAAE,KAAK0S,EAAE,EAAIzS,EAAE,KAAKoS,EAAE,EAC7BrS,EAAE,KAAK2S,EAAE,EAAI1S,EAAE,KAAKuS,EAAE,EACtBxS,EAAE,KAAK4S,EAAE,EAAI3S,EAAE,KAAK0S,EAAE,EACpBc,EAAKzT,EAAE,KAAK0S,EAAE,EAAIzS,EAAE,KAAKqS,EAAE,EAC7BtS,EAAE,KAAK2S,EAAE,EAAI1S,EAAE,KAAKwS,EAAE,EACtBzS,EAAE,KAAK4S,EAAE,EAAI3S,EAAE,KAAK2S,EAAE,EAC1B,OAAKI,IACDA,EAAM,IAAIH,IAEdG,EAAI,KAAKZ,EAAE,EAAIa,EACfD,EAAI,KAAKX,EAAE,EAAIa,EACfF,EAAI,KAAKV,EAAE,EAAIa,EACfH,EAAI,KAAKT,EAAE,EAAIa,EACfJ,EAAI,KAAKR,EAAE,EAAIa,EACfL,EAAI,KAAKP,EAAE,EAAIa,EACfN,EAAI,KAAKN,EAAE,EAAIa,EACfP,EAAI,KAAKL,EAAE,EAAIa,EACfR,EAAI,KAAKJ,EAAE,EAAIa,EACRT,CACV,CACD,OAAO,SAASA,EAAK,CACjB,OAAKA,IACDA,EAAM,IAAIH,IAEdG,EAAI,KAAKZ,EAAE,EAAI,EACfY,EAAI,KAAKX,EAAE,EAAI,EACfW,EAAI,KAAKV,EAAE,EAAI,EACfU,EAAI,KAAKT,EAAE,EAAI,EACfS,EAAI,KAAKR,EAAE,EAAI,EACfQ,EAAI,KAAKP,EAAE,EAAI,EACfO,EAAI,KAAKN,EAAE,EAAI,EACfM,EAAI,KAAKL,EAAE,EAAI,EACfK,EAAI,KAAKJ,EAAE,EAAI,EACRI,CACV,CACD,OAAO,UAAUU,EAAGC,EAAGX,EAAK,CACxB,OAAKA,IACDA,EAAM,IAAIH,IAEdG,EAAI,KAAKZ,EAAE,EAAI,EACfY,EAAI,KAAKX,EAAE,EAAI,EACfW,EAAI,KAAKV,EAAE,EAAIoB,EACfV,EAAI,KAAKT,EAAE,EAAI,EACfS,EAAI,KAAKR,EAAE,EAAI,EACfQ,EAAI,KAAKP,EAAE,EAAIkB,EACfX,EAAI,KAAKN,EAAE,EAAI,EACfM,EAAI,KAAKL,EAAE,EAAI,EACfK,EAAI,KAAKJ,EAAE,EAAI,EACRI,CACV,CACD,OAAO,MAAMY,EAAIC,EAAIb,EAAK,CACtB,OAAKA,IACDA,EAAM,IAAIH,IAEdG,EAAI,KAAKZ,EAAE,EAAIwB,EACfZ,EAAI,KAAKX,EAAE,EAAI,EACfW,EAAI,KAAKV,EAAE,EAAI,EACfU,EAAI,KAAKT,EAAE,EAAI,EACfS,EAAI,KAAKR,EAAE,EAAIqB,EACfb,EAAI,KAAKP,EAAE,EAAI,EACfO,EAAI,KAAKN,EAAE,EAAI,EACfM,EAAI,KAAKL,EAAE,EAAI,EACfK,EAAI,KAAKJ,EAAE,EAAI,EACRI,CACV,CACD,OAAO,OAAOc,EAAOd,EAAK,CACtB,MAAMe,EAAM,KAAK,IAAID,CAAK,EACpBE,EAAM,KAAK,IAAIF,CAAK,EAC1B,OAAKd,IACDA,EAAM,IAAIH,IAEdG,EAAI,KAAKZ,EAAE,EAAI2B,EACff,EAAI,KAAKX,EAAE,EAAI,CAAC2B,EAChBhB,EAAI,KAAKV,EAAE,EAAI,EACfU,EAAI,KAAKT,EAAE,EAAIyB,EACfhB,EAAI,KAAKR,EAAE,EAAIuB,EACff,EAAI,KAAKP,EAAE,EAAI,EACfO,EAAI,KAAKN,EAAE,EAAI,EACfM,EAAI,KAAKL,EAAE,EAAI,EACfK,EAAI,KAAKJ,EAAE,EAAI,EACRI,CACV,CACD,OAAO,KAAKzU,EAAK0V,EAAKC,EAAW,CAC7B,OAAKD,IACDA,EAAM,IAAIpB,IAEdoB,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACxB0V,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACxB0V,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACxB0V,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACxB0V,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACxB0V,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACxB0V,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACxB0V,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACxB0V,EAAI,KAAK,CAAC,EAAI1V,EAAI,KAAK,CAAC,EACjB0V,CACV,CACD,UAAUP,EAAGC,EAAG,CACZ,YAAK,KAAKrB,EAAE,EAAI,KAAK,KAAKF,EAAE,EAAIsB,EAAI,KAAK,KAAKrB,EAAE,EAAIsB,EAAI,KAAK,KAAKrB,EAAE,EACpE,KAAK,KAAKG,EAAE,EAAI,KAAK,KAAKF,EAAE,EAAImB,EAAI,KAAK,KAAKlB,EAAE,EAAImB,EAAI,KAAK,KAAKlB,EAAE,EAC7D,IACV,CACD,MAAMmB,EAAIC,EAAI,CACV,YAAK,KAAKzB,EAAE,EAAI,KAAK,KAAKA,EAAE,EAAIwB,EAChC,KAAK,KAAKvB,EAAE,EAAI,KAAK,KAAKA,EAAE,EAAIwB,EAChC,KAAK,KAAKtB,EAAE,EAAI,KAAK,KAAKA,EAAE,EAAIqB,EAChC,KAAK,KAAKpB,EAAE,EAAI,KAAK,KAAKA,EAAE,EAAIqB,EACzB,IACV,CACD,OAAOC,EAAO,CACV,GAAIA,IAAU,GAAK,EAAGA,EAAQ,KAAK,GAAM,GACrC,OAAO,KAEX,MAAMC,EAAM,KAAK,IAAID,CAAK,EACpBE,EAAM,KAAK,IAAIF,CAAK,EACpBb,EAAK,KAAK,KAAKb,EAAE,EAAI2B,EAAM,KAAK,KAAK1B,EAAE,EAAI2B,EAC3Cd,EAAK,KAAK,KAAKb,EAAE,EAAI0B,EAAM,KAAK,KAAK3B,EAAE,EAAI4B,EAC3CZ,EAAK,KAAK,KAAKb,EAAE,EAAIwB,EAAM,KAAK,KAAKvB,EAAE,EAAIwB,EAC3CX,EAAK,KAAK,KAAKb,EAAE,EAAIuB,EAAM,KAAK,KAAKxB,EAAE,EAAIyB,EACjD,YAAK,KAAK5B,EAAE,EAAIa,EAChB,KAAK,KAAKZ,EAAE,EAAIa,EAChB,KAAK,KAAKX,EAAE,EAAIa,EAChB,KAAK,KAAKZ,EAAE,EAAIa,EACT,IACV,CACD,SAASc,EAAO,CACZ,OAAOtB,GAAS,SAAS,KAAMsB,EAAO,IAAI,CAC7C,CACD,IAAI,IAAK,CACL,OAAO,KAAK,KAAK7B,EAAE,CACtB,CACD,IAAI,IAAK,CACL,OAAO,KAAK,KAAKG,EAAE,CACtB,CACD,IAAI,IAAK,CACL,OAAO,KAAK,KAAKL,EAAE,CACtB,CACD,IAAI,IAAK,CACL,OAAO,KAAK,KAAKC,EAAE,CACtB,CACD,IAAI,IAAK,CACL,OAAO,KAAK,KAAKE,EAAE,CACtB,CACD,IAAI,IAAK,CACL,OAAO,KAAK,KAAKC,EAAE,CACtB,CACD,eAAekB,EAAGC,EAAG,CACjB,MAAO,CACH,KAAK,KAAKvB,EAAE,EAAIsB,EAAI,KAAK,KAAKrB,EAAE,EAAIsB,EAAI,KAAK,KAAKrB,EAAE,EACpD,KAAK,KAAKC,EAAE,EAAImB,EAAI,KAAK,KAAKlB,EAAE,EAAImB,EAAI,KAAK,KAAKpB,EAAE,CAChE,CACK,CACL,CACA,MAAMQ,GAAa,IAAIF,GCrOvB,IAAIuB,GACH,SAAUA,EAAY,CAInBA,EAAWA,EAAW,SAAc,CAAC,EAAI,WAIzCA,EAAWA,EAAW,YAAiB,CAAC,EAAI,cAI5CA,EAAWA,EAAW,MAAW,CAAC,EAAI,QAItCA,EAAWA,EAAW,OAAY,CAAC,EAAI,SAIvCA,EAAWA,EAAW,SAAc,EAAE,EAAI,WAI1CA,EAAWA,EAAW,iBAAsB,EAAE,EAAI,mBAIlDA,EAAWA,EAAW,qBAA0B,EAAE,EAAI,uBAItDA,EAAWA,EAAW,oBAAyB,GAAG,EAAI,sBAOtDA,EAAWA,EAAW,WAAgB,GAAG,EAAI,aAI7CA,EAAWA,EAAW,KAAU,CAAC,EAAI,OAIrCA,EAAWA,EAAW,IAAS,GAAG,EAAI,KAC1C,GAAGA,IAAeA,EAAa,CAAE,EAAC,EAC3B,MAAMC,WAAiBnH,EAAa,CAkBvC,YAAYoH,EAAOnM,EAAO,CACtB,QAlBJmE,EAAA,cACAA,EAAA,gBAAW,IACXA,EAAA,cACAA,EAAA,kBAAa8H,EAAW,KACxB9H,EAAA,wBACAA,EAAA,6BACAA,EAAA,uBACAA,EAAA,oBAAe,MACfA,EAAA,oBAAe,IACfA,EAAA,0BAAqB,MACrBA,EAAA,kBAAa,GACbA,EAAA,4BAAuB,GACvBA,EAAA,4BAAuB,GACvBA,EAAA,4BAAuB,GACvBA,EAAA,4BAAuB,GACvBA,EAAA,kBAAa,GACbA,EAAA,iBAAY,IA+CZA,EAAA,uBAAkB,CAAC1B,EAAQ2J,IAAe,CAGtC,KAAK,MAAM,gBACX,KAAK,KAAK,SAAU,CAChB,KAAM,UACN,WAAAA,CACZ,CAAS,CACT,GACIjI,EAAA,uBAAkB,CAAC1B,EAAQ/G,IAAU,CACjC,KAAK,KAAK,SAAU,CAChB,KAAM,UACN,MAAAA,CACZ,CAAS,CACT,GA1DQ,KAAK,MAAQyQ,EACb,KAAK,MAAQ,CACT,GAAGnM,EACH,OAAQ,IACpB,EAEQ,KAAK,OAASA,EAAM,OACpB,KAAK,2BAA0B,CAClC,CAED,YAAY6I,EAAa7I,EAAOpG,EAAU,KAAM,CAExC,KAAK,MAAM,SACX,KAAK,cAAa,EAEtB,KAAM,CAAE,UAAAyS,CAAS,EAAK,KAAK,MACrB3H,EAAU2H,EAAU,YAAYxD,EAAa7I,EAAOpG,CAAO,EACjE,KAAK,MAAM,QAAU8K,EACrB,KAAK,MAAM,eAAiB9K,EAC5B,KAAK,kBAAiB,EAKtB,eAAe,IAAM,CACb8K,EAAQ,QAAU,SAClB,KAAK,gBAAgBA,EAASA,EAAQ,UAAU,EAE3CA,EAAQ,QAAU,UACvB,KAAK,gBAAgBA,EAASA,EAAQ,KAAK,EAE/CA,EAAQ,GAAG,SAAU,KAAK,eAAe,EACzCA,EAAQ,GAAG,SAAU,KAAK,eAAe,CACrD,CAAS,CACJ,CACD,eAAgB,CACR,KAAK,MAAM,UACX,KAAK,MAAM,QAAQ,IAAI,SAAU,KAAK,eAAe,EACrD,KAAK,MAAM,QAAQ,IAAI,SAAU,KAAK,eAAe,GAEzD,KAAK,MAAM,QAAU,KACrB,KAAK,MAAM,eAAiB,KAC5B,KAAK,kBAAiB,CACzB,CAiBD,WAAWoE,EAAY9I,EAAO,CAC1B,MAAMsM,EAAY,KAAK,MAAM,SAAS,iBAAgB,EACtD1H,EAAa0H,CAAS,EACtB,KAAM,CAAE,OAAAC,EAAQ,MAAOtQ,CAAC,EAAKqQ,EAAU,WAAWxD,EAAY9I,CAAK,EACnE,KAAK,MAAM,OAASuM,EACpB,KAAK,MAAM,YAActQ,EACzB,KAAK,kBAAiB,CACzB,CASD,cAAc/G,EAAM,CAChB,KAAK,YAAcA,EAGnB,MAAMsX,EAAS,KAAK,MAAM,OACtBA,GAAU,EAAEA,EAAO,WAAaP,EAAW,WAC3CO,EAAO,cAAcP,EAAW,QAAQ,CAE/C,CACD,cAAe,CACX,KAAK,SAAS,KAAK,CAACpU,EAAGC,IAAMD,EAAE,WAAaC,EAAE,UAAU,CAC3D,CACD,4BAA6B,CACzB,KAAK,qBAAuB4S,GAAS,OAAO,KAAK,MAAM,SAAU,KAAK,oBAAoB,EAAE,MAAM,KAAK,MAAM,OAAQ,KAAK,MAAM,MAAM,CACzI,CACD,sBAAuB,CACnB9F,EAAa,KAAK,oBAAoB,EACtC,MAAM6H,EAAkB,KAAK,MAAM,OAAS,KAAK,MAAM,MACjDC,EAAkB,KAAK,MAAM,OAAS,KAAK,MAAM,OACjDC,EAAkB,KAAK,MAAM,OAAS,KAAK,MAAM,MACjDC,EAAkB,KAAK,MAAM,OAAS,KAAK,MAAM,OACvD,KAAK,eAAiBlC,GAAS,UAAU+B,EAAkBE,EAAkB,KAAK,MAAM,EAAGD,EAAkBE,EAAkB,KAAK,MAAM,EAAG,KAAK,cAAc,EAC3J,SAAS,KAAK,oBAAoB,EAClC,UAAU,CAACH,EAAiB,CAACC,CAAe,EACjD,KAAK,cAAcT,EAAW,MAAM,CACvC,CAKD,OAAOY,EAAOC,EAAqB,KAAM,CACjC,KAAK,WAAab,EAAW,cAC7B,KAAK,2BAA0B,EAC/B,KAAK,cAAcA,EAAW,KAAK,GAEnC,KAAK,WAAaA,EAAW,QAC7B,KAAK,qBAAoB,EACzB,KAAK,cAAcA,EAAW,MAAM,GAExC,MAAMO,EAAS,KAAK,MAAM,OAC1B,IAAIO,EAAkBd,EAAW,KAC7B,KAAK,WAAaA,EAAW,SAC7BrH,EAAa,KAAK,cAAc,EAChC,KAAK,gBAAkB8F,GAAS,MAAK8B,GAAA,YAAAA,EAAQ,kBAAmB,KAAK,eAAgB,KAAK,eAAe,EACrGA,GACA,KAAK,gBAAgB,SAAS,KAAK,cAAc,EAErD,KAAK,cAAcP,EAAW,SAAWA,EAAW,QAAQ,EAC5Dc,GAAmBd,EAAW,QAE9B,KAAK,WAAaA,EAAW,WAC7B,KAAK,sBAAsBa,CAAkB,EAC7C,KAAK,kBAAiB,EACtB,KAAK,cAAcb,EAAW,QAAQ,EACtCc,GAAmBd,EAAW,UAE9B,KAAK,WAAaA,EAAW,aACzBO,EACA,KAAK,WAAaA,EAAO,WAAa,KAAK,MAAM,MAGjD,KAAK,WAAa,KAAK,MAAM,MAEjC,KAAK,cAAcP,EAAW,SAAWA,EAAW,mBAAmB,EACvEc,GAAmBd,EAAW,YAE9B,KAAK,WAAaA,EAAW,sBAC7B,KAAK,qBAAuBe,GAA6B,KAAK,MAAM,QAAS,KAAK,WAAY,EAAI,EAClG,KAAK,qBAAuBA,GAA6B,KAAK,MAAM,QAAS,KAAK,WAAY,EAAI,EAClG,KAAK,qBAAuBA,GAA6B,KAAK,MAAM,QAAS,KAAK,WAAY,EAAI,EAClG,KAAK,qBAAuBA,GAA6B,KAAK,MAAM,QAAS,KAAK,WAAY,EAAI,EAClG,KAAK,kBAAiB,EACtB,KAAK,cAAcf,EAAW,QAAQ,EACtCc,GAAmBd,EAAW,qBAG9BO,GAAU,KAAK,WAAaP,EAAW,mBACvC,KAAK,gBAAe,EAEpBO,EAAO,cAAcP,EAAW,oBAAoB,GAEpD,KAAK,WAAaA,EAAW,UAAY,KAAK,SAAS,QACvD,KAAK,SAAS,QAASpI,GAAU,CAE7BA,EAAM,cAAckJ,CAAe,EAE/BlJ,EAAM,aAAe,GAGzBA,EAAM,OAAOgJ,EAAO,KAAK,YAAY,CACrD,CAAa,EAID,KAAK,WAAaZ,EAAW,sBAE7B,KAAK,aAAY,EAGrB,KAAK,WAAa,CACrB,CAGD,mBAAoB,CAChB,OAAI,KAAK,MAAM,QACH,KAAK,aAAe,GAE5B,KAAK,MAAM,OACH,KAAK,aAAe,GAE5B,KAAK,MAAM,SACH,KAAK,aAAe,GAEjB,CACX,QACA,WACA,cACA,YACA,aACA,UACA,UACA,UACA,SACZ,EACmB,KAAMxF,GAAU,KAAK,MAAMA,CAAK,IAAM,CAAC,EACtC,KAAK,aAAe,GAExB,KAAK,aAAe,EAC/B,CAWD,sBAAsBqG,EAAqB,KAAM,CAE7C,GADAlI,EAAa,KAAK,eAAe,EAC7B,KAAK,qBAAuBkI,GAAsB,KAAK,aACvD,OAEJ,MAAMG,EAAK,KAAK,gBACVC,EAAYD,EAAG,KAAO,GAAKA,EAAG,KAAO,EAC3C,IAAIE,EAAe,KAAK,MAAM,UAAY,CAACD,EACrC,CACE,EAAGD,EAAG,GACN,EAAGA,EAAG,GACN,MAAO,KAAK,MAAQA,EAAG,GACvB,OAAQ,KAAK,OAASA,EAAG,EAC5B,EACC,KACFH,GAAsBK,EACtBA,EAAeC,GAAcN,EAAoBK,CAAY,EAExDL,IACLK,EAAeL,GAEnB,KAAK,mBAAqBA,EAC1B,KAAK,aAAeK,CACvB,CACD,iBAAkB,SACd,MAAMnN,EAAQ,KAAK,MACbqN,EAAIrN,EAAM,QAAU,EACpB/D,IAAIoI,EAAArE,EAAM,SAAN,YAAAqE,EAAc,SAAU,EAClC,IAAIiJ,EAASD,GACT/I,EAAAtE,EAAM,SAAN,MAAAsE,EAAc,eACdgJ,EAASD,EAAIpR,EAAIoR,EAAIpR,GAEzB,KAAK,WAAaqR,CACrB,CACD,YAAYC,EAAU,CAClB,KAAM,CAAE,MAAAxY,EAAO,OAAAC,EAAQ,QAAA0P,EAAS,eAAA8I,EAAgB,OAAAjB,EAAQ,YAAAkB,CAAW,EAAK,KAAK,MACvE,CAAE,qBAAAC,EAAsB,qBAAAC,EAAsB,qBAAAC,EAAsB,qBAAAC,CAAoB,EAAM,KAC9F,CAAE,OAAAP,EAAQ,WAAAQ,EAAY,gBAAiBb,EAAI,aAAAE,CAAc,EAAG,KAClEvI,EAAaqI,CAAE,EAEfM,EAAS,QAAQ,CACb,MAAAxY,EACA,OAAAC,EACA,QAAS0Y,EACT,QAASC,EACT,QAASC,EACT,QAASC,EACT,QAAAnJ,EACA,eAAA8I,EACA,OAAAF,EACA,OAAAf,EACA,YAAAkB,EACA,MAAOK,EACP,aAAAX,EACA,GAAIF,EAAG,GACP,GAAIA,EAAG,GACP,GAAIA,EAAG,GACP,GAAIA,EAAG,GACP,GAAIA,EAAG,GACP,GAAIA,EAAG,EACnB,CAAS,CAGJ,CAED,IAAI,IAAK,CACL,OAAO,KAAK,MAAM,EACrB,CACD,IAAI,GAAI,CACJ,OAAO,KAAK,MAAM,CACrB,CACD,IAAI,EAAEtT,EAAO,CACL,KAAK,MAAM,IAAMA,IACjB,KAAK,MAAM,EAAIA,EACf,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,MAAO,WACP,OAAQ,KAAK,MAAM,KACd5H,EAAA,KAAK,MAAM,SAAX,YAAAA,EAAmB,SAAQwB,GAAAvB,EAAA,KAAK,MAAM,SAAX,YAAAA,EAAmB,kBAAnB,YAAAuB,EAAoC,KAAM,EAC7E,CACD,IAAI,MAAO,SACP,OAAO,KAAK,MAAM,IAAKvB,GAAAD,EAAA,KAAK,MAAM,SAAX,YAAAA,EAAmB,OAAnB,KAAAC,EAA2B,EACrD,CACD,IAAI,GAAI,CACJ,OAAO,KAAK,MAAM,CACrB,CACD,IAAI,EAAE3K,EAAO,CACL,KAAK,MAAM,IAAMA,IACjB,KAAK,MAAM,EAAIA,EACf,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,MAAM,KACrB,CACD,IAAI,MAAMtS,EAAO,CACT,KAAK,MAAM,QAAUA,IACrB,KAAK,MAAM,MAAQA,EACnB,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAOtS,EAAO,CACV,KAAK,MAAM,SAAWA,IACtB,KAAK,MAAM,OAASA,EACpB,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,OAAQ,CAGR,OAAO,KAAK,MACf,CACD,IAAI,MAAMtS,EAAO,CAGb,KAAK,OAASA,EACd,KAAK,OAASA,CACjB,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAOA,EAAO,CACV,KAAK,MAAM,SAAWA,IACtB,KAAK,MAAM,OAASA,EACpB,KAAK,cAAcsS,EAAW,WAAW,EAEhD,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAOtS,EAAO,CACV,KAAK,MAAM,SAAWA,IACtB,KAAK,MAAM,OAASA,EACpB,KAAK,cAAcsS,EAAW,WAAW,EAEhD,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,MAAM,KACrB,CACD,IAAI,MAAMtS,EAAO,EACT,KAAK,MAAM,SAAWA,GAAS,KAAK,MAAM,SAAWA,KACrD,KAAK,MAAM,OAASA,EACpB,KAAK,MAAM,OAASA,EACpB,KAAK,MAAM,MAAQA,EACnB,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAOtS,EAAO,CACV,KAAK,MAAM,SAAWA,IACtB,KAAK,MAAM,OAASA,EACpB,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAOtS,EAAO,CACV,KAAK,MAAM,SAAWA,IACtB,KAAK,MAAM,OAASA,EACpB,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,MAAM,KACrB,CACD,IAAI,MAAMtS,EAAO,EACT,KAAK,MAAM,SAAWA,GAAS,KAAK,MAAM,SAAWA,KACrD,KAAK,MAAM,OAASA,EACpB,KAAK,MAAM,OAASA,EACpB,KAAK,MAAM,MAAQA,EACnB,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAOtS,EAAO,CACV,KAAK,MAAM,SAAWA,IACtB,KAAK,MAAM,OAASA,EACpB,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAOtS,EAAO,CACV,KAAK,MAAM,SAAWA,IACtB,KAAK,MAAM,OAASA,EACpB,KAAK,cAAcsS,EAAW,KAAK,EAE1C,CACD,IAAI,UAAW,CACX,OAAO,KAAK,MAAM,QACrB,CACD,IAAI,SAAStS,EAAO,CACZ,KAAK,MAAM,WAAaA,IACxB,KAAK,MAAM,SAAWA,EACtB,KAAK,cAAcsS,EAAW,WAAW,EAEhD,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,MAAM,KACrB,CACD,IAAI,MAAMtS,EAAO,CACb,KAAK,MAAM,MAAQA,EACnB,KAAK,cAAcsS,EAAW,oBAAsBA,EAAW,UAAU,CAC5E,CACD,IAAI,UAAW,CACX,OAAO,KAAK,MAAM,QACrB,CACD,IAAI,SAAStS,EAAO,CAChB,KAAK,MAAM,SAAWA,EACtB,KAAK,cAAcsS,EAAW,QAAQ,CACzC,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,MAAM,KACrB,CACD,IAAI,MAAMtS,EAAO,EACT,KAAK,MAAM,UAAYA,GACvB,KAAK,MAAM,UAAYA,GACvB,KAAK,MAAM,UAAYA,GACvB,KAAK,MAAM,UAAYA,KACvB,KAAK,QAAUA,EACf,KAAK,QAAUA,EACf,KAAK,QAAUA,EACf,KAAK,QAAUA,GAEnB,KAAK,MAAM,MAAQA,EACnB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CACD,IAAI,UAAW,CACX,OAAO,KAAK,MAAM,QACrB,CACD,IAAI,SAAStS,EAAO,EACZ,KAAK,MAAM,UAAYA,GAAS,KAAK,MAAM,UAAYA,KACvD,KAAK,QAAUA,EACf,KAAK,QAAUA,GAEnB,KAAK,MAAM,SAAWA,EACtB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CACD,IAAI,aAAc,CACd,OAAO,KAAK,MAAM,WACrB,CACD,IAAI,YAAYtS,EAAO,EACf,KAAK,MAAM,UAAYA,GAAS,KAAK,MAAM,UAAYA,KACvD,KAAK,QAAUA,EACf,KAAK,QAAUA,GAEnB,KAAK,MAAM,YAAcA,EACzB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,MAAM,SACrB,CACD,IAAI,UAAUtS,EAAO,EACb,KAAK,MAAM,UAAYA,GAAS,KAAK,MAAM,UAAYA,KACvD,KAAK,QAAUA,EACf,KAAK,QAAUA,GAEnB,KAAK,MAAM,UAAYA,EACvB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CACD,IAAI,YAAa,CACb,OAAO,KAAK,MAAM,UACrB,CACD,IAAI,WAAWtS,EAAO,EACd,KAAK,MAAM,UAAYA,GAAS,KAAK,MAAM,UAAYA,KACvD,KAAK,QAAUA,EACf,KAAK,QAAUA,GAEnB,KAAK,MAAM,WAAaA,EACxB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CACD,IAAI,SAAU,CACV,OAAO,KAAK,MAAM,OACrB,CACD,IAAI,QAAQtS,EAAO,CACf,KAAK,MAAM,QAAUA,EACrB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CACD,IAAI,SAAU,CACV,OAAO,KAAK,MAAM,OACrB,CACD,IAAI,QAAQtS,EAAO,CACf,KAAK,MAAM,QAAUA,EACrB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CACD,IAAI,SAAU,CACV,OAAO,KAAK,MAAM,OACrB,CACD,IAAI,QAAQtS,EAAO,CACf,KAAK,MAAM,QAAUA,EACrB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CACD,IAAI,SAAU,CACV,OAAO,KAAK,MAAM,OACrB,CACD,IAAI,QAAQtS,EAAO,CACf,KAAK,MAAM,QAAUA,EACrB,KAAK,cAAcsS,EAAW,mBAAmB,CACpD,CAGD,IAAI,cAAe,CACf,OAAO,KAAK,MAAM,cAAgB,CACrC,CACD,IAAI,aAAatS,EAAO,CACpB,KAAK,MAAM,aAAeA,EAC1B,KAAK,cAAcsS,EAAW,iBAAmBA,EAAW,QAAQ,EACpE,KAAK,SAAS,QAASpI,GAAU,CAC7BA,EAAM,cAAcoI,EAAW,gBAAgB,CAC3D,CAAS,CACJ,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAOtS,EAAO,CACd,KAAK,MAAM,OAASA,EACpB,KAAK,cAAcsS,EAAW,iBAAmBA,EAAW,QAAQ,EACpE,KAAK,SAAS,QAASpI,GAAU,CAC7BA,EAAM,cAAcoI,EAAW,gBAAgB,CAC3D,CAAS,CACJ,CACD,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,MACrB,CACD,IAAI,OAAO8B,EAAW,CAClB,MAAMC,EAAY,KAAK,MAAM,OAC7B,GAAIA,IAAcD,EAIlB,IADA,KAAK,MAAM,OAASA,EAChBC,EAAW,CACX,MAAMpO,EAAQoO,EAAU,SAAS,QAAQ,IAAI,EAC7CpJ,EAAahF,IAAU,GAAI,2DAA2D,EACtFoO,EAAU,SAAS,OAAOpO,EAAO,CAAC,CACrC,CACGmO,IACAA,EAAU,SAAS,KAAK,IAAI,EAE5B,KAAK,cAAc9B,EAAW,GAAG,EAEjC8B,EAAU,cAAc9B,EAAW,SAAWA,EAAW,oBAAoB,GAEjF,KAAK,2BAA0B,EAClC,CACL,CC9nBA,IAAIgC,GAAS,EACN,SAASC,IAAW,CACvB,OAAOD,IACX,CACO,MAAME,WAAqBpJ,EAAa,CAW3C,YAAY/E,EAAOoO,EAAcjC,EAAOkC,EAAU,OAC9C,QAXJlK,EAAA,qBACAA,EAAA,cACAA,EAAA,WACAA,EAAA,iBAEAA,EAAA,iBAAY,IACZA,EAAA,YAAO,IACPA,EAAA,eAAU,MACVA,EAAA,gBAAW,MACXA,EAAA,eAAU,MAsRVA,EAAA,uBAAkB,CAAC1B,EAAQ6L,IAAY,CACnC,KAAK,KAAK,SAAUA,CAAO,CACnC,GACInK,EAAA,uBAAkB,CAAC1B,EAAQ6L,IAAY,CACnC,KAAK,KAAK,SAAUA,CAAO,CACnC,GAxRQ,KAAK,aAAeF,EACpB,KAAK,MAAQjC,EACb,KAAK,IAAK9H,EAAAgK,GAAA,YAAAA,EAAU,KAAV,KAAAhK,EAAgB6J,GAAQ,EAClC,KAAK,SACDG,GACI,IAAInC,GAAS,KAAK,MAAO,CACrB,GAAI,KAAK,GACT,EAAGlM,EAAM,EACT,EAAGA,EAAM,EACT,MAAOA,EAAM,MACb,OAAQA,EAAM,OACd,MAAOA,EAAM,MACb,SAAUA,EAAM,SAChB,MAAOA,EAAM,MACb,SAAUA,EAAM,SAChB,YAAaA,EAAM,YACnB,UAAWA,EAAM,UACjB,WAAYA,EAAM,WAClB,QAASA,EAAM,QACf,QAASA,EAAM,QACf,QAASA,EAAM,QACf,QAASA,EAAM,QACf,OAAQA,EAAM,OACd,aAAcA,EAAM,aACpB,OAAQA,EAAM,OACd,OAAQA,EAAM,OACd,OAAQA,EAAM,OACd,OAAQA,EAAM,OACd,MAAOA,EAAM,MACb,MAAOA,EAAM,MACb,OAAQA,EAAM,OACd,OAAQA,EAAM,OACd,SAAUA,EAAM,SAChB,OAAQ,KACR,OAAQ,KACR,YAAa,KACb,QAAS,KACT,eAAgB,IACpC,CAAiB,EAET,KAAK,SAAS,GAAG,SAAU,KAAK,eAAe,EAC/C,KAAK,SAAS,GAAG,SAAU,KAAK,eAAe,EAE/C,KAAK,OAASA,EAAM,OACpB,KAAK,OAASA,EAAM,OACpB,KAAK,QAAUA,EAAM,QACrB,KAAK,IAAMA,EAAM,GACpB,CACD,IAAI,GAAI,CACJ,OAAO,KAAK,SAAS,CACxB,CACD,IAAI,EAAErG,EAAO,CACT,KAAK,SAAS,EAAIA,CACrB,CACD,IAAI,GAAI,CACJ,OAAO,KAAK,SAAS,CACxB,CACD,IAAI,EAAEA,EAAO,CACT,KAAK,SAAS,EAAIA,CACrB,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,SAAS,KACxB,CACD,IAAI,MAAMA,EAAO,CACb,KAAK,SAAS,MAAQA,CACzB,CACD,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,MACxB,CACD,IAAI,OAAOA,EAAO,CACd,KAAK,SAAS,OAASA,CAC1B,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,SAAS,KACxB,CACD,IAAI,MAAMA,EAAO,CACb,KAAK,SAAS,MAAQA,CACzB,CACD,IAAI,UAAW,CACX,OAAO,KAAK,SAAS,QACxB,CACD,IAAI,SAASA,EAAO,CAChB,KAAK,SAAS,SAAWA,CAC5B,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,SAAS,KACxB,CACD,IAAI,MAAMA,EAAO,CACb,KAAK,SAAS,MAAQA,CACzB,CACD,IAAI,UAAW,CACX,OAAO,KAAK,SAAS,QACxB,CACD,IAAI,SAASA,EAAO,CAChB,KAAK,SAAS,SAAWA,CAC5B,CACD,IAAI,aAAc,CACd,OAAO,KAAK,SAAS,WACxB,CACD,IAAI,YAAYA,EAAO,CACnB,KAAK,SAAS,YAAcA,CAC/B,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,SAAS,SACxB,CACD,IAAI,UAAUA,EAAO,CACjB,KAAK,SAAS,UAAYA,CAC7B,CACD,IAAI,YAAa,CACb,OAAO,KAAK,SAAS,UACxB,CACD,IAAI,WAAWA,EAAO,CAClB,KAAK,SAAS,WAAaA,CAC9B,CACD,IAAI,SAAU,CACV,OAAO,KAAK,SAAS,OACxB,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,SAAS,QAAUA,CAC3B,CACD,IAAI,SAAU,CACV,OAAO,KAAK,SAAS,OACxB,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,SAAS,QAAUA,CAC3B,CACD,IAAI,SAAU,CACV,OAAO,KAAK,SAAS,OACxB,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,SAAS,QAAUA,CAC3B,CACD,IAAI,SAAU,CACV,OAAO,KAAK,SAAS,OACxB,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,SAAS,QAAUA,CAC3B,CACD,IAAI,OAAQ,CACR,OAAI,KAAK,SAAW,KAAK,OACd,KAEJ,KAAK,SAAS,MACxB,CACD,IAAI,MAAMA,EAAO,CAETA,IAAU,OAGd,KAAK,SAAS,OAASA,EACvB,KAAK,SAAS,OAASA,EAC1B,CACD,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,MACxB,CACD,IAAI,OAAOA,EAAO,CACd,KAAK,SAAS,OAASA,CAC1B,CACD,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,MACxB,CACD,IAAI,OAAOA,EAAO,CACd,KAAK,SAAS,OAASA,CAC1B,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,SAAS,KACxB,CACD,IAAI,MAAMA,EAAO,CACb,KAAK,SAAS,MAAQA,CACzB,CACD,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,MACxB,CACD,IAAI,OAAOA,EAAO,CACd,KAAK,SAAS,OAASA,CAC1B,CACD,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,MACxB,CACD,IAAI,OAAOA,EAAO,CACd,KAAK,SAAS,OAASA,CAC1B,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,SAAS,KACxB,CACD,IAAI,MAAMA,EAAO,CACb,KAAK,SAAS,MAAQA,CACzB,CACD,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,MACxB,CACD,IAAI,OAAOA,EAAO,CACd,KAAK,SAAS,OAASA,CAC1B,CACD,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,MACxB,CACD,IAAI,OAAOA,EAAO,CACd,KAAK,SAAS,OAASA,CAC1B,CACD,IAAI,UAAW,CACX,OAAO,KAAK,SAAS,QACxB,CACD,IAAI,SAASA,EAAO,CAChB,KAAK,SAAS,SAAWA,CAC5B,CACD,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CACD,IAAI,OAAOoU,EAAW,OAClB,MAAMC,EAAY,KAAK,QAGvB,GAFA,KAAK,QAAUD,EACf,KAAK,SAAS,QAAS1J,EAAA0J,GAAA,YAAAA,EAAW,WAAX,KAAA1J,EAAuB,KAC1C2J,EAAW,CACX,MAAMpO,EAAQoO,EAAU,SAAS,QAAQ,IAAI,EAC7CpJ,EAAahF,IAAU,GAAI,+DAA+D,EAC1FoO,EAAU,SAAS,OAAOpO,EAAO,CAAC,CACrC,CACGmO,GACAA,EAAU,SAAS,KAAK,IAAI,CAEnC,CACD,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CACD,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,MACxB,CACD,IAAI,OAAOpU,EAAO,CACd,KAAK,SAAS,OAASA,CAC1B,CACD,IAAI,cAAe,CACf,OAAO,KAAK,SAAS,YACxB,CACD,IAAI,aAAaA,EAAO,CACpB,KAAK,SAAS,aAAeA,CAChC,CACD,IAAI,KAAM,CACN,OAAO,KAAK,IACf,CACD,IAAI,IAAI4U,EAAU,CACd,GAAI,KAAK,OAASA,EAIlB,IADA,KAAK,KAAOA,EACR,CAACA,EAAU,CACX,KAAK,QAAU,KACf,MACH,CACD,KAAK,QAAU,KAAK,aAAa,cAAc,eAAgB,CAC3D,IAAKA,CACjB,CAAS,EACJ,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CACD,IAAI,QAAQ7J,EAAS,CACb,KAAK,WAAaA,IAGlB,KAAK,UACL,KAAK,aAAa,eAAe,yBAAyB,KAAK,QAAQ,EAEvEA,GACA,KAAK,aAAa,eAAe,yBAAyBA,CAAO,EAErE,KAAK,SAAWA,EACZA,EACA,KAAK,SAAS,YAAYA,EAAQ,OAAQA,EAAQ,MAAOA,EAAQ,OAAO,EAGxE,KAAK,SAAS,gBAErB,CAQD,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CACD,IAAI,OAAO6H,EAAQ,CACX,KAAK,UAAYA,IAGrB,KAAK,QAAUA,EACXA,GACA,KAAK,SAAS,WAAWA,EAAO,OAAQA,EAAO,KAAK,EAE3D,CACD,SAAU,CACN,KAAK,KAAK,gBAAiB,EAAE,EAC7B,KAAK,OAAS,KACd,KAAK,QAAU,KACf,KAAK,KAAK,eAAgB,EAAE,EAC5B,KAAK,mBAAkB,CAC1B,CACD,OAAQ,CAEP,CACD,QAAQvM,EAAOgF,EAAU,CACrB,MAAM8E,EAAY,IAAIf,GAAc,KAAK,SAAU/I,EAAOgF,CAAQ,EAIlE,OAFmB,IAAI4E,GAAwB,KAAK,MAAM,iBAAkBE,CAAS,CAGxF,CACL,CC1UO,MAAM0E,GAAarC,GAAU,CAChC,MAAMsC,EAAU,IAAM,CAElB,GADAtC,EAAM,iBAAgB,EAClB,CAACA,EAAM,kBAAmB,CAC1B,WAAWsC,EAAS,kBAAkB,EACtC,MACH,CACDtC,EAAM,UAAS,EACf,sBAAsBsC,CAAO,CACrC,EACI,sBAAsBA,CAAO,CACjC,EAKaC,GAAe,IACjB,YAAc,YAAY,IAAK,EAAG,KAAK,IAAG,iBCnB9CrK,GAAA,cAA4BsK,EAAgB,CAC/C,YAAYpB,EAAU,CAClB,MAAM,CACF,SAAAA,EACA,WAAY,CAAC,aAAc,sBAAuB,SAAS,EAC3D,SAAU,CACN,CAAE,KAAM,eAAgB,QAAS,YAAc,EAC/C,CAAE,KAAM,eAAgB,QAAS,WAAa,EAC9C,CAAE,KAAM,YAAa,QAAS,YAAc,CAC/C,CACb,CAAS,CACJ,CACD,aAAaqB,EAAU,CACnB,KAAM,CAAE,GAAAC,CAAI,EAAG,KACXA,EAAG,aAAaA,EAAG,kBAAkB,IAAMD,EAAS,CAAC,EAAE,aAG3DC,EAAG,cAAcA,EAAG,QAAQ,EAC5BA,EAAG,YAAYA,EAAG,WAAYD,EAAS,CAAC,EAAE,UAAU,EACvD,CAoDL,EAnDIzK,EApBGE,GAoBI,gBAAgB,CACnB,OAAQ,8wBA+BR,SAAU,sdAkBlB,GAtEOA,ICCA,MAAMyK,WAA6BH,EAAgB,CAEtD,YAAYpB,EAAU,CAClB,MAAM,CACF,SAAAA,EACA,WAAY,CACR,aACA,sBACA,UACA,gBACH,EACD,SAAU,CACN,CAAE,KAAM,eAAgB,QAAS,YAAc,EAC/C,CAAE,KAAM,eAAgB,QAAS,WAAa,EAC9C,CAAE,KAAM,gBAAiB,QAAS,YAAc,CACnD,CACb,CAAS,EAfLpJ,EAAA,+BAA0B,GAgBzB,CACD,aAAaO,EAAS,CAClB,KAAM,CAAE,SAAA6I,EAAU,GAAAsB,CAAI,EAAG,KACzB,GAAInK,EAAQ,OAAS6I,EAAS,OAAO,WAAW,+BAC5C,MAAM,IAAI,MAAM,+CAA+C,OAAAA,EAAS,OAAO,WAAW,+BAA8B,YAAW,EAEvI7I,EAAQ,QAAQ,CAACzG,EAAGzI,IAAM,CACtBqZ,EAAG,cAAcA,EAAG,SAAWrZ,CAAC,EAChCqZ,EAAG,YAAYA,EAAG,WAAY5Q,EAAE,UAAU,CACtD,CAAS,EACD,MAAM8Q,EAAW,MAAM,KAAK,MAAMrK,EAAQ,MAAM,EAAE,KAAI,CAAE,EACxD,KAAK,WAAW,gBAAiBqK,CAAQ,CAC5C,CAoEL,CAnEI5K,EA9BS2K,GA8BF,gBAAgB,CACnB,OAAQ,i6BAkCR,SAAWE,GAAiB,2BACZ,OAAAA,EAAY,+ZAec,OAAAA,EAAY,oCACpD,aAAM,KAAK,MAAMA,CAAY,EAAE,KAAI,CAAE,EAClC,IAAKC,GAAQ,eACd,OAAAA,IAAQ,EAAI,QAAU,GAAE,eAAc,OAAAA,EAAG,+CACb,OAAAA,EAAG,iCAElC,EACI,KAAK,EAAE,EAAC,8MAQrB,GCpHO,MAAMC,EAAa,CA4BtB,YAAYtV,EAAS,CA3BrBuK,EAAA,gBAAW,GACXA,EAAA,YAAO,IACPA,EAAA,YACAA,EAAA,eACAA,EAAA,sBAAiB,IACjBA,EAAA,wBAAmB,IACnBA,EAAA,mBAAc,IAsBV,KAAM,CAAE,IAAAgL,EAAK,OAAA1M,EAAQ,MAAAzC,EAAQ,CAAE,GAAKpG,EACpC,KAAK,IAAMuV,EACX,KAAK,OAAS1M,EACd,MAAM2M,EAAc,GACdC,EAAiB,GACvB,IAAIC,EAAmB,GACvB,MAAMC,EAAW,KAAK,YAAY,UAAY,GAC9C,UAAWC,KAAKD,EAAU,CACtB,MAAME,EAAOF,EAASC,CAAC,EACjBE,EAAUD,EAAK,KAEfE,EAAc,GAAG,OAAAR,EAAG,KAAI,OAAAK,GAC9B,IAAII,EAAS,GACTH,EAAK,OACLG,EAAS,IAAI,OAAAH,EAAK,KAAKzP,CAAK,EAAC,MAEjCqP,EAAe,KAAKM,CAAW,EAC/BL,GAAoB,WAAW,OAAAI,EAAO,KAAI,OAAAC,GAAc,OAAAC,EAAM,KAC9DR,EAAYI,CAAC,EAAI,CAAE,KAAMG,EAAa,QAASJ,EAASC,CAAC,EAAE,OAC9D,CACD,KAAK,eAAiBH,EAAe,KAAK,GAAG,EAC7C,KAAK,iBAAmBC,EACxB,KAAK,YAAcF,CACtB,CAvCD,OAAO,aAAapP,EAAO,CACvB,MAAO,EACV,CACD,OAAO,oBAAoBuP,EAAUvP,EAAO,CACxC,MAAMT,EAAM,GACZ,UAAWiQ,KAAKD,EAAU,CACtB,MAAMM,EAAMN,EAASC,CAAC,EACtB,IAAII,EAAS,GACTC,EAAI,OACJD,EAAS,IAAI,OAAAC,EAAI,KAAK7P,CAAK,EAAC,MAEhCT,EAAI,KAAK,GAAG,OAAAsQ,EAAI,KAAI,KAAI,OAAAL,GAAI,OAAAI,EAAQ,CACvC,CACD,OAAOrQ,EAAI,KAAK,GAAG,CACtB,CA0BD,OAAO,gBAAgBS,EAAO,CAC1B,MAAO,EACV,CACD,OAAO,cAAcA,EAAO,CACxB,MAAO,EACV,CACL,CAnDImE,EARS+K,GAQF,WAAW,IAClB/K,EATS+K,GASF,WACP/K,EAVS+K,GAUF,gBACP/K,EAXS+K,GAWF,cACP/K,EAZS+K,GAYF,gBCVJ,MAAMY,GAAN,MAAMA,WAAsBnB,EAAgB,CAE/C,YAAYpB,EAAUvN,EAAO+P,EAAmB,CAC5C,MAAMxD,EAASuD,GAAc,aAAa9P,EAAO+P,CAAiB,EAClE,MAAM,CACF,SAAAxC,EACA,WAAY,CAAC,aAAc,sBAAuB,SAAS,EAC3D,SAAU,CACN,CAAE,KAAM,eAAgB,QAAS,YAAc,EAC/C,CAAE,KAAM,eAAgB,QAAS,WAAa,EAC9C,CAAE,KAAM,YAAa,QAAS,YAAc,EAC5C,CAAE,KAAM,eAAgB,QAAS,YAAc,EAC/C,CAAE,KAAM,UAAW,QAAS,WAAa,EACzC,GAAGhB,EAAO,QACb,EACD,cAAe,CACX,OAAQA,EAAO,OACf,SAAUA,EAAO,QACpB,CACb,CAAS,EAlBLpI,EAAA,eAAU,IAmBN,KAAK,QAAUoI,EAAO,OACzB,CACD,aAAaqC,EAAU,CACnB,KAAM,CAAE,GAAAC,CAAI,EAAG,KACfA,EAAG,cAAcA,EAAG,QAAQ,EAC5BA,EAAG,YAAYA,EAAG,WAAYD,EAAS,CAAC,EAAE,UAAU,CACvD,CACD,UAAU5O,EAAO,OACb,MAAMgQ,EAAU,KAAK,SAAS,UAAU,qBAAoB,GAC5D3L,EAAArE,EAAM,UAAN,MAAAqE,EAAe,QAAQ,CAAC4L,EAAKrQ,IAAU,OACnC,MAAMsQ,EAAS,KAAK,QAAQtQ,CAAK,EAC3BuQ,EAAUH,EAAQE,EAAO,IAAI,EAC7BlQ,GAAQqE,EAAA4L,EAAI,QAAJ,KAAA5L,EAAa,GACrB+L,EAAUF,EAAO,YACvB,OAAO,KAAKlQ,CAAK,EAAE,QAAS/D,GAAM,CAC9B,MAAMoU,EAASF,EAAQ,SAASlU,CAAC,EAC3BqU,EAAWF,EAAQnU,CAAC,EAC1B,IAAItC,EAAQ0W,EAAO,UACbA,EAAO,UAAUrQ,EAAM/D,CAAC,EAAG+D,CAAK,EAChCA,EAAM/D,CAAC,EACT,MAAM,QAAQtC,CAAK,IACnBA,EAAQ,IAAI,aAAaA,CAAK,GAElC,KAAK,WAAW2W,EAAS,KAAM3W,CAAK,CACpD,CAAa,CACb,EACK,CACD,OAAO,aAAaqG,EAAO+P,EAAmB,CAE1C,MAAMQ,EAAkB,GAClBC,EAAU,GAChB,IAAIC,EAAkB,GACtB,MAAMlB,EAAW,GACXmB,EAAM,GACNV,EAAUhQ,EAAM,QAAQ,IAAKkQ,GAAW,CAC1C,MAAMS,EAAYZ,EAAkBG,EAAO,IAAI,EACzChU,EAAMyU,EAAU,aAAaT,EAAO,OAAS,EAAE,EACrDK,EAAgBrU,CAAG,EAAIqU,EAAgBrU,CAAG,EAAI,EAAEqU,EAAgBrU,CAAG,EAAI,EACvE,MAAM0U,EAAKL,EAAgBrU,CAAG,EAC1B0U,IAAO,GACPF,EAAI,KAAK,CAAE,IAAAxU,EAAK,KAAMgU,EAAO,KAAM,MAAOA,EAAO,KAAK,CAAE,EAG5D,MAAMC,EAAU,IAAIQ,EAAU,CAC1B,IAAK,GAAG,OAAAzU,GAAM,OAAA0U,IAAO,EAAI,GAAKA,GAC9B,OAAQ1U,EACR,MAAOgU,EAAO,KAC9B,CAAa,EACD,OAAAO,GAAmBN,EAAQ,iBAC3BZ,EAAS,KAAK,GAAG,OAAO,OAAOY,EAAQ,WAAW,CAAC,EAC5CA,CACnB,CAAS,EAED,IAAIU,EAAgB,GACpBH,GAAA,MAAAA,EAAK,QAASI,GAAO,OACjB,MAAMX,EAAUJ,EAAkBe,EAAG,IAAI,EACnCC,EAAUZ,EAAQ,iBAAiB9L,EAAAyM,EAAG,QAAH,KAAAzM,EAAY,IAC/C2M,EAAQ,GACd,UAAWC,KAAKd,EAAQ,QAAS,CAC7B,IAAIe,EAAKD,EACT,MAAME,EAAWhB,EAAQ,QAAQc,CAAC,EAC9BT,EAAQS,CAAC,GAAKT,EAAQS,CAAC,IAAME,IAC7BD,EAAKpB,GAAc,uBAAuBmB,EAAGE,EAAUX,CAAO,GAElEA,EAAQU,CAAE,EAAIC,EAAS,QAAQ,WAAYD,CAAE,EAC7CF,EAAM,KAAK,CAAE,EAAAC,EAAG,GAAAC,CAAI,EACvB,CACD,IAAIE,EAAejB,EAAQ,wBAAwB,SAC7CA,EAAQ,aAAaY,CAAO,EAC5BZ,EAAQ,aACVkB,EAAalB,EAAQ,sBAAsB,SACzCA,EAAQ,WAAWY,CAAO,EAC1BZ,EAAQ,WACVmB,EAAenB,EAAQ,wBAAwB,SAC7CA,EAAQ,aAAaY,CAAO,EAC5BZ,EAAQ,aACda,EAAM,QAASO,GAAM,CACjB,KAAM,CAAE,EAAAN,EAAG,GAAAC,CAAI,EAAGK,EACZC,EAAM,IAAI,OAAO,MAAM,OAAAP,GAAK,GAAG,EACjCG,IACAA,EAAeA,EAAa,QAAQI,EAAKN,CAAE,GAE3CG,IACAA,EAAaA,EAAW,QAAQG,EAAKN,CAAE,GAEvCI,IACAA,EAAeA,EAAa,QAAQE,EAAKN,CAAE,EAE/D,CAAa,EACD,MAAMO,EAAmBtB,EAAQ,oBAAoBA,EAAQ,SAAUY,CAAO,EACxEW,EAAKD,EAAiB,OAAS,EAAI,KAAK,OAAAA,GAAqB,GAC/DL,IACAP,GAAiB,sBACd,OAAAC,EAAG,IAAG,mCAAkC,OAAAY,EAAE,mBACjD,OAAAN,EAAY,0BAIRC,IACAR,GAAiB,uBACb,OAAAC,EAAG,IAAG,kEAAiE,OAAAY,EAAE,qBAC/E,OAAAL,EAAU,4BAIRC,IACAT,GAAiB,uBACb,OAAAC,EAAG,IAAG,oEAAmE,OAAAY,EAAE,qBACjF,OAAAJ,EAAY,2BAI1B,GACQ,IAAIK,EAAgB,GACpB,UAAWV,KAAKT,EACZmB,GAAiBnB,EAAQS,CAAC,EAG9B,IAAIW,EAAc,mEACdC,EAAc,WAGlB,QAASrc,EAAI,EAAGA,EAAIwa,EAAQ,OAAQxa,IAAK,CACrC,MAAM4D,EAAU4W,EAAQxa,CAAC,EACnBkc,EAAKtY,EAAQ,eAAe,OAAS,EAAI,KAAK,OAAAA,EAAQ,gBAAmB,GACzE0Y,EAAe/B,EAAkB3W,EAAQ,IAAI,EAC/C0Y,EAAa,eACbD,GAAe,6BACL,OAAAzY,EAAQ,OAAM,6BAA4B,OAAAsY,EAAE,iBAGtDI,EAAa,aACbD,GAAe,4BACN,OAAAzY,EAAQ,OAAM,kDAAiD,OAAAsY,EAAE,iBAG1EI,EAAa,eACbF,EAAc,MAAM,OAAAxY,EAAQ,OAAM,oDAAmD,OAAAsY,EAAE,MAE3F,MAAMK,EAAO/B,EAAQxa,EAAI,CAAC,GACtBuc,IAAS,QACThC,EAAkBgC,EAAK,IAAI,EAAE,gBAC7BF,GAAe,6BACL,OAAAD,EAAW,eAG5B,CACD,MAAO,CACH,QAAA5B,EACA,SAAAT,EACA,SAAUO,GAAc,SAASW,EAAiBkB,EAAed,EAAegB,CAAW,EAC3F,OAAQ/B,GAAc,OAAQ,CAC1C,CACK,CACD,OAAO,uBAAuB5T,EAAK8V,EAAcC,EAAkBC,EAAY,EAAG,CAC9E,MAAMjB,EAAI/U,GAAOgW,EAAY,EAAIA,EAAY,IAC7C,OAAID,EAAiBhB,CAAC,GAAKgB,EAAiBhB,CAAC,IAAMe,EACxC,KAAK,uBAAuB9V,EAAK8V,EAAcC,EAAkB,EAAEC,CAAS,EAEhFjB,CACV,CACD,OAAO,gBAAgBjR,EAAO+P,EAAmB,OAC7C,MAAO,CACH,UAAU1L,EAAArE,EAAM,UAAN,KAAAqE,EAAiB,IAAI,IAAK6L,IAAY,CAC5C,KAAMA,EAAO,KACb,MAAOH,EAAkBG,EAAO,IAAI,EAAE,gBAAiBA,EAAO,OAAS,EAAI,CAC3F,EAAc,EACF,YAAa,CACT,MAAO,EACP,OAAQ,CACX,EACD,OAAQ,CACpB,CACK,CACD,OAAO,aAAalQ,EAAO+P,EAAmB,OAC1C,IAAIe,EAAK,GACT,OAAAzM,EAAArE,EAAM,UAAN,MAAAqE,EAAe,QAAS6L,GAAW,CAE/B,MAAMhU,EADY6T,EAAkBG,EAAO,IAAI,EACzB,aAAaA,EAAO,OAAS,EAAE,EACrDY,GAAM,IAAI,OAAA5U,EACtB,GACe,gBAAgB,OAAA4U,EAC1B,CA6EL,EA5EI3M,EA3MS2L,GA2MF,mBACP3L,EA5MS2L,GA4MF,SAAS,IAAM,80BAiCtB3L,EA7OS2L,GA6OF,WAAW,CAACP,EAAUiB,EAASK,EAAegB,IAAgB,qWAgBnE,OAAAtC,EAAQ,gFAKR,OAAAiB,EAAO,YAEP,OAAAK,EAAa,4eAcX,OAAAgB,EAAW,+DAlRZ,IAAMM,GAANrC,GCqBA,MAAMsC,WAAyBzD,EAAgB,CAClD,YAAYpB,EAAU,CAClB,MAAM,CACF,SAAAA,EACA,WAAY,CAAC,aAAc,sBAAuB,SAAS,EAC3D,SAAU,CACN,CAAE,KAAM,eAAgB,QAAS,YAAc,EAC/C,CAAE,KAAM,eAAgB,QAAS,WAAa,EAC9C,CAAE,KAAM,YAAa,QAAS,WAAa,EAC3C,CAAE,KAAM,eAAgB,QAAS,YAAc,EAC/C,CAAE,KAAM,WAAY,QAAS,WAAa,CAC7C,CACb,CAAS,CACJ,CAED,OAAO,gBAAgBvN,EAAO,CAC1B,MAAO,CACH,OAAQA,EAAM,QAAU,GACxB,YAAa,CACT,MAAO,EACP,OAAQ,CACX,CACb,CACK,CACD,aAAa4O,EAAU,CACnB,KAAM,CAAE,GAAAC,CAAI,EAAG,KACfA,EAAG,cAAcA,EAAG,QAAQ,EAC5BA,EAAG,YAAYA,EAAG,WAAYD,EAAS,CAAC,EAAE,UAAU,CACvD,CACD,UAAU5O,EAAO,CACb,KAAK,WAAW,WAAYA,EAAM,MAAM,CAC3C,CACD,oBAAoBqS,EAAQC,EAAQ,CAChC,OAAQD,EAAO,SAAWC,EAAO,QAC7BD,EAAO,YAAY,QAAUC,EAAO,YAAY,OAChDD,EAAO,YAAY,SAAWC,EAAO,YAAY,MACxD,CAoEL,CA1FInO,EAdSiO,GAcF,mBAuBPjO,EArCSiO,GAqCF,gBAAgB,CACnB,OAAQ,m1BAgCR,SAAU,g9BAiClB,GC1GA,MAAMG,GAAsB,IAAI,aAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAAC,EAc3DC,GAAN,MAAMA,WAAkB7D,EAAgB,CAC3C,YAAYpB,EAAU,CAClB,MAAM,CACF,SAAAA,EACA,WAAY,CAAC,aAAc,qBAAqB,EAChD,SAAU,CACN,CAAE,KAAM,eAAgB,QAAS,YAAc,EAC/C,CAAE,KAAM,cAAe,QAAS,kBAAoB,EACpD,CAAE,KAAM,YAAa,QAAS,WAAa,EAC3C,CAAE,KAAM,eAAgB,QAAS,WAAa,EAC9C,CAAE,KAAM,YAAa,QAAS,WAAa,EAC3C,CAAE,KAAM,UAAW,QAAS,YAAc,EAC1C,CAAE,KAAM,SAAU,QAAS,WAAa,EACxC,CAAE,KAAM,kBAAmB,QAAS,WAAa,EACjD,CAAE,KAAM,UAAW,QAAS,WAAa,CAC5C,CACb,CAAS,CACJ,CACD,aAAaqB,EAAU,CACnB,KAAM,CAAE,GAAAC,CAAI,EAAG,KACfA,EAAG,cAAcA,EAAG,QAAQ,EAC5BA,EAAG,YAAYA,EAAG,WAAYD,EAAS,CAAC,EAAE,UAAU,CACvD,CACD,UAAU5O,EAAO,CACb,MAAMyS,EAAgBD,GAAU,gBAAgBxS,CAAK,EACrD,UAAW9D,KAAOuW,EACd,GAAIvW,IAAQ,YACR,KAAK,WAAW,cAAe,GAAOuW,EAAcvW,CAAG,CAAC,UAEnDA,IAAQ,UACb,KAAK,WAAW,YAAauW,EAAcvW,CAAG,CAAC,UAE1CA,IAAQ,QAAS,CACtB,MAAMwW,EAAaC,GAA4BF,EAAc,KAAK,EAClE,KAAK,WAAW,UAAWC,CAAU,CACxC,MACQxW,IAAQ,OACb,KAAK,WAAW,SAAUuW,EAAcvW,CAAG,CAAC,EAEvCA,IAAQ,gBACb,KAAK,WAAW,kBAAmBuW,EAAcvW,CAAG,CAAC,EAEhDA,IAAQ,SACb,KAAK,WAAW,UAAWuW,EAAcvW,CAAG,EAAI,EAAM,CAAG,CAGpE,CACD,OAAO,gBAAgB8D,EAAQ,GAAI,iBAC/B,MAAO,CACH,WAAWqE,EAAArE,EAAM,YAAN,KAAAqE,EAAmBkO,GAC9B,SAASjO,EAAAtE,EAAM,UAAN,KAAAsE,EAAiB,EAC1B,OAAOuB,EAAA7F,EAAM,QAAN,KAAA6F,EAAe,WACtB,MAAMC,EAAA9F,EAAM,OAAN,KAAA8F,EAAc,GACpB,eAAeC,EAAA/F,EAAM,gBAAN,KAAA+F,EAAuB,EACtC,OAAOC,EAAAhG,EAAM,QAAN,KAAAgG,EAAe,EAClC,CACK,CAsDL,EArDI7B,EAzDSqO,GAyDF,gBAAgB,CACnB,OAAQ,guBAqBR,SAAU,yhCA8BlB,GA7GO,IAAMI,GAANJ,GCZA,MAAMK,WAAqB3D,EAAa,CAAxC,kCAEH/K,EAAA,YAAO,UACP,OAAO,cAAe,CAClB,MAAO,QACV,CAwCD,OAAO,gBAAgBnE,EAAO,OAC1B,MAAO,CACH,QAAQqE,EAAArE,EAAM,SAAN,KAAAqE,EAAgB,EACpC,CACK,CAYL,CA5DIF,EADS0O,GACF,mBAKP1O,EANS0O,GAMF,WAAW,CACd,OAAQ,CACJ,MAAO,EACP,OAAQ,aACR,KAAM,OACN,UAAYlZ,GAAU,CAClB,IAAI4X,EAAI5X,EACR,OAAI,MAAM,QAAQ4X,CAAC,EACXA,EAAE,SAAW,EACbA,EAAI,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAEtBA,EAAE,SAAW,EAClBA,EAAI,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAEtBA,EAAE,SAAW,IAClBA,EAAI,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,GAG1B,OAAOA,GAAM,WAClBA,EAAI,CAACA,EAAGA,EAAGA,EAAGA,CAAC,GAEZA,CACV,CACJ,CACT,GACIpN,EA/BS0O,GA+BF,UAAU,CACb,SAAU,8FAKV,QAAS,kNAOjB,GAMI1O,EAlDS0O,GAkDF,eAAe,sgBAQtB1O,EA1DS0O,GA0DF,eAAe,oECzDnB,MAAMC,WAAqB5D,EAAa,CAAxC,kCAEH/K,EAAA,YAAO,UACP,OAAO,cAAe,CAClB,MAAO,QACV,CACD,OAAO,gBAAgBnE,EAAO,SAC1B,MAAO,CACH,OAAOqE,EAAArE,EAAM,QAAN,KAAAqE,EAAe,GACtB,OAAOC,EAAAtE,EAAM,QAAN,KAAAsE,EAAe,UAClC,CACK,CAqBL,CA/BIH,EADS2O,GACF,mBAWP3O,EAZS2O,GAYF,WAAW,CACd,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,MAAO,CACH,MAAO,WACP,UAAYC,GAASJ,GAA4BI,CAAI,EACrD,OAAQ,aACR,KAAM,MACT,CACT,GACI5O,EAzBS2O,GAyBF,eAAe,wIAItB3O,EA7BS2O,GA6BF,aAAa,2BC7BjB,MAAME,WAA6B9D,EAAa,CAAhD,kCAEH/K,EAAA,YAAO,kBACP,OAAO,aAAanE,EAAO,CACvB,MAAO,iBAAiB,OAAAA,EAAM,OAAO,OACxC,CACD,OAAO,gBAAgBA,EAAO,SAC1B,MAAMiT,GAAS5O,EAAArE,EAAM,SAAN,KAAAqE,EAAgB,CAAC,WAAY,UAAU,EACtD,IAAI6O,EAAQlT,EAAM,MAClB,GAAI,CAACkT,EAAO,CACRA,EAAQ,GACR,MAAMC,EAAOF,EAAO,OAAS,EAC7B,QAASzd,EAAI,EAAGA,EAAIyd,EAAO,OAAQzd,IAC/B0d,EAAM,KAAK1d,GAAK,EAAI2d,EAAK,CAEhC,CACD,MAAO,CACH,OAAAF,EACA,MAAAC,EACA,OAAO5O,EAAAtE,EAAM,QAAN,KAAAsE,EAAe,CAClC,CACK,CA2FL,CA/GIH,EADS6O,GACF,mBAqBP7O,EAtBS6O,GAsBF,WAAW,CACd,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,OAAQ,CACJ,MAAO,WACP,UAAYI,GACKA,EAAM,IAAKA,GAAUT,GAA4BS,CAAK,CAAC,EACxD,OAAO,CAACC,EAAKxW,IAAQwW,EAAI,OAAOxW,CAAG,EAAG,EAAE,EAExD,KAAOmD,GAAUA,EAAM,OAAO,OAC9B,OAAQ,aACR,KAAM,MACT,EACD,MAAO,CACH,MAAO,CAAE,EACT,UAAW,CAACrG,EAAOqG,IAAU,OACzB,MAAMiT,GAAS5O,EAAArE,EAAM,SAAN,KAAAqE,EAAgB,GAC/B,IAAI6O,EAAQvZ,EACZ,MAAM2Z,EAAM3Z,EACZ,GAAIuZ,EAAM,SAAW,GAAMA,GAASA,EAAM,SAAWD,EAAO,OAAS,CACjE,QAASzd,EAAI,EAAGA,EAAIyd,EAAO,OAAQzd,IAC3B0d,EAAM1d,CAAC,GACP8d,EAAI9d,CAAC,EAAI0d,EAAM1d,CAAC,EACZ0d,EAAM1d,EAAI,CAAC,IAAM,QAAa8d,EAAI9d,EAAI,CAAC,IAAM,SAC7C8d,EAAI9d,EAAI,CAAC,EAAI8d,EAAI9d,EAAI,CAAC,GAAK0d,EAAM1d,CAAC,EAAI8d,EAAI9d,EAAI,CAAC,GAAK,IAIxD8d,EAAI9d,CAAC,EAAIA,GAAK,GAAKyd,EAAO,OAAS,IAG3CC,EAAQI,CACX,CACD,OAAOA,CACV,EACD,KAAOtT,GAAUA,EAAM,OAAO,OAC9B,OAAQ,aACR,KAAM,OACT,CACT,GACImE,EAjES6O,GAiEF,UAAU,CACb,WAAY,iOAOZ,SAAU,8MAOV,UAAW,uIAKnB,GACI7O,EAtFS6O,GAsFF,YAAaO,GAAW,CAC3B,IAAIlK,EAAO,GACX,QAAS7T,EAAI,EAAGA,EAAI+d,EAAQ/d,IACxB6T,GAAQ,mCAAmC,OAAA7T,EAAC,2BAA0B,OAAAA,EAAI,EAAC,gBAAe,OAAAA,EAAC,cAAa,OAAAA,EAAI,EAAC,mBAEjH,OAAO6T,CACf,GACIlF,EA7FS6O,GA6FF,aAAchT,GAAU,CAC3B,MAAMiT,EAASjT,EAAM,OAAO,QAAU,EACtC,MAAO,0iBAUY,OAAAiT,EAAM,iPAMjC,GChHO,MAAMO,WAAwBtE,EAAa,CAA3C,kCACH/K,EAAA,YAAO,aACP,OAAO,cAAe,CAClB,MAAO,WACV,CAOL,CANIA,EALSqP,GAKF,aAAa,gNCJjB,MAAMC,WAA0BvE,EAAa,CAA7C,kCAEH/K,EAAA,YAAO,eACP,OAAO,cAAe,CAClB,MAAO,aACV,CACD,OAAO,gBAAgBnE,EAAO,SAC1B,MAAO,CACH,OAAOqE,EAAArE,EAAM,QAAN,KAAAqE,EAAe,GACtB,OAAOC,EAAAtE,EAAM,QAAN,KAAAsE,EAAe,UAClC,CACK,CAmCL,CA7CIH,EADSsP,GACF,mBAWPtP,EAZSsP,GAYF,WAAW,CACd,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,MAAO,CACH,MAAO,WACP,UAAYV,GAASJ,GAA4BI,CAAI,EACrD,OAAQ,aACR,KAAM,MACT,CACT,GACI5O,EAzBSsP,GAyBF,UAAU,CACb,SAAU,8FAKV,SAAU,4JAMlB,GACItP,EAtCSsP,GAsCF,eAAe,gOAKtBtP,EA3CSsP,GA2CF,aAAa,2BC3CjB,MAAMC,WAAwBxE,EAAa,CAA3C,kCAEH/K,EAAA,YAAO,aACP,OAAO,cAAe,CAClB,MAAO,WACV,CACD,OAAO,gBAAgBnE,EAAO,SAC1B,MAAO,CACH,OAAOqE,EAAArE,EAAM,QAAN,KAAAqE,EAAe,GACtB,OAAOC,EAAAtE,EAAM,QAAN,KAAAsE,EAAe,UAClC,CACK,CAmCL,CA7CIH,EADSuP,GACF,mBAWPvP,EAZSuP,GAYF,WAAW,CACd,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,MAAO,CACH,MAAO,WACP,UAAYX,GAASJ,GAA4BI,CAAI,EACrD,OAAQ,aACR,KAAM,MACT,CACT,GACI5O,EAzBSuP,GAyBF,UAAU,CACb,SAAU,8FAKV,SAAU,4JAMlB,GACIvP,EAtCSuP,GAsCF,eAAe,+MAKtBvP,EA3CSuP,GA2CF,aAAa,2BC3CjB,MAAMC,WAA2BzE,EAAa,CAA9C,kCAEH/K,EAAA,YAAO,gBACP,OAAO,cAAe,CAClB,MAAO,cACV,CACD,OAAO,gBAAgBnE,EAAO,SAC1B,MAAO,CACH,OAAOqE,EAAArE,EAAM,QAAN,KAAAqE,EAAe,GACtB,OAAOC,EAAAtE,EAAM,QAAN,KAAAsE,EAAe,UAClC,CACK,CAmCL,CA7CIH,EADSwP,GACF,mBAWPxP,EAZSwP,GAYF,WAAW,CACd,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,MAAO,CACH,MAAO,WACP,UAAYZ,GAASJ,GAA4BI,CAAI,EACrD,OAAQ,aACR,KAAM,MACT,CACT,GACI5O,EAzBSwP,GAyBF,UAAU,CACb,SAAU,8FAKV,SAAU,4JAMlB,GACIxP,EAtCSwP,GAsCF,eAAe,gOAKtBxP,EA3CSwP,GA2CF,aAAa,2BC3CjB,MAAMC,WAAyB1E,EAAa,CAA5C,kCAEH/K,EAAA,YAAO,cACP,OAAO,cAAe,CAClB,MAAO,YACV,CACD,OAAO,gBAAgBnE,EAAO,SAC1B,MAAO,CACH,OAAOqE,EAAArE,EAAM,QAAN,KAAAqE,EAAe,GACtB,OAAOC,EAAAtE,EAAM,QAAN,KAAAsE,EAAe,UAClC,CACK,CAmCL,CA7CIH,EADSyP,GACF,mBAWPzP,EAZSyP,GAYF,WAAW,CACd,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,MAAO,CACH,MAAO,WACP,UAAYb,GAASJ,GAA4BI,CAAI,EACrD,OAAQ,aACR,KAAM,MACT,CACT,GACI5O,EAzBSyP,GAyBF,UAAU,CACb,SAAU,8FAKV,SAAU,4JAMlB,GACIzP,EAtCSyP,GAsCF,eAAe,+MAKtBzP,EA3CSyP,GA2CF,aAAa,2BC9DjB,MAAMC,WAAqB3E,EAAa,CAAxC,kCAEH/K,EAAA,YAAO,UACP,OAAO,aAAanE,EAAO,CACvB,MAAO,QACV,CACD,OAAO,gBAAgBA,EAAO,eAC1B,MAAO,CACH,WAAWqE,EAAArE,EAAM,YAAN,KAAAqE,EAAmB,GAC9B,YAAYC,EAAAtE,EAAM,aAAN,KAAAsE,EAAoB,EAChC,YAAYuB,EAAA7F,EAAM,aAAN,KAAA6F,EAAoB,EAChC,WAAWC,EAAA9F,EAAM,YAAN,KAAA8F,EAAmB,EAC9B,MAAMC,EAAA/F,EAAM,OAAN,KAAA+F,EAAc,KAAK,IAAK,CAC1C,CACK,CAiFL,CA9FI5B,EADS0P,GACF,mBAcP1P,EAfS0P,GAeF,WAAW,CACd,UAAW,CACP,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,WAAY,CACR,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,WAAY,CACR,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,UAAW,CACP,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,KAAM,CACF,MAAO,EACP,OAAQ,YACR,UAAYla,IACA,KAAK,MAAQA,GAAS,IAElC,KAAM,OACT,CACT,GACIwK,EA7CS0P,GA6CF,UAAU,CACb,KAAM,0LAMN,MAAO,obAaP,IAAK,0aAeb,GACI1P,EAjFS0P,GAiFF,aAAa,yoBClEjB,MAAMC,WAAsB5E,EAAa,CAAzC,kCAEH/K,EAAA,YAAO,WACP,OAAO,cAAe,CAClB,MAAO,SACV,CA0BD,OAAO,gBAAgBnE,EAAO,OAC1B,MAAO,CACH,MAAMqE,EAAArE,EAAM,OAAN,KAAAqE,EAAc,EAChC,CACK,CA4CL,CA9EIF,EADS2P,GACF,mBAKP3P,EANS2P,GAMF,WAAW,CACd,KAAM,CACF,MAAO,EACP,OAAQ,aACR,KAAM,OACN,UAAYna,GAAU,CAClB,IAAI4X,EAAI5X,EACR,OAAI,MAAM,QAAQ4X,CAAC,EACXA,EAAE,SAAW,EACbA,EAAI,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAEtBA,EAAE,SAAW,EAClBA,EAAI,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAEtBA,EAAE,SAAW,IAClBA,EAAI,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,GAG1B,OAAOA,GAAM,WAClBA,EAAI,CAACA,EAAGA,EAAGA,EAAGA,CAAC,GAEZA,CACV,CACJ,CACT,GAMIpN,EApCS2P,GAoCF,aAAa,uwCCnCjB,MAAMC,WAA6B7E,EAAa,CAAhD,kCAEH/K,EAAA,YAAO,kBACP,OAAO,aAAanE,EAAO,CACvB,MAAO,iBAAiB,OAAAA,EAAM,OAAO,OACxC,CACD,OAAO,gBAAgBA,EAAO,eAC1B,MAAMiT,GAAS5O,EAAArE,EAAM,SAAN,KAAAqE,EAAgB,CAAC,WAAY,UAAU,EACtD,IAAI6O,EAAQlT,EAAM,MAClB,GAAI,CAACkT,EAAO,CACRA,EAAQ,GACR,MAAMC,EAAOF,EAAO,OAAS,EAC7B,QAASzd,EAAI,EAAGA,EAAIyd,EAAO,OAAQzd,IAC/B0d,EAAM,KAAK1d,GAAK,EAAI2d,EAAK,CAEhC,CACD,MAAO,CACH,OAAAF,EACA,MAAAC,EACA,OAAO5O,EAAAtE,EAAM,QAAN,KAAAsE,EAAe,EACtB,QAAQwB,GAAAD,EAAA7F,EAAM,SAAN,KAAA6F,EAAgB7F,EAAM,QAAtB,KAAA8F,EAA+B,EACvC,OAAOC,EAAA/F,EAAM,QAAN,KAAA+F,EAAe,CAAC,GAAK,EAAG,CAC3C,CACK,CAuEL,CA7FI5B,EADS4P,GACF,mBAuBP5P,EAxBS4P,GAwBF,WAAW,CACd,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,OAAQ,CACJ,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,MAAO,CACH,MAAO,CAAC,GAAK,EAAG,EAChB,OAAQ,aACR,KAAM,MACT,EACD,OAAQ,CACJ,MAAO,WACP,UAAYX,GACKA,EAAM,IAAKA,GAAUT,GAA4BS,CAAK,CAAC,EACxD,OAAO,CAACC,EAAKxW,IAAQwW,EAAI,OAAOxW,CAAG,EAAG,EAAE,EAExD,KAAOmD,GAAUA,EAAM,OAAO,OAC9B,OAAQ,aACR,KAAM,MACT,EACD,MAAO,CACH,MAAO,CAAE,EACT,UAAW,CAACrG,EAAOqG,IAAU,OACzB,MAAMiT,GAAS5O,EAAArE,EAAM,SAAN,KAAAqE,EAAgB,GAC/B,IAAI6O,EAAQvZ,EACZ,MAAM2Z,EAAM3Z,EACZ,GAAIuZ,EAAM,SAAW,GAAMA,GAASA,EAAM,SAAWD,EAAO,OAAS,CACjE,QAASzd,EAAI,EAAGA,EAAIyd,EAAO,OAAQzd,IAC3B0d,EAAM1d,CAAC,GACP8d,EAAI9d,CAAC,EAAI0d,EAAM1d,CAAC,EACZ0d,EAAM1d,EAAI,CAAC,IAAM,QAAa8d,EAAI9d,EAAI,CAAC,IAAM,SAC7C8d,EAAI9d,EAAI,CAAC,EAAI8d,EAAI9d,EAAI,CAAC,GAAK0d,EAAM1d,CAAC,EAAI8d,EAAI9d,EAAI,CAAC,GAAK,IAIxD8d,EAAI9d,CAAC,EAAIA,GAAK,GAAKyd,EAAO,OAAS,IAG3CC,EAAQI,CACX,CACD,OAAOA,CACV,EACD,KAAOtT,GAAUA,EAAM,OAAO,OAC9B,OAAQ,aACR,KAAM,OACT,CACT,GACImE,EA7ES4P,GA6EF,aAAc/T,GAAU,CAC3B,MAAMiT,EAASjT,EAAM,OAAO,QAAU,EACtC,MAAO,uXAQY,OAAAiT,EAAM,iPAMjC,GC1FO,MAAMe,WAA6B9E,EAAa,CAAhD,kCAEH/K,EAAA,YAAO,kBACP,OAAO,cAAe,CAClB,MAAO,gBACV,CACD,OAAO,gBAAgBnE,EAAO,mBAC1B,MAAO,CACH,OAAOqE,EAAArE,EAAM,QAAN,KAAAqE,EAAe,GACtB,UAAUC,EAAAtE,EAAM,WAAN,KAAAsE,EAAkB,GAC5B,QAAQuB,EAAA7F,EAAM,SAAN,KAAA6F,EAAgB,EACxB,OAAOC,EAAA9F,EAAM,QAAN,KAAA8F,EAAe,KAAK,GAAK,EAChC,SAASC,EAAA/F,EAAM,UAAN,KAAA+F,EAAiB,GAC1B,QAAQC,EAAAhG,EAAM,SAAN,KAAAgG,EAAgB,EACxB,OAAOC,EAAAjG,EAAM,QAAN,KAAAiG,EAAe,UAClC,CACK,CAqFL,CApGI9B,EADS6P,GACF,mBAgBP7P,EAjBS6P,GAiBF,WAAW,CACd,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,SAAU,CACN,MAAO,GACP,OAAQ,YACR,KAAM,OACT,EACD,OAAQ,CACJ,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,MAAO,CACH,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,QAAS,CACL,MAAO,EACP,OAAQ,YACR,KAAM,QACN,UAAYra,GACDA,EAAQ,EAAI,CAE1B,EACD,OAAQ,CACJ,MAAO,EACP,OAAQ,YACR,KAAM,OACT,EACD,MAAO,CACH,MAAO,WACP,UAAYoZ,GAASJ,GAA4BI,CAAI,EACrD,OAAQ,aACR,KAAM,MACT,CACT,GACI5O,EA1DS6P,GA0DF,UAAU,CACb,SAAU,kLAQV,QAAS,6JAOjB,GACI7P,EA3ES6P,GA2EF,eAAe,+1BAuBtB7P,EAlGS6P,GAkGF,aAAa,2BCxGjB,MAAMC,EAAkB,CAM3B,aAAc,CALd9P,EAAA,eAAU,IAAI,KACdA,EAAA,sBAAiB,IACjBA,EAAA,sBAAiB,MACjBA,EAAA,0BAAqB,IACrBA,EAAA,iBAEI,KAAK,mBAAmB,gBAAiB+P,EAAa,EACtD,KAAK,mBAAmB,uBAAwBpF,EAAoB,EACpE,KAAK,mBAAmB,mBAAoBsD,EAAgB,EAC5D,KAAK,mBAAmB,gBAAiBD,EAAa,EACtD,KAAK,mBAAmB,YAAaS,EAAS,EAC9C,KAAK,mBAAmB,SAAUE,EAAY,EAC9C,KAAK,mBAAmB,eAAgBa,EAAkB,EAC1D,KAAK,mBAAmB,aAAcC,EAAgB,EACtD,KAAK,mBAAmB,cAAeH,EAAiB,EACxD,KAAK,mBAAmB,YAAaC,EAAe,EACpD,KAAK,mBAAmB,UAAWI,EAAa,EAChD,KAAK,mBAAmB,iBAAkBd,EAAoB,EAC9D,KAAK,mBAAmB,iBAAkBe,EAAoB,EAC9D,KAAK,mBAAmB,YAAaP,EAAe,EACpD,KAAK,mBAAmB,SAAUK,EAAY,EAC9C,KAAK,mBAAmB,SAAUhB,EAAY,EAC9C,KAAK,mBAAmB,iBAAkBmB,EAAoB,CACjE,CACD,mBAAmBG,EAAQC,EAAS,CAChC,KAAK,eAAeD,CAAM,EAAIC,CACjC,CACD,mBAAmBC,EAAYC,EAAa,CACxC,KAAK,mBAAmBD,CAAU,EAAIC,CACzC,CACD,sBAAuB,CACnB,OAAO,KAAK,kBACf,CACD,sBAAuB,CACnB,OAAO,KAAK,cACf,CACD,WAAWH,EAAQnU,EAAO,CACtB,GAAI,CAAC,KAAK,SACN,MAAM,IAAI,MAAM,8BAA8B,EAElD,MAAMuU,EAAc,KAAK,eAAeJ,CAAM,EAC9C,GAAI,CAACI,EACD,MAAM,IAAI,MAAM,gBAAgB,OAAAJ,EAAM,sBAAqB,EAE/D,GAAIA,IAAW,gBACX,OAAO,KAAK,kBAAkBnU,CAAK,EAEvC,MAAMyS,EAAgB8B,EAAY,gBAAgBvU,CAAK,EACjDwU,EAAWD,EAAY,aAAa9B,CAAa,GAAK8B,EAAY,KACxE,GAAIC,GAAY,KAAK,QAAQ,IAAIA,CAAQ,EACrC,MAAO,CACH,OAAQ,KAAK,QAAQ,IAAIA,CAAQ,EACjC,MAAO/B,CACvB,EAGQ,MAAMlG,EAAS,IAAIgI,EAAY,KAAK,SAAUvU,CAAK,EACnD,OAAIwU,GACA,KAAK,QAAQ,IAAIA,EAAUjI,CAAM,EAE9B,CACH,OAAAA,EACA,MAAOkG,CACnB,CACK,CACD,kBAAkBzS,EAAO,CACrB,GAAI,CAAC,KAAK,SACN,MAAM,IAAI,MAAM,8BAA8B,EAElD,MAAMyS,EAAgBN,GAAc,gBAAgBnS,EAAO,KAAK,kBAAkB,EAC5EwU,EAAWrC,GAAc,aAAaM,EAAe,KAAK,kBAAkB,EAClF,GAAI+B,GAAY,KAAK,QAAQ,IAAIA,CAAQ,EACrC,MAAO,CACH,OAAQ,KAAK,QAAQ,IAAIA,CAAQ,EACjC,MAAO/B,CACvB,EAEQ,MAAMlG,EAAS,IAAI4F,GAAc,KAAK,SAAUnS,EAAO,KAAK,kBAAkB,EAC9E,OAAIwU,GACA,KAAK,QAAQ,IAAIA,EAAUjI,CAAM,EAE9B,CACH,OAAQA,EACR,MAAOkG,CACnB,CACK,CACD,UAAUlG,EAAQ,CACV,KAAK,iBAAmBA,IAGxB,KAAK,gBACL,KAAK,eAAe,SAExBA,EAAO,OAAM,EACb,KAAK,eAAiBA,EACzB,CACL,CC/FO,IAAAkI,GAAA,KAAuB,CAAvB,cACHtQ,EAAA,wBAAmB,IAAI,KACvB,kBAAkB2F,EAAW,CACzB,KAAK,iBAAiB,IAAIA,CAAS,CACtC,CACD,oBAAoBA,EAAW,CAC3B,KAAK,iBAAiB,OAAOA,CAAS,CACzC,CACD,OAAOX,EAAI,CACP,KAAK,iBAAiB,QAASW,GAAc,CACzCA,EAAU,OAAOX,CAAE,CAC/B,CAAS,CACJ,CACL,iBCCO9E,GAAA,cAA2BqQ,EAAQ,CAEtC,YAAYrI,EAAWrM,EAAO,CAC1B,MAAMqM,CAAS,EAFnBlI,EAAA,cAGI,KAAK,MAAQE,GAAa,gBAAgBrE,CAAK,CAClD,CACD,MAAM,gBAAiB,CACnB,KAAM,CAAE,IAAA5J,EAAK,iBAAAue,GAAqB,KAAK,MACvC,GAAI,CAACve,EACD,MAAO,CACH,KAAM,IACtB,EAEQ,GAAIA,aAAe,UACf,MAAO,CACH,KAAMA,EACN,iBAAAue,CAChB,EAGQ,MAAMC,EAAO,MADI,MAAM,MAAMxe,CAAG,GACJ,OAC5B,MAAO,CACH,KAAM,MAAM,kBAAkBwe,EAAM,CAChC,iBAAkBD,EAAmB,cAAgB,OACrD,qBAAsB,OACtB,iBAAkB,MAClC,CAAa,CACb,CACK,CACD,OAAO,aAAa3U,EAAO,CACvB,MAAMyS,EAAgBpO,GAAa,gBAAgBrE,CAAK,EAExD,OAAIyS,EAAc,eAAe,UACtB,GAEJ,gBAAgB,OAAAA,EAAc,IAAG,KAAI,OAAAA,EAAc,iBAC7D,CACD,OAAO,gBAAgBzS,EAAO,SAC1B,MAAO,CACH,KAAKqE,EAAArE,EAAM,MAAN,KAAAqE,EAAa,GAClB,kBAAkBC,EAAAtE,EAAM,mBAAN,KAAAsE,EAA0B,EACxD,CACK,CAEL,EADIH,EA3CGE,GA2CI,mBA3CJA,mBCLAA,GAAA,cAA2BqQ,EAAQ,CAEtC,YAAYrI,EAAWrM,EAAO,CAC1B,MAAMqM,CAAS,EAFnBlI,EAAA,cAGI,KAAK,MAAQE,GAAa,gBAAgBrE,CAAK,CAClD,CACD,MAAM,gBAAiB,CACnB,KAAM,CAAE,MAAAjL,EAAO,OAAAC,GAAW,KAAK,MACzB6f,EAAO9f,EAAQC,EAAS,EACxB8f,EAAa,IAAI,kBAAkBD,CAAI,EAC7C,QAASrf,EAAI,EAAGA,EAAIqf,EAAMrf,GAAK,EAAG,CAC9B,MAAMoF,EAAI,KAAK,MAAM,KAAK,OAAM,EAAK,GAAG,EACxCka,EAAWtf,CAAC,EAAIoF,EAChBka,EAAWtf,EAAI,CAAC,EAAIoF,EACpBka,EAAWtf,EAAI,CAAC,EAAIoF,EACpBka,EAAWtf,EAAI,CAAC,EAAI,GACvB,CACD,MAAO,CACH,KAAM,IAAI,UAAUsf,EAAY/f,EAAOC,CAAM,CACzD,CACK,CACD,OAAO,aAAagL,EAAO,CACvB,MAAMyS,EAAgBpO,GAAa,gBAAgBrE,CAAK,EACxD,MAAO,gBAAgB,OAAAyS,EAAc,MAAK,KAAI,OAAAA,EAAc,OAAM,KAAI,OAAAA,EAAc,QACvF,CACD,OAAO,gBAAgBzS,EAAO,WAC1B,MAAO,CACH,OAAOqE,EAAArE,EAAM,QAAN,KAAAqE,EAAe,IACtB,QAAQC,EAAAtE,EAAM,SAAN,KAAAsE,EAAgB,IACxB,SAASuB,EAAA7F,EAAM,UAAN,KAAA6F,EAAiB,CACtC,CACK,CAEL,EADI1B,EAhCGE,GAgCI,mBAhCJA,ICLA,MAAM0Q,EAAmB,CAkB5B,aAAc,CAdd5Q,EAAA,kBAAa,GACbA,EAAA,sBAAiB,IACjBA,EAAA,uBAAkB,IAAI,KACtBA,EAAA,sBAAiB,IAAI,KACrBA,EAAA,uBAAkB,IAAI,SACtBA,EAAA,0BAAqB,IAAI,SAQzBA,EAAA,iBAGI,KAAK,oBAAoB,eAAgB6Q,EAAY,EACrD,KAAK,oBAAoB,eAAgBC,EAAY,EACrD,KAAK,oBAAoB,eAAgBC,EAAY,EACrD,KAAK,oBAAoB,aAAcC,EAAU,CACpD,CACD,oBAAoBtM,EAAauM,EAAc,CAC3C,KAAK,eAAevM,CAAW,EAAIuM,CACtC,CACD,YAAYvM,EAAa7I,EAAOpG,EAAU,KAAM,OAC5C,MAAMyb,EAAe,KAAK,eAAexM,CAAW,EACpD,GAAI,CAACwM,EACD,MAAM,IAAI,MAAM,iBAAiB,OAAAxM,EAAW,sBAAqB,EAErE,IAAInE,EAQJ,IANI9K,GAAA,YAAAA,EAAS,MAAO,QAAa,KAAK,eAAe,IAAIA,EAAQ,EAAE,IAG/D8K,EAAU,KAAK,eAAe,IAAI9K,EAAQ,EAAE,GAG5C,CAAC8K,EAAS,CACV,MAAM4Q,EAAS1b,GAAA,YAAAA,EAAS,GAClB4a,GAAWnQ,EAAAzK,GAAA,YAAAA,EAAS,WAAT,KAAAyK,EAAqBgR,EAAa,aAAarV,CAAK,EACjEwU,GAAY,KAAK,gBAAgB,IAAIA,CAAQ,EAG7C9P,EAAU,KAAK,gBAAgB,IAAI8P,CAAQ,EAI3C9P,EAAU,IAAI2Q,EAAa,KAAMrV,CAAK,EAEtCsV,GACA,KAAK,oBAAoBA,EAAQd,EAAU9P,CAAO,CAEzD,CACD,OAAI9K,GAAA,MAAAA,EAAS,SACK,KAAK,cAAc8K,CAAO,EAClC,KAAI,EAEPA,CACV,CAeD,oBAAoB6Q,EAAef,EAAU9P,EAAS,CAClD,KAAM,CAAE,eAAA8Q,EAAgB,mBAAAC,CAAoB,EAAG,KAC/CD,EAAe,IAAID,EAAe7Q,CAAO,EACrC+Q,EAAmB,IAAI/Q,CAAO,EAE9B+Q,EAAmB,IAAI/Q,CAAO,EAAE,SAGhC+Q,EAAmB,IAAI/Q,EAAS,CAAE,SAAA8P,EAAU,MAAO,CAAC,CAAE,EAClDA,GACA,KAAK,gBAAgB,IAAIA,EAAU9P,CAAO,EAGrD,CAYD,yBAAyB6Q,EAAe,CACpC,KAAM,CAAE,eAAAC,EAAgB,mBAAAC,CAAoB,EAAG,KACzC/Q,EAAU8Q,EAAe,IAAID,CAAa,EAChD,GAAK7Q,IAKL8Q,EAAe,OAAOD,CAAa,EAC/BE,EAAmB,IAAI/Q,CAAO,GAAG,CACjC,MAAMgR,EAAcD,EAAmB,IAAI/Q,CAAO,EAClDE,EAAa8Q,CAAW,EACxBA,EAAY,QACRA,EAAY,QAAU,IACtBD,EAAmB,OAAO/Q,CAAO,EAI7BgR,EAAY,UACZ,KAAK,gBAAgB,OAAOA,EAAY,QAAQ,EAG3D,CACJ,CAMD,cAAe,CASX,MAAO,CACH,aAAc,KAAK,gBAAgB,KACnC,YAAa,KAAK,eAAe,IAC7C,CACK,CAeD,cAAcC,EAAe,CACzB,GAAI,KAAK,gBAAgB,IAAIA,CAAa,EAEtC,OAAO,KAAK,gBAAgB,IAAIA,CAAa,EAEjD,MAAMjR,EAAU,KAAK,SAAS,iBAAiBiR,CAAa,EAC5D,YAAK,gBAAgB,IAAIA,EAAejR,CAAO,EACxCA,CACV,CACL,CC3KO,MAAMkR,EAAc,CAEvB,YAAYC,EAAe,CAD3B1R,EAAA,sBAEI,KAAK,cAAgB0R,CAExB,CACD,YAAYC,EAAM,CAEd,UAAWC,KAAQ,KAAK,cAAe,CACnC,MAAMC,EAAK,KAAK,cAAcD,CAAI,EAC9BC,GAAMA,EAAG,oBAAoBF,CAAI,GACjCE,EAAG,YAAYF,CAAI,CAE1B,CACJ,CAYD,OAAO,gBAAgBG,EAAsBjW,EAAO,CAChD,MAAMkW,EAAa,GAwBnB,OAvBmBD,EAAqB,OAAO,CAACpY,EAAMsY,IAAgB,CAClE,GAAItY,EACA,OAAOA,EAEX,MAAMuY,EAAYD,EAAYnW,EAAM,UAAU,EAC9C,GAAI,CAACoW,EACD,OAEJ,MAAMC,EAAgB,IAAI,IAAID,CAAS,EAKvC,UAAWE,KAAYD,GACfC,EAAS,YAAY,UAAYtW,EAAM,aACvCsW,EAAS,YAAY,QAAUtW,EAAM,WACrCsW,EAAS,YAAY,SAAWtW,EAAM,aACtCqW,EAAc,OAAOC,CAAQ,EAIrC,OAAOD,EAAc,OAAM,EAAG,KAAI,EAAG,KACxC,EAAE,MAAS,GACSH,EAAW,CAAC,CACpC,CACL,CCvDA,MAAMK,GAAuB,CACzB,EAAG,CAACza,EAAOnC,IAAU,CACjBmC,EAAM,MAAM,EAAInC,CACnB,EACD,EAAG,CAACmC,EAAOnC,IAAU,CACjBmC,EAAM,MAAM,EAAInC,CACnB,EACD,MAAO,CAACmC,EAAOnC,IAAU,CACrBmC,EAAM,MAAM,MAAQnC,CACvB,EACD,OAAQ,CAACmC,EAAOnC,IAAU,CACtBmC,EAAM,MAAM,OAASnC,CACxB,EACD,MAAO,CAACmC,EAAOnC,IAAU,CACrBmC,EAAM,MAAM,MAAQnC,CACvB,EACD,OAAQ,CAACmC,EAAOnC,IAAU,CACtBmC,EAAM,MAAM,OAASnC,CACxB,EACD,WAAY,CAACmC,EAAOnC,IAAU,CAC1BmC,EAAM,MAAM,WAAanC,CAC5B,EACD,WAAY,CAACmC,EAAOnC,IAAU,CAC1BmC,EAAM,MAAM,WAAanC,CAC5B,EACD,UAAW,CAACmC,EAAOnC,IAAU,CACzBmC,EAAM,MAAM,UAAYnC,CAC3B,EACD,YAAa,CAACmC,EAAOnC,IAAU,CAC3BmC,EAAM,MAAM,YAAcnC,CAC7B,EACD,SAAU,CAACmC,EAAOnC,IAAU,CACxBmC,EAAM,MAAM,SAAWnC,CAC1B,EACD,KAAM,CAACmC,EAAOnC,IAAU,CACpBmC,EAAM,MAAM,KAAOnC,CACtB,EACD,UAAW,CAACmC,EAAOnC,IAAU,CACzBmC,EAAM,MAAM,UAAYnC,CAC3B,EACD,QAAS,CAACmC,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,CACzB,EACD,QAAS,CAACmC,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,CACzB,EACD,WAAY,CAACmC,EAAOnC,IAAU,CAC1BmC,EAAM,MAAM,WAAanC,CAC5B,EACD,QAAS,CAACmC,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,CACzB,EACD,cAAe,CAACmC,EAAOnC,IAAU,CAC7BmC,EAAM,MAAM,cAAgBnC,CAC/B,EACD,MAAO,CAACmC,EAAOnC,IAAU,CACrBmC,EAAM,MAAM,MAAQnC,CACvB,CACL,EACO,MAAM6c,EAAa,CAGtB,YAAYrK,EAAO,CAFnBhI,EAAA,cACAA,EAAA,YAEI,KAAK,MAAQgI,EACb,MAAMsK,EAAc,CAChB,GAAGF,GACH,GAAG,KAAK,mBAAoB,CACxC,EAGQ,KAAK,IAAM,OAAO,OAAO,OAAO,YAAY,OAAO,QAAQE,CAAW,EAAE,IAAI,CAAC,CAACva,EAAKpC,CAAM,IAC9E,CACHoC,EACA,CAACJ,EAAOnC,IAAU,CACVmC,EAAM,MAAMI,CAAG,IAAMvC,GACrBG,EAAOgC,EAAOnC,CAAK,CAE1B,CACjB,CACS,CAAC,CAAC,CACN,CACD,UAAUmC,EAAO4a,EAAQhb,EAAO,CAExBI,EAAM,SAAW4a,IAGrB5a,EAAM,OAAS4a,EACf5a,EAAM,QAAQ,KAAK4a,EAAQhb,CAAK,EACnC,CAWD,oBAAoBI,EAAO,CACnBA,EAAM,kBAGVA,EAAM,gBAAkB,GACxB,eAAe,IAAM,CACjBA,EAAM,gBAAkB,GACxB,KAAK,YAAYA,CAAK,CAClC,CAAS,EACJ,CACL,CCjGO,MAAM6a,GAAmB,GCEzB,SAASC,GAAmBC,EAAUC,EAASC,EAAeC,EAAeC,EAAcC,EAAWC,EAAO,CAEhH,IAAIC,EAAiB,EACjBH,IACAG,EAAiB,KAAK,IAAI,KAAK,IAAI,KAAK,MAAMH,EAAa,GAAKJ,CAAQ,EAAG,CAAC,EAAGK,EAAU,MAAM,GAInG,MAAMG,EAAS,EACTC,EAASR,EAAUC,EAAgBK,EAAiBJ,EAE1D,GAAI,EAAAG,GAASG,GAAUH,EAAQJ,GAG/B,MAAO,CACH,EAAGM,EACH,EAAGC,EACH,UAAWF,CACnB,CACA,CC7BO,MAAMG,EAAiB,CAI1B,YAAYC,EAAUC,EAAY,EAAG,CAHrCtT,EAAA,iBACAA,EAAA,kBAAa,IACbA,EAAA,mBAEI,KAAK,SAAWqT,EAChB,KAAK,SAAWA,EAChB,KAAK,WAAaC,EAAY,EAC9B,KAAK,WAAa,EACrB,CACD,MAAO,CACH,MAAMC,EAAa,KAAK,WAAW,OAAS,EAEpC,KAAK,WAAW,IAAK,EACvB,KAAK,SAAS,OACpB,OAAIA,EAAW,KACX,KAAK,WAAa,GAGlB,KAAK,aAEFA,CACV,CACD,MAAO,CACH,GAAI,KAAK,WAAW,OAAS,EAIzB,OAAO,KAAK,WAAW,CAAC,EAE5B,MAAMla,EAAS,KAAK,SAAS,KAAI,EACjC,YAAK,WAAW,KAAKA,CAAM,EACpBA,CACV,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CACL,CCrCO,SAAUma,GAAqBC,EAAMxW,EAAQ,EAAG,CACnD,IAAI5L,EAAI4L,EACR,KAAO5L,EAAIoiB,EAAK,QAAQ,CACpB,MAAMC,EAAYD,EAAK,YAAYpiB,CAAC,EACpC,GAAIqiB,IAAc,OACd,MAAM,IAAI,MAAM,4BAA4B,EAEhD,MAAMA,EACNriB,GAAKqiB,GAAa,MAAS,EAAI,CAClC,CACL,CCJO,SAASC,GAAYF,EAAMG,EAAaC,EAAQ,CACnD,MAAMC,EAASD,EAAO,UAAUD,EAAa,IAAIR,GAAiBI,GAAqBC,EAAM,CAAC,EAAG,CAAC,CAAC,EACnG,IAAI7iB,EAAQ,EACZ,UAAWmjB,KAASD,EACZC,EAAM,SACNnjB,GAASmjB,EAAM,UAGvB,OAAOnjB,CACX,CCfO,SAASojB,GAAWC,EAAcf,EAAQC,EAAQM,EAAMS,EAAWtjB,EAAOC,EAAQ6hB,EAAUyB,EAInGC,EAAcC,EAIdtB,EAAWD,EAAcwB,EAAYC,EAAqBC,EAAY,CAClE/T,EAAa6T,EAAY,0BAA0B,EACnD7T,EAAa6T,EAAW,OAAQ,0BAA0B,EAC1D7T,EAAa6T,EAAW,KAAM,0BAA0B,EACxD7T,EAAa6T,EAAW,OAAQ,0BAA0B,EAY1D,MAAMG,EAAmBH,EAAW,KAAK,KAAK,KAIxC1B,EAAgBF,EAAW+B,EAI3BC,EAAU9jB,EAAQgiB,EAIlB+B,EAAiBR,EAAgBvB,EACjCgC,EAAyB7B,EAAUkB,CAAY,EAC/CY,GAAyBD,GAAA,YAAAA,EAAwB,iBAAkB,EACnEE,GAAeF,GAAA,YAAAA,EAAwB,OAAQ,EAC/CG,GAAeH,GAAA,YAAAA,EAAwB,OAAQ,EACrD,IAAII,EAAOF,EACPG,EAAOF,EACPG,EAAOhC,EACPiC,EAAOhC,EACPiC,EAAe,EAInB,MAAMC,EAAW,CACb,eAAgB,GAChB,aAAc,GACd,OAAQ,EAChB,EAEUxB,EAASS,EAAW,OACpBV,EAAc,CAChB,cAAee,CACvB,EAEI,IAAIb,GAASD,EAAO,UAAUD,EAAa,IAAIR,GAAiBI,GAAqBC,EAAMoB,CAAsB,EAAGA,CAAsB,CAAC,EACvIS,GACAC,GAAqB,GACzB,MAAMC,GAAkB,GAClBC,GAAc,MACdC,GAAuB7kB,EAAS+hB,EAChC+C,GAAyBhC,GAAY8B,GAAa7B,EAAaC,CAAM,EAE3E,IAAI+B,GAAY,GAChB,KAAOA,IAAW,CACd,MAAMC,GAAkBxB,IAAY,QAChCG,GACAW,EAAOV,EAAmBA,GAAoBiB,GAC5CI,GAAcD,GACdnB,EACAA,EAAUiB,GAIhB,IAAII,GAAyB,EAG7B,MAAQT,GAAcxB,GAAO,KAAI,IAAO,CAACwB,GAAY,MAAM,CACvD,MAAMvB,EAAQuB,GAAY,MAC1B,GAAIrB,IAAiBlB,EAAU,OAC3BA,EAAU,KAAK,CACX,eAAgBgB,EAAM,QACtB,KAAAkB,EACA,KAAAD,CACpB,CAAiB,UAEIf,EAAelB,EAAU,OAC9B,MAAM,IAAI,MAAM,6BAA6B,EAejD,GAXIgB,EAAM,YAAc,IAAMA,EAAM,YAAc,GAC1CsB,EAAS,iBAAmB,KAC5BA,EAAS,eAAiB,GAC1BU,GAAyBb,GAGxBG,EAAS,iBAAmB,KACjCA,EAAS,eAAiBtB,EAAM,QAChCsB,EAAS,aAAeD,EACxBC,EAAS,OAASU,IAElBhC,EAAM,OAAQ,CAEd,MAAMiC,GAAWd,EAAOnB,EAAM,QAAUA,EAAM,MAE9C,GAEAM,IAAY,QAER2B,IAAYF,IAEZT,EAAS,iBAAmB,IAE5BA,EAAS,eAAiBtB,EAAM,SAEhCsB,EAAS,OAAS,EAIlB,GAAIQ,GAAiB,CACjB/B,GAASD,EAAO,UAAUD,EAAa,IAAIR,GAAiBI,GAAqBC,EAAM4B,EAAS,cAAc,EAAGA,EAAS,cAAc,CAAC,EACzID,EAAeC,EAAS,aACxB,KACH,MAEGvB,GAASD,EAAO,UAAUD,EAAa,IAAIR,GAAiBI,GAAqBiC,GAAa,CAAC,EAAG,CAAC,CAAC,EACpGP,EAAOG,EAAS,OAChBD,EAAeC,EAAS,iBAG3B,CAED,MAAMY,GAAQf,EAAOnB,EAAM,QACrBmC,GAAQf,EAAOpB,EAAM,QACrBoC,GAAuBrD,EACvBqC,EAAOV,GAAoB3B,EAAa,GAAKF,EAC7C,GACAwD,GAA0BtD,EAC1BqC,GAAQrC,EAAa,GAAKF,EAC1B,GAEN,GAAIuD,IAAwBC,GAAyB,CAC7Cb,KAAuB,KACvBA,GAAqBH,GAEzB,MAAMiB,GAAa/B,EAAW,cAAcP,EAAM,OAAO,EAEnD1I,GAAIgL,GAAW,EAAI/B,EAAW,KAAK,OAAO,OAC1C7d,GAAI4f,GAAW,EAAI/B,EAAW,KAAK,OAAO,OAC1CgC,GAAUD,GAAW,MAAQ/B,EAAW,KAAK,OAAO,OACpDiC,GAAWF,GAAW,OAAS/B,EAAW,KAAK,OAAO,OAI5DF,EAAagB,GAAc,EAAIa,GAC/B7B,EAAagB,GAAc,EAAIc,GAC/B9B,EAAagB,GAAc,EAAI/J,GAC/B+I,EAAagB,GAAc,EAAI3e,GAE/B2d,EAAagB,GAAc,EAAIa,GAAQlC,EAAM,MAC7CK,EAAagB,GAAc,EAAIc,GAC/B9B,EAAagB,GAAc,EAAI/J,GAAIiL,GACnClC,EAAagB,GAAc,EAAI3e,GAE/B2d,EAAagB,GAAc,EAAIa,GAC/B7B,EAAagB,GAAc,EAAIc,GAAQnC,EAAM,OAC7CK,EAAagB,GAAc,EAAI/J,GAC/B+I,EAAagB,GAAc,EAAI3e,GAAI8f,GAEnCnC,EAAagB,GAAc,EAAIa,GAAQlC,EAAM,MAC7CK,EAAagB,GAAc,EAAIc,GAAQnC,EAAM,OAC7CK,EAAagB,GAAc,EAAI/J,GAAIiL,GACnClC,EAAagB,GAAc,EAAI3e,GAAI8f,EACtC,CACDtB,EAAO,KAAK,IAAIA,EAAMiB,GAAQnC,EAAM,MAAM,EAC1CmB,GAAQnB,EAAM,SACdiB,EAAO,KAAK,IAAIA,EAAME,CAAI,CAC7B,CACJ,SAIOnB,EAAM,YAAc,GACpB,KAGX,CAEGwB,KAAuB,KACvBC,GAAgB,KAAK,CACjB,YAAaD,GACb,UAAWH,CAC3B,CAAa,EACDG,GAAqB,IAEzBL,EAAO,EACPC,GAAQV,EACRR,IACAoB,EAAS,eAAiB,GAC1BU,GAAyB,GAErB,CAACxB,GACDF,IAAY,QACZvB,GACAqC,EAAOrC,EAAa,GAAKF,GAQpB0C,IAAeA,GAAY,MAI3BjB,IAAY,QAAU,CAACG,GAAc,CAACqB,MAG3CD,GAAY,GAEnB,CAGD,GAAI1B,IAAc,SAAU,CACxB,MAAMsC,GAAcnC,IAAY,OAASW,EAAON,EAChD,QAASrjB,GAAI,EAAGA,GAAImkB,GAAgB,OAAQnkB,KAAK,CAC7C,MAAMolB,GAAOjB,GAAgBnkB,EAAC,EAExBqlB,EAENtC,EAAaqC,GAAK,UAAY,CAAC,EAAIrC,EAAaqC,GAAK,WAAW,EAC1DE,IAAWH,GAAcE,GAAa,EAC5C,QAASha,GAAI+Z,GAAK,YAAa/Z,GAAI+Z,GAAK,UAAW/Z,IAAK,EACpD0X,EAAa1X,EAAC,GAAKia,EAE1B,CACJ,SACQzC,IAAc,QAAS,CAC5B,MAAMsC,GAAcnC,IAAY,OAASW,EAAON,EAChD,QAASrjB,GAAI,EAAGA,GAAImkB,GAAgB,OAAQnkB,KAAK,CAC7C,MAAMolB,GAAOjB,GAAgBnkB,EAAC,EACxBqlB,EAAYD,GAAK,YAAcA,GAAK,YACpC,EAEErC,EAAaqC,GAAK,UAAY,CAAC,EAAIrC,EAAaqC,GAAK,WAAW,EAClEE,GAAUH,GAAcE,EAC9B,QAASha,GAAI+Z,GAAK,YAAa/Z,GAAI+Z,GAAK,UAAW/Z,IAAK,EACpD0X,EAAa1X,EAAC,GAAKia,EAE1B,CACJ,CACDlW,SAAa6U,EAAW,EACjB,CACH,gBAAiBF,EACjB,eAAgBA,EAAe,GAC/B,oBAAqBE,GAAY,KAC3B7B,EAAK,OAASoB,EACdS,GAAY,MAAM,QAAUT,EAAyB,EAC3D,eAAgB,CAAC,CAACS,GAAY,KAC9B,KAAAN,EACA,KAAAC,CACR,CACA,CC/PO,SAAS2B,GAAiBxP,EAAGC,EAAGwP,EAASC,EAAYC,EAAeC,EAAe,CACtF,MAAMC,EAAeH,EAAaC,EAC5BG,EAAKF,EAAc,GAAK5P,EACxB+P,EAAKH,EAAc,GAAK3P,EAC9B,OAAO+P,GAAgBJ,CAAa,EAC9B,CACE,GAAIE,EACJ,GAAIC,EAAKN,EAAUI,EACnB,GAAIC,GAAMF,EAAc,GAAKA,EAAc,IAC3C,GAAIG,EAAKN,GAAWG,EAAc,GAAKA,EAAc,IAAMC,CAC9D,EACC,CACE,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,GAAI,CAChB,CACA,CChBA,MAAMI,GAAmBC,GAAY,EAAG,EAAG,EAAG,CAAC,EAOxC,MAAMC,WAAwBlF,EAAa,CAQ9C,YAAYrK,EAAO,CACf,MAAMA,CAAK,EALfhI,EAAA,wBAAmB,IACnBA,EAAA,wBAAmB,IACnBA,EAAA,kBACAA,EAAA,uBAGI,KAAK,UAAY,KAAK,MAAM,UAAU,WAAW,WAAW,EAAE,OAC9D,KAAK,eAAiB,CAClB,GAAI,EACJ,GAAI,EACJ,GAAI,KAAK,MAAM,QAAQ,SACvB,GAAI,KAAK,MAAM,QAAQ,SACnC,CACK,CAED,oBAAqB,CACjB,MAAO,CACH,WAAY,CAACrI,EAAOnC,IAAU,CAC1BmC,EAAM,MAAM,WAAanC,EACzBmC,EAAM,WAAa,OACnB,KAAK,sBAAsBA,CAAK,CACnC,EACD,WAAY,CAACA,EAAOnC,IAAU,CAC1BmC,EAAM,MAAM,WAAanC,EACzBmC,EAAM,WAAa,OACnB,KAAK,sBAAsBA,CAAK,CACnC,EACD,UAAW,CAACA,EAAOnC,IAAU,CACzBmC,EAAM,MAAM,UAAYnC,EACxBmC,EAAM,WAAa,OACnB,KAAK,sBAAsBA,CAAK,CACnC,EACD,YAAa,CAACA,EAAOnC,IAAU,CAC3BmC,EAAM,MAAM,YAAcnC,EAC1BmC,EAAM,WAAa,OACnB,KAAK,sBAAsBA,CAAK,CACnC,EACD,SAAU,CAACA,EAAOnC,IAAU,CACxBmC,EAAM,MAAM,SAAWnC,EACvB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,KAAM,CAACA,EAAOnC,IAAU,CACpBmC,EAAM,MAAM,KAAOnC,EACnB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,UAAW,CAACA,EAAOnC,IAAU,CACzBmC,EAAM,MAAM,UAAYnC,EACxB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,MAAO,CAACA,EAAOnC,IAAU,CACrBmC,EAAM,MAAM,MAAQnC,CACvB,EACD,EAAG,CAACmC,EAAOnC,IAAU,CACjBmC,EAAM,MAAM,EAAInC,EAChB,KAAK,6BAA6BmC,CAAK,CAC1C,EACD,EAAG,CAACA,EAAOnC,IAAU,CACjBmC,EAAM,MAAM,EAAInC,EAChB,KAAK,6BAA6BmC,CAAK,CAC1C,EACD,QAAS,CAACA,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,EACtB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,MAAO,CAACA,EAAOnC,IAAU,CACrBmC,EAAM,MAAM,MAAQnC,EACpB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,OAAQ,CAACA,EAAOnC,IAAU,CACtBmC,EAAM,MAAM,OAASnC,EACrB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,QAAS,CAACA,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,EACtB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,WAAY,CAACA,EAAOnC,IAAU,CAC1BmC,EAAM,MAAM,WAAanC,EACzB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,QAAS,CAACA,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,EAGtB,KAAK,oBAAoBmC,CAAK,CACjC,EACD,cAAe,CAACA,EAAOnC,IAAU,CAC7BmC,EAAM,MAAM,cAAgBnC,EAC5B,KAAK,sBAAsBmC,CAAK,CACnC,EACD,MAAO,CAACA,EAAOnC,IAAU,CACrBmC,EAAM,MAAM,MAAQnC,CACvB,CACb,CACK,CACD,cAAcqG,EAAO,CAIjB,KAAM,CAAE,WAAA2b,CAAY,EAAG3b,EACvB,OAAQ2b,KAAc,KAAK,kBACvBA,KAAc,KAAK,kBACnBA,IAAe,sBACtB,CACD,oBAAoBrF,EAAU,CAC1B,OAAOA,aAAoBsF,EAC9B,CACD,YAAYtF,EAAU,CAGlB1R,EAAa0R,aAAoBsF,EAAa,EAC9C,MAAMC,EAAavF,EAAS,WACtBH,EAAcG,EAAS,OAAS,OAChC,KAAK,iBACLA,EAAS,OAAS,OACd,KAAK,iBACL,OACV,GAAI,CAACH,EAAa,CACd,QAAQ,KAAK,2BAA2B,OAAAG,EAAS,KAAM,EACvD,MACH,CACD,IAAIwF,EAAU3F,EAAY0F,CAAU,EAC/BC,IACDA,EAAU,IAAI,IACd3F,EAAY0F,CAAU,EAAIC,GAE9BA,EAAQ,IAAIxF,CAAQ,CACvB,CACD,YAAYtW,EAAO,CACf,MAAO,CACH,MAAAA,EACA,OAAQ,eACR,gBAAiB,GACjB,QAAS,IAAI+E,GACb,UAAW,CAAE,EACb,oBAAqB,GACrB,aAAc,OACd,cAAe,CACX,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,MAAO,EACV,EACD,gBAAiB,EACjB,eAAgB,EAChB,aAAc,OACd,aAAc,KACd,eAAgB,GAChB,MAAO,OACP,MAAO,OACP,cAAe,EACf,WAAY,OACZ,UAAW,CACP,YAAa,EACb,YAAa,EACb,wBAAyB,EACzB,UAAW,EACX,QAAS,EACT,UAAW,EACX,WAAY,CACf,CACb,CACK,CACD,YAAYjJ,EAAO,CACf,GAAI,CAAE,WAAA2c,CAAY,EAAG3c,EACrB,KAAM,CAAE,MAAAqb,EAAO,UAAAD,EAAW,UAAA6E,EAAW,oBAAArD,CAAmB,EAAK5c,EAO7D,GANAigB,EAAU,cAENjgB,EAAM,SAAW,gBACjB,KAAK,UAAUA,EAAO,SAAS,EAG/B,CAAC2c,IACDA,EAAa,KAAK,gBAAgB3c,EAAM,KAAK,EAC7CA,EAAM,WAAa2c,EACf,CAACA,GAAY,CACb,MAAMuD,EAAM,6DAA6D,OAAAlgB,EAAM,MAAM,WAAU,KAC/F,QAAQ,MAAMkgB,CAAG,EACjB,KAAK,UAAUlgB,EAAO,SAAU,IAAI,MAAMkgB,CAAG,CAAC,EAC9C,MACH,CAIL,GAAI,CAACvD,EAAW,OAAQ,CACpBA,EAAW,KAAK,SAAU,IAAM,CAC5B,KAAK,oBAAoB3c,CAAK,CAC9C,CAAa,EACD,MACH,CAED8I,EAAa6T,EAAW,KAAM,iCAAiC,EAC/D,KAAM,CAAE,KAAAb,EAAM,SAAAf,EAAU,EAAAtL,EAAG,EAAAC,EAAG,QAAAgN,EAAS,MAAAzjB,EAAO,OAAAC,EAAQ,WAAA2jB,GAAe7c,EAAM,MAErEkf,EAAUxC,IAAY,QAAUG,EAAa7c,EAAM,MAAM,QAAU,EACzE,GAAI,CAAE,aAAAmb,CAAc,EAAGnb,EAEvB,MAAMkb,EAAgByB,EAAW,KAAK,KAAK,KAKrC1B,EAAgBF,EAAWG,EACjClb,EAAM,cACFib,EAAgB0B,EAAW,KAAK,cAAc,cAElD,MAAMwD,EAAerE,EAAK,OAASjB,GACnC,IAAI4B,EAAezc,EAAM,cACrB,CAACyc,GAAgBA,EAAa,OAAS0D,KACvC1D,EAAe,IAAI,aAAa0D,EAAe,CAAC,GAEpD,MAAMd,EAAgBrf,EAAM,cAE5B,GAAI,CAACqf,EAAc,MAAO,CAEtB,MAAMe,EAAgBT,GAAYlQ,EAAGC,EAAGgN,IAAY,OAASjN,EAAIxW,EAAQ,IAAUyjB,IAAY,OAAShN,EAAIxW,EAAS,IAAUwmB,EAAgB,EAI/IW,GAAe,KAAK,eAAgBD,EAAepgB,EAAM,aAAa,EACtEqf,EAAc,MAAQ,EACzB,CAID,GAAI,CAACzC,GAAuBzB,EAAc,CACtC,GAAI1L,EAAI0L,EAAa,IAAMkE,EAAc,IACrC5P,EAAI0L,EAAa,IAAMkE,EAAc,IACrC3P,EAAIwP,EAAU/D,EAAa,IAAMkE,EAAc,IAC/C3P,EAAIwP,EAAU/D,EAAa,IAAMkE,EAAc,GAAI,CACnD,KAAK,UAAUrf,EAAO,QAAQ,EAC9B,MACH,CAEDmb,EAAenb,EAAM,aAAe,OACpC,KAAK,UAAUA,EAAO,SAAS,CAClC,CACD,KAAM,CAAE,QAAAgb,EAAS,UAAAuB,GAAcvc,EAAM,MAErC,GAAI,CAACmb,EAAc,CACf,MAAMmF,EAAsBjB,EAAc,GAAKA,EAAc,GACvDkB,EAAwB,KAAK,KAAKD,EAAsBpF,CAAa,EAC3EC,EAAe8D,GAAiBxP,EAAGC,EAAGwP,EAAShE,EAAeqF,EAAuBlB,CAAa,CACrG,CACD,MAAM/Z,EAAQwV,GAAmBC,EAAUC,EAASC,EAAeC,EAAeC,EAAcC,EAAWC,CAAK,EAChH,GAAI,CAAC/V,EAAO,CAGR,KAAK,UAAUtF,EAAO,QAAQ,EAC9B,MACH,CACD,KAAM,CAAE,cAAAwc,CAAa,EAAKxc,EAAM,MAC1BwgB,EAAOnE,GAAW/W,EAAM,UAAWA,EAAM,EAAGA,EAAM,EAAGwW,EAAMS,EAAWtjB,EAAOC,EAAQ6hB,EAAUyB,EAAeC,EAAcC,EAAStB,EAAWD,EAAcwB,EAAYC,EAAqBC,CAAU,EAC/M7c,EAAM,eAAiB,GACvBA,EAAM,gBAAkBwgB,EAAK,gBAC7BxgB,EAAM,eAAiBwgB,EAAK,eAC5BxgB,EAAM,aAAeyc,EACrBzc,EAAM,aAAemb,EACrB8E,EAAU,wBAA0BO,EAAK,oBACzCP,EAAU,WAAaxD,EAAa,WAEhC+D,EAAK,iBACLxgB,EAAM,MAAQwgB,EAAK,KAAOvF,EAC1Bjb,EAAM,MAAQwgB,EAAK,KAAOvF,GAM9B,KAAK,UAAUjb,EAAO,QAAQ,CACjC,CACD,YAAYA,EAAOygB,EAAWpP,EAAcqP,EAAO,WAC/C,GAAI,CAAC1gB,EAAM,aAEP,OAEkB,YAAY,IAAM,EAExC,KAAM,CAAE,SAAAyR,CAAQ,EAAK,KAAK,MACM,KAAK,MAAM,QAC3C,KAAM,CAAE,SAAAsJ,EAAU,MAAApQ,EAAO,QAAA+R,EAAS,WAAAG,EAAY,OAAArL,EAAQ,MAAAmP,CAAK,EAAK3gB,EAAM,MAEhEkf,EAAUxC,IAAY,QAAUG,EAAa7c,EAAM,MAAM,QAAU,EACnE,CAAE,MAAA4gB,EAAQ,EAAG,MAAAvF,EAAQ,EAAG,cAAAwF,EAAe,aAAApE,EAAc,eAAAqE,EAAgB,WAAAnE,CAAa,EAAG3c,EAC3F,GAAI,CAAE,aAAA+gB,CAAc,EAAG/gB,EACvB,GAAI,CAAC+gB,EAAc,CACf,MAAMhO,EAAKtB,EAAS,GACduP,EAAS,EAAI,aAAa,kBAC1BC,EAAclO,EAAG,eACvBjK,EAAamY,CAAW,EACxBjhB,EAAM,aAAe,IAAIkhB,GAAiB,CACtC,CACI,OAAQD,EACR,WAAY,CACR,WAAY,CACR,KAAM,aACN,KAAM,EACN,KAAMlO,EAAG,MACT,WAAY,GACZ,OAAAiO,EACA,OAAQ,CACX,EACD,oBAAqB,CACjB,KAAM,sBACN,KAAM,EACN,KAAMjO,EAAG,MACT,WAAY,GACZ,OAAAiO,EACA,OAAQ,EAAI,aAAa,iBAC5B,CACJ,CACJ,CACjB,CAAa,EACDhhB,EAAM,eAAiB,GACvB8I,EAAa9I,EAAM,YAAY,EAC/B+gB,EAAe/gB,EAAM,YACxB,CACD,GAAI,CAAC8gB,EAAgB,CACjB,MAAM/N,EAAKtB,EAAS,GACd0P,GAAS5Y,EAAAwY,GAAA,YAAAA,EAAc,UAAU,yBAAxB,KAAAxY,EAAkD,KACjEwK,EAAG,WAAWA,EAAG,aAAcoO,CAAM,EACrCpO,EAAG,WAAWA,EAAG,aAAc0J,EAAc1J,EAAG,WAAW,EAC3D/S,EAAM,eAAiB,EAC1B,CACD8I,EAAa6T,CAAU,EACvB,MAAMyE,EAAW,IAAIC,GAAkB5P,EAAS,GAAIA,EAAS,QAASsP,EAAc,KAAK,UAAW,CAChG,UAAWN,EAAU,KAIrB,MAAOa,GAAgB3W,EAAO+V,CAAK,EACnC,KAAM3F,KAAYvS,EAAAmU,EAAW,OAAX,YAAAnU,EAAiB,KAAK,OAAQ,GAChD,QAAA0W,EACA,cAAA2B,EACA,MAAOF,EAAM,cACzB,EAAWD,EAAOrP,EAAc,CAAE,OAAQgK,EAAO,MAAOuF,CAAO,EAAE,EAAGpP,CAAM,EAC5D5I,GAAUmB,EAAA/J,EAAM,aAAN,YAAA+J,EAAkB,QAClCjB,EAAaF,CAAO,EACpB,MAAM2Y,EAAa,KAAK,MAAM,UAAU,cAAc3Y,CAAO,EAC7DwY,EAAS,WAAWG,CAAU,EAC9BH,EAAS,OAASphB,EAAM,gBACxBohB,EAAS,SAAWphB,EAAM,eAC1ByR,EAAS,YAAY2P,CAAQ,CA8DhC,CAED,gBAAgBld,EAAO,CACnB,OAAO4V,GAAc,gBAAgB,CAAC,KAAK,iBAAkB,KAAK,gBAAgB,EAAG5V,CAAK,CAC7F,CAOD,6BAA6BlE,EAAO,CAChCA,EAAM,cAAc,MAAQ,GAC5B,KAAK,oBAAoBA,CAAK,CACjC,CAUD,sBAAsBA,EAAO,CACzBA,EAAM,cAAc,MAAQ,GAC5BA,EAAM,aAAe,OACrBA,EAAM,MAAQ,OACdA,EAAM,MAAQ,OACdA,EAAM,UAAY,GAClB,KAAK,UAAUA,EAAO,SAAS,EAC/B,KAAK,oBAAoBA,CAAK,CACjC,CACL,CCldA,MAAMwhB,GAAwB,KACvB,MAAMC,EAA6B,CAKtC,YAAY7X,EAAQpH,EAAS,CAJ7B6F,EAAA,gBACAA,EAAA,iBACAA,EAAA,kBACAA,EAAA,mBAEI,KAAK,QAAUuB,EACf,KAAK,SAAWpH,EAChB,KAAK,UAAY,KAAK,cAAc,CAAE,EACzC,CACD,IAAI,SAAS1D,EAAG,CACZ,KAAK,UAAY,KAAK,cAAcA,CAAC,CACxC,CACD,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CACD,cAAe,CACX,OAAO,KAAK,UAAU,SACzB,CACD,mBAAoB,CAChB,KAAK,SAAS,KAAO,KAAK,gBAAe,EACzC,KAAK,SAAS,aAAe,KAAK,UAAU,YAC/C,CACD,iBAAkB,CACd,MAAM4iB,EAAK,CAAC,KAAK,UAAU,QAAQ,EAC7BC,EAAM,GACZ,QAAS,EAAI,EAAG3d,EAAI0d,EAAG,OAAQ,EAAI1d,EAAG,IAC9B0d,EAAG,CAAC,IAAM,SAAWA,EAAG,CAAC,IAAM,aAC/BC,EAAI,KAAKD,EAAG,CAAC,CAAC,EAGdC,EAAI,KAAK,IAAI,OAAAD,EAAG,CAAC,EAAC,IAAG,EAG7B,MAAO,GAAG,YAAK,UAAU,UAAS,KAAI,YAAK,UAAU,SAAW,KAAK,aAAc,SAAM,OAAAC,EAAI,KAAK,GAAG,EACxG,CACD,OAAQ,CACJ,GAAY,SAAS,MAAO,CACxB,MAAMC,EAAc,KAAK,kBACzB,GAAI,CACA,GAAI,CAAC,SAAS,MAAM,MAAMA,EAAa,KAAK,UAAU,IAAI,EAEtD,OAAO,SAAS,MACX,KAAKA,EAAa,KAAK,UAAU,IAAI,EACrC,MAAOthB,GAAQ,CAEhB,QAAQ,KAAK,8BAA+BA,EAAKshB,CAAW,CACpF,CAAqB,EACI,KAAK,IAAM,CACP,SAAS,MAAM,MAAMA,EAAa,KAAK,UAAU,IAAI,GACtD,QAAQ,KAAK,6BAA8BA,CAAW,CAElF,CAAqB,CAER,OACM,EAAG,CACN,QAAQ,KAAK,4CAA8CA,CAAW,CACzE,CACJ,CACJ,CACD,qBAAsB,CAClB,MAAMC,EAAa,GACbC,EAAY,KAAK,eACjBC,EAAc,KAAK,UAAU,YAAcD,EAC3CE,EAAe,KAAK,UAAU,aAAeF,EAC7C/G,EAAW,KAAK,UAAU,SAAW+G,EAC3C,IAAI9G,EAAU,KAAK,UAAU,UAAY,KACnC,KACA,KAAK,UAAU,QAAU8G,EAC3B3C,GAAc,KAAK,UAAU,YAAcpE,GAAY+G,EAC3D,MAAMG,EAAI,KAAK,UAAU,EAAIH,EACvBI,EAAI,KAAK,UAAU,EAAIJ,EAC7B,IAAIK,EAAgB,KAAK,UAAU,cAAgBL,EACnD,MAAMM,EAAQ,KAAK,UAAU,MAAQN,EAC/BO,EAAQ,KAAK,UAAU,MAAQP,EAC/BQ,EAAQ,KAAK,UAAU,MAAQR,EAC/BS,EAAQ,KAAK,UAAU,MAAQT,EAC/BtF,GAAiB,KAAK,UAAU,eAAiB,GAAKsF,EACtDU,EAAa,KAAK,UAAU,WAAaV,EAE/C,KAAK,kBAAiB,EAEtB,IAAI7oB,EAAQgpB,GAAK,KAAO,KAAK,aAAY,EAErCQ,EAAaxpB,EAAQ8oB,EASzB,GARIU,EAAa,KACbxpB,GAAS,GAAKwpB,EACdA,EAAa,IAEZN,IACDA,EAAgBM,GAGhB,KAAK,UAAU,cAAgB,CAAC,KAAK,UAAU,SAAU,CACzD,IAAIC,EACJ,OAAQ,KAAK,UAAU,aAAY,CAC/B,IAAK,OACDA,EAAS,GACT,MACJ,IAAK,WACDA,EAAS,KAAK,UAAU,eACxB,MACJ,QACIA,EAAS,KAAK,UAAU,YAC/B,CACD,KAAK,UAAU,KAAO,KAAK,SAAS,KAAK,UAAU,KAAMP,EAAgBK,EAAYE,CAAM,CAC9F,CAGD,IAAIC,EACJ,GAAI,KAAK,UAAU,SACfA,EAAY,KAAK,SAAS,KAAK,UAAU,KAAMR,EAAe3F,EAAegG,CAAU,MAEtF,CACDG,EAAY,CAAE,EAAG,KAAK,UAAU,KAAK,MAAM,gBAAgB,EAAG,EAAG,IACjE,MAAM3e,EAAI2e,EAAU,EAAE,OACtB,QAASjpB,EAAI,EAAGA,EAAIsK,EAAI,EAAGtK,IACvBipB,EAAU,EAAE,KAAKjpB,CAAC,CAEzB,CACD,IAAIkpB,EAAQD,EAAU,EACtB,GAAI,KAAK,UAAU,UAAYC,EAAM,OAAS,KAAK,UAAU,SAAU,CACnE,MAAMC,EAAYD,EAAM,MAAM,EAAG,KAAK,UAAU,QAAQ,EACxD,IAAIE,EAAa,KACjB,GAAI,KAAK,UAAU,eAAgB,CAE/B,MAAMb,EAAI,KAAK,UAAU,eACnB,KAAK,YAAY,KAAK,UAAU,cAAc,EAC9C,EACAc,EAAK,KAAK,SAASF,EAAUA,EAAU,OAAS,CAAC,EAAGV,EAAgBF,EAAGzF,EAAegG,CAAU,EACtGK,EAAUA,EAAU,OAAS,CAAC,EAAI,GAAG,OAAAE,EAAG,EAAE,CAAC,GAAI,YAAK,UAAU,gBAC9DD,EAAa,CAACC,EAAG,EAAE,OAAS,EAAIA,EAAG,EAAE,CAAC,EAAI,EAAE,CAC/C,MAEGD,EAAa,CAAC,EAAE,EAGpB,IAAIppB,EACJ,MAAMsK,EAAI4e,EAAM,OAChB,IAAI7d,EAAI,EACR,MAAMoQ,EAAIwN,EAAU,EAAE,OACtB,IAAKjpB,EAAI,KAAK,UAAU,SAAUA,EAAIsK,EAAGtK,IACrCopB,EAAW/d,CAAC,GAAK,GAAG,OAAA+d,EAAW/d,CAAC,EAAI,IAAM,IAAK,OAAA6d,EAAMlpB,CAAC,GAClDA,EAAI,EAAIyb,GAAKwN,EAAU,EAAEjpB,EAAI,CAAC,GAC9BqL,IAGR8c,EAAW,cAAgBiB,EAAW,KAAK,IAAI,EAC/CjB,EAAW,cAAgB,GAC3Be,EAAQC,CACX,MAEGhB,EAAW,cAAgB,GAC3BA,EAAW,cAAgB,GAG/B,IAAImB,EAAe,EACnB,MAAMC,EAAa,GACnB,QAASvpB,EAAI,EAAGA,EAAIkpB,EAAM,OAAQlpB,IAAK,CACnC,MAAMqlB,EAAY,KAAK,YAAY6D,EAAMlpB,CAAC,EAAG8iB,CAAa,GAAK9iB,IAAM,EAAI8oB,EAAa,GACtFS,EAAW,KAAKlE,CAAS,EACzBiE,EAAe,KAAK,IAAIA,EAAcjE,CAAS,CAClD,CACD8C,EAAW,WAAaoB,EACnBhB,IAEDhpB,EAAQ+pB,EAAejB,EAAcC,EACrCS,EAAaO,GAGjB7D,EAAaA,GAAcpE,EAC3B,IAAI7hB,EACJ,GAAIgpB,EACAhpB,EAASgpB,MAER,CACD,MAAMgB,EAAiB,KAAK,UAAU,cAAgB,SAAW,GAAMnI,EAAW,EAClF7hB,EACIimB,GAAcyD,EAAM,OAAS,GACzBM,EACA,KAAK,IAAI/D,EAAYpE,CAAQ,GAC5BC,GAAW,EACvB,CACD,OAAIA,IAAY,OACZA,EAAUD,GAEd8G,EAAW,EAAI5oB,EACf4oB,EAAW,EAAI3oB,EACf2oB,EAAW,MAAQe,EACnBf,EAAW,UAAYC,EAClB7oB,IAEDA,EAAQ,GAEPC,IAEDA,EAAS,IAETkpB,GAASC,KACTppB,EAAQ,KAAK,IAAIA,EAAOopB,EAAQD,CAAK,IAErCE,GAASC,KACTrpB,EAAS,KAAK,IAAIA,EAAQqpB,EAAQD,CAAK,GAE3CT,EAAW,MAAQ5oB,EACnB4oB,EAAW,WAAaY,EACxBZ,EAAW,OAAS3oB,EACpB2oB,EAAW,SAAW9G,EACtB8G,EAAW,MAAQO,EACnBP,EAAW,MAAQS,EACnBT,EAAW,MAAQQ,EACnBR,EAAW,MAAQU,EACnBV,EAAW,WAAa1C,EACxB0C,EAAW,WAAaoB,EACxBpB,EAAW,QAAU7G,EACrB6G,EAAW,YAAcE,EACzBF,EAAW,aAAeG,EAC1BH,EAAW,cAAgBrF,EAC3BqF,EAAW,WAAaW,EACjBX,CACV,CACD,KAAKA,EAAYsB,EAAe,CAC5B,MAAMrB,EAAY,KAAK,eAEjBc,GAAQO,GAAA,YAAAA,EAAe,QAAStB,EAAW,MAC3CoB,GAAaE,GAAA,YAAAA,EAAe,aAActB,EAAW,WACrD3oB,EAASiqB,EACTA,EAAc,MAAM,OAAStB,EAAW,WACxCA,EAAW,OAEjB,KAAK,QAAQ,MAAQ,KAAK,IAAI,KAAK,KAAKA,EAAW,MAAQ,KAAK,UAAU,qBAAqB,EAAGL,EAAqB,EACvH,KAAK,QAAQ,OAAS,KAAK,IAAI,KAAK,KAAKtoB,CAAM,EAAGsoB,EAAqB,EAEvE,KAAK,kBAAiB,EAClBK,EAAW,UAAY,MAEvB,KAAK,SAAS,YAAc,IAC5B,KAAK,SAAS,SAAS,EAAG,EAAG,IAAM,GAAI,EACvC,KAAK,SAAS,YAAc,IAE5BA,EAAW,OAASA,EAAW,QAC/B,KAAK,SAAS,UAAU,CAACA,EAAW,MAAO,CAACA,EAAW,KAAK,EAEhE,IAAIuB,EACAC,EACJ,MAAMC,EAAY,GAElB,QAAS5pB,EAAI,EAAGsK,EAAI4e,EAAM,OAAQlpB,EAAIsK,EAAGtK,IACrC0pB,EAAgB1pB,IAAM,EAAImoB,EAAW,WAAa,EAElDwB,EAAgB3pB,EAAImoB,EAAW,WAAaA,EAAW,QACnD,KAAK,UAAU,eAAiB,SAChCwB,IAAkBxB,EAAW,WAAaA,EAAW,UAAY,EAE5D,KAAK,UAAU,eAAiB,WACrCwB,GAAiBxB,EAAW,WAAaA,EAAW,UAEpD,KAAK,UAAU,YAAc,QAC7BuB,GAAiBvB,EAAW,WAAaoB,EAAWvpB,CAAC,EAEhD,KAAK,UAAU,YAAc,WAClC0pB,IAAkBvB,EAAW,WAAaoB,EAAWvpB,CAAC,GAAK,GAE/D0pB,GAAiBvB,EAAW,YAC5ByB,EAAU,KAAK,CACX,KAAMV,EAAMlpB,CAAC,EACb,EAAG0pB,EACH,EAAGC,EACH,EAAGJ,EAAWvpB,CAAC,CAC/B,CAAa,EAGL,GAAI,KAAK,UAAU,UAAW,CAC1B,MAAMiR,EAAQ,KAAK,UAAU,eACvB4Y,EAAW,KAAK,UAAU,gBAAkBzB,GAAaD,EAAW,SAAW,IAC/E2B,EAAS,KAAK,UAAU,gBAAkB1B,EAC1C2B,EAAgB,KAAK,UAAU,uBAAyB,KACxD,KAAK,UAAU,qBAAuB3B,EACtCD,EAAW,YACX6B,EAAiB,KAAK,UAAU,wBAA0B,KAC1D,KAAK,UAAU,sBAAwB5B,EACvCD,EAAW,aACjB,KAAK,SAAS,UAAY8B,GAAchZ,CAAK,EAC7C,QAASjR,EAAI,EAAGA,EAAI4pB,EAAU,OAAQ5pB,IAAK,CACvC,MAAMkqB,EAAWN,EAAU5pB,CAAC,EAC5B,KAAK,SAAS,SAASkqB,EAAS,EAAIH,EAAeG,EAAS,EAAI/B,EAAW,QAAU2B,EAAQI,EAAS,EAAIF,EAAiBD,EAAeF,CAAQ,CACrJ,CACJ,CAED,IAAIM,EAAqB,KACrB,KAAK,UAAU,SACfA,EAAqB,CACjB,KAAK,SAAS,YACd,KAAK,SAAS,cACd,KAAK,SAAS,cACd,KAAK,SAAS,UAC9B,EACY,KAAK,SAAS,YAAcF,GAAc,KAAK,UAAU,WAAW,EACpE,KAAK,SAAS,cAAgB,KAAK,UAAU,cAAgB7B,EAC7D,KAAK,SAAS,cAAgB,KAAK,UAAU,cAAgBA,EAC7D,KAAK,SAAS,WAAa,KAAK,UAAU,WAAaA,GAE3D,KAAK,SAAS,UAAY6B,GAAc,KAAK,UAAU,SAAS,EAChE,QAASjqB,EAAI,EAAGsK,EAAIsf,EAAU,OAAQ5pB,EAAIsK,EAAGtK,IAAK,CAC9C,MAAMkqB,EAAWN,EAAU5pB,CAAC,EAC5B,GAAImoB,EAAW,gBAAkB,EAC7B,KAAK,SAAS,SAAS+B,EAAS,KAAMA,EAAS,EAAGA,EAAS,CAAC,MAE3D,CACD,MAAME,EAAYF,EAAS,KAAK,MAAM,EAAE,EACxC,IAAInU,EAAImU,EAAS,EACjB,QAASlqB,EAAI,EAAGqL,EAAI+e,EAAU,OAAQpqB,EAAIqL,EAAGrL,IACzC,KAAK,SAAS,SAASoqB,EAAUpqB,CAAC,EAAG+V,EAAGmU,EAAS,CAAC,EAClDnU,GAAK,KAAK,YAAYqU,EAAUpqB,CAAC,EAAGmoB,EAAW,aAAa,CAEnE,CACJ,CACGgC,IACA,KAAK,SAAS,YAAcA,EAAmB,CAAC,EAChD,KAAK,SAAS,cAAgBA,EAAmB,CAAC,EAClD,KAAK,SAAS,cAAgBA,EAAmB,CAAC,EAClD,KAAK,SAAS,WAAaA,EAAmB,CAAC,IAE/ChC,EAAW,OAASA,EAAW,QAC/B,KAAK,SAAS,UAAUA,EAAW,MAAOA,EAAW,KAAK,EAE9D,KAAK,WAAaA,CACrB,CACD,SAASkC,EAAM5B,EAAeO,EAAQ,CAClC,MAAMsB,EAAc,KAAK,SAAS,YAAYtB,CAAM,EAAE,MAChDuB,EAAUF,EAAK,OACfG,EAAY,KAAK,SAAS,YAAYH,CAAI,EAAE,MAElD,GAAIG,GAAa/B,EACb,OAAO4B,EAGX,IAAII,EAAc,KAAK,MAAOhC,EAAgB8B,EAAWC,CAAS,EAC9DE,EAAiB,KAAK,SAAS,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAE,MAC3EH,EAEJ,GAAII,EAAiBjC,EACjB,KAAOgC,EAAc,IACjBC,EACI,KAAK,SAAS,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAE,MACtDH,EACJI,EAAiBjC,IACjBgC,GAAe,MASvB,MAAOA,EAAcF,GAIjB,GAHAG,EACI,KAAK,SAAS,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAE,MACtDH,EACJI,EAAiBjC,EACjBgC,GAAe,MAEd,CAEDA,GAAe,EACf,KACH,CAIT,OAAQJ,EAAK,UAAU,EAAGI,CAAW,GAChChC,GAAiB6B,EAActB,EAAS,GAChD,CAKD,SAAS5G,EAAMqG,EAAe3F,EAAe6H,EAAS,EAAG,CAGrD,MAAMzB,EAAQ9G,EAAK,MAAM,QAAQ,EACjC,IAAIwI,EAAW,GACf,MAAMC,EAAe,GACrB,QAAS7qB,EAAI,EAAGA,EAAIkpB,EAAM,OAAQlpB,IAAK,CACnC,MAAM8qB,EAAc,GACpB,IAAI9iB,EAAS,GACT+iB,EAAYtC,EAAgBkC,EAChC,MAAMK,EAAQ9B,EAAMlpB,CAAC,EAAE,MAAM,GAAG,EAChC,QAASqL,EAAI,EAAGA,EAAI2f,EAAM,OAAQ3f,IAAK,CACnC,MAAMmf,EAAY,KAAK,YAAYQ,EAAM3f,CAAC,EAAGyX,CAAa,EACpDmI,EAAqBT,EAAY,KAAK,YAAY,IAAK1H,CAAa,EACtEzX,IAAM,GAAK4f,EAAqBF,GAG5B1f,EAAI,IACJyf,EAAY,KAAK9iB,CAAM,EACvBA,EAAS,IAEbA,GAAUgjB,EAAM3f,CAAC,EACjB0f,EAAYtC,EAAgB+B,GAAanf,IAAM,EAAIsf,EAAS,KAG5DI,GAAaE,EACbjjB,GAAU,IAAI,OAAAgjB,EAAM3f,CAAC,GAE5B,CACDyf,EAAY,KAAK9iB,CAAM,EACvBA,EAAS,GACT4iB,EAAWA,EAAS,OAAOE,CAAW,EAClC9qB,EAAIkpB,EAAM,OAAS,GACnB2B,EAAa,KAAKD,EAAS,MAAM,CAExC,CACD,MAAO,CAAE,EAAGA,EAAU,EAAGC,CAAY,CACxC,CACD,YAAYR,EAAMa,EAAQ,EAAG,CACzB,OAAKA,EAGEb,EAAK,MAAM,EAAE,EAAE,OAAO,CAACxM,EAAKsN,IACxBtN,EAAM,KAAK,SAAS,YAAYsN,CAAI,EAAE,MAAQD,EACtD,CAAC,EAJO,KAAK,SAAS,YAAYb,CAAI,EAAE,KAK9C,CACD,cAAc7a,EAAU,CACpB,MAAO,CACH,KAAM,GACN,EAAG,EACH,EAAG,EACH,UAAW,SACX,SAAU,GACV,SAAU,KACV,SAAU,GACV,cAAe,EACf,UAAW,GACX,aAAc,GACd,WAAY,KACZ,aAAc,aACd,UAAW,OACX,cAAe,MACf,QAAS,KACT,SAAU,EACV,eAAgB,KAChB,UAAW,CAAC,EAAK,EAAK,EAAK,CAAG,EAC9B,YAAa,EACb,aAAc,EACd,OAAQ,GACR,YAAa,CAAC,EAAK,EAAK,EAAK,CAAG,EAChC,cAAe,EACf,cAAe,EACf,WAAY,EACZ,UAAW,GACX,gBAAiB,EACjB,eAAgB,CAAC,EAAK,EAAK,EAAK,CAAG,EACnC,gBAAiB,EACjB,qBAAsB,EACtB,sBAAuB,EACvB,cAAe,EACf,WAAY,EACZ,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,iBAAkB,GAClB,kBAAmB,EACnB,UAAW,EACX,sBAAuB,EACvB,GAAGA,CACf,CACK,CACL,CCndA,MAAM4b,GAAiB,OAAO,KAAS,IAAc,WAAa,YAIlE,MAAMC,KAAiBxc,GAAAuc,GAAe,WAAf,YAAAvc,GAAyB,QAC5Cuc,GAAe,MACnB,SAASE,GAAiB9gB,EAAO,CAC7B,KAAM,CAAE,WAAA2b,EAAY,UAAAoF,EAAW,WAAAC,EAAY,YAAAC,EAAa,SAAApK,CAAU,EAAG7W,EACrE,MAAO,CAAC+gB,EAAWC,EAAYC,EAAa,GAAG,OAAApK,EAAQ,MAAM8E,CAAU,EAAE,KAAK,GAAG,CACrF,CAQA,MAAMH,GAAmBC,GAAY,EAAG,EAAG,EAAG,CAAC,EACxC,MAAMyF,WAA2B1K,EAAa,CAIjD,YAAYrK,EAAO,CACf,MAAMA,CAAK,EAJfhI,EAAA,eACAA,EAAA,gBACAA,EAAA,uBAGQ,OAAO,gBAAoB,IAC3B,KAAK,OAAS,IAAI,gBAAgB,EAAG,CAAC,EAGtC,KAAK,OAAS,SAAS,cAAc,QAAQ,EAGjD,IAAI7F,EAAU,KAAK,OAAO,WAAW,IAAI,EACpCA,IAID,KAAK,OAAS,SAAS,cAAc,QAAQ,EAC7CA,EAAU,KAAK,OAAO,WAAW,IAAI,GAEzCsG,EAAatG,CAAO,EACpB,KAAK,QAAUA,EACf,KAAK,eAAiB,CAClB,GAAI,EACJ,GAAI,EACJ,GAAI,KAAK,MAAM,QAAQ,SACvB,GAAI,KAAK,MAAM,QAAQ,SACnC,CACK,CAED,oBAAqB,CACjB,MAAO,CACH,WAAY,CAACxC,EAAOnC,IAAU,CAC1BmC,EAAM,MAAM,WAAanC,EACzBmC,EAAM,SAAW,OACjB,KAAK,sBAAsBA,CAAK,CACnC,EACD,WAAY,CAACA,EAAOnC,IAAU,CAC1BmC,EAAM,MAAM,WAAanC,EACzBmC,EAAM,SAAW,OACjB,KAAK,sBAAsBA,CAAK,CACnC,EACD,UAAW,CAACA,EAAOnC,IAAU,CACzBmC,EAAM,MAAM,UAAYnC,EACxBmC,EAAM,SAAW,OACjB,KAAK,sBAAsBA,CAAK,CACnC,EACD,YAAa,CAACA,EAAOnC,IAAU,CAC3BmC,EAAM,MAAM,YAAcnC,EAC1BmC,EAAM,SAAW,OACjB,KAAK,sBAAsBA,CAAK,CACnC,EACD,SAAU,CAACA,EAAOnC,IAAU,CACxBmC,EAAM,MAAM,SAAWnC,EACvBmC,EAAM,SAAW,OACjB,KAAK,sBAAsBA,CAAK,CACnC,EACD,KAAM,CAACA,EAAOnC,IAAU,CACpBmC,EAAM,MAAM,KAAOnC,EACnB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,UAAW,CAACA,EAAOnC,IAAU,CACzBmC,EAAM,MAAM,UAAYnC,EACxB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,MAAO,CAACA,EAAOnC,IAAU,CACrBmC,EAAM,MAAM,MAAQnC,EACpB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,EAAG,CAACA,EAAOnC,IAAU,CACjBmC,EAAM,MAAM,EAAInC,EAChB,KAAK,6BAA6BmC,CAAK,CAC1C,EACD,EAAG,CAACA,EAAOnC,IAAU,CACjBmC,EAAM,MAAM,EAAInC,EAChB,KAAK,6BAA6BmC,CAAK,CAC1C,EACD,QAAS,CAACA,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,EACtB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,MAAO,CAACA,EAAOnC,IAAU,CACrBmC,EAAM,MAAM,MAAQnC,EACpB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,OAAQ,CAACA,EAAOnC,IAAU,CACtBmC,EAAM,MAAM,OAASnC,EACrB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,QAAS,CAACA,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,EACtB,KAAK,sBAAsBmC,CAAK,CACnC,EACD,QAAS,CAACA,EAAOnC,IAAU,CACvBmC,EAAM,MAAM,QAAUnC,CACzB,EACD,cAAe,CAACmC,EAAOnC,IAAU,CAC7BmC,EAAM,MAAM,cAAgBnC,EAC5B,KAAK,sBAAsBmC,CAAK,CACnC,CAIb,CACK,CAED,cAAckE,EAAO,CAIjB,MAAO,EACV,CACD,oBAAoBsW,EAAU,CAC1B,OAAOA,aAAoB6K,EAC9B,CACD,YAAY7K,EAAU,CAGlB1R,EAAa0R,aAAoB6K,EAAa,EAI9CN,GAAc,IAAIvK,EAAS,QAAQ,CACtC,CACD,YAAYtW,EAAO,CACf,MAAO,CACH,MAAAA,EACA,OAAQ,eACR,gBAAiB,GACjB,QAAS,IAAI+E,GACb,YAAa,OACb,uBAAwB,IAAIwY,GAA6B,KAAK,OAAQ,KAAK,OAAO,EAClF,aAAc,OACd,cAAe,CACX,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,MAAO,EACV,EACD,WAAY,OACZ,oBAAqB,GACrB,MAAO,EACP,MAAO,EACP,SAAU,OACV,sBAAuB,OACvB,UAAW,CACP,YAAa,EACb,YAAa,EACb,UAAW,EACX,wBAAyB,EACzB,UAAW,EACX,QAAS,EACT,WAAY,CACf,CACb,CACK,CACD,YAAYzhB,EAAO,CAMf,GAJIA,EAAM,SAAW,gBACjB,KAAK,UAAUA,EAAO,SAAS,EAG/B,CAACA,EAAM,SAAU,CACjB,MAAMslB,EAAYN,GAAiBhlB,EAAM,KAAK,EAO9C,GANAA,EAAM,SAAW,CACb,UAAWslB,EAEX,OAAQ,EACxB,EAEgB,CAACtlB,EAAM,SAAS,OAAQ,CACxB+kB,GACK,KAAKO,CAAS,EACd,KAAK,KAAK,aAAa,KAAK,KAAMtlB,EAAOslB,CAAS,CAAC,EACnD,MAAM,KAAK,gBAAgB,KAAK,KAAMtlB,EAAOslB,CAAS,CAAC,EAC5D,MACH,CACJ,CAED,GAAI,CAACtlB,EAAM,SAAS,OAChB,OAECA,EAAM,aACPA,EAAM,uBAAuB,SAAW,CACpC,KAAMA,EAAM,MAAM,KAClB,UAAWA,EAAM,MAAM,UACvB,SAAUA,EAAM,MAAM,WACtB,SAAUA,EAAM,MAAM,SACtB,UAAW,CACPA,EAAM,MAAM,YACZA,EAAM,MAAM,UACZA,EAAM,MAAM,UAChC,EAAkB,KAAK,GAAG,EACV,UAAW6W,GAA4B7W,EAAM,MAAM,KAAK,EACxD,QAASA,EAAM,MAAM,SAAWA,EAAM,MAAM,QAC5C,SAAUA,EAAM,MAAM,UAAY,OAClC,cAAeA,EAAM,MAAM,UAAY,OAAS,OAAYA,EAAM,MAAM,MACxE,cAAeA,EAAM,MAAM,aAC3C,EAEYA,EAAM,WAAaA,EAAM,uBAAuB,oBAAmB,EAMnEA,EAAM,MAAQA,EAAM,WAAW,WAAaA,EAAM,WAAW,MAAM,OACnEA,EAAM,MAAQA,EAAM,WAAW,MAE/BA,EAAM,aAAe,QAEzB,KAAM,CAAE,EAAAyP,EAAG,EAAAC,EAAG,MAAAzW,EAAO,OAAAC,EAAQ,QAAAgmB,EAAS,QAAAxC,CAAO,EAAK1c,EAAM,MAClD,CAAE,cAAAqf,CAAe,EAAGrf,EAC1B,GAAI,CAAE,aAAAmb,EAAc,YAAAoK,CAAa,EAAGvlB,EACpC,GAAI,CAACqf,EAAc,MAAO,CAEtB,MAAMe,EAAgBT,GAAYlQ,EAAGC,EAAGgN,IAAY,OAASjN,EAAIxW,EAAQ,IAAUyjB,IAAY,OAAShN,EAAIxW,EAAS,IAAUwmB,EAAgB,EAI/IW,GAAe,KAAK,eAAgBD,EAAef,CAAa,EAChEA,EAAc,MAAQ,EACzB,CACD,MAAMiB,EAAsBjB,EAAc,GAAKA,EAAc,GACvDkB,EAAwB,KAAK,KAAKD,EAAsBtgB,EAAM,WAAW,UAAU,EACzF,GAAIsgB,IAAwB,EAAG,CAG3BiF,EAAc,OACdpK,EAAe,OACf,KAAK,UAAUnb,EAAO,QAAQ,EAC9B,MACH,SACQmb,GAAgBoK,EAAa,CAGlC,MAAMC,EAAuB/V,EAAI0L,EAAa,GACxCsK,EAAuB/V,EAAIwP,EAAU/D,EAAa,GAClDuK,EAAuBjW,EAAI0L,EAAa,GACxCwK,EAAuBjW,EAAIwP,EAAU/D,EAAa,GACxD,GAAIqK,GAAwBnG,EAAc,IACtCqG,GAAwBrG,EAAc,IACtCoG,GAAwBpG,EAAc,IACtCsG,GAAwBtG,EAAc,GAAI,CAC1C,KAAK,UAAUrf,EAAO,QAAQ,EAC9B,MACH,CACG2lB,EAAuBtG,EAAc,IAErClE,EAAa,IAAMoF,EAAwBvgB,EAAM,WAAW,WAC5Dmb,EAAa,IAAMoF,EAAwBvgB,EAAM,WAAW,WAE5DulB,EAAY,KAAKA,EAAY,MAAO,GACpCA,EAAY,CAAC,EAAE,aACXA,EAAY,CAAC,EAAE,aAAehF,EAClCgF,EAAY,CAAC,EAAE,WACXA,EAAY,CAAC,EAAE,aAAehF,EAClCgF,EAAY,CAAC,EAAE,MAAQ,IAElBE,EAAuBpG,EAAc,KAE1ClE,EAAa,IAAMoF,EAAwBvgB,EAAM,WAAW,WAC5Dmb,EAAa,IAAMoF,EAAwBvgB,EAAM,WAAW,WAE5DulB,EAAY,QAAQA,EAAY,IAAK,GACrCA,EAAY,CAAC,EAAE,aACXA,EAAY,CAAC,EAAE,aAAehF,EAClCgF,EAAY,CAAC,EAAE,WACXA,EAAY,CAAC,EAAE,aAAehF,EAClCgF,EAAY,CAAC,EAAE,MAAQ,GAE9B,KACI,CACD,MAAMK,EAAa5lB,EAAM,WAAW,WAAaugB,EAC3CsF,EAAa,KAAK,KAAK3G,EAAU0G,CAAU,EAC3CE,EAAiBD,EAAatF,EAC9BwF,EAAiBD,EAAiBvF,EAClCyF,EAAiBF,EAAiBvF,EAGxCgF,EAAc,CACV,CACI,QAASA,GAAA,YAAAA,EAAc,GAAG,QAC1B,aAAcQ,EACd,WAAYA,EAAiBxF,EAC7B,MAAO,EACV,EACD,CACI,QAASgF,GAAA,YAAAA,EAAc,GAAG,QAC1B,aAAcO,EACd,WAAYA,EAAiBvF,EAC7B,MAAO,EACV,EACD,CACI,QAASgF,GAAA,YAAAA,EAAc,GAAG,QAC1B,aAAcS,EACd,WAAYA,EAAiBzF,EAC7B,MAAO,EACV,CACjB,EACYvgB,EAAM,YAAculB,EACpB,MAAMU,EAAqBJ,EAAaD,EACxCzK,EAAe,CACX,GAAI,EACJ,GAAI8K,EAAqBL,EACzB,GAAI3sB,EACJ,GAAIgtB,EAAqBL,EAAa,CACtD,CACS,CACD5lB,EAAM,aAAemb,EACA,YAAY,IAAM,EACvC,UAAW+K,KAAYX,EACnB,GAAI,CAAAW,EAAS,MAEb,IAAIA,EAAS,aAAe,EAAG,CAC3BA,EAAS,QAAU,KAAK,MAAM,UAAU,YAAY,eAAgB,CAChE,IAAK,EACzB,CAAiB,EACDA,EAAS,MAAQ,GACjB,QACH,CACDlmB,EAAM,uBAAuB,KAAKA,EAAM,WAAY,CAChD,MAAOA,EAAM,WAAW,MAAM,MAAMkmB,EAAS,aAAcA,EAAS,UAAU,EAC9E,WAAYlmB,EAAM,WAAW,WAAW,MAAMkmB,EAAS,aAAcA,EAAS,UAAU,CACxG,CAAa,EACK,KAAK,OAAO,QAAU,GAAK,KAAK,OAAO,SAAW,IACpDA,EAAS,QAAU,KAAK,MAAM,UAAU,YAAY,eAAgB,CAChE,IAAK,KAAK,QAAQ,aAAa,EAAG,EAAG,KAAK,OAAO,MAAO,KAAK,OAAO,MAAM,CAC9F,EAAmB,CACC,QAAS,EAC7B,CAAiB,GAELA,EAAS,MAAQ,GAIrB,KAAK,UAAUlmB,EAAO,QAAQ,CACjC,CACD,YAAYA,EAAOygB,EAAWpP,EAAcqP,EAAO,iCAC/C,KAAM,CAAE,MAAArQ,CAAO,EAAG,KACZ,CAAE,YAAAkV,EAAa,MAAA3E,EAAQ,EAAG,MAAAvF,EAAQ,EAAG,aAAAF,CAAc,EAAGnb,EAC5D,GAAI,CAACulB,GAAe,CAACpK,EACjB,OACJ,KAAM,CAAE,EAAA1L,EAAG,EAAAC,EAAG,QAAAwP,EAAS,QAAAxC,EAAS,MAAAzjB,EAAO,OAAAC,CAAM,EAAiB8G,EAAM,MAC9DmmB,EAAc,CAChB,EAAG1W,EACH,EAAGC,EACH,MAAOgN,IAAY,OAASzjB,EAAQ2nB,EACpC,OAAQlE,IAAY,OAASxjB,EAASmiB,CAClD,EAC4B/J,GAAc,CAC9B,EAAG,EACH,EAAG,EACH,MAAOjB,EAAM,QAAQ,SACrB,OAAQA,EAAM,QAAQ,SACzB,EAAE8V,CAAW,EASdrd,EAAayc,EAAa,4BAA4B,EACtDzc,EAAaqS,EAAc,6BAA6B,EAExD,MAAMiL,GADqBjL,EAAa,GAAKA,EAAa,IACpB,EAChC,CAAE,OAAA3J,EAAQ,MAAA7G,GAAU3K,EAAM,MAG1BqmB,EAAgB3F,EAAQ4F,GAA4B3b,CAAK,EACzD4b,EAAYrV,GAA6B,WAAYmV,CAAa,EACpEd,EAAY,CAAC,EAAE,OACf,KAAK,MAAM,SAAS,QAAQ,CACxB,MAAOc,EACP,aAAAhV,EACA,QAASkV,EACT,QAASA,EACT,QAASA,EACT,QAASA,EACT,QAAO/d,GAAAD,EAAAgd,EAAY,CAAC,EAAE,UAAf,YAAAhd,EAAwB,aAAxB,YAAAC,EAAoC,QAAS,EACpD,SAAQwB,GAAAD,EAAAwb,EAAY,CAAC,EAAE,UAAf,YAAAxb,EAAwB,aAAxB,YAAAC,EAAoC,SAAU,EACtD,QAASub,EAAY,CAAC,EAAE,QACxB,eAAgB,CAAE,EAClB,OAAQ,KACR,YAAa,KACb,OAAA/T,EACA,GAAIiP,EAAU,GACd,GAAIA,EAAU,GAAKvB,EAAU/D,EAAa,GAC1C,GAAIsF,EAAU,GACd,GAAIA,EAAU,GACd,GAAIA,EAAU,GACd,GAAIA,EAAU,EAC9B,CAAa,EAED8E,EAAY,CAAC,EAAE,OACf,KAAK,MAAM,SAAS,QAAQ,CACxB,MAAOc,EACP,aAAAhV,EACA,QAASkV,EACT,QAASA,EACT,QAASA,EACT,QAASA,EACT,QAAOrc,GAAAD,EAAAsb,EAAY,CAAC,EAAE,UAAf,YAAAtb,EAAwB,aAAxB,YAAAC,EAAoC,QAAS,EACpD,SAAQE,GAAAD,EAAAob,EAAY,CAAC,EAAE,UAAf,YAAApb,EAAwB,aAAxB,YAAAC,EAAoC,SAAU,EACtD,QAASmb,EAAY,CAAC,EAAE,QACxB,eAAgB,CAAE,EAClB,OAAQ,KACR,YAAa,KACb,OAAA/T,EACA,GAAIiP,EAAU,GACd,GAAIA,EAAU,GAAKvB,EAAU/D,EAAa,GAAKiL,EAC/C,GAAI3F,EAAU,GACd,GAAIA,EAAU,GACd,GAAIA,EAAU,GACd,GAAIA,EAAU,EAC9B,CAAa,EAED8E,EAAY,CAAC,EAAE,OACf,KAAK,MAAM,SAAS,QAAQ,CACxB,MAAOc,EACP,aAAAhV,EACA,QAASkV,EACT,QAASA,EACT,QAASA,EACT,QAASA,EACT,QAAOjc,IAAAD,GAAAkb,EAAY,CAAC,EAAE,UAAf,YAAAlb,GAAwB,aAAxB,YAAAC,GAAoC,QAAS,EACpD,SAAQE,IAAAD,GAAAgb,EAAY,CAAC,EAAE,UAAf,YAAAhb,GAAwB,aAAxB,YAAAC,GAAoC,SAAU,EACtD,QAAS+a,EAAY,CAAC,EAAE,QACxB,eAAgB,CAAE,EAClB,OAAQ,KACR,YAAa,KACb,OAAA/T,EACA,GAAIiP,EAAU,GACd,GAAIA,EAAU,GAAKvB,EAAU/D,EAAa,GAAKiL,EAAWA,EAC1D,GAAI3F,EAAU,GACd,GAAIA,EAAU,GACd,GAAIA,EAAU,GACd,GAAIA,EAAU,EAC9B,CAAa,CA8BR,CAQD,6BAA6BzgB,EAAO,CAChCA,EAAM,cAAc,MAAQ,GAC5B,KAAK,UAAUA,EAAO,SAAS,EAC/B,KAAK,oBAAoBA,CAAK,CACjC,CAUD,sBAAsBA,EAAO,CACzBA,EAAM,WAAa,OACnB,KAAK,UAAUA,EAAO,SAAS,EAC/B,KAAK,oBAAoBA,CAAK,CACjC,CACD,aAAaA,EAAOslB,EAAW,OACvBA,MAAc/c,EAAAvI,EAAM,WAAN,YAAAuI,EAAgB,YAAa,CAACvI,EAAM,WAGtDA,EAAM,SAAS,OAAS,GACxB,KAAK,oBAAoBA,CAAK,EACjC,CACD,gBAAgBA,EAAOslB,EAAW1lB,EAAO,OACjC0lB,MAAc/c,EAAAvI,EAAM,WAAN,YAAAuI,EAAgB,YAAa,CAACvI,EAAM,WAKtDA,EAAM,SAAS,OAAS,GACxB,QAAQ,MAAM,2CAA2C,OAAAA,EAAM,SAAS,UAAS,KAAKJ,CAAK,EAC3F,KAAK,oBAAoBI,CAAK,EACjC,CACL,CCjhBA,MAAMwmB,GAAe,WAEd,cAAoBvd,EAAa,CAoBpC,YAAYnL,EAAS,CACjB,QApBJuK,EAAA,gBAEAA,EAAA,yBACAA,EAAA,kBACAA,EAAA,oBACAA,EAAA,sBACAA,EAAA,kBACAA,EAAA,iBACAA,EAAA,aAEAA,EAAA,iBAAY,GACZA,EAAA,qBAAgB,GAChBA,EAAA,wBAAmB,GACnBA,EAAA,oBAAe,GACfA,EAAA,sBAAiB,GACjBA,EAAA,uBAAkB,IAMd,KAAK,QAAUvK,EACf,KAAM,CAAE,OAAA8L,EAAQ,WAAA6c,EAAY,OAAAC,EAAQ,MAAA/F,EAAO,SAAAtX,EAAU,UAAAC,CAAW,EAAGxL,EACnE,KAAK,UAAY,IAAImb,GACrB,KAAK,UAAY,IAAId,GACrB,KAAK,iBAAmB,IAAIwO,GACxBhG,GAAA,MAAAA,EAAO,qBACP,YAAY,IAAM,CACd7X,EAAa,KAAK,SAAS,EAC3B,MAAM8d,EAAY,KAAK,UAAU,aAAY,EAC7C,QAAQ,IAAI,0BAA2BA,EAAU,WAAW,EAC5D,QAAQ,IAAI,2BAA4BA,EAAU,YAAY,CACjE,EAAE,GAAI,EAEX,KAAK,SAAW,IAAIC,GAAkB,CAClC,MAAO,KACP,OAAAjd,EACA,WAAY9L,EAAQ,yBAA2BA,EAAQ,wBACvD,WAAY2oB,GAAA,KAAAA,EAAc,WAC1B,aAAAD,GACA,UAAW,KAAK,UAChB,UAAW,KAAK,SAC5B,CAAS,EAED,KAAK,UAAU,SAAW,KAAK,SAC/B,KAAK,cAAgB,CACjB,OAAQ,IAAIpB,GAAmB,IAAI,EACnC,IAAK,IAAIxF,GAAgB,IAAI,CACzC,EACQ,KAAK,YAAc,IAAI9F,GAAc,KAAK,aAAa,EAEvD,MAAMgN,EAAW,IAAI1W,GAAS,KAAM,CAChC,GAAIsW,EACJ,EAAG,EACH,EAAG,EACH,MAAOrd,EACP,OAAQC,EACR,MAAO,EACP,SAAU,GACV,MAAO,EACP,SAAU,EACV,YAAa,EACb,UAAW,EACX,WAAY,EACZ,QAAS,EACT,QAAS,EACT,QAAS,EACT,QAAS,EACT,OAAQ,EACR,aAAc,EACd,OAAQ,EACR,OAAQ,EACR,OAAQ,EACR,OAAQ,EACR,MAAO,EACP,MAAO,GACP,OAAQ,GACR,OAAQ,GACR,SAAU,EACV,OAAQ,KACR,QAAS,KACT,eAAgB,KAChB,OAAQ,KACR,YAAa,IACzB,CAAS,EACD,KAAK,KAAOwd,EAGRpU,GAAU,IAAI,CAErB,CAID,kBAAmB,CACf,KAAM,CAAE,iBAAAqU,CAAkB,EAAG,KACxB,KAAK,OAGV,KAAK,cAAgB,KAAK,iBAC1B,KAAK,iBAAmBnU,KACxB,KAAK,UAAa,KAAK,cAEjB,KAAK,iBAAmB,KAAK,cAD7B,IAAM,EAGZmU,EAAiB,OAAO,KAAK,SAAS,EACzC,CAID,iBAAkB,CACd,MAAO,CAAC,CAAC,KAAK,KAAK,YAAc,KAAK,eACzC,CAID,WAAY,CACR,KAAM,CAAE,SAAAtV,EAAU,gBAAAuV,CAAiB,EAAG,KAElC,KAAK,KAAK,aAAe,GACzB,KAAK,KAAK,OAAO,KAAK,SAAS,EAGnCvV,GAAA,MAAAA,EAAU,QACV,KAAK,SAAS,KAAK,IAAI,EACvBA,GAAA,MAAAA,EAAU,SAENuV,IACA,KAAK,gBAAkB,IAI3B,KAAM,CAAE,kBAAAC,CAAiB,EAAK,KAAK,QACnC,GAAIA,IACA,KAAK,eACL,KAAK,gBAAkB,KAAK,UACxB,KAAK,gBAAkBA,GAAmB,CAC1C,MAAMnd,EAAM,KAAK,MAAO,KAAK,aAAe,IAAQ,KAAK,cAAc,EACvE,KAAK,aAAe,EACpB,KAAK,eAAiB,EACtB,KAAK,KAAK,YAAaA,CAAG,CAC7B,CAER,CACD,SAAShJ,EAAM,CACXgI,EAAa,KAAK,UAAYhI,EAAK,eAAe,EAC9CA,EAAK,cACLA,EAAK,YAAY,KAAK,QAAQ,EAElC,QAAS,EAAI,EAAG,EAAIA,EAAK,SAAS,OAAQ,IAAK,CAC3C,MAAMiH,EAAQjH,EAAK,SAAS,CAAC,EACxBiH,IAGDA,GAAA,YAAAA,EAAO,cAAe,GAG1B,KAAK,SAASA,CAAK,CACtB,CACJ,CAID,eAAgB,CACZ,KAAK,gBAAkB,EAC1B,CAWD,oBAAoBmf,EAASC,EAAuB,KAAM,CACtD,IAAIC,EAAaD,EACbE,EAAmB,GAEvB,GAAID,EAAY,CACZ,MAAME,EAAmB,KAAK,cAAcF,CAAU,EACjDE,EAKKA,EAAiB,cAAcJ,CAAO,IAC5C,QAAQ,KAAK,sCAAsC,OAAAE,EAAU,cAAcF,CAAO,EAClFE,EAAa,KACbC,EAAmB,KAPnB,QAAQ,KAAK,2BAA2B,OAAAD,EAAU,eAAc,EAChEA,EAAa,KACbC,EAAmB,GAO1B,CACD,GAAI,CAACD,EAAY,CAEb,SAAW,CAACnN,EAAMC,CAAE,IAAK,OAAO,QAAQ,KAAK,aAAa,EACtD,GAAID,IAAS,UAITC,EAAG,cAAcgN,CAAO,EAAG,CAC3BE,EAAanN,EACb,KACH,CAEAmN,IAEDA,EAAa,SAEpB,CACGC,GACA,QAAQ,KAAK,iCAAiC,cAAOD,CAAU,EAAG,EAGtE,MAAMG,EAAuB,KAAK,cAAcH,CAAU,EAC1Dte,SAAaye,EAAsB,gCAAgC,EAG5DA,CACV,CACL,ECxOO,MAAMC,WAAqBpX,EAAS,CAIvC,YAAYC,EAAOnM,EAAO,CACtB,MAAMmM,EAAOnM,CAAK,EAJtBmE,EAAA,qBACAA,EAAA,gBACAA,EAAA,6BAAwB,MA4BxBA,EAAA,oBAAe,IAAM,CACjB,KAAM,CAAE,QAAAqU,CAAS,EAAG,KACd+K,EAAW,KAAK,QAAQ,MAAM,MAC9BC,EAAY,KAAK,QAAQ,MAAM,OAC/BC,EAAY,KAAK,QAAQ,OAAS,EAClCC,EAAa,KAAK,QAAQ,OAAS,EACrClL,IAAY,QACZ,KAAK,MAAM,MAAQ+K,EACnB,KAAK,MAAM,OAASC,GAEfhL,IAAY,SACjB,KAAK,MAAM,MAAQ+K,EACnB,KAAK,MAAM,OAASG,GAEflL,IAAY,SACjB,KAAK,MAAM,MAAQiL,EACnB,KAAK,MAAM,OAASC,GAExB,KAAK,qBAAoB,EAGzB,KAAK,MAAM,gBACX,KAAK,KAAK,SAAU,CAChB,KAAM,OACN,WAAY,CACR,MAAO,KAAK,QAAQ,OAAS,EAC7B,OAAQ,KAAK,QAAQ,OAAS,CACjC,CACb,CAAS,CACT,GACIvf,EAAA,oBAAe,CAAC1B,EAAQ/G,IAAU,CAC9B,KAAK,KAAK,SAAU,CAChB,KAAM,OACN,MAAAA,CACZ,CAAS,CACT,GA5DQ,KAAK,sBAAwBsE,EAAM,qBACnC,KAAM,CAAE,qBAAAqjB,EAAsB,kBAAAM,GAAsB,KAAK,4BAA4B,CACjF,EAAG,KAAK,KACR,EAAG,KAAK,KACR,MAAO3jB,EAAM,MACb,OAAQA,EAAM,OACd,UAAWA,EAAM,UACjB,MAAOA,EAAM,MACb,OAAQA,EAAM,OACd,QAASA,EAAM,QACf,WAAYA,EAAM,WAClB,QAASA,EAAM,QACf,QAASA,EAAM,QACf,cAAeA,EAAM,cACrB,MAAOA,EAAM,MACb,WAAYA,EAAM,WAClB,SAAUA,EAAM,SAChB,YAAaA,EAAM,YACnB,UAAWA,EAAM,UACjB,WAAYA,EAAM,WAClB,KAAMA,EAAM,IACf,EAAE,MAAS,EACZ,KAAK,aAAeqjB,EACpB,KAAK,QAAUM,CAClB,CAqCD,IAAI,OAAQ,CACR,OAAO,KAAK,QAAQ,MAAM,KAC7B,CACD,IAAI,MAAMhqB,EAAO,CACb,KAAK,aAAa,IAAI,MAAM,KAAK,QAASA,CAAK,CAClD,CACD,IAAI,QAAS,CACT,OAAO,KAAK,QAAQ,MAAM,MAC7B,CACD,IAAI,OAAOA,EAAO,CACd,KAAK,aAAa,IAAI,OAAO,KAAK,QAASA,CAAK,CACnD,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,QAAQ,MAAM,KAC7B,CACD,IAAI,MAAMA,EAAO,CACb,KAAK,aAAa,IAAI,MAAM,KAAK,QAASA,CAAK,CAClD,CACD,IAAI,MAAO,CACP,OAAO,KAAK,QAAQ,MAAM,IAC7B,CACD,IAAI,KAAKA,EAAO,CACZ,KAAK,aAAa,IAAI,KAAK,KAAK,QAASA,CAAK,EAC9C,KAAK,kBAAiB,CACzB,CACD,IAAI,sBAAuB,CACvB,OAAO,KAAK,qBACf,CACD,IAAI,qBAAqBA,EAAO,CAC5B,KAAK,sBAAwBA,EAC7B,KAAM,CAAE,qBAAA0pB,EAAsB,kBAAAM,CAAmB,EAAG,KAAK,4BAA4B,KAAK,QAAQ,MAAO,KAAK,OAAO,EACrH,KAAK,aAAeN,EACpB,KAAK,QAAUM,CAClB,CACD,IAAI,UAAW,CACX,OAAO,KAAK,QAAQ,MAAM,QAC7B,CACD,IAAI,SAAShqB,EAAO,CAChB,KAAK,aAAa,IAAI,SAAS,KAAK,QAASA,CAAK,CACrD,CACD,IAAI,YAAa,CACb,OAAO,KAAK,QAAQ,MAAM,UAC7B,CACD,IAAI,WAAWA,EAAO,CAClB,KAAK,aAAa,IAAI,WAAW,KAAK,QAASA,CAAK,CACvD,CACD,IAAI,aAAc,CACd,OAAO,KAAK,QAAQ,MAAM,WAC7B,CACD,IAAI,YAAYA,EAAO,CACnB,KAAK,aAAa,IAAI,YAAY,KAAK,QAASA,CAAK,CACxD,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,QAAQ,MAAM,SAC7B,CACD,IAAI,UAAUA,EAAO,CACjB,KAAK,aAAa,IAAI,UAAU,KAAK,QAASA,CAAK,CACtD,CACD,IAAI,YAAa,CACb,OAAO,KAAK,QAAQ,MAAM,UAC7B,CACD,IAAI,WAAWA,EAAO,CAClB,KAAK,aAAa,IAAI,WAAW,KAAK,QAASA,CAAK,CACvD,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,QAAQ,MAAM,SAC7B,CACD,IAAI,UAAUA,EAAO,CACjB,KAAK,aAAa,IAAI,UAAU,KAAK,QAASA,CAAK,CACtD,CACD,IAAI,SAAU,CACV,OAAO,KAAK,QAAQ,MAAM,OAC7B,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,aAAa,IAAI,QAAQ,KAAK,QAASA,CAAK,CACpD,CACD,IAAI,YAAa,CACb,OAAO,KAAK,QAAQ,MAAM,UAC7B,CACD,IAAI,WAAWA,EAAO,CAClB,KAAK,aAAa,IAAI,WAAW,KAAK,QAASA,CAAK,CACvD,CACD,IAAI,SAAU,CACV,OAAO,KAAK,QAAQ,MAAM,OAC7B,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,aAAa,IAAI,QAAQ,KAAK,QAASA,CAAK,CACpD,CACD,IAAI,SAAU,CACV,OAAO,KAAK,QAAQ,MAAM,OAC7B,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,aAAa,IAAI,QAAQ,KAAK,QAASA,CAAK,CACpD,CACD,IAAI,eAAgB,CAChB,OAAO,KAAK,QAAQ,MAAM,aAC7B,CACD,IAAI,cAAcA,EAAO,CACrB,KAAK,aAAa,IAAI,cAAc,KAAK,QAASA,CAAK,CAC1D,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,QAAQ,MAAM,KAC7B,CACD,IAAI,MAAMA,EAAO,CACb,KAAK,aAAa,IAAI,MAAM,KAAK,QAASA,CAAK,CAClD,CACD,OAAOkT,EAAOC,EAAqB,KAAM,CACrC,MAAM,OAAOD,EAAOC,CAAkB,EACtClI,EAAa,KAAK,eAAe,EAEjC,KAAK,aAAa,IAAI,EAAE,KAAK,QAAS,KAAK,gBAAgB,EAAE,EAC7D,KAAK,aAAa,IAAI,EAAE,KAAK,QAAS,KAAK,gBAAgB,EAAE,CAChE,CACD,mBAAoB,CAChB,OAAI,MAAM,oBACC,GAEP,KAAK,QAAQ,MAAM,OAAS,GACpB,KAAK,aAAe,GAExB,KAAK,aAAe,EAC/B,CACD,YAAY2I,EAAU,CAClB3I,EAAa,KAAK,eAAe,EACjC,KAAK,aAAa,YAAY,KAAK,QAAS,KAAK,gBAAiB,KAAK,aAAc,KAAK,UAAU,CACvG,CAMD,4BAA4B5E,EAAO4jB,EAAW,CAC1C,MAAMP,EAAuB,KAAK,MAAM,oBAAoBrjB,EAAO,KAAK,qBAAqB,EACvF2jB,EAAoBN,EAAqB,YAAYrjB,CAAK,EAEhE,OAAI4jB,GADgB,CAAC,UAAW,SAAU,QAAQ,EAGlC,QAASC,GAAc,CAC/BD,EAAU,QAAQ,IAAIC,CAAS,CAC/C,CAAa,EAELF,EAAkB,QAAQ,GAAG,SAAU,KAAK,YAAY,EACxDA,EAAkB,QAAQ,GAAG,SAAU,KAAK,YAAY,EACxDN,EAAqB,oBAAoBM,CAAiB,EACnD,CACH,qBAAAN,EACA,kBAAAM,CACZ,CACK,CACL,CCxNO,MAAMG,WAAyB3V,EAAa,CAC/C,YAAYnO,EAAOoO,EAAcjC,EAAO,CACpC,MAAMnM,EAAOoO,EAAcjC,EAAO,IAAImX,GAAanX,EAAO,CACtD,GAAI+B,GAAU,EACd,EAAGlO,EAAM,EACT,EAAGA,EAAM,EACT,MAAOA,EAAM,MACb,OAAQA,EAAM,OACd,MAAOA,EAAM,MACb,SAAUA,EAAM,SAChB,MAAOA,EAAM,MACb,SAAUA,EAAM,SAChB,YAAaA,EAAM,YACnB,UAAWA,EAAM,UACjB,WAAYA,EAAM,WAClB,QAASA,EAAM,QACf,QAASA,EAAM,QACf,QAASA,EAAM,QACf,QAASA,EAAM,QACf,OAAQA,EAAM,OACd,aAAcA,EAAM,aACpB,OAAQA,EAAM,OACd,OAAQA,EAAM,OACd,OAAQA,EAAM,OACd,OAAQA,EAAM,OACd,MAAOA,EAAM,MACb,MAAOA,EAAM,MACb,OAAQA,EAAM,OACd,OAAQA,EAAM,OACd,SAAUA,EAAM,SAEhB,KAAMA,EAAM,KACZ,SAAUA,EAAM,SAChB,WAAYA,EAAM,WAClB,WAAYA,EAAM,WAClB,YAAaA,EAAM,YACnB,UAAWA,EAAM,UACjB,QAASA,EAAM,QACf,WAAYA,EAAM,WAClB,cAAeA,EAAM,cACrB,UAAWA,EAAM,UACjB,QAASA,EAAM,QACf,QAASA,EAAM,QACf,qBAAsBA,EAAM,qBAC5B,MAAOA,EAAM,MAEb,OAAQ,KACR,QAAS,KACT,eAAgB,KAChB,OAAQ,KACR,YAAa,IAChB,EAAC,CACL,CACD,IAAI,MAAO,CACP,OAAO,KAAK,SAAS,IACxB,CACD,IAAI,KAAKrG,EAAO,CACZ,KAAK,SAAS,KAAOA,CACxB,CACD,IAAI,sBAAuB,CACvB,OAAO,KAAK,SAAS,oBACxB,CACD,IAAI,qBAAqBA,EAAO,CAC5B,KAAK,SAAS,qBAAuBA,CACxC,CACD,IAAI,UAAW,CACX,OAAO,KAAK,SAAS,QACxB,CACD,IAAI,SAASA,EAAO,CAChB,KAAK,SAAS,SAAWA,CAC5B,CACD,IAAI,YAAa,CACb,OAAO,KAAK,SAAS,UACxB,CACD,IAAI,WAAWA,EAAO,CAClB,KAAK,SAAS,WAAaA,CAC9B,CACD,IAAI,YAAa,CACb,OAAO,KAAK,SAAS,UACxB,CACD,IAAI,WAAWA,EAAO,CAClB,KAAK,SAAS,WAAaA,CAC9B,CACD,IAAI,aAAc,CACd,OAAO,KAAK,SAAS,WACxB,CACD,IAAI,YAAYA,EAAO,CACnB,KAAK,SAAS,YAAcA,CAC/B,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,SAAS,SACxB,CACD,IAAI,UAAUA,EAAO,CACjB,KAAK,SAAS,UAAYA,CAC7B,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,SAAS,SACxB,CACD,IAAI,UAAUA,EAAO,CACjB,KAAK,SAAS,UAAYA,CAC7B,CACD,IAAI,SAAU,CACV,OAAO,KAAK,SAAS,OACxB,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,SAAS,QAAUA,CAC3B,CACD,IAAI,YAAa,CACb,OAAO,KAAK,SAAS,UACxB,CACD,IAAI,WAAWA,EAAO,CAClB,KAAK,SAAS,WAAaA,CAC9B,CACD,IAAI,SAAU,CACV,OAAO,KAAK,SAAS,OACxB,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,SAAS,QAAUA,CAC3B,CACD,IAAI,SAAU,CACV,OAAO,KAAK,SAAS,OACxB,CACD,IAAI,QAAQA,EAAO,CACf,KAAK,SAAS,QAAUA,CAC3B,CACD,IAAI,eAAgB,CAChB,OAAO,KAAK,SAAS,aACxB,CACD,IAAI,cAAcA,EAAO,CACrB,KAAK,SAAS,cAAgBA,CACjC,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,SAAS,KACxB,CACD,IAAI,MAAMA,EAAO,CACb,KAAK,SAAS,MAAQA,CACzB,CACL,24BCtJO,SAASoqB,GAA0BC,EAAO,CAC7C,OAAOA,EAAM,qBAAqBC,EACtC,CACO,eAAeC,GAAkBC,EAAqBhY,EAAO,CAChE,IAAIiY,EACJ,GAAI,CACA,QAAQ,IAAI,yBAA0BD,CAAmB,EACzDC,EAAU,MAAMC,GAAA,WAAOF,GAAsC,mBAChE,OACM1vB,EAAG,CACN,QAAQ,MAAM,iCAAiC,OAAA0vB,EAAmB,yBAAwB,EAC1F,QAAQ,MAAM1vB,CAAC,EACf,MACH,CACD,GAAI,CAAC2vB,EAAO,QAAS,CACjB,QAAQ,MAAM,iCAAiC,OAAAD,EAAmB,oCAAmC,EACrG,MACH,CACD,MAAMG,EAAiBF,EAAO,QAC9B,GAAIL,GAA0BO,CAAc,EAAG,CAC3C,MAAMC,EAAgB,IAAID,EAC1B,GAAI,CACA,MAAMC,EAAc,IAAIpY,CAAK,CAChC,OACM1X,EAAG,CACN,QAAQ,MAAM,0BAA0B,OAAA0vB,EAAmB,oBAAmB,EAC9E,QAAQ,MAAM1vB,CAAC,CAClB,CACJ,MAEG,QAAQ,MAAM,0BAA0B,OAAA0vB,EAAmB,mCAAkC,CAErG,CChBO,MAAMK,EAAe,CAArB,cACHrgB,EAAA,YAAO,MACPA,EAAA,aAAQ,MACRA,EAAA,oBAAe,MACf,MAAM,KAAKiK,EAAcqW,EAAkB/e,EAAQ,CAC/C,KAAK,MAAQ,IAAIgf,GAAM,CACnB,OAAQxW,GAAU,EAClB,SAAUuW,EAAiB,SAC3B,UAAWA,EAAiB,UAC5B,wBAAyBA,EAAiB,wBAC1C,yBAA0BA,EAAiB,yBAC3C,WAAYA,EAAiB,WAC7B,OAAA/e,EACA,kBAAmB+e,EAAiB,kBACpC,MAAO,CACH,oBAAqB,EACxB,CACb,CAAS,EACD,KAAK,aAAerW,EACpBxJ,EAAa,KAAK,MAAM,IAAI,EAC5B,MAAMhI,EAAO,IAAIuR,GAAaC,EAAa,oBAAoB,EAAE,EAAG,KAAK,aAAc,KAAK,MAAO,KAAK,MAAM,IAAI,EAClH,KAAK,KAAOxR,EACZA,EAAK,KAAK,gBAAiB,KAAK,oBAAoB,KAAK,KAAMA,CAAI,CAAC,EACpE,KAAK,aAAaA,CAAI,EAElB6nB,EAAiB,qBACjB,MAAMP,GAAkBO,EAAiB,oBAAqB,KAAK,KAAK,EAG5E,KAAK,MAAM,GAAG,YAAa,CAACtY,EAAOvG,IAAQ,CACvC,KAAK,YAAYA,CAAG,CAChC,CAAS,CACJ,CACD,WAAW5F,EAAO,CACd4E,EAAa,KAAK,YAAY,EAC9BA,EAAa,KAAK,KAAK,EACvB,MAAMhI,EAAO,IAAIuR,GAAanO,EAAO,KAAK,aAAc,KAAK,KAAK,EAClE,OAAApD,EAAK,KAAK,gBAAiB,KAAK,oBAAoB,KAAK,KAAMA,CAAI,CAAC,EACpE,KAAK,aAAaA,CAAI,EACfA,CACV,CACD,eAAeoD,EAAO,CAClB4E,EAAa,KAAK,YAAY,EAC9BA,EAAa,KAAK,KAAK,EACvB,MAAMhI,EAAO,IAAIknB,GAAiB9jB,EAAO,KAAK,aAAc,KAAK,KAAK,EACtE,OAAApD,EAAK,KAAK,gBAAiB,KAAK,oBAAoB,KAAK,KAAMA,CAAI,CAAC,EACpE,KAAK,aAAaA,CAAI,EACfA,CACV,CAED,YAAYA,EAAM,CACdA,EAAK,QAAO,CACf,CACD,eAAewB,EAAI,CACf,KAAM,CAAE,MAAA+N,CAAO,EAAG,KAClBvH,EAAauH,CAAK,EAClBA,EAAM,UAAU,yBAAyB/N,CAAE,CAC9C,CACD,aAAc,CACVwG,SAAa,KAAK,IAAI,EACf,KAAK,IACf,CAGD,aAAahI,EAAM,CACf,MAAM,IAAI,MAAM,yBAAyB,CAC5C,CACD,oBAAoBA,EAAM,CACtB,MAAM,IAAI,MAAM,yBAAyB,CAC5C,CACD,YAAYgJ,EAAK,CACb,MAAM,IAAI,MAAM,yBAAyB,CAC5C,CACL,CCzEW,IAAA2H,GACAoX,GAOK,SAAAC,GACdhrB,EAAyC,GAC3B,CACR,MAAAqL,EAAS,IAAIuf,GAEnB,OAAAjX,GAAW,IAAIzI,GAAalL,EAASA,EAAQ,QAAU,MAAOqL,CAAM,EAErD0f,GAAApX,GAAS,aAAa,KAAKA,EAAQ,EAC3CA,EACT,CClBA,MAAqBsX,WAAiB,KAAiB,CAGrD,YAAYjoB,EAAmB,CACvB,QACN,KAAK,QAAUA,CACjB,CAEA,IAAI,UAAoC,CAEtC,OAAO,KAAK,KAAK,QAAQ,UAAY,CAAC,CACxC,CAEA,IAAI,YAAa,CACf,OAAO,KAAK,CAAC,CACf,CAEA,OAAOA,EAAiBkoB,EAAuB,CAC7C,GAAIA,EAAY,CACR,MAAAllB,EAAQ,KAAK,QAAQklB,CAAU,EAChC,YAAOllB,EAAO,EAAGhD,CAAI,OAE1B,KAAK,KAAKA,CAAI,EAGhBA,EAAK,OAAS,KAAK,QACnB,KAAK,QAAQ,SAAW,EAC1B,CAEA,OAAOA,EAAiB,CAChB,MAAAmoB,EAAoB,KAAK,QAAQnoB,CAAI,EACvCmoB,GAAqB,GAClB,YAAOA,EAAmB,CAAC,CAEpC,CACF,CC3BA,YAAY,IAAM,CAAmB,iEAG9B,MAAMC,GAAiB,CAC5B,MAAO,GACP,kBAAmB,CACjB,SAAU,IACV,OAAQ,aACV,EACA,aAAc,CACZ,WAAY,SACZ,SAAU,GACZ,CACF,ECrBgB,SAAAC,GAAIjJ,EAAapf,KAAoBsoB,EAAa,CAMlE,CAEO,SAASC,GAAO5jB,EAAwD,CAC7E,OAAO,OAAOA,GAAS,UACzB,CAQO,SAASpE,GAAQoE,EAA8B,CAC7C,aAAM,QAAQA,CAAI,CAC3B,CAEO,SAAS6jB,GAAS7jB,EAA+B,CACtD,OAAO,OAAOA,GAAS,QACzB,CAEO,SAAS8jB,GAAS9jB,EAA+B,CACtD,OAAO,OAAOA,GAAS,QACzB,CAEO,SAAS+jB,GAAU/jB,EAA+B,CAChD,cAAO,UAAUA,CAAI,CAC9B,CAEgB,SAAAgkB,GACdC,EACAhjB,EACA,CACA,UAAWtG,KAAOsG,EAChB,GAAItG,KAAOspB,EACF,SAGJ,QACT,CAEO,SAASC,GACd9rB,EACoB,CACpB,OAAOwD,GAAQxD,CAAK,EAAKA,EAA+B,CAAC,EAAIA,CAC/D,CChDA,MAAqB+rB,WAAe,KAAc,CAGhD,YAAYC,EAAsBC,EAA2B,GAAI,KAAAC,EAAA,IAAAX,IAAA,UAAAA,CAAA,GAC3D,OAAA/nB,GAAQyoB,CAAY,EACtBC,EAAM,GAAGD,CAAY,EACZR,GAASQ,CAAY,EAC9BC,EAAMD,CAAY,EAElBC,EACE,GAAG,OAAO,QAAQD,CAAY,EAC3B,OAAO,CAAC,CAACE,EAAMnsB,CAAK,IAAMA,CAAK,EAC/B,IAAI,CAAC,CAACuC,CAAG,IAAMA,CAAG,GAIzB,KAAK,SAAWypB,EACT,IACT,CAEA,IAAI7pB,EAAe,CACV,YAAK,QAAQA,CAAK,GAAK,CAChC,CAEA,GAAGA,EAAe,CACT,YAAK,QAAQA,CAAK,GAAK,CAChC,CAEA,IAAIA,EAAe,CACjB,KAAK,KAAKA,CAAK,EACf,KAAK,SAAS,CAChB,CAEA,OAAOA,EAAe,CAChB,KAAK,IAAIA,CAAK,EAChB,KAAK,OAAOA,CAAK,EAEjB,KAAK,IAAIA,CAAK,CAElB,CAEA,OAAOA,EAAe,CACd,MAAAiqB,EAAqB,KAAK,QAAQjqB,CAAK,EACzCiqB,GAAsB,IACnB,YAAOA,EAAoB,CAAC,EACjC,KAAK,SAAS,EAElB,CACF,CCrDA,SAAAC,GAAyBppB,EAA4B,CACnD,MAAM2B,EAAW,GACjB,QAAS/I,EAAI,EAAGA,EAAIoH,EAAK,SAAS,OAAQpH,IAAK,CACvC,MAAA0E,EAAI0C,EAAK,SAASpH,CAAC,EAErB,GAAA0E,EAAE,OAAS,WAIf,IAAIA,EAAE,OAAS,QAAU,EAAEA,EAAE,OAASA,EAAE,QAC/B,SAGTqE,EAAS,KAAKrE,CAAC,EACjB,CAEA,MAAM+rB,EAAc1nB,EAAS,OAEvB2nB,GADYtpB,EAAK,eAAiB,SACZ,MACtBupB,EAAYD,EAAQ,QAAU,SAC9BE,EAAiBF,EAAQ,SAAW,QACpCG,EAAYH,EAAQ,aAAe,YACnCI,EAAYJ,EAAQ,cAAgB,eACpCK,EAAOL,EAAQ,IAAM,IACrBM,EAAYN,EAAQ,IAAM,IAC1BO,EAAgB7pB,EAAKupB,CAAS,GAAK,EACnCO,EAAqB9pB,EAAKwpB,CAAc,GAAK,EAC7CO,EAAM/pB,EAAK,KAAO,EAClBgqB,EAAUhqB,EAAK,gBAAkB,YACjCiqB,EAAQjqB,EAAK,WACnB,IAAIkqB,EAAW,EACX,CAAC,SAAU,eAAgB,aAAa,EAAE,SAASF,CAAO,IAC5DE,EAAWvoB,EAAS,OAClB,CAACV,EAAM3D,IAAM2D,GAAQ3D,EAAEisB,CAAS,GAAK,GACrC,IAKJ,MAAMY,EACJL,GAAsBG,EACjB3sB,GAAiB,CACZ2sB,IAAU,YACZ3sB,EAAEssB,CAAS,EAAI,EACNK,IAAU,SACnB3sB,EAAEssB,CAAS,GAAKE,GAAsBxsB,EAAEksB,CAAc,GAAK,IAAM,EACxDS,IAAU,YACnB3sB,EAAEssB,CAAS,EAAIE,GAAsBxsB,EAAEksB,CAAc,GAAK,GAC5D,EAEDlsB,GAAiBA,EAExB,GAAI0sB,IAAY,YAAa,CAC3B,IAAIxlB,EAAQ,EAQZ,GAPS7C,EAAA,QAASrE,GAAM,CACtBA,EAAEqsB,CAAI,EAAInlB,GAASlH,EAAEmsB,CAAS,GAAK,GAEhCjlB,IAAAlH,EAAEisB,CAAS,GAAK,GAAKQ,GAAOzsB,EAAEmsB,CAAS,GAAK,IAAMnsB,EAAEosB,CAAS,GAAK,GACrES,EAAgB7sB,CAAC,EAClB,EAEG0C,EAAK,WAAY,CACnB,MAAM6pB,EAAgBrlB,EAAQulB,EAC1BF,OAAkB7pB,EAAKupB,CAAS,EAClC,OAAAvpB,EAAKupB,CAAS,EAAIM,EACX,EAEX,UACSG,IAAY,UAAW,CAChC,IAAIxlB,EAAQqlB,EACZ,QAASjxB,EAAIywB,EAAc,EAAGzwB,GAAK,EAAGA,IAAK,CACnC,MAAA0E,EAAIqE,EAAS/I,CAAC,EACpBoP,EAAa1K,CAAC,EACZA,EAAAqsB,CAAI,EAAInlB,GAASlH,EAAEisB,CAAS,GAAK,IAAMjsB,EAAEosB,CAAS,GAAK,GAEtDllB,IAAAlH,EAAEisB,CAAS,GAAK,GAAKQ,GAAOzsB,EAAEmsB,CAAS,GAAK,IAAMnsB,EAAEosB,CAAS,GAAK,GACrES,EAAgB7sB,CAAC,CACnB,UACS0sB,IAAY,SAAU,CAC/B,IAAIxlB,GAASqlB,GAAiBK,EAAWH,GAAOV,EAAc,KAAO,EAC5D1nB,EAAA,QAASrE,GAAM,CACtBA,EAAEqsB,CAAI,EAAInlB,EACAA,IAAAlH,EAAEisB,CAAS,GAAK,GAAKQ,EAC/BI,EAAgB7sB,CAAC,EAClB,UACQ0sB,IAAY,eAAgB,CAC/B,MAAAI,GAASP,EAAgBK,IAAab,EAAc,GAC1D,IAAI7kB,EAAQ,EACH7C,EAAA,QAASrE,GAAM,CACtBA,EAAEqsB,CAAI,EAAInlB,EACAA,IAAAlH,EAAEisB,CAAS,GAAK,GAAKa,EAC/BD,EAAgB7sB,CAAC,EAClB,UACQ0sB,IAAY,cAAe,CAC9B,MAAAI,GAASP,EAAgBK,IAAab,EAAc,GAC1D,IAAI7kB,EAAQ4lB,EACHzoB,EAAA,QAASrE,GAAM,CACtBA,EAAEqsB,CAAI,EAAInlB,EACAA,IAAAlH,EAAEisB,CAAS,GAAK,GAAKa,EAC/BD,EAAgB7sB,CAAC,EAClB,CACH,CAGO,QACT,CC3EA,KAAM,CAAE,kBAAmB+sB,EAA6B,EAAAjC,GAExD,SAASkC,GAAuBC,EAAmB,CACjD,MAAMnX,EAAU,GAEhB,SAAW,CAAC9a,EAAM8K,CAAK,IAAK,OAAO,QACjCmnB,CAAA,EAEAnX,EAAQ,KAAK,CAAE,KAAA9a,EAAM,MAAA8K,CAAO,GAE9B,OAAO2kB,GAAa,gBAAiB,CAAE,QAAA3U,CAAyB,EAClE,CAEA,SAASoX,GACPC,EAAsD,GACtD,CACO,OACL,IAAuB1tB,EAAkD,CAEnE0rB,GAAS1rB,CAAK,IAChBA,EAAQ,CAAE,MAAOA,EAAO,MAAO,GAAW,GAE5C,KAAK,QAAU,CACb,GAAI,KAAK,SAAW,CAAC,EAChB,CAAC,SAAS,OAAA0tB,EAAW,EAAG1tB,CAAM,EAEhC,eAAU,OAAA0tB,EAAW,EAAI1tB,CAChC,EACA,KAAuB,CACd,YAAK,UAAU,OAAA0tB,EAAW,CACnC,EAEJ,CAEA,MAAMC,GAA+B,CACnC,QACA,QACA,WACA,aACA,YACA,cACA,UACA,UACA,UACA,UACA,SACA,WACA,aACA,QACA,SACA,SACA,QACA,SACA,SACA,WACA,QACA,QACA,SACA,SACA,IACA,IACA,SACA,cACF,EAEMC,GAAqC,CACzC,WACA,UACA,aACA,MACA,OACA,YACA,UACA,WACA,iBACA,eACA,eACA,gBACA,UACF,EAiCO,MAAMC,WAAoB,MAAO,CAiCtC,YAAYjkB,EAAc,CAClB,QAhCY,cAQpB,KAAQ,QAA8B,KAyBpC,KAAK,KAAOA,EACZ,KAAK,SAAW,GAChB,KAAK,UAAY,GACjB,KAAK,aAAe,CAAE,EAAG,EAAG,EAAG,GAC1B,cAAW,IAAIshB,GAAS,IAAI,EAEjC,UAAW3oB,KAAOorB,GACT,sBAAe,KAAMprB,EAAK,CAC/B,KAAc,CACL,YAAK,IAAI,OAAAA,EAAK,GAAM,KAAK,KAAO,KAAK,IAAIA,CAAG,CACrD,EACA,IAAItB,EAAkC,CACpC,KAAK,IAAI,OAAAsB,EAAK,EAAIupB,GAAmB7qB,CAAC,EACjC,gCAA2BsB,EAAKtB,CAAC,CACxC,EACD,EAGH,UAAWsB,KAAOqrB,GACT,sBAAe,KAAMrrB,EAAK,CAC/B,KAAM,CACG,YAAK,IAAI,OAAAA,EAAK,GAAM,KAAK,KAAO,KAAK,IAAIA,CAAG,CACrD,EACA,IAAItB,EAAG,CACA,SAAI,OAAAsB,EAAK,EAAItB,EACb,sBAAiBsB,EAAKtB,CAAC,CAC9B,EACD,EAIH,OAAO,iBAAiB,KAAM,CAC5B,aAAc,CACZ,IAAuB6sB,EAAQ,CAC7B,KAAK,cAAgBA,EACrB,KAAK,QAAU,CACb,GAAI,KAAK,SAAW,CAAC,EAChB,OAAQ,CAAE,OAAAA,EAAS,CAE5B,EACA,KAAuB,CACrB,OAAO,KAAK,aACd,CACF,EACA,OAAQL,GAAe,EACvB,WAAYA,GAAe,MAAM,EACjC,YAAaA,GAAe,OAAO,EACnC,UAAWA,GAAe,KAAK,EAC/B,aAAcA,GAAe,QAAQ,EACtC,EAED,OAAO,iBAAiB,KAAM,CAC5B,eAAgB,CACd,IAAIpnB,EAAQ,GAAI,CACd,KAAK,gBAAkBA,EACvB,KAAK,QAAU,CACb,GAAI,KAAK,SAAW,CAAC,EAChB,eAAgBA,CAAM,CAE/B,EACA,KAAM,CACJ,OAAO,KAAK,eACd,CACF,EACD,CACH,CAEA,IAAI,SAAU,CACZ,OAAO,KAAK,QACd,CAEA,IAAI,QAAQpF,EAAG,CACb,KAAK,SAAWA,EACX,YAASssB,GAAuBtsB,CAAC,CACxC,CAEA,IAAI,QAAS,CACX,OAAO,KAAK,OACd,CAEA,IAAI,OAAOqB,EAAG,OACZ,KAAK,QAAUA,EACX,KAAK,UAAY,KAAK,MACnB,SAAI,QAASoI,EAAApI,GAAA,YAAAA,EAAG,MAAH,KAAAoI,EAAU,KAEhC,CAEA,IAAI,QAAgC,CAClC,OAAO,KAAK,OACd,CAEA,IAAI,OAAOzJ,EAA4D,CACjEuC,GAAQvC,CAAC,EACN,aAAU+pB,GAAa,GAAG/pB,CAAC,EAEhC,KAAK,QAAUA,EAEZ,sBAAiB,SAAU,KAAK,OAAO,CAC9C,CAEA,2BACE2I,EACA5J,EACA,CACI,QAAK,UAAY,KAAK,IAAK,CACzB,GAAAwD,GAAQxD,CAAK,EACf,OAAO,KAAK,gBAAgB,CAAE,CAAC4J,CAAI,EAAG5J,EAAM,CAAC,GAAKA,EAAM,CAAC,CAAC,EAAE,MAAM,EAGpE,GAAI,KAAK,SACA,YAAK,gBAAgB,CAAE,CAAC4J,CAAI,EAAG5J,CAAO,GAAE,QAGhD,KAAK,IAAI4J,CAAmB,EAAwB5J,CAAA,MAGjDwD,GAAQxD,CAAK,IACfA,EAAQA,EAAM,CAAC,GAEZ,kBAAa4J,CAAI,EAAI5J,CAE9B,CAEA,iBAAiB4J,EAAc5J,EAAgB,CACzC,KAAK,UAAY,KAAK,IACvB,KAAK,IAAI4J,CAAgC,EAAgB5J,EAErD,kBAAa4J,CAAI,EAAI5J,CAE9B,CAEA,gBACEqG,EACA0nB,EACA,CACa9iB,SAAA,KAAK,IAAK,wCAAwC,EACxD,KAAK,IAAI,QAAQ5E,EAAO0nB,GAAqB,KAAK,iBAAiB,CAC5E,CAEA,UAAW,CACL,KAAK,SACP1jB,GAA8B,IAAI,EAElC,KAAK,UAAY,EAErB,CAEA,YAAa,CACX,OAAO,KAAK,OAAS,MACvB,CAEA,mBAAoB,CAClB,KAAK,IAAK,KACR,SACA,CAAC2jB,EAAcC,IAAqC,CAC9C,GAAAA,EAAc,OAAS,OAAQ,CAC3B,MAAE,WAAAxb,CAAe,EAAAwb,EAEvB,KAAK,MAAQxb,EAAW,MACxB,KAAK,OAASA,EAAW,OACpB,YAAQ,aAAa,KAAMA,CAAU,CAC5C,CACF,EAEJ,CAEA,SAAU,CACD,YAAK,SAAS,IAAKlS,GAAMA,EAAE,IAAI,EAAE,KAAK,EAAE,CACjD,CAEA,SAAU,CACR,KAAK,KAAOqT,GAAS,YAAY,KAAK,GAAG,CAC3C,CAEA,IAAI,MAAM5T,EAAoB,CAE5B,QAASuC,KAAOvC,EACVuC,IAAQ,YACJA,EAAA,YAGH,KAAKA,CAAwB,IAC3B,KAAAA,CAAwB,EAAIvC,EAAMuC,CAAwB,GAInE,KAAK,OAASvC,CAChB,CAEA,IAAI,OAAqB,CACvB,OAAO,KAAK,MACd,CAEA,IAAI,aAAc,CACT,YAAK,SAAS,OAAS,CAChC,CAEA,IAAI,OAAOkuB,EAAoB,CACxB,aAAU,IAAInC,GAAO,KAAK,cAAc,KAAK,IAAI,EAAGmC,CAAM,EAC3D,KAAK,UACP,KAAK,cAAc,CAEvB,CAEA,IAAI,QAAiB,CACd,oBAAU,KAAK,SAAW,IAAInC,GAAO,KAAK,cAAc,KAAK,IAAI,CAAC,EAChE,KAAK,OACd,CAEA,IAAI,mBAAgD,CAClD,OAAO,KAAK,oBAAsBuB,EACpC,CAEA,IAAI,kBAAkBS,EAA+C,CACnE,KAAK,mBAAqBA,CAC5B,CAEA,aAAa7jB,EAAqBuI,EAAyB,OACrD,KAAK,cAEA+Y,GAAA,KAAK,cAAc,GACxB,KAAK,eAAe,KAAK,KAAMthB,EAAOuI,CAAU,EAE9C,KAAK,UAAY,QACf4Z,GAAc,IAAI,KACpB3hB,EAAA,KAAK,SAAL,MAAAA,EAAa,gBAIV8gB,GAAA,KAAK,QAAQ,GAAK,KAAK,SAAS,KAAK,KAAMthB,EAAOuI,CAAU,EAEvE,CAEA,eAAgB,OAGd,GAFI6Y,GAAA,kBAAmB,KAAM,KAAK,MAAM,EAEpC,KAAK,cAAe,CAEhB4C,QAAS,KAAK,OAAO,MAAM,EACjC,KAAK,SAAS,QAAS3tB,GAAOA,EAAE,OAAS2tB,CAAO,CAClD,CAEA,MAAMA,IAASxjB,EAAA2gB,GAAO,kBAAP,YAAA3gB,EAAA,KAAA2gB,GAAyB,KAAM,KAAK,UAAW,KAAK,OAE/D,QAAK,aAAgB,KAAK,OAASO,GAAU,KAAK,MAAOsC,CAAM,EAAI,CAChE,iBAAc,KAAK,aAAe,GACvC,IAAIC,EAAe,GAER,UAAChsB,EAAOisB,CAAU,IAAK,OAAO,QAAQ,KAAK,WAAW,EAE1DF,EAAO,SAAS/rB,CAAK,IACTgsB,EAAA,CACb,GAAGA,EACH,GAAGC,CAAA,GAKT,MAAMC,EAAYH,EAAO,OAAO,CAACxU,EAAKvX,IAAU,CACxC,MAAAmsB,EAAS,KAAK,MAAMnsB,CAAK,EAC/B,OAAImsB,IACI5U,EAAA,CACJ,GAAGA,EACH,GAAG4U,CAAA,EAID,KAAK,aAAe,CAAC,KAAK,YAAYnsB,CAAK,IACxC,iBAAYA,CAAK,EAAI,GAC1B,OAAO,KAAKmsB,CAAM,EAAE,QAAS/rB,GAAQ,CACnC,KAAK,YAAaJ,CAAK,EAAEI,CAAG,EAAI,KAAKA,CAAiB,EACvD,IAGEmX,CACT,EAAG,CAAE,GAGL,OAAO,OAAO,KAAM,CAAE,GAAGyU,EAAc,GAAGE,EAAW,CACvD,CACF,CAEA,QAAS,CAEP,MAAMprB,EAAO,KACP4P,EAAS,KAAK,OAGhBA,EAAO,WACTA,EAAO,aAAa,EACpBA,EAAO,SAAW,IAGpB5P,EAAK,aAAa,EAEd,KAAK,OAAO,QACd,KAAK,cAAc,EAGrB,IAAIoD,EAAQpD,EAAK,aAEb4P,EAAO,MACTxM,EAAM,OAASwM,EAAO,KAGpB5P,EAAK,cACCoD,EAAA,CACN,GAAGglB,GAAO,aACV,GAAGhlB,EACH,KAAMpD,EAAK,QAAQ,GAGjBoD,EAAM,UACHA,EAAM,QACTA,EAAM,OACHwM,EAAO,OAAS,GAAKxM,EAAM,GAAKA,EAAM,aAAe,GACxDpD,EAAK,OAASoD,EAAM,MACpBpD,EAAK,WAAa,IAGhB,CAACoD,EAAM,QAAUA,EAAM,UAAY,SACrCA,EAAM,QACHwM,EAAO,QAAU,GAAKxM,EAAM,GAAKA,EAAM,cAAgB,GAC1DpD,EAAK,QAAUoD,EAAM,OACrBpD,EAAK,WAAa,KAKjBA,EAAA,IAAM2Q,GAAS,eAAevN,CAAK,EAExCmlB,GAAO,KAAK,QAAQ,GAAK,KAAK,SAAS,KAAK,KAAMvoB,CAAI,EAElDuoB,GAAOvoB,EAAK,MAAM,GACpBA,EAAK,IAAI,GAAG,SAAUA,EAAK,MAAM,GAG/B,CAACA,EAAK,OAAS,CAACA,EAAK,UACvBA,EAAK,WAAa,GAClBA,EAAK,kBAAkB,KAInBoD,EAAM,KAAOA,EAAM,UAEnB,MAAMA,EAAM,KAAK,IACnBA,EAAM,OAASwM,EAAO,OAAS,GAAKxM,EAAM,EAC1CpD,EAAK,OAASoD,EAAM,MACpBpD,EAAK,WAAa,IAGhB,MAAMoD,EAAM,MAAM,IACpBA,EAAM,QAAUwM,EAAO,QAAU,GAAKxM,EAAM,EAC5CpD,EAAK,QAAUoD,EAAM,OACrBpD,EAAK,WAAa,IAGfoD,EAAM,QAGJpD,EAAA,OAASoD,EAAM,MAAQ,IAK3BpD,EAAA,IAAM2Q,GAAS,WAAWvN,CAAK,EAEhCpD,EAAK,QACPA,EAAK,IAAI,GAAG,SAAUA,EAAK,MAAM,EAG/BA,EAAK,QACPA,EAAK,IAAI,GAAG,SAAUA,EAAK,MAAM,EAGnCuoB,GAAO,KAAK,QAAQ,GAAK,KAAK,SAAS,KAAK,KAAMvoB,CAAI,GAGxDA,EAAK,SAAW,GACXA,EAAA,WAAaA,EAAK,WAEvB,OAAO,KAAK,YACd,CACF,CC/iBO,MAAMsrB,GAAuCloB,IAAK,WAAAmoB,EAAAC,GAAA,QAAAC,UAAAF,EAAenoB,EAAK,IAAAmoB,CAAA,GAAS,ECAzEG,EAAuCtoB,IAAK,WAAAmoB,EAAAC,GAAA,QAAAC,UAAAF,EAC5CnoB,EAAK,IAAAmoB,CAAA,GAAS,ECE3B,SAASI,GAAc3rB,EAAiB,CAClCA,EAAK2G,OAAS,aAGlBqB,EAAahI,aAAgB4qB,EAAW,EACxC5qB,EAAK4rB,OAAM,EACX5rB,EAAK2B,SAASkqB,QAAQvuB,GAAKquB,GAAcruB,CAAC,CAAC,EAC7C,CAcO,MAAMwuB,GAAU1oB,GAAuB,CAC5C,MAAMuN,EAAWqX,GAAuB5kB,EAAMpG,OAAO,EAC/CsF,EAAOqO,EAASrO,OACtB,IAAI7F,EAEJiB,UAAa,IAAM,CACjB4E,EAAKypB,KAAK,IAAM,CACd/jB,EAAavL,CAAI,EACjBA,EAAKuvB,IAAMrb,EAASlU,KACpBA,EAAKkF,SAASkqB,QAAQF,EAAa,EACnCpD,GAAOnlB,EAAM6oB,aAAa,GAAK7oB,EAAM6oB,cAAcxvB,CAAI,CACxD,GAAEyvB,MAAMC,QAAQrtB,KAAK,CACxB,CAAC,GACD,WAAAysB,EAAAC,GAAA,UAAAY,EACe3vB,EAAI,cAAA2vB,GAAAC,cAAAD,EAAAb,CAAA,EAAJ9uB,EAAI8uB,EAAAe,GAAAf,EACdnoB,MAAMzB,QAAQ,EAAA4pB,CAAA,IAGrB,ECrDA,SAASgB,GAAiB,CACxB,cAAAC,EACA,eAAAC,EACA,WAAAC,EACA,YAAAC,EACA,WAAAC,EACA,WAAAC,EACA,YAAAC,EACA,cAAAC,EACA,cAAAC,EACA,eAAAC,CACF,EAAG,CACD,SAASC,EAAOtd,EAAQud,EAAUC,EAAQC,EAAS,CAEjD,GADID,IAAW,QAAa,CAACC,IAASA,EAAU,IAC5C,OAAOF,GAAa,WAAY,OAAOG,EAAiB1d,EAAQud,EAAUE,EAASD,CAAM,EAC7F3vB,GAAmBjB,GAAW8wB,EAAiB1d,EAAQud,EAAU,EAAE3wB,EAAS4wB,CAAM,EAAGC,CAAO,CAC7F,CACD,SAASC,EAAiB1d,EAAQ7S,EAAOP,EAAS4wB,EAAQG,EAAa,CACrE,KAAO,OAAO/wB,GAAY,YAAYA,EAAUA,EAAO,EACvD,GAAIO,IAAUP,EAAS,OAAOA,EAC9B,MAAM6E,EAAI,OAAOtE,EACfywB,EAAQJ,IAAW,OACrB,GAAI/rB,IAAM,UAAYA,IAAM,SAE1B,GADIA,IAAM,WAAUtE,EAAQA,EAAM,SAAQ,GACtCywB,EAAO,CACT,IAAIxtB,EAAOxD,EAAQ,CAAC,EAChBwD,GAAQ0sB,EAAW1sB,CAAI,EACzB2sB,EAAY3sB,EAAMjD,CAAK,EAClBiD,EAAOysB,EAAe1vB,CAAK,EAClCP,EAAUixB,EAAc7d,EAAQpT,EAAS4wB,EAAQptB,CAAI,CAC7D,MACYxD,IAAY,IAAM,OAAOA,GAAY,SACvCmwB,EAAYK,EAAcpd,CAAM,EAAIpT,EAAUO,CAAK,GAEnD0wB,EAAc7d,EAAQpT,EAAS4wB,EAAQX,EAAe1vB,CAAK,CAAC,EAC5DP,EAAUO,WAGLA,GAAS,MAAQsE,IAAM,UAChC7E,EAAUixB,EAAc7d,EAAQpT,EAAS4wB,CAAM,MAC1C,IAAI/rB,IAAM,WACf,OAAA5D,GAAmB,IAAM,CACvB,IAAIO,EAAIjB,IACR,KAAO,OAAOiB,GAAM,YAAYA,EAAIA,EAAC,EACrCxB,EAAU8wB,EAAiB1d,EAAQ5R,EAAGxB,EAAS4wB,CAAM,CAC7D,CAAO,EACM,IAAM5wB,EACR,GAAI,MAAM,QAAQO,CAAK,EAAG,CAC/B,MAAM2wB,EAAQ,GACd,GAAIC,EAAuBD,EAAO3wB,EAAOwwB,CAAW,EAClD,OAAA9vB,GACE,IAAOjB,EAAU8wB,EAAiB1d,EAAQ8d,EAAOlxB,EAAS4wB,EAAQ,EAAI,CAChF,EACe,IAAM5wB,EAEf,GAAIkxB,EAAM,SAAW,EAAG,CACtB,MAAME,EAAcH,EAAc7d,EAAQpT,EAAS4wB,CAAM,EACzD,GAAII,EAAO,OAAQhxB,EAAUoxB,CACrC,MACY,MAAM,QAAQpxB,CAAO,EACnBA,EAAQ,SAAW,EACrBqxB,EAAYje,EAAQ8d,EAAON,CAAM,EAC5BU,EAAgBle,EAAQpT,EAASkxB,CAAK,EACpClxB,GAAW,MAAQA,IAAY,GACxCqxB,EAAYje,EAAQ8d,CAAK,EAEzBI,EAAgBle,EAAS4d,GAAShxB,GAAY,CAACwwB,EAAcpd,CAAM,CAAC,EAAG8d,CAAK,EAGhFlxB,EAAUkxB,CAChB,KAAW,CACL,GAAI,MAAM,QAAQlxB,CAAO,EAAG,CAC1B,GAAIgxB,EAAO,OAAQhxB,EAAUixB,EAAc7d,EAAQpT,EAAS4wB,EAAQrwB,CAAK,EACzE0wB,EAAc7d,EAAQpT,EAAS,KAAMO,CAAK,CAClD,MAAiBP,GAAW,MAAQA,IAAY,IAAM,CAACwwB,EAAcpd,CAAM,EACnEgd,EAAWhd,EAAQ7S,CAAK,EACnBgxB,EAAYne,EAAQ7S,EAAOiwB,EAAcpd,CAAM,CAAC,EACvDpT,EAAUO,CACX,EACD,OAAOP,CACR,CACD,SAASmxB,EAAuBK,EAAYN,EAAOO,EAAQ,CACzD,IAAItvB,EAAU,GACd,QAAS/F,EAAI,EAAGkL,EAAM4pB,EAAM,OAAQ90B,EAAIkL,EAAKlL,IAAK,CAChD,IAAI+L,EAAO+oB,EAAM90B,CAAC,EAChByI,EACF,GAAI,EAAAsD,GAAQ,MAAQA,IAAS,IAAQA,IAAS,IACzC,GAAI,MAAM,QAAQA,CAAI,EACzBhG,EAAUgvB,EAAuBK,EAAYrpB,CAAI,GAAKhG,WAC5C0C,EAAI,OAAOsD,IAAU,UAAYtD,IAAM,SACjD2sB,EAAW,KAAKvB,EAAe9nB,CAAI,CAAC,UAC3BtD,IAAM,WACf,GAAI4sB,EAAQ,CACV,KAAO,OAAOtpB,GAAS,YAAYA,EAAOA,EAAI,EAC9ChG,EACEgvB,EAAuBK,EAAY,MAAM,QAAQrpB,CAAI,EAAIA,EAAO,CAACA,CAAI,CAAC,GAAKhG,CACvF,MACUqvB,EAAW,KAAKrpB,CAAI,EACpBhG,EAAU,QAEPqvB,EAAW,KAAKrpB,CAAI,CAC5B,CACD,OAAOhG,CACR,CACD,SAASmvB,EAAgBI,EAAYjzB,EAAGC,EAAG,CACzC,IAAIizB,EAAUjzB,EAAE,OACdkzB,EAAOnzB,EAAE,OACTozB,EAAOF,EACPG,EAAS,EACTC,EAAS,EACTC,EAAQvB,EAAehyB,EAAEmzB,EAAO,CAAC,CAAC,EAClCK,EAAM,KACR,KAAOH,EAASF,GAAQG,EAASF,GAAM,CACrC,GAAIpzB,EAAEqzB,CAAM,IAAMpzB,EAAEqzB,CAAM,EAAG,CAC3BD,IACAC,IACA,QACD,CACD,KAAOtzB,EAAEmzB,EAAO,CAAC,IAAMlzB,EAAEmzB,EAAO,CAAC,GAC/BD,IACAC,IAEF,GAAID,IAASE,EAAQ,CACnB,MAAMtuB,EACJquB,EAAOF,EAAWI,EAAStB,EAAe/xB,EAAEqzB,EAAS,CAAC,CAAC,EAAIrzB,EAAEmzB,EAAOE,CAAM,EAAKC,EACjF,KAAOD,EAASF,GAAMzB,EAAWsB,EAAYhzB,EAAEqzB,GAAQ,EAAGvuB,CAAI,CACtE,SAAiBquB,IAASE,EAClB,KAAOD,EAASF,IACV,CAACK,GAAO,CAACA,EAAI,IAAIxzB,EAAEqzB,CAAM,CAAC,IAAGzB,EAAWqB,EAAYjzB,EAAEqzB,CAAM,CAAC,EACjEA,YAEOrzB,EAAEqzB,CAAM,IAAMpzB,EAAEmzB,EAAO,CAAC,GAAKnzB,EAAEqzB,CAAM,IAAMtzB,EAAEmzB,EAAO,CAAC,EAAG,CACjE,MAAMpuB,EAAOitB,EAAehyB,EAAE,EAAEmzB,CAAI,CAAC,EACrCxB,EAAWsB,EAAYhzB,EAAEqzB,GAAQ,EAAGtB,EAAehyB,EAAEqzB,GAAQ,CAAC,CAAC,EAC/D1B,EAAWsB,EAAYhzB,EAAE,EAAEmzB,CAAI,EAAGruB,CAAI,EACtC/E,EAAEmzB,CAAI,EAAIlzB,EAAEmzB,CAAI,CACxB,KAAa,CACL,GAAI,CAACI,EAAK,CACRA,EAAM,IAAI,IACV,IAAI71B,EAAI21B,EACR,KAAO31B,EAAIy1B,GAAMI,EAAI,IAAIvzB,EAAEtC,CAAC,EAAGA,GAAG,CACnC,CACD,MAAMoK,EAAQyrB,EAAI,IAAIxzB,EAAEqzB,CAAM,CAAC,EAC/B,GAAItrB,GAAS,KACX,GAAIurB,EAASvrB,GAASA,EAAQqrB,EAAM,CAClC,IAAIz1B,EAAI01B,EACNI,EAAW,EACXrtB,EACF,KAAO,EAAEzI,EAAIw1B,GAAQx1B,EAAIy1B,GAClB,GAAAhtB,EAAIotB,EAAI,IAAIxzB,EAAErC,CAAC,CAAC,IAAM,MAAQyI,IAAM2B,EAAQ0rB,IACjDA,IAEF,GAAIA,EAAW1rB,EAAQurB,EAAQ,CAC7B,MAAMvuB,GAAO/E,EAAEqzB,CAAM,EACrB,KAAOC,EAASvrB,GAAO4pB,EAAWsB,EAAYhzB,EAAEqzB,GAAQ,EAAGvuB,EAAI,CAC7E,MAAmB+tB,EAAYG,EAAYhzB,EAAEqzB,GAAQ,EAAGtzB,EAAEqzB,GAAQ,CAAC,CACxD,MAAMA,SACFzB,EAAWqB,EAAYjzB,EAAEqzB,GAAQ,CAAC,CAC1C,CACF,CACF,CACD,SAASb,EAAc7d,EAAQpT,EAAS4wB,EAAQQ,EAAa,CAC3D,GAAIR,IAAW,OAAW,CACxB,IAAIuB,EACJ,KAAQA,EAAU3B,EAAcpd,CAAM,GAAIid,EAAWjd,EAAQ+e,CAAO,EACpE,OAAAf,GAAehB,EAAWhd,EAAQge,CAAW,EACtC,EACR,CACD,MAAM5tB,EAAO4tB,GAAenB,EAAe,EAAE,EAC7C,GAAIjwB,EAAQ,OAAQ,CAClB,IAAIoyB,EAAW,GACf,QAASh2B,EAAI4D,EAAQ,OAAS,EAAG5D,GAAK,EAAGA,IAAK,CAC5C,MAAMi2B,EAAKryB,EAAQ5D,CAAC,EACpB,GAAIoH,IAAS6uB,EAAI,CACf,MAAMC,EAAW/B,EAAc8B,CAAE,IAAMjf,EACnC,CAACgf,GAAY,CAACh2B,EAChBk2B,EAAWf,EAAYne,EAAQ5P,EAAM6uB,CAAE,EAAIjC,EAAWhd,EAAQ5P,EAAMotB,CAAM,EACvE0B,GAAYjC,EAAWjd,EAAQif,CAAE,CAChD,MAAeD,EAAW,EACnB,CACF,MAAMhC,EAAWhd,EAAQ5P,EAAMotB,CAAM,EACtC,MAAO,CAACptB,CAAI,CACb,CACD,SAAS6tB,EAAYje,EAAQ8d,EAAON,EAAQ,CAC1C,QAASx0B,EAAI,EAAGkL,EAAM4pB,EAAM,OAAQ90B,EAAIkL,EAAKlL,IAAKg0B,EAAWhd,EAAQ8d,EAAM90B,CAAC,EAAGw0B,CAAM,CACtF,CACD,SAASW,EAAYne,EAAQmf,EAASC,EAAS,CAC7CpC,EAAWhd,EAAQmf,EAASC,CAAO,EACnCnC,EAAWjd,EAAQof,CAAO,CAC3B,CACD,SAASC,EAAiBjvB,EAAMoD,EAAO8rB,EAAY,GAAIC,EAAc,CACnE,OAAA/rB,IAAUA,EAAQ,IACb+rB,GACH1xB,GACE,IAAOyxB,EAAU,SAAW5B,EAAiBttB,EAAMoD,EAAM,SAAU8rB,EAAU,QAAQ,CAC7F,EAEIzxB,GAAmB,IAAM2F,EAAM,KAAOA,EAAM,IAAIpD,CAAI,CAAC,EACrDvC,GAAmB,IAAM,CACvB,UAAWksB,KAAQvmB,EAAO,CACxB,GAAIumB,IAAS,YAAcA,IAAS,MAAO,SAC3C,MAAM5sB,EAAQqG,EAAMumB,CAAI,EACpB5sB,IAAUmyB,EAAUvF,CAAI,IAC5BmD,EAAY9sB,EAAM2pB,EAAM5sB,EAAOmyB,EAAUvF,CAAI,CAAC,EAC9CuF,EAAUvF,CAAI,EAAI5sB,EACnB,CACP,CAAK,EACMmyB,CACR,CACD,MAAO,CACL,OAAOE,EAAMC,EAAS,CACpB,IAAIzqB,EACJ,OAAA1I,GAAWoH,GAAW,CACpBsB,EAAWtB,EACX4pB,EAAOmC,EAASD,EAAI,CAAE,CAC9B,CAAO,EACMxqB,CACR,EACD,OAAAsoB,EACA,OAAOltB,EAAMmtB,EAAUgC,EAAc,CAC/B,OAAOhC,GAAa,WACtB1vB,GAAmBjB,GAAWyyB,EAAiBjvB,EAAMmtB,EAAQ,EAAI3wB,EAAS2yB,CAAY,CAAC,EAClFF,EAAiBjvB,EAAMmtB,EAAU,OAAWgC,CAAY,CAChE,EACD,cAAA3C,EACA,eAAAC,EACA,WAAAG,EACA,QAAQ5sB,EAAM2G,EAAM5J,EAAOkE,EAAM,CAC/B,OAAA6rB,EAAY9sB,EAAM2G,EAAM5J,EAAOkE,CAAI,EAC5BlE,CACR,EACL,WAAI0I,GACA,OAAQhI,GACR,KAAMK,GACV,gBAAIiH,GACA,IAAI5I,EAAIkzB,EAASC,EAAK,CACpB,OAAO3yB,GAAQ,IAAMR,EAAGkzB,EAASC,CAAG,CAAC,CACtC,CACL,CACA,CAEA,SAASC,GAAevyB,EAAS,CAC/B,MAAM2T,EAAW4b,GAAiBvvB,CAAO,EACzC,OAAA2T,EAAS,WAAalL,GACfkL,CACT,CCnOA,MAAe6e,GAAA,CACb,cAAc7oB,EAA2B,CACjC,MAAA3G,EAAO,IAAI4qB,GAAYjkB,CAAI,EACjC,OAAAgK,GAAS,MAAQjT,GAAa,IAAMsC,EAAK,OAAQ,GAC1CA,CACT,EACA,eAAegb,EAAwB,CAErC,MAAO,CAAE,KAAM,WAAY,KAAAA,EAAM,OAAQ,IAAK,CAChD,EACA,YAAYhb,EAAgBjD,EAAqB,CAE/CiD,EAAK,KAAOjD,EACZ,MAAM6S,EAAS5P,EAAK,OACpBgI,EAAa4H,CAAM,EACZA,EAAA,YAAcA,EAAO,oBACrBA,EAAA,KAAOA,EAAO,SACvB,EACA,YAAY5P,EAAmB2G,EAAc5J,EAAa,GAAY,CACpE,GAAI4J,IAAS,UAAW,CACtB3G,EAAK,SAAWjD,EAChB,MACF,CAEAiD,EAAK2G,CAAI,EAAI5J,CACf,EACA,WAAW6S,EAAqB5P,EAAiByvB,EAAyB,CAEpE7f,IACKA,EAAA,SAAS,OAAO5P,EAAMyvB,CAAM,EAE/BzvB,EAAK,OAAS,YAEZ4P,EAAO,eACFA,EAAA,YAAcA,EAAO,oBACrBA,EAAA,KAAOA,EAAO,WAI7B,EACA,WAAW5P,EAA4B,CACrC,OAAOA,EAAK,YACd,EACA,WAAW4P,EAAqB5P,EAAuB,CAE9C4P,EAAA,SAAS,OAAO5P,CAAI,EACvBA,aAAgB4qB,IAClB5qB,EAAK,QAAQ,CAEjB,EACA,cAAcA,EAA0C,OACtD,OAAOyH,EAAAzH,EAAK,SAAL,KAAAyH,EAAe,MACxB,EACA,cAAczH,EAA0C,CAC/C,OAAAA,EAAK,SAAS,CAAC,CACxB,EACA,eAAeA,EAAwC,CACrD,GAAIA,EAAK,OAAQ,CACf,MAAM2B,EAAW3B,EAAK,OAAO,UAAY,GACnCgD,EAAQrB,EAAS,QAAQ3B,CAAI,EAAI,EACnC,GAAAgD,EAAQrB,EAAS,OACnB,OAAOA,EAASqB,CAAK,CAEzB,CAEF,CACF,EC9DM0sB,GAAgBH,GACiBC,EACvC,EAIa5D,GAAS8D,GAAc,OAKvB,CACX,OAAApc,GACA,KAAA1R,GAAA,gBACAmD,EACA,cAAAynB,GACA,eAAAC,GACA,WAAAG,GACA,OAAAM,GACA,OAAAyC,GACA,QAAAC,GACA,WAAAnqB,GACA,IAAAoqB,EACF,EAAIH,GChCY,SAAAI,EAASjmB,EAAyB,GAAY,CACxD,OAAA6e,GAAU7e,CAAK,EACVA,EAGL,OAAOA,GAAU,SAEfA,EAAM,WAAW,GAAG,EACf,EACLA,EAAM,QAAQ,IAAK,IAAI,GAAKA,EAAM,SAAW,EAAI,KAAO,KAIxDA,EAAM,WAAW,IAAI,EAChB,OAAOA,CAAK,EAEd,EAAO,MAAQA,EAAM,SAAW,EAAIA,EAAQ,KAAOA,IAGrD,CACT,CAKO,SAASkmB,GAAQC,EAAa,CAC3B,OAAAA,EAAM,KAAK,GAAM,GAC3B,CCufA,MAAMC,GAAW,gBA2BjB,SAASC,GAAeC,EAAYC,EAAW,OAAO,SAAU,CAC9D,MAAM,EAAIA,EAASH,EAAQ,IAAMG,EAASH,EAAQ,EAAI,IAAI,KAC1D,QAAS,EAAI,EAAG/vB,EAAIiwB,EAAW,OAAQ,EAAIjwB,EAAG,IAAK,CACjD,MAAMyG,EAAOwpB,EAAW,CAAC,EACpB,EAAE,IAAIxpB,CAAI,IACb,EAAE,IAAIA,CAAI,EACVypB,EAAS,iBAAiBzpB,EAAM0pB,EAAY,EAE/C,CACH,CAmPA,SAASA,GAAax4B,EAAG,CACvB,MAAMyH,EAAM,KAAK,OAAAzH,EAAE,MACnB,IAAImI,EAAQnI,EAAE,cAAgBA,EAAE,aAAY,EAAG,CAAC,GAAMA,EAAE,OAcxD,IAbIA,EAAE,SAAWmI,GACf,OAAO,eAAenI,EAAG,SAAU,CACjC,aAAc,GACd,MAAOmI,CACb,CAAK,EAEH,OAAO,eAAenI,EAAG,gBAAiB,CACxC,aAAc,GACd,KAAM,CACJ,OAAOmI,GAAQ,QAChB,CACL,CAAG,EAEMA,GAAM,CACX,MAAMswB,EAAUtwB,EAAKV,CAAG,EACxB,GAAIgxB,GAAW,CAACtwB,EAAK,SAAU,CAC7B,MAAMrI,EAAOqI,EAAK,GAAG,OAAAV,EAAG,OAAM,EAE9B,GADA3H,IAAS,OAAY24B,EAAQ,KAAKtwB,EAAMrI,EAAME,CAAC,EAAIy4B,EAAQ,KAAKtwB,EAAMnI,CAAC,EACnEA,EAAE,aAAc,MACrB,CACDmI,EAAOA,EAAK,QAAUA,EAAK,YAAcA,EAAK,IAC/C,CACH,CAoLA,MAAMuwB,GAAW,GC5gCV,SAASC,IAAoB,CAChC,IAAIC,EAAY,IAAI,IACpB,SAASC,EAAUr0B,EAAU,CACzB,OAAAo0B,EAAU,IAAIp0B,CAAQ,EACf,IAAMo0B,EAAU,OAAOp0B,CAAQ,CACzC,CACD,IAAI0G,EAAS,GACb,SAAS4tB,EAAQC,EAAI5zB,EAAS,CAC1B,GAAI+F,EACA,MAAO,EAAEA,EAAS,IACtB,MAAMlL,EAAI,CACN,GAAA+4B,EACA,QAAA5zB,EACA,iBAAkB,GAClB,eAAgB,IAAOnF,EAAE,iBAAmB,EACxD,EACQ,UAAWqI,KAAKuwB,EACZvwB,EAAE,SAAS,CACP,GAAGrI,EACH,KAAMqI,EAAE,SACR,MAAQ2wB,GAAU,CACdA,IAAU9tB,EAAS,IACnB7C,EAAE,SAAS0wB,EAAI5zB,CAAO,CACzB,CACjB,CAAa,EACL,MAAO,CAACnF,EAAE,gBACb,CACD,MAAO,CACH,UAAA64B,EACA,QAAAC,CACR,CACA,CC9BA,MAAMG,GAAiB,wBACjBC,GAAgB,iBAEf,SAASC,GAAcC,EAAMC,EAAY,GAAO,CACnD,MAAMj0B,EAAIg0B,EAAK,QAAQF,GAAe,IAAI,EAC1C,OAAO9zB,EAAKi0B,GAAa,QAAQ,KAAKj0B,CAAC,EAAIA,EAAI,IAAMA,EAAK,EAC9D,CACO,SAASk0B,GAAYC,EAAMH,EAAMI,EAAM,CAC1C,GAAIP,GAAe,KAAKG,CAAI,EACxB,OAEJ,MAAMK,EAAWN,GAAcI,CAAI,EAC7BG,EAAWF,GAAQL,GAAcK,CAAI,EAC3C,IAAIzwB,EAAS,GACb,MAAI,CAAC2wB,GAAYN,EAAK,WAAW,GAAG,EAChCrwB,EAAS0wB,EAEJC,EAAS,cAAc,QAAQD,EAAS,YAAW,CAAE,IAAM,EAChE1wB,EAAS0wB,EAAWC,EAGpB3wB,EAAS2wB,GAEL3wB,GAAU,KAAOowB,GAAcC,EAAM,CAACrwB,CAAM,CACxD,CACO,SAAS4wB,GAAUz0B,EAAO00B,EAAS,CACtC,GAAI10B,GAAS,KACT,MAAM,IAAI,MAAM00B,CAAO,EAE3B,OAAO10B,CACX,CACO,SAAS20B,GAAUL,EAAMT,EAAI,CAChC,OAAOI,GAAcK,CAAI,EAAE,QAAQ,eAAgB,EAAE,EAAIL,GAAcJ,CAAE,CAC7E,CACO,SAASe,GAAoBp4B,EAAK,CACrC,MAAMq4B,EAAS,GACf,OAAAr4B,EAAI,aAAa,QAAQ,CAACwD,EAAOuC,IAAQ,CACrCsyB,EAAOtyB,CAAG,EAAIvC,CACtB,CAAK,EACM60B,CACX,CACO,SAASC,GAAcZ,EAAMa,EAASC,EAAc,CACvD,KAAM,CAACC,EAASC,CAAK,EAAIhB,EAAK,MAAM,KAAM,CAAC,EACrCiB,EAAWF,EAAQ,MAAM,GAAG,EAAE,OAAO,OAAO,EAC5CluB,EAAMouB,EAAS,OACrB,OAAQC,GAAa,CACjB,MAAMC,EAAcD,EAAS,MAAM,GAAG,EAAE,OAAO,OAAO,EAChDE,EAAUD,EAAY,OAAStuB,EACrC,GAAIuuB,EAAU,GAAMA,EAAU,GAAKJ,IAAU,QAAa,CAACH,EACvD,OAAO,KAEX,MAAMQ,EAAQ,CACV,KAAMxuB,EAAM,GAAK,IACjB,OAAQ,CAAE,CACtB,EACcyuB,EAAet1B,GAAM80B,IAAiB,OAAY,OAAYA,EAAa90B,CAAC,EAClF,QAASrE,EAAI,EAAGA,EAAIkL,EAAKlL,IAAK,CAC1B,MAAM45B,EAAUN,EAASt5B,CAAC,EACpB65B,EAAaL,EAAYx5B,CAAC,EAC1B+F,EAAU6zB,EAAQ,CAAC,IAAM,IACzBlzB,EAAMX,EAAU6zB,EAAQ,MAAM,CAAC,EAAIA,EACzC,GAAI7zB,GAAW+zB,GAAaD,EAAYF,EAAYjzB,CAAG,CAAC,EACpDgzB,EAAM,OAAOhzB,CAAG,EAAImzB,UAEf9zB,GAAW,CAAC+zB,GAAaD,EAAYD,CAAO,EACjD,OAAO,KAEXF,EAAM,MAAQ,IAAI,OAAAG,EACrB,CACD,GAAIR,EAAO,CACP,MAAMU,EAAYN,EAAUD,EAAY,MAAM,CAACC,CAAO,EAAE,KAAK,GAAG,EAAI,GACpE,GAAIK,GAAaC,EAAWJ,EAAYN,CAAK,CAAC,EAC1CK,EAAM,OAAOL,CAAK,EAAIU,MAGtB,QAAO,IAEd,CACD,OAAOL,CACf,CACA,CACA,SAASI,GAAa/xB,EAAOiyB,EAAQ,CACjC,MAAMC,EAAW51B,GAAMA,EAAE,cAAc0D,EAAO,OAAW,CAAE,YAAa,MAAQ,KAAM,EACtF,OAAIiyB,IAAW,OACJ,GAEF,OAAOA,GAAW,SAChBC,EAAQD,CAAM,EAEhB,OAAOA,GAAW,WAChBA,EAAOjyB,CAAK,EAEd,MAAM,QAAQiyB,CAAM,EAClBA,EAAO,KAAKC,CAAO,EAErBD,aAAkB,OAChBA,EAAO,KAAKjyB,CAAK,EAErB,EACX,CACO,SAASmyB,GAAWC,EAAO,CAC9B,KAAM,CAACf,EAASC,CAAK,EAAIc,EAAM,QAAQ,MAAM,KAAM,CAAC,EAC9Cb,EAAWF,EAAQ,MAAM,GAAG,EAAE,OAAO,OAAO,EAClD,OAAOE,EAAS,OAAO,CAACc,EAAOR,IAAYQ,GAASR,EAAQ,WAAW,GAAG,EAAI,EAAI,GAAIN,EAAS,QAAUD,IAAU,OAAY,EAAI,EAAE,CACzI,CACO,SAASgB,GAAiB92B,EAAI,CACjC,MAAMsyB,EAAM,IAAI,IACVnyB,EAAQwE,KACd,OAAO,IAAI,MAAM,GAAI,CACjB,IAAIqE,EAAGC,EAAU,CACb,OAAKqpB,EAAI,IAAIrpB,CAAQ,GACjBrE,GAAazE,EAAO,IAAMmyB,EAAI,IAAIrpB,EAAUtH,GAAW,IAAM3B,EAAI,EAACiJ,CAAQ,CAAC,CAAC,CAAC,EAE1EqpB,EAAI,IAAIrpB,CAAQ,GAC1B,EACD,0BAA2B,CACvB,MAAO,CACH,WAAY,GACZ,aAAc,EAC9B,CACS,EACD,SAAU,CACN,OAAO,QAAQ,QAAQjJ,EAAE,CAAE,CAC9B,CACT,CAAK,CACL,CAcO,SAAS+2B,GAAgBlB,EAAS,CACrC,IAAIM,EAAQ,kBAAkB,KAAKN,CAAO,EAC1C,GAAI,CAACM,EACD,MAAO,CAACN,CAAO,EACnB,IAAImB,EAASnB,EAAQ,MAAM,EAAGM,EAAM,KAAK,EACrC1Q,EAASoQ,EAAQ,MAAMM,EAAM,MAAQA,EAAM,CAAC,EAAE,MAAM,EACxD,MAAMc,EAAW,CAACD,EAASA,GAAUb,EAAM,CAAC,GAM5C,KAAQA,EAAQ,kBAAkB,KAAK1Q,CAAM,GACzCwR,EAAS,KAAMD,GAAUb,EAAM,CAAC,CAAC,EACjC1Q,EAASA,EAAO,MAAM0Q,EAAM,CAAC,EAAE,MAAM,EAEzC,OAAOY,GAAgBtR,CAAM,EAAE,OAAO,CAACze,EAASkwB,IAAc,CAAC,GAAGlwB,EAAS,GAAGiwB,EAAS,IAAI/zB,GAAKA,EAAIg0B,CAAS,CAAC,EAAG,EAAE,CACvH,CCzJA,MAAMC,GAAgB,IACTC,GAAmBjyB,GAAa,EAChCkyB,GAAkBlyB,GAAa,EAC/BmyB,GAAY,IAAMjC,GAAU3zB,GAAW01B,EAAgB,EAAG,+CAA+C,EAEzGG,GAAW,IAAmB71B,GAAW21B,EAAe,GAAKC,GAAS,EAAG,KAYzEE,GAAc,IAAMF,KAAY,mBAChCG,GAAc,IAAMH,GAAW,EAAC,SAahCI,GAAY,IAAMH,GAAU,EAAC,OAsBnC,SAASI,GAAaC,EAAU3C,EAAO,GAAI,CAC9C,KAAM,CAAE,UAAA4C,EAAW,KAAAt0B,EAAM,SAAAiC,EAAU,SAAAsyB,CAAQ,EAAKF,EAC1CG,EAAS,CAACvyB,GAAa,MAAM,QAAQA,CAAQ,GAAK,CAACA,EAAS,OAC5DwyB,EAAS,CACX,IAAKJ,EACL,UAAAC,EACA,KAAAt0B,EACA,SAAAu0B,CACR,EACI,OAAOG,GAAQL,EAAS,IAAI,EAAE,OAAO,CAACtd,EAAKwa,IAAS,CAChD,UAAWoD,KAAgBnB,GAAgBjC,CAAI,EAAG,CAC9C,MAAMA,EAAOS,GAAUN,EAAMiD,CAAY,EACnCrC,EAAUkC,EAASjD,EAAOA,EAAK,MAAM,KAAM,CAAC,EAAE,CAAC,EACrDxa,EAAI,KAAK,CACL,GAAG0d,EACH,aAAAE,EACA,QAAArC,EACA,QAASH,GAAcG,EAAS,CAACkC,EAAQH,EAAS,YAAY,CAC9E,CAAa,CACJ,CACD,OAAOtd,CACV,EAAE,CAAE,EACT,CACO,SAAS6d,GAAaC,EAAQvxB,EAAQ,EAAG,CAC5C,MAAO,CACH,OAAAuxB,EACA,MAAOzB,GAAWyB,EAAOA,EAAO,OAAS,CAAC,CAAC,EAAI,IAAQvxB,EACvD,QAAQmvB,EAAU,CACd,MAAMx3B,EAAU,GAChB,QAAS/B,EAAI27B,EAAO,OAAS,EAAG37B,GAAK,EAAGA,IAAK,CACzC,MAAMm6B,EAAQwB,EAAO37B,CAAC,EAChB05B,EAAQS,EAAM,QAAQZ,CAAQ,EACpC,GAAI,CAACG,EACD,OAAO,KAEX33B,EAAQ,QAAQ,CACZ,GAAG23B,EACH,MAAAS,CACpB,CAAiB,CACJ,CACD,OAAOp4B,CACV,CACT,CACA,CACA,SAASy5B,GAAQr3B,EAAO,CACpB,OAAO,MAAM,QAAQA,CAAK,EAAIA,EAAQ,CAACA,CAAK,CAChD,CACO,SAASy3B,GAAeT,EAAU3C,EAAO,GAAIqD,EAAQ,CAAE,EAAEC,EAAW,GAAI,CAC3E,MAAMC,EAAYP,GAAQL,CAAQ,EAClC,QAASn7B,EAAI,EAAGkL,EAAM6wB,EAAU,OAAQ/7B,EAAIkL,EAAKlL,IAAK,CAClD,MAAMg8B,EAAMD,EAAU/7B,CAAC,EACvB,GAAIg8B,GAAO,OAAOA,GAAQ,SAAU,CAC3BA,EAAI,eAAe,MAAM,IAC1BA,EAAI,KAAO,IACf,MAAML,EAAST,GAAac,EAAKxD,CAAI,EACrC,UAAW2B,KAASwB,EAAQ,CACxBE,EAAM,KAAK1B,CAAK,EAChB,MAAM8B,EAAe,MAAM,QAAQD,EAAI,QAAQ,GAAKA,EAAI,SAAS,SAAW,EAC5E,GAAIA,EAAI,UAAY,CAACC,EACjBL,GAAeI,EAAI,SAAU7B,EAAM,QAAS0B,EAAOC,CAAQ,MAE1D,CACD,MAAMI,EAASR,GAAa,CAAC,GAAGG,CAAK,EAAGC,EAAS,MAAM,EACvDA,EAAS,KAAKI,CAAM,CACvB,CACDL,EAAM,IAAG,CACZ,CACJ,CACJ,CAED,OAAOA,EAAM,OAASC,EAAWA,EAAS,KAAK,CAACz5B,EAAGC,IAAMA,EAAE,MAAQD,EAAE,KAAK,CAC9E,CACO,SAAS85B,GAAgBL,EAAUvC,EAAU,CAChD,QAASv5B,EAAI,EAAGkL,EAAM4wB,EAAS,OAAQ97B,EAAIkL,EAAKlL,IAAK,CACjD,MAAM05B,EAAQoC,EAAS97B,CAAC,EAAE,QAAQu5B,CAAQ,EAC1C,GAAIG,EACA,OAAOA,CAEd,CACD,MAAO,EACX,CACO,SAAS0C,GAAe/D,EAAM/xB,EAAO,CACxC,MAAM+1B,EAAS,IAAI,IAAI,YAAY,EAC7B17B,EAAMuE,GAAWmD,GAAQ,CAC3B,MAAMi0B,EAAQjE,IACd,GAAI,CACA,OAAO,IAAI,IAAIiE,EAAOD,CAAM,CAC/B,OACMz1B,EAAK,CACR,eAAQ,MAAM,gBAAgB,OAAA01B,EAAO,EAC9Bj0B,CACV,CACJ,EAAEg0B,EAAQ,CACP,OAAQ,CAACh6B,EAAGC,IAAMD,EAAE,OAASC,EAAE,IACvC,CAAK,EACKi6B,EAAWr3B,GAAW,IAAMvE,EAAK,EAAC,QAAQ,EAC1C67B,EAASt3B,GAAW,IAAMvE,EAAG,EAAG,OAAQ,EAAI,EAC5C87B,EAAOv3B,GAAW,IAAMvE,EAAK,EAAC,IAAI,EAClC+F,EAAM,IAAM,GAClB,MAAO,CACH,IAAI,UAAW,CACX,OAAO61B,EAAQ,CAClB,EACD,IAAI,QAAS,CACT,OAAOC,EAAM,CAChB,EACD,IAAI,MAAO,CACP,OAAOC,EAAI,CACd,EACD,IAAI,OAAQ,CACR,OAAOn2B,EAAK,CACf,EACD,IAAI,KAAM,CACN,OAAOI,EAAG,CACb,EACD,MAAO2zB,GAAiB5yB,GAAG+0B,EAAQ,IAAMzD,GAAoBp4B,EAAK,EAAC,CAAC,CAC5E,CACA,CACA,IAAI+7B,GAIG,SAASC,GAAoBC,EAAaC,EAAaz4B,EAAU,GAAI,CACxE,KAAM,CAAE,OAAQ,CAACqB,EAAQq3B,CAAS,EAAG,MAAAC,EAAQ,EAAI,EAAGH,EAC9CI,EAAYD,EAAM,YAAct2B,GAAKA,GACrCw2B,EAAaF,EAAM,aAAet2B,GAAKA,GACvCy2B,EAAcH,EAAM,aAAenF,GAAiB,EACpDc,EAAWH,GAAY,GAAIn0B,EAAQ,MAAQ,EAAE,EACnD,GAAIs0B,IAAa,OACb,MAAM,IAAI,MAAM,GAAG,OAAAA,EAAQ,4BAA2B,EAEjDA,GAAY,CAACjzB,EAAQ,EAAC,OAC3Bq3B,EAAU,CAAE,MAAOpE,EAAU,QAAS,GAAM,OAAQ,EAAK,CAAE,EAE/D,KAAM,CAACyE,EAAWC,CAAY,EAAIl5B,EAAa,EAAK,EAC9C0H,EAAQ,MAAOukB,GAAa,CAC9BiN,EAAa,EAAI,EACjB,GAAI,CACA,MAAM50B,GAAgB2nB,CAAQ,CACjC,QACO,CACJiN,EAAa,EAAK,CACrB,CACT,EACU,CAACC,EAAWC,CAAY,EAAIp5B,EAAauB,EAAM,EAAG,KAAK,EACvD,CAACa,EAAOC,CAAQ,EAAIrC,EAAauB,EAAM,EAAG,KAAK,EAC/C8zB,EAAW6C,GAAeiB,EAAW/2B,CAAK,EAC1Ci3B,EAAY,GACZC,EAAct5B,EAA0C,EAAE,EAC1Du5B,EAAY,CACd,QAAS/E,EACT,OAAQ,CAAE,EACV,KAAM,IAAMA,EACZ,OAAQ,IAAM,KACd,YAAYV,EAAI,CACZ,OAAOO,GAAYG,EAAUV,CAAE,CAClC,CACT,EACI,OAAAnzB,GAAmB,IAAM,CACrB,KAAM,CAAE,MAAAV,EAAO,MAAAmC,CAAO,EAAGb,EAAM,EAE/B1B,GAAQ,IAAM,CACNI,IAAUk5B,KACVzxB,EAAM,IAAM,CACR8wB,GAAS,SACTY,EAAan5B,CAAK,EAClBoC,EAASD,CAAK,EAEdk3B,EAAY,CAAC,EAAE,EAAE,CACrC,CAAiB,EAAE,KAAK,IAAM,CACVd,GAAS,MAC7B,CAAiB,CAEjB,CAAS,CACT,CAAK,EACM,CACH,KAAMe,EACN,SAAAlE,EACA,UAAA4D,EACA,WAAAF,EACA,UAAAD,EACA,iBAAAU,EACA,YAAAR,EACA,aAAAS,EACA,YAAAH,CACR,EACI,SAASI,EAAkBzD,EAAOnC,EAAI5zB,EAAS,CAE3CL,GAAQ,IAAM,CACV,GAAI,OAAOi0B,GAAO,SAAU,CACnBA,IAGI+E,EAAM,GACXG,EAAY,QAAQlF,EAAI5zB,CAAO,GAAK24B,EAAM,GAAG/E,CAAE,EAG/C,QAAQ,KAAK,sDAAsD,GAEvE,MACH,CACD,KAAM,CAAE,QAAA6F,EAAS,QAAArpB,EAAS,OAAAspB,EAAQ,MAAOC,CAAS,EAAK,CACnD,QAAS,GACT,QAAS,GACT,OAAQ,GACR,GAAG35B,CACnB,EACkB45B,GAAaxpB,EAAU2lB,EAAM,YAAYnC,CAAE,EAAIO,GAAY,GAAIP,CAAE,EACvE,GAAIgG,KAAe,OACf,MAAM,IAAI,MAAM,SAAS,OAAAhG,EAAE,2BAA0B,EAEpD,GAAIuF,EAAU,QAAU7C,GACzB,MAAM,IAAI,MAAM,oBAAoB,EAExC,MAAM92B,GAAUy5B,IAChB,IAAIW,KAAep6B,IAAWm6B,IAAcz3B,EAAK,IACzC,CAAAqxB,IAMC,GAAIuF,EAAY,QAAQc,GAAY55B,CAAO,EAAG,CAC/C,MAAM8G,GAAMqyB,EAAU,KAAK,CAAE,MAAO35B,GAAS,QAAAi6B,EAAS,OAAAC,EAAQ,MAAOx3B,EAAK,CAAI,GAC9EsF,EAAM,IAAM,CACR8wB,GAAS,WACTY,EAAaU,EAAU,EACvBz3B,EAASw3B,CAAS,EAElBP,EAAY,CAAC,EAAE,EAAE,CACzC,CAAqB,EAAE,KAAK,IAAM,CACND,EAAU,SAAWryB,KACrBwxB,GAAS,OACTuB,EAAY,CACR,MAAOD,GACP,MAAOD,CACvC,CAA6B,EAE7B,CAAqB,CACJ,EAEjB,CAAS,CACJ,CACD,SAASL,EAAiBvD,EAAO,CAE7B,OAAAA,EAAQA,GAASl1B,GAAW21B,EAAe,GAAK6C,EACzC,CAACzF,EAAI5zB,IAAYw5B,EAAkBzD,EAAOnC,EAAI5zB,CAAO,CAC/D,CACD,SAAS65B,EAAY1hB,EAAM,CACvB,MAAM2hB,EAAQX,EAAU,CAAC,EACrBW,KACI3hB,EAAK,QAAU2hB,EAAM,OAAS3hB,EAAK,QAAU2hB,EAAM,QACnDpB,EAAU,CACN,GAAGvgB,EACH,QAAS2hB,EAAM,QACf,OAAQA,EAAM,MAClC,CAAiB,EAELX,EAAU,OAAS,EAE1B,CACD,SAASI,EAAah9B,EAAKw9B,EAAa,CACpC,MAAMp8B,EAAUo6B,GAAgBU,EAAa,EAAEl8B,EAAI,QAAQ,EACrDy9B,EAAa1B,GACnBA,GAAS,UACT,QAAShD,KAAS33B,EAAS,CACvB,KAAM,CAAE,MAAAo4B,EAAO,OAAAnB,CAAQ,EAAGj3B,EAAQ23B,CAAK,EACvCS,EAAM,WACFA,EAAM,UAAU,SAChBA,EAAM,UAAU,UACpBgE,GACIhE,EAAM,MACNA,EAAM,KAAK,CACP,OAAAnB,EACA,SAAU,CACN,SAAUr4B,EAAI,SACd,OAAQA,EAAI,OACZ,KAAMA,EAAI,KACV,MAAOo4B,GAAoBp4B,CAAG,EAC9B,MAAO,KACP,IAAK,EACR,EACD,OAAQ,SAC5B,CAAiB,CACR,CACD+7B,GAAS0B,CACZ,CAKL,CACO,SAASC,GAAmBC,EAAQtnB,EAAQunB,EAAQ7E,EAAOV,EAAQ,CACtE,KAAM,CAAE,KAAAR,EAAM,SAAAe,CAAU,EAAG+E,EACrB,CAAE,QAAAlF,EAAS,UAAAgC,EAAW,KAAAt0B,CAAI,EAAK4yB,EAAO,EAAC,MACvCrB,EAAOnzB,GAAW,IAAMw0B,EAAO,EAAC,IAAI,EAC1C0B,GACIA,EAAU,SACVA,EAAU,QAAO,EACrB,MAAMr8B,EAAO+H,EAAOA,EAAK,CAAE,OAAAkyB,EAAQ,SAAAO,EAAU,OAAQmD,IAAU,SAAW,GAAI,OAoB9E,MAnBc,CACV,OAAA1lB,EACA,QAAAoiB,EACA,KAAAf,EACA,OAAAW,EACA,OAAQ,IAAMoC,EACRjvB,GAAgBivB,EAAW,CACzB,OAAApC,EACA,SAAAO,EACA,KAAAx6B,EACA,IAAI,UAAW,CACX,OAAOw/B,EAAM,CAChB,CACjB,CAAa,EACCA,EAAQ,EACd,YAAYvG,EAAI,CACZ,OAAOO,GAAYC,EAAK,KAAM,EAAER,EAAIK,EAAI,CAAE,CAC7C,CACT,CAEA,CCpXO,MAAMmG,GAAyBF,GAAY9zB,GAAU,CACxD,KAAM,CAAEguB,MAAM,EAAGhuB,EACXuxB,EAAYhzB,GAAS,IAAMyB,EAAMzB,QAAQ,EACzC+yB,EAAW52B,GAAW,IAAM02B,GAAepxB,EAAM3G,KAAO,CAAEu3B,UAAW5wB,EAAM3G,KAAMkF,SAAUgzB,EAAU,CAAG,EAAGA,EAAS,EAAIvxB,EAAMguB,MAAQ,EAAE,CAAC,EACzIiG,EAAc9B,GAAoB2B,EAAQxC,EAAU,CAAEtD,MAAK,CAAC,EAClE8F,SAAOI,QAAUJ,EAAOI,OAAOD,CAAW,EAC1CE,EAAShE,GAAiBiE,SAAQ,CAACz6B,MAAOs6B,EAAW,IAAA11B,UAAA,QAAA41B,EAClDE,GAAM,CAACJ,YAAaA,EAAW,IAAE3C,UAAQ,QAAEA,EAAQ,CAAE,MAE5D,EACA,SAAS+C,GAAOr0B,EAAO,CACnB,MAAMzI,EAAUmD,GAAW,IAAMi3B,GAAgB3xB,EAAMsxB,SAAUtxB,EAAMi0B,YAAYlF,SAASgD,QAAQ,CAAC,EAY/FvD,EAASqB,GAAiB,IAAM,CAClC,MAAM5e,EAAI1Z,IACJi3B,EAAS,GACf,QAASh5B,EAAI,EAAGA,EAAIyb,EAAE7O,OAAQ5M,IAC1B8+B,OAAOC,OAAO/F,EAAQvd,EAAEzb,CAAC,EAAEg5B,MAAM,EAErC,OAAOA,CACX,CAAC,EACK/tB,EAAY,GAClB,IAAIpH,EACJ,MAAMm7B,EAAc95B,GAAWuC,GAAG1F,EAAS,CAACk9B,EAAaC,EAAa72B,IAAS,CAC3E,IAAI82B,EAAQD,GAAeD,EAAYryB,SAAWsyB,EAAYtyB,OAC9D,MAAM2P,EAAO,GACb,QAASvc,EAAI,EAAGkL,EAAM+zB,EAAYryB,OAAQ5M,EAAIkL,EAAKlL,IAAK,CACpD,MAAMo/B,EAAYF,GAAeA,EAAYl/B,CAAC,EACxCq/B,EAAYJ,EAAYj/B,CAAC,EAC3BqI,GAAQ+2B,GAAaC,EAAUlF,MAAMzzB,MAAQ04B,EAAUjF,MAAMzzB,IAC7D6V,EAAKvc,CAAC,EAAIqI,EAAKrI,CAAC,GAGhBm/B,EAAQ,GACJl0B,EAAUjL,CAAC,GACXiL,EAAUjL,CAAC,IAEfsD,GAAWoH,GAAW,CAClBO,EAAUjL,CAAC,EAAI0K,EACf6R,EAAKvc,CAAC,EAAIq+B,GAAmB7zB,EAAMi0B,YAAaliB,EAAKvc,EAAI,CAAC,GAAKwK,EAAMi0B,YAAYjG,KAAM8G,GAAa,IAAMN,IAAch/B,EAAI,CAAC,CAAC,EAAG,IAAM+B,EAAS,EAAC/B,CAAC,EAAGg5B,CAAM,CAC/J,CAAC,EAET,CAEA,OADA/tB,EAAUs0B,OAAON,EAAYryB,MAAM,EAAEqmB,QAAQvoB,GAAWA,EAAO,CAAE,EAC7DrC,GAAQ82B,EACD92B,GAEXxE,EAAO0Y,EAAK,CAAC,EACNA,EACV,EAAC,EACF,OAAAoiB,EAASzwB,GAAI,KAACsxB,MAAI,QAAER,EAAa,GAAIn7B,CAAI,EAAEsK,MAAK,GAAApF,SAC7CoxB,GAAKwE,EAAK/D,GAAgBgE,SAAQ,CAACz6B,MAAOg2B,EAAK,IAAApxB,UAAA,QAAGoxB,EAAMoE,QAAQ,GAA4B,EAEnG,CACA,MAAMe,GAAgBjxB,GACX,IAAAswB,EAAQzwB,GAAI,KAACsxB,MAAI,QAAEnxB,EAAK,CAAE,EAAEF,MAAK,GAAApF,SACrCsF,GAAKswB,EAAK/D,GAAgBgE,SAAQ,CAACz6B,MAAOkK,EAAK,IAAAtF,UAAA,QAAGsF,EAAMkwB,QAAQ,IAC3D,EAECkB,GAASj1B,GAAU,CAC5B,MAAMk1B,EAAc32B,GAAS,IAAMyB,EAAMzB,QAAQ,EACjD,OAAO8D,GAAWrC,EAAO,CACrB,IAAIzB,UAAW,CACX,OAAO22B,EAAW,CACtB,CACJ,CAAC,CACL,EC/EA,SAASC,GAAU,CAACx7B,EAAO8B,CAAQ,EAAG25B,EAAK1zB,EAAK,CAC5C,MAAO,CAAC0zB,EAAM,IAAMA,EAAIz7B,EAAO,GAAIA,EAAO+H,EAAO9G,GAAMa,EAASiG,EAAI9G,CAAC,CAAC,EAAIa,CAAQ,CACtF,CACA,SAAS45B,GAAcC,EAAU,CAC7B,GAAIA,IAAa,IACb,OAAO,KAGX,GAAI,CACA,OAAO,SAAS,cAAcA,CAAQ,CACzC,OACM7gC,EAAG,CACN,OAAO,IACV,CACL,CACO,SAAS8gC,GAAavQ,EAAQ,CACjC,IAAIrlB,EAAS,GACb,MAAM61B,EAAQ77B,GAAW,OAAOA,GAAU,SAAW,CAAE,MAAAA,GAAUA,EAC3D87B,EAASN,GAAUz7B,EAAa87B,EAAKxQ,EAAO,IAAG,CAAE,EAAG,CAAE,OAAQ,CAACntB,EAAGC,IAAMD,EAAE,QAAUC,EAAE,MAAO,EAAG,OAAWia,IAC7G,CAACpS,GAAUqlB,EAAO,IAAIjT,CAAI,EACnBA,EACV,EACD,OAAAiT,EAAO,MACHjoB,GAAUioB,EAAO,KAAK,CAACrrB,EAAQqrB,EAAO,QAAU,CAC5CrlB,EAAS,GACT81B,EAAO,CAAC,EAAED,EAAK77B,CAAK,CAAC,EACrBgG,EAAS,EACZ,EAAC,EACCq0B,GAAsB,CACzB,OAAAyB,EACA,OAAQzQ,EAAO,OACf,MAAOA,EAAO,KACtB,CAAK,CACL,CACO,SAAS0Q,GAAUjzB,EAAQvN,EAAMg4B,EAAS,CAC7C,OAAAzqB,EAAO,iBAAiBvN,EAAMg4B,CAAO,EAC9B,IAAMzqB,EAAO,oBAAoBvN,EAAMg4B,CAAO,CACzD,CACO,SAASyI,GAAa1D,EAAM2D,EAAa,CAC5C,MAAMnK,EAAK4J,GAAc,IAAI,OAAApD,EAAM,EAC/BxG,EACAA,EAAG,eAAc,EAEZmK,GACL,OAAO,SAAS,EAAG,CAAC,CAE5B,CC3CO,MAAMC,GAA0B,IAAI,ICFpC,SAASC,GAAkBC,EAAU,GAAMC,EAAgB,GAAOC,EAAa,WAAY,CAC9F,OAAQnC,GAAW,CACf,MAAM5F,EAAW4F,EAAO,KAAK,KAAI,EAC3BV,EAAoBU,EAAO,iBAAiBA,EAAO,IAAI,EAC7D,IAAIoC,EAAiB,GACrB,SAASC,EAAM1K,EAAI,CACf,OAAOA,EAAG,eAAiB,4BAC9B,CACD,SAAS2K,EAAaC,EAAK,CACvB,GAAIA,EAAI,kBACJA,EAAI,SAAW,GACfA,EAAI,SACJA,EAAI,QACJA,EAAI,SACJA,EAAI,SACJ,OACJ,MAAMx+B,EAAIw+B,EACL,aAAc,EACd,KAAK5K,GAAMA,aAAc,MAAQA,EAAG,SAAS,gBAAkB,GAAG,EACvE,GAAI,CAAC5zB,GAAMm+B,GAAiB,CAACn+B,EAAE,aAAa,MAAM,EAC9C,OACJ,MAAMy+B,EAAMH,EAAMt+B,CAAC,EACb0+B,EAAOD,EAAMz+B,EAAE,KAAK,QAAUA,EAAE,KAEtC,IADey+B,EAAMz+B,EAAE,OAAO,QAAUA,EAAE,SAC3B,CAAC0+B,GAAQ,CAAC1+B,EAAE,aAAa,OAAO,EAC3C,OACJ,MAAM2+B,GAAO3+B,EAAE,aAAa,KAAK,GAAK,IAAI,MAAM,KAAK,EACrD,GAAIA,EAAE,aAAa,UAAU,GAAM2+B,GAAOA,EAAI,SAAS,UAAU,EAC7D,OACJ,MAAMrgC,EAAMmgC,EAAM,IAAI,IAAIC,EAAM,SAAS,OAAO,EAAI,IAAI,IAAIA,CAAI,EAChE,GAAI,EAAApgC,EAAI,SAAW,OAAO,SAAS,QAC9B+3B,GAAY/3B,EAAI,UAAY,CAACA,EAAI,SAAS,YAAW,EAAG,WAAW+3B,EAAS,YAAa,IAE9F,MAAO,CAACr2B,EAAG1B,CAAG,CACjB,CACD,SAASsgC,EAAkBJ,EAAK,CAC5B,MAAM92B,EAAM62B,EAAaC,CAAG,EAC5B,GAAI,CAAC92B,EACD,OACJ,KAAM,CAAC1H,EAAG1B,CAAG,EAAIoJ,EACXiuB,EAAKsG,EAAO,UAAU39B,EAAI,SAAWA,EAAI,OAASA,EAAI,IAAI,EAC1D2F,EAAQjE,EAAE,aAAa,OAAO,EACpCw+B,EAAI,eAAc,EAClBjD,EAAkB5F,EAAI,CAClB,QAAS,GACT,QAAS31B,EAAE,aAAa,SAAS,EACjC,OAAQ,CAACA,EAAE,aAAa,UAAU,EAClC,MAAOiE,GAAS,KAAK,MAAMA,CAAK,CAChD,CAAa,CACJ,CACD,SAAS46B,EAAoBL,EAAK,CAC9B,MAAM92B,EAAM62B,EAAaC,CAAG,EAC5B,GAAI,CAAC92B,EACD,OACJ,KAAM,CAAC1H,EAAG1B,CAAG,EAAIoJ,EACZ22B,EAAe//B,EAAI,QAAQ,GAC5B29B,EAAO,aAAa39B,EAAK0B,EAAE,aAAa,SAAS,IAAM,OAAO,CACrE,CACD,SAAS8+B,EAAeN,EAAK,CACzB,MAAM92B,EAAM62B,EAAaC,CAAG,EAC5B,GAAI,CAAC92B,EACD,OACJ,KAAM,CAAC1H,EAAG1B,CAAG,EAAIoJ,EACb22B,EAAe//B,EAAI,QAAQ,IAE/B+/B,EAAe//B,EAAI,QAAQ,EAAI,WAAW,IAAM,CAC5C29B,EAAO,aAAa39B,EAAK0B,EAAE,aAAa,SAAS,IAAM,OAAO,EAC9D,OAAOq+B,EAAe//B,EAAI,QAAQ,CACrC,EAAE,GAAG,EACT,CACD,SAASygC,EAAgBP,EAAK,CAC1B,MAAM92B,EAAM62B,EAAaC,CAAG,EAC5B,GAAI,CAAC92B,EACD,OACJ,KAAM,CAAG,CAAApJ,CAAG,EAAIoJ,EACZ22B,EAAe//B,EAAI,QAAQ,IAC3B,aAAa+/B,EAAe//B,EAAI,QAAQ,CAAC,EACzC,OAAO+/B,EAAe//B,EAAI,QAAQ,EAEzC,CACD,SAAS0gC,EAAiBR,EAAK,CAC3B,IAAIS,EAAYT,EAAI,WAAaA,EAAI,UAAU,aAAa,YAAY,EAClEA,EAAI,UAAU,WACdA,EAAI,OAAO,OACjB,GAAI,CAACS,EACD,OACJ,GAAI,CAACA,EAAU,WAAW,SAAS,EAAG,CAClC,MAAM3gC,EAAM,IAAI,IAAI2gC,CAAS,EAE7B,GADAA,EAAYhD,EAAO,UAAU39B,EAAI,SAAWA,EAAI,MAAM,EAClD,CAAC2gC,EAAU,WAAWb,CAAU,EAChC,MACP,CACD,GAAII,EAAI,OAAO,OAAO,YAAa,IAAK,OACpC,MAAM,IAAI,MAAM,2CAA2C,EAC/D,MAAMnJ,EAAU2I,GAAQ,IAAIiB,CAAS,EACrC,GAAI5J,EAAS,CACTmJ,EAAI,eAAc,EAClB,MAAM9hC,EAAO,IAAI,SAAS8hC,EAAI,MAAM,EACpCnJ,EAAQ,KAAK4G,EAAQv/B,CAAI,CAC5B,CACJ,CAEDu4B,GAAe,CAAC,QAAS,QAAQ,CAAC,EAClC,SAAS,iBAAiB,QAAS2J,CAAiB,EAChDV,IACA,SAAS,iBAAiB,YAAaY,CAAc,EACrD,SAAS,iBAAiB,WAAYC,CAAe,EACrD,SAAS,iBAAiB,UAAWF,CAAmB,EACxD,SAAS,iBAAiB,aAAcA,CAAmB,GAE/D,SAAS,iBAAiB,SAAUG,CAAgB,EACpD95B,GAAU,IAAM,CACZ,SAAS,oBAAoB,QAAS05B,CAAiB,EACnDV,IACA,SAAS,oBAAoB,YAAaY,CAAc,EACxD,SAAS,oBAAoB,WAAYC,CAAe,EACxD,SAAS,oBAAoB,UAAWF,CAAmB,EAC3D,SAAS,oBAAoB,aAAcA,CAAmB,GAElE,SAAS,oBAAoB,SAAUG,CAAgB,CACnE,CAAS,CACT,CACA,CC3HO,SAASE,GAAWz/B,EAAK,CAC5B,MAAMk2B,EAAKl2B,EAAI,QAAQ,QAAS,EAAE,EAIlC,GAAI,CAACk2B,EAAG,WAAW,GAAG,EAAG,CACrB,KAAM,CAAG,CAAAK,EAAO,GAAG,EAAI,OAAO,SAAS,KAAK,MAAM,IAAK,CAAC,EACxD,MAAO,GAAG,OAAAA,EAAI,KAAI,OAAAL,EACrB,CACD,OAAOA,CACX,CACO,SAASwJ,GAAWh3B,EAAO,CAC9B,OAAOu1B,GAAa,CAChB,IAAK,IAAM,OAAO,SAAS,KAAK,MAAM,CAAC,EACvC,IAAI,CAAE,MAAA57B,EAAO,QAAA05B,EAAS,OAAAC,EAAQ,MAAAx3B,CAAK,EAAI,CAC/Bu3B,EACA,OAAO,QAAQ,aAAav3B,EAAO,GAAI,IAAMnC,CAAK,EAGlD,OAAO,SAAS,KAAOA,EAE3B,MAAMs9B,EAAYt9B,EAAM,QAAQ,GAAG,EAC7Bs4B,EAAOgF,GAAa,EAAIt9B,EAAM,MAAMs9B,EAAY,CAAC,EAAI,GAC3DtB,GAAa1D,EAAMqB,CAAM,CAC5B,EACD,KAAM4D,GAAUxB,GAAU,OAAQ,aAAc,IAAMwB,GAAQ,EAC9D,OAAQpB,GAAkB91B,EAAM,QAASA,EAAM,cAAeA,EAAM,UAAU,EAC9E,MAAO,CACH,GAAI6M,GAAS,OAAO,QAAQ,GAAGA,CAAK,EACpC,WAAYghB,GAAQ,IAAI,OAAAA,GACxB,UAAWkJ,EACd,CACT,CAAK,EAAE/2B,CAAK,CACZ,CC7BA,IAAIm3B,GAAoB,CAAC,CAACrzB,GAkEtBszB,GAAeD,GAASp+B,GAAO2E,GAAU,EAAGX,GAAUhE,CAAE,EAAIA,EAAKgE,GCnErE,SAASs6B,GAAkB50B,EAAQvN,EAAMg4B,EAAStzB,EAAS,CACzD,OAAA6I,EAAO,iBAAiBvN,EAAMg4B,EAAStzB,CAAO,EACvCw9B,GAAa30B,EAAO,oBAAoB,KAAKA,EAAQvN,EAAMg4B,EAAStzB,CAAO,CAAC,CACrF,CCeA,SAAS09B,GAAoBC,EAASv+B,EAAgB0E,KAAY,CAChE,IAAI2vB,EAAY,EAAG1zB,EAAO69B,EAC1B,MAAO,KACLnK,IACAtwB,GAAU,IAAM,CACdswB,IACA,eAAe,IAAM,CACf,CAACA,GAAamK,IAChBA,IACAA,EAAc79B,EAAQ,OAEhC,CAAO,CACP,CAAK,EACI69B,GACH1+B,GAAYoH,GAAYvG,EAAQ49B,EAAQC,EAAct3B,CAAO,EAAGlH,CAAa,EAExEW,EAEX,CC1BA,IAAI89B,GAAkCH,GACpC,IAAM,CAIJ,KAAM,CAAChjC,EAAOojC,CAAQ,EAAIh+B,EAAa,IAAI,EAC3C,OAAA29B,GAAkB,OAAQ,UAAY,GAAM,CAC1CK,EAAS,CAAC,EACV,WAAW,IAAMA,EAAS,IAAI,CAAC,CACrC,CAAK,EACMpjC,CACR,CACH,ECXO,SAAS6wB,GAAO5jB,EAAM,CACzB,OAAO,OAAOA,GAAS,UAC3B,CAqCO,SAASqD,GAAahB,EAAWyqB,EAAS,CAC7C,GAAI,CAACzqB,EACD,MAAM,IAAI,MAAMyqB,GAAW,kBAAkB,CAErD,CCvCA,IAAIsJ,GAAS,CACT,KAAM,YACN,MAAO,aACP,GAAI,UACJ,KAAM,YACN,MAAO,QACP,KAAM,GACV,EACA,KAAM,CAACC,GAAWC,EAAY,EAAIn+B,EAAa,CAAE,GAEpCo+B,GAAkB,CAACC,EAAa,KAAO,CAChD,MAAMC,EAAgBP,KACtBE,GAAS,CACL,GAAGA,GACH,GAAGI,CACX,EACI,MAAME,EAAgB,OAAO,QAAQN,EAAM,EAC3C,OAAAr9B,GAAa2C,GAAG8G,GAAe,CAACm0B,EAAmBC,EAAgBC,EAAgB,KAAO,OAEtF,IAAIh/B,EAAU8+B,EACd,MAAMG,EAAK,GACX,KAAOj/B,GACEA,EAAQ,OAAO,IAAI,OAAO,IAC3BA,EAAQ,OAAO,IAAI,OAAO,EAC1B+rB,GAAO/rB,EAAQ,OAAO,GAClBA,EAAQ,QAAQ,KAAKA,EAAS8+B,EAAmBC,GAAA,KAAAA,EAAkB,IAAI,GAG/EE,EAAG,KAAKj/B,CAAO,EACfA,GAAUiL,EAAAjL,EAAQ,SAAR,KAAAiL,EAAkB,KAEhC,OAAA+zB,EAAc,QAASE,GAAQ,CACtBD,EAAG,SAASC,CAAG,IAChBA,EAAI,OAAO,OAAO,OAAO,EACzBnT,GAAOmT,EAAI,MAAM,GACbA,EAAI,OAAO,KAAKA,EAAKJ,EAAmBC,GAAA,KAAAA,EAAkB,IAAI,EAElF,CAAS,EACDN,GAAaQ,CAAE,EACRA,CACV,EAAE,CAAE,MAAO,EAAM,EAAC,EACnB/9B,GAAa,IAAM,CACf,MAAM7F,EAAIujC,IACV,GAAIvjC,EAAG,CAGH,MAAM8jC,EAAgBN,EAAc,KAAK,CAAC,CAAC/7B,EAAKvC,CAAK,IAC1CA,IAAUlF,EAAE,GACtB,EACD8E,GAAQ,IAAM,CACV,MAAM8+B,EAAKT,KACX,UAAWU,KAAOD,EAAI,CAClB,MAAMG,EAAiBD,EAAgBA,EAAc,CAAC,EAAI,OAC1D,GAAIC,EAAgB,CAChB,MAAMC,EAAeH,EAAI,KAAK,OAAAE,EAAgB,EAC9C,GAAIrT,GAAOsT,CAAY,GACfA,EAAa,KAAKH,EAAK7jC,EAAG6jC,CAAG,IAAM,GACnC,KAGX,MAEG,QAAQ,IAAI,wBAAwB,OAAA7jC,EAAE,IAAK,EAE/C,GAAI0wB,GAAOmT,EAAI,UAAU,GACjBA,EAAI,WAAW,KAAKA,EAAK7jC,EAAG+jC,EAAgBF,CAAG,IAAM,GACrD,KAGX,CACD,MAAO,EACvB,CAAa,CACJ,CACT,CAAK,EACMV,EACX,EC7EO,SAASc,GAAYjN,EAAIkN,EAAS,CACrC,MAAMC,EAAMD,IACZ,IAAIE,EAAKC,EAAMC,EAAOC,EAClB,MAAM,QAAQJ,CAAG,EAEbA,EAAI,SAAW,GACfC,EAAMG,EAASJ,EAAI,CAAC,EACpBE,EAAOC,EAAQH,EAAI,CAAC,GAEfA,EAAI,SAAW,GACpBC,EAAMD,EAAI,CAAC,EACXE,EAAOC,EAAQH,EAAI,CAAC,EACpBI,EAASJ,EAAI,CAAC,GAGd,CAACC,EAAKE,EAAOC,EAAQF,CAAI,EAAIF,EAIjCC,EAAME,EAAQC,EAASF,EAAOF,EAElCnN,EAAG,eAAiB,CAAC7uB,EAAMiY,IAAS,CAChC,GAAIA,EAAM,CACN4W,EAAG,MACCA,EAAG,SAAS,OAAO,CAACpY,EAAKnZ,IACdmZ,GAAOnZ,EAAE,OAAS,GAC1B,CAAC,EACA4+B,EACAC,EACR,MAAME,EAAaxN,EAAG,SAAS,CAAC,EAC5BwN,IAEAA,EAAW,EAAIH,EACfG,EAAW,WAAaH,GAE5B,IAAII,EAAY,EAChBzN,EAAG,SAAS,QAASvxB,GAAM,CACvBA,EAAE,GAAKA,EAAE,GAAK,GAAK2+B,EACnB3+B,EAAE,UAAY2+B,EACdK,EAAY,KAAK,IAAIA,EAAWh/B,EAAE,QAAU,CAAC,CAC7D,CAAa,EACDuxB,EAAG,OAASyN,EAAYL,EAAMG,CACjC,CACT,CACA,CC7CA,SAASG,GAAeC,EAAS,GAAI,CACjC,MAAMC,EAAkB,GACxB,IAAI7jC,EACJ,IAAKA,EAAI,EAAGA,EAAI4jC,EAAO,OAAQ5jC,IAAK,CAChC,MAAMqE,EAAIu/B,EAAO5jC,CAAC,EAClB,GAAI,OAAOqE,GAAM,UAAY,CAACA,EAAE,SAAS,QAAQ,EAC7Cw/B,EAAgB,KAAKD,EAAO5jC,CAAC,CAAC,MAG9B,MAEP,CAKD,MAAO,CAAC6jC,EAAgB,KAAK,MAAM,CAAC,EAAE,OAAOD,EAAO,MAAM5jC,CAAC,CAAC,CAChE,CACA,SAAS8jC,GAAMC,EAAO,CAClB,OAAO,IAAI,QAASvvB,GAAY,CAC5B,WAAWA,EAASuvB,CAAK,CACjC,CAAK,CACL,CASA,SAASC,GAAMC,EAAQC,EAAYC,EAAO,QAAS,CAC/C,MAAMC,EAAQ,OAAO,gBACrB,OAAO,IAAI,QAAQ,CAAC5vB,EAAS6vB,IAAW,CACpC,MAAMC,EAAY,IAAI,yBAAyBL,CAAM,EACrDK,EAAU,KAAOH,EACjBG,EAAU,MAAQ,IAAM,CACpB9vB,GACZ,EACQ8vB,EAAU,QAAWrlC,GAAM,CACvBolC,EAAOplC,CAAC,CACpB,EACQilC,EAAW,KAAKI,CAAS,EACzBF,EAAM,MAAME,CAAS,CAC7B,CAAK,CACL,CACA,SAASC,GAAYX,EAAQO,EAAMtgC,EAAO,GAAM,CAC5C,MAAMugC,EAAQ,OAAO,gBACfI,EAAmBb,GAAe,MAAM,QAAQC,CAAM,EAAIA,EAAS,CAACA,CAAM,CAAC,EAC3Ea,EAAsB,GAMtBP,EAAa,GACnB,IAAIQ,EAAS,GAmEb,MAAO,CACH,QAnEiB,SAAY,CAC7B,GAAI,CACA,KAAOA,GAAUF,EAAiB,QAAQ,CACtC,MAAMP,EAAS,MAAM,QAAQ,QAAQO,EAAiB,MAAK,CAAE,EAC7D,GAAKE,GAKA,GAAI,OAAOT,GAAW,UAAYA,EAAO,SAAS,QAAQ,EAAG,CAE9D,IAAIF,EAAQ,OAAOE,EAAO,MAAM,QAAQ,EAAE,CAAC,CAAC,EAAI,IAC5C,MAAMF,CAAK,IACXA,EAAQ,GAEZ,MAAMD,GAAMC,CAAK,CACpB,SACQ,OAAOE,GAAW,UAAYA,EAAO,OAAQ,CAGlD,IAAIU,EAAc,EAClB,KAAOD,GAAUC,EAAc,GAC3B,GAAI,CACA,MAAMX,GAAMC,EAAQC,EAAYC,CAAI,EACpCQ,EAAc,CACjB,OACM1lC,EAAG,CAEN,GAAIA,aAAa,0BACb,GAAIA,EAAE,QAAU,UACZ0lC,IACA,QAAQ,KAAK,iDAAiD,OAAAA,EAAa,EAC3E,MAAMb,GAAM,KAAO,EAAea,EAAY,UAEzC1lC,EAAE,QAAU,YACjBA,EAAE,QAAU,cAEZ0lC,EAAc,MAGd,OAAM,IAAI,MAAM,8BAA8B,OAAA1lC,EAAE,MAAO,MAI3D,OAAMA,CAEb,CAER,SACQ,OAAOglC,GAAW,WAAY,CACnC,MAAMW,EAAeL,GAAYN,EAAQ,EAAEE,EAAM,EAAK,EACtDM,EAAoB,KAAKG,CAAY,EACrC,MAAMA,EAAa,MACtB,SACQ,MAAM,QAAQX,CAAM,EAAG,CAE5B,MAAMW,EAAeL,GAAYN,EAAQE,EAAM,EAAK,EACpDM,EAAoB,KAAKG,CAAY,EACrC,MAAMA,EAAa,MACtB,MApDG,MAqDP,CACJ,QACO,CACJF,EAAS,EACZ,CACT,KAGQ,IAAI,QAAS,CACT,OAAOA,CACV,EACD,OAASG,GAAY,CACjBL,EAAiB,KAAKK,CAAO,CAChC,EACD,OAAQ,IAAM,CACLH,IAGD7gC,GACAugC,EAAM,OAAM,EAEhBK,EAAoB,QAASA,GAAwB,CACjDA,EAAoB,OAAM,CAC1C,CAAa,EACDC,EAAS,GACZ,CACT,CACA,CACA,IAAII,GACW,SAAAC,GAAUF,EAASV,EAAO,QAAS,CAC9CW,WAAiBA,GAAc,SAC/BA,GAAgBP,GAAYM,EAASV,CAAI,EAClCW,EACX,CCnKA,IAAIE,GAAW,CAAC7U,EAAUrmB,IAAS,CAIjC,IAAIm7B,EACJ,MAAMC,EAAQ,IAAM,aAAaD,CAAS,EAC1C,OAAI/8B,GAAU,GACZX,GAAU29B,CAAK,EAMV,OAAO,OALI,IAAIxV,IAAS,CACzBuV,IAAc,QAChBC,IACFD,EAAY,WAAW,IAAM9U,EAAS,GAAGT,CAAI,EAAG5lB,CAAI,CACxD,EACkC,CAAE,MAAAo7B,CAAO,EAC3C,ECEA,IAAIC,GACAvC,GAAgB,GAChBwC,GACAC,GAAmB,GACvB,MAAMC,GAAc,IACpB,SAASC,GAAkBpV,EAAUhvB,EAAM,CACvC,MAAMkF,EAAU2+B,GAAS7U,EAAUhvB,CAAI,EACvC,IAAIqkC,EACJ,MAAMC,EAAaC,GAAa,CAC5BF,EAAcE,EACdr/B,EAAQq/B,CAAQ,CACxB,EACI,OAAAD,EAAU,MAAQ,IAAM,CACpBp/B,EAAQ,MAAK,EACb8pB,EAASqV,CAAW,CAC5B,EACIC,EAAU,MAAQp/B,EAAQ,MACnBo/B,CACX,CACA,SAASE,GAAW7C,EAAK,CACrB,OAAOA,EAAI,IAAMA,EAAI,IACzB,CACA,SAAS8C,GAAkBxD,EAAY,GAAI,CACvC,GAAI,CAACyD,GAAU,eAAiB,CAACA,GAAU,QACvC,OAEJ,MAAMC,EAAS1D,EAAU,MAAOU,GAAQ,CAACA,EAAI,OAAO,EAC9CiD,EAAY3D,EAAU,OAAQU,GAAQ,CAACF,GAAc,SAASE,CAAG,CAAC,EAExE,GADAqC,KACI,CAACW,GAAUD,GAAU,cAAe,CACpCA,GAAU,cAAc,EAAE,EAC1B,MACH,CACDjD,GAAgBR,EAAU,MAAM,CAAC,EACjC,MAAM4D,EAAiB,GACjBC,EAAaF,EAAU,OAAO,CAACloB,EAAKilB,KAClCA,EAAI,UACJjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,WAAYA,EAAI,QAAQ,CAAC,EACpDkD,EAAe,KAAKlD,EAAI,QAAQ,GAE3BA,EAAI,OACTjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,QAASA,EAAI,KAAK,CAAC,EAC9CkD,EAAe,KAAKlD,EAAI,KAAK,GAG7BjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,cAAe,EAAE,CAAC,EAE1CjlB,GACR,CAAE,GAcL,GAbAkoB,EAAU,QAAS,EAAC,OAAO,CAACloB,EAAKilB,KACzBA,EAAI,iBACJjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,UAAWA,EAAI,eAAe,CAAC,EAC1DkD,EAAe,KAAKlD,EAAI,eAAe,GAGvCjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,aAAc,EAAE,CAAC,EAEzCjlB,GACRooB,CAAU,EACTJ,GAAU,OACV,QAAQ,MAAMI,CAAU,EAExBD,EAAe,OACf,OAAOH,GAAU,MAAMG,EAAe,OAAO,CAACnoB,EAAKxW,IAAQwW,EAAI,OAAOxW,CAAG,EAAG,EAAE,CAAC,CAEvF,CACA,SAAS6+B,GAAarB,EAAS,CAC3B,GAAIQ,IAGJ,OAAQD,GAAoBe,GAAatB,CAAO,CACpD,CACO,MAAMgB,GAAY,CACrB,MAAO,GACP,QAAS,GACT,OAAQ,UAAY,CAChBT,IAAqBA,GAAkB,QAC1C,EACD,eAAgB,SAAUgB,EAAQ,EAAG,CACjCxD,GAAgBA,GAAc,MAAM,EAAGwD,CAAK,EAC5CjB,IACH,EACD,MAAO,SAAU/iB,EAAM,CAAE,OAAAikB,EAAS,GAAO,aAAAC,EAAe,EAAO,EAAG,GAAI,CAClE,OAAIT,GAAU,eAAiBA,GAAU,UACrCA,GAAU,cAAc,QACpBQ,GAAUjB,IAAqBA,GAAkB,OACjDA,GAAkB,OAAOhjB,CAAI,GAG7ByjB,GAAU,OAAM,EAChBK,GAAa9jB,CAAI,GAEjBkkB,IACAjB,GAAmB,GACnBD,aAAmB,OACd,QAAQ,IAAM,CACfC,GAAmB,GACnBQ,GAAU,QAAO,CACrC,GACqB,MAAM,QAAQ,SAGpBT,EACV,EACD,QAAS,SAAUgB,EAAQ,EAAG,CAC1BP,GAAU,eAAeO,CAAK,EAC9BP,GAAU,eACNA,GAAU,cAAc9hC,GAAQ,IAAMq+B,GAAS,CAAE,CAAC,CACzD,EACD,YAAa,SAAU,CAAE,cAAAmE,EAAgB,IAAK,mBAAAC,EAAqBlB,EAAc,EAAG,GAAI,CACpFO,GAAU,cAAgBN,GAAkBK,GAAmBW,CAAa,EAC5EpB,GAAsBI,GAAkB,IAAM,CAE1C3C,GAAgB,EACnB,EAAE4D,CAAkB,CACxB,CACL,ECrHaC,GAAe,KACxBZ,GAAU,YAAW,EACrB/gC,GAAa2C,GAAG26B,GAAWyD,GAAU,cAAe,CAAE,MAAO,EAAM,EAAC,EAC7DA,ICJJ,SAASa,GAAiB7U,EAAW,CACxC,OAAO,UAAY,SACf,MAAMpB,EAAc,KAAK,SAAS,OAC5BuP,EAAO,KAAK,KACZ2G,EAAe,KAAK,SAC1B,GAAI9U,IAAc,SAAWA,IAAc,OACvC,EAEI,IADA,KAAK,UAAa,KAAK,UAAY,GAAKpB,EAAe,EACnD,KAAK,UAAYA,EAAa,CAC9B,GAAI,CAACuP,EAAM,CACP,KAAK,SAAW,KAChB,KACH,CACD,KAAK,SAAW,CACnB,QACInxB,EAAA,KAAK,SAAS,KAAK,QAAQ,IAA3B,MAAAA,EAA8B,mBAElCgjB,IAAc,QAAUA,IAAc,KAC3C,EAEI,IADA,KAAK,UAAa,KAAK,UAAY,GAAKpB,EAAe,EACnD,KAAK,SAAW,EAAG,CACnB,GAAI,CAACuP,EAAM,CACP,KAAK,SAAW,KAChB,KACH,CACD,KAAK,SAAWvP,EAAc,CACjC,QACI3hB,EAAA,KAAK,SAAS,KAAK,QAAQ,IAA3B,MAAAA,EAA8B,WAE3C,GAAI,KAAK,WAAa,KAClB,YAAK,SAAW63B,EACT,GAEX,MAAMjC,EAAS,KAAK,SAAS,KAAK,QAAQ,EAI1C,GAHAt1B,GAAas1B,aAAkB1S,EAAW,EAC1C,KAAK,mBACD,KAAK,kBAAkB,KAAK,KAAM,KAAM0S,EAAQ,KAAK,SAAUiC,CAAY,EAC3E,KAAK,QAAUA,IAAiB,KAAM,CAGtC,MAAMC,EAAoB,KAAK,SAASD,CAAY,EACpDv3B,GAAaw3B,aAA6B5U,EAAW,EACrD,MAAMrwB,EAAMilC,EAAkB,SAC9BlC,EAAO,SAAW/iC,CACrB,CACD,OAAA6M,GAAiBk2B,CAAM,EAChB,EACf,CACA,CChDO,SAASmC,GAAIr8B,EAAO,CACvB,MAAM84B,EAAOoD,GAAiB,MAAM,EAC9BnD,EAAQmD,GAAiB,OAAO,EAChCI,EAAe,CACjBC,QAAS,OACTC,eAAgB,aAEpB,kBAAArU,EAAAC,GAAA,QAAAqU,UAAAtU,EAAA,SAAqB2Q,CAAI,EAAA2D,GAAAtU,EAAA,UAAW4Q,CAAK,EAAA1Q,GAAAF,EAAAuU,GAAA,KAAEC,UAAQ,QAAE38B,EAAM28B,UAAY,CAAC,MAAEC,SAAO,QAAE58B,EAAM48B,UAAYtE,GAAO,CACpG,GAAI,CAACA,GAAOA,EAAIqE,WAAa,KACzB,OACJ,IAAI94B,EAAQy0B,EAAI/5B,SAAS+5B,EAAIqE,QAAQ,EACrC,KAAO94B,WAAOg5B,WACVvE,EAAIqE,WACJ94B,EAAQy0B,EAAI/5B,SAAS+5B,EAAIqE,QAAQ,EAE/B94B,aAAiB2jB,IAEvB3jB,EAAMi5B,SAAQ,CAClB,EAAE,MAAEC,OAAK,QAAE/8B,EAAM+8B,OAAST,CAAY,GAAMt8B,CAAK,MAAAkpB,GAAAf,EAAGnoB,MAAMzB,QAAQ,EAAA4pB,CAAA,IAC1E,CCnBO,SAAS6U,GAAOh9B,EAAO,CAC1B,MAAMi9B,EAAKf,GAAiB,IAAI,EAC1BgB,EAAOhB,GAAiB,MAAM,EAC9BI,EAAe,CACjBC,QAAS,OACTY,cAAe,SACfX,eAAgB,aAEpB,kBAAArU,EAAAC,GAAA,QAAAqU,UAAAtU,EAAA,OAAmB8U,CAAE,EAAAR,GAAAtU,EAAA,SAAU+U,CAAI,EAAA7U,GAAAF,EAAAuU,GAAA,KAAEE,SAAO,QAAE58B,EAAM48B,UAAYtE,GAAO,CAC/D,GAAI,CAACA,GAAOA,EAAIqE,WAAa,KACzB,OACJ,IAAI94B,EAAQy0B,EAAI/5B,SAAS+5B,EAAIqE,QAAQ,EACrC,KAAO94B,WAAOg5B,WACVvE,EAAIqE,WACJ94B,EAAQy0B,EAAI/5B,SAAS+5B,EAAIqE,QAAQ,EAE/B94B,aAAiB2jB,IAEvB3jB,EAAMi5B,SAAQ,CAClB,EAAE,MAAEH,UAAQ,QAAE38B,EAAM28B,UAAY,CAAC,MAAEI,OAAK,QAAE/8B,EAAM+8B,OAAST,CAAY,GAAMt8B,CAAK,MAAAkpB,GAAAf,EAAGnoB,MAAMzB,QAAQ,EAAA4pB,CAAA,IACzG,CCrCO,KAAM,CAACiV,GAAkBC,EAAmB,EAAI3jC,EAAqB,EAAE,EACjE,CAAC4jC,GAAWC,EAAY,EAAI7jC,EAAsB,EAAK,ECIrD,SAAS8jC,IAAa,CACnC,IAAIC,EAAKC,EACLxD,EAAS,EACb,MAAM1d,EAAQ,EACRmhB,EAAW,CAAEnhB,QAAO/V,MAAO,YAC3BihB,EAAoB,CAAEte,SAAU,IAAME,OAAQ,eAEpDhP,UAAa2C,GAAGmgC,GAAmBQ,GAAgB,CACjD,GAAIA,EAAIC,WAAW,GAAG,EAAG,CACvBJ,EAAIh3B,MAAQm3B,EACZH,EAAIrnC,IAAM,GACVqnC,EAAIjhB,MAAQ,EACZ0d,EAAS,EACTwD,EAAIlhB,MAAQ,EACZ,MACF,MACEihB,EAAIh3B,MAAQ,WAGd,GAAIyzB,IAAW,EAAG,CAChBuD,EAAIrnC,IAAMwnC,EACV1D,EAAS,EACT,MACF,CAEA,GAAIA,IAAW,EAAG,CAChBwD,EAAItnC,IAAMwnC,EACV1D,EAAS,EAETwD,EAAIlhB,MAAQ,CAACA,CAAK,EAClBihB,EAAIjhB,MAAQ,CAAC,CAAC,EACd,MACF,CAEI0d,IAAW,IACbuD,EAAIrnC,IAAMwnC,EACV1D,EAAS,EAETuD,EAAIjhB,MAAQA,EACZkhB,EAAIlhB,MAAQ,EAEhB,EAAG,CAAEnf,MAAO,EAAK,EAAC,EAElB82B,EACC7L,EAAI,CAACvzB,MAAO,KAAMC,OAAQ,KAAMsY,OAAQ,GAAE,IAAA/O,UAAA,OAAA41B,GACxC7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAA9U,EAAMyU,EAAG,OAAAzU,gBAAA8U,CAAA,EAAHL,EAAGK,CAAA,EAAEC,QAAO,GAACrW,kBAAmBA,EAAmBqV,MAAOY,EAAQxJ,IAC5E7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAAE,EAAMN,EAAG,OAAAM,gBAAAF,CAAA,EAAHJ,EAAGI,CAAA,EAAEC,QAAO,GAACrW,kBAAmBA,EAAmBqV,MAAOY,EAAUnhB,MAAO,EAAC2X,IACtF7L,EAAI,KACHtY,SAAO,OAAE,CACPiuB,eAAgB,CACdhrB,OAAQ,CAACyZ,EAAS,SAAS,EAAGA,EAAS,SAAS,EAAGA,EAAS,SAAS,CAAC,EACtExZ,MAAO,CAAC,EAAG,GAAK,EAAG,EACnBle,OAAQ,IACRD,MAAO,KACPmpC,MAAO,CAAC,GAAK,CAAC,CAChB,EACD,OAIP,q/BCrDSxR,EAAS,SAAS,EACjByR,EAAM,OAAO,QAYhB,MAAMC,GAAgB,CAC3B,MAAO,GACP,OAAQ,GACR,EAAG,CACL,EASW1R,EAAS,SAAS,EAIlBA,EAAS,SAAS,ECxC7B,MAAe2R,GAAA,CACb,OAAQ,CACN,GAAIF,EAAM,WACV,MAAO,IACP,OAAQ,IACR,EAAG,IACH,IAAK,GACL,OAAQ,IACR,OAAQzR,EAASyR,EAAM,MAAM,OAAO,EACpC,EAAG,CACD,GACA,CACE,SAAU,IACV,OAAQ,aACV,CACF,EACA,MAAO,CACL,EAAG,CACDA,EAAM,OAAO,QACb,CACE,SAAU,IACV,OAAQ,aACV,CACF,CACF,CACF,EACA,cAAe,CACb,MAAO,GACP,OAAQ,EACR,EAAG,EACH,EAAG,GACH,MAAOzR,EAAS,SAAS,EACzB,MAAO,CACL,OAAQ,CACV,EACA,OAAQ,CAER,CACF,EACA,YAAa,CACX,OAAQ,IACR,MAAO,CACL,MAAO,IACP,MAAO,CAAC,CAAC,EACT,SAAU,IACV,OAAQ,aACV,EACA,MAAOC,GAAQ,GAAG,EAClB,MAAO,CAAC,EAAG,GAAK,EAAG,EACnB,MAAO,IACP,OAAQ,KACR,MAAOD,EAASyR,EAAM,MAAM,OAAO,CACrC,EACA,SAAU,CACR,OAAQ,EACR,SAAU,GACV,EAAG,GACH,EAAG,GACH,OAAQ,GACR,MAAO,EACP,OAAQ,CACN,MAAO,CACT,CACF,CACF,EC3CMjQ,GAAWoQ,KAgCF,SAASC,GAAKv+B,EAAO,CAClC,IAAIw+B,EACJ,MAAMC,EAAWlO,KAEjB,SAASqM,GAA2B,CAClC,KAAKr+B,SAASkqB,QAASvuB,GAAMA,EAAE2tB,OAAQ6W,IAAI,QAAQ,CAAC,EACpD,KAAKngC,SAASo+B,SAAUG,UAC1B,CAEA,SAAS6B,GAA0B,CACjC,KAAKhC,SAAW,EAChB,KAAKp+B,SAASkqB,QAASvuB,GAAMA,EAAE2tB,OAAQ+W,OAAO,QAAQ,CAAC,CACzD,CACA,OAAAzK,EACG7L,EAAI,KAACyU,OAAK,QAAE9U,GAAO4W,WAAW,MAAAtgC,UAAA,QAAA41B,EAC5B6I,GAAMN,GACD18B,EAAK,CACT48B,QAASA,EACT+B,OAAQA,EAAM,IACd5B,OAAK,QAAE9U,GAAO+U,MAAM,EACpBe,QAAO,OAAAx/B,UAAA,SAELyB,iBAAO8+B,aAAc,IAAIzT,IAAK0T,GAAQ5K,EACrC7L,EAAI,KACHlyB,KAAG,QAAE83B,GAAY,GAAE6Q,SAASC,KAAM,EAClCjC,MAAOqB,GACPa,cAAa,GACbC,QAASA,IAAMT,EAAU,GAAEM,SAASlR,KAAM,EAAC,IAAAtvB,UAAA,OAAA41B,GAE1C7L,EAAI,KAACyU,OAAK,QAAE9U,GAAOkX,aAAa,EAAAhL,IAChCjM,GAAI,KAAC6U,OAAK,QAAE9U,GAAOmX,QAAQ,MAAA7gC,UAAA,QAAGwgC,EAASx7B,IAAI,OAE/C,CAAC,EAAA4wB,KAEH7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAA9U,EAAMwV,EAAQ,OAAAxV,gBAAA8U,CAAA,EAARU,EAAQV,CAAA,OAGzB,CC1EA,MAAeuB,GAAA,CACb,KAAM,CACJ,MAAO,KAAM,OAAQ,IACvB,EACA,YAAa,CACX,EAAG,GACL,EACA,aAAc,CACZ,MAAO,KAAM,OAAQ,IACrB,EAAG,IAEH,EAAG,IAAK,QAAS,OACjB,SAAU,GACV,UAAW,QACb,EACA,gBAAiB,CACf,MAAO,KACP,OAAQ,IAER,EAAG,IACH,EAAG,IAAK,QAAS,OACjB,SAAU,GACV,UAAW,QACb,EACA,eAAgB,CACd,MAAOlB,EAAM,OAAO,QACpB,OAAQ,IACR,EAAG,IACH,EAAG,EACH,OAAQ,CACV,EACA,UAAW,CACT,aAAc,EACd,MAAO,IAAK,OAAQ,IAAK,EAAG,GAAI,EAAG,GAAI,OAAQ,EACjD,EACA,aAAc,CAAE,EAAG,GAAI,EAAG,EAAG,EAC7B,aAAc,CACZ,MAAO,KACP,OAAQ,IACR,EAAG,EACH,EAAG,EACH,OAAQ,GACR,MAAO,GACP,MAAOzR,EAAS,SAAS,CAC3B,EACA,SAAU,CACR,OAAQ,GACR,MAAO,IACP,UAAW,GACX,SAAU,GACV,MAAOA,EAAS,SAAS,EACzB,OAAQ,CACV,EACA,IAAK,CACH,QAAS,OACT,eAAgB,eAChB,OAAQ,IACR,IAAK,EACP,EACA,OAAQ,CACN,QAAS,OACT,cAAe,SACf,eAAgB,YAChB,IAAK,GACL,MAAOyR,EAAM,OAAO,QAAW,EAAIA,EAAM,OAAO,QAChD,EAAGA,EAAM,OAAO,QAAUA,EAAM,OAAO,QACvC,EAAG,IACH,OAAQ,CACV,EACA,KAAM,CACJ,MAAO,IACP,OAAQ,IACR,EAAG,GACH,EAAG,IACH,MAAOzR,EAAS,SAAS,CAC3B,EACA,UAAW,CACT,GAAGyR,EAAM,WAAW,MACpB,QAAS,OACT,MAAO,KACP,OAAQ,GACV,CACF,EAEMmB,GAAS,CACb,MAAO,IACP,OAAQ,GACR,MAAO5S,EAAS,SAAS,EACzB,aAAc,EACd,OAAQ,CAAE,MAAO,EAAG,MAAOA,EAAS,SAAS,CAAE,EAC/C,MAAO,EACP,MAAO,CACL,MAAO,IACP,OAAQ,CAAE,MAAO,EAAG,MAAOA,EAAS,SAAS,CAAE,CACjD,CACF,EAEM6S,GAAS,CACb,MAAO7S,EAAS,SAAS,EACzB,OAAQ,EACR,EAAG,EACH,EAAG,GACH,MAAO4S,GAAO,MAAQ,CACxB,EAEME,GAAa,CACjB,SAAU,GACV,EAAG,GAEH,QAAS,QACT,UAAW,SACX,MAAO9S,EAAS,SAAS,EACzB,OAAQ4S,GAAO,OACf,MAAOA,GAAO,KAChB,EAEaG,GAAe,CAC1B,UAAWH,GACX,OAAQC,GACR,KAAMC,EACR,EAGaE,GAAiB,CAC5B,MAAO,IACP,OAAQ,IACR,MAAOhT,EAAS,SAAS,EACzB,MAAO,CACL,MAAOA,EAAS,SAAS,CAC3B,EACA,SAAU,CACR,MAAOA,EAAS,SAAS,CAC3B,CACF,EAGSA,EAAS,SAAS,EAUlBA,EAAS,SAAS,EACjBgT,GAAe,OAChBA,GAAe,MAKbhT,EAAS,SAAS,EC5KtB,MAAMiT,GAAY,CACrB,CACI,KAAM,OAAQ,KAAM,IAAK,KAAM,sBACnC,EACA,CACI,KAAM,SAAU,KAAM,UAAW,KAAM,wBAC3C,EACA,CACI,KAAM,KAAM,KAAM,MAAO,KAAM,sBACnC,EACA,CACI,KAAM,cAAe,KAAM,UAAW,KAAM,uBAChD,EACA,CACI,KAAM,cAAe,KAAM,QAAS,KAAM,sBAC9C,CACJ,ECLMC,GAAO5/B,GAAU,CACrB,MAAM6/B,EAAY5D,KAClB4D,EAAUC,QAAU,GACpB,MAAMrB,EAAWlO,KACXxB,EAAgByB,KACPC,GAAW,EAC1B,IAAIsP,EAAWC,EACf,KAAM,CAACC,EAAiBC,CAAkB,EAAIxmC,EAAaq1B,CAAQ,EAEnE+I,UAAgB,CACdyG,KAAM,IACN4B,OAAQ,QACV,CAAC,EAED1iC,GAAQ,IAAM,CACZ8/B,GAAa,EAAI,CACnB,CAAC,EAEDjjC,GAAa,IAAM,CACjB4lC,EAAmBnR,EAASgD,QAAQ,CACtC,CAAC,EAGDoC,EACG7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAA9U,EACEoX,OAAOC,IAAG,OAAArX,gBAAA8U,CAAA,EAAVsC,OAAOC,IAAGvC,CAAA,EACfwC,OAAQA,IAAMC,QAAQC,KAAM,EAC5BC,OAAQA,IAAMhC,EAAS,GAAG,EAC1B1B,MAAO,CAAEhoC,MAAO,KAAMC,OAAQ,IAAM,EACpC0rC,OAAQA,IAAM,CACZ,GAAIX,EAAUlY,OAAO8Y,IAAI,OAAO,GAAMrD,GAAS,GAAM,IAAS2C,EAAiB,GAAI,UACjF,MAAO,GAETD,EAAcj8B,GAAa,EAC3Bg8B,EAAUjD,SAAQ,CACnB,EACD8D,QAASA,KACPrD,GAAa,EAAK,EACXwC,EAAUlY,OAAO8Y,IAAI,OAAO,GAAKX,EAAYlD,YAEtD+D,OAAM,OAAAtiC,UAAA,QAAA41B,EAELqJ,GAAUrJ,MAGV7L,EAAI,KAACyU,OAAK,QAAE9U,GAAO6Y,WAAW,MAAAviC,UAAA,QAAGyB,EAAMzB,QAAQ,EAAA41B,IAE/CoK,GAAI,CAAApvB,IAAA2uB,EAAA,OAAAE,EAAM+B,EAAS,OAAA/B,gBAAAF,CAAA,EAATiC,EAASjC,CAAA,EAAEgB,WAAYa,EAAS,MAYjD,ECtEAoB,GAAe,IAAoC,0DCE7CC,GAAWA,IAAM,CACrB,MAAMC,EAAoB,CACxBlsC,MAAO,IACPC,OAAQ,IACRwW,EAAG,IACHD,EAAG,GACHob,IAAK,GACL4V,QAAS,OACTY,cAAe,SACfX,eAAgB,aAGZ0E,EAAmB,CACvBnsC,MAAO,IACPC,OAAQ,GACR2xB,IAAK,EACL4V,QAAS,OACTY,cAAe,MACfX,eAAgB,aAGZ2E,EAAQ,CACZtqB,SAAU,IAGNuqB,EAAW,CACfrsC,MAAOksC,EAAkBlsC,MACzB8hB,SAAU,GACV2B,QAAS,SAGL6oB,EAAU,CACdxqB,SAAU,IAGZ,OAAAsd,EACG7L,EAAI,CAACgZ,UAAS,GAACvE,MAAOkE,EAAiB,IAAA1iC,UAAA,OAAA41B,GACrCjM,GAAI,CAAC6U,MAAOoE,EAAK5iC,SAAA,oBAAA41B,IACjBjM,GAAI,CAAC6U,MAAOqE,EAAQ7iC,SAAA,4VAAA41B,IACpB7L,EAAI,CAACyU,MAAOmE,EAAgB,IAAA3iC,UAAA,OAAA41B,GAC1BjM,GAAI,CAAC6U,MAAOsE,EAAO9iC,SAAA,eAAA41B,IACnB7L,EAAI,CAACvzB,MAAO,GAAIC,OAAQ,GAAIoB,IAAK,yBAAwB+9B,IACzDjM,GAAI,CAAC6U,MAAOsE,EAAO9iC,SAAA,qBAI5B,EChDagjC,GAAY,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACrC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC9B,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC9B,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC9B,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC9B,GACD,ECHLC,GAAyB,CACpC,QAAS,OACT,cAAe,SACf,IAAK,GACL,EAAG,EACH,MAAO9U,EAAS,SAAS,EACzB,OAAQyR,EAAM,OAAO,QACrB,MAAO,CACT,EAEasD,GAAoB,CAC/B,QAAS,OACT,cAAe,MACf,eAAgB,YAChB,IAAK,GACL,EAAG,GACH,OAAQ,IACR,OAAQtD,EAAM,OAAO,OACvB,EAEauD,GAAsB,CACjC,QAAS,OACT,cAAe,SACf,eAAgB,YAChB,IAAK,GACL,MAAO,IACP,EAAG,GACH,OAAQ,GACV,EAIaC,GAAmB,CAC9B,QAAS,OACT,cAAe,MACf,eAAgB,eAChB,IAAK,EACL,OAAQ,GACR,MAAO,GACT,EAEaC,GAAwB,CACnC,MAAOlV,EAAS,SAAS,EACzB,MAAO,GACP,OAAQ,IACR,EAAG,EACH,EAAG,CACL,EAEamV,GAAoB,CAC/B,QAAS,OACT,aAAc,EACd,OAAQ,CAAE,MAAO,EAAG,MAAOnV,EAAS,SAAS,CAAE,EAC/C,eAAgB,SAChB,WAAY,SACZ,IAAK,EACL,MAAO,GACP,OAAQ,GACR,MAAOA,EAAS,SAAS,EACzB,MAAO,CACL,OAAQ,CAAE,MAAO,EAAG,MAAOA,EAAS,SAAS,CAAE,EAC/C,MAAOA,EAAS,SAAS,CAC3B,CACF,EAEaoV,GAAoB,CAC/B,SAAU,EACZ,EAEaC,GAAmB,CAC9B,MAAOrV,EAAS,MAAM,EACtB,MAAO,IACP,EAAG,GACH,OAAQ,GACR,MAAO,EACP,gBAAiBA,EAAS,SAAS,EACnC,aAAc,EACd,OAAQ,CAAE,MAAO,EAAG,MAAOA,EAAS,SAAS,CAAE,EAC/C,QAAS,OACT,WAAY,SACZ,eAAgB,WAClB,EAEasV,GAAoB,CAC/B,MAAO,IACP,QAAS,OACT,cAAe,SACf,WAAY,YACZ,eAAgB,YAChB,IAAK,GACL,EAAG,CACL,EAEaC,GAA0B,CACrC,OAAQ,GACR,MAAO,IACP,MAAOvV,EAAS,SAAS,EACzB,QAAS,OACT,WAAY,SACZ,eAAgB,SAChB,aAAc,EACd,OAAQ,CAAE,MAAO,EAAG,MAAOA,EAAS,SAAS,CAAE,EAC/C,MAAO,CACL,OAAQ,CAAE,MAAO,EAAG,MAAOA,EAAS,SAAS,CAAE,EAC/C,MAAOA,EAAS,SAAS,CAC3B,CACF,EAEawV,GAA8B,CACzC,MAAO,GACP,OAAQ,EACV,EAEaC,GAAmB,CAC9B,OAAQ,GACR,EAAG,EACH,EAAG,CACL,EAEaC,GAAoB,CAC/B,MAAO1V,EAAS,SAAS,EACzB,EAAG,KACH,SAAU,GACV,EAAG,GACH,MAAOyR,EAAM,OAAO,SAAW,IAAM,KACrC,OAAQA,EAAM,OAAO,QACrB,OAAQ,IAER,WAAY,SACZ,eAAgB,QAClB,EAEakE,GAAuB,CAClC,QAAS,OACT,cAAe,SACf,eAAgB,YAChB,IAAK,GACL,MAAOlE,EAAM,OAAO,SAAW,EAAIA,EAAM,OAAO,QAAU,KAAQA,EAAM,OAAO,QAAUA,EAAM,OAAO,SAAW,GACjH,EAAG,GACH,EAAG,GACH,OAAQ,CACV,EAEamE,GAA0B,CACrC,QAAS,OACT,cAAe,SACf,eAAgB,YAChB,IAAK,EACP,EAEaC,GAAc,CACzB,QAAS,OACT,eAAgB,SAChB,WAAY,QACd,EC1JeC,GAAA,CACb,UAAW,CACT,aAAc,EACd,MAAO,IACP,OAAQ,IACR,MAAO,EACP,OAAQ,CAEV,EAEA,UAAW,CACT,aAAc,EACb,EAAG,GAAI,EAAG,GAAI,OAAQ,GACvB,MAAO9V,EAAS,SAAS,CAC3B,CACF,ECLe,SAAS+V,GAAUziC,EAA2B,CAC3D,IAAI0iC,EACJpoC,GAAa2C,GAAG8G,GAAgBu0B,GAAQ,CACtC1zB,EAAa0zB,CAAG,EAChBqK,WAAW,IAAM,CACXrK,EAAIsK,aACNF,EAAal2B,OAAS8rB,EAAI9rB,OAC1Bk2B,EAAalmB,MAAQ,EACrBkmB,EAAaG,MAAQ,EACrBH,EAAan3B,EAAI+sB,EAAI/sB,EAAK,IAC1Bm3B,EAAal3B,EAAI8sB,EAAI9sB,EAAK,IAC1Bk3B,EAAa3tC,MAAQujC,EAAIvjC,MAAS,IAClC2tC,EAAa1tC,OAASsjC,EAAItjC,OAAU,IACpC0tC,EAAaI,gBAAgB,CAAED,MAAO,IAAI,CAAC,EAAEzhC,MAAK,GAGlDshC,EAAalmB,MAAQ,CAExB,EAAE,EAAE,CACP,EAAG,CAAEnf,MAAO,EAAK,EAAC,EAClB,SAAS0lC,GAA8B,QACrC1+B,EAAA,KAAK9F,SAASo+B,WAAd,MAAAt4B,EAAwBy4B,UAC1B,CAGA,OAAA3I,EACG7L,EAAIoU,GAAK18B,EAAK,CAAE+9B,QAAO,OAAChB,OAAK,QAAE9U,GAAOwa,SAAS,MAAAlkC,UAAA,QAAA41B,EAC7C7L,EAAIoU,GAAA,CACHE,QAASmG,CAAU,EACf/iC,EAAK,CACT+9B,QAAO,OACPhB,OAAK,QAAE9U,GAAOwa,SAAS,EAAAtO,KAExB7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAA9U,EAAM0Z,EAAY,OAAA1Z,gBAAA8U,CAAA,EAAZ4E,EAAY5E,CAAA,MAAEf,OAAK,QAAE9U,GAAO+a,SAAS,QAGtD,CCjCO,SAASC,GAAQjjC,EAAqB,CAC3C,KAAM,CAACkjC,EAAOC,CAAM,EAAIrgC,GAAW9C,EAAO,CAAC,OAAO,CAAC,EAEnD,OAAAm0B,EAAQkI,GAAGK,GAAKyG,EAAM,KAAEpG,OAAK,QAAE9U,GAAOoU,GAAG,MAAA99B,UAAA,QAAA41B,EACvC3wB,GAAG,KAAC4/B,MAAI,QAAEF,EAAM3iC,KAAK,EAAAhC,SACjBgD,GAAI4yB,EAAMsO,GAAclhC,CAAI,CAAI,MAIxC,CAEO,SAAS+9B,GAAOt/B,EAAO,CAC5B,OAAAm0B,EACG7L,EAAIoU,GAAK18B,EAAK,CAAEi/B,cAAa,GAAClB,QAAO,OACpChB,OAAK,QAAE0C,GAAa4D,SAAS,MAAA9kC,UAAA,QAAA41B,EAC5BjM,GAAI,KAAC6U,OAAK,QAAE0C,GAAa7nB,IAAI,MAAArZ,UAAA,QAAGyB,EAAMzB,QAAQ,OAGrD,CChCO,SAAS+kC,GAAqBpoC,EAAyC,CAC5E,KAAM,CAACqoC,EAAOC,CAAQ,EAAI9pC,EAAoB,CAAE,GAC1C,CAAC+pC,EAAMC,CAAO,EAAIhqC,EAAa,CAAC,EAChC,CAAC2H,EAAKsiC,CAAM,EAAIjqC,EAAa,EAAK,EAElC,CAACkqC,CAAQ,EAAI/oC,GAAe4oC,EAAMvoC,CAAO,EAC/C,OAAAjB,GAAe,IAAM,CACnB,MAAM4pC,EAAUD,IACXC,GAEL7mC,GAAM,IAAM,CACN6mC,EAAQ,SAAW,GACrBF,EAAO,EAAI,EACXH,EAAUvnC,GAAM,CAAC,GAAGA,EAAG,GAAG4nC,CAAO,CAAC,EACrC,EACF,EAEM,CACH,MAAAN,EACA,KAAAE,EACA,QAAAC,EACA,SAAAF,EACA,IAAAniC,EACA,OAAAsiC,CAAA,CAEN,CC3BA,MAAMG,GAAgB,mCAChBC,GAAmB,2CACnBC,GAAW,+BACjB,IAAIC,GACAC,GACJ,MAAMC,GAAiB,OAEjBC,GAAqB,CACzB,QAAS,CACP,eAAgB,mBAChB,cAAe,UAAYL,EAC7B,CACF,EAEgB,SAAAM,GAAYxW,EAAcyW,EAAqBH,GAAgB,CAC7E,OAAOD,GAAeI,EAAazW,CACrC,CAEA,SAASuH,GAAIvH,EAAcW,EAAsB,GAAI,CACnD,OAAIyV,GACKM,GAAK1W,EAAMW,CAAM,EAEjBgW,GAAa,OAAK,IAAMD,GAAK1W,EAAMW,CAAM,CAAC,CAErD,CAEA,SAAS+V,GAAK1W,EAAcW,EAAsB,GAAI,CAC7C,aAAMwV,GAAWnW,GAAQA,EAAK,SAAS,GAAG,EAAI,IAAM,KAAO,WAAaiW,GAAiB,CAC9F,GAAGM,GACH,GAAG5V,CAAA,CACJ,EAAE,KAAMjd,GAAMA,EAAE,KAAM,EACzB,CAEA,SAASizB,IAAa,CACpB,OAAOD,GAAK,gBAAgB,EAAE,KAAMhwC,GAAS,OAC9B,OAAA0vC,GAAA1vC,EACb2vC,IAAe7/B,EAAA9P,EAAK,SAAL,YAAA8P,EAAa,gBACrB9P,CAAA,CACR,CACH,CAEA,MAAekwC,GAAA,CACb,IAAArP,GACA,WAAAoP,EACF,EC1CA,SAASE,GAAeptC,EAAaqtC,EAA2B,CAC1D,OAAArtC,EAAI,OAASqtC,EACRrtC,EAAI,UAAU,EAAGqtC,EAAY,CAAC,EAAI,MAEpCrtC,CACT,CAEgB,SAAAstC,GAAWta,EAAiBzV,EAAO,EAAG,CACpD,IAAIrX,EAAqB,GAChB,UAAI,EAAGqD,EAAIypB,EAAM,OAAQ,EAAIzpB,EAAG,GAAKgU,EAC5CrX,EAAO,KAAK8sB,EAAM,MAAM,EAAG,EAAIzV,CAAI,CAAC,EAE/B,OAAArX,CACT,CAqBgB,SAAAqnC,GAAoBtkC,EAAe,GAAY,CACtD,OAAAA,EAAM,IAAKgB,IAAU,CACxB,IAAK8iC,GAAY9iC,EAAK,aAAeA,EAAK,YAAY,EACtD,QAAS8iC,GAAY9iC,EAAK,eAAiBA,EAAK,aAAc,MAAM,EACpE,SAAU8iC,GAAY9iC,EAAK,cAAe,OAAO,EACjD,KAAM,WAAW,OAAAA,EAAK,YAAc,SAAQ,KAAI,OAAAA,EAAK,IACrD,WAAYmjC,GAAenjC,EAAK,OAASA,EAAK,KAAM,EAAE,EACtD,MAAOA,EAAK,OAASA,EAAK,KAC1B,KAAMA,EACN,WAAY,CACV,KAAMA,EAAK,YAAc,SACzB,GAAIA,EAAK,EACX,EACA,YAAa,CACX,MAAOA,EAAK,OAASA,EAAK,KAC1B,YAAaA,EAAK,QACpB,CACF,GACJ,CCnDA,IAAIujC,OAAY,IAChB,MAAMC,OAAoB,IAE1B,SAAAC,GAAyBnwB,EAAcowB,EAAY,CACjD,MAAMzV,EAAS,GACf,MAAO,OAAO0V,GAAoC,CAChD,MAAM/uC,EAAM,0CAA0C,OAAA+uC,EAAS,YAAW,OAAAD,GACtE,GAAAH,GAAM,IAAI3uC,CAAG,EACR,OAAA2uC,GAAM,IAAI3uC,CAAG,EAGtB,MAAMgvC,EAAWtwB,EAEb,IAAArX,EAAS,MAAMinC,GAAI,IAAItuC,CAAG,EAAE,KAAMivC,GAAa,CAC7C,IAAArlC,EAAUqlC,EAAS,QAAQ,OAAQ7zB,GAAM,CAACA,EAAE,KAAK,EACjD8zB,GAASN,GAAc,IAAIvV,CAAM,EAAIuV,GAAc,IAAIvV,CAAM,EAAI,IAAI,OAAOqV,GAAoB9kC,CAAO,CAAC,EACxGulC,EAASV,GAAWS,EAAOF,CAAQ,EACvC,OAAIG,EAAOA,EAAO,OAAS,CAAC,EAAE,OAASH,EACrCJ,GAAc,IAAIvV,EAAQ8V,EAAO,IAAK,GAEtCP,GAAc,OAAOvV,CAAM,EAEtB8V,CAAA,CACR,EACD,eAAQ,IAAI9nC,CAAM,EACXA,CAAA,CAEX,CCLA,MAAM0wB,GAAWoQ,KAGF,SAASiH,GAAOvlC,EAAO,CAClC,IAAIwlC,EAAqBC,EAAgBC,EAAiBC,EAAsBC,EAAiBC,EAAiBC,EAAmBC,EAAqBC,EAC1J,KAAM,CAACC,EAAaC,CAAc,EAAIxsC,EAAa,EAAE,EAC/C,CAACysC,EAASC,CAAU,EAAI1sC,EAAa,CAAC,EAE5C,IAAI2sC,EAAuB3rC,GAAW,IAC7B4oC,GAAqB0B,GAAe,EAAGiB,EAAW,CAAE,CAAC,CAC7D,EAED3rC,GAAa2C,GAAGgpC,EAActsC,GAAU,CACtCysC,EAAW,CAAC,EACZC,EAAsB,EAAC3C,QAAQ,CAAC,CACjC,EAAC,EAEF,MAAM4C,EAAU5pC,GAAe,IACtB,CACR,EAED,SAASkgC,GAA2B,CAClC,KAAK/U,OAAO6W,IAAI,OAAO,CACzB,CAEA,SAASC,GAA0B,CACjC,KAAK9W,OAAO+W,OAAO,OAAO,CAC5B,CAEA,MAAM2H,EAAiBA,IACd,IAAM,CACXL,EAAeroC,GAAQA,EAAO,GAAG,GAI/B2oC,EAAqBA,IAClB,IAAM,CACXN,EAAeroC,GAAQA,EAAK4oC,MAAM,EAAG,EAAE,CAAC,GAI5C,SAASC,EAAexqC,EAAa,CACnC,MAAO,IAAM,CACXgqC,EAAeroC,GAAQA,EAAO3B,CAAG,EAErC,CAEA,MAAMyqC,EAAiBA,IAAM,CAC3B,IAAIpyC,EAAY,GAEhB,QAASiB,EAAI,EAAGA,EAAI+rC,GAAUn/B,OAAQ5M,GAAKoxC,EAAgB,CACzD,MAAMC,EAActF,GAAUkF,MAAMjxC,EAAGA,EAAIoxC,CAAc,EACzDryC,EAAKuyC,KAAKD,CAAW,CACvB,CAEA,OAAA1S,EACG3wB,GAAG,CAAC4/B,KAAM7uC,EAAIgK,SACZA,CAACgD,EAAM/L,IAAC2+B,EACNkI,GAAG,CAACU,MAAO4E,GAAkBL,UAAW,GAAOT,OAAM,OAAAtiC,UAAA,QAAA41B,EACnD3wB,GAAG,CAAC4/B,KAAM7hC,EAAIhD,SACZA,CAACrC,EAAK2E,IAACszB,EACL7L,EAAI,CACHyU,MAAO8E,GAAiB,IACxB3C,SAAO,QAAEwH,EAAexqC,CAAG,CAAC,EAC5B6hC,QAAO,GACPY,OAAQA,EACR/B,QAASA,EACTqC,cAAa,GACbqC,UAAW,GAAK,IAAA/iC,UAAA,QAAA41B,EAEfjM,GAAI,CAAC6U,MAAO+E,GAAiBvjC,SAC3BrC,CAAG,KAGT,KAEC,IAMd,SAAS6mC,GAA8B,QACrC1+B,EAAA,KAAK9F,SAASo+B,WAAd,MAAAt4B,EAAwBy4B,WACxBsJ,GAAY,KAAK56B,GAAK,GAAK,GAAK,EAAE,EAClC,IAAIu7B,EAAWV,EAAoB,EAAG9C,MAAK,EAAGnhC,OAC3C,KAAKoK,SACFu6B,IAAa,GAAK,KAAKv6B,OAAOmwB,UAAY,KAAKnwB,OAAOmwB,UAAYoK,EAAW,IAC/EV,EAAsB,EAAC3C,QAAQznC,GAAKA,EAAI,CAAC,CAG/C,CAEA,SAASijC,GAA2B,CACpC,CAEA,OAAA/K,EACG7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAA9U,EAAMwc,EAAmB,OAAAxc,gBAAA8U,CAAA,EAAnB0H,EAAmB1H,CAAA,EAAEC,QAAO,GAAChB,MAAO6E,GAAuBN,UAAS,OAAA/iC,UAAA,QAAA41B,EAC5E7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAAE,EACE2H,EAAoB,OAAA3H,gBAAAF,CAAA,EAApB6H,EAAoB7H,CAAA,EACzBC,QAAO,GACPhB,MAAOyE,GACPF,UAAS,GACTT,OAAM,OAAAtiC,UAAA,OAAA41B,GAEL7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAAkJ,EAAMvB,EAAc,OAAAuB,gBAAAlJ,CAAA,EAAd2H,EAAc3H,CAAA,EAAEf,MAAOoF,GAAkBtF,UAAS,GAAA1I,IAC5D7L,EAAI,CAAAnZ,IAAA2uB,EAAA,OAAAmJ,EAAMxB,EAAc,OAAAwB,gBAAAnJ,CAAA,EAAd2H,EAAc3H,CAAA,EAAEf,MAAOgF,GAAkBhE,QAAO,GAAClB,UAAS,OAAAt+B,UAAA,QAAA41B,EAClEjM,GAAI,KAAC6U,OAAK,OAAE,CACXt2B,MAAOimB,EAAS,SAAS,EACzB7V,SAAU,GACVqwB,WAAY,GACb,MAAA3oC,UAAA,QACG0nC,EAAW,CAAE,KAAA9R,IAGlB6I,GAAM,CACLD,MAAO0E,GAAiBtyB,IAAA2uB,EAAA,OAAAqJ,EACnBvB,EAAe,OAAAuB,gBAAArJ,CAAA,EAAf8H,EAAe9H,CAAA,EACpBwD,UAAS,GACT8F,OAAQA,IAAM,CACZ,GAAGtB,EAAkBje,OAAO8Y,IAAI,OAAO,EACrC,MAAO,EAEV,EACDE,OAAM,OAAAtiC,UAAA,OAAA41B,GAEL6I,GAAM,CACLD,MAAO2E,GAAmBvyB,IAAA2uB,EAAA,OAAAuJ,EACrBvB,EAAiB,OAAAuB,gBAAAvJ,CAAA,EAAjBgI,EAAiBhI,CAAA,EACtB8C,QAASA,IAAM,CACbiF,EAAgB/I,SAAQ,EACxBiJ,EAAoBjJ,SAAQ,CAC7B,EACD4D,OAAQA,IAAM,CACZnD,GAAa,EAAI,CAClB,MAAAh/B,UAAA,OAAA41B,GAEAkI,GAAG,CAACU,MAAO4E,GAAkBL,UAAW,GAAK,IAAA/iC,UAAA,OAAA41B,GAC3C7L,EAAI,CACHyU,MAAOkF,GAAuB9yB,IAAA2uB,EAAA,OAAAwJ,EACzBtB,EAAqB,OAAAsB,gBAAAxJ,CAAA,EAArBkI,EAAqBlI,CAAA,MAC1BoB,SAAO,QAAEqH,EAAc,CAAE,EACzBxI,QAAO,GACPuD,UAAW,GAAK,IAAA/iC,UAAA,QAAA41B,EAEf7L,EAAI,CACHyU,MAAOmF,GACP9rC,IAAK83B,GAAW,wBAChB+Q,cAAa,GACblB,QAAO,MAAA5J,IAGV7L,EAAI,CACHyU,MAAOkF,GAAuB,IAC9B/C,SAAO,QAAEsH,EAAkB,CAAE,EAC7BzI,QAAO,GACPuD,UAAW,GAAK,IAAA/iC,UAAA,QAAA41B,EAEf7L,EAAI,CACHyU,MAAOmF,GACP9rC,IAAK83B,GAAW,6BAChB+Q,cAAa,GACblB,QAAO,UAAA5J,IAIZ6I,GAAM,CAAC6D,OAAM,GAAC9D,MAAOuF,GAAuB,IAAA/jC,UAAA,QAEzCooC,EAAc,CAAE,EAAAxS,IAGnB6I,GAAM,CAAA7tB,IAAA2uB,EAAA,OAAAyJ,EACA7B,EAAe,OAAA6B,gBAAAzJ,CAAA,EAAf4H,EAAe5H,CAAA,EACpBC,QAAO,GACPhB,MAAOiF,GACP/C,cAAa,OAAA1gC,UAAA,QAAA41B,EAEZjM,GAAI,KAAC6U,OAAK,OAAE,CACXt2B,MAAOimB,EAAS,SAAS,EACzB7V,SAAU,GACV2wB,MAAO,CACL/gC,MAAOimB,EAAS,SAAS,CAC3B,EACD,SAAAyH,IAKJ7L,EAAI,CACHyU,MAAOqF,GAAiBjzB,IAAA2uB,EAAA,OAAA2J,EACnB5B,EAAe,OAAA4B,gBAAA3J,CAAA,EAAf+H,EAAe/H,CAAA,EACpB4C,OAAQA,IAAM,CACZoF,EAAkBhJ,SAAQ,CAC3B,MAAAv+B,UAAA,OAAA41B,GAEAzwB,GAAI,KAACsxB,MAAI,QAAEqR,EAAoB,EAAG9C,QAAQnhC,QAAU,CAAC,MAAA7D,UAAA,QAAA41B,EACnD7L,EAAI,CAACyU,MAAOwF,GAAW,IAAAhkC,UAAA,QAAA41B,EACrBjM,GAAI,CACH6U,MAAO,CACLlmB,SAAU,GACV0lB,QAAS,OACTC,eAAgB,SAChBnkB,UAAW,QACZ,EAAA9Z,SAAA,gBAAA41B,IAMNzwB,GAAI,KAACsxB,MAAI,QAAEqR,EAAoB,EAAG9C,QAAQnhC,OAAS,CAAC,MAAA7D,UAAA,QAAA41B,EAClD6I,GAAM,CAAA7tB,IAAA2uB,EAAA,OAAA4J,EAAM3B,EAAmB,OAAA2B,gBAAA5J,CAAA,EAAnBiI,EAAmBjI,CAAA,EAAEC,QAAO,OAACvyB,GAAC,QAAE26B,EAAO,CAAE,EAAEpJ,MAAOsF,GAAsBxB,OAAM,OAAAtiC,UAAA,QAAA41B,EACxF3wB,GAAG,KAAC4/B,MAAI,QAAEiD,EAAoB,EAAG9C,OAAO,EAAAhlC,SACtCA,CAACgC,EAAO/K,IAAC2+B,EACP8O,GAAO,KAAC3B,WAAS,QAAEqG,GAAArB,QAAQ9wC,EAAG,EAAC,EAAIqwC,KAAgBhe,OAAO8Y,IAAI,OAAO,CAAC,EAAEpgC,MAAOA,EAAOq8B,QAASmG,EAAY7D,QAASA,CAAO,EAAI,uBAUpJ,CCxOa,SAAS0I,GAASC,EAAa,CAC5C,MAAMvB,EAAU5pC,GAAe,IACtB,CACR,EACK,CAACorC,EAAeC,CAAgB,EAAIruC,EAAa,CAAC,EAClD,CAACsuC,EAAaC,CAAc,EAAIvuC,EAAa,CAAC,EACpD,IAAIsmC,EAEJ,SAASd,GAA2B,CAClC,IAAIgJ,EAAS,KAAK3pC,SAASo+B,SACvBqL,EAAW,IAGfpjC,EAAasjC,GAAUA,EAAO9pC,EAAE,EAChClI,GAAUgyC,EAAO/xC,GAAG,EACpB4xC,EAAiB,EAAG,EACpBE,EAAe,CAAC,EAChBE,EAASrL,SAAQ,EACjBkD,EAAcj8B,GAAa,EAC7B,CAEA,SAASqkC,GAAY,CACnB9xC,KACAyxC,EAAiB,CAAC,EAClBE,EAAe,CAAC,EAChBtF,WAAW,IAAM,CACf3C,EAAYlD,SAAQ,CACrB,EAAE,EAAE,CACP,CAEA,MAAMuL,EAAQ,CACZ,CACEC,MAAO,iBACPlqC,GAAI,MACJjI,IAAK,0EACLoyC,YAAa,0BACf,EACA,CACED,MAAO,cACPlqC,GAAI,QACJjI,IAAK,oDACLoyC,YAAa,oBACf,CAAC,EAGH,SAASC,EAASxoC,EAAO,CACvB,MAAMyoC,EAAY,CAChB1zC,MAAO,IACPC,OAAQ,IACR0zC,aAAc,EACd7F,MAAO,EACPp8B,MAAO,UACP+gC,MAAO,CACL3E,MAAO,IACPp8B,MAAO,UACT,GAEI,CAACA,EAAOkiC,CAAQ,EAAIjvC,EAAa,UAAU,EAEjD,OAAAy6B,EAAQ7L,EAAIoU,GAAK18B,EAAK,CAAE48B,QAASA,IAAM+L,EAAS,GAAU,EAAGhK,OAAQA,IAAMgK,EAAS,UAAU,EAAG5K,QAAO,GAAChB,MAAO0L,EAAS,IAAAlqC,UAAA,QAAA41B,EACtH7L,EAAI,CAAC/c,EAAG,GAAE,IAAAhN,UAAA,OAAA41B,GACRjM,GAAI,CAAC1c,EAAG,GAAIqL,SAAU,GAAE,IAAEpQ,OAAK,QAAEA,EAAK,CAAE,MAAAlI,UAAA,QAAGyB,EAAMJ,MAAQ,CAAC,EAAAu0B,IAC1DjM,GAAI,CAAC1c,EAAG,IAAKqL,SAAU,GAAI9hB,MAAO,IAAKC,OAAQ,GAAIwjB,QAAO,WAAQ/R,OAAK,QAAEA,EAAK,CAAE,MAAAlI,UAAA,QAAGyB,EAAMsoC,KAAK,EAAAnU,IAC9FjM,GAAI,CAAC1c,EAAG,IAAKqL,SAAU,GAAI9hB,MAAO,IAAKyjB,QAAO,YAAS/R,OAAK,QAAEA,EAAK,CAAE,MAAAlI,UAAA,QAAGyB,EAAMuoC,WAAW,WAGhG,CAEA,KAAM,CAACK,EAAMC,CAAO,EAAInvC,EAAa,GAAG,EAExC,SAASovC,EAAkBC,EAAK,CAC1Bf,EAAW,GACbG,EAASrL,SAAQ,CAIrB,CAEA,IAAIqL,EAEJ7tC,GAAa2C,GAAG8G,GAAgBu0B,GAAQ,CAClC0P,EAAW,GACbG,EAASrL,SAAQ,CAErB,EAAG,CAAEz/B,MAAO,EAAK,EAAC,EAElB,MAAM2rC,EAAYA,IAAM,CAClBhB,EAAW,GACbnxC,MAIEoyC,EAAaA,IAAM,CACnBjB,EAAW,GACbjxC,MAIEmyC,EAAWA,IAAM,CACjBlB,EAAW,GACbhxC,MAIEmyC,EAAYA,IAAM,CAClBnB,EAAW,GACb3wC,MAIJ,OAAA88B,EACG7L,EAAI,CAAC8gB,SAAU,WAAYC,YAAa,UAAYjB,SAAUA,EAAQ,IAAA7pC,UAAA,OAAA41B,GACpE7L,EAAI,CAAC/c,EAAG,IAAG,IAAAhN,UAAA,OAAA41B,GACTjM,GAAI,CAACrR,SAAU,GAAItL,EAAG,IAAKC,EAAG,GAAEjN,SAAA,SAAA41B,IAChC7L,EAAI,CAAC9c,EAAG,IAAKxW,OAAQ,EAAGD,MAAO,KAAM0R,MAAO,UAAU,KAAA0tB,IAGxDkI,GAAG,CAACyM,kBAAmBA,EAAmB5J,QAASA,EAClDxX,kBAAmB,CAAC4R,MAAO,GAAIlwB,SAAU,GAAI,EAC7C20B,QAAO,OAACxyB,GAAC,QAAEq9B,EAAI,CAAE,EAAEp9B,EAAG,IAAKzW,MAAO,KAAI,IAAEgoC,OAAK,QAAE9U,GAAOoU,GAAG,EAAEG,eAAgB,YAAa7V,IAAK,GAAE,IAAApoB,UAAA,OAAA41B,GAC9F3wB,GAAG,CAAC4/B,KAAMiF,EAAK9pC,SACXA,CAAC+qC,EAAM9zC,IAAC2+B,EACNqU,EAAQ9L,GAAA,KAACG,WAAS,QAAEmL,EAAW,CAAE,MAAE1G,WAAS,QAAEgF,EAAQ9wC,EAAC,CAAE,CAAC,MAAEoK,OAAK,QAAEpK,EAAC,CAAE,GAAM8zC,CAAI,GAAGnV,IAGzF7L,EAAI,CACH9c,EAAG,IACHxW,OAAQ,GACRD,MAAO,GACP0R,MAAO,WACPi6B,OAAQsI,EACRpI,QAASqI,EACTM,KAAML,EACN9B,OAAQ+B,EAASh6B,IAAA2uB,EAAA,OAAA9U,EACZmf,EAAQ,OAAAnf,gBAAA8U,CAAA,EAARqK,EAAQrK,CAAA,EACbjB,UAAS,OAAA1I,IAGZ7L,EAAI,KAAC9L,OAAK,QAAEsrB,EAAa,CAAE,MAAErhC,OAAK,QAAEimB,EAAS,SAAS,CAAC,EAAGpf,OAAQ,GAAG,MAG5E,CC3JA,MAAAk8B,GAAe,IACbrV,EACG7L,EAAI,CAACyU,MAAO,CAAEhoC,MAAO,KAAMC,OAAQ,KAAMyR,MAAO,SAAY,MAAAlI,UAAA,QAAA41B,EACzDjM,GAAI,CAAA3pB,SAAA,iBCFZ,IAAIumC,OAAY,IAChB,MAAMC,OAAoB,IAE1B,SAAA0E,GAAyBja,EAAgB3a,EAAe,CACtD,OAAQqwB,GAAoC,CAC1C,MAAM/uC,EAAM,aAAa,OAAAq5B,EAAM,eAAc,OAAA0V,GACzC,GAAAJ,GAAM,IAAI3uC,CAAG,EACR,OAAA2uC,GAAM,IAAI3uC,CAAG,EAGhB,MAAAgvC,EAAWtwB,GAAc,EAE/B,IAAIrX,EAASinC,GAAI,IAAItuC,CAAG,EAAE,KAAMivC,GAAa,CACvC,IAAArlC,EAAUqlC,EAAS,QAAQ,OAAQ7zB,GAAM,CAACA,EAAE,KAAK,EACjD8zB,GAASN,GAAc,IAAIvV,CAAM,EAAIuV,GAAc,IAAIvV,CAAM,EAAI,IAAI,OAAOqV,GAAoB9kC,CAAO,CAAC,EACxGulC,EAASV,GAAWS,EAAOF,CAAQ,EACvC,OAAIG,EAAOA,EAAO,OAAS,CAAC,EAAE,OAASH,EACrCJ,GAAc,IAAIvV,EAAQ8V,EAAO,IAAK,GAEtCP,GAAc,OAAOvV,CAAM,EAEtB8V,CAAA,CACR,EAEK,OAAAR,GAAA,IAAI3uC,EAAKqH,CAAM,EACdA,CAAA,CAEX,CCzBA,MAAMksC,GAAa,KACbC,GAAiB,CACrB,GAAGxL,EAAMyL,WAAWC,SACpB90C,MAAO20C,GACP10C,OAAQ,GACRwjB,QAAS,MACX,EACMsxB,GAAY9pC,GAAKm0B,EACpBjM,GAAIwU,GAAK18B,EAAK,CAAE+8B,MAAO4M,GAAc,IAAAprC,UAAA,QACnCyB,EAAMzB,QAAQ,EAElB,GAEKwrC,GAAoB,CACxB,GAAG5L,EAAMyL,WAAWI,MACpBj1C,MAAO20C,GACP10C,OAAQ,GACRwjB,QAAS,MACX,EAEMyxB,GAAa,CACjBpzB,SAAU,GACVoE,WAAY,EACd,EAEMivB,GAAelqC,GAAKm0B,EACvBjM,GAAIwU,GAAK18B,EAAK,CAAE+8B,MAAOgN,GAAiB,IAAAxrC,UAAA,QACtCyB,EAAMzB,QAAQ,EAElB,GAED,SAAS4rC,GAAWC,EAAS,CAC3B,MAAAjW,GAEKzwB,GAAI,KAACsxB,MAAI,QAAEoV,iBAASC,UAAUD,iBAASC,UAAW,GAAG,MAAA9rC,UAAA,OAAA41B,GACnD7L,EAAI,CACHlyB,IAAG,8EACHkyC,MAAK,yBACLvL,MAAO,CAAEhoC,MAAO,GAAIC,OAAQ,GAAIs1C,YAAa,EAAG,EAACnW,IAElDjM,GAAI,CAAC6U,MAAOwN,GAAa,IAAAhsC,UAAA,QAAG6rC,EAAQC,OAAS,GAAG,MAAAlW,IAElDzwB,GAAI,KAACsxB,MAAI,QAAEoV,iBAASI,SAASJ,iBAASI,SAAU,GAAG,MAAAjsC,UAAA,OAAA41B,GACjD7L,EAAI,CACHlyB,IAAG,iJACHkyC,MAAK,yBACLvL,MAAO,CAAEhoC,MAAO,GAAIC,OAAQ,GAAIs1C,YAAa,EAAG,EAACnW,IAElDjM,GAAI,CAAC6U,MAAOwN,GAAa,IAAAhsC,UAAA,QAAG6rC,EAAQI,MAAQ,GAAG,QAIxD,CAEA,MAAMC,GAASzqC,IACb,WAAAmoB,EAAAC,GAAA,QAAAa,UAEQyP,GAAWvQ,EAAE,KAAC,EAAG,GAAI,GAAI,EAAE,CAAC,EAAAE,GAAAF,EAAAuU,GAC5B18B,EAAK,OACF,CACLyG,MAAO,aACPiiC,aAAc,EACdgC,OAAQ,CAAE31C,MAAO,EAAG0R,MAAO,YAAa,CAC1C,CAAC,OAAAyiB,GAAAf,EAAAgM,EAEAjM,GAAI,CAAC6U,MAAOkN,GAAU,IAAA1rC,UAAA,QAAGyB,EAAMzB,QAAQ,KAAA4pB,CAAA,KAKxCoiB,GAAgBpM,EAAMyL,WAAWe,MAEjCC,GAAY5qC,GAAKm0B,EACpB7L,EAAI,KACHyU,OAAK,OAAE,CACL,GAAGoB,EAAM0M,QACTlkB,IAAK,GACL5xB,MAAO20C,GACP10C,OAAQ,GACT,MAAAuJ,UAAA,OAAA41B,GAEAjM,GAAI,CAAC6U,MAAOwN,GAAa,IAAAhsC,UAAA,QAAGyB,EAAM8qC,QAAQ,EAAA3W,IAC1C3wB,GAAG,KAAC4/B,MAAI,QAAEpjC,EAAM+qC,MAAM,EAAAxsC,SAAIgD,GAAI4yB,EAAMsW,GAAK,CAACj/B,EAAG,GAAEjN,SAAGgD,CAAI,EAAS,GAAAomC,GAC/DwC,OAAWnqC,EAAMoqC,OAAO,CAAC,IAE7B,EAEKY,GAAgBhrC,IACpB+oB,QAAQ9D,IAAI,SAAUjlB,EAAM+qC,MAAM,EAClC5W,EAAQ7L,EAAIoU,GACJ18B,EAAK,KACT+8B,OAAK,OAAE,CACL,GAAGoB,EAAM8M,WACTl2C,MAAO20C,GACP10C,OAAQ,IACR2xB,IAAK,GACN,MAAApoB,UAAA,OAAA41B,GAEA2V,GAAQ,KAAAvrC,UAAA,QAAEyB,EAAMsoC,KAAK,EAAAnU,IACrB+V,GAAW,KAAA3rC,UAAA,QAAEyB,EAAMuoC,WAAW,EAAApU,IAC9ByW,GAAQ,KACPE,UAAQ,QAAE9qC,EAAM8qC,QAAQ,MACxBC,QAAM,QAAE/qC,EAAM+qC,MAAM,MACpBX,SAAO,QAAEpqC,EAAMoqC,OAAO,UCzGvB,SAASc,GAAan1C,EAAS,CACpC,MAAMD,EAAQ,KAAK,MAAMC,EAAU,EAAE,EAC/Bo1C,EAAmBp1C,EAAU,GACnC,OAAOD,EAAQ,MAAQq1C,EAAmB,GAAK,IAAM,IAAMA,EAAmB,GAChF,CAEA,SAASC,GAASC,EAAY,CAE5B,OADcA,EAAW,MAAM,GAAG,EACrB,CAAC,CAChB,CAoBO,SAASC,GAAQ,CAAC,KAAAp2C,EAAM,GAAAkJ,CAAE,EAAG,CAClC,IAAImtC,EAAKr2C,IAAS,QAAU,CAC1B,OAAQ,GACR,MAAO,EACR,EAAG,GAEJ,OAAOuvC,GAAI,IAAI,IAAI,OAAAvvC,EAAI,KAAI,OAAAkJ,EAAI,EAAE,KAC9B7J,IAAU,CACT,gBAAiB8vC,GAAY9vC,EAAK,cAAe,UAAU,EAC3D,YAAa,CACX,MAAOA,EAAK,OAASA,EAAK,KAC1B,YAAaA,EAAK,SAClB,OAAQ,CAAC,IAAI,EACb,SAAUW,IAAS,QACjBg2C,GAAa32C,EAAK,OAAO,EAAI,MAAQA,EAAK,aAAe,GAAG,OAAA62C,GAAS72C,EAAK,cAAc,EAAC,OAAM,OAAA62C,GAAS72C,EAAK,aAAa,GAC5H,QAASg3C,CACV,EACD,GAAGh3C,CACJ,EAAC,CACN,CChDA,MAAei3C,GAAA,CACX,IAAK,CACD,QAAS,OACT,eAAgB,eAChB,OAAQ,GACV,EACA,OAAQ,CACN,QAAS,OACT,cAAe,SACf,eAAgB,YAChB,IAAK,GACL,MAAOrN,EAAM,OAAO,QAAW,EAAIA,EAAM,OAAO,QAChD,EAAGA,EAAM,OAAO,QAAUA,EAAM,OAAO,QACvC,EAAG,IACH,OAAQ,CACV,EACA,eAAgB,CACd,MAAOA,EAAM,OAAO,QACpB,OAAQ,IACR,EAAG,IACH,EAAG,EACH,OAAQ,CACV,CACN,ECZe,SAASsN,GAAWzrC,EAA2B,CAC5D+oB,QAAQ9D,IAAIjlB,EAAM9K,IAAI,EAEtB,MAAMoxC,EAAU5pC,GAAe,IACtB,CACR,EAGD,OAAAy3B,EACG7L,EAAI,CAACojB,SAAQ,OAAC3O,OAAK,QAAE9U,GAAO0jB,cAAc,MAAAptC,UAAA,QAAA41B,EACxC6I,GAAM,CACL6D,OAAM,GACN+K,SAAQ,sBACR7N,QAAO,OACPvyB,GAAC,QAAExL,EAAMwL,CAAC,MACVuxB,OAAK,QAAE9U,GAAO+U,MAAM,MAAAz+B,UAAA,QAAA41B,EAEnB3wB,GAAG,KAAC4/B,MAAI,QAAEpjC,iBAAOzL,OAAQ,EAAE,EAAAgK,SACzBA,CAACgC,EAAO/K,IAAC2+B,EACP8O,GAAO,KACN3B,WAAS,QAAEgF,EAAQ9wC,EAAC,CAAE,CAAC,EACvBgnC,eAAgB,YAChBj8B,MAAOA,EAAK,IACZq8B,SAAO,QAAE58B,EAAM48B,OAAO,MACtBsC,SAAO,QAAEl/B,EAAMk/B,OAAO,GAEzB,QAKX,CC1CA,MAAe2M,GAAA,CACb,cAAe,CACb,aAAc,EACd,MAAO,IACP,OAAQ,GACR,MAAO,EACP,OAAQ,KACR,MAAOnf,EAAS,SAAS,EACzB,MAAO,GACP,EAAG,EACH,EAAG,IACL,EACA,WAAY,CACV,OAAQ,EACR,SAAU,GACV,MAAOA,EAAS,SAAS,EACzB,OAAQ,GACR,EAAG,GACH,EAAG,GACH,MAAO,GACP,SAAU,MAEZ,EAEA,UAAW,CACT,aAAc,EACb,EAAG,GAAI,EAAG,GAAI,OAAQ,GACvB,MAAOA,EAAS,SAAS,CAC3B,CACF,ECnBe,SAASof,GAAa9rC,EAA2B,CAE9D1F,UACE2C,GACE8G,GACCu0B,GAAQ,CACP1zB,EAAa0zB,CAAG,EAChBqK,WAAW,IAAM,CACf5Z,QAAQ9D,IAAI,MAAOqT,CAAG,CAcvB,EAAE,EAAE,CACP,EACA,CAAEj7B,MAAO,EACX,EACF,EAMA82B,EACGzwB,GAAI,KAACsxB,MAAI,QAAEh1B,EAAM+rC,MAAM,MAAAxtC,UAAA,QAAA41B,EACrB7L,EAAIoU,GAAK18B,EAAK,CAAE+9B,QAAO,OAAChB,OAAK,QAAE9U,GAAO+jB,aAAa,MAAAztC,UAAA,QAAA41B,EACjDjM,GAAI,KAAC6U,OAAK,QAAE9U,GAAOgkB,UAAU,MAAA1tC,UAAA,QAAGyB,iBAAOquB,UAAW,EAAE,UAI7D,CCzBA,MAAM6d,GAASA,IAAM,CACnB,MAAM1d,EAASiC,KACT,CAAC0V,EAASC,CAAU,EAAI1sC,EAAa,CAAC,EACtC,CAACyyC,EAAYC,CAAa,EAAI1yC,EAAY,EAC3BmB,GAAesxC,EAAYE,EAAsB,EACtE,KAAM,CAACzJ,EAAa0J,CAAc,EAAI5yC,EAAa,CAAE,GAC/C+kC,EAAWlO,KAEX,CAACgc,EAAoBC,CAAe,EAAI9yC,EAAa,EAAK,EAChDgD,GAAe,IACtB,CACR,EACD,IAA4B+vC,EAE5B,MAAMC,EAAWhyC,GAAW,IACnB4oC,GAAqBmG,GAAejb,EAAOgB,QAAU,MAAO,CAAC,CAAC,CACtE,EACDl1B,GACE2C,GACE8G,GACCu0B,GAAQ,CACHA,EAAIkG,UACNnB,GAAoB/E,EAAIkG,QAAQ,EAK9BlG,EAAIsK,aACN0J,EAAehU,EAAIsK,WAAW,CAElC,EACA,CAAEvlC,MAAO,EACX,EACF,EACA,SAASsvC,GAAmB,CAC1B5jB,QAAQ9D,IAAI,wBAAwB,EACpCunB,EAAgB,EAAI,CACtB,CAEA,SAASzJ,GAA8B,QACrC1+B,EAAA,KAAK9F,SAASo+B,WAAd,MAAAt4B,EAAwBy4B,WACxBsJ,GAAY,KAAK56B,GAAK,GAAK,GAAK,EAAE,EAClC,IAAIu7B,EAAW2F,EAAQ,EAAGnJ,MAAK,EAAGnhC,OAC9B,KAAKoK,SAELu6B,IAAa,GACZ,KAAKv6B,OAAOmwB,UAAY,KAAKnwB,OAAOmwB,UAAYoK,EAAW,IAE5D2F,EAAU,EAAChJ,QAASznC,GAAMA,EAAI,CAAC,CAGrC,CAEA,SAASijC,GAA2B,CAClC,IAAIgJ,EAAS,KAAK3pC,SAASo+B,SAC3B/3B,EAAasjC,GAAUA,EAAO3R,IAAI,EAClCkI,EAASyJ,EAAO3R,IAAI,CACtB,CAEA,OAAApC,EACG7L,EAAI,KAAA/pB,UAAA,OAAA41B,GACFzwB,GAAI,KAACsxB,MAAI,QAAE0X,EAAU,EAACnJ,MAAO,EAACnhC,MAAM,MAAA7D,UAAA,QAAA41B,EAClC6W,GAAYtO,GAAA,CAAClxB,EAAG,IAAKD,EAAG,EAAE,EAAMq3B,CAAW,GAAAzO,EAC3CsX,GAAU,CACTv2C,KAAI,aACJgqC,QAASA,EACTtC,QAASmG,EAAU,IACnBxuC,MAAI,QAAEm4C,EAAQ,EAAGnJ,OAAO,MACxB/3B,GAAC,QAAE26B,EAAO,CAAE,MAAAhS,IAIfmL,GAAM,CACLgC,UAAS,GAAAnyB,IAAA2uB,EAAA,OAAA9U,EACJyjB,EAAU,OAAAzjB,gBAAA8U,CAAA,EAAV2O,EAAU3O,CAAA,EACf8C,QAASA,IAAM,CACb,GAAI6L,EAAW5kB,OAAO8Y,IAAI,OAAO,EAC/B,MAAO,GAEK58B,KACd0oC,EAAW3P,SAAQ,CACpB,EACDvxB,EAAG,IACH2zB,QAASyN,EAAgBpuC,SAAA,6BAAA41B,IAI1B2X,GAAY,KACXC,QAAM,QAAEQ,EAAkB,CAAE,EAC5Ble,QAAS,4BAA4B,MAI7C,ECrHepG,GAAA,CACb,IAAK,CACH,QAAS,OACT,eAAgB,eAChB,OAAQ,GACV,EACA,OAAQ,CACN,QAAS,OACT,cAAe,SACf,eAAgB,YAChB,IAAK,GACL,MAAOkW,EAAM,OAAO,QAAU,EAAIA,EAAM,OAAO,QAC/C,EAAGA,EAAM,OAAO,QAAUA,EAAM,OAAO,QACvC,EAAG,IACH,OAAQ,CACV,EACA,eAAgB,CACd,MAAOA,EAAM,OAAO,QACpB,OAAQ,IACR,EAAG,IACH,EAAG,EACH,OAAQ,CACV,CACF,ECPe,MAAMyO,CAAW,CAE5B,OAAO,aAAaC,EAAIC,EAAI7wC,EAAG,CAC3B,OAAO4wC,EAAK5wC,EAAI6wC,GAAM,EAAI7wC,EAC7B,CAED,OAAO,IAAIsV,EAAGw7B,EAAGj1C,EAAG,CAChB,OAAQyZ,GAAK,KAAOw7B,GAAK,GAAKj1C,EAAK,IAAM,QAC5C,CAED,OAAO,KAAKyZ,EAAGw7B,EAAGj1C,EAAGD,EAAG,CACpB,OAAQ0Z,GAAK,KAAOw7B,GAAK,GAAKj1C,GAAOD,EAAI,IAAO,GAAK,QACxD,CAED,OAAO,aAAa4O,EAAO,CACvB,IAAI8K,GAAM9K,EAAQ,MAAS,GAAK,IAC5BsmC,GAAMtmC,EAAQ,IAAO,GAAK,IAC1B3O,EAAI2O,EAAQ,IAChB,MAAO,OAAS8K,EAAI,IAAMw7B,EAAI,IAAMj1C,EAAI,GAC3C,CAED,OAAO,cAAc2O,EAAO,CACxB,IAAI8K,GAAM9K,EAAQ,MAAS,GAAK,IAC5BsmC,GAAMtmC,EAAQ,IAAO,GAAK,IAC1B3O,EAAI2O,EAAQ,IACZ5O,GAAM4O,EAAQ,SAAY,GAAK,IACnC,MAAO,QAAU8K,EAAI,IAAMw7B,EAAI,IAAMj1C,EAAI,IAAMD,EAAE,QAAQ,CAAC,EAAI,GACjE,CAED,OAAO,uBAAuB4O,EAAO,CACjC,IAAI8K,EAAI,KAAK,MAAM9K,EAAM,CAAC,EAAI,GAAG,EAC7BsmC,EAAI,KAAK,MAAMtmC,EAAM,CAAC,EAAI,GAAG,EAC7B3O,EAAI,KAAK,MAAM2O,EAAM,CAAC,EAAI,GAAG,EAC7B5O,EAAI,KAAK,MAAM4O,EAAM,CAAC,EAAI,GAAG,EAAI,IACrC,MAAO,QAAU8K,EAAI,IAAMw7B,EAAI,IAAMj1C,EAAI,IAAMD,EAAE,QAAQ,CAAC,EAAI,GACjE,CAED,OAAO,4BAA4Bm1C,EAAM,CACrC,IAAIz7B,GAAMy7B,EAAO,MAAS,GAAK,IAC3BD,GAAMC,EAAO,IAAO,GAAK,IACzBl1C,EAAIk1C,EAAO,IACXn1C,EAAMm1C,EAAO,SAAY,EAC7B,MAAO,CAACz7B,EAAI,IAAKw7B,EAAI,IAAKj1C,EAAI,IAAKD,EAAI,GAAG,CAC7C,CAED,OAAO,2BAA2Bm1C,EAAM,CACpC,IAAIz7B,GAAMy7B,EAAO,MAAS,GAAK,IAC3BD,GAAMC,EAAO,IAAO,GAAK,IACzBl1C,EAAIk1C,EAAO,IACf,MAAO,CAACz7B,EAAI,IAAKw7B,EAAI,IAAKj1C,EAAI,GAAG,CACpC,CAED,OAAO,kBAAkBk1C,EAAM,CAC3B,IAAIz7B,GAAMy7B,EAAO,MAAS,GAAK,IAC3BD,GAAMC,EAAO,IAAO,GAAK,IACzBl1C,EAAIk1C,EAAO,IACXn1C,EAAMm1C,EAAO,SAAY,EAC7B,MAAO,CAACz7B,EAAGw7B,EAAGj1C,EAAGD,CAAC,CACrB,CAED,OAAO,cAAckb,EAAM,CACvBA,EAAK,CAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,EAAK,CAAC,CAAC,CAAC,EAC5CA,EAAK,CAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,EAAK,CAAC,CAAC,CAAC,EAC5CA,EAAK,CAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,EAAK,CAAC,CAAC,CAAC,EAC5CA,EAAK,CAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,EAAK,CAAC,CAAC,CAAC,EAC5C,IAAInY,IAAMmY,EAAK,CAAC,EAAI,IAAM,MAAQA,EAAK,CAAC,EAAI,IAAM,MAAQA,EAAK,CAAC,EAAI,IAAM,IAAMA,EAAK,CAAC,EAAI,GAC1F,OAAInY,EAAI,IACJA,EAAI,WAAaA,EAAI,GAElBA,CACV,CAED,OAAO,YAAYqyC,EAAIC,EAAIjxC,EAAG,CAC1B,IAAIkxC,GAAOF,EAAK,MAAS,GAAK,IAC1BG,GAAOH,EAAK,IAAO,GAAK,IACxBI,EAAKJ,EAAK,IACVK,EAAOL,EAAK,SAAY,EAExBM,GAAOL,EAAK,MAAS,GAAK,IAC1BM,GAAON,EAAK,IAAO,GAAK,IACxBO,EAAKP,EAAK,IACVQ,EAAOR,EAAK,SAAY,EAExB37B,EAAI47B,EAAKlxC,EAAIsxC,GAAM,EAAItxC,GACvB,EAAImxC,EAAKnxC,EAAIuxC,GAAM,EAAIvxC,GACvBnE,EAAIu1C,EAAKpxC,EAAIwxC,GAAM,EAAIxxC,GACvBpE,EAAIy1C,EAAKrxC,EAAIyxC,GAAM,EAAIzxC,GAE3B,OAAO,KAAK,MAAMpE,CAAC,EAAI,SAAW,KAAK,MAAM0Z,CAAC,EAAI,MAAQ,KAAK,MAAM,CAAC,EAAI,IAAM,KAAK,MAAMzZ,CAAC,CAC/F,CAED,OAAO,iBAAiBoC,EAAG+B,EAAG,CAC1B,IAAIsV,EAAI,EAAGw7B,EAAI,EAAGj1C,EAAI,EAAGD,EAAI,EAAGoG,EAAI,EAChC6B,EAAI5F,EAAE,OACV,QAAS1E,EAAI,EAAGA,EAAIsK,EAAGtK,IAAK,CACxB,IAAI23C,GAAOjzC,EAAE1E,CAAC,EAAI,MAAS,GAAK,IAC5B43C,GAAOlzC,EAAE1E,CAAC,EAAI,IAAO,GAAK,IAC1B63C,EAAKnzC,EAAE1E,CAAC,EAAI,IACZ83C,EAAOpzC,EAAE1E,CAAC,EAAI,SAAY,EAC9B+b,GAAK47B,EAAKlxC,EAAEzG,CAAC,EACbu3C,GAAKK,EAAKnxC,EAAEzG,CAAC,EACbsC,GAAKu1C,EAAKpxC,EAAEzG,CAAC,EACbqC,GAAKy1C,EAAKrxC,EAAEzG,CAAC,EACbyI,GAAKhC,EAAEzG,CAAC,CACX,CAED,OAAAyI,EAAI,EAAIA,EACD,KAAK,MAAMpG,EAAIoG,CAAC,EAAI,SAAW,KAAK,MAAMsT,EAAItT,CAAC,EAAI,MAAQ,KAAK,MAAM8uC,EAAI9uC,CAAC,EAAI,IAAM,KAAK,MAAMnG,EAAImG,CAAC,CAC/G,CAED,OAAO,sBAAsB/D,EAAG,CAC5B,IAAIqX,EAAI,EAAGw7B,EAAI,EAAGj1C,EAAI,EAAGD,EAAI,EAAGoG,EAAI,EAChC6B,EAAI5F,EAAE,OACV,QAAS1E,EAAI,EAAGA,EAAIsK,EAAGtK,IAAK,CACxB,IAAI23C,GAAOjzC,EAAE1E,CAAC,EAAI,MAAS,GAAK,IAC5B43C,GAAOlzC,EAAE1E,CAAC,EAAI,IAAO,GAAK,IAC1B63C,EAAKnzC,EAAE1E,CAAC,EAAI,IACZ83C,EAAOpzC,EAAE1E,CAAC,EAAI,SAAY,EAC9B+b,GAAK47B,EACLJ,GAAKK,EACLt1C,GAAKu1C,EACLx1C,GAAKy1C,EACLrvC,GAAK,CACR,CAED,OAAAA,EAAI,EAAIA,EACD,KAAK,MAAMpG,EAAIoG,CAAC,EAAI,SAAW,KAAK,MAAMsT,EAAItT,CAAC,EAAI,MAAQ,KAAK,MAAM8uC,EAAI9uC,CAAC,EAAI,IAAM,KAAK,MAAMnG,EAAImG,CAAC,CAC/G,CAED,OAAO,gBAAgB/D,EAAGsiB,EAAO,CAC7B,IAAI3kB,GAAMqC,EAAI,SAAW,GAAKsiB,EAAS,EACvC,QAAYtiB,GAAK,GAAM,KAAQrC,EAAK,IAAO,OACnCqC,EAAI,OAAUrC,EAAK,IAAO,UACzBqC,EAAI,MAAS,IAAMrC,EAAK,IAAO,WACnCA,GAAK,GACb,CAED,OAAO,IAAI+0B,EAAK,CACZ,OAAOA,GAAO,KAAK,GAAK,IAC3B,CAED,OAAO,gBAAgB/0B,EAAGC,EAAGoC,EAAGiG,EAAG,CAC/B,IAAIwtC,EAAK,EAAM91C,EACX+1C,EAAK,GAAO1zC,EAAIrC,GAAK81C,EACrBE,EAAK,EAAMF,EAAKC,EAChBE,EAAK,EAAMh2C,EACXi2C,EAAK,GAAO5tC,EAAIrI,GAAKg2C,EACrBE,EAAK,EAAMF,EAAKC,EAEpB,OAAO,SAAUp3C,EAAM,CACnB,GAAIA,GAAQ,EACR,MAAO,GAEX,GAAIA,GAAQ,EACR,MAAO,GAGX,IAAIsH,EAAI,GAAKgwC,EAAKC,EAAMC,EAExB,QAASC,EAAK,EAAGA,EAAK,GAAIA,IAAM,CAG5B,GAFAH,EAAMhwC,GAAKA,GAAKA,EAAI4vC,EAAKD,GAAMD,GAC/BQ,EAAKx3C,EAAOs3C,EACRE,EAAK,OAASA,EAAK,KACnB,OAAOlwC,GAAKA,GAAKA,EAAI+vC,EAAKD,GAAMD,GAMpC,GAFAI,EAAOjwC,GAAKA,GAAK,EAAI4vC,GAAM,EAAID,GAAMD,EAEjCO,EAAO,OAASA,EAAO,MAEvB,MAGJjwC,GAAKkwC,EAAKD,CACb,CAGD,IAAIG,EAAO,EACPC,EAAO,EACX,QAASF,EAAK,EAAGA,EAAK,GAAIA,IAAM,CAM5B,GALAnwC,EAAI,IAAOowC,EAAOC,GAElBL,EAAMhwC,GAAKA,GAAKA,EAAI4vC,EAAKD,GAAMD,GAE/BQ,EAAKx3C,EAAOs3C,EACRE,EAAK,OAASA,EAAK,KAEnB,OAAOlwC,GAAKA,GAAKA,EAAI+vC,EAAKD,GAAMD,GAGhCK,EAAK,EACLG,EAAOrwC,EAEPowC,EAAOpwC,CAEd,CAEb,CACK,CAED,OAAO,kBAAkB3G,EAAK,CAC1B,OAAQA,EAAG,CACP,IAAK,SACD,OAAO,SAAUX,EAAM,CACnB,OAAOA,CAC3B,EACY,IAAK,OACD,OAAOi2C,EAAW,gBAAgB,IAAM,GAAK,IAAM,CAAG,EAC1D,IAAK,UACD,OAAOA,EAAW,gBAAgB,IAAM,EAAG,EAAK,CAAG,EACvD,IAAK,WACD,OAAOA,EAAW,gBAAgB,EAAG,EAAG,IAAM,CAAG,EACrD,IAAK,cACD,OAAOA,EAAW,gBAAgB,IAAM,EAAG,IAAM,CAAG,EACxD,IAAK,aACD,OAAO,UAAY,CACf,MAAO,EAC3B,EACY,IAAK,WACD,OAAO,SAAUj2C,EAAM,CACnB,OAAOA,IAAS,EAAI,EAAI,CAC5C,EACY,QACI,IAAIkD,EAAI,gBACR,GAAIvC,GAAOA,EAAI,QAAQuC,CAAC,IAAM,EAAG,CAC7B,IAAI00C,EAAQj3C,EAAI,OAAOuC,EAAE,OAAQvC,EAAI,OAASuC,EAAE,OAAS,CAAC,EAAE,MAAM,GAAG,EACrE,GAAI00C,EAAM,SAAW,EACjB,eAAQ,KAAK,wCAA0Cj3C,CAAG,EAGnD,SAAUX,EAAM,CACnB,OAAOA,CACnC,EAEoB,IAAIkB,EAAI,WAAW02C,EAAM,CAAC,CAAC,EACvBz2C,EAAI,WAAWy2C,EAAM,CAAC,CAAC,EACvBr0C,EAAI,WAAWq0C,EAAM,CAAC,CAAC,EACvBpuC,EAAI,WAAWouC,EAAM,CAAC,CAAC,EAC3B,OAAI,MAAM12C,CAAC,GAAK,MAAMC,CAAC,GAAK,MAAMoC,CAAC,GAAK,MAAMiG,CAAC,GAC3C,QAAQ,KAAK,wCAA0C7I,CAAG,EAEnD,SAAUX,EAAM,CACnB,OAAOA,CACnC,GAG2Bi2C,EAAW,gBAAgB/0C,EAAGC,EAAGoC,EAAGiG,CAAC,CAChE,KACoB,gBAAQ,KAAK,wCAA0C7I,CAAG,EAEnD,SAAUX,EAAM,CACnB,OAAOA,CAC/B,CAES,CACJ,CAEL,CClQe,IAAA63C,EAAA,MAAMC,EAAM,CAEvB,OAAO,WAAW90C,EAAO,CACrB,OAAO,OAAOA,GAAU,UAC3B,CAED,OAAO,SAASA,EAAO,CACnB,OAAO,OAAOA,GAAU,QAC3B,CAED,OAAO,UAAUA,EAAO,CACpB,OAAQ,OAAOA,GAAU,UAAaA,EAAQ,IAAO,CACxD,CAED,OAAO,UAAUA,EAAO,CACpB,OAAOA,IAAU,IAAQA,IAAU,EACtC,CAED,OAAO,SAASA,EAAO,CACnB,OAAO,OAAOA,GAAU,QAC3B,CAED,OAAO,MAAMiB,EAAG,CACZ,OAAI6zC,GAAM,gBAAgB7zC,CAAC,GAAK,MAAM,QAAQA,CAAC,EACpC6zC,GAAM,aAAa7zC,CAAC,EAGpBA,CAEd,CAED,OAAO,gBAAgB4qB,EAAK,CACxB,IAAIhjB,EAAO,OAAO,KAAKgjB,CAAG,EACtBkpB,EAAQ,CAAE,EACd,QAASl5C,EAAI,EAAGA,EAAIgN,EAAK,OAAQhN,IAC7Bk5C,EAAMlsC,EAAKhN,CAAC,CAAC,EAAIgwB,EAAIhjB,EAAKhN,CAAC,CAAC,EAEhC,OAAOk5C,CACV,CAED,OAAO,MAAMC,EAAMC,EAAM,CACrB,IAAIpsC,EAAO,OAAO,KAAKosC,CAAI,EAC3B,QAASp5C,EAAI,EAAGA,EAAIgN,EAAK,OAAQhN,IAC7Bm5C,EAAKnsC,EAAKhN,CAAC,CAAC,EAAIo5C,EAAKpsC,EAAKhN,CAAC,CAAC,EAEhC,OAAOm5C,CACV,CAED,OAAO,SAASh1C,EAAO,CACnB,IAAIzE,EAAO,OAAOyE,EAClB,MAAO,CAAC,CAACA,IAAUzE,IAAS,UAAYA,IAAS,WACpD,CAED,OAAO,cAAcyE,EAAO,CAExB,MAAO,CAAC,CAACA,GADE,OAAOA,IACU,QAC/B,CAED,OAAO,gBAAgBA,EAAM,CACzB,OAAO,OAAOA,GAAU,UAAYA,GAASA,EAAM,cAAgB,MACtE,CAED,OAAO,cAAciG,EAAOivC,EAAK,CAC7B,OAAOJ,GAAM,eAAe7uC,EAAOivC,EAAI,MAAM,CAChD,CAED,OAAO,eAAejvC,EAAOc,EAAK,CAC9B,GAAIA,IAAQ,EAAG,OAAOd,EACtB,KAAOA,EAAQ,GACXA,GAAS,KAAK,KAAK,CAACA,EAAQc,CAAG,EAAIA,EAEvC,OAAAd,EAAQA,EAAQc,EACTd,CACV,CAED,OAAO,aAAa4lB,EAAK,CACrB,IAAIhwB,EAAG0E,EACP,GAAIu0C,GAAM,WAAWjpB,CAAG,EAEpB,OAAOA,EAEX,GAAI,MAAM,QAAQA,CAAG,EAAG,CACpBtrB,EAAI,GACJ,IAAIsI,EAAO,OAAO,KAAKgjB,CAAG,EAC1B,IAAKhwB,EAAI,EAAGA,EAAIgN,EAAK,OAAQhN,IACzB0E,EAAEsI,EAAKhN,CAAC,CAAC,EAAIi5C,GAAM,aAAajpB,EAAIhjB,EAAKhN,CAAC,CAAC,CAAC,EAEhD,OAAO0E,CACV,SAAUu0C,GAAM,SAASjpB,CAAG,EAAG,CAC5BtrB,EAAI,CAAE,EACN,IAAIsI,EAAO,OAAO,KAAKgjB,CAAG,EAC1B,IAAKhwB,EAAI,EAAGA,EAAIgN,EAAK,OAAQhN,IACzB0E,EAAEsI,EAAKhN,CAAC,CAAC,EAAIi5C,GAAM,aAAajpB,EAAIhjB,EAAKhN,CAAC,CAAC,CAAC,EAEhD,OAAO0E,CACnB,KACY,QAAOsrB,CAEd,CAED,OAAO,YAAYqnB,EAAIC,EAAI,CACvB,OAAK,OAAOD,GAAS,OAAOC,EAAY,GACpC2B,GAAM,gBAAgB5B,CAAE,EACjB4B,GAAM,gBAAgB3B,CAAE,GAAK2B,GAAM,oBAAoB5B,EAAIC,CAAE,EAC7D,MAAM,QAAQD,CAAE,EAChB,MAAM,QAAQC,CAAE,GAAK2B,GAAM,YAAY5B,EAAIC,CAAE,EAE7CD,IAAOC,CAErB,CAED,OAAO,oBAAoB6B,EAAMC,EAAM,CACnC,IAAIE,EAAQ,OAAO,KAAKH,CAAI,EACxBI,EAAQ,OAAO,KAAKH,CAAI,EAC5B,GAAIE,EAAM,SAAWC,EAAM,OACvB,MAAO,GAGX,QAASv5C,EAAI,EAAGsK,EAAIgvC,EAAM,OAAQt5C,EAAIsK,EAAGtK,IAAK,CAC1C,MAAMw5C,EAAKF,EAAMt5C,CAAC,EACZy5C,EAAKF,EAAMv5C,CAAC,EAClB,GAAIw5C,IAAOC,EACP,MAAO,GAGX,MAAMpC,EAAK8B,EAAKK,CAAE,EACZlC,EAAK8B,EAAKK,CAAE,EAElB,GAAI,CAACR,GAAM,YAAY5B,EAAIC,CAAE,EACzB,MAAO,EAEd,CAED,MAAO,EACV,CAED,OAAO,YAAYD,EAAIC,EAAI,CACvB,GAAID,EAAG,SAAWC,EAAG,OACjB,MAAO,GAEX,QAAS,EAAI,EAAGhtC,EAAI+sC,EAAG,OAAQ,EAAI/sC,EAAG,IAClC,GAAI,CAAC,KAAK,YAAY+sC,EAAG,CAAC,EAAGC,EAAG,CAAC,CAAC,EAC9B,MAAO,GAIf,MAAO,EACV,CAED,OAAO,WAAWjzC,EAAG,CACjB,IAAI2D,EAAS,GACb,OAAA3D,EAAE,QAAQ,SAAUF,EAAO,CACvB6D,EAAO,KAAK7D,CAAK,CAC7B,CAAS,EACM6D,CACV,CAED,OAAO,gBAAgBga,EAAU,CAC7B,IAAIha,EAAS,GACT0xC,EAAiB13B,EAAS,OAC9B,KAAO,CAAC03B,EAAe,MACnB1xC,EAAO,KAAK0xC,EAAe,KAAK,EAChCA,EAAiB13B,EAAS,OAE9B,OAAOha,CACV,CAED,OAAO,SAAS2xC,EAAU,CACtB,OAAOA,GAAY,IAAMA,GAAY,EACxC,CAEL,EAEAV,EAAM,MAAS,OAAO,OAAW,KAAiB,OAAO,WAAe,IACxEA,EAAM,MAAQA,EAAM,OAAU,UAAU,UAAU,QAAQ,KAAK,IAAM,GACrEA,EAAM,QAAW,OAAO,WAAe,IACvCA,EAAM,OAAU,OAAO,OAAW,KAAgBA,EAAM,QACxDA,EAAM,MAAQA,EAAM,OAAU,UAAU,UAAU,QAAQ,eAAe,IAAM,GAC/EA,EAAM,QAAUA,EAAM,QAAU,UAAU,UAAU,QAAQ,QAAQ,IAAM,IAAM,UAAU,UAAU,QAAQ,QAAQ,IAAM,IClL3G,MAAMW,EAAK,CAEtB,OAAO,cAAc5pB,EAAKjiB,EAAM5J,EAAO,CACnC6rB,EAAIjiB,CAAI,EAAI5J,CACf,CAED,OAAO,YAAY6rB,EAAKxgB,EAAU,CAC9B,GAAI,CAACypC,EAAM,gBAAgBzpC,CAAQ,EAC/B,QAAQ,MAAM,6CAA6C,MACxD,CACH,IAAIqqC,EAAQ,OAAO,KAAKrqC,CAAQ,EAChC,QAASxP,EAAI,EAAGsK,EAAIuvC,EAAM,OAAQ75C,EAAIsK,EAAGtK,IAAK,CAC1C,IAAI+N,EAAO8rC,EAAM75C,CAAC,EAElB,KAAK,oBAAoBgwB,EAAKjiB,EAAMyB,EAASzB,CAAI,CAAC,CACrD,CACJ,CACJ,CAED,OAAO,oBAAoBiiB,EAAKjiB,EAAM5J,EAAO,CACzC,IAAIG,EAAS0rB,EAAI,YAAc4pB,GAAK,cAEhC7rC,EAAK,OAAO,CAAC,IAAM,IAEfA,IAAS,YACT,QAAQ,MAAM,0CAA4CA,EAAO,kBAAkB,EAEhFA,IAAS,SAEZkrC,EAAM,WAAW90C,CAAK,GAAKA,EAAM,UAEjCA,EAAQA,EAAM,QAAQ6rB,CAAG,GAG7B1rB,EAAO0rB,EAAKjiB,EAAM5J,CAAK,EAE9B,CAED,OAAO,MAAM21C,EAAM,CAEfA,EAAK,QAAU,EAClB,CAGL,CC5Ce,MAAMC,EAAkB,CAEnC,OAAO,WAAWC,EAAMC,EAAeC,EAAgB,CACnD,MAAMC,EAAYF,EAAgB,EAClC,IAAIG,EAEAC,EAAeC,EAEnB,OAAON,EAAI,CACP,IAAK,aACDK,EAAgB,EAChBC,EAAiB,EACjB,MACJ,IAAK,WACDD,EAAgBH,EAChBI,EAAiB,EACjB,MACJ,IAAK,SACDD,EAAgBH,EAAiB,EACjCI,EAAiB,EACjB,MACJ,IAAK,gBACDD,EAAgB,EAChBC,EAAiB,KAAK,IAAI,EAAGJ,CAAc,EAAIC,EAC/C,MACJ,IAAK,eACD,GAAID,EAAiB,EACjB,OAAO,KAAK,WAAW,SAAUD,EAAeC,CAAc,EAE9DE,EAAcF,GAAkBC,EAAW,GAC3CE,EAAgB,GAAMD,EACtBE,EAAiBF,EAErB,MACJ,IAAK,eACD,GAAIF,EAAiB,EACjB,OAAO,KAAK,WAAW,SAAUD,EAAeC,CAAc,EAE9DE,EAAcF,GAAkBC,EAAW,GAC3CE,EAAgBD,EAChBE,EAAiBF,EAErB,MACJ,IAAK,UACDC,EAAgB,EAChBC,EAAiB,EACjB,MACJ,QACI,MAAM,IAAI,MAAM,iBAAmBN,CAAI,CAC9C,CAED,MAAO,CAAC,cAAAK,EAAe,eAAAC,CAAc,CACxC,CAEL,CCpDe,MAAMC,EAAe,CAEhC,YAAYC,EAAQ,CAChB,KAAK,QAAUA,EACf,KAAK,oBAAsB,CAC9B,CAED,IAAI,QAAS,CACT,OAAO,KAAK,QAAQ,MACvB,CAED,MAAO,CACH,KAAK,oBAAsB,KAAK,wBACnC,CAED,OAAQ,CAEJ,MAAMN,EADgB,KAAK,QAAQ,cACI,KAAK,oBAEtC,CAAC,cAAAG,EAAe,eAAAC,CAAc,EAAI,KAAK,YAAYJ,CAAc,EAEjEhxB,EAAQ,KAAK,OAEb8wB,EAAO,KAAK,QAAQ,eAAe,aACzC,IAAIS,EAAW,EACXT,IAAS,WAAa9wB,EAAM,QAAWgxB,EAAiB,IACxDO,EAAWP,EAAiBhxB,EAAM,QAGtC,IAAIwxB,EAAaL,EACjB,QAASr6C,EAAI,EAAGsK,EAAI4e,EAAM,OAAQlpB,EAAIsK,EAAGtK,IAAK,CAC1C,MAAM26C,EAAwBD,EACxBE,EAAU1xB,EAAMlpB,CAAC,EAAE,kBAAiB,EAE1C,IAAI66C,EAA2B3xB,EAAMlpB,CAAC,EAAE,oBAAsBy6C,EAE9DG,EAAQ,uBAAuBC,CAAwB,EACvDD,EAAQ,yBAAyBD,CAAqB,EAEtDC,EAAQ,MAAK,EAETA,EAAQ,wBACR1xB,EAAMlpB,CAAC,EAAE,mBAGb06C,GAAcG,EACdH,GAAcJ,CACjB,CACJ,CAED,IAAI,oBAAqB,CACrB,OAAO,KAAK,mBACf,CAED,wBAAyB,CACrB,MAAMpxB,EAAQ,KAAK,OACnB,IAAI4xB,EAAQ,EACZ,QAAS,EAAI,EAAGxwC,EAAI4e,EAAM,OAAQ,EAAI5e,EAAG,IAAK,CAC1C,MAAM8a,EAAO8D,EAAM,CAAC,EACpB4xB,GAAS11B,EAAK,mBACjB,CACD,OAAO01B,CACV,CAED,YAAYZ,EAAgB,CACxB,MAAMF,EAAO,KAAK,QAAQ,eAAe,aACnCC,EAAgB,KAAK,OAAO,OAClC,OAAOF,GAAkB,WAAWC,EAAMC,EAAeC,CAAc,CAC1E,CAEL,CCxEe,MAAMa,CAAU,CAE3B,OAAO,6BAA6BhvC,EAAMivC,EAAY,CAElD,MAAMhkC,EADSjL,EAAK,OACE,YACtB,GAAKiL,EAEE,CACH,MAAMikC,EAAalvC,EAAK,WACxB,OAAIkvC,EAEO,KAAK,kBAAkBA,EAAYD,CAAU,EAAI,KAAK,gBAAgBC,EAAYD,CAAU,EAG5FA,EAAahkC,EAAO,EAAIA,EAAO,CAE7C,KAVG,OAAO,EAWd,CAED,OAAO,eAAejL,EAAMivC,EAAY,CACpC,OAAIA,EACIjvC,EAAK,MACD,KAAK,0BAA0BA,EAAM,EAAI,EAClCA,EAAK,MAAM,KAAK,6BAA6BA,EAAM,EAAI,CAAC,EAExD,EAGJA,EAAK,cAGZA,EAAK,MACD,KAAK,0BAA0BA,EAAM,EAAK,EACnCA,EAAK,MAAM,KAAK,6BAA6BA,EAAM,EAAK,CAAC,EAEzD,EAGJA,EAAK,cAGvB,CAED,OAAO,0BAA0BA,EAAMivC,EAAY,CAC/C,MAAMC,EAAalvC,EAAK,WACxB,MAAI,EAAAkvC,GAAcA,EAAW,MAAM,QAAQ,oBAAoBD,CAAU,EAK5E,CAED,OAAO,eAAejvC,EAAMivC,EAAY,CACpC,OAAIA,EACO,CAACjvC,EAAK,eAAiB,CAACA,EAAK,MAE7B,CAACA,EAAK,gBAAkB,CAACA,EAAK,KAE5C,CAED,OAAO,iBAAiBA,EAAMivC,EAAY,CACtC,OAAOA,EAAajvC,EAAK,EAAIA,EAAK,CACrC,CAED,OAAO,kBAAkBA,EAAMivC,EAAY,CACvC,OAAOA,EAAajvC,EAAK,EAAIA,EAAK,CACrC,CAED,OAAO,iBAAiBA,EAAMivC,EAAY77C,EAAK,CACvC67C,EACAjvC,EAAK,EAAI5M,EAET4M,EAAK,EAAI5M,CAEhB,CAED,OAAO,kBAAkB4M,EAAMivC,EAAY37B,EAAM,CACzC27B,EACAjvC,EAAK,EAAIsT,EAETtT,EAAK,EAAIsT,CAEhB,CAED,OAAO,eAAetT,EAAMivC,EAAY,CACpC,IAAIE,EAAU,KAAK,oBAAoBnvC,EAAMivC,CAAU,EAEnDG,EAAkB,EACtB,OAAIpvC,EAAK,sBACLovC,EAAkBpvC,EAAK,UAAU,mBAAmBivC,CAAU,GAGvCG,EAAkB,IAEzCD,EAAU,KAAK,IAAIA,EAASC,CAAe,GAExCD,CACV,CAED,OAAO,oBAAoBnvC,EAAMivC,EAAY,CACzC,OAAIjvC,EAAK,gBACEA,EAAK,MAAM,QAAQ,eAAeivC,CAAU,EAE7BjvC,EAAK,SAAS,SAAW,EAEpC,EAEA,KAAK,eAAeA,EAAMivC,CAAU,CAGtD,CAED,OAAO,WAAWjvC,EAAMivC,EAAY37B,EAAM,CAClCtT,EAAK,gBACeA,EAAK,MAAM,cAAgBivC,EAE3CjvC,EAAK,MAAM,QAAQ,eAAesT,CAAI,EAEtCtT,EAAK,MAAM,QAAQ,gBAAgBsT,CAAI,EAG3C,KAAK,kBAAkBtT,EAAMivC,EAAY37B,CAAI,CAEpD,CAGD,OAAO,iBAAiBtT,EAAMivC,EAAY,CACtC,GAAIjvC,EAAK,gBAAiB,CACtB,MAAMqvC,EAAOrvC,EAAK,MAClB,OAAIivC,EACOI,EAAK,YAELA,EAAK,UAE5B,KACY,OAAO,EAEd,CAED,OAAO,gBAAgBrvC,EAAMivC,EAAY,CACrC,GAAIjvC,EAAK,gBAAiB,CACtB,MAAMqvC,EAAOrvC,EAAK,MAClB,OAAIivC,EACOI,EAAK,aAAeA,EAAK,YAEzBA,EAAK,WAAaA,EAAK,aAE9C,KACY,OAAO,EAEd,CAED,OAAO,gBAAgBrvC,EAAMivC,EAAY,CACrC,MAAMK,EAAWtvC,EAAK,SACtB,OAAIsvC,EACIL,EACOK,EAAS,WAETA,EAAS,UAGb,CAEd,CAED,OAAO,eAAetvC,EAAMivC,EAAY,CACpC,MAAMK,EAAWtvC,EAAK,SACtB,OAAIsvC,EACIL,EACOK,EAAS,YAAcA,EAAS,WAEhCA,EAAS,UAAYA,EAAS,aAGlC,CAEd,CAEL,CClLe,MAAMC,EAAa,CAE9B,YAAYl2B,EAAM,CACd,KAAK,MAAQA,EACb,KAAK,iBAAmB,EACxB,KAAK,YAAc,CACtB,CAED,OAAOrH,EAAQ,CACX,KAAK,YAAc,EAEnB,KAAK,iBAAmBA,EACxB,IAAIw9B,EAAoB,KAAK,wBAC7B,GAAIA,EAAmB,CACnB,MAAMxwC,EAAQ,KAAK,MAAM,MACzB,EAAG,CACC,IAAIywC,EAAkB,KAAK,iBAAmBD,EAC9C,QAASv7C,EAAI,KAAK,MAAM,WAAYA,GAAK,KAAK,MAAM,SAAUA,IAAK,CAE/D,MAAMq7C,EADOtwC,EAAM/K,CAAC,EACE,SAChBy7C,EAAeJ,EAAS,OAE9B,GAD0BI,EAAe,EACnB,CAClB,IAAIC,EAASD,EAAeD,EAC5B,MAAMN,EAAUG,EAAS,sBACnBh8B,EAAOg8B,EAAS,yBACtB,GAAIh8B,EAAO67B,EAAS,CAChB,MAAMS,EAAYt8B,EAAO67B,EACFQ,GAAUC,IAE7BD,EAASC,EAGTJ,GAAqBE,GAGzB,MAAMG,EAAYv8B,EAAOq8B,EAMzB,GALAL,EAAS,gBAAgBO,CAAS,EAElC,KAAK,aAAeF,EACpB,KAAK,kBAAoBA,EAErB,KAAK,IAAI,KAAK,gBAAgB,EAAI,KAClC,MAEP,CACJ,CACJ,CACjB,OAAoBH,GAAsB,KAAK,IAAI,KAAK,gBAAgB,EAAI,KACnE,CACJ,CAED,uBAAwB,CACpB,IAAIT,EAAQ,EACZ,MAAM/vC,EAAQ,KAAK,MAAM,MACzB,QAAS,EAAI,KAAK,MAAM,WAAY,GAAK,KAAK,MAAM,SAAU,IAAK,CAE/D,MAAMswC,EADOtwC,EAAM,CAAC,EACE,SAEtB,GAAIswC,EAAS,OAAQ,CACjB,MAAMH,EAAUG,EAAS,sBACZA,EAAS,yBAGXH,IACPJ,GAASO,EAAS,OAEzB,CACJ,CACD,OAAOP,CACV,CAED,eAAgB,CACZ,OAAO,KAAK,WACf,CAEL,CC5Ee,MAAMe,EAAW,CAE5B,YAAYz2B,EAAM,CACd,KAAK,MAAQA,EACb,KAAK,iBAAmB,EACxB,KAAK,WAAa,CACrB,CAED,KAAKrH,EAAQ,CACT,KAAK,WAAa,EAElB,KAAK,iBAAmBA,EACxB,IAAI+9B,EAAkB,KAAK,sBAC3B,GAAIA,EAAiB,CACjB,MAAM/wC,EAAQ,KAAK,MAAM,MACzB,EAAG,CACC,IAAIgxC,EAAgB,KAAK,iBAAmBD,EAC5C,QAAS97C,EAAI,KAAK,MAAM,WAAYA,GAAK,KAAK,MAAM,SAAUA,IAAK,CAE/D,MAAMq7C,EADOtwC,EAAM/K,CAAC,EACE,SAChBg8C,EAAaX,EAAS,KAE5B,GADwBW,EAAa,EACjB,CAChB,IAAIC,EAAOD,EAAaD,EACxB,MAAMG,EAAUb,EAAS,6BACnBh8B,EAAOg8B,EAAS,yBACtB,GAAIa,EAAU,EACV,GAAI78B,GAAQ68B,EAERD,EAAO,MACJ,CACH,MAAME,EAAUD,EAAU78B,EACJ48B,GAAQE,IAE1BF,EAAOE,EAGPL,GAAmBE,EAE1B,CAGL,GAAIC,EAAO,EAAG,CACV,MAAML,EAAYv8B,EAAO48B,EAMzB,GALAZ,EAAS,gBAAgBO,CAAS,EAElC,KAAK,YAAcK,EACnB,KAAK,kBAAoBA,EAErB,KAAK,IAAI,KAAK,gBAAgB,EAAI,KAClC,MAEP,CACJ,CACJ,CACjB,OAAoBH,GAAoB,KAAK,IAAI,KAAK,gBAAgB,EAAI,KACjE,CACJ,CAED,qBAAsB,CAClB,IAAIhB,EAAQ,EACZ,MAAM/vC,EAAQ,KAAK,MAAM,MACzB,QAAS,EAAI,KAAK,MAAM,WAAY,GAAK,KAAK,MAAM,SAAU,IAAK,CAE/D,MAAMswC,EADOtwC,EAAM,CAAC,EACE,SAEtB,GAAIswC,EAAS,KAAM,CACf,MAAMa,EAAUb,EAAS,6BACnBh8B,EAAOg8B,EAAS,0BAGlBa,IAAY,GAAK78B,EAAO68B,KACxBpB,GAASO,EAAS,KAEzB,CACJ,CACD,OAAOP,CACV,CAED,cAAe,CACX,OAAO,KAAK,UACf,CAEL,CCjFe,MAAMsB,EAAe,CAEhC,YAAYC,EAAY,CACpB,KAAK,MAAQA,CAChB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,MAAM,OACrB,CAED,UAAW,CACP,KAAM,CAAC,cAAAhC,EAAe,eAAAC,CAAc,EAAI,KAAK,YAAW,EAExD,IAAII,EAAaL,EAEjB,MAAMtvC,EAAQ,KAAK,MAAM,MACzB,QAAS/K,EAAI,KAAK,MAAM,WAAYA,GAAK,KAAK,MAAM,SAAUA,IAAK,CAC/D,MAAM+L,EAAOhB,EAAM/K,CAAC,EAEpB+L,EAAK,SAAS,sBAAsB2uC,CAAU,EAC9CA,GAAc3uC,EAAK,SAAS,6CAC5B2uC,GAAcJ,CACjB,CACJ,CAED,aAAc,CACV,MAAMJ,EAAiB,KAAK,MAAM,gBAClC,IAAIF,EAAO,KAAK,QAAQ,eAAe,eACvC,MAAMC,EAAgB,KAAK,MAAM,cAEjC,OAAOF,GAAkB,WAAWC,EAAMC,EAAeC,CAAc,CAC1E,CAEL,CCnCe,MAAMoC,EAAY,CAE7B,YAAYl3B,EAAM,CACd,KAAK,MAAQA,EACb,KAAK,qBAAuB,EAC5B,KAAK,uBAAyB,EAC9B,KAAK,mBAAqB,KAC1B,KAAK,wBAA0B,GAC/B,KAAK,0BAA4B,EACpC,CAED,IAAI,SAAU,CACV,OAAO,KAAK,MAAM,OACrB,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,QAAQ,cACvB,CAED,uBAAuB/F,EAAM,CACzB,KAAK,qBAAuBA,CAC/B,CAED,yBAAyByK,EAAQ,CAC7B,KAAK,uBAAyBA,CACjC,CAED,OAAQ,CACJ,KAAK,mBAAqB,KAAK,eAAe,WAE9C,KAAK,0BAA4B,KAAK,QAAQ,oBAAoB,CAAC,KAAK,eAAe,WAAW,EAElG,KAAK,wBAA0B,GAC/B,MAAM/e,EAAQ,KAAK,MAAM,MACzB,QAAS/K,EAAI,KAAK,MAAM,WAAYA,GAAK,KAAK,MAAM,SAAUA,IAAK,CAC/D,MAAM+L,EAAOhB,EAAM/K,CAAC,EACpB,KAAK,WAAW+L,CAAI,CACvB,CACJ,CAED,IAAI,wBAAyB,CACzB,OAAO,KAAK,uBACf,CAED,WAAWA,EAAM,CACb,MAAMsvC,EAAWtvC,EAAK,SACtB,IAAIslB,EAAQgqB,EAAS,WAAa,KAAK,mBAavC,OAXIhqB,IAAU,WAAa,KAAK,gBAAgBgqB,CAAQ,IACpDhqB,EAAQ,cAGRA,IAAU,WAAa,CAAC,KAAK,2BACzBgqB,EAAS,wBAETA,EAAS,0BAAyB,EAInChqB,EAAK,CACR,IAAK,aACD,KAAK,oBAAoBgqB,CAAQ,EACjC,MACJ,IAAK,WACD,KAAK,kBAAkBA,CAAQ,EAC/B,MACJ,IAAK,SACD,KAAK,qBAAqBA,CAAQ,EAClC,MACJ,IAAK,UACD,KAAK,kBAAkBA,CAAQ,EAC/B,KACP,CACJ,CAED,oBAAoBA,EAAU,CAC1BA,EAAS,uBAAuB,KAAK,sBAAsB,CAC9D,CAED,kBAAkBA,EAAU,CACxB,MAAMkB,EAAoBlB,EAAS,8CACnCA,EAAS,uBAAuB,KAAK,wBAA0B,KAAK,qBAAuBkB,EAAkB,CAChH,CAED,qBAAqBlB,EAAU,CAC3B,MAAMkB,EAAoBlB,EAAS,8CAC7BmB,GAAU,KAAK,qBAAuBD,GAAqB,EACjElB,EAAS,uBAAuB,KAAK,uBAAyBmB,CAAM,CACvE,CAED,kBAAkBnB,EAAU,CACxBA,EAAS,uBAAuB,KAAK,sBAAsB,EAE3D,MAAMoB,EAAiCpB,EAAS,yBAChD,IAAIh8B,EAAO,KAAK,qBAAuBg8B,EAAS,sBAAwBA,EAAS,uBAEjF,MAAMqB,EAA0BrB,EAAS,8BACrCqB,EAA0B,IAC1Br9B,EAAO,KAAK,IAAIA,EAAMq9B,CAAuB,GAGjD,MAAMC,EAA0BtB,EAAS,8BACDsB,EAA0B,IAE9Dt9B,EAAO,KAAK,IAAIA,EAAMs9B,CAAuB,GAGjDtB,EAAS,iBAAiBh8B,CAAI,EACQg8B,EAAS,2BAEYoB,IASvD,KAAK,wBAA0B,GAEtC,CAED,gBAAgBpB,EAAU,CACtB,MAAMuB,EAAwBvB,EAAS,yBACjCwB,EAAgBxB,EAAS,YAAc,UAC7C,OAAOuB,GAAyB,CAACC,CACpC,CAEL,CC5He,MAAMC,EAAW,CAE5B,YAAYtC,EAAQuC,EAAYC,EAAUC,EAAgB,CACtD,KAAK,QAAUzC,EACf,KAAK,MAAQA,EAAO,MACpB,KAAK,WAAauC,EAClB,KAAK,SAAWC,EAChB,KAAK,gBAAkBC,CAC1B,CAED,eAAgB,CACZ,KAAK,cAAa,EAClB,KAAK,iBAAgB,EACrB,KAAK,gBAAe,CACvB,CAED,eAAgB,CACR,KAAK,gBAAkB,EACvB,KAAK,eAAe,KAAK,eAAe,EACjC,KAAK,gBAAkB,GAC9B,KAAK,iBAAiB,CAAC,KAAK,eAAe,CAElD,CAED,eAAel/B,EAAQ,CACnB,MAAMm/B,EAAS,IAAIrB,GAAW,IAAI,EAClCqB,EAAO,KAAKn/B,CAAM,EAClB,KAAK,iBAAmBm/B,EAAO,cAClC,CAED,iBAAiBn/B,EAAQ,CACrB,MAAMo/B,EAAW,IAAI7B,GAAa,IAAI,EACtC6B,EAAS,OAAOp/B,CAAM,EACtB,KAAK,iBAAmBo/B,EAAS,eACpC,CAED,kBAAmB,CACI,IAAIf,GAAe,IAAI,EAC/B,SAAQ,CACtB,CAED,mBAAoB,CAChB,OAAO,IAAIE,GAAY,IAAI,CAC9B,CAED,iBAAkB,CACd,KAAK,4BAA2B,CACnC,CAED,oBAAqB,CACjB,IAAIc,EAAkB,EACtB,QAASp9C,EAAI,KAAK,WAAYA,GAAK,KAAK,SAAUA,IAAK,CACnD,MAAM+L,EAAO,KAAK,MAAM/L,CAAC,EACzBo9C,GAAmBrxC,EAAK,SAAS,yCACpC,CACD,OAAOqxC,CACV,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,SAAW,KAAK,WAAa,CAC5C,CAED,IAAI,qBAAsB,CACtB,MAAMC,EAA4B,KAAK,QAAQ,yBAA0B,GAAI,CAAC,KAAK,QAAQ,kBAE3F,OAD6B,KAAK,QAAQ,WAAY,GAAIA,EAE/C,KAAK,wBAEL,KAAK,QAAQ,aAE3B,CAED,6BAA8B,CAC1B,KAAK,wBAA0B,KAAK,4BACvC,CAED,4BAA6B,CACzB,IAAIC,EAAmB,EACvB,QAASt9C,EAAI,KAAK,WAAYA,GAAK,KAAK,SAAUA,IAAK,CACnD,MAAM+L,EAAO,KAAK,MAAM/L,CAAC,EACzBs9C,EAAmB,KAAK,IAAIA,EAAkBvxC,EAAK,SAAS,4CAA2C,CAAE,CAC5G,CACD,OAAOuxC,CACV,CAGL,CCtFe,MAAMC,EAAa,CAE9B,YAAY/C,EAAQ,CAChB,KAAK,QAAUA,EACf,KAAK,iBAAmB,GACxB,KAAK,kBAAoB,GACzB,KAAK,qBAAuB,CAC/B,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,iBAAkB,CAClB,OAAI,KAAK,mBAAqB,KAC1B,KAAK,iBAAmB,KAAK,uBAE1B,KAAK,gBACf,CAED,IAAI,kBAAmB,CACnB,OAAI,KAAK,oBAAsB,KAC3B,KAAK,kBAAoB,KAAK,wBAE3B,KAAK,iBACf,CAED,IAAI,qBAAsB,CACtB,OAAO,KAAK,oBACf,CAED,aAAc,CACV,KAAK,OAAM,EACX,MAAMzvC,EAAQ,KAAK,QAAQ,MACrBi1B,EAAO,KAAK,QAAQ,WAAU,EAEpC,IAAI+c,EAAa,EACb/8C,EACJ,MAAMsK,EAAIS,EAAM,OAChB,IAAK/K,EAAI,EAAGA,EAAIsK,EAAGtK,IAAK,CACpB,MAAM+L,EAAOhB,EAAM/K,CAAC,EAEpB,KAAK,gBAAgB+L,CAAI,EAGzB,MAAMyxC,EAAmBzxC,EAAK,SAAS,2CAA0C,EAE7Ei0B,GAAShgC,EAAI+8C,GACU,KAAK,gBAAkBS,EAAmB,KAAK,gBAElE,KAAK,YAAYT,EAAY/8C,EAAI,CAAC,EAClC,KAAK,gBAAkB,EACvB+8C,EAAa/8C,GAIrB,KAAK,kBAAkBw9C,CAAgB,CAC1C,CAEGT,EAAa/8C,GACb,KAAK,YAAY+8C,EAAY/8C,EAAI,CAAC,CAEzC,CAED,gBAAgB+L,EAAM,CACdA,EAAK,gBACLA,EAAK,WAAW,mBAEhBA,EAAK,SAAS,kBAErB,CAED,QAAS,CACL,KAAK,cAAgB,KAAK,QAAQ,aAClC,KAAK,gBAAkB,EACvB,KAAK,gBAAkB,EACvB,KAAK,OAAS,GAEd,KAAK,iBAAmB,GACxB,KAAK,kBAAoB,GACzB,KAAK,qBAAuB,CAC/B,CAED,kBAAkByxC,EAAkB,CAChC,KAAK,iBAAmBA,EACpB,KAAK,gBAAkB,KAAK,kBAC5B,KAAK,gBAAkB,KAAK,gBAEnC,CAED,YAAYT,EAAYC,EAAU,CAC9B,MAAMC,EAAiB,KAAK,mCACtB73B,EAAO,IAAI03B,GAAW,KAAK,QAASC,EAAYC,EAAUC,CAAc,EAC9E73B,EAAK,cAAa,EAClB,KAAK,OAAO,KAAKA,CAAI,GAEjB,KAAK,uBAAyB,GAAM,KAAK,gBAAkB,KAAK,wBAChE,KAAK,qBAAuB,KAAK,gBAExC,CAED,kCAAmC,CAC/B,MAAI,CAAC,KAAK,QAAQ,kBAAoB,KAAK,QAAQ,0BACxC,EAEA,KAAK,cAAgB,KAAK,eAExC,CAED,sBAAuB,CACnB,IAAIq4B,EAAmB,EACvB,MAAM1yC,EAAQ,KAAK,QAAQ,MAC3B,QAAS,EAAI,EAAGT,EAAIS,EAAM,OAAQ,EAAIT,EAAG,IAAK,CAE1C,MAAMozC,EADO3yC,EAAM,CAAC,EACc,SAAS,yCAAwC,EACnF0yC,EAAmB,KAAK,IAAIA,EAAkBC,CAAoB,CACrE,CACD,OAAOD,CACV,CAED,qBAAsB,CAClB,OAAI,KAAK,OAAO,SAAW,EAChB,KAAK,OAAO,CAAC,EAAE,mBAAkB,EAGjC,KAAK,QAAQ,YAE3B,CAEL,CCpIe,MAAME,EAAuB,CAExC,YAAYnD,EAAQ,CAChB,KAAK,QAAUA,EACf,KAAK,WAAa,KAAK,eAAe,SACtC,KAAK,yBAA2B,KAAK,QAAQ,4BAA2B,EACxE,KAAK,uBAAyB,KAAK,QAAQ,0BAAyB,CACvE,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,QAAQ,cACvB,CAED,UAAW,CACP,MAAMoD,EAAa,KAAK,QAAQ,uBAAsB,EAClDA,EAEgB,IAAID,GAAuBC,EAAW,OAAO,EACrD,yBAAyB,KAAK,eAAe,IAAI,GAEzD,KAAK,cAAa,EAClB,KAAK,eAAc,EAE1B,CAED,eAAgB,CACZ,MAAM7xC,EAAO,KAAK,eAAe,KACjC,IAAIgK,EAAIglC,EAAU,iBAAiBhvC,EAAM,EAAI,EACzCiK,EAAI+kC,EAAU,iBAAiBhvC,EAAM,EAAK,EAC1Cwc,EAAIwyB,EAAU,kBAAkBhvC,EAAM,EAAI,EAC1Cyc,EAAIuyB,EAAU,kBAAkBhvC,EAAM,EAAK,EAE/Cwc,GAAK,KAAK,QAAQ,wBAClBC,GAAK,KAAK,QAAQ,sBAElBzc,EAAK,gBAAe,EAEpBA,EAAK,UAAUgK,EAAGC,EAAGuS,EAAGC,CAAC,CAC5B,CAED,gBAAiB,CACb,MAAMzd,EAAQ,KAAK,QAAQ,MAC3B,QAAS/K,EAAI,EAAGsK,EAAIS,EAAM,OAAQ/K,EAAIsK,EAAGtK,IAAK,CAC1C,MAAM+L,EAAOhB,EAAM/K,CAAC,EACd69C,EAAa,KAAK,mBAAmB9xC,CAAI,EAG/C,KAAK,cAAcA,CAAI,EAElB8xC,GACD,KAAK,sBAAsB9xC,CAAI,CAEtC,CACJ,CAED,mBAAmBA,EAAM,CACrB,GAAIA,EAAK,SAAW,GACZA,EAAK,gBAAiB,CACtB,MAAMyuC,EAASzuC,EAAK,MAAM,QAG1B,GADuCA,EAAK,IAAMA,EAAK,OAAO,GAAKA,EAAK,IAAMA,EAAK,OAAO,EAGtF,MAAO,GACJ,CACH,MAAM+xC,EAAgBtD,EAAO,cAC7BA,EAAO,sBAAsBA,EAAO,YAAY,EAChDA,EAAO,uBAAuBsD,CAAa,CAC9C,CACJ,CAEL,MAAO,EACV,CAED,yBAAyB/xC,EAAM,CAC3B,KAAK,cAAcA,CAAI,EACvB,KAAK,sBAAsBA,CAAI,CAClC,CAED,cAAcA,EAAM,CACZ,KAAK,YACL,KAAK,0BAA0BA,CAAI,EAGvC,IAAIgK,EAAIglC,EAAU,iBAAiBhvC,EAAM,EAAI,EACzCiK,EAAI+kC,EAAU,iBAAiBhvC,EAAM,EAAK,EAC1Cwc,EAAIwyB,EAAU,kBAAkBhvC,EAAM,EAAI,EAC1Cyc,EAAIuyB,EAAU,kBAAkBhvC,EAAM,EAAK,EAE/CgK,GAAK,KAAK,yBACVC,GAAK,KAAK,uBAEGjK,EAAK,OAEdwc,GAAKxc,EAAK,MAAM,QAAQ,sBAAqB,EAC7Cyc,GAAKzc,EAAK,MAAM,QAAQ,oBAAmB,GAG/C,MAAMsvC,EAAWtvC,EAAK,SAClBsvC,IACAtlC,GAAKslC,EAAS,6BACdrlC,GAAKqlC,EAAS,4BAGlBtvC,EAAK,gBAAe,EACpBA,EAAK,UAAUgK,EAAGC,EAAGuS,EAAGC,CAAC,CAC5B,CAED,sBAAsBzc,EAAM,CACxB,MAAMqvC,EAAOrvC,EAAK,MACdqvC,GACgB,IAAIuC,GAAuBvC,EAAK,OAAO,EAC/C,eAAc,CAE7B,CAED,0BAA0BrvC,EAAM,CAC5B,MAAMgyC,EAAUhyC,EAAK,SAAS,sBAAuB,EAAGA,EAAK,SAAS,2CAA0C,EAC1GiyC,EAAc,KAAK,QAAQ,aAAeD,EAChDhyC,EAAK,SAAS,sBAAsBiyC,CAAW,CAClD,CAEL,CCpHe,MAAMC,EAAW,CAE5B,YAAYC,EAAe,CACvB,KAAK,eAAiBA,EAEtB,KAAK,cAAgB,IAAIX,GAAa,IAAI,EAE1C,KAAK,kBAAoB,GACzB,KAAK,mBAAqB,GAE1B,KAAK,+BAAiC,EACtC,KAAK,gCAAkC,EAEvC,KAAK,QAAU,EAClB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,QAAS,CACT,OAAO,KAAK,KAAK,MACpB,CAED,YAAa,CACU,KAAK,KAAK,aAAe,KAGxC,KAAK,qBAAoB,EAEzB,KAAK,iBAAgB,EAEzB,KAAK,iBAAgB,CACxB,CAED,kBAAmB,CACX,KAAK,OACL,KAAK,yBAAwB,EAE7B,KAAK,kCAAiC,CAE7C,CAED,0BAA2B,CACvB,KAAK,qBAAoB,EACzB,KAAK,YAAW,EAChB,KAAK,oBAAmB,CAC3B,CAED,qBAAsB,CAClB,KAAK,+BAAiC,KAAK,aAC3C,KAAK,gCAAkC,KAAK,aAC/C,CAED,mCAAoC,CACF,KAAK,KAAK,OAAS,KAAK,KAAK,OAGvD,KAAK,KAAK,wBACV,KAAK,yBAAwB,IAE7B,KAAK,aAAe,KAAK,+BACzB,KAAK,cAAgB,KAAK,gCAEjC,CAED,kBAAmB,CACC,IAAII,GAAuB,IAAI,EACvC,SAAQ,CACnB,CAED,sBAAuB,CAGnB,MAAMG,EAAgB,KAAK,cAC3B,KAAK,gBAAe,EACpB,KAAK,uBAAuBA,CAAa,CAC5C,CAED,sBAAuB,CACf,KAAK,KAAK,oBACV,KAAK,KAAK,SAAS,oBAEnB,KAAK,aAAe,KAAK,oBACzB,KAAK,cAAgB,KAAK,sBAE9B,KAAK,kBAAoB,GACzB,KAAK,mBAAqB,GAC1B,KAAK,QAAU,EAClB,CAED,aAAc,CACV,KAAK,gBAAe,EACpB,KAAK,iBAAgB,CACxB,CAKD,iBAAkB,CACd,KAAK,aAAY,EACjB,KAAK,2BAA0B,CAClC,CAED,cAAe,CACX,KAAK,cAAc,aACtB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,cAAc,KAC7B,CAED,4BAA6B,CACpB,KAAK,mBACF,KAAK,4BACL,KAAK,aAAe,KAAK,cAAc,oBAGlD,CAKD,kBAAmB,CACf,MAAMlD,EAAU,IAAIL,GAAe,IAAI,EACvCK,EAAQ,KAAI,EACZ,KAAK,oBAAsBA,EAAQ,mBACnC,KAAK,4BAA2B,EAChCA,EAAQ,MAAK,CAChB,CAED,6BAA8B,CACrB,KAAK,oBACF,KAAK,6BACL,KAAK,cAAgB,KAAK,oBAGrC,CAED,YAAa,CACT,OAAO,KAAK,eAAe,IAC9B,CAED,oBAAoBI,EAAY,CAC5B,OAAI,KAAK,cAAgBA,EACd,KAAK,0BAEL,KAAK,0BAEnB,CAED,yBAA0B,CACtB,MAAO,CAAC,KAAK,WAAU,GAAM,CAAC,KAAK,uBAAsB,CAC5D,CAED,0BAA2B,CACvB,MAAO,CAAC,KAAK,yBAChB,CAED,wBAAyB,CACrB,MAAO,CAACD,EAAU,eAAe,KAAK,KAAM,KAAK,WAAW,CAC/D,CAED,yBAA0B,CACtB,MAAO,CAACA,EAAU,eAAe,KAAK,KAAM,CAAC,KAAK,WAAW,CAChE,CAED,eAAeC,EAAY,CACvB,OAAI,KAAK,cAAgBA,EACd,KAAK,sBAEL,KAAK,sBAEnB,CAED,qBAAsB,CAClB,OAAO,KAAK,cAAc,eAC7B,CAED,sBAAuB,CACnB,OAAO,KAAK,cAAc,gBAC7B,CAED,eAAe37B,EAAM,CACb,KAAK,eAAiBA,IAClB,KAAK,OAAS,EACd,KAAK,sBAAsBA,CAAI,EAE3B,KAAK,kCACL,KAAK,aAAeA,EACpB,KAAK,4BAA2B,IAGhC,KAAK,KAAK,wBACV,KAAK,sBAAsBA,CAAI,GAI9C,CAED,+BAA+BA,EAAM,CAMjC,OAL6BA,IAAS,KAAK,oBAIhB,CAAC,KAAK,0BAOpC,CAED,sBAAsBA,EAAM,CACxB,MAAM8+B,EAAe9+B,EAAO,KAAK,aACjC,KAAK,QAAU8+B,EAEf,KAAK,aAAe9+B,EAEpB,KAAK,kBAAoB,GACzB,KAAK,YAAW,EAChB,KAAK,kBAAoB,EAC5B,CAED,gBAAgBA,EAAM,CACd,KAAK,gBAAkBA,IACnB,KAAK,OAAS,EACd,KAAK,uBAAuBA,CAAI,EAEhC,KAAK,cAAgBA,EAGhC,CAED,uBAAuBA,EAAM,CACzB,KAAK,cAAgBA,EAErB,KAAK,mBAAqB,GAC1B,KAAK,iBAAgB,EACrB,KAAK,mBAAqB,EAC7B,CAED,IAAI,oBAAqB,CACrB,OAAO,KAAK,YAAc,KAAK,KAAK,OAAO,EAAI,KAAK,KAAK,OAAO,CACnE,CAED,IAAI,qBAAsB,CACtB,OAAO,KAAK,YAAc,KAAK,KAAK,OAAO,EAAI,KAAK,KAAK,OAAO,CACnE,CAED,wBAAyB,CACrB,OAAO,KAAK,KAAK,kBAAmB,EAAG,KAAK,KAAK,SAAS,IAAM,IACnE,CAED,uBAAwB,CACpB,OAAO07B,EAAU,gBAAgB,KAAK,KAAM,EAAI,CACnD,CAED,qBAAsB,CAClB,OAAOA,EAAU,gBAAgB,KAAK,KAAM,EAAK,CACpD,CAED,6BAA8B,CAC1B,OAAOA,EAAU,iBAAiB,KAAK,KAAM,EAAI,CACpD,CAED,2BAA4B,CACxB,OAAOA,EAAU,iBAAiB,KAAK,KAAM,EAAK,CACrD,CAED,mBAAoB,CAChB,OAAOA,EAAU,eAAe,KAAK,KAAM,KAAK,WAAW,CAC9D,CAED,oBAAqB,CACjB,OAAOA,EAAU,eAAe,KAAK,KAAM,CAAC,KAAK,WAAW,CAC/D,CAED,IAAI,aAAc,CACd,OAAO,KAAK,eAAe,WAC9B,CAED,IAAI,UAAW,CACX,OAAO,KAAK,eAAe,QAC9B,CAED,IAAI,MAAO,CACP,OAAO,KAAK,eAAe,IAC9B,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,KAAK,KACpB,CAED,IAAI,kBAAmB,CACnB,OAAO,KAAK,iBACf,CAED,IAAI,mBAAoB,CACpB,OAAO,KAAK,kBACf,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,MAAM,MACrB,CAED,IAAI,cAAe,CACf,OAAOA,EAAU,kBAAkB,KAAK,KAAM,KAAK,WAAW,CACjE,CAED,IAAI,eAAgB,CAChB,OAAOA,EAAU,kBAAkB,KAAK,KAAM,CAAC,KAAK,WAAW,CAClE,CAED,IAAI,aAAa31C,EAAG,CAChB21C,EAAU,kBAAkB,KAAK,KAAM,KAAK,YAAa31C,CAAC,CAC7D,CAED,IAAI,cAAcA,EAAG,CACjB21C,EAAU,kBAAkB,KAAK,KAAM,CAAC,KAAK,YAAa31C,CAAC,CAC9D,CAEL,CCxUe,MAAMg5C,EAAc,CAG/B,YAAYryC,EAAM,CACd,KAAK,MAAQA,EAEb,KAAK,QAAU,IAAIsyC,GAAO,IAAI,EAC9B,KAAK,YAAc,GACnB,KAAK,SAAW,GAChB,KAAK,MAAQ,GACb,KAAK,YAAc,UACnB,KAAK,gBAAkB,aACvB,KAAK,cAAgB,aAErB,KAAK,aAAe,EACpB,KAAK,YAAc,EACnB,KAAK,cAAgB,EACrB,KAAK,eAAiB,CACzB,CAED,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,oBAAqB,CACjB,KAAK,MAAM,mBACd,CAED,kBAAmB,CACf,KAAK,MAAM,iBACd,CAED,IAAI,WAAY,CACZ,OAAQ,KAAK,YAAc,MAAQ,WAAa,KAAK,SAAW,WAAa,GAChF,CAED,IAAI,UAAUC,EAAG,CACT,KAAK,YAAcA,IAEvB,KAAK,YAAeA,IAAM,OAASA,IAAM,cACzC,KAAK,SAAYA,IAAM,eAAiBA,IAAM,iBAE9C,KAAK,iBAAgB,EACxB,CAED,IAAI,KAAKl5C,EAAG,CACR,KAAK,MAAQA,EACb,KAAK,iBAAgB,CACxB,CAED,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,WAAWA,EAAG,CACd,GAAI,KAAK,cAAgBA,EACzB,IAAIg5C,GAAc,YAAY,QAAQh5C,CAAC,IAAM,GACzC,MAAM,IAAI,MAAM,gCAAkCg5C,GAAc,YAAY,KAAK,GAAG,CAAC,EAEzF,KAAK,YAAch5C,EAEnB,KAAK,iBAAgB,EACxB,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,IAAI,aAAaA,EAAG,CAChB,GAAI,KAAK,gBAAkBA,EAC3B,IAAIg5C,GAAc,cAAc,QAAQh5C,CAAC,IAAM,GAC3C,MAAM,IAAI,MAAM,kCAAoCg5C,GAAc,cAAc,KAAK,GAAG,CAAC,EAE7F,KAAK,cAAgBh5C,EAErB,KAAK,iBAAgB,EACxB,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,eACf,CAED,IAAI,eAAeA,EAAG,CAClB,GAAI,KAAK,kBAAoBA,EAE7B,IAAIg5C,GAAc,gBAAgB,QAAQh5C,CAAC,IAAM,GAC7C,MAAM,IAAI,MAAM,oCAAsCg5C,GAAc,gBAAgB,KAAK,GAAG,CAAC,EAEjG,KAAK,gBAAkBh5C,EAEvB,KAAK,iBAAgB,EACxB,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,YAAcA,EACnB,KAAK,WAAaA,EAClB,KAAK,aAAeA,EACpB,KAAK,cAAgBA,CACxB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,WACf,CAED,IAAI,YAAYA,EAAG,CACf,KAAK,aAAeA,EACpB,KAAK,mBAAkB,CAC1B,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,WAAWA,EAAG,CACd,KAAK,YAAcA,EACnB,KAAK,mBAAkB,CAC1B,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,aAAaA,EAAG,CAChB,KAAK,cAAgBA,EACrB,KAAK,mBAAkB,CAC1B,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,IAAI,cAAcA,EAAG,CACjB,KAAK,eAAiBA,EACtB,KAAK,mBAAkB,CAC1B,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,MAAMoK,EAAU,CACZoqC,GAAK,YAAY,KAAMpqC,CAAQ,CAClC,CAEL,CAEA4uC,GAAc,YAAc,CAAC,aAAc,WAAY,SAAU,SAAS,EAC1EA,GAAc,cAAgB,CAAC,aAAc,WAAY,SAAU,gBAAiB,eAAgB,eAAgB,SAAS,EAC7HA,GAAc,gBAAkB,CAAC,aAAc,WAAY,SAAU,gBAAiB,eAAgB,cAAc,ECvJrG,MAAMG,EAAS,CAE1B,YAAYxyC,EAAM,CACd,KAAK,KAAO,KACZ,KAAK,MAAQA,EACb,KAAK,MAAQ,EACb,KAAK,QAAUwyC,GAAS,YACxB,KAAK,WAAa,OAClB,KAAK,UAAY,EACjB,KAAK,WAAa,EAClB,KAAK,UAAY,EACjB,KAAK,WAAa,EAElB,KAAK,YAAc,EACnB,KAAK,WAAa,EAClB,KAAK,aAAe,EACpB,KAAK,cAAgB,CACxB,CAED,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,IAAI,KAAKn5C,EAAG,CACJ,KAAK,QAAUA,IAEnB,KAAK,MAAQ,SAASA,CAAC,GAAK,EAE5B,KAAK,SAAQ,EAChB,CAED,IAAI,QAAS,CACT,OAAI,KAAK,UAAYm5C,GAAS,YACnB,KAAK,oBAET,KAAK,OACf,CAED,mBAAoB,CAChB,OAAI,KAAK,KAAK,gBACH,EAGA,CAEd,CAED,IAAI,OAAOn5C,EAAG,CACN,KAAK,UAAYA,IAErB,KAAK,QAAU,SAASA,CAAC,GAAK,EAE9B,KAAK,SAAQ,EAChB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACb,GAAI,KAAK,aAAeA,EAExB,IAAIA,IAAM,OACN,KAAK,WAAa,WACf,CACH,GAAIg5C,GAAc,YAAY,QAAQh5C,CAAC,IAAM,GACzC,MAAM,IAAI,MAAM,+BAAiCg5C,GAAc,YAAY,KAAK,GAAG,CAAC,EAExF,KAAK,WAAah5C,CACrB,CAED,KAAK,SAAQ,EAChB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAY,KAAK,IAAI,EAAGA,CAAC,EAC9B,KAAK,MAAM,kBAAkB,GAAM,EAAK,CAC3C,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACb,KAAK,WAAa,KAAK,IAAI,EAAGA,CAAC,EAC/B,KAAK,MAAM,kBAAkB,GAAO,EAAI,CAC3C,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAY,KAAK,IAAI,EAAGA,CAAC,EAC9B,KAAK,MAAM,kBAAkB,GAAM,EAAK,CAC3C,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACb,KAAK,WAAa,KAAK,IAAI,EAAGA,CAAC,EAC/B,KAAK,MAAM,kBAAkB,GAAO,EAAI,CAC3C,CAMD,IAAI,OAAOA,EAAG,CACV,KAAK,WAAaA,EAClB,KAAK,UAAYA,EACjB,KAAK,YAAcA,EACnB,KAAK,aAAeA,CACvB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,UACf,CAED,IAAI,WAAWA,EAAG,CACd,KAAK,YAAcA,EACnB,KAAK,SAAQ,CAChB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,UAAUA,EAAG,CACb,KAAK,WAAaA,EAClB,KAAK,SAAQ,CAChB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,YAAYA,EAAG,CACf,KAAK,aAAeA,EACpB,KAAK,SAAQ,CAChB,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,aAAaA,EAAG,CAChB,KAAK,cAAgBA,EACrB,KAAK,SAAQ,CAChB,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,UAAW,CACH,KAAK,KAAK,KAAK,IAAI,iBAAgB,CAC1C,CAED,IAAI,IAAIA,EAAG,CACP,KAAK,KAAOA,CACf,CAED,IAAI,KAAM,CACN,OAAO,KAAK,IACf,CAED,MAAMoK,EAAU,CACZoqC,GAAK,YAAY,KAAMpqC,CAAQ,CAClC,CAED,kBAAmB,CACf,KAAK,+BAA8B,EACnC,KAAK,6BAA4B,CACpC,CAED,2BAA4B,CACpB,KAAK,IAAI,YACT,KAAK,6BAA4B,EAEjC,KAAK,+BAA8B,CAE1C,CAED,gCAAiC,CAC7B,IAAI+Y,EAAIwyB,EAAU,eAAe,KAAK,KAAM,EAAI,EAC5C,KAAK,YACLxyB,EAAI,KAAK,IAAI,KAAK,UAAWA,CAAC,GAE9B,KAAK,YACLA,EAAI,KAAK,IAAI,KAAK,UAAWA,CAAC,GAElCwyB,EAAU,kBAAkB,KAAK,KAAM,GAAMxyB,CAAC,CACjD,CAED,8BAA+B,CAC3B,IAAIC,EAAIuyB,EAAU,eAAe,KAAK,KAAM,EAAK,EAC7C,KAAK,aACLvyB,EAAI,KAAK,IAAI,KAAK,WAAYA,CAAC,GAE/B,KAAK,aACLA,EAAI,KAAK,IAAI,KAAK,WAAYA,CAAC,GAEnCuyB,EAAU,kBAAkB,KAAK,KAAM,GAAOvyB,CAAC,CAClD,CAED,6BAA8B,CAC1B,OAAO,KAAK,mBAAmB,CAAC,KAAK,IAAI,WAAW,CACvD,CAED,6BAA8B,CAC1B,OAAO,KAAK,mBAAmB,CAAC,KAAK,IAAI,WAAW,CACvD,CAED,4BAA6B,CACzB,OAAO,KAAK,mBAAmB,KAAK,IAAI,WAAW,CACtD,CAED,mBAAmBwyB,EAAY,CAC3B,OAAIA,EACO,KAAK,UAEL,KAAK,UAEnB,CAED,mBAAmBA,EAAY,CAC3B,OAAIA,EACO,KAAK,UAEL,KAAK,UAEnB,CAED,qBAAsB,CAClB,OAAOD,EAAU,eAAe,KAAK,KAAM,KAAK,IAAI,WAAW,CAClE,CAED,sBAAuB,CACnB,OAAOA,EAAU,eAAe,KAAK,KAAM,CAAC,KAAK,IAAI,WAAW,CACnE,CAED,wBAAyB,CACrB,OAAOA,EAAU,kBAAkB,KAAK,KAAM,KAAK,IAAI,WAAW,CACrE,CAED,uBAAwB,CACpB,OAAOA,EAAU,iBAAiB,KAAK,KAAM,KAAK,IAAI,WAAW,CACpE,CAED,sBAAsB57C,EAAK,CACvB,OAAO47C,EAAU,iBAAiB,KAAK,KAAM,KAAK,IAAI,YAAa57C,CAAG,CACzE,CAED,uBAAuBA,EAAK,CACxB,OAAO47C,EAAU,iBAAiB,KAAK,KAAM,CAAC,KAAK,IAAI,YAAa57C,CAAG,CAC1E,CAED,yBAA0B,CACtB,OAAO47C,EAAU,kBAAkB,KAAK,KAAM,CAAC,KAAK,IAAI,WAAW,CACtE,CAED,iBAAiB17B,EAAM,CACnB,OAAO07B,EAAU,WAAW,KAAK,KAAM,CAAC,KAAK,IAAI,YAAa17B,CAAI,CACrE,CAED,gBAAgBA,EAAM,CAClB,OAAO07B,EAAU,WAAW,KAAK,KAAM,KAAK,IAAI,YAAa17B,CAAI,CACpE,CAED,qBAAsB,CAClB,OAAO07B,EAAU,gBAAgB,KAAK,KAAM,KAAK,IAAI,WAAW,CACnE,CAED,sBAAuB,CACnB,OAAOA,EAAU,gBAAgB,KAAK,KAAM,CAAC,KAAK,IAAI,WAAW,CACpE,CAED,oBAAqB,CACjB,OAAOA,EAAU,eAAe,KAAK,KAAM,KAAK,IAAI,WAAW,CAClE,CAED,qBAAsB,CAClB,OAAOA,EAAU,eAAe,KAAK,KAAM,CAAC,KAAK,IAAI,WAAW,CACnE,CAED,4BAA6B,CACzB,OAAOA,EAAU,gBAAgB,KAAK,KAAM,EAAI,CACnD,CAED,0BAA2B,CACvB,OAAOA,EAAU,gBAAgB,KAAK,KAAM,EAAK,CACpD,CAED,yCAA0C,CACtC,OAAO,KAAK,sBAAwB,KAAK,sBAAwB,KAAK,oBACzE,CAED,0CAA2C,CACvC,OAAO,KAAK,uBAAyB,KAAK,uBAAyB,KAAK,qBAC3E,CAED,4CAA6C,CACzC,OAAO,KAAK,yBAA2B,KAAK,sBAAwB,KAAK,oBAC5E,CAED,6CAA8C,CAC1C,OAAO,KAAK,0BAA4B,KAAK,uBAAyB,KAAK,qBAC9E,CAED,wBAAyB,CACrB,MAAO,CAACA,EAAU,eAAe,KAAK,KAAM,CAAC,KAAK,IAAI,WAAW,CACpE,CAED,sBAAuB,CACnB,MAAO,CAAC,EAAE,KAAK,IAAI,YAAc,KAAK,KAAK,MAAQ,KAAK,KAAK,MAChE,CAEL,CAGAwD,GAAS,YAAc,GCxUR,MAAMC,EAAW,CAE5B,YAAYvxC,EAAQ,CAChB,KAAK,QAAUA,EAQf,KAAK,QAAU,EAEf,KAAK,SAAW,GAEhB,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAET,KAAK,WAAa,EAClB,KAAK,WAAa,EAClB,KAAK,eAAiB,EACtB,KAAK,gBAAkB,EAEvB,KAAK,MAAQ,KACb,KAAK,UAAY,KACjB,KAAK,kBAAoB,GAEzB,KAAK,OAAS,IACjB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,KAAO,KAAK,KAAK,QAAU,IAC1C,CAED,gBAAiB,CACT,KAAK,cAAa,GAAM,KAAK,UAAS,GACtC,KAAK,WAAW,YAEvB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,IAAI,KAAK7H,EAAG,CACHA,GAKI,KAAK,iBACN,KAAK,YAAW,EAEpB,KAAK,MAAM,MAAMA,CAAC,GAPd,KAAK,iBACL,KAAK,aAAY,CAQ5B,CAED,IAAI,UAAW,CACX,OAAI,KAAK,kBACE,IAEX,KAAK,gBAAe,EACb,KAAK,UACf,CAED,IAAI,SAASA,EAAG,CACZ,GAAIA,IAAM,IACN,GAAI,CAAC,KAAK,kBAAmB,CACzB,MAAM4R,EAAS,KAAK,WACpB,KAAK,kBAAoB,GACzB,KAAK,cAAa,EACdA,IACAA,EAAO,qBAAoB,EAC3BA,EAAO,gBAAe,EAE7B,UAED,KAAK,gBAAe,EAEpB,KAAK,UAAU,MAAM5R,CAAC,EAElB,KAAK,kBAAmB,CACxB,KAAK,kBAAoB,GACzB,KAAK,cAAa,EAClB,MAAM4R,EAAS,KAAK,WAChBA,IACAA,EAAO,qBAAoB,EAC3BA,EAAO,gBAAe,EAE7B,CAER,CAED,aAAc,CACV,KAAK,MAAQ,IAAIonC,GAAc,IAAI,EACnC,KAAK,cAAa,EAClB,KAAK,kBAAiB,EACtB,KAAK,2BAA0B,CAClC,CAED,cAAe,CACX,KAAK,kBAAiB,EACtB,KAAK,MAAQ,KACb,KAAK,cAAa,EAClB,KAAK,4BAA2B,CACnC,CAED,4BAA6B,CACzB,MAAMr1C,EAAW,KAAK,QAAQ,UAC9B,GAAIA,EACA,QAAS/I,EAAI,EAAGsK,EAAIvB,EAAS,OAAQ/I,EAAIsK,EAAGtK,IAC1B+I,EAAS/I,CAAC,EAClB,OAAO,iBAGxB,CAED,6BAA8B,CAC1B,MAAM+I,EAAW,KAAK,QAAQ,UAC9B,GAAIA,EACA,QAAS/I,EAAI,EAAGsK,EAAIvB,EAAS,OAAQ/I,EAAIsK,EAAGtK,IAC1B+I,EAAS/I,CAAC,EAClB,OAAO,kBAGxB,CAED,iBAAkB,CACd,KAAK,gBAAe,EACpB,MAAMi7C,EAAa,KAAK,QAAQ,QAAQ,QACxC,KAAK,UAAU,IAAMA,EAAW,MAChCA,EAAW,gBAAe,EAC1B,KAAK,cAAa,CACrB,CAED,kBAAmB,CACX,KAAK,YACL,KAAK,UAAU,IAAM,MAIzB,KAAK,cAAa,EAGlB,KAAK,cAAa,CACrB,CAED,eAAgB,CACZ,KAAK,EAAI,EACT,KAAK,EAAI,CACZ,CAED,iBAAkB,CACT,KAAK,YACN,KAAK,UAAY,IAAIsD,GAAS,IAAI,EAEzC,CAED,eAAgB,CACZ,MAAMjU,EAAU,KAAK,YACjB,KAAK,WAAaA,IACdA,EACA,KAAK,QAAO,EAEZ,KAAK,SAAQ,EAEjB,KAAK,SAAWA,EAEvB,CAED,SAAU,CACN,KAAK,oBAAmB,EACxB,KAAK,QAAQ,kBAChB,CAED,UAAW,CACP,KAAK,wBAAuB,EAC5B,KAAK,QAAQ,mBAChB,CAED,WAAY,CACR,OAAO,KAAK,cAAa,GAAM,KAAK,kBAAiB,CACxD,CAED,eAAgB,CACZ,OAAO,KAAK,QAAU,IACzB,CAED,mBAAoB,CAChB,OAAO,KAAK,aAAe,IAC9B,CAED,yBAA0B,CACtB,MAAMr9B,EAAS,KAAK,QACpBA,EAAO,EAAI,KAAK,WAChBA,EAAO,EAAI,KAAK,WAChBA,EAAO,cAAc,KAAK,eAAgB,KAAK,eAAe,CACjE,CAED,qBAAsB,CAClB,MAAMA,EAAS,KAAK,QACpB,KAAK,WAAaA,EAAO,GACzB,KAAK,WAAaA,EAAO,GACzB,KAAK,eAAiBA,EAAO,GAC7B,KAAK,gBAAkBA,EAAO,EACjC,CAED,UAAUwrB,EAAMT,EAAI,CACZS,GAAQA,EAAK,mBACbA,EAAK,QAAQ,mBAGbT,GAAMA,EAAG,oBACT,KAAK,gBAAe,EACpBA,EAAG,QAAQ,oBAEf,KAAK,cAAa,CACrB,CAED,IAAI,YAAa,CACb,GAAI,KAAK,kBACL,OAAO,KAGX,MAAMhhB,EAAS,KAAK,QAAQ,QAC5B,OAAIA,GAAUA,EAAO,kBACVA,EAAO,QAEX,IACV,CAED,WAAW5R,EAAG,CACV,MAAM4R,EAAS,KAAK,WAChBA,GACAA,EAAO,iBAAgB,CAE9B,CAED,IAAI,OAAQ,CACR,OAAK,KAAK,SACN,KAAK,OAAS,KAAK,iBAEhB,KAAK,MACf,CAED,eAAgB,CACZ,MAAMjM,EAAQ,GACRhC,EAAW,KAAK,QAAQ,UAC9B,GAAIA,EACA,QAAS,EAAI,EAAGuB,EAAIvB,EAAS,OAAQ,EAAIuB,EAAG,IAAK,CAC7C,MAAMyB,EAAOhD,EAAS,CAAC,EACnBgD,EAAK,SACDA,EAAK,cACLhB,EAAM,KAAKgB,EAAK,MAAM,CAGjC,CAEL,OAAOhB,CACV,CAED,kBAAmB,CACf,KAAK,qBAAoB,EACzB,KAAK,gBAAe,CACvB,CAED,sBAAuB,CACnB,KAAK,OAAS,IACjB,CAED,UAAUgL,EAAGC,EAAGuS,EAAGC,EAAG,CAClB,IAAIi2B,EAAY,KAAK,WACjBC,EAAY,KAAK,WACjB,KAAK,QACLD,EAAY,KAAK,MAAM1D,EAAU,6BAA6B,KAAM,EAAI,CAAC,GAEzE,KAAK,QACL2D,EAAY,KAAK,MAAM3D,EAAU,6BAA6B,KAAM,EAAK,CAAC,GAG1E,KAAK,oBACL,KAAK,OAAO,UAAUhlC,EAAI0oC,EAAWzoC,EAAI0oC,EAAWn2B,EAAGC,CAAC,EAGxD,KAAK,OAAO,UAAUi2B,EAAWC,EAAWn2B,EAAGC,CAAC,CAEvD,CAED,kBAAkBm2B,EAAc,GAAMC,EAAe,GAAM,CACvD,KAAK,cAAcD,EAAaC,CAAY,CAC/C,CAED,iBAAkB,CACd,KAAK,cAAa,CACrB,CAED,aAAc,CACV,KAAK,cAAa,CACrB,CAED,WAAY,CACR,OAAO,KAAK,QAAU,CACzB,CAED,cAAcC,EAAsB,GAAOC,EAAuB,GAAO,CACrE,GAAI,KAAK,gBAAiB,CACtB,MAAMtE,EAAS,KAAK,MAAM,QAG1BqE,EAAsBA,GAAuBrE,EAAO,oBAAoB,EAAI,EAC5EsE,EAAuBA,GAAwBtE,EAAO,oBAAoB,EAAK,CAClF,CAED,MAAMuE,EAAS,GAAKF,EAAsB,EAAI,IAAMC,EAAuB,EAAI,GACzEE,EAAiB,KAAK,kBAAkBD,CAAM,EACpD,KAAK,SAAWA,EACZC,EAAiB,EACb,KAAK,WACL,KAAK,WAAW,sBAAsBD,CAAM,EAE5C,KAAK,QAAQ,gBAGjB,KAAK,QAAQ,eAEpB,CAED,kBAAkBE,EAAO,CACrB,MAAQ,GAAI,KAAK,QAAWA,CAC/B,CAED,sBAAsBC,EAAa,CAC/B,MAAMC,EAAY,KAAK,iCAAiCD,CAAW,EAC7DF,EAAiB,KAAK,kBAAkBG,CAAS,EAEvD,GADA,KAAK,SAAWA,EACZH,EAAiB,EAAG,CACpB,MAAM/D,EAAa,KAAK,WACpBA,EACAA,EAAW,sBAAsBkE,CAAS,EAE1C,KAAK,QAAQ,eAE7B,MACY,KAAK,QAAQ,eAEpB,CAED,iCAAiCD,EAAa,CAC1C,MAAM1E,EAAS,KAAK,MAAM,QAEpB4E,EAAqB5E,EAAO,YAAc,EAAI,EAC9C6E,EAAsB7E,EAAO,YAAc,EAAI,EAEV0E,EAAcG,GAEXH,EAAcE,GAEzB5E,EAAO,cAEGA,EAAO,6BAGpC0E,GAAeG,GAM/B,IAAIC,EAAiB9E,EAAO,oBAAoB,EAAI,EAChD+E,EAAkB/E,EAAO,oBAAoB,EAAK,EAElDA,EAAO,SAGHA,EAAO,YACP8E,EAAiB,GAEjBC,EAAkB,IAI1B,MAAMC,EAAc,GAAKF,EAAiB,EAAI,IAAMC,EAAkB,EAAI,GAG1E,OADuBL,EAAcM,CAExC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,iBAAkB,CACd,KAAK,QAAU,CAClB,CAED,uBAAwB,CACpB,KAAK,QAAU,CAClB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,kCAAkCp6C,EAAG,CACjC,KAAK,WAAaA,CACrB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,kCAAkCA,EAAG,CACjC,KAAK,WAAaA,CACrB,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,cAAcA,EAAG,CACb,KAAK,iBAAmBA,IACxB,KAAK,eAAiBA,EACtB,KAAK,kBAAkB,GAAM,EAAK,EAEzC,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,eACf,CAED,IAAI,eAAeA,EAAG,CACd,KAAK,kBAAoBA,IACzB,KAAK,gBAAkBA,EACvB,KAAK,kBAAkB,GAAO,EAAI,EAEzC,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,QAAQ,KACvB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,QAAQ,KACvB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,QAAQ,KACvB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,QAAQ,KACvB,CACL,CCjde,MAAMq6C,EAAc,CAE/B,YAAYprC,EAASqrC,EAAS,KAAM,CAChC,KAAK,GAAKD,GAAc,KAExB,KAAK,QAAUprC,EAEf,KAAK,MAAQA,EAAQ,MAMrB,KAAK,SAAW,IAAI,IAOpB,KAAK,oBAAsB,EAM3B,KAAK,OAASqrC,EAMd,KAAK,SAAW,KAMhB,KAAK,UAAY,KAMjB,KAAK,aAAe,EAEpB,KAAK,EAAI,EACT,KAAK,EAAI,EAET,KAAK,eAAiB,KAMtB,KAAK,UAAY,GAOjB,KAAK,WAAa,KAOlB,KAAK,iBAAmB,CAAC,KAAK,OAO9B,KAAK,WAAa,KAOlB,KAAK,UAAY,KAQhB,KAAK,UAAY,EACrB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,WAAWt6C,EAAG,CACL,KAAK,SAAS,IAAIA,CAAC,GACpB,KAAK,SAAS,IAAIA,CAAC,CAE1B,CAED,cAAcA,EAAG,CACb,KAAK,SAAS,OAAOA,CAAC,CACzB,CAED,uBAAwB,CACpB,KAAK,sBACD,KAAK,sBAAwB,GAC7B,KAAK,YAAW,CAEvB,CAED,uBAAwB,CACpB,KAAK,sBACD,KAAK,sBAAwB,GAC7B,KAAK,cAAa,CAEzB,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,gBACf,CAED,IAAI,gBAAgBA,EAAG,CACnB,KAAK,iBAAmBA,CAC3B,CAED,sBAAsBu6C,EAAI,CACtB,KAAK,SAAS,QAAQzwC,GAAW,CAC7BA,EAAQ,SAAS,QAAQywC,CAAE,CACvC,CAAS,CACJ,CAED,oBAAqB,CACjB,OAAO,KAAK,SAAS,KAAO,CAC/B,CAED,qBAAqBA,EAAI,CACrB,KAAK,SAAS,QAAQzwC,GAAW,CAC7BA,EAAQ,SAAS,QAAQunB,GAAW,CAC5BA,EAAQ,QACRkpB,EAAGlpB,CAAO,CAE9B,CAAa,CACb,CAAS,CACJ,CAED,gBAAiB,CACb,OAAO,KAAK,CACf,CAED,iBAAkB,CACd,OAAO,KAAK,CACf,CAED,cAAe,CACX,MAAO,CAAC,KAAK,WAAa,CAAC,KAAK,OAAM,CACzC,CAED,aAAc,CAEV,KAAK,KAAI,CACZ,CAED,eAAgB,CACZ,KAAK,OAAM,CACd,CAED,QAAS,CACD,KAAK,cACD,KAAK,YACL,KAAK,UAAU,IAAI,EAGnB,KAAK,UAAY,MAErB,KAAK,aAAe,EAE3B,CAED,UAAW,CACP,MAAO,CAAC,CAAC,KAAK,cACjB,CAED,WAAY,CACR,OAAQ,KAAK,aAAe,CAC/B,CAED,SAAU,CACN,MAAO,CAAC,CAAC,KAAK,UACjB,CAED,QAAS,CACL,KAAK,KAAI,EACL,KAAK,UACL,KAAK,KAAI,CAEhB,CAED,KAAKmpB,EAAY,GAAO,CAEhB,KAAK,iBAKL,CAAC,KAAK,gBAAkB,CAAC,KAAK,UAAS,IACvC,KAAK,aAAgB,IAAI,KAAM,EAAE,QAAO,EACxC,KAAK,UAAY,KAAK,OAAO,CAACh5C,EAAKxC,IAAY,CAE3C,GAAI,KAAK,YAAa,CAIlB,GAFA,KAAK,UAAY,KAEb,KAAK,QAAQ,MAAM,UAEnB,OAEJ,GAAIwC,EAEA,KAAK,QAAQA,CAAG,UACTxC,GAAWA,EAAQ,OAC1B,GAAI,CAAC,KAAK,MAAM,gBAAiB,GAAI,CAACw7C,GAAcx7C,EAAQ,WAAa,GAAQ,CAC7E,MAAMy7C,EAAmB,KAAK,MAAM,iBACpC,KAAK,UAAYA,EAAiB,gBAClCA,EAAiB,IAAI,KAAMz7C,CAAO,CAC9D,MAC4B,KAAK,oBAAoBA,CAAO,CAG3C,CACJ,EAAE,IAAI,EAEd,CAED,oBAAoBA,EAAS,CACzB,KAAK,aAAe,EACpB,KAAK,UAAUA,CAAO,CACzB,CAED,UAAUA,EAAS,CACf,MAAMqB,EAASrB,EAAQ,OAEvB,KAAK,UAAaA,GAAWA,EAAQ,UAAY,GACjD,KAAK,EAAIqB,EAAO,OAAUrB,GAAWA,EAAQ,GAAM,EACnD,KAAK,EAAIqB,EAAO,QAAWrB,GAAWA,EAAQ,GAAM,EAEhDA,GAAWA,EAAQ,aAEnB,KAAK,WAAaA,EAAQ,YAG9B,KAAK,UAAY,CAAC,CAACA,EAAQ,UAEvBA,GAAWA,EAAQ,WACnB,KAAK,UAAYA,EAAQ,UACzBA,GAAWA,EAAQ,aACnB,KAAK,cAAgBA,EAAQ,aAE7B,KAAK,cAAgB,GAGrB,KAAK,iBAAiBqB,CAAM,GAE5B,KAAK,eAAiBA,EAEtB,KAAK,EAAI,KAAK,GAAKA,EAAO,EAC1B,KAAK,EAAI,KAAK,GAAKA,EAAO,EAG1B,KAAK,UAAYrB,EAAQ,eAAe,WAAW,EAAIA,EAAQ,UAAY,IAE3E,KAAK,QAAQ,oBAAoB,KAAMA,CAAO,EAIlD,KAAK,WAAa,KAElB,KAAK,OAAM,CACd,CAED,QAAS,CACL,OAAO,KAAK,oBAAsB,CACrC,CAED,QAAS,CACD,KAAK,UACL,KAAK,SAAS,QAAQ8K,GAAW,CAC7BA,EAAQ,OAAM,CAC9B,CAAa,CAER,CAED,mBAAoB,CAIZ,KAAK,iBAEL,KAAK,eAAe,OAAS,KAAK,MAAM,cAG5C,KAAK,qBAAqB,SAAUunB,EAAS,CACzCA,EAAQ,kBAAiB,CACrC,CAAS,CAEJ,CAED,yBAA0B,CACtB,KAAK,qBAAqB,SAAUA,EAAS,CACzCA,EAAQ,qBAAoB,CACxC,CAAS,CACJ,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,oBAAqB,CACjB,KAAK,eAAiB,KAEtB,KAAK,UAAY,IACpB,CAKD,qBAAqBqpB,EAAkBv3B,EAAGC,EAAG,CACzC,IAAIu3B,EAAoB,KAAK,eAE7B,KAAK,eAAiBD,EACtB,KAAK,EAAIv3B,EACT,KAAK,EAAIC,EAEL,CAACu3B,GAAqB,KAAK,gBAC3B,KAAK,qBAAqBtpB,GAAWA,EAAQ,sBAAuB,GAGnE,KAAK,gBACN,KAAK,qBAAqBA,GAAWA,EAAQ,qBAAqB,IAAI,CAAC,EAI3E,KAAK,sBAAsBA,GAAWA,EAAQ,kBAAmB,EAGpE,CAED,QAAQx3B,EAAG,CACP,KAAK,WAAaA,EAClB,KAAK,aAAe,EACpB,QAAQ,MAAM,iCAAkCA,EAAG,KAAK,QAAQ,EAChE,KAAK,qBAAqBw3B,GAAWA,EAAQ,yBAAyBx3B,CAAC,CAAC,CAC3E,CAED,MAAO,CACC,KAAK,YACL,KAAK,QAAQ,kBAAkB,IAAI,CAE1C,CAED,iBAAiBwG,EAAQ,CACrB,OAAIwzC,EAAM,OACCxzC,EAAO,YAAY,OAAS,eAGnC,iBAAkB,OACXA,aAAkB,aAGtB,EACV,CAEL,CAEAg6C,GAAc,UAAU,gBAAkB,GAE1CA,GAAc,GAAK,EC9XJ,MAAMO,EAAkB,CAEnC,YAAYC,EAAa,CAErB,KAAK,SAAWA,EAAY,QAC5B,KAAK,MAAQA,EAEb,KAAK,IAAM,KAAK,MAAM,IAEtB,KAAK,SAAW,GAChB,KAAK,KAAO,GACZ,KAAK,UAAY,GAEjB,KAAK,eAAiB,KAEtB,KAAK,qBAAuB,GAE5B,KAAK,qBAAuB,KAE5B,KAAK,iBAAmB,GAExB,KAAK,MAAQ,EAChB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQ76C,EAAG,CACX,KAAK,SAAWA,EAChB,KAAK,MAAM,8BACd,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,gBACf,CAED,IAAI,gBAAgBA,EAAG,CACnB,KAAK,iBAAmBA,EACxB,KAAK,MAAM,oBAAoB,CAAC,EAGhC,KAAK,MAAM,WAAW,CAAC,CAC1B,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACR,KAAK,YAAcA,IACnB,KAAK,UAAYA,EAGjB,KAAK,MAAM,oBAAoB,CAAC,EAEvC,CAED,mBAAoB,CAChB,OAAK,KAAK,uBACN,KAAK,qBAAuB,IAAIq6C,GAAc,KAAK,SAAS,MAAM,cAAc,EAChF,KAAK,oBAAmB,GAErB,KAAK,oBACf,CAED,kBAAmB,CACf,MAAO,CAAC,CAAC,KAAK,oBACjB,CAED,oBAAqB,CACjB,OAAO,KAAK,sBAAwB,KAAK,qBAAqB,mBAAkB,CACnF,CAED,qBAAsB,CAClB,IAAIS,EAAgB,KAAK,mBACzB,GAAI,KAAK,qBAAsB,CAC3B,GAAI,KAAK,qBAAqB,gBAAkBA,EAAe,CAC3D,IAAI33B,EAAI23B,EAAgBA,EAAc,EAAI,EACtC13B,EAAI03B,EAAgBA,EAAc,EAAI,EAC1C,KAAK,qBAAqB,qBAAqBA,EAAe33B,EAAGC,CAAC,CACrE,CAGD,KAAK,qBAAqB,sBAAsBiO,GAAW,CACvDA,EAAQ,kBAAiB,EACzBA,EAAQ,KAAK,oBAAoB,CAAC,CAClD,CAAa,CACJ,CACJ,CAED,qBAAsB,CAElB,OAAI,KAAK,UAAY,CAAC,KAAK,KAChB,GACA,QAAK,UAAY,KAAK,MAAQ,KAAK,MAAM,kBAAoB,EAK3E,CAED,YAAa,CACT,KAAK,QAAO,CACf,CAED,IAAI,qBAAsB,CACtB,OAAO,KAAK,oBACf,CAED,SAAU,CACN,KAAK,qBAAoB,CAC5B,CAED,sBAAuB,CACf,KAAK,iBACA,KAAK,sBACN,KAAK,IAAI,qBAAqB,KAAK,cAAc,EAErD,KAAK,eAAiB,KACtB,KAAK,qBAAuB,GAC5B,KAAK,oBAAmB,EAE/B,CAGD,4BAA4B0pB,EAAe,CACnC,KAAK,iBAAmBA,IACxB,KAAK,qBAAoB,EACzB,KAAK,eAAiBA,EACtB,KAAK,qBAAuB,GAEnC,CAED,kBAAmB,CACf,MAAO,CAAC,CAAC,KAAK,cACjB,CAED,kBAAmB,CACf,OAAK,KAAK,iBACN,KAAK,eAAiB,KAAK,IAAI,sBAAsB,KAAK,MAAM,GAAI,KAAK,MAAM,EAAE,EACjF,KAAK,qBAAuB,IAEzB,KAAK,cACf,CAED,kBAAmB,CACf,OAAO,KAAK,cACf,CAEL,CCtJe,MAAMC,EAAY,CAE7B,YAAY3pB,EAAS,CACjB,KAAK,SAAWA,EAEhB,KAAK,IAAMA,EAAQ,MAAM,IAKzB,KAAK,QAAU,EAEf,KAAK,QAAU,KAEf,KAAK,UAAY,KAEjB,KAAK,SAAW,EAEhB,KAAK,cAAgB,IAAI4pB,GAEzB,KAAK,YAAc,GAEnB,KAAK,YAAc,EAEnB,KAAK,cAAgB,KAErB,KAAK,eAAiB,KAGtB,KAAK,SAAW,EAChB,KAAK,SAAW,EAEhB,KAAK,SAAW,EAChB,KAAK,SAAW,EAChB,KAAK,SAAW,EAChB,KAAK,SAAW,EAEhB,KAAK,WAAa,GAElB,KAAK,aAAe,GAEpB,KAAK,UAAY,GAGjB,KAAK,OAAS,GAEd,KAAK,aAAe,EAMpB,KAAK,wBAA0B,KAE/B,KAAK,eAAiB,EAEtB,KAAK,UAAY,KAEjB,KAAK,kBAAoB,EAEzB,KAAK,kBAAoB,KAEzB,KAAK,eAAiB,KAAK,cAE3B,KAAK,YAAc,KAAK,IAAI,YAE5B,KAAK,SAAW,KAGhB,KAAK,aAAe,KAGpB,KAAK,iBAAmB,EAExB,KAAK,SAAW,KAAK,SAAW,KAAK,SAAW,KAAK,SAAW,WAEhE,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEV,KAAK,UAAY,EACjB,KAAK,OAAS,KACd,KAAK,OAAS,KACd,KAAK,OAAS,KACd,KAAK,OAAS,KAEd,KAAK,QAAU,EACf,KAAK,QAAU,EACf,KAAK,QAAU,GACf,KAAK,QAAU,GACf,KAAK,QAAU,EACf,KAAK,QAAU,EACf,KAAK,UAAY,EAEjB,KAAK,OAAS,EACd,KAAK,SAAW,GAEhB,KAAK,KAAO,EACZ,KAAK,KAAO,EACZ,KAAK,KAAO,EACZ,KAAK,KAAO,EAEZ,KAAK,QAAU,EACf,KAAK,oBAAsB,GAC3B,KAAK,SAAW,KAEhB,KAAK,QAAU,GASf,KAAK,cAAgB,GAErB,KAAK,QAAU,KAGf,KAAK,wBAA0B,GAE/B,KAAK,YAAc,KAEnB,KAAK,oBAAsB,GAE3B,KAAK,cAAgB,KAErB,KAAK,iBAAmB,KAExB,KAAK,oBAAsB,GAE3B,KAAK,UAAY,KAEjB,KAAK,SAAW,GAEhB,KAAK,OAAS,KAAK,cAEnB,KAAK,QAAU,IAClB,CAED,IAAI,SAAU,CACV,OAAI,KAAK,OACE,KAAK,OAER,KAAK,gBACE,KAAK,QAAQ,UAEb,KAAK,EAGvB,CAED,IAAI,QAAQj7C,EAAG,CACP6zC,EAAM,WAAW7zC,CAAC,EAClB,KAAK,MAAQA,GAEb,KAAK,cAAa,EACd,KAAK,iBACL,KAAK,GAAMA,EAAI,KAAK,QAAQ,UAC5B,KAAK,QAAQ,kCAAkCA,CAAC,GAEhD,KAAK,EAAIA,EAGpB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACDA,IAAM,KAAK,KACX,KAAK,2BAA2BA,EAAI,KAAK,GAAI,CAAC,EAC9C,KAAK,GAAKA,EAEjB,CAED,IAAI,OAAQ,CACR,OAAQ,KAAK,UAAY,EAAI,KAAK,OAAS,IAC9C,CAED,IAAI,MAAMA,EAAG,CACL,KAAK,SAAWA,IAChB,KAAK,WAAa,EAClB,KAAK,OAASA,EACV,KAAK,iBACL,KAAK,QAAQ,kCAAkC,CAAC,EAChD,KAAK,OAAO,gBAEZ,KAAK,GAAK,EACV,KAAK,wBAAuB,GAGvC,CAED,eAAgB,CACZ,KAAK,UAAY,KAAK,UAAa,MAAS,EAC5C,KAAK,OAAS,IACjB,CAED,IAAI,SAAU,CACV,OAAI,KAAK,OACE,KAAK,OAER,KAAK,gBACE,KAAK,QAAQ,UAEb,KAAK,EAGvB,CAED,IAAI,QAAQA,EAAG,CACP6zC,EAAM,WAAW7zC,CAAC,EAClB,KAAK,MAAQA,GAEb,KAAK,cAAa,EACd,KAAK,iBACL,KAAK,GAAMA,EAAI,KAAK,QAAQ,UAC5B,KAAK,QAAQ,kCAAkCA,CAAC,GAEhD,KAAK,EAAIA,EAGpB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACDA,IAAM,KAAK,KACX,KAAK,2BAA2B,EAAGA,EAAI,KAAK,EAAE,EAC9C,KAAK,GAAKA,EAEjB,CAED,IAAI,OAAQ,CACR,OAAQ,KAAK,UAAY,EAAI,KAAK,OAAS,IAC9C,CAED,IAAI,MAAMA,EAAG,CACL,KAAK,SAAWA,IAChB,KAAK,WAAa,EAClB,KAAK,OAASA,EACV,KAAK,iBACL,KAAK,QAAQ,kCAAkC,CAAC,EAChD,KAAK,OAAO,gBAEZ,KAAK,GAAK,EACV,KAAK,wBAAuB,GAGvC,CAED,eAAgB,CACZ,KAAK,UAAY,KAAK,UAAa,MAAS,EAC5C,KAAK,OAAS,IACjB,CAED,IAAI,OAAQ,CACR,OAAQ,KAAK,UAAY,EAAI,KAAK,OAAS,IAC9C,CAED,IAAI,MAAMA,EAAG,CACL,KAAK,SAAWA,IAChB,KAAK,WAAa,EAClB,KAAK,OAASA,EACV,KAAK,iBACL,KAAK,QAAQ,eAAiB,EAC9B,KAAK,OAAO,kBAAkB,GAAM,EAAK,IAEzC,KAAK,GAAK,EACV,KAAK,wBAAuB,GAGvC,CAED,cAAe,CACX,KAAK,UAAY,KAAK,UAAa,MAAS,EAC5C,KAAK,OAAS,IACjB,CAED,IAAI,OAAQ,CACR,OAAQ,KAAK,UAAY,EAAI,KAAK,OAAS,IAC9C,CAED,IAAI,MAAMA,EAAG,CACL,KAAK,SAAWA,IAChB,KAAK,WAAa,EAClB,KAAK,OAASA,EACV,KAAK,iBACL,KAAK,QAAQ,gBAAkB,EAC/B,KAAK,OAAO,kBAAkB,GAAO,EAAI,IAEzC,KAAK,GAAK,EACV,KAAK,wBAAuB,GAGvC,CAED,cAAe,CACX,KAAK,UAAY,KAAK,UAAa,MAAS,EAC5C,KAAK,OAAS,IACjB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,gBAAiB,CACb,OAAI,KAAK,gBACE,KAAK,QAAQ,cAEb,KAAK,EAEnB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,iBAAkB,CACd,OAAI,KAAK,gBACE,KAAK,QAAQ,eAEb,KAAK,EAEnB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACN,KAAK,UAAYA,IACjB,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACN,KAAK,UAAYA,IACjB,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,MAAMA,EAAG,EACL,KAAK,UAAYA,GAAK,KAAK,UAAYA,KACvC,KAAK,QAAUA,EACf,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACN,KAAK,UAAYA,IACjB,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACN,KAAK,UAAYA,IACjB,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OACf,CAED,IAAI,MAAMA,EAAG,EACL,KAAK,UAAYA,GAAK,KAAK,UAAYA,KACvC,KAAK,QAAUA,EACf,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACN,KAAK,UAAYA,IACjB,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACN,KAAK,UAAYA,IACjB,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OACf,CAED,IAAI,MAAMA,EAAG,EACL,KAAK,UAAYA,GAAK,KAAK,UAAYA,KACvC,KAAK,QAAUA,EACf,KAAK,QAAUA,EACf,KAAK,sBAAqB,EAEjC,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACR,KAAK,YAAcA,IACnB,KAAK,UAAYA,EACjB,KAAK,sBAAqB,EAEjC,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,MAAMA,EAAG,CAGT,GADAA,EAAKA,EAAI,EAAI,EAAKA,EAAI,MAAQ,EAAIA,EAC9B,KAAK,SAAWA,EAAG,CACnB,IAAIiD,EAAO,KAAK,OAChB,KAAK,OAASjD,EACd,KAAK,kBAAiB,EACjBiD,IAAS,IAAQjD,IAAM,IACxB,KAAK,SAAS,oBAErB,CACJ,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAG,CACP,KAAK,WAAaA,IAClB,KAAK,SAAWA,EAChB,KAAK,kBAAiB,EACtB,KAAK,SAAS,qBAEV,KAAK,iBACL,KAAK,OAAO,WAAWA,CAAC,EAGnC,CAED,uBAAwB,CACpB,GAAI,KAAK,YAAc,GAAK,KAAK,WAAa,EAAI,KAAK,IAAK,CAExD,IAAIk7C,EAAM,KAAK,IAAI,KAAK,SAAS,EAC7BC,EAAM,KAAK,IAAI,KAAK,SAAS,EAEjC,KAAK,mBACDA,EAAM,KAAK,QACX,CAACD,EAAM,KAAK,QACZA,EAAM,KAAK,QACXC,EAAM,KAAK,OAC3B,CACA,MACY,KAAK,mBACD,KAAK,QACL,EACA,EACA,KAAK,OACrB,EAEQ,KAAK,sBAAqB,CAC7B,CAED,uBAAwB,CACpB,KAAK,sBAAqB,EAC1B,KAAK,wBAAuB,CAC/B,CAED,uBAAwB,CACpB,IAAIC,EAAY,KAAK,QAAU,KAAK,GAChCC,EAAY,KAAK,QAAU,KAAK,GAChCC,EAAK,KAAK,IAAMF,EAAY,KAAK,SAAWC,EAAY,KAAK,UAAYD,EACzEG,EAAK,KAAK,IAAMH,EAAY,KAAK,SAAWC,EAAY,KAAK,UAAYA,EAC7EC,GAAM,KAAK,QAAU,KAAK,GAC1BC,GAAM,KAAK,QAAU,KAAK,GAC1B,KAAK,SAAWD,EAChB,KAAK,SAAWC,CACnB,CAED,2BAA2BhI,EAAIiI,EAAI,CAC/B,KAAK,mBAAmBjI,EAAIiI,CAAE,CACjC,CAED,mBAAoB,CAChB,KAAK,eAAe,KAAK,SAAW,KAAK,OAAS,CAAC,CACtD,CAQD,oBAAoBlhD,EAAM,CACtB,GAAI,KAAK,cAAc,MAAO,CAE1B,IAAI+G,EAAI,KAER,IADAA,EAAE,kBAAoB,KAAK,IAAI/G,EAAM+G,EAAE,iBAAiB,GAChDA,EAAIA,EAAE,UAAaA,EAAE,oBAAsB,GAC/CA,EAAE,kBAAoB,CAE7B,CACJ,CAUD,WAAW/G,EAAM,CACb,KAAK,SAAWA,EAEhB,KAAK,eAAc,EAGf,KAAK,SACL,KAAK,QAAQ,oBAAoB,CAAC,CAEzC,CAED,gBAAiB,CACb,IAAI+G,EAAI,KACR,KAAOA,GAAK,CAACA,EAAE,aACXA,EAAE,YAAc,GAChBA,EAAIA,EAAE,OAEb,CAED,WAAY,CACR,OAAO,KAAK,OACf,CAED,UAAUuQ,EAAQ,CACd,GAAIA,IAAW,KAAK,QAAS,CACzB,IAAI6pC,EAAiB,KAAK,aACtBC,EAAa,KAAK,QAwCtB,GAvCA,KAAK,QAAU9pC,GAGX,KAAK,SAAYA,GAAUA,EAAO,gBAAiB,IACnD,KAAK,OAAO,UAAU8pC,EAAY9pC,CAAM,EAGxC8pC,GAEAA,EAAW,oBAAoB,CAAC,EAGpC,KAAK,WAAW,EAAI,EAAI,CAAC,EAErB,KAAK,SAEL,KAAK,QAAQ,iBAGb,KAAK,UAAY,EACjB,KAAK,WAAW9pC,CAAM,EAEtB,KAAK,WAAWA,EAASA,EAAO,aAAY,EAAK,IAAI,EAGrD6pC,IAAmB,KAAK,eACnB,KAAK,aAGN,KAAK,eAAeC,EAAW,aAAc,GAF7C,KAAK,gBAAe,GAO5B,KAAK,cAAgB,GACjB,KAAK,UACL,KAAK,SAAS,cAGd,CAAC,KAAK,QAAS,CACf,IAAIC,EAAiB/pC,GAAU,CAACA,EAAO,wBAA0BA,EAAO,aAAe,KACnF+pC,IAAmB,KAAK,eACxB,KAAK,oBAAoB,CAAC,EAC1B,KAAK,yBAAyBA,CAAc,EAEnD,CACJ,CACJ,CAED,YAAY9oB,EAAQ,GAAO,CACnB,CAAC,KAAK,QAAU,KAAK,eAAiB,IACtC,KAAK,OAAS,GACVA,GAGA,KAAK,IAAI,WAAW,IAAI,EAGnC,CAED,WAAW7tB,EAAOiE,EAAO,CAChB,KAAK,YAAW,KAAK,UAAY,IACtC,KAAK,UAAU,OAAOjE,EAAO,EAAGiE,CAAK,EACrCA,EAAM,UAAU,IAAI,CACvB,CAED,WAAWjE,EAAOiE,EAAO,CAChB,KAAK,YAAW,KAAK,UAAY,IACtC,KAAK,UAAUjE,CAAK,EAAE,UAAU,IAAI,EACpC,KAAK,UAAUA,CAAK,EAAIiE,EACxBA,EAAM,UAAU,IAAI,CACvB,CAED,cAAcjE,EAAO,CACjB,IAAIiE,EAAQ,KAAK,UAAUjE,CAAK,EAChC,KAAK,UAAU,OAAOA,EAAO,CAAC,EAC9BiE,EAAM,UAAU,IAAI,CACvB,CAED,gBAAiB,CACb,GAAI,KAAK,UAAW,CAChB,QAASrO,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC9C,KAAK,UAAUA,CAAC,EAAE,UAAU,IAAI,EAGpC,KAAK,UAAU,OAAO,CAAC,EAEnB,KAAK,mBACL,KAAK,kBAAkB,OAAO,CAAC,CAEtC,CACJ,CAED,aAAa+1B,EAASirB,EAAOC,EAAO,CAChC,KAAK,UAAYA,EACjB,QAASjhD,EAAI,EAAGsK,EAAIyrB,EAAQ,OAAQ/1B,EAAIsK,EAAGtK,IACvC+1B,EAAQ/1B,CAAC,EAAE,UAAU,IAAI,EAE7B,QAASA,EAAI,EAAGsK,EAAI02C,EAAM,OAAQhhD,EAAIsK,EAAGtK,IACrCghD,EAAMhhD,CAAC,EAAE,UAAU,IAAI,CAE9B,CAED,UAAUkhD,EAAWC,EAAS,CAC1B,IAAIz8C,EAAI,KAAK,UAAUw8C,CAAS,EAChC,KAAK,UAAU,OAAOA,EAAW,CAAC,EAClC,KAAK,UAAU,OAAOC,EAAS,EAAGz8C,CAAC,EAGnC,KAAK,cAAgB,GACjB,KAAK,UACL,KAAK,SAAS,aAErB,CAED,mBAAmBrC,EAAGC,EAAGoC,EAAGiG,EAAG,CAC3B,KAAK,WAAW,CAAC,EACjB,KAAK,SAAWtI,EAChB,KAAK,SAAWC,EAChB,KAAK,SAAWoC,EAChB,KAAK,SAAWiG,EAGhB,KAAK,WAAcrI,IAAM,GAAOoC,IAAM,GAAOrC,EAAI,GAAOsI,EAAI,CAC/D,CAED,mBAAmBguC,EAAIiI,EAAI,CACvB,KAAK,UAAYjI,EACjB,KAAK,UAAYiI,EACjB,KAAK,wBAAuB,CAC/B,CAED,eAAev+C,EAAG,CACV,CAAC,KAAK,cAAc,OAAW,KAAK,SAAW,KAAK,QAAQ,cAAc,OAAUA,EAEpF,KAAK,WAAW,EAAI,GAAG,EAEvB,KAAK,WAAW,CAAC,EAGjBA,EAAI,QAEJA,EAAI,GAGR,KAAK,YAAcA,CACtB,CAED,cAAckmB,EAAGC,EAAG44B,EAAa,KAAK,aAAc,CAIhD,GAFA,KAAK,aAAeA,EAEhB,KAAK,gBACL,KAAK,QAAQ,cAAgB74B,EAC7B,KAAK,QAAQ,eAAiBC,UAE1B,KAAK,KAAOD,GAAK,KAAK,KAAOC,EAC7B,YAAK,kBAAkBD,EAAGC,CAAC,EACpB,GAGf,MAAO,EACV,CAED,kBAAkBD,EAAGC,EAAG,EAChB,KAAK,KAAOD,GAAK,KAAK,KAAOC,KAC7B,KAAK,GAAKD,EACV,KAAK,GAAKC,EAEV,KAAK,wBAAuB,EAExB,KAAK,cACL,KAAK,YAAY,uBACjB,KAAK,YAAY,uBAGrB,KAAK,sBAAqB,EAEjC,CAED,iBAAiB64B,EAAKC,EAAKC,EAAKC,EAAK,CACjC,KAAK,oBAAoB,CAAC,EAE1B,KAAK,KAAOH,EACZ,KAAK,KAAOC,EACZ,KAAK,KAAOC,EACZ,KAAK,KAAOC,CACf,CAED,IAAI,wBAAyB,CACzB,OAAO,KAAK,uBACf,CAED,0BAA0BrhC,EAAe,CACrC,KAAK,oBAAoB,CAAC,EAC1B,KAAK,wBAA0BA,CAClC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,WAAY,CAER,KAAK,QAAU,IAAIigC,GAAY,KAAK,QAAQ,EAG5C,KAAK,QAAQ,kBAAoB,EACjC,KAAK,QAAQ,YAAc,GAG3B,KAAK,QAAU,GAEf,KAAK,IAAI,KAAO,KAGhB,KAAK,QAAQ,UAAY,CAAC,EAAG,EAAG,KAAK,IAAI,MAAM,YAAa,KAAK,IAAI,MAAM,YAAY,EACvF,KAAK,QAAQ,SAAW,KAAK,QAAQ,UAGrC,KAAK,QAAQ,iBAAmB,KAEhC,KAAK,WAAW,EAAI,EAAI,CAAC,CAC5B,CAED,aAAa17C,EAAG,CACZ,IAAI+B,EAAI/B,EACR,KAAO+B,EAAIA,EAAE,SACT,GAAI,OAASA,EACT,MAAO,GAGf,MAAO,EACV,CAED,YAAa,CACT,OAAQ,KAAK,qBAAuB,KAAK,yBAA2B,KAAK,UAAY,GAAK,KAAK,SAAW,CAAC,KAAK,OACnH,CAED,cAAe,CACX,OAAI,KAAK,aACE,KAEA,KAAK,QAAQ,cAE3B,CAED,WAAWg7C,EAAY,CACnB,GAAI,KAAK,WAAaA,EAAY,CAU9B,GATI,KAAK,WAAa,OACd,KAAK,UAAY,GACjB,KAAK,SAAS,mBAIlB,KAAK,SAAS,eAGdA,IAAe,KAAM,CACrB,IAAIC,EAAoBD,EAAW,eAAiB,EAGhD,KAAK,UAAY,GACjBA,EAAW,iBAAgB,EAG3BA,EAAW,eAAiB,IACxB,CAACC,GAAqB,KAAK,UAAYD,GAKvCA,EAAW,kBAAkB,KAAK,IAAI,EAI1CA,EAAW,YAAW,EAE7B,CAED,KAAK,SAAWA,EAGhB,KAAK,cAAgB,EACxB,CACJ,CAED,kBAAmB,CAEf,GADA,KAAK,iBACD,KAAK,iBAAmB,IACnB,KAAK,oBACN,KAAK,kBAAoB,IAEzB,KAAK,WAAW,CAEhB,QAASzhD,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC9C,KAAK,kBAAkB,KAAK,KAAK,UAAUA,CAAC,CAAC,EAGjD,KAAK,OAAS,EACjB,CAER,CAED,kBAAmB,CACf,KAAK,iBACD,KAAK,iBAAmB,IACxB,KAAK,OAAS,GACd,KAAK,kBAAkB,OAAO,CAAC,EAEtC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAO8X,EAAQ,CACf,GAAI,KAAK,UAAYA,EAAQ,CACzB,KAAK,oBAAoB,CAAC,EAE1B,IAAI2pC,EAAa,KAAK,SAElBZ,EAAiB,KAAK,aACtB/oC,IAAW,GAAK,KAAK,UAAY,EAC7B,KAAK,UAAY,KAAK,SAClB,KAAK,UACL,KAAK,SAAS,mBAGlB2pC,EAAa,KAAK,QAEf3pC,IAAW,GAAK,KAAK,UAAY,GACxC2pC,EAAa,KAAK,QAAU,KAAK,QAAQ,aAAc,EAAG,KACtDA,IAAe,KAAK,UAChB,KAAK,WACL,KAAK,SAAS,mBACd,KAAK,SAAS,gBAGf3pC,IAAW,KAAK,SACnB,KAAK,UAAY,KAAK,SAAS,gBAC/B,KAAK,SAAS,cAIlB2pC,IAAe,KAAK,UACpB,KAAK,WAAW,IAAI,EAGxB,KAAK,QAAU3pC,EAEX2pC,IAAe,KAAK,UACpB,KAAK,WAAWA,CAAU,EAG1BZ,IAAmB,KAAK,eACnB,KAAK,aAGN,KAAK,eAAe,KAAK,QAAQ,aAAc,GAF/C,KAAK,gBAAe,GAO5B,KAAK,cAAgB,GACjB,KAAK,UACL,KAAK,SAAS,aAErB,CACJ,CAED,IAAI,oBAAqB,CACrB,OAAO,KAAK,mBACf,CAED,IAAI,mBAAmBz7C,EAAG,CACtB,KAAK,oBAAoB,CAAC,EAE1B,IAAIy7C,EAAiB,KAAK,aAC1B,KAAK,oBAAsBz7C,EAEvBy7C,IAAmB,KAAK,eACnB,KAAK,aAGN,KAAK,eAAe,KAAK,QAAQ,aAAc,GAF/C,KAAK,gBAAe,EAK/B,CAED,eAAec,EAAc,CACrBA,GAAgBA,EAAa,eAAiB,GAE9B,KAAK,oBACb,QAASj9C,GAAM,CACf,KAAK,aAAaA,CAAC,GAAKA,EAAE,UAAY,GACtCA,EAAE,WAAW,IAAI,CAErC,CAAa,CAER,CAED,mBAAoB,CAChB,MAAM6F,EAAU,GAChB,GAAI,KAAK,UACL,QAASvK,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC9C,KAAK,UAAUA,CAAC,EAAE,qBAAqBuK,CAAO,EAGtD,OAAOA,CACV,CAED,qBAAqBA,EAAS,CAC1B,GAAI,KAAK,QACLA,EAAQ,KAAK,IAAI,UACV,KAAK,WAAa,CAAC,KAAK,WAAU,EACzC,QAASvK,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC9C,KAAK,UAAUA,CAAC,EAAE,qBAAqBuK,CAAO,CAGzD,CAED,iBAAkB,CAEd,GAAI,KAAK,eAAiB,EAAG,CACzB,IAAIk3C,EAAa,KAAK,QAAQ,aAAY,EAGtC,KAAK,QACL,KAAK,qBAAoB,EAG7B,KAAK,kBAAkB,MAAO,EAAC,QAAQ,SAAU/8C,EAAG,CAC5CA,EAAE,UAAY,GACdA,EAAE,WAAW+8C,CAAU,CAE3C,CAAa,CACJ,CACJ,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQxwC,EAAO,CACX,KAAK,WAAaA,IAClB,KAAK,oBAAoB,KAAK,wBAA0B,EAAI,CAAC,EAC7D,KAAK,SAAWA,EAEvB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAO,CACX,KAAK,WAAaA,IAClB,KAAK,oBAAoB,KAAK,wBAA0B,EAAI,CAAC,EAC7D,KAAK,SAAWA,EAEvB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAO,CACX,KAAK,WAAaA,IAClB,KAAK,oBAAoB,KAAK,wBAA0B,EAAI,CAAC,EAC7D,KAAK,SAAWA,EAEvB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAO,CACX,KAAK,WAAaA,IAClB,KAAK,oBAAoB,KAAK,wBAA0B,EAAI,CAAC,EAC7D,KAAK,SAAWA,EAEvB,CAGD,IAAI,SAASqtC,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,WAAW,CAAC,CACpB,CAED,IAAI,cAAcA,EAAG,CACjB,KAAK,eAAiBA,EACtB,KAAK,WAAW,CAAC,CACpB,CAED,IAAI,aAAaA,EAAG,CAChB,KAAK,cAAgBA,EACrB,KAAK,WAAW,CAAC,CACpB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOl5C,EAAG,CACV,KAAK,oBAAoB,CAAC,EAE1B,IAAIw8C,EAAa,KAAK,QAEtB,GADA,KAAK,QAAUx8C,EACX,CAACA,GAAKw8C,EAAY,CAElB,IAAIb,EAAkB,KAAK,SAAW,CAAC,KAAK,QAAQ,wBAA0B,KAAK,QAAQ,aAAe,KAC1G,KAAK,yBAAyBA,CAAc,CAC/C,MAAU37C,GAEP,KAAK,yBAAyB,IAAI,CAEzC,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aAAe,KAAK,aAAa,OAAS,KAAK,YAAY,aAC1E,CAED,IAAI,mBAAoB,CACpB,OAAO,KAAK,YACf,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACR,KAAK,YAAcA,IACnB,KAAK,UAAYA,EAIjB,KAAK,WAAW,EAAI,CAAC,EAE5B,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAG,CAIX,KAAK,SAAWA,CACnB,CAED,yBAAyB66C,EAAa,CAGlC,GAFA,KAAK,aAAeA,EAEhB,KAAK,WAAa,CAAC,KAAK,wBACxB,QAASjgD,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAAK,CACnD,IAAI0E,EAAI,KAAK,UAAU1E,CAAC,EACnB0E,EAAE,UACHA,EAAE,yBAAyBu7C,CAAW,EACtCv7C,EAAE,kBAAoB,EAE7B,CAER,CAED,iCAAiCu7C,EAAa,CAC1C,GAAI,KAAK,UACL,QAASjgD,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAAK,CACnD,IAAI0E,EAAI,KAAK,UAAU1E,CAAC,EACnB0E,EAAE,UACHA,EAAE,yBAAyBu7C,CAAW,EACtCv7C,EAAE,kBAAoB,EAE7B,CAER,CAED,mBAAoB,CAChB,OAAO,KAAK,iBAAmB,KAAK,aACvC,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,8BAA+B,CAEnB,KAAK,WAAW,SAGpB,KAAK,uBAAsB,GAE3B,KAAK,wBAAuB,EAC5B,KAAK,YAAY,uBAExB,CAED,wBAAyB,CACrB,GAAI,CAAC,KAAK,wBAAyB,CAC/B,IAAIm8C,EAAiB,KAAK,aAE1B,KAAK,wBAA0B,GAE/B,KAAK,eAAiB,IAAIR,GAG1B,KAAK,iCAAiC,IAAI,EAErCQ,GAED,KAAK,eAAe,KAAK,QAAU,KAAK,QAAQ,eAAiB,IAAI,EAGzE,KAAK,oBAAoB,CAAC,EAG1B,KAAK,WAAW,CAAC,EAEjB,KAAK,OAAS,KAAK,eACtB,CACJ,CAED,yBAA0B,CAClB,KAAK,0BACL,KAAK,wBAA0B,GAE/B,KAAK,iCAAiC,KAAK,YAAY,EAEvD,KAAK,eAAiB,KAAK,cAEtB,KAAK,cACN,KAAK,gBAAe,EAIxB,KAAK,WAAW,CAAC,EAEjB,KAAK,oBAAoB,CAAC,EAE1B,KAAK,OAAS,KAAK,cAE1B,CAED,SAAU,CACN,OAAQ,KAAK,WAAa,YAAgB,KAAK,WAAa,YAAgB,KAAK,WAAa,YAAgB,KAAK,WAAa,UACnI,CAED,oBAAqB,CACjB,OAAQ,KAAK,OAAS,GAAO,KAAK,OAAS,GAAO,KAAK,OAAS,GAAO,KAAK,OAAS,CACxF,CAED,iBAAkB,CACd,KAAK,kBAAoB,CAAC,KAAK,KAAM,KAAK,KAAM,KAAK,KAAM,KAAK,IAAI,EACpE,KAAK,KAAO,EACZ,KAAK,KAAO,EACZ,KAAK,KAAO,EACZ,KAAK,KAAO,CACf,CAED,mBAAoB,CAChB,KAAK,KAAO,KAAK,kBAAkB,CAAC,EACpC,KAAK,KAAO,KAAK,kBAAkB,CAAC,EACpC,KAAK,KAAO,KAAK,kBAAkB,CAAC,EACpC,KAAK,KAAO,KAAK,kBAAkB,CAAC,EACpC,KAAK,kBAAoB,IAC5B,CAED,cAAe,CACX,KAAK,eAAiB,CAAC,KAAK,SAAU,KAAK,SAAU,KAAK,SAAU,KAAK,QAAQ,EACjF,KAAK,SAAW,WAChB,KAAK,SAAW,WAChB,KAAK,SAAW,WAChB,KAAK,SAAW,UACnB,CAED,gBAAiB,CACb,KAAK,SAAW,KAAK,eAAe,CAAC,EACrC,KAAK,SAAW,KAAK,eAAe,CAAC,EACrC,KAAK,SAAW,KAAK,eAAe,CAAC,EACrC,KAAK,SAAW,KAAK,eAAe,CAAC,EACrC,KAAK,eAAiB,IACzB,CAED,WAAY,CACR,OAAQ,KAAK,YAAc,KAC9B,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,aAAaz7C,EAAG,CAMhB,KAAK,cAAgBA,EAAIA,EAAE,MAAK,EAAK,KAGrC,KAAK,wBAAuB,CAC/B,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,QAAS,CACL,KAAK,SAAW,KAAK,QAAQ,SAEzB,KAAK,SAAW,KAAK,QAAQ,UAAS,EAClC,KAAK,QAAU,KACf,KAAK,QAAQ,iBAET,KAAK,QAAU,GAAM,KAAK,WAClC,KAAK,uBAAsB,EAG3B,KAAK,YAEL,KAAK,YAAc,GACnB,KAAK,UAAU,KAAK,QAAS,IAAI,GAGrC,MAAMy8C,EAAK,KAAK,QAAQ,cACxB,IAAIt5B,EAAI,KAAK,cACb,MAAMu5B,EAAWD,EAAG,OAAS,KAAK,YAQlC,GAAI,KAAK,aAAgB,KAAK,SAAWC,GAAav5B,EAAE,OAAS,CAACu5B,EAAU,CACxE,IAAI/C,EAAS,KAAK,QAGdA,EAAS,IACL,CAACx2B,EAAE,OAASu5B,IAEZ,KAAK,kBAAoB,GAE7Bv5B,EAAE,MAAQs5B,EAAG,MAAQ,KAAK,YAEtBt5B,EAAE,MAAQ,QAEVA,EAAE,MAAQ,IAIdw2B,EAAS,IACTx2B,EAAE,GAAKs5B,EAAG,GAAK,KAAK,SAAWA,EAAG,GAClCt5B,EAAE,GAAKs5B,EAAG,GAAK,KAAK,SAAWA,EAAG,GAC9BA,EAAG,KAAO,IAAGt5B,EAAE,IAAM,KAAK,SAAWs5B,EAAG,IACxCA,EAAG,KAAO,IAAGt5B,EAAE,IAAM,KAAK,SAAWs5B,EAAG,KAG5C9C,EAAS,IACTx2B,EAAE,GAAK,KAAK,SAAWs5B,EAAG,GAC1Bt5B,EAAE,GAAK,KAAK,SAAWs5B,EAAG,GAC1Bt5B,EAAE,GAAK,KAAK,SAAWs5B,EAAG,GAC1Bt5B,EAAE,GAAK,KAAK,SAAWs5B,EAAG,GAEtB,KAAK,aACLt5B,EAAE,IAAM,KAAK,SAAWs5B,EAAG,GAC3Bt5B,EAAE,IAAM,KAAK,SAAWs5B,EAAG,GAC3Bt5B,EAAE,IAAM,KAAK,SAAWs5B,EAAG,GAC3Bt5B,EAAE,IAAM,KAAK,SAAWs5B,EAAG,KAKnC,MAAMl8C,EAAK,KAAK,QAAQ,eACxB,GAAI,KAAK,QAAQ,oBAAqB,CAClC,MAAM+D,EAAO,KAAK,iBAAmB,KAAK,cACtCA,IAGA,KAAK,eAAiB,IAAI22C,IAG9B,MAAMtkC,EAAI,KAAK,gBAGXrS,GAASq1C,EAAS,KAClBhjC,EAAE,MAAQpW,EAAG,MAAQ,KAAK,YAEtBoW,EAAE,MAAQ,QACVA,EAAE,MAAQ,KAIdrS,GAASq1C,EAAS,KAClBhjC,EAAE,GAAKpW,EAAG,GAAK,KAAK,SAAWA,EAAG,GAClCoW,EAAE,GAAKpW,EAAG,GAAK,KAAK,SAAWA,EAAG,GAC9BA,EAAG,KAAO,IAAGoW,EAAE,IAAM,KAAK,SAAWpW,EAAG,IACxCA,EAAG,KAAO,IAAGoW,EAAE,IAAM,KAAK,SAAWpW,EAAG,KAG5C+D,IAEAq1C,GAAU,IAGVr1C,GAASq1C,EAAS,KAClBhjC,EAAE,GAAK,KAAK,SAAWpW,EAAG,GAC1BoW,EAAE,GAAK,KAAK,SAAWpW,EAAG,GAC1BoW,EAAE,GAAK,KAAK,SAAWpW,EAAG,GAC1BoW,EAAE,GAAK,KAAK,SAAWpW,EAAG,GAEtB,KAAK,aACLoW,EAAE,IAAM,KAAK,SAAWpW,EAAG,GAC3BoW,EAAE,IAAM,KAAK,SAAWpW,EAAG,GAC3BoW,EAAE,IAAM,KAAK,SAAWpW,EAAG,GAC3BoW,EAAE,IAAM,KAAK,SAAWpW,EAAG,IAGnD,MACgB,KAAK,eAAiB,KAAK,cAG3B,KAAK,IAAI,kBAAoB,GAC7B,KAAK,IAAI,gBAAkB,KAAK,iBAAmB,EAEnD,KAAK,iBAAmB,KAAK,IAAI,kBAIrC,MAAMo8C,EAAqB,KAAK,yBAA2B,KAAK,YAAY,sBACxE,KAAK,sBAAwBA,IAE7B,KAAK,SAAW,EAAI,EAGpBhD,GAAU,EAEL,KAAK,qBAEN,KAAK,YAAY,WAGzB,KAAK,oBAAsBgD,EAE3B,MAAMhmC,EAAI,KAAK,eAETimC,EAAQ,KAAK,aAAe,KAAO,KAAK,GACxCC,EAAQ,KAAK,aAAe,KAAO,KAAK,GAG9C,IAAIhsC,EAAIC,EAAIgsC,EAAIC,EAChB,MAAMC,EAAYrmC,EAAE,KAAO,GAAOA,EAAE,KAAO,GAAOA,EAAE,GAAK,GAAOA,EAAE,GAAK,EAavE,GAZIqmC,GACAnsC,EAAK,KAAK,IAAI,EAAG+rC,EAAQjmC,EAAE,GAAIimC,EAAQjmC,EAAE,GAAKkmC,EAAQlmC,EAAE,GAAIkmC,EAAQlmC,EAAE,EAAE,EAAIA,EAAE,GAC9EmmC,EAAK,KAAK,IAAI,EAAGF,EAAQjmC,EAAE,GAAIimC,EAAQjmC,EAAE,GAAKkmC,EAAQlmC,EAAE,GAAIkmC,EAAQlmC,EAAE,EAAE,EAAIA,EAAE,GAC9E7F,EAAK,KAAK,IAAI,EAAG8rC,EAAQjmC,EAAE,GAAIimC,EAAQjmC,EAAE,GAAKkmC,EAAQlmC,EAAE,GAAIkmC,EAAQlmC,EAAE,EAAE,EAAIA,EAAE,GAC9EomC,EAAK,KAAK,IAAI,EAAGH,EAAQjmC,EAAE,GAAIimC,EAAQjmC,EAAE,GAAKkmC,EAAQlmC,EAAE,GAAIkmC,EAAQlmC,EAAE,EAAE,EAAIA,EAAE,KAE9E9F,EAAK8F,EAAE,GACPmmC,EAAKnmC,EAAE,GAAKA,EAAE,GAAKimC,EACnB9rC,EAAK6F,EAAE,GACPomC,EAAKpmC,EAAE,GAAKA,EAAE,GAAKkmC,GAGnB,KAAK,eAAiBG,GAAY,KAAK,SAAW,GAAK,KAAK,SAAW,GAAI,CAG3E,MAAMC,EAAK,KAAK,GAAK18C,EAAG,GAAK,KAAK,GAAKA,EAAG,GAAKA,EAAG,GAC5C28C,EAAK,KAAK,GAAK38C,EAAG,GAAK,KAAK,GAAKA,EAAG,GAAKA,EAAG,GAC9C08C,EAAKpsC,IAAIA,EAAKosC,GACdC,EAAKpsC,IAAIA,EAAKosC,GACdD,EAAKH,IAAIA,EAAKG,GACdC,EAAKH,IAAIA,EAAKG,EACrB,CAED,GAAIvD,EAAS,GAAK,CAAC,KAAK,SAEpB,GAAI,KAAK,WAAahjC,EAAE,SAAQ,EAAI,CAEhC,MAAMwmC,EAAO,KAAK,QAAQ,oBAAsB,KAAK,QAAQ,UAAY,KAAK,QAAQ,SACtF,GAAIA,EAAM,CAEN,MAAMC,EAAK,KAAK,IAAID,EAAK,CAAC,EAAGtsC,CAAE,EACzBwsC,EAAK,KAAK,IAAIF,EAAK,CAAC,EAAGrsC,CAAE,EAC/B,KAAK,SAAW,CACZssC,EACAC,EACA,KAAK,IAAIF,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAGL,CAAE,EAAIM,EAClC,KAAK,IAAID,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAGJ,CAAE,EAAIM,CAC9D,CACA,MACwB,KAAK,SAAW,CAACxsC,EAAIC,EAAIgsC,EAAKjsC,EAAIksC,EAAKjsC,CAAE,CAEjE,MAEoB,KAAK,SAAW,KAAK,QAAQ,oBAAsB,KAAK,QAAQ,UAAY,KAAK,QAAQ,SAWjG,GANI,KAAK,cACL,KAAK,iBAAmB,KAAK,cAE7B,KAAK,iBAAmB,KAAK,QAAQ,iBAGrC,KAAK,eAED,KAAK,cAAc,KAAK,OAAO,IAE3BksC,GACAnsC,EAAK,KAAK,IAAI,EAAG+rC,EAAQjmC,EAAE,GAAIimC,EAAQjmC,EAAE,GAAKkmC,EAAQlmC,EAAE,GAAIkmC,EAAQlmC,EAAE,EAAE,EAAIA,EAAE,GAC9EmmC,EAAK,KAAK,IAAI,EAAGF,EAAQjmC,EAAE,GAAIimC,EAAQjmC,EAAE,GAAKkmC,EAAQlmC,EAAE,GAAIkmC,EAAQlmC,EAAE,EAAE,EAAIA,EAAE,GAC9E7F,EAAK,KAAK,IAAI,EAAG8rC,EAAQjmC,EAAE,GAAIimC,EAAQjmC,EAAE,GAAKkmC,EAAQlmC,EAAE,GAAIkmC,EAAQlmC,EAAE,EAAE,EAAIA,EAAE,GAC9EomC,EAAK,KAAK,IAAI,EAAGH,EAAQjmC,EAAE,GAAIimC,EAAQjmC,EAAE,GAAKkmC,EAAQlmC,EAAE,GAAIkmC,EAAQlmC,EAAE,EAAE,EAAIA,EAAE,KAE9E9F,EAAK8F,EAAE,GACPmmC,EAAKnmC,EAAE,GAAKA,EAAE,GAAKimC,EACnB9rC,EAAK6F,EAAE,GACPomC,EAAKpmC,EAAE,GAAKA,EAAE,GAAKkmC,GAGnB,KAAK,eAAiBG,GAAY,KAAK,SAAW,GAAK,KAAK,SAAW,IAAI,CAC3E,MAAMC,EAAK,KAAK,GAAK18C,EAAG,GAAK,KAAK,GAAKA,EAAG,GAAKA,EAAG,GAC5C28C,EAAK,KAAK,GAAK38C,EAAG,GAAK,KAAK,GAAKA,EAAG,GAAKA,EAAG,GAC9C08C,EAAKpsC,IAAIA,EAAKosC,GACdC,EAAKpsC,IAAIA,EAAKosC,GACdD,EAAKH,IAAIA,EAAKG,GACdC,EAAKH,IAAIA,EAAKG,EACrB,CAIT,GAAI,KAAK,QAAQ,eAAiB,EAE9B,KAAK,aAAe,EAEhB,KAAK,sBACL,KAAK,oBAAsB,GAC3B,KAAK,QAAQ,sCAGbvD,EAAS,EAAG,CAEZ,KAAK,aAAe,EACpB,IAAI2D,EAAe,GA6CnB,IA1CI,CAAC,KAAK,yBAA2B,CAAC,KAAK,aAAe,CAAC,KAAK,YAAY,mBACpE,KAAK,WAAa,KAAK,SAAS,CAAC,GAAK,GAAK,KAAK,SAAS,CAAC,GAAK,GAE/D,KAAK,aAAe,IAGf,KAAK,SAAS,CAAC,EAAIR,GACnB,KAAK,SAAS,CAAC,EAAIC,GACnBlsC,EAAM,KAAK,SAAS,CAAC,EAAI,KAAK,SAAS,CAAC,GACxCC,EAAM,KAAK,SAAS,CAAC,EAAI,KAAK,SAAS,CAAC,KAEzC,KAAK,aAAe,GAGpB,KAAK,eACD,KAAK,WAAa,KAAK,qBAAwB,KAAK,UAAa8rC,GAASC,KAC1E,KAAK,aAAe,IAKhCS,EAAgB,KAAK,eAAiB,EACjCA,IAEG,KAAK,iBACLA,EAAe,EAAGR,EAAK,KAAK,SAAS,CAAC,EAAI,KAAK,iBAAiB,CAAC,GAC5DC,EAAK,KAAK,SAAS,CAAC,EAAI,KAAK,iBAAiB,CAAC,GAC/ClsC,EAAK,KAAK,SAAS,CAAC,EAAI,KAAK,SAAS,CAAC,EAAI,KAAK,iBAAiB,CAAC,GAClEC,EAAK,KAAK,SAAS,CAAC,EAAI,KAAK,SAAS,CAAC,EAAI,KAAK,iBAAiB,CAAC,GAEvEwsC,EAAe,EAAGR,EAAK,KAAK,SAAS,CAAC,EAAI,KACrCC,EAAK,KAAK,SAAS,CAAC,EAAI,KACxBlsC,EAAK,KAAK,SAAS,CAAC,EAAI,KAAK,SAAS,CAAC,EAAI,KAC3CC,EAAK,KAAK,SAAS,CAAC,EAAI,KAAK,SAAS,CAAC,EAAI,KAEhDwsC,GAAgB,KAAK,eAAiB,IAEtC,KAAK,aAAe,KAK5B,KAAK,sBAAwBA,EAG7B,GAFA,KAAK,oBAAsBA,EAEvB,KAAK,oBAAqB,CAW1B,KAAK,YAAc,GAEnB,MAAM3D,EAAS,KAAK,QAIpB,GAHA,KAAK,QAAU,EACf,KAAK,QAAQ,4BAET,KAAK,QAEL,OAAO,KAAK,SAGhB,KAAK,QAAUA,CAC3C,MAC4B,KAAK,QAAQ,4BAGxB,CAoBL,GAjBI,KAAK,sBAED,KAAK,WACL,KAAK,UAAU,CAAC,EAAIiD,EACpB,KAAK,UAAU,CAAC,EAAIC,GAEpB,KAAK,UAAY,CAAC,EAAG,EAAGD,EAAOC,CAAK,GAK5C,KAAK,SAAY,KAAK,QAAU,IAGhC,KAAK,QAAU,EACf,KAAK,YAAc,GAEf,KAAK,aAAe,EAAG,CAcvB,GAbI,KAAK,sBACD,KAAK,cAAc,aAInB,KAAK,eAAiB,KAAK,cAI3B,KAAK,eAAiB5B,GAAmB,UAI7C,KAAK,UACL,QAASrgD,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC9C,KAAK,UAAUA,CAAC,EAAE,OAAM,EAI5B,KAAK,sBACL,KAAK,eAAiB+b,EAE1C,SACoB,KAAK,UACL,QAAS/b,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC1C,KAAK,UAAUA,CAAC,EAAE,YAClB,KAAK,UAAUA,CAAC,EAAE,OAAM,GAGxB,KAAK,UAAUA,CAAC,EAAE,SAAW,KAAK,SAClC,KAAK,UAAUA,CAAC,EAAE,kBAAiB,GAM/C,KAAK,gBACL,KAAK,eAAe,KAAK,OAAO,CAEhD,MACgB,KAAK,IAAI,kBAAoB,IAAM,KAAK,kBAAoB,KAAK,IAAI,gBAErE,KAAK,IAAI,gBAAkB,GAE3B,KAAK,gBAAe,CAG/B,CAED,wBAAyB,CACrB,GAAI,KAAK,UAAY,EAAG,CACpB,MAAM+V,EAAI,KAAK,OAAO,KAAK,QAAQ,CAAC,EAChCA,IAAM,KAAK,KACX,KAAK,UAAaA,EAAI,KAAK,GAC3B,KAAK,GAAKA,EAEjB,CACD,GAAI,KAAK,UAAY,EAAG,CACpB,MAAMC,EAAI,KAAK,OAAO,KAAK,QAAQ,CAAC,EAChCA,IAAM,KAAK,KACX,KAAK,UAAaA,EAAI,KAAK,GAC3B,KAAK,GAAKA,EAEjB,CAED,IAAI2sC,EAAc,GAClB,GAAI,KAAK,UAAY,EAAG,CACpB,MAAMp6B,EAAI,KAAK,OAAO,KAAK,QAAQ,CAAC,EAChCA,IAAM,KAAK,KACX,KAAK,GAAKA,EACVo6B,EAAc,GAErB,CACD,GAAI,KAAK,UAAY,EAAG,CACpB,MAAMn6B,EAAI,KAAK,OAAO,KAAK,QAAQ,CAAC,EAChCA,IAAM,KAAK,KACX,KAAK,GAAKA,EACVm6B,EAAc,GAErB,CAEGA,IAEA,KAAK,sBAAqB,EAE1B,KAAK,QAAQ,oBAAoB,KAAK,GAAI,KAAK,EAAE,EAExD,CAED,mBAAoB,CAGhB,GAAI,KAAK,eAAiB,GAAK,KAAK,eAAe,MAAQ,IAGvD,KAAK,aAAe,EAEhB,KAAK,sBACL,KAAK,oBAAsB,GAC3B,KAAK,QAAQ,8BAGb,KAAK,WACL,QAAS3iD,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC9C,KAAK,UAAUA,CAAC,EAAE,kBAAiB,CAIlD,CAED,iBAAkB,CACd,GAAI,KAAK,aAAgB,KAAK,eAAiB,IAC3C,KAAK,iBAAmB,KAAK,IAAI,kBAE7B,KAAK,WACL,QAASA,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC9C,KAAK,UAAUA,CAAC,EAAE,gBAAe,CAIhD,CAED,eAAgB,CAOZ,GANA,KAAK,kBAAoB,EAErB,KAAK,QACL,KAAK,qBAAoB,EAGzB,KAAK,aAAe,GAAK,KAAK,eAAe,MAAO,CACpD,IAAI4iD,EAAc,KAAK,YASvB,GAPK,KAAK,eAAiB,GAAM,KAAK,0BAClCA,EAAY,UAAU,KAAK,aAAc,KAAK,YAAY,EAC1DA,EAAY,WAAW,KAAK,QAAQ,EACpC,KAAK,YAAY,QAAQ,IAAI,GAI7B,KAAK,UACL,GAAI,KAAK,eACL,QAAS5iD,EAAI,EAAGsK,EAAI,KAAK,kBAAkB,OAAQtK,EAAIsK,EAAGtK,IACtD,KAAK,kBAAkBA,CAAC,EAAE,OAAM,MAGpC,SAASA,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC1C,KAAK,UAAUA,CAAC,EAAE,UAAY,GAE9B,KAAK,UAAUA,CAAC,EAAE,OAAM,CAM3C,CACJ,CAED,iBAAkB,CACd,MAAM6iD,EAAmB,KAAK,kBAW9B,GANA,KAAK,kBAAoB,EAErB,KAAK,QACL,KAAK,qBAAoB,EAGzB,KAAK,aAAe,GAAK,KAAK,eAAe,MAAO,CACpD,IAAID,EAAc,KAAK,YAEnBE,EAAqB,GACrBC,EACAC,EACJ,GAAI,KAAK,oBAAqB,CAC1B,GAAI,KAAK,KAAO,GAAK,KAAK,KAAO,EAE7B,OACG,GAAI,CAAC,KAAK,YAAY,iBAAgB,GAAOH,GAAoB,GAoDpE,GAlDA,KAAK,IAAI,uBAETD,EAAY,UAAUA,EAAY,cAAe,IAAI,EAErDI,EAAwBJ,EAAY,kBAEpCG,EAAoB,CAChB,cAAe,KACf,OAAQ,EACR,EAAG,KAAK,GACR,EAAG,KAAK,GACR,MAAO,GACP,QAAS,GACT,OAAQ,GACR,MAAO,EAC/B,GAEwB,KAAK,YAAY,oBAAuB,CAACH,EAAY,qBAAwBC,EAAmB,KAiBhGE,EAAkB,MAAQ,GAC1BH,EAAY,oBAAsB,IAGjC,KAAK,YAAY,oBAMlB,KAAK,YAAY,uBAGrBA,EAAY,qBAAqBG,CAAiB,EAClDH,EAAY,WAAW,IAAI,EAEvB,KAAK,wBAAyB,CAC9B,IAAI7mC,EAAI,KAAK,eAGb,KAAK,eAAiBskC,GAAmB,SAGzC,KAAK,YAAY,QAAQ,IAAI,EAE7B,KAAK,eAAiBtkC,CACzB,OAED+mC,EAAqB,EAEzC,MACqB,KAAK,eAAiB,GAAM,KAAK,0BAClCF,EAAY,UAAU,KAAK,aAAc,KAAK,YAAY,EAC1DA,EAAY,WAAW,KAAK,QAAQ,EACpC,KAAK,YAAY,QAAQ,IAAI,GAKrC,GAAIE,GAAsB,KAAK,UAC3B,GAAI,KAAK,eACL,QAAS9iD,EAAI,EAAGsK,EAAI,KAAK,kBAAkB,OAAQtK,EAAIsK,EAAGtK,IACtD,KAAK,kBAAkBA,CAAC,EAAE,OAAM,MAGpC,SAASA,EAAI,EAAGsK,EAAI,KAAK,UAAU,OAAQtK,EAAIsK,EAAGtK,IAC1C,KAAK,UAAUA,CAAC,EAAE,UAAY,GAE9B,KAAK,UAAUA,CAAC,EAAE,OAAM,EAMxC,GAAI,KAAK,oBAAqB,CAC1B,IAAIijD,EAAsB,GAkC1B,GAjCIH,IAEAF,EAAY,sBAAqB,EAIjC,KAAK,YAAY,MAAQG,EAAkB,MAEvCA,EAAkB,MAIlB,KAAK,YAAY,uBACVA,EAAkB,eAEzB,KAAK,YAAY,4BAA4BA,EAAkB,aAAa,EAE5EA,EAAkB,OAAS,KAEvB,KAAK,YAAY,qBAEjB,KAAK,YAAY,uBAGrBA,EAAkB,cAAgB,KAAK,YAAY,iBAAgB,GAIvEH,EAAY,qBAAqBI,CAAqB,EAEtDC,EAAsB,IAGtB,CAAC,KAAK,YAAY,MAAO,CACzB,IAAI/C,EAAgB,KAAK,YAAY,iBAAgB,EASrD,GARI+C,IACI/C,IAEAA,EAAc,OAAS0C,EAAY,MAAM,cAE7C,KAAK,YAAY,uBAGjB,CAAC,KAAK,YAAY,gBAAiB,CAEnCA,EAAY,UAAU,KAAK,aAAc,KAAK,YAAY,EAC1DA,EAAY,WAAW,KAAK,QAAQ,EAGpC,MAAMtT,EAAQ,CAACyT,GAAqBA,EAAkB,MAEtDH,EAAY,cAAc,KAAK,YAAatT,CAAK,EACjD,KAAK,gBAAe,EACf,KAAK,YAAY,UAAU,KAAK,aAAY,EACjD,KAAK,YAAY,QAAQ,KAAM,EAAI,EAC9B,KAAK,YAAY,UAAU,KAAK,eAAc,EACnD,KAAK,kBAAiB,EACtBsT,EAAY,cAAc,IAAI,CACjC,CACJ,CACJ,CAEGG,GAAqBA,EAAkB,QAEvCH,EAAY,oBAAsB,GAEzC,CACJ,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,sBAAuB,CAUnB,MAAMt4C,EAAI,KAAK,kBAAkB,OACjC,IAAI44C,EAAM,EACV,MAAM7gD,EAAI,KAAK,kBAGTC,EAAI,GACV,QAAStC,EAAI,EAAGA,EAAIsK,EAAGtK,IACfqC,EAAErC,CAAC,EAAE,WAAa,OACdqC,EAAErC,CAAC,EAAE,cACLsC,EAAE,KAAKD,EAAErC,CAAC,CAAC,GAEPkjD,IAAQljD,IACRqC,EAAE6gD,CAAG,EAAI7gD,EAAErC,CAAC,GAEhBkjD,MAKZ,MAAMznC,EAAInZ,EAAE,OACZ,GAAImZ,EAAG,CACH,QAASpQ,EAAI,EAAGA,EAAIoQ,EAAGpQ,IACnB/I,EAAE+I,CAAC,EAAE,cAAgB,GAGzB/I,EAAE,KAAK89C,GAAY,oBAAoB,EACvC,MAAM91C,EAAI44C,EACV,GAAK54C,EAWE,CACHjI,EAAE,OAAOiI,CAAC,EAC1B,EACA,CAAgBjI,EAAE,KAAK+9C,GAAY,oBAAoB,EAEvC8C,EAAM,EACN,IAAIljD,EAAI,EACJqL,EAAI,EACR,MAAM83C,EAAc,GACpB,EAAG,CAGC,MAAMja,GAFK7mC,EAAErC,CAAC,EAAE,UAAYsC,EAAE+I,CAAC,EAAE,QAAUhJ,EAAErC,CAAC,EAAE,iBAAmBsC,EAAE+I,CAAC,EAAE,iBAAmBhJ,EAAErC,CAAC,EAAE,QAAUsC,EAAE+I,CAAC,EAAE,SAE/F,EAAI/I,EAAE+I,GAAG,EAAIhJ,EAAErC,GAAG,EAMlC,IAJIkjD,IAAQ,GAAMC,EAAYD,EAAM,CAAC,IAAMha,KACvCia,EAAYD,GAAK,EAAIha,GAGrBlpC,GAAKsK,EAAG,CACR,EAAG,CACC,MAAM4+B,EAAM5mC,EAAE+I,GAAG,GACb63C,IAAQ,GAAMC,EAAYD,EAAM,CAAC,IAAMha,KACvCia,EAAYD,GAAK,EAAIha,EAErD,OAAiC79B,EAAIoQ,GACb,KACxB,SAA+BpQ,GAAKoQ,EAAG,CACf,EAAG,CACC,MAAMytB,EAAM7mC,EAAErC,GAAG,GACbkjD,IAAQ,GAAMC,EAAYD,EAAM,CAAC,IAAMha,KACvCia,EAAYD,GAAK,EAAIha,EAErD,OAAiClpC,EAAIsK,GACb,KACH,CACJ,OAAQ,IAET,KAAK,kBAAoB64C,CAC5B,KAjDO,CACJD,EAAM,EACN,IAAI73C,EAAI,EACR,GACIhJ,EAAE6gD,GAAK,EAAI5gD,EAAE+I,GAAG,QACXA,EAAIoQ,GAETpZ,EAAE,OAAS6gD,GAEX7gD,EAAE,OAAO6gD,CAAG,CAEhC,CAuCA,MACgB7gD,EAAE,OAAS6gD,GAEX7gD,EAAE,OAAO6gD,CAAG,EAIpB,KAAK,OAAS,EACjB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,iBACf,CAED,IAAI,YAAa,CACb,OAAK,KAAK,cACN,KAAK,YAAc,IAAIlD,GAAkB,IAAI,GAE1C,KAAK,WACf,CAED,iBAAkB,CACd,IAAIz3B,EAAI,KAAK,cAEb,MAAO,CACHA,EAAE,GACFA,EAAE,GACFA,EAAE,GAAK,KAAK,GAAKA,EAAE,GACnBA,EAAE,GAAK,KAAK,GAAKA,EAAE,GACnBA,EAAE,GAAK,KAAK,GAAKA,EAAE,GAAK,KAAK,GAAKA,EAAE,GACpCA,EAAE,GAAK,KAAK,GAAKA,EAAE,GAAK,KAAK,GAAKA,EAAE,GACpCA,EAAE,GAAK,KAAK,GAAKA,EAAE,GACnBA,EAAE,GAAK,KAAK,GAAKA,EAAE,EAC/B,CACK,CAED,uBAAuB66B,EAAMC,EAAM,CAC/B,IAAItnC,EAAI,KAAK,eACb,MAAO,CACHA,EAAE,GAAKA,EAAE,GAAKqnC,EAAOrnC,EAAE,GAAKsnC,EAC5BtnC,EAAE,GAAKA,EAAE,GAAKqnC,EAAOrnC,EAAE,GAAKsnC,CACxC,CACK,CAED,kBAAkBD,EAAMC,EAAM,CAC1B,IAAI96B,EAAI,KAAK,eACb,MAAO,CACHA,EAAE,GAAKA,EAAE,GAAK66B,EAAO76B,EAAE,GAAK86B,EAC5B96B,EAAE,GAAKA,EAAE,GAAK66B,EAAO76B,EAAE,GAAK86B,CACxC,CACK,CAED,eAAettC,EAAGC,EAAGjN,EAAU,CAE3B,GAAI,KAAK,eAAe,QAAU,EAclC,IAVI,KAAK,QAAQgN,EAAGC,CAAC,IACb,KAAK,SACD,KAAK,aACLjN,EAAS,KAAK,IAAI,EAGtBA,EAAS,KAAK,IAAI,GAItB,KAAK,UAAW,CAChB,MAAMsC,EAAI,KAAK,UAAU,OACzB,QAASrL,EAAI,EAAGA,EAAIqL,EAAGrL,IACnB,KAAK,UAAUA,CAAC,EAAE,eAAe+V,EAAGC,EAAGjN,CAAQ,CAEtD,CAED,OAAOA,EAAS,KAAKq3C,GAAY,oBAAoB,EACxD,CAED,QAAQkD,EAAIC,EAAI,CACZ,MAAM7+C,EAAI,KAAK,kBACf,OAAO4+C,EAAK5+C,EAAE,CAAC,GAAK4+C,EAAK5+C,EAAE,CAAC,GAAK6+C,EAAK7+C,EAAE,CAAC,GAAK6+C,EAAK7+C,EAAE,CAAC,CACzD,CAED,WAAY,CACR,MAAM8+C,EAAK,KAAK,SACV9+C,EAAI,KAAK,kBAEf,OAAOA,EAAE,CAAC,GAAK8+C,EAAG,CAAC,GAAK9+C,EAAE,CAAC,GAAK8+C,EAAG,CAAC,EAAIA,EAAG,CAAC,GAAK9+C,EAAE,CAAC,GAAK8+C,EAAG,CAAC,GAAK9+C,EAAE,CAAC,GAAK8+C,EAAG,CAAC,EAAIA,EAAG,CAAC,CACzF,CAED,IAAI,QAAS,CACT,YAAK,cAAa,EACX,KAAK,OACf,CAED,IAAI,MAAO,CACP,OAAO,KAAK,QAAU,KAAK,QAAQ,KAAO,IAC7C,CAED,IAAI,KAAKp+C,EAAG,CACR,KAAK,OAAO,KAAOA,CACtB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,QAAU,KAAK,QAAQ,SAAW,IACjD,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,OAAO,SAAWA,CAC1B,CAED,YAAa,CACT,MAAO,CAAC,CAAC,KAAK,SAAW,KAAK,QAAQ,mBACzC,CAED,iBAAkB,CACd,MAAO,CAAC,CAAC,KAAK,SAAW,KAAK,QAAQ,eACzC,CAED,kBAAmB,CACf,KAAK,cAAa,CACrB,CAED,eAAgB,CACP,KAAK,UACN,KAAK,QAAU,IAAIo5C,GAAW,IAAI,EAEzC,CAED,mBAAoB,CAChB,KAAK,wBAAuB,CAC/B,CAED,eAAgB,CACZ,OAAQ,KAAK,SAAW,KAAK,QAAQ,UAAS,CACjD,CAED,UAAUzoC,EAAGC,EAAGuS,EAAGC,EAAG,CAClB,KAAK,EAAIzS,EACT,KAAK,EAAIC,EACT,KAAK,kBAAkBuS,EAAGC,CAAC,CAC9B,CAED,eAAgB,CACZ,KAAK,WAAW,GAAG,CACtB,CAED,yBAA0B,CACtB,KAAK,WAAW,CAAC,CACpB,CAEL,CAEA,MAAM63B,EAAmB,CAErB,aAAc,CACV,KAAK,MAAQ,EAEb,KAAK,GAAK,EACV,KAAK,GAAK,EAEV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,CACb,CAED,YAAa,CACT,OAAO,KAAK,QAAU,GAClB,KAAK,KAAO,GACZ,KAAK,KAAO,GACZ,KAAK,KAAO,GACZ,KAAK,KAAO,GACZ,KAAK,KAAO,GACZ,KAAK,KAAO,CACnB,CAED,UAAW,CACP,OAAO,KAAK,KAAO,GAAK,KAAK,KAAO,CACvC,CAEL,CAEAA,GAAmB,SAAW,IAAIA,GAClCD,GAAY,qBAAuB,SAAU/9C,EAAGC,EAAG,CAC/C,OAAQD,EAAE,UAAYC,EAAE,QAAUD,EAAE,iBAAmBC,EAAE,iBAAmBD,EAAE,QAAUC,EAAE,OAC9F,EC7sEe,MAAMiN,CAAa,CAE9B,aAAc,CAEV,KAAK,mBAAqB,EAC7B,CAED,GAAGxB,EAAMtK,EAAU,CACV,KAAK,qBACN,KAAK,eAAiB,CAAE,EACxB,KAAK,gBAAkB,CAAE,EACzB,KAAK,mBAAqB,IAGd,KAAK,eAAesK,CAAI,EAIhC,KAAK,eAAeA,CAAI,IAAMwB,EAAa,UAC3C,KAAK,gBAAgBxB,CAAI,EAAI,CAAC,KAAK,eAAeA,CAAI,EAAGtK,CAAQ,EACjE,KAAK,eAAesK,CAAI,EAAIwB,EAAa,UAEzC,KAAK,gBAAgBxB,CAAI,EAAE,KAAKtK,CAAQ,EAN5C,KAAK,eAAesK,CAAI,EAAItK,CASnC,CAED,KAAKsK,EAAMtK,EAAU,CACjB,MAAMggD,EAAU,CAACC,EAAMC,EAAMC,IAAS,CAClCngD,EAASigD,EAAMC,EAAMC,CAAI,EACzB,KAAK,IAAI71C,EAAM01C,CAAO,CACzB,EACDA,EAAQ,eAAiBhgD,EACzB,KAAK,GAAGsK,EAAM01C,CAAO,CACxB,CAED,IAAI11C,EAAMtK,EAAU,CAChB,GAAI,KAAK,mBAAoB,CACzB,MAAMG,EAAU,KAAK,eAAemK,CAAI,EACxC,GAAInK,GACA,GAAIA,IAAY2L,EAAa,SAAU,CACnC,MAAMsoB,EAAY,KAAK,gBAAgB9pB,CAAI,EAC3C,UAAWzG,KAAKuwB,EACZ,GAAIvwB,IAAM7D,GAAY6D,EAAE,gBAAkB7D,EACtC,MAAO,EAGlB,SAAU,KAAK,eAAesK,CAAI,IAAMtK,GAAY,KAAK,eAAesK,CAAI,EAAE,iBAAmBtK,EAC9F,MAAO,GAGlB,CACD,MAAO,EACV,CAED,IAAIsK,EAAMtK,EAAU,CAChB,GAAI,KAAK,mBAAoB,CACzB,MAAMG,EAAU,KAAK,eAAemK,CAAI,EACxC,GAAInK,EACA,GAAIA,IAAY2L,EAAa,SAAU,CACnC,MAAMsoB,EAAY,KAAK,gBAAgB9pB,CAAI,EAC3C,IAAI3D,EAAQytB,EAAU,QAAQp0B,CAAQ,EAClC2G,GAAS,GACTytB,EAAU,OAAOztB,EAAO,CAAC,EAE7BA,EAAQytB,EAAU,IAAKvwB,GAAMA,EAAE,cAAc,EAAE,QAAQ7D,CAAQ,EAC3D2G,GAAS,GACTytB,EAAU,OAAOztB,EAAO,CAAC,EAEzBytB,EAAU,SAAW,IACrB,KAAK,eAAe9pB,CAAI,EAAI8pB,EAAU,CAAC,EACvC,KAAK,gBAAgB9pB,CAAI,EAAI,OAEpC,MAAU,KAAK,eAAeA,CAAI,IAAMtK,GAAY,KAAK,eAAesK,CAAI,EAAE,iBAAmBtK,KAC9F,KAAK,eAAesK,CAAI,EAAI,OAGvC,CACJ,CAED,eAAeA,EAAMtK,EAAU,CAC3B,KAAK,IAAIsK,EAAMtK,CAAQ,CAC1B,CAED,KAAKsK,EAAM21C,EAAMC,EAAMC,EAAM,CACzB,GAAI,KAAK,mBAAoB,CACzB,MAAM9J,EAAO,KAAK,eAAe/rC,CAAI,EACjC+rC,IACIA,IAASvqC,EAAa,SACtBuqC,EAAK,KAAM/rC,EAAM21C,EAAMC,EAAMC,CAAI,EAEjC9J,EAAK4J,EAAMC,EAAMC,CAAI,EAGhC,CACJ,CAED,cAAc71C,EAAM,CAChB,GAAI,KAAK,mBAAoB,CACzB,MAAM+rC,EAAO,KAAK,eAAe/rC,CAAI,EACrC,GAAI+rC,EACA,OAAIA,IAASvqC,EAAa,SACf,KAAK,gBAAgBxB,CAAI,EAAE,OAE3B,CAGlB,CACD,MAAO,EACV,CAED,mBAAmBA,EAAM,CACjB,KAAK,qBACL,OAAO,KAAK,eAAeA,CAAI,EAC/B,OAAO,KAAK,gBAAgBA,CAAI,EAEvC,CAEL,CAEAwB,EAAa,SAAW,SAASs0C,EAAQ91C,EAAM21C,EAAMC,EAAMC,EAAM,CAC7D,MAAM/rB,EAAYgsB,EAAO,gBAAgB91C,CAAI,EAC7C,GAAI8pB,EAGA,UAAWp0B,IAAY,CAAC,GAAGo0B,CAAS,EAChCp0B,EAASigD,EAAMC,EAAMC,CAAI,CAGrC,EAEAr0C,EAAa,WAAa,SAASu0C,EAAK,CACpCA,EAAI,UAAU,GAAKv0C,EAAa,UAAU,GAC1Cu0C,EAAI,UAAU,KAAOv0C,EAAa,UAAU,KAC5Cu0C,EAAI,UAAU,IAAMv0C,EAAa,UAAU,IAC3Cu0C,EAAI,UAAU,IAAMv0C,EAAa,UAAU,IAC3Cu0C,EAAI,UAAU,eAAiBv0C,EAAa,UAAU,eACtDu0C,EAAI,UAAU,KAAOv0C,EAAa,UAAU,KAC5Cu0C,EAAI,UAAU,cAAgBv0C,EAAa,UAAU,cACrDu0C,EAAI,UAAU,mBAAqBv0C,EAAa,UAAU,kBAC9D,EC9Ie,MAAMw0C,EAAO,CAExB,YAAYC,EAAa,CACrB,KAAK,aAAe,GAEpB,KAAK,IAAMA,EAMX,KAAK,UAAY,IAAI,GACxB,CAED,OAAO,OAAOrtC,EAAOvR,EAAG,CACpB,IAAI2R,EACJ,GAAIkiC,EAAM,gBAAgB7zC,CAAC,EACnBA,EAAE,KACF2R,EAASJ,EAAM,SAAS,aAAaA,EAAM,IAAKvR,CAAC,EAEjD2R,EAAS,KAAK,OAGdA,GACA6iC,GAAK,YAAY7iC,EAAQ3R,CAAC,UAEvBA,IAAM,KACb2R,EAASJ,EAAM,IAAI,YAAY,sBACxBvR,IAAM,OACb2R,EAAS,aAEL3R,EAAE,SACGuR,EAAM,SAAS,kBAAkBvR,EAAE,WAAW,IAC/C,QAAQ,MAAM,iCAAiC,EAC/CA,EAAI,MAER2R,EAAS3R,MACN,CACH,QAAQ,MAAM,2CAA2C,EACzD,MACH,CAGL,OAAO2R,CACV,CAED,OAAO,UAAW,CAEjB,CAED,OAAO,QAAS,CAEf,CAED,WAAWkpC,EAAa,CACpB,KAAK,UAAU,IAAIA,CAAW,CACjC,CAED,cAAcA,EAAa,CACvB,KAAK,UAAU,OAAOA,CAAW,EAC5B,KAAK,WACN,KAAK,QAAO,CAEnB,CAED,QAAS,CACL,KAAK,UAAU,QAAQA,GAAe,CAClCA,EAAY,oBAAoB,CAAC,CAC7C,CAAS,CACJ,CAED,MAAMzwC,EAAU,CACZoqC,GAAK,YAAY,KAAMpqC,CAAQ,CAClC,CAED,YAAa,CAGT,MAAO,EACV,CAED,UAAW,CAGP,MAAO,EACV,CAED,SAAU,CAET,CAED,IAAI,UAAW,CACX,MAAO,EACV,CACL,CCjGe,MAAM0P,EAAQ,CAKzB,YAAYvI,EAAO,CACf,KAAK,MAAQA,EAEb,KAAK,QAAU,KAAK,MAAM,eAE1B,KAAK,GAAKuI,GAAQ,KAMlB,KAAK,SAAW,IAAI,IAMpB,KAAK,aAAe,EAOpB,KAAK,QAAU,KASf,KAAK,YAAc,KAMnB,KAAK,GAAK,EAMV,KAAK,GAAK,EAMV,KAAK,GAAK,EAMV,KAAK,GAAK,EAOV,KAAK,WAAa,EAOlB,KAAK,GAAK,EAOV,KAAK,GAAK,EAMV,KAAK,SAAW,GAOhB,KAAK,YAAc,EAEtB,CAED,IAAI,QAAS,CACT,OAAI,KAAK,aAAe,KAAK,MAAM,uBAAuB,IAAI,KAC1D,KAAK,qBAAqB,EAAI,EAC9B,KAAK,MAAM,0BAA0B,IAAI,GAEtC,KAAK,OACf,CAED,WAAW9Z,EAAG,CACL,KAAK,SAAS,IAAIA,CAAC,IACpB,KAAK,SAAS,IAAIA,CAAC,EAEf,KAAK,SAAS,OAAS,GACnB,KAAK,SACL,KAAK,QAAQ,WAAW,IAAI,EAIhCA,EAAE,QACF,KAAK,eAAc,EAG9B,CAED,cAAcA,EAAG,CACT,KAAK,SAAS,OAAOA,CAAC,IAClB,KAAK,SAAS,OAAS,GACnB,KAAK,SACL,KAAK,QAAQ,cAAc,IAAI,EAInCA,EAAE,QACF,KAAK,eAAc,EAG9B,CAED,gBAAiB,CAEE,KAAK,QAGhB,KAAK,oCAAmC,EAG5C,KAAK,eACD,KAAK,eAAiB,GACtB,KAAK,YAAW,CAEvB,CAED,gBAAiB,CACE,KAAK,OACpB,KAAK,eACA,KAAK,cACN,KAAK,cAAa,CAEzB,CAED,aAAc,CACN,KAAK,QACL,KAAK,OAAO,uBAEnB,CAED,QAAS,CACD,KAAK,aACL,KAAK,iBAAgB,EAGzB,KAAK,SAAS,QAAQqxB,GAAW,CACzBA,EAAQ,QACRA,EAAQ,sBAAqB,CAE7C,CAAS,CACJ,CAED,qCAAsC,CAIlC,MAAMhxB,EAAS,KAAK,OACpB,GAAKA,EAAO,WAMJ,KAAK,aACL,KAAK,iBAAgB,MAPL,CACpB,MAAMw+C,EAAW,KAAK,4BAClBA,GAAYA,EAAS,SAAU,GAAKA,IAAax+C,GACjD,KAAK,sBAAsBw+C,CAAQ,CAEnD,CAKK,CAED,eAAgB,CACR,KAAK,QACL,KAAK,OAAO,uBAEnB,CAED,QAAS,CACL,OAAO,KAAK,aAAe,CAC9B,CAMD,cAAe,CAEX,OAAO,IACV,CAmBD,kBAAmB,CACf,MAAM,IAAI,MAAM,uCAAuC,CAC1D,CAED,IAAI,SAAU,CACV,OAAO,KAAK,aACf,CAMD,aAAc,CACV,MAAO,EACV,CAKD,UAAW,CAEH,KAAK,SACL,KAAK,cAAa,EAElB,KAAK,YAAc,EAE1B,CAED,eAAgB,CAIZ,KAAK,MAAM,uBAAuB,IAAI,CACzC,CAED,qBAAqBhsB,EAAQ,GAAO,CAGhC,GAAIA,GAAS,KAAK,SAAU,CACxB,KAAK,YAAc,GACnB,IAAIxyB,EAAS,KAAK,oBAClB,KAAK,sBAAsBA,CAAM,CACpC,CACJ,CAED,mBAAoB,CAChB,IAAIA,EAAS,KACb,GAAI,KAAK,cAAe,CACpB,MAAMy+C,EAAW,KAAK,eACtBz+C,EAAS,KAAK,0BAA0By+C,CAAQ,EAC3Cz+C,IACDA,EAAS,KAAK,QAAQ,iBAAiB,KAAK,iBAAgB,EAAIy+C,CAAQ,EAE/E,CACD,OAAOz+C,CACV,CAED,0BAA0By+C,EAAW,KAAK,eAAgB,CACtD,OAAI,KAAK,eACDA,EACO,KAAK,QAAQ,yBAAyBA,CAAQ,EAGtD,IACV,CAED,sBAAsBC,EAAY,KAAM,CACpC,IAAIC,EAAY,KAAK,QA2BrB,GAzBA,KAAK,QAAUD,EAEX,KAAK,SAAS,OACVC,IACI,KAAK,cACLA,EAAU,sBAAqB,EAGnCA,EAAU,cAAc,IAAI,EAGzB,KAAK,MAAW,CAACA,EAAU,OAAM,GAChC,KAAK,QAAQ,kBAAkBA,CAAS,GAI5CD,IAEAA,EAAU,WAAW,IAAI,EACrB,KAAK,cACLA,EAAU,sBAAqB,IAKvC,KAAK,SACL,GAAIA,EACA,GAAIA,EAAU,WAGN,KAAK,aACL,KAAK,iBAAgB,EAGzB,KAAK,SAAS,QAAQ1tB,GAAW,CACzBA,EAAQ,QACRA,EAAQ,qBAAqB,IAAI,CAE7D,CAAqB,MACE,CACH,MAAM4tB,EAAYF,EAAU,UACxBE,GACA,KAAK,SAAS,QAAQ5tB,GAAW,CACzBA,EAAQ,QACRA,EAAQ,yBAAyB4tB,CAAS,CAE1E,CAAyB,CAER,MAED,KAAK,SAAS,QAAQ5tB,GAAW,CACzBA,EAAQ,QACRA,EAAQ,qBAAqB,IAAI,CAEzD,CAAiB,CAGZ,CAED,MAAO,CAEC,KAAK,SACA,KAAK,YACN,KAAK,OAAO,KAAK,EAAI,EAGhC,CAED,UAAW,CACP,OAAO,KAAK,SAAW,KAAK,QAAQ,SAAQ,CAC/C,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,SAAW,KAAK,QAAQ,SACvC,CAED,MAAO,CACC,KAAK,SACL,KAAK,QAAQ,MAEpB,CAED,IAAI,WAAW,CAAC,KAAA/2B,EAAO,QAAS,EAAA6oB,EAAI,EAAG,EAAAC,EAAI,EAAG,MAAA87B,EAAQ,GAAK,MAAAC,EAAQ,EAAG,EAAG,CACrE,KAAK,YAAc,CAAC,KAAA7kD,EAAM,EAAA6oB,EAAG,EAAAC,EAAG,MAAA87B,EAAO,MAAAC,CAAK,EACxC,KAAK,YACL,KAAK,iBAAgB,CAE5B,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,kBAAmB,CACf,KAAK,YAAc,IACtB,CAED,kBAAmB,CACX,KAAK,YAAY,OAAS,QAC1B,KAAK,kBAAiB,EACf,KAAK,YAAY,OAAS,WACjC,KAAK,oBAAmB,EAE5B,KAAK,iBAAgB,EACrB,KAAK,gBAAe,CACvB,CAED,mBAAoB,CAChB,MAAMC,EAAS,KAAK,YAAY,EAAI,KAAK,QAAQ,EAC3CC,EAAS,KAAK,YAAY,EAAI,KAAK,QAAQ,EACjD,IAAIpX,EAAQ,KAAK,IAAImX,EAAQC,CAAM,EACnC,GAAKpX,EAEL,IADA,KAAK,WAAa,EAAEA,EAChBmX,GAAUA,EAASnX,EAAO,CAC1B,MAAMqX,EAAc,KAAK,WAAa,KAAK,YAAY,EACjDC,EAAmB,KAAK,QAAQ,EAAID,EAC1C,KAAK,GAAKC,EAAmB,KAAK,YAAY,MAC9C,KAAK,GAAK,KAAK,QAAQ,EAAIA,CAC9B,CACD,GAAIF,GAAUA,EAASpX,EAAO,CAC1B,MAAMqX,EAAc,KAAK,WAAa,KAAK,YAAY,EACjDC,EAAmB,KAAK,QAAQ,EAAID,EAC1C,KAAK,GAAKC,EAAmB,KAAK,YAAY,MAC9C,KAAK,GAAK,KAAK,QAAQ,EAAIA,CAC9B,EACJ,CAED,qBAAsB,CAClB,MAAMH,EAAS,KAAK,YAAY,EAAI,KAAK,QAAQ,EAC3CC,EAAS,KAAK,YAAY,EAAI,KAAK,QAAQ,EACjD,IAAIpX,EAAQmX,GACR,CAACnX,GAASoX,EAASpX,KACnBA,EAAQoX,GAEPpX,IACL,KAAK,WAAa,EAAEA,EACvB,CAED,eAAet3B,EAAGC,EAAGuS,EAAGC,EAAG,CACvB,KAAK,iBAAgB,EAErBzS,GAAK,KAAK,WACVC,GAAK,KAAK,WACVuS,GAAK,KAAK,WACVC,GAAK,KAAK,YACN,KAAK,KAAOzS,GAAK,KAAK,KAAOC,GAAK,KAAK,KAAOuS,GAAK,KAAK,KAAOC,KAC/D,KAAK,GAAKzS,EACV,KAAK,GAAKC,EACV,KAAK,GAAKuS,EACV,KAAK,GAAKC,EAEV,KAAK,gBAAgB,EAAI,EAEhC,CAED,iBAAkB,CACd,KAAK,iBAAgB,GAEjB,KAAK,IAAM,KAAK,IAAM,KAAK,IAAM,KAAK,MACtC,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEV,KAAK,gBAAe,EAE3B,CAED,iBAAkB,CACd,KAAK,SAAW,CAAC,EAAE,KAAK,IAAM,KAAK,IAAM,KAAK,IAAM,KAAK,IAEzD,IAAIo8B,EAAO,KACX,KAAK,SAAS,QAAQ,SAASnuB,EAAS,CAEhCA,EAAQ,mBAAqBmuB,GAC7BnuB,EAAQ,kCAAiC,CAEzD,CAAS,CACJ,CAED,kBAAmB,CACf,IAAImuB,EAAO,KACX,KAAK,SAAS,QAAQ,SAASnuB,EAAS,CAEhCA,EAAQ,mBAAqBmuB,GAC7BnuB,EAAQ,mBAAkB,CAE1C,CAAS,CACJ,CAED,gBAAiB,CACb,IAAIouB,EAAc,GAClB,OAAAA,EAAY,KAAU,KAAK,YAAY,KACnC,KAAK,IAAM,IAAGA,EAAY,EAAO,KAAK,GACtC,KAAK,IAAM,IAAGA,EAAY,EAAO,KAAK,GACtC,KAAK,IAAM,IAAGA,EAAY,EAAO,KAAK,GACtC,KAAK,IAAM,IAAGA,EAAY,EAAO,KAAK,GACtC,KAAK,YAAc,IAAGA,EAAY,UAAe,KAAK,WACnDA,CACV,CAED,IAAI,IAAK,CACL,OAAO,KAAK,EACf,CAED,IAAI,IAAK,CACL,OAAO,KAAK,EACf,CAED,IAAI,IAAK,CACL,OAAO,KAAK,EACf,CAED,IAAI,IAAK,CACL,OAAO,KAAK,EACf,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,GAAK,KAAK,UACzB,CACD,IAAI,EAAEz/C,EAAG,CACL,KAAK,iBAAgB,EACrBA,EAAIA,EAAI,KAAK,WACT,KAAK,KAAOA,IACZ,KAAK,GAAKA,EACV,KAAK,gBAAe,EAE3B,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,GAAK,KAAK,UACzB,CACD,IAAI,EAAEA,EAAG,CACL,KAAK,iBAAgB,EACrBA,EAAIA,EAAI,KAAK,WACT,KAAK,KAAOA,IACZ,KAAK,GAAKA,EACV,KAAK,gBAAe,EAE3B,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,GAAK,KAAK,UACzB,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,iBAAgB,EACrBA,EAAIA,EAAI,KAAK,WACT,KAAK,KAAOA,IACZ,KAAK,GAAKA,EACV,KAAK,gBAAe,EAE3B,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,GAAK,KAAK,UACzB,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,iBAAgB,EACrBA,EAAIA,EAAI,KAAK,WACT,KAAK,KAAOA,IACZ,KAAK,GAAKA,EACV,KAAK,gBAAe,EAE3B,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACb,KAAK,iBAAgB,EACjB,KAAK,aAAeA,IACpB,KAAK,WAAaA,EAClB,KAAK,iBAAgB,EAE5B,CAED,mBAAoB,CAChB,MAAO,EACV,CAED,gBAAiB,CACb,OAAK,KAAK,qBAMF,KAAK,KAAO,KAAK,QAAU,KAAK,QAAQ,eAAgB,EAAG,KAAK,GAAK,IAAM,KAAK,WAJ7E,CAKd,CAED,iBAAkB,CACd,OAAK,KAAK,qBAKF,KAAK,KAAO,KAAK,QAAU,KAAK,QAAQ,gBAAiB,EAAG,KAAK,GAAK,IAAM,KAAK,WAH9E,CAId,CAED,MAAMoK,EAAU,CACZoqC,GAAK,YAAY,KAAMpqC,CAAQ,CAClC,CAEL,CAEA0P,GAAQ,UAAU,UAAY,GAE9BA,GAAQ,GAAK,EChmBE,MAAMM,WAAqBN,EAAQ,CAE9C,YAAYvI,EAAO,CACf,MAAMA,CAAK,EAEX,KAAK,KAAO,OACZ,KAAK,UAAY,EACpB,CAED,IAAI,KAAM,CACN,OAAO,KAAK,IACf,CAED,IAAI,IAAIvR,EAAG,CACH,KAAK,OAASA,IACd,KAAK,KAAOA,EACZ,KAAK,SAAQ,EAEpB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACR,KAAK,YAAcA,IACnB,KAAK,UAAYA,EACjB,KAAK,SAAQ,EAEpB,CAED,aAAc,CACV,MAAO,CAAC,CAAC,KAAK,IACjB,CAED,cAAe,CACX,OAAO,KAAK,IACf,CAED,kBAAmB,CACf,IAAIxE,EAAM,KAAK,KACXkkD,EAAW,KAAK,UACpB,GAAI,KAAK,MAAM,UAAU,aAAa,EAAG,CACrC,IAAIC,EAAKnkD,EAAI,WAAW,CAAC,EACpBA,EAAI,QAAQ,IAAI,IAAM,KAASmkD,GAAM,IAAMA,GAAM,IAAQA,GAAM,IAAMA,GAAM,KAAQA,GAAM,MAE1FnkD,EAAM,KAAK,MAAM,UAAU,aAAa,EAAIA,EAEnD,CAED,OAAQ++C,GACG,KAAK,MAAM,SAAS,eAAe,CAAC,IAAK/+C,EAAK,SAAUkkD,CAAQ,EAAGnF,CAAE,CAEnF,CAED,gBAAiB,CACb,MAAM3vB,EAAM,MAAM,iBAClB,OAAI,KAAK,OACLA,EAAI,IAAM,KAAK,MAEZA,CACV,CAEL,CCxDO,SAASg1B,GAAelkC,EAAUyK,EAAWlK,EAAU+G,EAAW68B,EAAiB,CACtF,IAAIj9B,EAAKlH,EACJ,MAAM,QAAQkH,CAAE,IACjBA,EAAK,CAACA,CAAE,GAEZ,IAAIC,EAAM,GACV,QAASjoB,EAAI,EAAGsK,EAAI0d,EAAG,OAAQhoB,EAAIsK,EAAGtK,IAAK,CACvC,IAAIklD,EAAQl9B,EAAGhoB,CAAC,EAGZklD,IAAU,OACVA,EAAQD,GAERC,IAAU,SAAWA,IAAU,aAC/Bj9B,EAAI,KAAKi9B,CAAK,EAGdj9B,EAAI,KAAK,IAAI,OAAAi9B,EAAK,IAAG,CAE5B,CACD,MAAO,GAAG,OAAA35B,EAAS,KAAI,OAAAlK,EAAW+G,EAAS,OAAM,OAAAH,EAAI,KAAK,GAAG,EACjE,CAMO,SAASk9B,GAAiBj6B,EAAO,CACpC,OAAOA,IAAU,IAAMA,IAAU,GACrC,CAMO,SAASk6B,GAAQl6B,EAAO,CAC3B,OAAOi6B,GAAiBj6B,CAAK,GAAKA,IAAU,GAChD,CAOO,SAASm6B,GAAeC,EAAYljC,EAAM,CAC7C,MAAMmjC,EAAanjC,EAAK,MAAMkjC,CAAU,GAAK,GACvCt6B,EAAQ5I,EAAK,MAAMkjC,CAAU,GAAK,GACxC,IAAIE,EAAQ,GACZ,QAASxlD,EAAI,EAAGA,EAAIgrB,EAAM,OAAQhrB,IAC9BwlD,EAAM,KAAKx6B,EAAMhrB,CAAC,EAAGulD,EAAWvlD,CAAC,CAAC,EAEtC,OAAAwlD,EAAM,IAAG,EACFA,EAAM,OAAQn7B,GAASA,GAAQ,EAAE,CAC5C,CAQO,SAAS/H,GAAYxZ,EAASuhB,EAAMa,EAAQ,EAAG,CAClD,OAAKA,EAGEb,EAAK,MAAM,EAAE,EAAE,OAAO,CAACxM,EAAKsN,IAI3Bg6B,GAAiBh6B,CAAI,EACdtN,EAEJA,EAAM/U,EAAQ,YAAYqiB,CAAI,EAAE,MAAQD,EAChD,CAAC,EAVOpiB,EAAQ,YAAYuhB,CAAI,EAAE,KAWzC,CAWO,SAASo7B,GAAS38C,EAASsZ,EAAMqG,EAAe3F,EAAe6H,EAAQ,CAG1E,MAAM+6B,EAAa,YACnB,IAAIx8B,EAAQ9G,EAAK,MAAM,QAAQ,EAC3BwI,EAAW,GACXC,EAAe,GACnB,QAAS7qB,EAAI,EAAGA,EAAIkpB,EAAM,OAAQlpB,IAAK,CACnC,IAAI8qB,EAAc,GACd9iB,EAAS,GACT+iB,EAAYtC,EAAgBkC,EAC5BK,EAAQ9B,EAAMlpB,CAAC,EAAE,MAAM0lD,CAAU,EACjCC,EAASz8B,EAAMlpB,CAAC,EAAE,MAAM0lD,CAAU,GAAK,GAC3C,QAASr6C,EAAI,EAAGA,EAAI2f,EAAM,OAAQ3f,IAAK,CACnC,MAAM6f,EAAQy6B,EAAOt6C,EAAI,CAAC,GAAK,GACzBgf,EAAOW,EAAM3f,CAAC,EACdmf,EAAYlI,GAAYxZ,EAASuhB,EAAMvH,CAAa,EACpDmI,EAAqBT,EAAYlI,GAAYxZ,EAASoiB,EAAOpI,CAAa,EAC5EzX,IAAM,GAAK4f,EAAqBF,GAG5B1f,EAAI,IACJyf,EAAY,KAAK9iB,CAAM,EACvBA,EAAS,IAEbA,GAAUqiB,EACVU,EAAYtC,EAAgB+B,GAAanf,IAAM,EAAIsf,EAAS,KAG5DI,GAAaE,EACbjjB,GAAUkjB,EAAQb,EAEzB,CACDS,EAAY,KAAK9iB,CAAM,EACvBA,EAAS,GACT4iB,EAAWA,EAAS,OAAOE,CAAW,EAClC9qB,EAAIkpB,EAAM,OAAS,GACnB2B,EAAa,KAAKD,EAAS,MAAM,CAExC,CACD,MAAO,CAAE,EAAGA,EAAU,EAAGC,CAAY,CACzC,CCnIe,MAAM+6B,EAAoB,CAErC,YAAYjvC,EAAOzG,EAAQV,EAAU,CACjC,KAAK,OAASmH,EACd,KAAK,QAAUzG,EACf,KAAK,SAAW,KAAK,QAAQ,WAAW,IAAI,EAC5C,KAAK,UAAYV,CACpB,CAED,cAAe,CACX,OAAO,KAAK,UAAU,SACzB,CAED,mBAAoB,CAChB,KAAK,SAAS,KAAOw1C,GACjB,KAAK,UAAU,SACf,KAAK,UAAU,UACf,KAAK,UAAU,SACf,KAAK,aAAc,EACnB,KAAK,OAAO,UAAU,iBAAiB,CACnD,EACQ,KAAK,SAAS,aAAe,KAAK,UAAU,YAC/C,CAED,OAAQ,CACJ,GAAI/L,EAAM,OAAS,SAAS,MAAO,CAC/B,MAAM/wB,EAAc88B,GAChB,KAAK,UAAU,SACf,KAAK,UAAU,UACf,KAAK,UAAU,SACf,KAAK,aAAc,EACnB,KAAK,OAAO,UAAU,iBAAiB,CACvD,EACY,GAAI,CACA,GAAI,CAAC,SAAS,MAAM,MAAM98B,EAAa,KAAK,UAAU,IAAI,EAEtD,OAAO,SAAS,MAAM,KAAKA,EAAa,KAAK,UAAU,IAAI,EAAE,MAAMthB,GAAO,CAEtE,QAAQ,KAAK,8BAA+BA,EAAKshB,CAAW,CACpF,CAAqB,EAAE,KAAK,IAAM,CACL,SAAS,MAAM,MAAMA,EAAa,KAAK,UAAU,IAAI,GACtD,QAAQ,KAAK,6BAA8BA,CAAW,CAElF,CAAqB,CAER,OAAO,EAAG,CACP,QAAQ,KAAK,4CAA8CA,CAAW,CACzE,CACJ,CACJ,CAED,MAAO,CAEH,MAAM29B,EAAc,KAAK,QACzB,OAAKA,EAGMA,EAAY,KAAK,IACb5M,EAAM,QAAU,KAAK,OAAO,SAAS,SAAS,IAAI,EAAI,KAAK,OACrE,EAJMA,EAAM,QAAU,KAAK,OAAO,SAAS,SAAS,IAAI,EAAI,KAAK,OAMzE,CAED,sBAAuB,CACnB,IAAI9wB,EAAa,GAEjB,MAAMC,EAAY,KAAK,eAEjBC,EAAc,KAAK,UAAU,YAAcD,EAC3CE,EAAe,KAAK,UAAU,aAAeF,EAC7C/G,EAAW,KAAK,UAAU,SAAW+G,EAC3C,IAAI9G,EAAU,KAAK,UAAU,UAAY,KAAO,KAAQ,KAAK,UAAU,QAAU8G,EAC7E3C,EAAa,KAAK,UAAU,WAAa2C,EAC7C,MAAMG,EAAI,KAAK,UAAU,EAAIH,EACvBI,EAAI,KAAK,UAAU,EAAIJ,EAC7B,IAAIK,EAAgB,KAAK,UAAU,cAAgBL,EACnD,MAAMM,EAAQ,KAAK,UAAU,MAAQN,EAC/BO,EAAQ,KAAK,UAAU,MAAQP,EAC/BQ,EAAQ,KAAK,UAAU,MAAQR,EAC/BS,EAAQ,KAAK,UAAU,MAAQT,EAC/BtF,GAAiB,KAAK,UAAU,eAAiB,GAAKsF,EACtDU,EAAa,KAAK,UAAU,WAAaV,EAG/C,KAAK,kBAAiB,EAGtB,IAAI7oB,EAAQgpB,GAAK,KAAK,OAAO,UAAU,GAAG,EAGtCQ,EAAaxpB,EAAS8oB,EAW1B,GAVIU,EAAa,KACbxpB,GAAU,GAAKwpB,EACfA,EAAa,IAGZN,IACDA,EAAgBM,GAIhB,KAAK,UAAU,cAAgB,CAAC,KAAK,UAAU,SAAU,CACzD,IAAIC,EACJ,OAAQ,KAAK,UAAU,aAAY,CAC/B,IAAK,OACDA,EAAS,GACT,MACJ,IAAK,WACDA,EAAS,KAAK,UAAU,eACxB,MACJ,QACIA,EAAS,KAAK,UAAU,YAC/B,CACD,KAAK,UAAU,KAAO,KAAK,SAAS,KAAK,UAAU,KAAMP,EAAgBK,EAAYE,CAAM,CAC9F,CAID,IAAIC,EACJ,GAAI,KAAK,UAAU,SACfA,EAAY,KAAK,SAAS,KAAK,UAAU,KAAMR,EAAe3F,EAAegG,CAAU,MACpF,CACHG,EAAY,CAAC,EAAG,KAAK,UAAU,KAAK,MAAM,gBAAgB,EAAG,EAAG,EAAE,EAC/D,IAAI3e,EAAI2e,EAAU,EAAE,OACvB,QAASjpB,EAAI,EAAGA,EAAIsK,EAAI,EAAGtK,IACvBipB,EAAU,EAAE,KAAKjpB,CAAC,CAEzB,CACD,IAAIkpB,EAAQD,EAAU,EAEtB,GAAI,KAAK,UAAU,UAAYC,EAAM,OAAS,KAAK,UAAU,SAAU,CACnE,IAAIC,EAAYD,EAAM,MAAM,EAAG,KAAK,UAAU,QAAQ,EAElDE,EAAa,KACjB,GAAI,KAAK,UAAU,eAAgB,CAE/B,IAAIb,EAAI,KAAK,UAAU,eAAiB,KAAK,YAAY,KAAK,UAAU,cAAc,EAAI,EACtFc,EAAK,KAAK,SAASF,EAAUA,EAAU,OAAS,CAAC,EAAGV,EAAgBF,EAAGzF,EAAegG,CAAU,EACpGK,EAAUA,EAAU,OAAS,CAAC,EAAIE,EAAG,EAAE,CAAC,EAAI,KAAK,UAAU,eAC3DD,EAAa,CAACC,EAAG,EAAE,OAAS,EAAIA,EAAG,EAAE,CAAC,EAAI,EAAE,CAC5D,MACgBD,EAAa,CAAC,EAAE,EAIpB,IAAIppB,EAAGsK,EAAI4e,EAAM,OACb7d,EAAI,EACJoQ,EAAIwN,EAAU,EAAE,OACpB,IAAKjpB,EAAI,KAAK,UAAU,SAAUA,EAAIsK,EAAGtK,IACrCopB,EAAW/d,CAAC,IAAM+d,EAAW/d,CAAC,EAAI,IAAM,IAAM6d,EAAMlpB,CAAC,EACjDA,EAAI,EAAIyb,GAAKwN,EAAU,EAAEjpB,EAAI,CAAC,GAC9BqL,IAIR8c,EAAW,cAAgBiB,EAAW,KAAK,IAAI,EAE/CjB,EAAW,cAAgB,GAE3Be,EAAQC,CACpB,MACYhB,EAAW,cAAgB,GAC3BA,EAAW,cAAgB,GAI/B,IAAImB,EAAe,EACfC,EAAa,GACjB,QAASvpB,EAAI,EAAGA,EAAIkpB,EAAM,OAAQlpB,IAAK,CACnC,IAAIqlB,EAAY,KAAK,YAAY6D,EAAMlpB,CAAC,EAAG8iB,CAAa,GAAK9iB,IAAM,EAAI8oB,EAAa,GACpFS,EAAW,KAAKlE,CAAS,EACzBiE,EAAe,KAAK,IAAIA,EAAcjE,CAAS,CAClD,CAED8C,EAAW,WAAaoB,EAEnBhB,IAEDhpB,EAAQ+pB,EAAejB,EAAcC,EACrCS,EAAaO,GAIjB7D,EAAaA,GAAcpE,EAE3B,IAAI7hB,EACJ,GAAIgpB,EACAhpB,EAASgpB,MACN,CACH,MAAMgB,EAAkB,KAAK,UAAU,cAAgB,SAAY,GAAMnI,EAAW,EACpF7hB,EAASimB,GAAcyD,EAAM,OAAS,GAAKM,EAAiB,KAAK,IAAI/D,EAAYpE,CAAQ,EAAIC,CAChG,CAED,OAAIA,IAAY,OACZA,EAAUD,GAGd8G,EAAW,EAAI5oB,EACf4oB,EAAW,EAAI3oB,EACf2oB,EAAW,MAAQe,EACnBf,EAAW,UAAYC,EAElB7oB,IAEDA,EAAQ,GAGPC,IAEDA,EAAS,IAGTkpB,GAASC,KACTppB,EAAQ,KAAK,IAAIA,EAAOopB,EAAQD,CAAK,IAGrCE,GAASC,KACTrpB,EAAS,KAAK,IAAIA,EAAQqpB,EAAQD,CAAK,GAG3CT,EAAW,MAAQ5oB,EACnB4oB,EAAW,WAAaY,EACxBZ,EAAW,OAAS3oB,EACpB2oB,EAAW,SAAW9G,EACtB8G,EAAW,MAAQO,EACnBP,EAAW,MAAQS,EACnBT,EAAW,MAAQQ,EACnBR,EAAW,MAAQU,EACnBV,EAAW,WAAa1C,EACxB0C,EAAW,WAAaoB,EACxBpB,EAAW,QAAU7G,EACrB6G,EAAW,YAAcE,EACzBF,EAAW,aAAeG,EAC1BH,EAAW,cAAgBrF,EAC3BqF,EAAW,WAAaW,EAEjBX,CACV,CAED,OAAQ,CACJ,MAAMA,EAAa,KAAK,uBAClBC,EAAY,KAAK,eAGvB,KAAK,QAAQ,MAAQ,KAAK,KAAKD,EAAW,MAAQ,KAAK,OAAO,UAAU,uBAAuB,CAAC,EAChG,KAAK,QAAQ,OAAS,KAAK,KAAKA,EAAW,MAAM,EAGjD,KAAK,kBAAiB,EAElBA,EAAW,UAAY,MAEvB,KAAK,SAAS,YAAc,IAC5B,KAAK,SAAS,SAAS,EAAG,EAAG,IAAM,GAAI,EACvC,KAAK,SAAS,YAAc,IAG5BA,EAAW,OAASA,EAAW,QAC/B,KAAK,SAAS,UAAU,CAACA,EAAW,MAAO,CAACA,EAAW,KAAK,EAGhE,IAAIuB,EACAC,EAEAC,EAAY,GAGhB,QAAS5pB,EAAI,EAAGsK,EAAI6d,EAAW,MAAM,OAAQnoB,EAAIsK,EAAGtK,IAChD0pB,EAAgB1pB,IAAM,EAAImoB,EAAW,WAAa,EAGlDwB,EAAiB3pB,EAAImoB,EAAW,WAAcA,EAAW,QAErD,KAAK,UAAU,eAAiB,SAChCwB,IAAkBxB,EAAW,WAAaA,EAAW,UAAY,EAC1D,KAAK,UAAU,eAAiB,WACvCwB,GAAiBxB,EAAW,WAAaA,EAAW,UAGpD,KAAK,UAAU,YAAc,QAC7BuB,GAAkBvB,EAAW,WAAaA,EAAW,WAAWnoB,CAAC,EAC1D,KAAK,UAAU,YAAc,WACpC0pB,IAAmBvB,EAAW,WAAaA,EAAW,WAAWnoB,CAAC,GAAK,GAE3E0pB,GAAiBvB,EAAW,YAE5ByB,EAAU,KAAK,CAAC,KAAMzB,EAAW,MAAMnoB,CAAC,EAAG,EAAG0pB,EAAe,EAAGC,EAAe,EAAGxB,EAAW,WAAWnoB,CAAC,CAAC,CAAC,EAI/G,GAAI,KAAK,UAAU,UAAW,CAC1B,IAAIiR,EAAQ,KAAK,UAAU,gBAAkB,EAEzC4Y,EAAY,KAAK,UAAU,gBAAkBzB,GAAaD,EAAW,SAAW,IACpF,MAAM2B,EAAS,KAAK,UAAU,gBAAkB1B,EAC1C2B,EAAiB,KAAK,UAAU,uBAAyB,KAAO,KAAK,UAAU,qBAAuB3B,EAAYD,EAAW,YAC7H6B,EAAkB,KAAK,UAAU,wBAA0B,KAAO,KAAK,UAAU,sBAAwB5B,EAAYD,EAAW,aAEtI,KAAK,SAAS,UAAYivB,EAAW,cAAcnmC,CAAK,EACxD,QAASjR,EAAI,EAAGA,EAAI4pB,EAAU,OAAQ5pB,IAAK,CACvC,IAAIkqB,EAAWN,EAAU5pB,CAAC,EAC1B,KAAK,SAAS,SAAUkqB,EAAS,EAAIH,EAAiBG,EAAS,EAAI/B,EAAW,QAAU2B,EAAUI,EAAS,EAAIF,EAAiBD,EAAgBF,CAAQ,CAC3J,CACJ,CAGD,IAAIM,EAAqB,KACrB,KAAK,UAAU,SACfA,EAAqB,CAAC,KAAK,SAAS,YAAa,KAAK,SAAS,cAAe,KAAK,SAAS,cAAe,KAAK,SAAS,UAAU,EAEnI,KAAK,SAAS,YAAcitB,EAAW,cAAc,KAAK,UAAU,WAAW,EAC/E,KAAK,SAAS,cAAgB,KAAK,UAAU,cAAgBhvB,EAC7D,KAAK,SAAS,cAAgB,KAAK,UAAU,cAAgBA,EAC7D,KAAK,SAAS,WAAa,KAAK,UAAU,WAAaA,GAG3D,KAAK,SAAS,UAAYgvB,EAAW,cAAc,KAAK,UAAU,SAAS,EAC3E,QAASp3C,EAAI,EAAGsK,EAAIsf,EAAU,OAAQ5pB,EAAIsK,EAAGtK,IAAK,CAC9C,IAAIkqB,EAAWN,EAAU5pB,CAAC,EAE1B,GAAImoB,EAAW,gBAAkB,EAC7B,KAAK,SAAS,SAAS+B,EAAS,KAAMA,EAAS,EAAGA,EAAS,CAAC,MACzD,CACH,MAAME,EAAYF,EAAS,KAAK,MAAM,EAAE,EACxC,IAAInU,EAAImU,EAAS,EACjB,QAASlqB,EAAI,EAAGqL,EAAI+e,EAAU,OAAQpqB,EAAIqL,EAAGrL,IACzC,KAAK,SAAS,SAASoqB,EAAUpqB,CAAC,EAAG+V,EAAGmU,EAAS,CAAC,EAClDnU,GAAK,KAAK,YAAYqU,EAAUpqB,CAAC,EAAGmoB,EAAW,aAAa,CAEnE,CACJ,CAEGgC,IACA,KAAK,SAAS,YAAcA,EAAmB,CAAC,EAChD,KAAK,SAAS,cAAgBA,EAAmB,CAAC,EAClD,KAAK,SAAS,cAAgBA,EAAmB,CAAC,EAClD,KAAK,SAAS,WAAaA,EAAmB,CAAC,IAG/ChC,EAAW,OAASA,EAAW,QAC/B,KAAK,SAAS,UAAUA,EAAW,MAAOA,EAAW,KAAK,EAG9D,KAAK,WAAaA,CACrB,CAED,SAASkC,EAAM5B,EAAeO,EAAQ,CAClC,MAAMsB,EAAc,KAAK,YAAYtB,CAAM,EACrCuB,EAAUF,EAAK,OACfG,EAAY,KAAK,YAAYH,CAAI,EAGvC,GAAIG,GAAa/B,EACb,OAAO4B,EAIX,IAAII,EAAc,KAAK,MAAOhC,EAAgB8B,EAAWC,CAAS,EAC9DE,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAIH,EAGxE,GAAII,EAAiBjC,EACjB,KAAOgC,EAAc,IACjBC,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAIH,EAChEI,EAAiBjC,IACjBgC,GAAe,MAQvB,MAAOA,EAAcF,GAEjB,GADAG,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAIH,EAChEI,EAAiBjC,EACjBgC,GAAe,MACZ,CAEHA,GAAc,EACd,KACH,CAKT,OAAOJ,EAAK,UAAU,EAAGI,CAAW,GAAKhC,GAAiB6B,EAActB,EAAS,GACpF,CAWD,SAAS5G,EAAMqG,EAAe3F,EAAe6H,EAAS,EAAG,CACrD,OAAO86B,GAAS,KAAK,SAAUrjC,EAAMqG,EAAe3F,EAAe6H,CAAM,CAC5E,CASD,YAAYN,EAAMa,EAAQ,EAAG,CACzB,OAAO5I,GAAY,KAAK,SAAU+H,EAAMa,CAAK,CAChD,CAEL,CC7Ze,MAAM46B,EAA4B,CAE7C,YAAYnvC,EAAOzG,EAAQV,EAAU,CACjC,KAAK,OAASmH,EACd,KAAK,QAAUzG,EACf,KAAK,SAAW,KAAK,QAAQ,WAAW,IAAI,EAC5C,KAAK,UAAYV,CACpB,CAED,cAAe,CACX,OAAO,KAAK,UAAU,SACzB,CAED,mBAAoB,CAChB,MAAM8Q,EAAO0kC,GACT,KAAK,UAAU,SACf,KAAK,UAAU,UACf,KAAK,UAAU,SACf,KAAK,aAAc,EACnB,KAAK,OAAO,UAAU,iBAAiB,CACnD,EACQ,YAAK,SAAS,KAAO1kC,EACrB,KAAK,SAAS,aAAe,KAAK,UAAU,aACrCA,CACV,CAED,OAAQ,CACJ,GAAI24B,EAAM,OAAS,SAAS,MAAO,CAC/B,MAAM/wB,EAAc88B,GAChB,KAAK,UAAU,SACf,KAAK,UAAU,UACf,KAAK,UAAU,SACf,KAAK,aAAc,EACnB,KAAK,OAAO,UAAU,iBAAiB,CACvD,EACY,GAAI,CACA,GAAI,CAAC,SAAS,MAAM,MAAM98B,EAAa,KAAK,UAAU,IAAI,EAEtD,OAAO,SAAS,MAAM,KAAKA,EAAa,KAAK,UAAU,IAAI,EAAE,MAAMthB,GAAO,CAEtE,QAAQ,KAAK,kBAAmBA,EAAKshB,CAAW,CACxE,CAAqB,EAAE,KAAK,IAAM,CACL,SAAS,MAAM,MAAMA,EAAa,KAAK,UAAU,IAAI,GACtD,QAAQ,KAAK,iBAAkBA,CAAW,CAEtE,CAAqB,CAER,OAAO,EAAG,CACP,QAAQ,KAAK,gCAAkCA,CAAW,CAC7D,CACJ,CACJ,CAED,MAAO,CAEH,MAAM29B,EAAc,KAAK,QACzB,OAAKA,EAGMA,EAAY,KAAK,IACb5M,EAAM,QAAU,KAAK,OAAO,SAAS,SAAS,IAAI,EAAI,KAAK,OACrE,EAJMA,EAAM,QAAU,KAAK,OAAO,SAAS,SAAS,IAAI,EAAI,KAAK,OAMzE,CAED,sBAAuB,CACnB,IAAI9wB,EAAa,GAEjB,MAAMC,EAAY,KAAK,eAEjBC,EAAc,KAAK,UAAU,YAAcD,EAC3CE,EAAe,KAAK,UAAU,aAAeF,EAC7C/G,EAAW,KAAK,UAAU,SAAW+G,EAErC3C,EAAa,KAAK,UAAU,WAAa2C,GAAa/G,EACtDkH,EAAI,KAAK,UAAU,GAAK,EAAI,KAAK,UAAU,EAAIH,EAAY,KAAK,OAAO,UAAU,GAAG,EAEpFK,EAAgB,KAAK,UAAU,cAAgBL,EAC/CM,EAAQ,KAAK,UAAU,MAAQN,EAC/BO,EAAQ,KAAK,UAAU,MAAQP,EAC/BQ,EAAQ,KAAK,UAAU,MAAQR,EAC/BS,EAAQ,KAAK,UAAU,MAAQT,EAC/BtF,EAAgB,KAAK,UAAU,eAAiB,EAGtDqF,EAAW,SAAW,KAAK,oBAE3BA,EAAW,EAAII,EACfJ,EAAW,MAAQI,EACnBJ,EAAW,KAAO,KAAK,UAAU,KACjCA,EAAW,UAAYC,EACvBD,EAAW,SAAW9G,EACtB8G,EAAW,kBAAoB,KAAK,UAAU,kBAC9CA,EAAW,WAAa1C,EACxB0C,EAAW,cAAgBrF,EAC3BqF,EAAW,UAAY,KAAK,UAAU,UACtCA,EAAW,UAAY,KAAK,UAAU,UACtCA,EAAW,cAAgB,KAAK,UAAU,cAC1CA,EAAW,UAAY,KAAK,UAAU,UACtCA,EAAW,eAAiB,KAAK,UAAU,eAC3CA,EAAW,gBAAkB,KAAK,UAAU,gBAC5CA,EAAW,qBAAuB,KAAK,UAAU,qBACjDA,EAAW,sBAAwB,KAAK,UAAU,sBAClDA,EAAW,gBAAkB,KAAK,UAAU,gBAC5CA,EAAW,YAAc,KAAK,UAAU,YACxCA,EAAW,aAAe,KAAK,UAAU,aACzCA,EAAW,SAAW,KAAK,UAAU,SACrCA,EAAW,eAAiB,KAAK,UAAU,eAC3CA,EAAW,aAAe,KAAK,UAAU,aACzCA,EAAW,SAAW,KAAK,UAAU,SACrCA,EAAW,cAAgBM,EAC3BN,EAAW,OAAS,KAAK,UAAU,OACnCA,EAAW,YAAc,KAAK,UAAU,YACxCA,EAAW,cAAgB,KAAK,UAAU,cAC1CA,EAAW,cAAgB,KAAK,UAAU,cAC1CA,EAAW,WAAa,KAAK,UAAU,WACvCA,EAAW,MAAQO,EACnBP,EAAW,MAAQQ,EACnBR,EAAW,MAAQS,EACnBT,EAAW,MAAQU,EACnBV,EAAW,WAAa,KAAK,UAAU,WAAaC,EACpDD,EAAW,UAAY,KAAK,UAAU,UAEtC,IAAI/F,EAAO+F,EAAW,KAClB49B,EAAY59B,EAAW,UAAYA,EAAW,eAAiBA,EAAW,MAG9E,GAAIA,EAAW,cAAgB,CAACA,EAAW,SAAU,CACjD,IAAIa,EACJ,OAAQ,KAAK,UAAU,aAAY,CAC/B,IAAK,OACDA,EAAS,GACT,MACJ,IAAK,WACDA,EAAS,KAAK,UAAU,eACxB,MACJ,QACIA,EAAS,KAAK,UAAU,YAC/B,CACD5G,EAAO,KAAK,SAASA,EAAMqG,GAAiBN,EAAW,EAAGa,CAAM,CACnE,CAED5G,EAAO,KAAK,SAASA,CAAI,EACzBA,EAAO,KAAK,MAAMA,CAAI,EACtBA,EAAO,KAAK,QAAQA,EAAMU,EAAeqF,EAAW,QAAQ,EAExDA,EAAW,aACX/F,EAAO,KAAK,OAAOA,EAAM+F,EAAW,UAAU,GAG9CA,EAAW,YACX/F,EAAOA,EAAK,OAAO,CAACvE,EAAKpV,IAAMoV,EAAI,OAAO,KAAK,UAAUpV,EAAGs9C,EAAW59B,EAAW,QAAQ,CAAC,EAAG,EAAE,EAChG,KAAK,eAAgB,GAIzB,IAAIpS,EAAIsS,EACJ29B,EAAS,EAEb,UAAWv9C,KAAK2Z,GAER+F,EAAW,UAAYpS,EAAItN,EAAE,MAAQs9C,GAAat9C,EAAE,MAAQ,QAC5DsN,EAAIsS,EACJ29B,GAAU,GAEdv9C,EAAE,OAASu9C,EAEPv9C,EAAE,MAAQ,OAIdA,EAAE,EAAIsN,EACNA,GAAKtN,EAAE,OAEX0f,EAAW,QAAU69B,EAAS,EAE1B,KAAK,UAAU,EACf79B,EAAW,EAAI,KAAK,UAAU,EACvBA,EAAW,UAAYA,EAAW,SAAWA,EAAW,QAC/DA,EAAW,EAAIA,EAAW,SAAWA,EAAW,WAAa9G,EAAW,EAExE8G,EAAW,EAAIA,EAAW,QAAUA,EAAW,WAAa9G,EAAW,EAS3E,MAAM4kC,EAAqB99B,EAAW,kBAAoBA,EAAW,SAGrE,IAAI+9B,EAAW,EACX/9B,EAAW,eAAiB,OAAS,KAAK,SAAS,cAAgB,aACnE+9B,EAAW,CAACD,EACL99B,EAAW,eAAiB,SACnC+9B,GAAY/9B,EAAW,WAAaA,EAAW,SAAW89B,GAAsB,EACzE,KAAK,UAAU,eAAiB,WACvCC,EAAW/9B,EAAW,WAAaA,EAAW,UAIlDA,EAAW,MAAQ,CAAE,EACrB,QAASnoB,EAAI,EAAGA,EAAImoB,EAAW,QAASnoB,IACpCmoB,EAAW,MAAMnoB,CAAC,EAAI,CAClB,MAAO,EACP,EAAG,EACH,EAAGmoB,EAAW,WAAanoB,EAAIkmD,EAC/B,KAAM,CAAE,CACX,EAGL,QAASz9C,KAAK2Z,EACV+F,EAAW,MAAM1f,EAAE,MAAM,EAAE,KAAK,KAAKA,CAAC,EAI1C,UAAWnB,KAAK6gB,EAAW,MAAO,CAC9B,GAAI7gB,EAAE,KAAK,QAAU,EACjB,SAGJ,MAAM6+C,EAAY7+C,EAAE,KAAK,CAAC,EAAE,KACtB0c,EAAW1c,EAAE,KAAKA,EAAE,KAAK,OAAS,CAAC,EAAE,KAEvC6+C,GAAa,MACb7+C,EAAE,KAAK,SAEP89C,GAAQphC,CAAQ,GAAKA,GAAY,OACjC1c,EAAE,KAAK,KAEd,CAID,QAASA,KAAK6gB,EAAW,MACrB7gB,EAAE,MAAQA,EAAE,KAAK,OAAO,CAACuW,EAAKpV,IAAMoV,EAAMpV,EAAE,MAAO,CAAC,EAOxD,GAJA0f,EAAW,MAAQ,KAAK,UAAU,GAAK,EAAI,KAAK,UAAU,EAAIC,EAAY,KAAK,IAAI,GAAGD,EAAW,MAAM,IAAK7gB,GAAMA,EAAE,KAAK,CAAC,EAAIghB,EAC9HH,EAAW,EAAIA,EAAW,MAGtBA,EAAW,UAAYA,EAAW,QAAUA,EAAW,UAAYA,EAAW,eAAgB,CAC9F,MAAM/d,EAAQ+d,EAAW,SAAW,EACpC,IAAIi+B,EAAehkC,EAAK,OAAQ3Z,GAAMA,EAAE,QAAU2B,CAAK,EACnD4e,EAASb,EAAW,eACxBa,EAAS,KAAK,SAASA,CAAM,EAC7BA,EAAS,KAAK,MAAMA,CAAM,EAC1BA,EAAS,KAAK,QAAQA,EAAQb,EAAW,cAAeA,EAAW,QAAQ,EAC3E,UAAW9jB,KAAK2kB,EACZ3kB,EAAE,OAAS+F,EACX/F,EAAE,EAAI,EACN+hD,EAAa,KAAK/hD,CAAC,EAGvB,MAAMgiD,EAAMr9B,EAAO,OAAS,EAC5B,IAAIlX,EAAKs0C,EAAa,OAAO,CAACvoC,EAAKpV,IAAMoV,EAAMpV,EAAE,MAAO,CAAC,EACzD,MAAOqJ,EAAKqW,EAAW,OAASi9B,GAAQgB,EAAaA,EAAa,OAASC,CAAG,EAAE,IAAI,KAChFD,EAAa,OAAOA,EAAa,OAASC,EAAK,CAAC,EAChDv0C,EAAKs0C,EAAa,OAAO,CAACvoC,EAAKpV,IAAMoV,EAAMpV,EAAE,MAAO,CAAC,EACjD,EAAA29C,EAAa,OAASC,KAA1B,CAIJ,KAAK,UAAUD,EAAcA,EAAa,CAAC,EAAE,CAAC,EAE9Cj+B,EAAW,MAAM/d,CAAK,EAAE,KAAOg8C,EAC/Bj+B,EAAW,MAAM/d,CAAK,EAAE,MAAQ0H,CACnC,CAGD,GAAIqW,EAAW,WAAa,SACxB,QAAS7gB,KAAK6gB,EAAW,MACrB7gB,EAAE,GAAK6gB,EAAW,MAAQ7gB,EAAE,MAAQ+gB,GAAe,UAEhDF,EAAW,WAAa,QAC/B,QAAS7gB,KAAK6gB,EAAW,MACrB7gB,EAAE,EAAI6gB,EAAW,MAAQ7gB,EAAE,MAAQ+gB,EAI3C,OAAOF,CACV,CAED,OAAQ,CACJ,MAAMA,EAAa,KAAK,uBAClBC,EAAY,KAAK,eACjBC,EAAcF,EAAW,YAAcC,EAG7C,IAAIk+B,EAAcn+B,EAAW,GAAKA,EAAW,OACzCA,EAAW,OAASA,EAAW,SAC/Bm+B,EAAc,KAAK,IAAIn+B,EAAW,EAAGA,EAAW,MAAQA,EAAW,KAAK,GAG5E,IAAIo+B,EAAep+B,EAAW,EAwB9B,IAvBIA,EAAW,OAASA,EAAW,SAC/Bo+B,EAAe,KAAK,IAAIp+B,EAAW,EAAGA,EAAW,MAAQA,EAAW,KAAK,GAG7E,KAAK,QAAQ,MAAQ,KAAK,KAAKm+B,EAAc,KAAK,OAAO,UAAU,uBAAuB,CAAC,EAC3F,KAAK,QAAQ,OAAS,KAAK,KAAKC,CAAY,EAG5C,KAAK,kBAAiB,EAElBp+B,EAAW,UAAY,MAEvB,KAAK,SAAS,YAAc,IAC5B,KAAK,SAAS,SAAS,EAAG,EAAG,IAAM,GAAI,EACvC,KAAK,SAAS,YAAc,IAI5BA,EAAW,OAASA,EAAW,QAC/B,KAAK,SAAS,UAAU,CAACA,EAAW,MAAO,CAACA,EAAW,KAAK,EAI5DA,EAAW,UAAW,CACtB,MAAMq+B,EAAUr+B,EAAW,gBAAkB,EACvC0B,EAAW1B,EAAW,gBAAkBA,EAAW,gBAAkBC,EAAaD,EAAW,SAAW,IACxGs+B,EAAWt+B,EAAW,gBAAkBA,EAAW,gBAAkBC,EAAY,EACjF2B,EAAiB5B,EAAW,uBAAyB,KAAOA,EAAW,qBAAuBC,EAAYD,EAAW,YACrH6B,EAAkB7B,EAAW,wBAA0B,KAAOA,EAAW,sBAAwBC,EAAYD,EAAW,aAE9H,KAAK,SAAS,UAAYivB,EAAW,cAAcoP,CAAO,EAC1D,MAAME,EAAUv+B,EAAW,SAAW,KAAK,IAAIA,EAAW,SAAUA,EAAW,OAAO,EAAIA,EAAW,QACrG,QAASnoB,EAAI,EAAGA,EAAI0mD,EAAS1mD,IAAK,CAC9B,MAAMsH,EAAI6gB,EAAW,MAAMnoB,CAAC,EAC5B,KAAK,SAAS,SAASsH,EAAE,EAAIyiB,EAAgB1B,EAAa/gB,EAAE,EAAIm/C,EAAUn/C,EAAE,MAAQyiB,EAAgBC,EAAgBH,CAAQ,CAC/H,CACJ,CAGD,IAAIM,EAAqB,KACrB,KAAK,UAAU,SACfA,EAAqB,CAAC,KAAK,SAAS,YAAa,KAAK,SAAS,cAAe,KAAK,SAAS,cAAe,KAAK,SAAS,UAAU,EAEnI,KAAK,SAAS,YAAcitB,EAAW,cAAc,KAAK,UAAU,WAAW,EAC/E,KAAK,SAAS,cAAgB,KAAK,UAAU,cAAgBhvB,EAC7D,KAAK,SAAS,cAAgB,KAAK,UAAU,cAAgBA,EAC7D,KAAK,SAAS,WAAa,KAAK,UAAU,WAAaA,GAI3D,MAAMu+B,EAAevP,EAAW,cAAc,KAAK,UAAU,SAAS,EACtE,IAAIwP,EAAeD,EACnB,KAAK,SAAS,UAAYA,EAC1B,UAAWvhC,KAAQ+C,EAAW,MAC1B,UAAW1f,KAAK2c,EAAK,KAAM,CACvB,IAAIo9B,EAAK,EAET,GAAI/5C,EAAE,MAAQ,MAIV,EAAA0f,EAAW,UAAY1f,EAAE,QAAU0f,EAAW,UAYlD,GARI1f,EAAE,OAASm+C,IACXA,EAAen+C,EAAE,MACjB,KAAK,SAAS,UAAYm+C,GAG9B,KAAK,SAAS,KAAOn+C,EAAE,UAGnBA,EAAE,QACF,QAASnB,KAAKmB,EAAE,QAAS,CACrB,MAAMsJ,EAAKoW,EAAW,MAAM1f,EAAE,MAAM,EAAE,EAAIA,EAAE,EAAI+5C,EAChD,KAAK,SAAS,SAASl7C,EAAE,KAAMyK,EAAIoW,EAAW,MAAM1f,EAAE,MAAM,EAAE,EAAI0f,EAAW,QAAQ,EACrFq6B,GAAMl7C,EAAE,KACX,KAEE,CACH,MAAMyK,EAAKoW,EAAW,MAAM1f,EAAE,MAAM,EAAE,EAAIA,EAAE,EAC5C,KAAK,SAAS,SAASA,EAAE,KAAMsJ,EAAIoW,EAAW,MAAM1f,EAAE,MAAM,EAAE,EAAI0f,EAAW,QAAQ,CACxF,CACJ,CAIDgC,IACA,KAAK,SAAS,YAAcA,EAAmB,CAAC,EAChD,KAAK,SAAS,cAAgBA,EAAmB,CAAC,EAClD,KAAK,SAAS,cAAgBA,EAAmB,CAAC,EAClD,KAAK,SAAS,WAAaA,EAAmB,CAAC,IAI/ChC,EAAW,OAASA,EAAW,QAC/B,KAAK,SAAS,UAAUA,EAAW,MAAOA,EAAW,KAAK,EAI9DA,EAAW,MAAQA,EAAW,MAAM,IAAK,GAAM,EAAE,KAAK,OAAO,CAACtK,EAAKzY,IAAMyY,EAAMzY,EAAE,KAAM,EAAE,CAAC,EACtF+iB,EAAW,WACXA,EAAW,MAAQA,EAAW,MAAM,MAAM,EAAGA,EAAW,QAAQ,GAIpE,KAAK,WAAaA,CAErB,CASD,YAAYkC,EAAMa,EAAQ,EAAG,CACzB,OAAO5I,GAAY,KAAK,SAAU+H,EAAMa,CAAK,CAChD,CAED,SAAS9I,EAAM,CACX,OAAOijC,GAAe,yEAA0EjjC,CAAI,CACvG,CAED,MAAMykC,EAAQ,CACV,IAAIC,EAAS,EACTC,EAAO,EACPC,EAAa,CAAC5P,EAAW,cAAc,KAAK,UAAU,SAAS,CAAC,EAChEnmC,EAAQ,EAEZ,MAAMg2C,EAAc,gCAEpB,OAAOJ,EAAO,IAAKp+C,GAAM,CACrB,GAAIA,GAAK,MACLq+C,GAAU,EACVr+C,EAAI,WACGA,GAAK,QAAUq+C,EAAS,EAC/BA,GAAU,EACVr+C,EAAI,WACGA,GAAK,MACZs+C,GAAQ,EACRt+C,EAAI,WACGA,GAAK,QAAUs+C,EAAO,EAC7BA,GAAQ,EACRt+C,EAAI,WACGA,GAAK,WACRu+C,EAAW,OAAS,IACpB/1C,GAAS,EACT+1C,EAAW,IAAG,GAElBv+C,EAAI,WACGw+C,EAAY,KAAKx+C,CAAC,EAAG,CAC5B,MAAMy+C,EAAUD,EAAY,KAAKx+C,CAAC,EAClCu+C,EAAW,KACP5P,EAAW,cAAc,SAAS8P,EAAQ,CAAC,CAAC,CAAC,CACjE,EACgBj2C,GAAS,EACTxI,EAAI,EAEP,CAED,MAAO,CACH,KAAMA,EACN,OAAQq+C,EACR,KAAMC,EACN,MAAOC,EAAW/1C,CAAK,CAC1B,CACb,CAAS,EACA,OAAQ7I,GAAMA,EAAE,MAAQ,EAAE,CAC9B,CAED,eAAeiiB,EAAM88B,EAAU,CAC3B,IAAI7mC,EAAO6mC,EACP98B,EAAK,OACL/J,EAAO,QAAUA,GAEjB+J,EAAK,SACL/J,EAAO,UAAYA,GAEvB,KAAK,SAAS,KAAOA,EACrB+J,EAAK,UAAY/J,CACpB,CAED,eAAe6mC,EAAU,CACrB,KAAK,SAAS,KAAOA,CACxB,CAED,QAAQC,EAAQtkC,EAAgB,EAAGqkC,EAAU,CACzC,UAAW1gD,KAAK2gD,EAKZ,GAJA,KAAK,eAAe3gD,EAAG0gD,CAAQ,EAC/B1gD,EAAE,MAAQ,KAAK,YAAYA,EAAE,KAAMqc,CAAa,EAG5CA,EAAgB,EAAG,CACnBrc,EAAE,QAAUA,EAAE,KAAK,MAAM,EAAE,EAAE,IAAKa,IAAc,CAAC,KAAMA,CAAC,EAAE,EAC1D,QAASA,KAAKb,EAAE,QACZa,EAAE,MAAQ,KAAK,YAAYA,EAAE,KAAMwb,CAAa,CAEvD,CAGL,YAAK,eAAeqkC,CAAQ,EACrBC,CACV,CAED,OAAOA,EAAQt+B,EAAY,CACvB,OAAAs+B,EAAO,OAAO,EAAG,EAAG,CAAC,KAAM,GAAI,MAAOt+B,CAAU,CAAC,EAC1Cs+B,CACV,CAED,SAAS/8B,EAAM5B,EAAeO,EAAQ,CAClC,MAAMsB,EAAc,KAAK,YAAYtB,CAAM,EACrCuB,EAAUF,EAAK,OACfG,EAAY,KAAK,YAAYH,CAAI,EAGvC,GAAIG,GAAa/B,EACb,OAAO4B,EAIX,IAAII,EAAc,KAAK,MAAOhC,EAAgB8B,EAAWC,CAAS,EAC9DE,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAIH,EAGxE,GAAII,EAAiBjC,EACjB,KAAOgC,EAAc,IACjBC,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAIH,EAChEI,EAAiBjC,IACjBgC,GAAe,MAQvB,MAAOA,EAAcF,GAEjB,GADAG,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGI,CAAW,CAAC,EAAIH,EAChEI,EAAiBjC,EACjBgC,GAAe,MACZ,CAEHA,GAAc,EACd,KACH,CAKT,OAAOJ,EAAK,UAAU,EAAGI,CAAW,GAAKhC,GAAiB6B,EAActB,EAAS,GACpF,CAED,eAAeqB,EAAM9qB,EAAO,CACxB,MAAMgrB,EAAUF,EAAK,OACfG,EAAY,KAAK,YAAYH,CAAI,EAEvC,GAAIG,GAAajrB,EACb,MAAO,CAAC,WAAY8qB,EAAK,OAAQ,eAAgBG,CAAS,EAG9D,IAAI68B,EAAa,KAAK,MAAO9nD,EAAQgrB,EAAWC,CAAS,EACrDE,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGg9B,CAAU,CAAC,EAGnE,GAAI38B,EAAiBnrB,EACjB,KAAO8nD,EAAa,IAChB38B,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGg9B,CAAU,CAAC,EAC3D38B,EAAiBnrB,IACjB8nD,GAAc,MAQtB,MAAOA,EAAa98B,GAEhB,GADAG,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGg9B,CAAU,CAAC,EAC3D38B,EAAiBnrB,EACjB8nD,GAAc,MACX,CAEHA,GAAa,EACb38B,EAAiB,KAAK,YAAYL,EAAK,UAAU,EAAGg9B,CAAU,CAAC,EAC/D,KACH,CAGT,MAAO,CAAC,WAAAA,EAAY,eAAA38B,CAAc,CAErC,CAED,UAAUL,EAAM9qB,EAAO4nD,EAAU,CAC7B,GAAI,CAAC98B,EAAK,KACN,OAAOA,EAEX,KAAK,eAAeA,EAAM88B,CAAQ,EAClC,MAAMpO,EAAQ,GACd,IAAI32B,EAAOiI,EAAK,KAChB,GAAKA,EAAK,QAaH,CACH,IAAIi9B,EAAa,EACbC,EAAU,GACVF,EAAa,EACjB,UAAW,KAAKh9B,EAAK,QACbi9B,EAAa,EAAE,OAAS/nD,GACxBw5C,EAAM,KAAK,CAAC,GAAG1uB,CAAI,CAAC,EACpB0uB,EAAMA,EAAM,OAAS,CAAC,EAAE,KAAO32B,EAAK,MAAM,EAAGilC,CAAU,EACvDtO,EAAMA,EAAM,OAAS,CAAC,EAAE,MAAQuO,EAChCvO,EAAMA,EAAM,OAAS,CAAC,EAAE,QAAUwO,EAClCnlC,EAAOA,EAAK,MAAMilC,CAAU,EAC5BC,EAAa,EACbC,EAAU,GACVF,EAAa,IAGbA,GAAc,EACdE,EAAQ,KAAK,CAAC,EACdD,GAAc,EAAE,OAIpBA,EAAa,IACbvO,EAAM,KAAK,CAAC,GAAG1uB,CAAI,CAAC,EACpB0uB,EAAMA,EAAM,OAAS,CAAC,EAAE,KAAO32B,EAAK,MAAM,EAAGilC,CAAU,EACvDtO,EAAMA,EAAM,OAAS,CAAC,EAAE,MAAQuO,EAChCvO,EAAMA,EAAM,OAAS,CAAC,EAAE,QAAUwO,EAEzC,KAxCG,QAAa,CACT,KAAM,CAAC,WAAAF,EAAY,eAAA38B,CAAc,EAAI,KAAK,eAAetI,EAAM7iB,CAAK,EAKpE,GAJAw5C,EAAM,KAAK,CAAC,GAAG1uB,CAAI,CAAC,EACpB0uB,EAAMA,EAAM,OAAS,CAAC,EAAE,KAAO32B,EAAK,MAAM,EAAGilC,CAAU,EACvDtO,EAAMA,EAAM,OAAS,CAAC,EAAE,MAAQruB,EAE5B28B,IAAejlC,EAAK,OACpB,MAGJA,EAAOA,EAAK,MAAMilC,CAAU,CAC/B,CA+BL,OAAOtO,CACV,CAED,UAAUqO,EAAQI,EAAW,EAAG,CAC5B,IAAIC,EAAY,EACZC,EAAQF,EACZ,UAAWn9B,KAAQ+8B,EACX/8B,EAAK,MAAQ,OAGjBA,EAAK,EAAIq9B,EAAQD,EACjBC,EAAQr9B,EAAK,EACbo9B,EAAYp9B,EAAK,MAGxB,CACL,CCppBe,MAAMs9B,WAAoBzoC,EAAQ,CAE7C,YAAYvI,EAAO,CACf,MAAMA,CAAK,EAGX,KAAK,WAAa,KAAK,MAAM,UAAU,WAAW,CACrD,CAED,OAAO,SAASA,EAAOzG,EAAQV,EAAU,CACrC,OAAI,KAAK,iBACE,IAAIs2C,GAA4BnvC,EAAOzG,EAAQV,CAAQ,EAEvD,IAAIo2C,GAAoBjvC,EAAOzG,EAAQV,CAAQ,CAE7D,CAED,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,IAAI,KAAKpK,EAAG,CACJ,KAAK,QAAUA,IACf,KAAK,MAAQ,GAAKA,EAClB,KAAK,SAAQ,EAEpB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACD,KAAK,KAAOA,IACZ,KAAK,GAAKA,EACV,KAAK,SAAQ,EAEpB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACD,KAAK,KAAOA,IACZ,KAAK,GAAKA,EACV,KAAK,SAAQ,EAEpB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACT,KAAK,aAAeA,IACpB,KAAK,WAAaA,EAClB,KAAK,SAAQ,EAEpB,CAED,IAAI,mBAAoB,CACpB,OAAO,KAAK,kBACf,CAED,IAAI,kBAAkBA,EAAG,CACjB,KAAK,qBAAuBA,IAC5B,KAAK,mBAAqBA,EAC1B,KAAK,SAAQ,EAEpB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACR,KAAK,YAAcA,IACnB,KAAK,UAAYA,EACjB,KAAK,SAAQ,EAEpB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACR,KAAK,YAAcA,IACnB,KAAK,UAAYA,EACjB,KAAK,SAAQ,EAEpB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACR,KAAK,YAAcA,IACnB,KAAK,UAAYA,EACjB,KAAK,SAAQ,EAEpB,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,cAAcA,EAAG,CACb,KAAK,iBAAmBA,IACxB,KAAK,eAAiBA,EACtB,KAAK,SAAQ,EAEpB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACT,KAAK,aAAeA,IACpB,KAAK,WAAaA,EAClB,KAAK,SAAQ,EAEpB,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,IAAI,aAAaA,EAAG,CACZA,GAAK,KAAK,gBACV,KAAK,cAAgBA,EACrB,KAAK,SAAQ,EAEpB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,WAAWA,EAAG,CACV,KAAK,cAAgBA,IACrB,KAAK,YAAcA,EACnB,KAAK,SAAQ,EAEpB,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,IAAI,aAAaA,EAAG,CACZ,KAAK,gBAAkBA,IACvB,KAAK,cAAgBA,EACrB,KAAK,SAAQ,EAEpB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACT,KAAK,aAAeA,IACpB,KAAK,WAAaA,EAClB,KAAK,SAAQ,EAEpB,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,cAAcA,EAAG,CACb,KAAK,iBAAmBA,IACxB,KAAK,eAAiBA,EACtB,KAAK,SAAQ,EAEpB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAG,CACP,KAAK,WAAaA,IAClB,KAAK,SAAWA,EAChB,KAAK,SAAQ,EAEpB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACR,KAAK,YAAcA,IACnB,KAAK,UAAYA,EACjB,KAAK,SAAQ,EAEpB,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,eACf,CAED,IAAI,eAAeA,EAAG,CACd,KAAK,kBAAoBA,IACzB,KAAK,gBAAkBA,EACvB,KAAK,SAAQ,EAEpB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACT,KAAK,aAAeA,IACpB,KAAK,WAAaA,EAClB,KAAK,SAAQ,EAEpB,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,YAAYA,EAAG,CACX,KAAK,eAAiBA,IACtB,KAAK,aAAeA,EACpB,KAAK,SAAQ,EAEpB,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,IAAI,aAAaA,EAAG,CACZ,KAAK,gBAAkBA,IACvB,KAAK,cAAgBA,EACrB,KAAK,SAAQ,EAEpB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACN,KAAK,UAAYA,IACjB,KAAK,QAAUA,EACf,KAAK,SAAQ,EAEpB,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,YAAYA,EAAG,CACX,KAAK,eAAiBA,IACtB,KAAK,aAAeA,EACpB,KAAK,SAAQ,EAEpB,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,cAAcA,EAAG,CACb,KAAK,iBAAmBA,IACxB,KAAK,eAAiBA,EACtB,KAAK,SAAQ,EAEpB,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,cAAcA,EAAG,CACb,KAAK,iBAAmBA,IACxB,KAAK,eAAiBA,EACtB,KAAK,SAAQ,EAEpB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,WAAWA,EAAG,CACV,KAAK,cAAgBA,IACrB,KAAK,YAAcA,EACnB,KAAK,SAAQ,EAEpB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACT,KAAK,aAAeA,IACpB,KAAK,WAAaA,EAClB,KAAK,SAAQ,EAEpB,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,gBACf,CAED,IAAI,gBAAgBA,EAAG,CACf,KAAK,mBAAqBA,IAC1B,KAAK,iBAAmBA,EACxB,KAAK,SAAQ,EAEpB,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,eACf,CAED,IAAI,eAAeA,EAAG,CACd,KAAK,kBAAoBA,IACzB,KAAK,gBAAkBA,EACvB,KAAK,SAAQ,EAEpB,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,gBACf,CAED,IAAI,gBAAgBA,EAAG,CACf,KAAK,mBAAqBA,IAC1B,KAAK,iBAAmBA,EACxB,KAAK,SAAQ,EAEpB,CAED,IAAI,sBAAuB,CACvB,OAAO,KAAK,qBACf,CAED,IAAI,qBAAqBA,EAAG,CACpB,KAAK,wBAA0BA,IAC/B,KAAK,sBAAwBA,EAC7B,KAAK,SAAQ,EAEpB,CAED,IAAI,uBAAwB,CACxB,OAAO,KAAK,sBACf,CAED,IAAI,sBAAsBA,EAAG,CACrB,KAAK,yBAA2BA,IAChC,KAAK,uBAAyBA,EAC9B,KAAK,SAAQ,EAEpB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,MAAMA,EAAG,CACL,KAAK,SAAWA,IAChB,KAAK,OAASA,EACd,KAAK,SAAQ,EAEpB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,MAAMA,EAAG,CACL,KAAK,SAAWA,IAChB,KAAK,OAASA,EACd,KAAK,SAAQ,EAEpB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,MAAMA,EAAG,CACL,KAAK,SAAWA,IAChB,KAAK,OAASA,EACd,KAAK,SAAQ,EAEpB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,MAAMA,EAAG,CACL,KAAK,SAAWA,IAChB,KAAK,OAASA,EACd,KAAK,SAAQ,EAEpB,CAED,IAAI,kBAAmB,CACnB,OAAO,KAAK,iBACf,CAED,IAAI,iBAAiBA,EAAG,CAChB,KAAK,oBAAsBA,IAC3B,KAAK,kBAAoBA,EACzB,KAAK,SAAQ,EAEpB,CAED,IAAI,cAAcA,EAAG,CACb,KAAK,iBAAmBA,IACxB,KAAK,eAAiBA,EACtB,KAAK,SAAQ,EAEpB,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,WAAWA,EAAG,CACV,KAAK,cAAgBA,IACrB,KAAK,YAAcA,EACnB,KAAK,SAAQ,EAEpB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,WAAY,CACZ,OAAO,MAAM,SAChB,CAED,IAAI,UAAUA,EAAG,CAET,KAAK,YAAcA,IACnB,MAAM,UAAYA,EAClB,KAAK,SAAQ,EAEpB,CAED,aAAc,CACV,MAAO,CAAC,CAAC,KAAK,IACjB,CAED,cAAe,CACX,IAAI2zC,EAAQ,GAEZ,OAAI,KAAK,IAAM,GAAGA,EAAM,KAAK,KAAO,KAAK,CAAC,EACtC,KAAK,IAAM,GAAGA,EAAM,KAAK,KAAO,KAAK,CAAC,EACtC,KAAK,YAAc,UAAUA,EAAM,KAAK,KAAO,KAAK,SAAS,EAC7D,KAAK,WAAa,IAAIA,EAAM,KAAK,KAAO,KAAK,QAAQ,EACrD,KAAK,oBAAsB,GAAGA,EAAM,KAAK,KAAO,KAAK,iBAAiB,EACtE,KAAK,WAAa,MAAMA,EAAM,KAAK,MAAQ,MAAM,QAAQ,KAAK,QAAQ,EAAI,KAAK,SAAS,KAAK,GAAG,EAAI,KAAK,SAAS,EAClH,KAAK,WAAa,IAAMA,EAAM,KAAK,MAAQ,KAAK,SAAW,EAAI,EAAE,EACjE,KAAK,gBAAkB,GAAGA,EAAM,KAAK,KAAO,KAAK,aAAa,EAC9D,KAAK,YAAc,IAAOA,EAAM,KAAK,KAAO,KAAK,UAAY,EAAI,CAAC,EAClE,KAAK,cAAgB,IAAIA,EAAM,KAAK,KAAO,KAAK,YAAY,EAC5D,KAAK,aAAe,MAAMA,EAAM,KAAK,KAAO,KAAK,UAAU,EAC3D,KAAK,eAAiB,cAAcA,EAAM,KAAK,KAAO,KAAK,YAAY,EACvE,KAAK,YAAc,QAAQA,EAAM,KAAK,KAAO,KAAK,SAAS,EAC3D,KAAK,gBAAkB,OAAOA,EAAM,KAAK,KAAO,KAAK,aAAa,EAClE,KAAK,UAAY,MAAMA,EAAM,KAAK,KAAO,KAAK,OAAO,EACrD,KAAK,WAAa,GAAGA,EAAM,KAAK,KAAO,KAAK,QAAQ,EACpD,KAAK,iBAAmB,MAAMA,EAAM,KAAK,KAAO,KAAK,cAAc,EACvEA,EAAM,KAAK,KAAO,KAAK,SAAS,EAC5B,KAAK,YAAc,YAAYA,EAAM,KAAK,KAAO,KAAK,UAAU,SAAS,EAAE,CAAC,EAC5E,KAAK,cAAgB,GAAGA,EAAM,KAAK,KAAO,KAAK,WAAW,EAC1D,KAAK,eAAiB,GAAGA,EAAM,KAAK,KAAO,KAAK,YAAY,EAC5D,KAAK,SAAW,IAAOA,EAAM,KAAK,MAAQ,KAAK,OAAS,EAAI,EAAE,EAC9D,KAAK,cAAgB,YAAYA,EAAM,KAAK,KAAO,KAAK,YAAY,SAAS,EAAE,CAAC,EAChF,KAAK,gBAAkB,GAAGA,EAAM,KAAK,KAAO,KAAK,aAAa,EAC9D,KAAK,gBAAkB,GAAGA,EAAM,KAAK,KAAO,KAAK,aAAa,EAC9D,KAAK,aAAe,GAAGA,EAAM,KAAK,KAAO,KAAK,UAAU,EACxD,KAAK,YAAc,IAAOA,EAAM,KAAK,MAAQ,KAAK,UAAY,EAAI,EAAE,EACpE,KAAK,kBAAoB,GAAGA,EAAM,KAAK,KAAO,KAAK,eAAe,EAClE,KAAK,iBAAmB,YAAYA,EAAM,KAAK,KAAO,KAAK,eAAe,SAAS,EAAE,CAAC,EACtF,KAAK,kBAAoB,MAAMA,EAAM,KAAK,KAAO,KAAK,eAAe,EACrE,KAAK,uBAAyB,MAAMA,EAAM,KAAK,KAAO,KAAK,oBAAoB,EAC/E,KAAK,wBAA0B,MAAMA,EAAM,KAAK,KAAO,KAAK,qBAAqB,EACjF,KAAK,gBAAkB,MAAMA,EAAM,KAAK,KAAO,KAAK,aAAa,EACjE,KAAK,aAAe,MAAMA,EAAM,KAAK,KAAO,KAAK,UAAU,EAE3D,KAAK,OAAOA,EAAM,KAAK,MAAQ,KAAK,KAAK,EACzC,KAAK,OAAOA,EAAM,KAAK,MAAQ,KAAK,KAAK,EACzC,KAAK,OAAOA,EAAM,KAAK,MAAQ,KAAK,KAAK,EACzC,KAAK,OAAOA,EAAM,KAAK,MAAQ,KAAK,KAAK,EAEzC,KAAK,kBAAkBA,EAAM,KAAK,KAAO,KAAK,iBAAmB,EAAI,CAAC,EAEjE,MAAQA,EAAM,KAAK,GAAG,EAAI,IAAM,KAAK,IAEjD,CAED,kBAAmB,CACf,MAAMrpB,EAAO,KAAK,YAEZrW,EAAK,KAAK,MAAM,GAEtB,OAAO,SAAUsmC,EAAI,CACjB,MAAMzvC,EAAS,KAAK,MAAM,SAAS,iBAAgB,EAC7C6H,EAAY2X,EAAK,iBACnB,IAAIo2B,GAA4B,KAAK,MAAO51C,EAAQwf,CAAI,EACxD,IAAIk2B,GAAoB,KAAK,MAAO11C,EAAQwf,CAAI,EAE9CjpB,EAAIsR,EAAS,OAEb6vC,EAAY,GAEZC,EAAW,KAAK,MAAM,UAAU,WAAW,EACjD,IAAIC,EAAU,GAGV7O,EAAM,UAAU4O,CAAQ,EACxBC,EAAUD,EACH5O,EAAM,SAAS4O,CAAQ,IAE9BC,EADkB,KAAK,MAAM,mBAAkB,GACxBD,EAAS,WAAan4B,EAAK,UAAYm4B,EAAS,UAGvExuC,GAAMyuC,IACNF,EAAUvuC,EAAG,kBAAkB,EAAIA,EAAG,SAGtC5S,EACAA,EAAE,KAAK,IAAM,CAETk5C,EAAG,KAAM,OAAO,OAAO,CACnB,WAAY5nC,EAAS,WACrB,SAAU,GACV,UAAW6vC,CACnC,EAAuB,KAAK,MAAM,SAAS,kCAAkC13C,CAAM,CAAC,CAAC,CACrF,CAAiB,EAAE,MAAOtJ,GAAQ,CACd+4C,EAAG/4C,CAAG,CAC1B,CAAiB,EAED+4C,EAAG,KAAM,OAAO,OAAO,CACnB,WAAY5nC,EAAS,WACrB,SAAU,GACV,UAAW6vC,CAC/B,EAAmB,KAAK,MAAM,SAAS,kCAAkC13C,CAAM,CAAC,CAAC,CAEjF,CACK,CAGD,gBAAiB,CACb,MAAM20C,EAAc,MAAM,iBAC1B,OAAI,KAAK,OAAS,KAAIA,EAAY,KAAU,KAAK,MAC7C,KAAK,IAAM,IAAGA,EAAY,EAAO,KAAK,GACtC,KAAK,IAAM,IAAGA,EAAY,EAAO,KAAK,GACtC,KAAK,YAAc,WAAUA,EAAY,UAAe,KAAK,WAC7D,KAAK,WAAa,KAAIA,EAAY,SAAc,KAAK,UACrD,KAAK,oBAAsB,IAAGA,EAAY,kBAAuB,KAAK,mBACtE,KAAK,WAAa,OAAMA,EAAY,SAAc,KAAK,UACvD,KAAK,WAAa,KAAMA,EAAY,SAAc,KAAK,UACvD,KAAK,gBAAkB,IAAGA,EAAY,cAAmB,KAAK,eAC9D,KAAK,YAAc,KAAOA,EAAY,UAAe,KAAK,WAC1D,KAAK,cAAgB,KAAIA,EAAY,aAAkB,KAAK,cAC5D,KAAK,aAAe,OAAMA,EAAY,WAAgB,KAAK,YAC3D,KAAK,eAAiB,eAAcA,EAAY,aAAkB,KAAK,cACvE,KAAK,YAAc,SAAQA,EAAY,UAAe,KAAK,WAC3D,KAAK,gBAAkB,QAAOA,EAAY,cAAmB,KAAK,eAClE,KAAK,UAAY,OAAMA,EAAY,QAAa,KAAK,SACrD,KAAK,WAAa,IAAGA,EAAY,SAAc,KAAK,UACpD,KAAK,iBAAmB,OAAMA,EAAY,eAAoB,KAAK,gBACnE,KAAK,YAAc,KAAK,MAAM,UAAU,WAAW,IAAGA,EAAY,UAAe,KAAK,WACtF,KAAK,YAAc,aAAYA,EAAY,UAAe,KAAK,WAC/D,KAAK,cAAgB,IAAGA,EAAY,YAAiB,KAAK,aAC1D,KAAK,eAAiB,IAAGA,EAAY,aAAkB,KAAK,cAC5D,KAAK,SAAW,KAAOA,EAAY,OAAY,KAAK,QACpD,KAAK,cAAgB,aAAYA,EAAY,YAAiB,KAAK,aACnE,KAAK,gBAAkB,IAAGA,EAAY,cAAmB,KAAK,eAC9D,KAAK,gBAAkB,IAAGA,EAAY,cAAmB,KAAK,eAC9D,KAAK,aAAe,IAAGA,EAAY,WAAgB,KAAK,YACxD,KAAK,YAAc,KAAOA,EAAY,UAAe,KAAK,WAC1D,KAAK,kBAAoB,IAAGA,EAAY,gBAAqB,KAAK,iBAClE,KAAK,iBAAmB,aAAYA,EAAY,eAAoB,KAAK,gBACzE,KAAK,kBAAoB,IAAGA,EAAY,gBAAqB,KAAK,iBAClE,KAAK,uBAAyB,IAAGA,EAAY,qBAA0B,KAAK,sBAC5E,KAAK,wBAA0B,IAAGA,EAAY,sBAA2B,KAAK,uBAC9E,KAAK,gBAAkB,IAAGA,EAAY,cAAmB,KAAK,eAC9D,KAAK,aAAe,IAAGA,EAAY,WAAgB,KAAK,YAExD,KAAK,QAAOA,EAAY,MAAW,KAAK,OACxC,KAAK,QAAOA,EAAY,MAAW,KAAK,OACxC,KAAK,QAAOA,EAAY,MAAW,KAAK,OACxC,KAAK,QAAOA,EAAY,MAAW,KAAK,OAExC,KAAK,mBAAkBA,EAAY,SAAc,KAAK,kBACnDA,CACV,CAED,WAAY,CACR,IAAI70B,EAAM,GACV,OAAAA,EAAI,KAAO,KAAK,MAChBA,EAAI,EAAI,KAAK,GACbA,EAAI,EAAI,KAAK,GACbA,EAAI,UAAY,KAAK,WACrBA,EAAI,SAAW,KAAK,UACpBA,EAAI,kBAAoB,KAAK,mBAC7BA,EAAI,SAAW,KAAK,UACpBA,EAAI,SAAW,KAAK,UACpBA,EAAI,cAAgB,KAAK,eACzBA,EAAI,UAAY,KAAK,WACrBA,EAAI,aAAe,KAAK,cACxBA,EAAI,WAAa,KAAK,YACtBA,EAAI,aAAe,KAAK,cACxBA,EAAI,UAAY,KAAK,WACrBA,EAAI,cAAgB,KAAK,eACzBA,EAAI,QAAU,KAAK,SACnBA,EAAI,SAAW,KAAK,UACpBA,EAAI,eAAiB,KAAK,gBAC1BA,EAAI,UAAY,KAAK,WACrBA,EAAI,UAAY,KAAK,WACrBA,EAAI,YAAc,KAAK,aACvBA,EAAI,aAAe,KAAK,cACxBA,EAAI,OAAS,KAAK,QAClBA,EAAI,YAAc,KAAK,aACvBA,EAAI,cAAgB,KAAK,eACzBA,EAAI,cAAgB,KAAK,eACzBA,EAAI,WAAa,KAAK,YACtBA,EAAI,UAAY,KAAK,WACrBA,EAAI,gBAAkB,KAAK,iBAC3BA,EAAI,eAAiB,KAAK,gBAC1BA,EAAI,gBAAkB,KAAK,iBAC3BA,EAAI,qBAAuB,KAAK,sBAChCA,EAAI,sBAAwB,KAAK,uBACjCA,EAAI,cAAgB,KAAK,eACzBA,EAAI,WAAa,KAAK,YACtBA,EAAI,MAAQ,KAAK,OACjBA,EAAI,MAAQ,KAAK,OACjBA,EAAI,MAAQ,KAAK,OACjBA,EAAI,MAAQ,KAAK,OACjBA,EAAI,iBAAmB,KAAK,kBACrBA,CACV,CAGL,CAIA,IAAI+3B,EAAQJ,GAAY,UACxBI,EAAM,MAAQ,GACdA,EAAM,GAAK,EACXA,EAAM,GAAK,EACXA,EAAM,WAAa,SACnBA,EAAM,UAAY,GAClBA,EAAM,UAAY,KAClBA,EAAM,UAAY,GAClBA,EAAM,eAAiB,EACvBA,EAAM,WAAa,GACnBA,EAAM,cAAgB,GACtBA,EAAM,YAAc,KACpBA,EAAM,cAAgB,aACtBA,EAAM,WAAa,OACnBA,EAAM,eAAiB,MACvBA,EAAM,SAAW,KACjBA,EAAM,UAAY,EAClBA,EAAM,gBAAkB,KACxBA,EAAM,WAAa,WACnBA,EAAM,aAAe,EACrBA,EAAM,cAAgB,EACtBA,EAAM,QAAU,GAChBA,EAAM,aAAe,WACrBA,EAAM,eAAiB,EACvBA,EAAM,eAAiB,EACvBA,EAAM,YAAc,EACpBA,EAAM,WAAa,GACnBA,EAAM,iBAAmB,EACzBA,EAAM,gBAAkB,WACxBA,EAAM,iBAAmB,EACzBA,EAAM,sBAAwB,EAC9BA,EAAM,uBAAyB,EAC/BA,EAAM,eAAiB,EACvBA,EAAM,YAAc,EACpBA,EAAM,OAAS,EACfA,EAAM,OAAS,EACfA,EAAM,OAAS,EACfA,EAAM,OAAS,EACfA,EAAM,kBAAoB,GAC1BA,EAAM,mBAAqB,EC5rBZ,MAAMC,WAAsB9oC,EAAQ,CAE/C,YAAYvI,EAAO,CACf,MAAMA,CAAK,EAEX,KAAK,eAAiB,MACzB,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,cAAcvR,EAAG,CACbA,IAAM,KAAK,iBACPA,EAAE,kBAEF,KAAK,WAAa,KAAK,MAAM,mBAAkB,GAEnD,KAAK,eAAiBA,EACtB,KAAK,SAAQ,EAEpB,CAED,mBAAoB,CAChB,OAAO,KAAK,cACf,CAEL,CC3Be,MAAMnC,WAAmBsM,CAAa,CAEjD,YAAY8E,EAAS7E,EAAUinB,EAASjqB,EAAU,CAC9C,QAEA,KAAK,QAAU6H,EAEf,KAAK,UAAY7E,EAEjB,KAAK,SAAWinB,EAEhB,KAAK,QAAUA,EAAQ,YAAY,UAAUjqB,CAAQ,EACrD,KAAK,QAAUiqB,EAAQ,YAAY,UAAUjqB,CAAQ,EAErD,KAAK,QAAUgD,EAAS,OAEnB,KAAK,UACN,KAAK,QAAUinB,EAAQ,YAAY,UAAUjqB,CAAQ,GAGzD,KAAK,YAAc,KAAK,QAAQ,KAAK,QAAQ,EAC7C,KAAK,aAAe,KAAK,YAEzB,KAAK,GAAK,EACV,KAAK,WAAa,CACrB,CAED,MAAMy7C,EAAa,CACf,KAAK,YAAc,KAAK,QAAQ,KAAK,QAAQ,EAExC,KAAK,aAMFA,IAAgB,KAAK,YACrB,KAAK,MAAMA,EAAa,CAAC,GAEzB,KAAK,aAAeA,EACpB,KAAK,GAAK,EACV,KAAK,WAAa,KAAK,UAAU,MACjC,KAAK,KAAK,OAAO,EACjB,KAAK,IAAG,IAXZ,KAAK,aAAeA,EACpB,KAAK,GAAK,EACV,KAAK,iBAAgB,EAY5B,CAED,QAAS,CACD,KAAK,GAAK,IAEV,KAAK,GAAK,EAEjB,CAED,MAAO,CAEH,KAAK,KAAK,MAAM,EAChB,KAAK,QAAQ,aAAa,IAAI,CACjC,CAED,OAAQ,CACJ,KAAK,KAAI,CACZ,CAED,MAAO,CACH,KAAK,QAAQ,UAAU,IAAI,CAC9B,CAED,MAAMA,EAAaxhD,EAAG,CACb,KAAK,cAON,KAAK,YAAc,KAAK,QAAQ,KAAK,QAAQ,EAC7C,KAAK,aAAewhD,EACpB,KAAK,GAAKxhD,EACV,KAAK,IAAG,IARR,KAAK,YAAc,KAAK,QAAQ,KAAK,QAAQ,EAC7C,KAAK,aAAewhD,EACpB,KAAK,GAAK,EACV,KAAK,iBAAgB,EAO5B,CAED,kBAAmB,CACf,KAAK,QAAQ,KAAK,SAAU,KAAK,aAAY,CAAE,CAClD,CAED,KAAM,CACF,KAAK,QAAQ,UAAU,IAAI,CAC9B,CAED,YAAa,CACT,OAAO,KAAK,SAAS,QACxB,CAED,WAAY,CACR,OAAQ,KAAK,GAAK,CACrB,CAED,SAASt0C,EAAI,CAMT,GALK,KAAK,eAEN,KAAK,GAAK,GAGV,KAAK,EAAI,EAAG,CACZ,GAAI,KAAK,UAAY,EAGjB,GAFA,KAAK,YAAcA,EAEf,KAAK,UAAY,EACjBA,EAAK,CAAC,KAAK,UACX,KAAK,WAAa,EAElB,KAAK,KAAK,UAAU,MAEpB,QAIJ,KAAK,UAAU,UAAY,EAC3B,KAAK,GAAK,EAEV,KAAK,IAAMA,EAAK,KAAK,UAAU,SAE/B,KAAK,IAAM,IAEX,KAAK,GAAK,EAEjB,CAED,KAAK,iBAAgB,EAErB,KAAK,gBAAe,CACvB,CAED,iBAAkB,CACd,KAAK,KAAK,WAAY,KAAK,CAAC,EACxB,KAAK,IAAM,GACX,KAAK,KAAK,QAAQ,CAEzB,CAED,kBAAkBs0C,EAAa,CAC3B,IAAIx/C,EAAI,KAAK,UAAU,mBAAmB,KAAK,CAAC,EAC5CA,IAAM,EACN,KAAK,aAAew/C,EACbx/C,IAAM,GACb,KAAK,YAAc,KAAK,aACxB,KAAK,aAAew/C,IAEpB,KAAK,YAAcA,GAAgBA,EAAc,KAAK,eAAiB,EAAIx/C,GAC3E,KAAK,aAAew/C,EAE3B,CAED,cAAe,CACX,GAAI,KAAK,GAAK,EACV,OAAO,KAAK,YACT,CACH,IAAI7iD,EAAI,KAAK,UAAU,oBAAoB,KAAK,CAAC,EACjD,OAAO,KAAK,QAAQ,KAAK,YAAa,KAAK,WAAYA,CAAC,CAC3D,CACJ,CAED,WAAY,CACR,KAAK,WAAa,CACrB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAYA,CACpB,CAEL,CAEAnC,GAAW,UAAU,aAAe,GCrMrB,MAAMilD,EAAW,CAE5B,aAAc,CACV,KAAK,OAAS,GACd,KAAK,MAAQ,CAAE,CAClB,CAED,KAAM,CACF,OAAO,KAAK,MACf,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OAAO,CAAC,CACvB,CAED,IAAI,MAAO,CACP,OAAO,KAAK,OAAO,OAAS,KAAK,OAAO,KAAK,OAAO,OAAS,CAAC,EAAI,MACrE,CAED,IAAIn8C,EAAM,CACN,KAAK,MAAMA,EAAM,KAAK,OAAO,MAAM,CACtC,CAED,MAAMA,EAAM3B,EAAO,CACf,GAAIA,GAAS,GAAKA,GAAS,KAAK,OAAO,OAAQ,CAC3C,IAAI+9C,EAAe,KAAK,OAAO,QAAQp8C,CAAI,EAC3C,GAAIo8C,IAAiB/9C,EACjB,OAAO2B,EAGX,GAAIktC,EAAM,gBAAgBltC,CAAI,EAAG,CAC7B,MAAM3D,EAAI2D,EACVA,EAAO,KAAK,WAAW3D,CAAC,EACxB2D,EAAK,MAAM3D,CAAC,CACf,CAEG+/C,GAAgB,GAChB,KAAK,MAAMp8C,EAAM3B,CAAK,GAElB2B,EAAK,MACL,KAAK,MAAMA,EAAK,GAAG,EAAIA,GAE3B,KAAK,OAAO,OAAO3B,EAAO,EAAG2B,CAAI,EACjC,KAAK,MAAMA,EAAM3B,CAAK,EAEtC,KACY,OAAM,IAAI,MAAM,oBAAsBA,EAAQ,qBAAuB,KAAK,OAAO,MAAM,CAE9F,CAED,aAAa2B,EAAM,CACf,GAAIA,EAAK,IAAK,CACV,MAAMq8C,EAAe,KAAK,SAASr8C,EAAK,GAAG,EAC3C,GAAI,CAACq8C,EACD,MAAM,IAAI,MAAM,+CAAiDr8C,EAAK,GAAG,EAE7E,KAAK,QAAQA,EAAMq8C,CAAY,CAC3C,KACY,OAAM,IAAI,MAAM,wCAAwC,EAE5D,KAAK,MAAMr8C,EAAM,KAAK,OAAO,MAAM,CAEtC,CAED,QAAQA,EAAMs8C,EAAU,CACpB,MAAMj+C,EAAQ,KAAK,SAASi+C,CAAQ,EACpC,GAAIj+C,IAAU,GACV,MAAM,IAAI,MAAM,2CAA2C,EAE/D,KAAK,MAAM2B,EAAM3B,CAAK,CACzB,CAED,MAAM2B,EAAM3B,EAAO,CACf,GAAIA,GAAS,GAAKA,GAAS,KAAK,OAAO,OAAQ,CAE3C,GAAI6uC,EAAM,gBAAgBltC,CAAI,EAAG,CAC7B,MAAM3D,EAAI2D,EACVA,EAAO,KAAK,WAAW3D,CAAC,EACxB2D,EAAK,MAAM3D,CAAC,CACf,CAED,IAAI+/C,EAAe,KAAK,OAAO,QAAQp8C,CAAI,EAC3C,GAAIo8C,GAAgB,IAChB,GAAIA,IAAiB/9C,EAAO,CACxB,MAAM82C,EAAYiH,EACdjH,IAAc92C,IACd,KAAK,OAAO,OAAO82C,EAAW,CAAC,EAC/B,KAAK,OAAO,OAAO92C,EAAO,EAAG2B,CAAI,EACjC,KAAK,OAAOA,EAAMm1C,EAAW92C,CAAK,EAEzC,UAEGA,EAAQ,KAAK,OAAO,OAAO,CAEvB,KAAK,OAAOA,CAAK,EAAE,MACnB,KAAK,MAAM,KAAK,OAAOA,CAAK,EAAE,GAAG,EAAI,QAGzC,MAAMi+C,EAAW,KAAK,OAAOj+C,CAAK,EAGlC,KAAK,OAAOA,CAAK,EAAI2B,EAEjBA,EAAK,MACL,KAAK,MAAMA,EAAK,GAAG,EAAIA,GAG3B,KAAK,MAAMA,EAAM3B,EAAOi+C,CAAQ,CACpD,KACoB,OAAM,IAAI,MAAM,oBAAsBj+C,EAAQ,qBAAuB,KAAK,OAAO,MAAM,CAG3G,KACY,OAAM,IAAI,MAAM,oBAAsBA,EAAQ,qBAAuB,KAAK,OAAO,MAAM,CAE9F,CAED,MAAMA,EAAO,CACT,OAAO,KAAK,OAAOA,CAAK,CAC3B,CAED,SAAS2B,EAAM,CACX,OAAO,KAAK,OAAO,QAAQA,CAAI,CAClC,CAED,OAAOA,EAAM,CACT,IAAI3B,EAAQ,KAAK,OAAO,QAAQ2B,CAAI,EAEhC3B,IAAU,IACV,KAAK,SAASA,CAAK,CAE1B,CAED,SAASA,EAAO,CACZ,GAAIA,GAAS,GAAKA,EAAQ,KAAK,OAAO,OAAQ,CAC1C,MAAM2B,EAAO,KAAK,OAAO3B,CAAK,EAE9B,OAAI2B,EAAK,MACL,KAAK,MAAMA,EAAK,GAAG,EAAI,QAG3B,KAAK,OAAO,OAAO3B,EAAO,CAAC,EAE3B,KAAK,SAAS2B,EAAM3B,CAAK,EAElB2B,CACnB,KACY,OAAM,IAAI,MAAM,uBAAuB,OAAA3B,EAAK,sBAAqB,YAAK,OAAO,OAAS,EAAG,CAEhG,CAED,OAAQ,CAEJ,GADQ,KAAK,OAAO,OACb,CACH,IAAI/B,EAAO,KAAK,OAChB,KAAK,OAAS,GACd,KAAK,MAAQ,CAAE,EACf,KAAK,OAAOA,EAAM,CAAE,EAAE,CAAE,EAC3B,CACJ,CAED,EAAED,EAAG,CACD,GAAI6wC,EAAM,gBAAgB7wC,CAAC,EAAG,CAC1B,IAAI1D,EAAI,KAAK,WAAW0D,CAAC,EACzB,OAAA1D,EAAE,MAAM0D,CAAC,EACT,KAAK,IAAI1D,CAAC,EACHA,CACV,SAAU,MAAM,QAAQ0D,CAAC,EAAG,CACzB,QAASpI,EAAI,EAAGsK,EAAIlC,EAAE,OAAQpI,EAAIsK,EAAGtK,IACjC,KAAK,EAAEoI,EAAEpI,CAAC,CAAC,EAEf,OAAO,IACV,SAAU,KAAK,OAAOoI,CAAC,EACpB,YAAK,IAAIA,CAAC,EACHA,CAEd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,UAAW,CACP,OAAO,KAAK,KACf,CAED,SAASuR,EAAK,CACV,OAAO,KAAK,MAAMA,CAAG,CACxB,CAED,SAASA,EAAK,CACV,OAAO,KAAK,MAAMA,CAAG,CACxB,CAED,OAAOA,EAAKtL,EAAO,CACf,KAAK,MAAMsL,CAAG,EAAItL,CACrB,CAED,MAAMmB,EAAU,CACRypC,EAAM,gBAAgBzpC,CAAQ,EAC9B,KAAK,aAAaA,CAAQ,EACnB,MAAM,QAAQA,CAAQ,GAC7B,KAAK,YAAYA,CAAQ,CAEhC,CAED,aAAaA,EAAU,CAEnB,IAAI84C,EAAO,KAAK,WACZC,EAAQ,OAAO,KAAK/4C,CAAQ,EAChC,QAASxP,EAAI,EAAGsK,EAAIi+C,EAAM,OAAQvoD,EAAIsK,EAAGtK,IAAK,CAC1C,IAAIwoD,EAAOD,EAAMvoD,CAAC,EACdqE,EAAImL,EAASg5C,CAAI,EAEjB9jD,EAAI4jD,EAAKE,CAAI,EACjB,GAAI,CAAC9jD,EACG,KAAK,OAAOL,CAAC,GAEbA,EAAE,IAAMmkD,EACR,KAAK,IAAInkD,CAAC,IAGVK,EAAI,KAAK,WAAWL,CAAC,EACrBK,EAAE,IAAM8jD,EACR9jD,EAAE,MAAML,CAAC,EACT,KAAK,IAAIK,CAAC,WAGV,KAAK,OAAOL,CAAC,GACb,GAAIK,IAAML,EAAG,CAET,IAAIoV,EAAM,KAAK,SAAS/U,CAAC,EACzBL,EAAE,IAAMmkD,EACR,KAAK,MAAMnkD,EAAGoV,CAAG,CACpB,OAED/U,EAAE,MAAML,CAAC,CAGpB,CACJ,CAED,aAAaywB,EAAO,CAChB,IAAI2zB,EAAO,GACX,GAAI3zB,EAAM,SAAW,KAAK,OAAO,OAC7B,QAAS,EAAI,EAAGxqB,EAAI,KAAK,OAAO,OAAS,EAAIA,GAAMm+C,EAAM,IACrDA,EAAOA,GAAS,KAAK,OAAO,CAAC,IAAM3zB,EAAM,CAAC,OAG9C2zB,EAAO,GAEX,OAAOA,CACV,CAED,YAAY3zB,EAAO,CAEf,GAAI,KAAK,aAAaA,CAAK,EACvB,OAGJ,QAAS90B,EAAI,EAAGsK,EAAI,KAAK,OAAO,OAAQtK,EAAIsK,EAAGtK,IAC3C,KAAK,OAAOA,CAAC,EAAE,OAAS,GAG5B,IAAIsoD,EACAl9C,EAAW,GACf,QAASpL,EAAI,EAAGsK,EAAIwqB,EAAM,OAAQ90B,EAAIsK,EAAGtK,IAAK,CAC1C,IAAIqE,EAAIywB,EAAM90B,CAAC,EACf,GAAI,KAAK,OAAOqE,CAAC,EACbA,EAAE,OAAS,GACX+G,EAAS,KAAK/G,CAAC,MACZ,CACH,IAAImkD,EAAOnkD,EAAE,IACTK,EACA8jD,IACKF,IAAMA,EAAO,KAAK,SAAQ,GAC/B5jD,EAAI4jD,EAAKE,CAAI,GAGZ9jD,EAIDA,EAAE,OAAS,GAFXA,EAAI,KAAK,WAAWL,CAAC,EAKrB40C,EAAM,gBAAgB50C,CAAC,GACvBK,EAAE,MAAML,CAAC,EAGb+G,EAAS,KAAK1G,CAAC,CAClB,CACJ,CAED,KAAK,UAAU0G,CAAQ,CAC1B,CAED,UAAUA,EAAU,CAChB,IAAIs9C,EAAY,KAAK,OACrB,KAAK,OAASt9C,EAGd,IAAI2qB,EAAU2yB,EAAU,OAAO38C,GAAQ,CAAC,IAAI0P,EAAI1P,EAAK,OAAQ,cAAOA,EAAK,OAAe0P,CAAC,CAAC,EACtFulC,EAAQ51C,EAAS,OAAOW,GAAS28C,EAAU,QAAQ38C,CAAI,IAAM,EAAG,EAEpE,GAAIgqB,EAAQ,QAAUirB,EAAM,OAAQ,CAEhC,KAAK,MAAQ,CAAE,EACf,QAAShhD,EAAI,EAAGsK,EAAI,KAAK,OAAO,OAAQtK,EAAIsK,EAAGtK,IAAK,CAChD,IAAI2Z,EAAM,KAAK,OAAO3Z,CAAC,EAAE,IACrB2Z,IACA,KAAK,MAAMA,CAAG,EAAI,KAAK,OAAO3Z,CAAC,EAEtC,CACJ,CAED,KAAK,OAAO+1B,EAASirB,EAAO51C,CAAQ,CACvC,CAED,KAAKkzC,EAAG,CACJ,MAAMvzC,EAAQ,KAAK,OAAO,MAAK,EAC/BA,EAAM,KAAKuzC,CAAC,EACZ,KAAK,YAAYvzC,CAAK,CACzB,CAED,MAAMgB,EAAM3B,EAAO,CAClB,CAED,SAAS2B,EAAM3B,EAAO,CACrB,CAED,OAAO2rB,EAASirB,EAAOC,EAAO,CAC7B,CAED,MAAMl1C,EAAM3B,EAAOi+C,EAAU,CAC5B,CAED,OAAOt8C,EAAMm1C,EAAWC,EAAS,CAChC,CAED,WAAW0C,EAAQ,CACf,MAAM,IAAI,MAAM,2DAA2D,CAC9E,CAED,OAAOA,EAAQ,CACX,MAAO,EACV,CAED,QAAQvF,EAAG,CACP,KAAK,IAAG,EAAG,QAAQA,CAAC,CACvB,CAEL,CC9Ve,MAAMqK,WAAyBT,EAAW,CAErD,YAAYzxB,EAAS,CACjB,QACA,KAAK,SAAWA,CACnB,CAED,eAAe1qB,EAAM,CACjB,MAAM+0C,EAAa/0C,EAAK,OACxB,GAAI+0C,GAAcA,IAAe,KAAK,SAAU,CAE5C,MAAM8H,EAAgB78C,EAAK,OAAO,UAC5B3B,EAAQw+C,EAAc,SAAS78C,CAAI,EAErCA,EAAK,MACL68C,EAAc,MAAM78C,EAAK,GAAG,EAAI,QAEpC68C,EAAc,OAAO,OAAOx+C,EAAO,CAAC,EAGpC02C,EAAW,KAAK,cAAc12C,CAAK,CAEtC,CAED2B,EAAK,WAAW,KAAK,QAAQ,CAGhC,CAED,MAAMA,EAAM3B,EAAO,CACf,KAAK,eAAe2B,CAAI,EACxB,KAAK,SAAS,KAAK,WAAW3B,EAAO2B,EAAK,IAAI,CACjD,CAED,SAASA,EAAM3B,EAAO,CAClB2B,EAAK,WAAW,IAAI,EACpB,KAAK,SAAS,KAAK,cAAc3B,CAAK,CACzC,CAED,OAAO2rB,EAASirB,EAAOC,EAAO,CAC1B,QAASjhD,EAAI,EAAGsK,EAAIyrB,EAAQ,OAAQ/1B,EAAIsK,EAAGtK,IACvC+1B,EAAQ/1B,CAAC,EAAE,WAAW,IAAI,EAE9B,QAASA,EAAI,EAAGsK,EAAI02C,EAAM,OAAQhhD,EAAIsK,EAAGtK,IACrC,KAAK,eAAeghD,EAAMhhD,CAAC,CAAC,EAEhC,IAAI6oD,EAAK7oD,GAAKA,EAAE,KAChB,KAAK,SAAS,KAAK,aAAa+1B,EAAQ,IAAI8yB,CAAE,EAAG7H,EAAM,IAAI6H,CAAE,EAAG5H,EAAM,IAAI4H,CAAE,CAAC,CAChF,CAED,MAAM98C,EAAM3B,EAAOi+C,EAAU,CACzBA,EAAS,WAAW,IAAI,EAExB,KAAK,eAAet8C,CAAI,EACxB,KAAK,SAAS,KAAK,WAAW3B,EAAO2B,EAAK,IAAI,CACjD,CAED,OAAOA,EAAMm1C,EAAWC,EAAS,CAC7B,KAAK,SAAS,KAAK,UAAUD,EAAWC,CAAO,CAClD,CAED,WAAW0C,EAAQ,CACf,OAAIA,EAAO,KACA,IAAIA,EAAO,KAAK,KAAK,SAAS,KAAK,EAEnC,KAAK,SAAS,MAAM,cAAa,CAE/C,CAED,OAAOA,EAAQ,CACX,OAAOA,EAAO,SACjB,CAEL,CCnEe,MAAMiF,CAAQ,CAEzB,YAAYnyC,EAAO,CACf,KAAK,MAAQA,EAEb,KAAK,KAAOmyC,EAAQ,KAEpB,KAAK,QAAO,EAGZ,KAAK,mBAAqB,GAE1B,KAAK,OAAS,IAAI1I,GAAY,IAAI,EAMlC,KAAK,MAAQ,KAMb,KAAK,WAAa,GAMlB,KAAK,UAAY,GAMjB,KAAK,SAAW,GAKhB,KAAK,SAAW,KAMhB,KAAK,UAAY,KAMjB,KAAK,mBAAqB,KAM1B,KAAK,OAAS,KAOd,KAAK,WAAa,KAMlB,KAAK,UAAY,GAMjB,KAAK,YAAc,KAEnB,KAAK,GAAK,EAEV,KAAK,GAAK,CACb,CAED,SAAU,CACT,CAED,IAAI,IAAK,CACL,OAAO,KAAK,IACf,CAED,IAAI,IAAIzmC,EAAK,CACT,GAAI,KAAK,QAAUA,EAAK,CACpB,MAAMggC,EAAWhgC,EAAI,WAAW,CAAC,EAC5Bs/B,EAAM,SAASU,CAAQ,GACxB,KAAK,YAAY,gDAAkDhgC,CAAG,EAEtE,KAAK,QAAU,OACf,KAAK,UAAU,KAAK,KAAK,EACrB,KAAK,UACL,KAAK,SAAS,YAAY,SAAS,KAAK,KAAK,GAIrD,KAAK,MAAQA,EAET,KAAK,QACL,KAAK,QAAQ,KAAK,KAAK,EACnB,KAAK,UACL,KAAK,SAAS,YAAY,OAAO,KAAK,MAAO,IAAI,EAG5D,CACJ,CAED,IAAI,KAAM,CACN,OAAO,KAAK,KACf,CAED,IAAI,MAAO,CACP,OAAO,KAAK,MACf,CAED,WAAY,CACR,KAAK,OAAO,YACZ,KAAK,oBAAmB,EACxB,KAAK,mBAAkB,CAC1B,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,WAAW3C,EAAQ,CACX,KAAK,WAAaA,IAElB,KAAK,UACL,KAAK,iBAAgB,EAGzB,KAAK,SAAWA,EAEZA,GACA,KAAK,eAAc,EAGvB,KAAK,oBAAmB,EACxB,KAAK,mBAAkB,EACvB,KAAK,iBAAgB,EAEjB,KAAK,QAAUA,GACf,KAAK,YAAY,+DAA+D,EAEvF,CAED,UAAW,CACP,IAAIovB,EAAQ,EAER3/B,EAAI,KAAK,SACb,KAAMA,GACF2/B,IACA3/B,EAAIA,EAAE,SAGV,OAAO2/B,CACV,CAED,YAAY9+B,EAAG,CACX,IAAIb,EAAI,KACR,KAAOa,EAAI,GAAKb,EAAE,UACdA,EAAIA,EAAE,SACNa,IAEJ,OAAOb,CACV,CAED,cAAe,CACX,MAAMpE,EAAI,GACV,IAAIoE,EAAI,KACR,KAAOA,GACHpE,EAAE,KAAKoE,CAAC,EACRA,EAAIA,EAAE,SAEV,OAAOpE,CACV,CAED,mBAAmB+jC,EAAO,CACtB,IAAI2iB,EAAS,KAAK,SAAQ,EAAK3iB,EAC/B,OAAI2iB,EAAS,EACF,KAEJ,KAAK,YAAYA,CAAM,CACjC,CAED,aAAarkD,EAAG,CACZ,IAAI+B,EAAI/B,EACR,KAAM+B,EAAIA,EAAE,QACR,GAAI,OAASA,EACT,MAAO,GAGf,MAAO,EACV,CAED,kBAAkB/B,EAAG,CACjB,IAAIskD,EAAK,KACLC,EAAKvkD,EACLwkD,EAAKF,EAAG,WACRG,EAAKF,EAAG,WACRC,EAAKC,EACLH,EAAKA,EAAG,YAAYE,EAAKC,CAAE,EACpBA,EAAKD,IACZD,EAAKA,EAAG,YAAYE,EAAKD,CAAE,GAG/B,EAAG,CACC,GAAIF,IAAOC,EACP,OAAOD,EAGXA,EAAKA,EAAG,SACRC,EAAKA,EAAG,QACpB,OAAiBD,GAAMC,GAEf,OAAO,IACV,CAED,IAAI,UAAW,CACX,OAAO,KAAK,UACf,CAED,IAAI,SAAU,CACV,OAAO,KAAK,SACf,CAED,IAAI,QAAS,CACT,OAAO,KAAK,QACf,CAED,aAAc,CACV,OAAQ,KAAK,SAAW,KAAK,SAAS,WAAc,KAAK,MAAM,OAAS,IAC3E,CAED,YAAa,CACT,OAAO,KAAK,OAAO,SAAY,KAAK,OAAO,MAAQ,IAAO,KAAK,SAAW,KAAK,SAAS,UAAa,KAAK,MAAM,OAAS,KAC5H,CAED,WAAY,CACR,OAAO,KAAK,cAAgB,KAAK,kBACpC,CAKD,qBAAsB,CAClB,IAAIG,EAAc,KAAK,cACvB,GAAI,KAAK,aAAeA,EAAa,CACjC,KAAK,WAAaA,EAEdA,GACA,KAAK,SAAQ,EAGjB,IAAIrgD,EAAW,KAAK,UAAU,IAAG,EACjC,GAAIA,EAAU,CACV,IAAI0S,EAAI1S,EAAS,OACjB,GAAI0S,EAAI,EACJ,QAASzb,EAAI,EAAGA,EAAIyb,EAAGzb,IACnB+I,EAAS/I,CAAC,EAAE,qBAGvB,CAEGopD,EACA,KAAK,UAAS,EAEd,KAAK,UAAS,CAErB,CACJ,CAKD,oBAAqB,CACjB,IAAIC,EAAa,KAAK,aACtB,GAAI,KAAK,YAAcA,EAAY,CAC3BA,GACA,KAAK,WAAU,EACf,KAAK,gBAAe,IAEpB,KAAK,YAAW,EAChB,KAAK,kBAAiB,GAG1B,IAAItgD,EAAW,KAAK,UAAU,IAAG,EACjC,GAAIA,EAAU,CACV,IAAI0S,EAAI1S,EAAS,OACjB,GAAI0S,EAAI,EACJ,QAASzb,EAAI,EAAGA,EAAIyb,EAAGzb,IACnB+I,EAAS/I,CAAC,EAAE,oBAGvB,CACJ,CACJ,CAED,iBAAkB,CACd,KAAK,UAAY,GAGjB,KAAK,kBAAiB,EACtB,KAAK,qBAAoB,EAErB,KAAK,WACL,KAAK,UAAU,WAAW,IAAI,EAG9B,KAAK,oBACL,KAAK,eAAc,EAGnB,KAAK,OAAO,QACZ,KAAK,OAAO,OAAO,WAAW,KAAK,MAAM,CAGhD,CAED,mBAAoB,CACZ,KAAK,UACL,KAAK,iBAAgB,EAGrB,KAAK,WACL,KAAK,UAAU,cAAc,IAAI,EAGjC,KAAK,OAAO,QACZ,KAAK,OAAO,OAAO,cAAc,KAAK,MAAM,EAG5C,KAAK,aACL,KAAK,WAAW,QAAQ,QAAQg6B,GAAUA,EAAO,cAAc,KAAK,MAAM,CAAC,EAG/E,KAAK,UAAY,EACpB,CAED,gBAAiB,CACb,KAAK,SAAW,GAGZ,KAAK,WACL,KAAK,UAAU,iBAGf,KAAK,WACL,KAAK,eAAc,EAEvB,KAAK,UAAS,CACjB,CAED,kBAAmB,CACX,KAAK,WACL,KAAK,UAAU,iBAGnB,KAAK,SAAW,GACZ,KAAK,WACL,KAAK,gBAAe,EAGpB,KAAK,kBACL,KAAK,WAAW,aAGpB,KAAK,YAAW,CACnB,CAED,UAAW,CACV,CAED,WAAY,CACX,CAED,WAAY,CACX,CAED,YAAa,CACZ,CAED,aAAc,CACb,CAED,WAAY,CACX,CAED,aAAc,CACb,CAED,WAAY,CACX,CAED,iBAAkB,CACd,OAAI,KAAK,GACE,KAAK,GACL,KAAK,mBACL,KAAK,mBAAmB,iBACxB,KAAK,UAEL,KAAK,UAAU,iBAEf,CAEd,CAED,kBAAmB,CACf,OAAI,KAAK,GACE,KAAK,GACL,KAAK,mBACL,KAAK,mBAAmB,kBACxB,KAAK,UAEL,KAAK,UAAU,kBAEf,CAEd,CAED,IAAI,aAAc,CACd,OAAI,KAAK,UAEE,KAAK,OAAO,iBAEZ,KAAK,iBAEnB,CAED,IAAI,cAAe,CACf,OAAI,KAAK,UACE,KAAK,OAAO,kBAEZ,KAAK,kBAEnB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,CACtB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,CACtB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,CACtB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,CACtB,CAED,iBAAkB,CACd,OAAO,KAAK,WAAa,KAAK,UAAU,SAAQ,CACnD,CAED,aAAc,CACN,KAAK,YACL,KAAK,UAAU,QAEX,CAAC,KAAK,UAAU,OAAQ,GAAI,CAAC,KAAK,eAGlC,KAAK,kBAAiB,EAGjC,CAED,qBAAsB,CAElB,MAAMqqB,EAAY,KAAK,UAAU,UAC7BA,GACA,KAAK,KAAK,UAAWA,EAAW,KAAK,UAAU,OAAO,CAE7D,CAED,gBAAiB,CACT,KAAK,UAAU,WACf,KAAK,qBAAqB,KAAK,SAAS,GAGxC,KAAK,qBAAqB,IAAI,EAE9B,KAAK,oBAAmB,EAE/B,CAED,iBAAkB,CAGd,KAAK,qBAAqB,IAAI,CACjC,CAED,IAAI,SAAU,CACV,OAAO,KAAK,SACf,CAED,IAAI,QAAQj/C,EAAG,CACX,IAAI8J,EACJ,GAAI+pC,EAAM,gBAAgB7zC,CAAC,EACnBA,EAAE,KACF8J,EAAU,IAAI9J,EAAE,KAAK,KAAK,KAAK,EAE/B8J,EAAU,KAAK,QAGfA,GACA0qC,GAAK,YAAY1qC,EAAS9J,CAAC,UAExB,CAACA,EACR8J,EAAU,aAEN9J,EAAE,UACF8J,EAAU9J,UACHA,EAAE,gBACT8J,EAAU,IAAI84C,GAAc,KAAK,KAAK,EACtC94C,EAAQ,cAAgB9J,MACrB,CACH,QAAQ,MAAM,4CAA4C,EAC1D,MACH,CAGL,MAAMkkD,EAAc,KAAK,UACrBp6C,IAAYo6C,IACZ,KAAK,UAAYp6C,EAEb,KAAK,UACD,KAAK,YACL,KAAK,UAAU,WAAW,IAAI,EAE1B,KAAK,qBACD,KAAK,UAAU,WACf,KAAK,qBAAqB,KAAK,SAAS,EAExC,KAAK,oBAAmB,IAMpC,KAAK,qBAAqB,IAAI,EAG9Bo6C,GAAeA,IAAgB,KAAK,oBACpCA,EAAY,cAAc,IAAI,EAGlC,KAAK,kBAAiB,EAE7B,CAED,IAAI,kBAAmB,CACnB,OAAO,KAAK,kBACf,CAED,qBAAqBlkD,EAAG,CACpB,IAAIkkD,EAAc,KAAK,mBAEnBA,GAAgBlkD,IAAMkkD,GAClB,KAAK,YAAcA,GAEnBA,EAAY,cAAc,IAAI,EAItC,MAAMC,EAAa,KAAK,OAAO,uBACzBC,GAAiBpkD,EAAIA,EAAE,QAAU,QAAUmkD,EAEjD,KAAK,mBAAqBnkD,EAC1B,KAAK,kBAAiB,EAElB,KAAK,mBACDokD,IAEA,KAAK,qBAAoB,EACzB,KAAK,OAAO,0BAA0B,KAAK,mBAAmB,OAAO,GAGzE,KAAK,OAAO,0BAA0B,IAAI,EAG1CA,IACI,KAAK,oBACL,KAAK,MAAM,0BAA0B,KAAK,kBAAkB,EAC5D,KAAK,KAAK,WAAY,KAAK,kBAAkB,GAE7C,KAAK,KAAK,aAAc,KAAK,kBAAkB,EAG1D,CAED,uBAAwB,CAEhB,KAAK,QAEL,KAAK,qBAAqB,KAAK,SAAS,CAE/C,CAED,yBAAyBvqD,EAAG,CACxB,KAAK,KAAK,UAAWA,EAAG,KAAK,UAAU,OAAO,CACjD,CAED,mBAAoB,CAChB,KAAK,OAAO,oBAAoB,CAAC,CACpC,CAED,mCAAoC,CAChC,KAAK,kBAAiB,EACtB,KAAK,qBAAoB,CAC5B,CAED,oBAAqB,CACjB,KAAK,kBAAiB,CACzB,CAED,oBAAoBspB,EAAGC,EAAG,CAClB,KAAK,mBAAmBm/B,KACxB,KAAK,QAAQ,EAAIp/B,EACjB,KAAK,QAAQ,EAAIC,EACjB,KAAK,EAAID,EACT,KAAK,EAAIC,EAEhB,CAED,mBAAoB,CAChB,IAAID,EAAI,KAAK,kBACTC,EAAI,KAAK,mBAETihC,EAAc,IACd,CAAClhC,GAAK,CAACC,IACH,CAAC,KAAK,oBAAsB,KAAK,YAGjCD,EAAIA,GAAK,KAAK,UAAU,GACxBC,EAAIA,GAAK,KAAK,UAAU,IAEnB,CAACD,GAAK,CAACC,IAAM,KAAK,UAAU,sBAC7BihC,EAAc,KAKtB,KAAK,OAAO,cAAclhC,EAAGC,EAAGihC,CAAW,GAC3C,KAAK,UAAS,CAErB,CAED,sBAAuB,CACnB,GAAI,KAAK,kBAAoB,KAAK,iBAAiB,QAAS,CACxD,IAAIC,EAAmB,KAAK,iBACxBC,EAAyB,KAAK,iBAAiB,QAE/CC,EAAM,EAAGC,EAAM,EAAGC,EAAM,EAAKC,EAAM,EACvC,GAAIL,EAAiB,SAAU,CAE3B,IAAInhC,EAAIohC,EAAuB,iBAC3B,EAAIA,EAAuB,kBAC3BK,EAAIC,EAAIC,EAAIC,EAChBH,EAAK,EAAIzhC,EACT0hC,EAAK,EAAI,EAELP,EAAiB,GACjBQ,EAAMR,EAAiB,GAAMM,EAE7BE,GAAM3hC,EAAImhC,EAAiB,IAAMM,EAGjCN,EAAiB,GACjBS,EAAKT,EAAiB,GAAKO,EAE3BE,GAAM,EAAIT,EAAiB,IAAMO,EAGrCD,GAAON,EAAiB,GACxBO,GAAOP,EAAiB,GAExBE,EAAMI,EACNH,EAAMI,EACNH,EAAMA,EAAMI,EAAKF,EACjBD,EAAMA,EAAMI,EAAKF,EAEjBL,EAAM,KAAK,IAAI,EAAGA,CAAG,EACrBC,EAAM,KAAK,IAAI,EAAGA,CAAG,EACrBC,EAAM,KAAK,IAAI,EAAGA,CAAG,EACrBC,EAAM,KAAK,IAAI,EAAGA,CAAG,CACxB,CAED,GAAIJ,EAAuB,cAAe,CACtC,IAAIS,EAASL,EACbA,EAAMF,EACNA,EAAMO,CACT,CACD,KAAK,OAAO,iBAAiBR,EAAKC,EAAKC,EAAKC,CAAG,CAClD,CACJ,CAED,iBAAkB,CACd,OAAO,KAAK,OAAO,iBACtB,CAED,kBAAmB,CACX,KAAK,QACL,KAAK,OAAO,QAASM,GAAQ,CAEzB,IAAI5jD,EAAI,KACR,MAAOA,EAAIA,EAAE,YACYA,EAAE,WAAW,IAAI4jD,CAAG,EAC1B,OAAO,IAAI,EAEtB,CAAA5jD,EAAE,YAAN,CAIpB,CAAa,EAGL,IAAI6jD,EAAO,KACPhgD,EAAI,EACR,GAAI,KAAK,YACD,CAAC,KAAK,YACNggD,EAAOrR,EAAM,gBAAgB,KAAK,WAAW,KAAI,CAAE,EACnD3uC,EAAIggD,EAAK,OAELhgD,EAAI,GACJ,QAAS,EAAI,EAAG,EAAIA,EAAG,IAAK,CACxB,IAAIigD,EAAS,KAAK,WAAW,IAAID,EAAK,CAAC,CAAC,EAGpC7jD,EAAI,KACR,KAAQA,EAAIA,EAAE,UAAW,CACrB,IAAI+jD,EAAiB/jD,EAAE,WAAW,IAAI6jD,EAAK,CAAC,CAAC,EAM7C,GAJAC,EAAO,QAAQ,SAAUE,EAAM,CAC3BD,EAAe,OAAOC,CAAI,CAC1D,CAA6B,EAEGhkD,EAAE,UACF,KAEP,CACJ,CAIhB,CAED,gBAAiB,CAET,KAAK,QACL,KAAK,OAAO,QAAS4jD,GAAQ,CACzB,IAAI5jD,EAAI,KACR,KAAOA,EAAIA,EAAE,UAAU,CACdA,EAAE,aACHA,EAAE,WAAa,IAAI,KAGvB,IAAIpC,EAAIoC,EAAE,WAAW,IAAI4jD,CAAG,EAQ5B,GAPKhmD,IACDA,EAAI,IAAI,IACRoC,EAAE,WAAW,IAAI4jD,EAAKhmD,CAAC,GAG3BA,EAAE,IAAI,IAAI,EAENoC,EAAE,UACF,KAEP,CACjB,CAAa,EAGD,KAAK,YAAc,KAAK,WAAW,OAC9B,KAAK,WACN,KAAK,WAAW,QAAQ,CAAC8jD,EAAQF,IAAQ,CACrC,IAAI5jD,EAAI,KACR,KAAO,CAACA,EAAE,YAAcA,EAAIA,EAAE,WAAW,CACjCA,EAAE,UAGDA,EAAE,aACHA,EAAE,WAAa,IAAI,KAGvB,IAAI,EAAIA,EAAE,WAAW,IAAI4jD,CAAG,EACvB,IACD,EAAI,IAAI,IACR5jD,EAAE,WAAW,IAAI4jD,EAAK,CAAC,GAG3BE,EAAO,QAAQ,SAAUE,EAAM,CAC3B,EAAE,IAAIA,CAAI,CACtC,CAAyB,CACJ,CACrB,CAAiB,EAGZ,CAGD,UAAUJ,EAAK,CACX,GAAI,CAAC,KAAK,WACN,MAAO,GAEX,IAAI5hD,EAAI,KAAK,WAAW,IAAI4hD,CAAG,EAC/B,OAAO5hD,EAAIwwC,EAAM,WAAWxwC,CAAC,EAAI,EACpC,CAED,SAAU,CACN,OAAO,KAAK,OAAS,KAAK,OAAS,EACtC,CAED,QAAQ6hD,EAAM,CACVA,EAAOA,EAAK,OAAO,CAACzsC,EAAKwsC,IACdxsC,EAAI,OAAOwsC,EAAI,MAAM,GAAG,CAAC,EACjC,CAAE,GAED,KAAK,OACLC,EAAK,KAAK,KAAK,KAAK,EAGxB,IAAItqD,EAAGsK,EAAIggD,EAAK,OACZI,EAAU,GACVC,EAAO,GACX,IAAK3qD,EAAI,EAAGA,EAAIsK,EAAGtK,IACV,KAAK,OAAOsqD,EAAKtqD,CAAC,CAAC,GACpB2qD,EAAK,KAAKL,EAAKtqD,CAAC,CAAC,EAIzB,IAAI4qD,EAAc,KAAK,MAAQ,GAE/B,IADAtgD,EAAIsgD,EAAY,OACX5qD,EAAI,EAAGA,EAAIsK,EAAGtK,IACXsqD,EAAK,QAAQM,EAAY5qD,CAAC,CAAC,GAAK,IAChC0qD,EAAQ,KAAKE,EAAY5qD,CAAC,CAAC,EAInC,IAAKA,EAAI,EAAGA,EAAI0qD,EAAQ,OAAQ1qD,IAC5B,KAAK,UAAU0qD,EAAQ1qD,CAAC,CAAC,EAG7B,IAAKA,EAAI,EAAGA,EAAI2qD,EAAK,OAAQ3qD,IACzB,KAAK,OAAO2qD,EAAK3qD,CAAC,CAAC,CAE1B,CAED,OAAOqqD,EAAK,CACR,GAAIA,EAAI,QAAQ,GAAG,IAAM,GACjBpR,EAAM,SAASoR,EAAI,WAAW,CAAC,CAAC,GAChC,KAAK,YAAY,iDAAiD,EAGtE,KAAK,QAAQA,CAAG,MACb,CACH,MAAMC,EAAOD,EAAI,MAAM,GAAG,EAC1B,QAAS,EAAI,EAAG5uC,EAAI6uC,EAAK,OAAQ,EAAI7uC,EAAG,IAAK,CACzC,MAAM4uC,EAAMC,EAAK,CAAC,EAEdrR,EAAM,SAASoR,EAAI,WAAW,CAAC,CAAC,GAChC,KAAK,YAAY,iDAAiD,EAGtE,KAAK,QAAQA,CAAG,CACnB,CACJ,CACJ,CAED,QAAQA,EAAK,CAIT,GAHK,KAAK,SACN,KAAK,OAAS,IAEd,KAAK,OAAO,QAAQA,CAAG,IAAM,GAAI,CACjC,KAAK,OAAO,KAAKA,CAAG,EAGpB,IAAI5jD,EAAI,KAAK,SACb,GAAIA,EACA,EAAG,CACMA,EAAE,aACHA,EAAE,WAAa,IAAI,KAGvB,IAAIpC,EAAIoC,EAAE,WAAW,IAAI4jD,CAAG,EACvBhmD,IACDA,EAAI,IAAI,IACRoC,EAAE,WAAW,IAAI4jD,EAAKhmD,CAAC,GAG3BA,EAAE,IAAI,IAAI,CAE9B,OAAyB,CAACoC,EAAE,YAAcA,EAAIA,EAAE,UAEvC,CACJ,CAED,UAAU4jD,EAAK,CACX,IAAIrqD,EAAI,KAAK,OAAO,QAAQqqD,CAAG,EAC/B,GAAIrqD,IAAM,GAAI,CACV,KAAK,OAAO,OAAOA,EAAG,CAAC,EAGvB,IAAIyG,EAAI,KAAK,SACb,GAAIA,EACA,EAAG,CACC,IAAIoE,EAAOpE,EAAE,WAAW,IAAI4jD,CAAG,EAC3Bx/C,GACAA,EAAK,OAAO,IAAI,CAExC,OAAyB,CAACpE,EAAE,YAAcA,EAAIA,EAAE,UAEvC,CACJ,CAED,OAAO4jD,EAAK,CACR,OAAQ,KAAK,QAAW,KAAK,OAAO,QAAQA,CAAG,IAAM,EACxD,CAOD,KAAKA,EAAK,CACN,GAAIA,EAAI,QAAQ,GAAG,IAAM,GACrB,OAAO,KAAK,KAAKA,CAAG,EAAE,CAAC,EAEvB,GAAI,KAAK,WAAY,CACjB,IAAI5hD,EAAI,KAAK,WAAW,IAAI4hD,CAAG,EAC/B,GAAI5hD,EAAG,CACH,MAAMsD,EAAOtD,EAAE,OAAQ,EAAC,KAAI,EAC5B,OAAOsD,EAAOA,EAAK,MAAQ,MAC9B,CACJ,CAER,CAED,IAAI,KAAM,CACN,OAAO,KAAK,IACf,CAED,IAAI,IAAI,EAAG,CACP,KAAK,KAAO,CACf,CAOD,KAAKs+C,EAAK,CAEN,GADUA,EAAI,QAAQ,GAAG,GACd,EAAG,CACV,IAAItR,EAAQsR,EAAI,MAAM,GAAG,EACrBtgD,EAAM,KAAK,UAAUgvC,EAAM,CAAC,CAAC,EAC7B8R,EAAQ,EACRnmD,EAAIq0C,EAAM,OACd,KAAOhvC,EAAI,QAAU8gD,EAAQnmD,GAAG,CAC5B,IAAIomD,EAAO,GACX,QAASz/C,EAAI,EAAGf,EAAIP,EAAI,OAAQsB,EAAIf,EAAGe,IACnCy/C,EAAOA,EAAK,OAAO/gD,EAAIsB,CAAC,EAAE,UAAU0tC,EAAM8R,CAAK,CAAC,CAAC,EAGrD9gD,EAAM+gD,EACND,GACH,CACD,OAAO9gD,CACnB,KACY,QAAO,KAAK,UAAUsgD,CAAG,CAEhC,CAED,KAAKA,EAAK76C,EAAU,CAChB,IAAI/G,EAAI,KAAK,KAAK4hD,CAAG,EACjB//C,EAAI7B,EAAE,OACV,QAASzI,EAAI,EAAGA,EAAIsK,EAAGtK,IACnB45C,GAAK,YAAYnxC,EAAEzI,CAAC,EAAGwP,CAAQ,CAEtC,CAED,IAAI,SAAU,CACV,OAAO,KAAK,SACf,CAED,IAAI,QAAQpK,EAAG,CACP,KAAK,YAAcA,IACdA,EAGD,KAAK,iBAAgB,EAFrB,KAAK,eAAc,EAKvB,KAAK,UAAYA,EAExB,CAED,IAAIizB,EAAM,CACN,MAAM9tB,EAAU,KAAK,OAAO8tB,CAAI,EAChC,GAAI9tB,EAAQ,OACR,OAAOA,EAAQ,CAAC,CAIvB,CAED,OAAO8tB,EAAM,CACT,GAAIA,EAAK,QAAQ,GAAG,IAAM,GAAI,CAC1B,IAAI0yB,EAAY1yB,EAAK,MAAM,GAAG,EAC1BtuB,EAAM,GACV,QAAS/J,EAAI,EAAGA,EAAI+qD,EAAU,OAAQ/qD,IAClC+J,EAAMA,EAAI,OAAO,KAAK,QAAQghD,EAAU/qD,CAAC,CAAC,CAAC,EAE/C,OAAO+J,CACnB,KACY,QAAO,KAAK,QAAQsuB,CAAI,CAE/B,CAED,QAAQA,EAAM,CACV,GAAIA,IAAS,GAAI,MAAO,CAAC,IAAI,EAG7B,IAAI2yB,EAAW3yB,EAAK,QAAQ,GAAG,EAC3B4yB,EAAW5yB,EAAK,QAAQ,GAAG,EAC/B,GAAI2yB,IAAa,IAAMC,IAAa,GAEhC,OAAO,KAAK,KAAK5yB,CAAI,EAIzB,IAAI6yB,EACJ,OAAID,IAAa,GACbC,EAAQ,GACR7yB,EAAOA,EAAK,OAAO,CAAC,GACb2yB,IAAa,GACpBE,EAAQ,GACR7yB,EAAOA,EAAK,OAAO,CAAC,GAEpB6yB,EAAQ,GAGL,KAAK,cAAc7yB,EAAM6yB,CAAK,CACxC,CAED,cAAc7yB,EAAM6yB,EAAO,CACvB,MAAMF,EAAW3yB,EAAK,QAAQ,GAAG,EAC3B4yB,EAAW5yB,EAAK,QAAQ,GAAG,EAEjC,GAAI2yB,IAAa,IAAMC,IAAa,GAChC,GAAIC,EAAO,CACP,MAAMvxC,EAAM,KAAK,SAAS0e,CAAI,EAC9B,OAAO1e,EAAM,CAACA,CAAG,EAAI,EACrC,KACgB,QAAO,KAAK,KAAK0e,CAAI,EAI7B,GAAK4yB,IAAa,IAAQD,IAAa,IAAMA,EAAWC,EAAW,CAC/D,IAAI1uC,EACJ,MAAMza,EAAMu2B,EAAK,OAAO,EAAG2yB,CAAQ,EACnC,GAAIE,EAAO,CACP,MAAMvxC,EAAM,KAAK,SAAS7X,CAAG,EAC7Bya,EAAO5C,EAAM,CAACA,CAAG,EAAI,EACrC,MACgB4C,EAAO,KAAK,KAAKza,CAAG,EAExB,IAAIg5C,EAAQ,GACZ,MAAMqQ,EAAU9yB,EAAK,OAAO2yB,EAAW,CAAC,EACxC,QAAShrD,EAAI,EAAGsK,EAAIiS,EAAK,OAAQvc,EAAIsK,EAAGtK,IACpC86C,EAAQA,EAAM,OAAOv+B,EAAKvc,CAAC,EAAE,cAAcmrD,EAAS,EAAK,CAAC,EAE9D,OAAOrQ,CACnB,KAAe,CACH,IAAIv+B,EACJ,MAAMza,EAAMu2B,EAAK,OAAO,EAAG4yB,CAAQ,EACnC,GAAIC,EAAO,CACP,MAAMvxC,EAAM,KAAK,SAAS7X,CAAG,EAC7Bya,EAAO5C,EAAM,CAACA,CAAG,EAAI,EACrC,MACgB4C,EAAO,KAAK,KAAKza,CAAG,EAExB,IAAIg5C,EAAQ,GACZ,MAAMqQ,EAAU9yB,EAAK,OAAO4yB,EAAW,CAAC,EACxC,QAASjrD,EAAI,EAAGsK,EAAIiS,EAAK,OAAQvc,EAAIsK,EAAGtK,IACpC86C,EAAQA,EAAM,OAAOv+B,EAAKvc,CAAC,EAAE,cAAcmrD,EAAS,EAAI,CAAC,EAE7D,OAAOrQ,CACV,CACJ,CAED,SAASnhC,EAAK,CACV,OAAO,KAAK,UAAU,SAASA,CAAG,CACrC,CAED,mBAAoB,CAChB,IAAI3Z,EACJA,EAAI,KAAK,SAAW,KAAK,SAAS,UAAU,SAAS,IAAI,EAAI,IAC7D,IAAIorD,EAAY,KAAK,UACjBtpD,EAAM,KAAK,SAAW,KAAK,SAAS,kBAAmB,EAAE,GAC7D,OAAI,KAAK,IACLA,GAAO,KAAO9B,EAAI,IAAM,KAAK,IACtBorD,EAAU,OACjBtpD,GAAO,KAAO9B,EAAI,IAAMorD,EAAU,KAAK,GAAG,EAE1CtpD,GAAO,KAAO9B,EAAI,KAAO,KAAK,GAE3B8B,CACV,CAED,UAAW,CACP,IAAIkuB,EAAM,KAAK,cACf,OAAO84B,EAAQ,gBAAgB94B,EAAK,EAAE,CACzC,CAED,OAAO,gBAAgBA,EAAKrF,EAAQ,CAChC,IAAI5hB,EAAWinB,EAAI,SACnB,OAAOA,EAAI,SAIX,IAAIq7B,EAAY,CAAC,QAAS,UAAW,UAAW,UAAW,SAAS,EAChEvpD,EAAM,KAAK,UAAUkuB,EAAK,SAAUxiB,EAAGpI,EAAG,CAC1C,OAAIimD,EAAU,QAAQ79C,CAAC,IAAM,GAClB,SAAWpI,EAAE,SAAS,EAAE,EAAI,IAEhCA,CACnB,CAAS,EAGD,GAFAtD,EAAMA,EAAI,QAAQ,8BAA+B,MAAM,EAEnDiH,EAAU,CACV,IAAIuiD,EAAW,GACf,GAAIrS,EAAM,gBAAgBlwC,CAAQ,EAAG,CACjC,IAAIu/C,EAAO,OAAO,KAAKv/C,CAAQ,EAC/BuiD,EAAW,GACX,QAAStrD,EAAI,EAAGsK,EAAIg+C,EAAK,OAAQtoD,EAAIsK,EAAGtK,IACpCsrD,GAAY,KAAK,OAAA3gC,EAAM,OAAM,OAAA29B,EAAKtoD,CAAC,EAAC,MACpC,OAAO+I,EAASu/C,EAAKtoD,CAAC,CAAC,EAAE,IACzBsrD,GAAYxC,EAAQ,gBAAgB//C,EAASu/C,EAAKtoD,CAAC,CAAC,EAAG2qB,EAAS,IAAI,GAAK3qB,EAAIsK,EAAI,EAAI,IAAM,IAE/F,IAAIihD,EAAWzpD,IAAQ,KACvBA,EAAMA,EAAI,OAAO,EAAGA,EAAI,OAAS,CAAC,GAAKypD,EAAU,GAAK,KAAOD,EAAW,KAAO3gC,EAAS,GACxG,KAAmB,CACH,IAAIrgB,EAAIvB,EAAS,OACjBuiD,EAAW,IACX,QAAStrD,EAAI,EAAGA,EAAIsK,EAAGtK,IACnBsrD,GAAYxC,EAAQ,gBAAgB//C,EAAS/I,CAAC,EAAG2qB,EAAS,IAAI,GAAK3qB,EAAIsK,EAAI,EAAI,IAAM,IAAM,KAE/FghD,GAAY3gC,EAAS,KACrB,IAAI4gC,EAAWzpD,IAAQ,KACvBA,EAAMA,EAAI,OAAO,EAAGA,EAAI,OAAS,CAAC,GAAKypD,EAAU,GAAK,KAAO,gBAAoB5gC,EAAS2gC,EAAW,GACxG,CAEJ,CAED,OAAOxpD,CACV,CAED,aAAc,CACV,IAAI0N,EAAW,KAAK,iBAEhBzG,EAAW,KAAK,UAAU,IAAG,EACjC,GAAIA,EAAU,CACV,IAAIuB,EAAIvB,EAAS,OACjB,GAAIuB,EAAG,CACH,MAAMkhD,EAAa,GACnB,IAAIC,EAAU,GACd,QAASzrD,EAAI,EAAGA,EAAIsK,EAAGtK,IACnBwrD,EAAW,KAAKziD,EAAS/I,CAAC,EAAE,YAAa,GACzCyrD,EAAUA,GAAW,CAAC1iD,EAAS/I,CAAC,EAAE,IAGjCyrD,EAMDj8C,EAAS,SAAWg8C,GALpBh8C,EAAS,SAAW,CAAE,EACtBg8C,EAAW,QAAQn9C,GAAS,CACxBmB,EAAS,SAASnB,EAAM,GAAG,EAAIA,CACvD,CAAqB,EAIR,CACJ,CAED,OAAAmB,EAAS,GAAK,KAAK,GAEZA,CACV,CAED,gBAAiB,CACb,IAAIA,EAAW,GA+Df,GA7DI,KAAK,cAAgBs5C,IACrBt5C,EAAS,KAAO,KAAK,YAAY,MAGjC,KAAK,QACLA,EAAS,IAAM,KAAK,OAGpB,KAAK,QAAU,KAAK,OAAO,SAC3BA,EAAS,KAAO,KAAK,QAGrB,KAAK,IAAM,IAAGA,EAAS,EAAI,KAAK,GAChC,KAAK,IAAM,IAAGA,EAAS,EAAI,KAAK,GAChC,KAAK,IAAM,IAAGA,EAAS,EAAI,KAAK,GAChC,KAAK,IAAM,IAAGA,EAAS,EAAI,KAAK,GAEhC,KAAK,SAAW,KAAK,OACjB,KAAK,SAAW,IAAGA,EAAS,MAAQ,KAAK,SAEzC,KAAK,SAAW,IAAGA,EAAS,OAAS,KAAK,QAC1C,KAAK,SAAW,IAAGA,EAAS,OAAS,KAAK,SAG9C,KAAK,SAAW,KAAK,OACjB,KAAK,SAAW,KAAKA,EAAS,MAAQ,KAAK,SAE3C,KAAK,SAAW,KAAKA,EAAS,OAAS,KAAK,QAC5C,KAAK,SAAW,KAAKA,EAAS,OAAS,KAAK,SAGhD,KAAK,SAAW,KAAK,OACjB,KAAK,SAAW,IAAGA,EAAS,MAAQ,KAAK,SAEzC,KAAK,SAAW,IAAGA,EAAS,OAAS,KAAK,QAC1C,KAAK,SAAW,IAAGA,EAAS,OAAS,KAAK,SAG9C,KAAK,QAAU,IAAGA,EAAS,MAAQ,KAAK,OAEvC,KAAK,UAASA,EAAS,QAAU,IAElC,KAAK,WAAa,IAAGA,EAAS,SAAW,KAAK,UAE9C,KAAK,UAAY,KAAK,SAAW,KAAK,UAAY,KAAK,SAAW,KAAK,UAAY,KAAK,QACpF,KAAK,UAAY,aAAYA,EAAS,MAAQ,KAAK,QAAQ,SAAS,EAAE,IAEtE,KAAK,UAAY,aAAYA,EAAS,QAAU,KAAK,QAAQ,SAAS,EAAE,GACxE,KAAK,UAAY,aAAYA,EAAS,QAAU,KAAK,QAAQ,SAAS,EAAE,GACxE,KAAK,UAAY,aAAYA,EAAS,QAAU,KAAK,QAAQ,SAAS,EAAE,GACxE,KAAK,UAAY,aAAYA,EAAS,QAAU,KAAK,QAAQ,SAAS,EAAE,IAG5E,KAAK,SAAQA,EAAS,OAAS,KAAK,QAEpC,KAAK,qBAAoBA,EAAS,mBAAqB,IAEvD,KAAK,WAAUA,EAAS,SAAW,KAAK,UAEvC,KAAK,UAASA,EAAS,QAAU,KAAK,SAEvC,KAAK,UAAW,CAChB,IAAIk8C,EAAM,KAAK,UAAU,eAAc,EACnC,OAAO,KAAKA,CAAG,EAAE,SACjBl8C,EAAS,QAAUk8C,EAE1B,CAED,GAAI,KAAK,QAAUzS,EAAM,WAAW,KAAK,OAAO,cAAc,EAAG,CAC7D,IAAIyS,EAAM,KAAK,OAAO,eAAc,EAChC,OAAO,KAAKA,CAAG,EAAE,SACjBl8C,EAAS,OAASk8C,EAEzB,CAED,OAAI,KAAK,mBACD,KAAK,WAAW,UAChBl8C,EAAS,gBAAkB,KAAK,WAAW,SAE3C,KAAK,WAAW,OAChBA,EAAS,oBAAsB,KAAK,WAAW,MAE/C,KAAK,WAAW,WAChBA,EAAS,sBAAwB,KAAK,WAAW,UAEjD,KAAK,WAAW,kBAChBA,EAAS,gBAAkB,KAAK,WAAW,kBAI5CA,CACV,CAED,OAAO,UAAUm8C,EAAc,CAC3B,IAAIC,EAAS9C,EAAQ,aAAa,IAAI6C,CAAY,EAClD,OAAKC,IACDA,EAAS,IAAI,SAAS,MAAO,cAAgBD,CAAY,EACzD7C,EAAQ,aAAa,IAAI6C,EAAcC,CAAM,GAE1CA,CACV,CAED,OAAO,UAAUD,EAAc,CAC3B,IAAIrnD,EAASwkD,EAAQ,aAAa,IAAI6C,CAAY,EAClD,OAAKrnD,IACDA,EAAS,IAAI,SAAS,MAAO,IAAK,OAASqnD,EAAe,MAAM,EAChE7C,EAAQ,aAAa,IAAI6C,EAAcrnD,CAAM,GAE1CA,CACV,CAED,IAAI,oBAAqB,CACrB,OAAO,KAAK,OAAO,mBACtB,CAED,2BAA4B,CAEpB,KAAK,WACL,KAAK,eAAc,CAE1B,CAED,4BAA6B,CAErB,KAAK,UACL,KAAK,iBAAgB,CAE5B,CAED,IAAI,aAAac,EAAG,CAChB,GAAI,CAAC,MAAM,QAAQA,CAAC,GAAKA,IAAM,KAC3B,MAAM,IAAI,MAAM,0FAA0F,EAE9G,KAAK,OAAO,aAAeA,CAC9B,CAED,IAAI,cAAe,CACf,OAAO,KAAK,OAAO,YACtB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,OAAO,OACtB,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,OAAO,QAAUA,CACzB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,OAAO,OACtB,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,OAAO,QAAUA,CACzB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACD6zC,EAAM,WAAW7zC,CAAC,GAClB,KAAK,GAAK,EACV,KAAK,OAAO,MAAQA,IAEpBA,EAAI,KAAK,IAAIA,EAAG,CAAC,EACb,KAAK,KAAOA,IACZ,KAAK,OAAO,eACZ,KAAK,GAAKA,EACV,KAAK,kBAAiB,GAGjC,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACD6zC,EAAM,WAAW7zC,CAAC,GAClB,KAAK,GAAK,EACV,KAAK,OAAO,MAAQA,IAEpBA,EAAI,KAAK,IAAIA,EAAG,CAAC,EACb,KAAK,KAAOA,IACZ,KAAK,OAAO,eACZ,KAAK,GAAKA,EACV,KAAK,kBAAiB,GAGjC,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACb,KAAK,WAAaA,CACrB,CAED,kBAAmB,CACX,KAAK,WAAa,KAAK,UAAY,KAAK,SAAS,YAAc,SAK/D,KAAK,SAAS,UAAY,EAEjC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,OAASA,CACxB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,OAASA,CACxB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OAAO,KACtB,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAAO,MAAQA,CACvB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,OAASA,CACxB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,OAASA,CACxB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OAAO,KACtB,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAAO,MAAQA,CACvB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,OAASA,CACxB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,OAASA,CACxB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OAAO,KACtB,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAAO,MAAQA,CACvB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,OAAO,QACtB,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,OAAO,SAAWA,CAC1B,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OAAO,KACtB,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAAO,MAAQA,CACvB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,OAAO,OACtB,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,OAAO,QAAUA,CACzB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,OAAO,OACtB,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,OAAO,QAAUA,CACzB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,OAAO,OACtB,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,OAAO,QAAUA,CACzB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,OAAO,OACtB,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,OAAO,QAAUA,CACzB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,OAAO,OACtB,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,OAAO,QAAUA,CACzB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OAAO,OACtB,CAED,IAAI,MAAMA,EAAG,EACL,KAAK,UAAYA,GAAK,KAAK,UAAYA,GAAK,KAAK,UAAYA,GAAK,KAAK,UAAYA,KACnF,KAAK,QAAUA,EACf,KAAK,QAAUA,EACf,KAAK,QAAUA,EACf,KAAK,QAAUA,EAEtB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,OACf,CAED,IAAI,SAASA,EAAG,EACR,KAAK,UAAYA,GAAK,KAAK,UAAYA,KACvC,KAAK,QAAUA,EACf,KAAK,QAAUA,EAEtB,CAED,IAAI,aAAc,CACd,OAAO,KAAK,OACf,CAED,IAAI,YAAYA,EAAG,EACX,KAAK,UAAYA,GAAK,KAAK,UAAYA,KACvC,KAAK,QAAUA,EACf,KAAK,QAAUA,EAEtB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,OACf,CAED,IAAI,UAAUA,EAAG,EACT,KAAK,UAAYA,GAAK,KAAK,UAAYA,KACvC,KAAK,QAAUA,EACf,KAAK,QAAUA,EAEtB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,OACf,CAED,IAAI,WAAWA,EAAG,EACV,KAAK,UAAYA,GAAK,KAAK,UAAYA,KACvC,KAAK,QAAUA,EACf,KAAK,QAAUA,EAEtB,CAED,IAAI,QAAS,CAAC,OAAO,KAAK,OAAO,MAAM,CACvC,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,OAASA,CACxB,CAED,IAAI,oBAAqB,CAAC,OAAO,KAAK,OAAO,kBAAkB,CAC/D,IAAI,mBAAmBA,EAAG,CACtB,KAAK,OAAO,mBAAqBA,CACpC,CAED,IAAI,UAAW,CAAC,OAAO,KAAK,OAAO,QAAQ,CAC3C,IAAI,SAASA,EAAG,CACZ,KAAK,OAAO,SAAWA,CAC1B,CAED,IAAI,SAAU,CAAC,OAAO,KAAK,OAAO,OAAO,CACzC,IAAI,QAAQA,EAAG,CACX,KAAK,OAAO,QAAUA,CACzB,CAED,IAAI,MAAO,CACP,OAAO,KAAK,SACf,CAED,IAAI,KAAKA,EAAG,CACH,MAAM,QAAQA,CAAC,IAAGA,EAAI,CAACA,CAAC,GAC7B,KAAK,QAAQA,CAAC,CACjB,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,KAAOA,CACf,CAED,IAAI,WAAY,CACZ,OAAK,KAAK,cACN,KAAK,YAAc,IAAIujD,GAAiB,KAAM,EAAK,GAEhD,KAAK,WACf,CAED,IAAI,WAAY,CACZ,OAAK,KAAK,wBACN,KAAK,YAAY,+CAAiD,KAAK,kBAAmB,GAEvF,KAAK,SACf,CAED,aAAc,CACV,OAAO,KAAK,qBAAsB,GAAI,KAAK,aAAgB,KAAK,YAAY,OAAS,CACxF,CAED,sBAAuB,CACnB,MAAO,EACV,CAED,IAAI,UAAW,CACX,OAAO,KAAK,UAAU,KACzB,CAED,IAAI,SAAS5/C,EAAU,CACnB,KAAK,UAAU,MAAMA,CAAQ,CAChC,CAED,IAAIX,EAAG,CACH,OAAO,KAAK,UAAU,EAAEA,CAAC,CAC5B,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,QACf,CAED,IAAI,QAAS,CACT,OAAO,KAAK,QACf,CAED,IAAI,KAAM,CACN,GAAI,KAAK,SAAW,KAAK,mBAAmBoX,GACxC,OAAO,KAAK,QAAQ,IAI3B,CAED,IAAI,IAAIpa,EAAG,CACP,MAAM8J,EAAU,IAAIsQ,GAAa,KAAK,KAAK,EAC3CtQ,EAAQ,IAAM9J,EACd,KAAK,QAAU8J,CAClB,CAED,IAAI,GAAG9J,EAAG,CACF,KAAK,SACL,KAAK,QAAQ,GAAKA,EAClB,KAAK,kBAAiB,GAEtB,KAAK,YAAY,wCAAwC,CAEhE,CAED,IAAI,GAAGA,EAAG,CACF,KAAK,SACL,KAAK,QAAQ,GAAKA,EAClB,KAAK,kBAAiB,GAEtB,KAAK,YAAY,wCAAwC,CAEhE,CAED,IAAI,MAAO,CACP,OAAQ,KAAK,UAAY,KAAK,MAAM,gBACvC,CAED,IAAI,KAAKA,EAAG,CACJA,EACA,KAAK,QAAU,KAAK,MAAM,iBAE1B,KAAK,QAAU,IAEtB,CAED,mBAAoB,CAChB,OAAI,CAAC,KAAK,SAAW,EAAE,KAAK,mBAAmBuiD,OAC3C,KAAK,QAAU,IAAIA,GAAY,KAAK,KAAK,EAErC,CAAC,KAAK,QAAQ,GAAK,CAAC,KAAK,QAAQ,IAGjC,KAAK,QAAQ,EAAI,KAAK,EACtB,KAAK,QAAQ,EAAI,KAAK,IAGvB,KAAK,OACf,CAED,IAAI,MAAO,CACP,OAAI,KAAK,SAAY,KAAK,mBAAmBA,GAClC,KAAK,QAEL,IAEd,CAED,IAAI,KAAKviD,EAAG,EACJ,CAAC,KAAK,SAAW,EAAE,KAAK,mBAAmBuiD,MAC3C,KAAK,kBAAiB,EAEtB1O,EAAM,SAAS7zC,CAAC,EAChB,KAAK,QAAQ,KAAOA,EAEpB,KAAK,QAAQ,MAAMA,CAAC,CAE3B,CAED,IAAI,SAASk5C,EAAG,CACZ,KAAK,OAAO,SAAWA,CAC1B,CAED,IAAI,aAAaA,EAAG,CAChB,KAAK,OAAO,aAAeA,CAC9B,CAED,IAAI,cAAcA,EAAG,CACjB,KAAK,OAAO,cAAgBA,CAC/B,CAED,aAAc,CAEV,KAAK,OAAO,gBACf,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,MACtB,CAED,IAAI,OAAOl5C,EAAG,CACV,GAAI6zC,EAAM,gBAAgB7zC,CAAC,GAAK,CAACA,EAAE,KAE3B,KAAK,QACL,KAAK,OAAO,MAAMA,CAAC,MAEpB,CACH,MAAM2R,EAASgtC,GAAO,OAAO,KAAK,MAAO3+C,CAAC,EAEtC,KAAK,WAAa,KAAK,OAAO,QAC9B,KAAK,OAAO,OAAO,cAAc,KAAK,MAAM,EAGhD,KAAK,OAAO,OAAS2R,EAEjB,KAAK,WAAa,KAAK,OAAO,QAC9B,KAAK,OAAO,OAAO,WAAW,KAAK,MAAM,CAEhD,CACJ,CAED,gBAAiB,CACb,MAAO,CAAC,CAAC,KAAK,OAAO,WACxB,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,GACf,CAED,IAAI,gBAAgB3R,EAAG,CACnB,KAAK,IAAMA,CACd,CAED,IAAI,KAAM,CACN,OAAO,KAAK,eAAc,GAAM,KAAK,WAAW,OACnD,CAED,IAAI,IAAIA,EAAG,CACP,KAAK,WAAW,QAAUA,CAC7B,CAED,IAAI,SAAU,CACV,OAAO,KAAK,eAAc,GAAM,KAAK,WAAW,IACnD,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,WAAW,KAAOA,CAC1B,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,eAAc,GAAM,KAAK,WAAW,eACnD,CAED,IAAI,gBAAgBA,EAAG,CACnB,KAAK,WAAW,gBAAkBA,CACrC,CAED,IAAI,uBAAwB,CACxB,OAAO,KAAK,eAAc,GAAM,KAAK,WAAW,QACnD,CAED,IAAI,sBAAsBA,EAAG,CACzB,KAAK,WAAW,SAAWA,CAC9B,CAED,YAAa,CACT,OAAO,KAAK,WAAW,mBAC1B,CAED,IAAI,YAAa,CACb,OAAO,KAAK,OAAO,UACtB,CAED,MAAMoK,EAAU,CACZ,IAAIq8C,EAAQ,OAAO,KAAKr8C,CAAQ,EAEhC,QAAS,EAAI,EAAGlF,EAAIuhD,EAAM,OAAQ,EAAIvhD,EAAG,IAAK,CAC1C,IAAI+tB,EAAOwzB,EAAM,CAAC,EAClB,MAAMzmD,EAAIoK,EAAS6oB,CAAI,EAEjByzB,EAAgBzzB,EAAK,WAAW,CAAC,EACvC,GAAI4gB,EAAM,SAAS6S,CAAa,EAAG,CAE/B,MAAMz9C,EAAQ,KAAK,SAASgqB,CAAI,EAChC,GAAKhqB,EAkBGjJ,IAAM,OACFiJ,EAAM,QACNA,EAAM,OAAO,UAAU,OAAOA,CAAK,EAEhC4qC,EAAM,gBAAgB7zC,CAAC,EAC9BiJ,EAAM,MAAMjJ,CAAC,EACNA,EAAE,WAETA,EAAE,IAAMizB,EACR,KAAK,UAAU,QAAQjzB,EAAGiJ,CAAK,GAE/B,KAAK,YAAY,8BAAgCgqB,CAAI,UA5BrDjzB,IAAM,OAAW,CAEjB,IAAIV,EACAu0C,EAAM,gBAAgB7zC,CAAC,GAEvBV,EAAI,KAAK,UAAU,WAAWU,CAAC,EAC/BV,EAAE,MAAMU,CAAC,GACF6zC,EAAM,SAAS7zC,CAAC,IACvBV,EAAIU,GAEJV,EAAE,YACFA,EAAE,IAAM2zB,GAGZ,KAAK,UAAU,EAAE3zB,CAAC,CACrB,CAgBrB,MAEgBk1C,GAAK,oBAAoB,KAAMvhB,EAAMjzB,CAAC,CAE7C,CACJ,CAED,YAAYyzB,EAAS,CACjB,MAAM,IAAI,MAAM,KAAK,YAAY,KAAO,KAAO,KAAK,kBAAiB,EAAK,MAAQA,CAAO,CAC5F,CAED,UAAUrpB,EAAU,CAChB,OAAO,KAAK,MAAM,WAAW,gBAAgB,KAAMA,CAAQ,CAC9D,CAED,WAAWhD,EAAUgD,EAAW,KAAM,CAClC,OAAIA,IAAa,KACN,KAAK,eAAehD,CAAQ,GAEnC,KAAK,eAAeA,EAAUgD,CAAQ,EAE/B,KAEd,CAED,IAAI,YAAYq0C,EAAQ,CACT,OAAO,KAAKA,CAAM,EACxB,QAAQr3C,GAAY,CACrB,KAAK,WAAWA,EAAUq3C,EAAOr3C,CAAQ,CAAC,CACtD,CAAS,CACJ,CAED,IAAI,OAAOq3C,EAAQ,CACJ,OAAO,KAAKA,CAAM,EACxB,QAAQr3C,GAAY,CACrB,IAAIrI,EAAQ0/C,EAAOr3C,CAAQ,EACvB,MAAM,QAAQrI,CAAK,EACnB,KAAK,UAAUqI,EAAUrI,EAAM,CAAC,EAAGA,EAAM,CAAC,CAAC,EAE3C,KAAK,UAAUqI,EAAUrI,CAAK,CAE9C,CAAS,CACJ,CAED,YAAYqI,EAAU,CAClB,GAAI,KAAK,aAAc,CACnB,IAAI/D,EAAI,KAAK,aAAa+D,CAAQ,EAC9B/D,GAAKA,EAAE,cACPA,EAAE,OAAM,CAEf,CACJ,CAED,eAAe+D,EAAU,CAChB,KAAK,eACN,KAAK,aAAe,IAExB,IAAI/D,EAAI,KAAK,aAAa+D,CAAQ,EAClC,OAAK/D,EAGMA,EAAE,uBAETA,EAAI,IAAIxF,GACJ,KAAK,MAAM,YACXwF,EACA,KACA+D,CAChB,GARY/D,EAAI,IAAIxF,GAAW,KAAK,MAAM,YAAa,KAAK,MAAM,YAAY,0BAA2B,KAAMuJ,CAAQ,EAU/G,KAAK,aAAaA,CAAQ,EAAI/D,EACvBA,CACV,CAED,eAAe+D,EAAUgD,EAAU,CAC/B,GAAI,CAACA,EACD,KAAK,kBAAkBhD,CAAQ,MAC5B,CACCysC,EAAM,gBAAgBzpC,CAAQ,IAE9BA,EAAW,KAAK,MAAM,YAAY,eAAeA,CAAQ,GAGxD,KAAK,eACN,KAAK,aAAe,IAGxB,IAAI5L,EAAU,KAAK,aAAa4I,CAAQ,EACxC,GAAI5I,GAAWA,EAAQ,aAEnB,OAAAA,EAAQ,SAAW4L,EACZ5L,EAGP,KAAK,aAAa4I,CAAQ,EAAIgD,CAErC,CACJ,CAED,kBAAkBhD,EAAU,CACpB,KAAK,cACL,OAAO,KAAK,aAAaA,CAAQ,CAExC,CAED,UAAUA,EAAUpH,EAAG,CACnB,IAAIqD,EAAI,KAAK,eAAe+D,CAAQ,EACpC,OAAI/D,GAAKA,EAAE,aACAA,EAAE,YAEFrD,CAEd,CAED,UAAUoH,EAAUpH,EAAGoK,EAAU,CACzBA,GACA,KAAK,eAAehD,EAAUgD,CAAQ,EAE1C,IAAI/G,EAAI,KAAK,eAAe+D,CAAQ,EACpC,OAAA/D,EAAE,MAAMrD,CAAC,EACFqD,CACV,CAED,IAAI,MAAO,CACP,OAAO,KAAK,OAAO,IACtB,CAED,IAAI,KAAKrD,EAAG,CACR,KAAK,OAAO,KAAOA,CACtB,CAED,IAAI,UAAW,CACX,OAAO,KAAK,OAAO,QACtB,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,OAAO,SAAWA,CAC1B,CAED,OAAO,gBAAgBoH,EAAU,CAC7B,OAAOA,EAAS,YAAa,EAAC,QAAQ,OAAO,GAAK,CACrD,CAED,OAAO,UAAUA,EAAU,CACvB,OAAIs8C,EAAQ,gBAAgBt8C,CAAQ,EACzB4qC,EAAW,YAEXA,EAAW,YAEzB,CAED,QAAS,CACL,MAAMz9B,EAAM,CAAC,GAAG,YAAK,YAAY,KAAM,EACjCoyC,EAAO,GACb,OAAAA,EAAKpyC,CAAG,EAAI,GAER,KAAK,cACLmvC,EAAQ,gBAAgBiD,EAAKpyC,CAAG,EAAG,KAAK,WAAW,EAEnDoyC,EAAKpyC,CAAG,EAAI,CAAC,GAAGmvC,EAAQ,cAAc,IAAI,CAAC,EAExCiD,CACV,CAED,OAAO,gBAAgBA,EAAMhjD,EAAU,CACnC,MAAMijD,EAAYjjD,EAClB,QAAS/I,EAAI,EAAGqL,EAAI2gD,EAAU,OAAQhsD,EAAIqL,EAAGrL,IAAK,CAC9C,MAAMy2B,EAAUu1B,EAAU,MAAMhsD,CAAC,EAC3B2Z,EAAM,GAAG,OAAA8c,EAAQ,OAAS,WAAW,OAAAA,EAAQ,KAC7Cw1B,EAAa,KAAK,cAAcx1B,CAAO,EAE7Cs1B,EAAKpyC,CAAG,EAAI,CAAC,GAAGsyC,CAAU,EAEtBx1B,EAAQ,gBACRs1B,EAAKpyC,CAAG,EAAE,SAAW,GACrB,KAAK,gBACDoyC,EAAKpyC,CAAG,EAAE,SAAU8c,EAAQ,WAChD,EAES,CACJ,CAED,OAAO,cAAcA,EAAS,CAC1B,MAAMjsB,EAAQ,GACRK,EAAO,CACT,QAAS,SAAU,WAAY,eAAgB,QAAS,WAAY,UAAW,IAAK,KAAM,cAC1F,QAAS,SAAU,SAAU,QAAS,SAAU,SAAU,MAAO,kBAAmB,kBAAmB,QACvG,SAAU,SAAU,QAAS,MAAO,UAAW,IAAK,IAAK,IAAK,SAC9D,SAAU,aAAc,aAAc,iBAClD,EACQ,IAAIP,EAAIO,EAAK,OAEb,KAAOP,KAAK,CACR,IAAI5D,EAAMmE,EAAKP,CAAC,EAChB,MAAM4hD,EAAa,QACbC,EAAa,QAEfD,EAAW,KAAKxlD,CAAG,GACnBA,EAAMA,EAAI,UAAU,EAAGA,EAAI,MAAM,EACjC8D,EAAM9D,CAAG,EAAI,CAAC,CAAC+vB,EAAQ/vB,CAAG,GACnBylD,EAAW,KAAKzlD,CAAG,GAC1BA,EAAMA,EAAI,UAAU,EAAGA,EAAI,OAAS,CAAC,EACjC,OAAO+vB,EAAQ/vB,CAAG,GAAM,aACxB8D,EAAM9D,CAAG,EAAI+vB,EAAQ/vB,CAAG,EAAC,IAG7B8D,EAAM9D,CAAG,EAAI+vB,EAAQ/vB,CAAG,CAE/B,CACD,MAAO,CAAC,GAAG8D,EAAO,GAAGisB,EAAQ,eAAgB,EAChD,CACL,CAGAlnB,EAAa,WAAWu5C,CAAO,EAE/BA,EAAQ,UAAU,UAAY,EAE9BA,EAAQ,GAAK,EAGbA,EAAQ,aAAe,IAAI,IAG3BA,EAAQ,aAAe,IAAI,IC1kEZ,MAAMsD,EAAa,CAE9B,aAAc,CACVA,GAAa,kBAAkB,IAAI,CACtC,CAED,OAAO,kBAAkBn/C,EAAQ,CAC7B,MAAMo/C,EAAoBp/C,EAAO,YAC3BqxB,EAAS8tB,GAAa,OAAOC,CAAiB,EACpD,OAAO,eAAep/C,EAAQqxB,EAAO,SAAS,EAC9CrxB,EAAO,YAAco/C,EACrBp/C,EAAO,kBAAiB,CAC3B,CAUD,OAAO,OAAOvN,EAAM,CAChB,GAAI,CAACA,EAAK,eAAe,KAAK,EAAG,CAE7B,MAAM4sD,EAAmB,IAAIC,GAAiB7sD,CAAI,EAClDA,EAAK,IAAM4sD,CACd,CAED,OAAO5sD,EAAK,IAAI,MACnB,CAOD,KAAKZ,KAAU4wB,EAAM,CACjB,GAAI,KAAK,WAAW5wB,CAAK,EACrB,OAAO,KAAKA,CAAK,EAAE,GAAG4wB,CAAI,CAEjC,CAOD,WAAY,CACR,OAAO,KAAK,OAAO,MACtB,CASD,SAAS88B,EAAWC,EAAmB,KAAK,OAAO,OAAQ,CACvD,MAAMnmD,EAAQ,KAAK,IAAI,eAAekmD,CAAS,EACzCE,EAAe,KAAK,IAAI,eAAeD,CAAgB,EACvD5B,EAAQvkD,EAAM,QAEpB,OADqB8lD,GAAa,iBAAiBM,EAAc7B,CAAK,IAC7CvkD,CAC5B,CAQD,WAAWyH,EAAM,CACb,MAAO,CAAC,CAAC,KAAK,YAAY,UAAUA,CAAI,CAC3C,CAQD,WAAWA,EAAM,CACb,MAAM4+C,EAAS,KAAK,YAAY,UAAU5+C,CAAI,EAC9C,MAAO,CAAC,CAAC4+C,GAAW,OAAOA,GAAW,UACzC,CAUD,UAAUH,EAAW98B,EAAM,CACvB,MAAMk9B,EAAa,EAAE,KAAK,iBAG1B,GAFA,KAAK,YAAcA,EAEf,KAAK,OAAO,SAAWJ,EAAW,CAElC,IAAIK,EAAW,KAAK,IAAI,UAAUL,CAAS,EACtCK,IAEDA,EAAW,KAAK,IAAI,eAAeL,CAAS,GAGhD,MAAMp+B,EAAY,KAAK,OAEjB0+B,EAA2BD,EAAS,UAAU,SAAW,KAAK,OAAO,UAAU,OAC/EE,EAA0BF,EAAS,UAAU,QAAU,KAAK,OAAO,UAAU,MACnF,GAAIC,GAA2BC,EAAwB,CACnD,MAAMC,EAAcZ,GAAa,gBAAgB,KAAK,OAAQS,CAAQ,EAChE/jD,EAAU,CACZ,SAAU+jD,EAAS,OACnB,UAAWz+B,EAAU,OACrB,YAAa4+B,EAAY,MAC7C,EACsBC,EAAcD,EAAY,QAEhC,GAAID,EAAwB,CACxB,MAAMG,EAAad,GAAa,qBAAqB,KAAK,OAAQa,CAAW,EAC7E,QAASjtD,EAAI,EAAGsK,EAAI4iD,EAAW,OAAQltD,EAAIsK,EAAGtK,IAI1C,GAHA,KAAK,WAAWktD,EAAWltD,CAAC,CAAC,EAC7B,KAAK,UAAU,KAAK,OAAQ0vB,EAAM5mB,CAAO,EACV,KAAK,cAAgB8jD,EAEhD,MAGX,CAED,GAAIE,EAAyB,CACzB,MAAMK,EAAcf,GAAa,qBAAqBS,EAAUI,CAAW,EAAE,UAC7E,QAASjtD,EAAI,EAAGsK,EAAI6iD,EAAY,OAAQntD,EAAIsK,EAAGtK,IAI3C,GAHA,KAAK,WAAWmtD,EAAYntD,CAAC,CAAC,EAC9B,KAAK,WAAW,KAAK,OAAQ0vB,EAAM5mB,CAAO,EACX,KAAK,cAAgB8jD,EAEhD,MAGX,CAEJ,CAID,GAFA,KAAK,WAAWC,CAAQ,EAEpB,KAAK,cAAe,CACpB,MAAM/jD,EAAU,CACZ,SAAU+jD,EAAS,OACnB,UAAWz+B,EAAU,MACzC,EAEoBsB,EACA,KAAK,cAAc5mB,EAAS,GAAG4mB,CAAI,EAEnC,KAAK,cAAc5mB,CAAO,CAEjC,CAED,GAAI,KAAK,eAAgB,CACrB,MAAMA,EAAU,CACZ,SAAU+jD,EAAS,OACnB,UAAWz+B,EAAU,MACzC,EACgB,KAAK,eAAetlB,CAAO,CAC9B,CAEJ,CACJ,CAED,WAAWxC,EAAOopB,EAAO,GAAI5mB,EAAS,CAClC,MAAMskD,EAAY,CAAC,CAAC9mD,EAAM,SACtBA,EAAM,UAAU,SACZ,CAAC8mD,GAAc9mD,EAAM,SAAS,UAAU,SAAWA,EAAM,UAAU,SACnEA,EAAM,UAAU,OAAO,MAAM,KAAM,CAACwC,EAAS,GAAG4mB,CAAI,CAAC,CAGhE,CAED,UAAUppB,EAAOopB,EAAO,GAAI5mB,EAAS,CACjC,MAAMskD,EAAY,CAAC,CAAC9mD,EAAM,SACtBA,EAAM,UAAU,QACZ,CAAC8mD,GAAc9mD,EAAM,SAAS,UAAU,QAAUA,EAAM,UAAU,QAClEA,EAAM,UAAU,MAAM,MAAM,KAAM,CAACwC,EAAS,GAAG4mB,CAAI,CAAC,CAG/D,CAED,WAAWppB,EAAO,CACd,KAAK,OAASA,EACd,KAAK,YAAcA,EAAM,QACzB,KAAK,YAAcA,CACtB,CAED,mBAAoB,CAChB,KAAK,OAAS,KACd,KAAK,YAAc,EACnB,KAAK,iBAAmB,EACxB,KAAK,IAAM,KAAK,YAAY,IAC5B,KAAK,WAAW,KAAK,IAAI,eAAe,EAAE,CAAC,EAC3C,MAAMwC,EAAU,CAAC,SAAU,GAAI,UAAW,OAAW,YAAa,MAAS,EAC3E,KAAK,WAAW,KAAK,OAAQ,CAAE,EAAEA,CAAO,EACxC,KAAK,eAAiB,MACzB,CASD,8BAA8BukD,EAAa,CACvC,IAAIC,EAAM,KAAK,OACf,EAAG,CACC,QAAS,EAAI,EAAGhjD,EAAI+iD,EAAY,OAAQ,EAAI/iD,EAAG,IAAK,CAChD,MAAMijD,EAAaF,EAAY,CAAC,EAChC,GAAKC,EAAI,SAIF,CACH,MAAME,EAAQjB,GAAiB,oBAAoBe,EAAI,OAAQC,CAAU,EACzE,GAAI,KAAKC,CAAK,EACV,OAAOD,CAEd,SAROD,EAAI,UAAUC,CAAU,EACxB,OAAOA,CAQlB,CACDD,EAAMA,EAAI,QACb,OAAQA,EACZ,CAED,OAAO,qBAAqBhnD,EAAOukD,EAAO,CACtC,MAAMx4B,EAAS,GACf,KAAO/rB,EAAM,QAAUukD,GACnBx4B,EAAO,KAAK/rB,CAAK,EACjBA,EAAQA,EAAM,SAElB,OAAO+rB,CACV,CAED,OAAO,gBAAgBo7B,EAAQC,EAAQ,CACnC,MAAMC,EAAcvB,GAAa,mBAAmBqB,CAAM,EACpDG,EAAcxB,GAAa,mBAAmBsB,CAAM,EACpDpjD,EAAI,KAAK,IAAIqjD,EAAY,OAAQC,EAAY,MAAM,EACzD,QAAS5tD,EAAI,EAAGA,EAAIsK,EAAGtK,IACnB,GAAI2tD,EAAY3tD,CAAC,IAAM4tD,EAAY5tD,CAAC,EAChC,OAAO2tD,EAAY3tD,EAAI,CAAC,EAGhC,OAAO2tD,EAAYrjD,EAAI,CAAC,CAC3B,CAED,OAAO,mBAAmBhE,EAAO,CAC7B,MAAM0B,EAAS,GACf,GACIA,EAAO,KAAK1B,CAAK,QACbA,EAAQA,EAAM,UACtB,OAAO0B,EAAO,SACjB,CAED,OAAO,iBAAiB1B,EAAOukD,EAAO,CAClC,GAAI,EAAAA,EAAQvkD,EAAM,SAIlB,MAAMukD,EAAQvkD,EAAM,SAChBA,EAAQA,EAAM,SAElB,OAAOA,EACV,CACL,CAEA,MAAMimD,EAAiB,CAEnB,YAAY7sD,EAAM,CACd,KAAK,MAAQA,EACb,KAAK,QAAU,KAEf,KAAK,KAAI,CACZ,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,MAAO,CACH,KAAK,QAAU,KAAK,gBAEpB,KAAK,UAAY,KAAK,eAEtB,KAAK,kCAAiC,CAEzC,CAED,eAAgB,CACZ,MAAMA,EAAO,KAAK,MAEZ4+B,EAAS,cAAiC5+B,CAAK,CACjD,aAAc,CAEV,GADA,MAAM,GAAG,SAAS,EACd,CAAC,KAAK,YAAY,eAAe,WAAW,EAC5C,MAAM,IAAI,MAAM,sBAAsB,OAAAA,EAAK,KAAI,yBAAwB,OAAAA,EAAK,KAAI,IAAG,CAE1F,CACb,EACQ,OAAA4+B,EAAO,UAAY,GACnBA,EAAO,UAAU,YAAc5+B,EAC/B4+B,EAAO,SAAW5+B,EAElB,KAAK,0BAA0B4+B,CAAM,EAE9BA,CACV,CAED,0BAA0BA,EAAQ,CAE9B,MAAMub,EAAQ,OAAO,oBAAoBuS,GAAa,SAAS,EAC/D,QAAS,EAAI,EAAG9hD,EAAIuvC,EAAM,OAAQ,EAAIvvC,EAAG,IAAK,CAC1C,MAAMyD,EAAO8rC,EAAM,CAAC,EACpB,GAAI9rC,IAAS,cAAe,CACxB,MAAM8/C,EAAa,OAAO,yBAAyBzB,GAAa,UAAWr+C,CAAI,EAC/E,OAAO,eAAeuwB,EAAO,UAAWvwB,EAAM8/C,CAAU,CAC3D,CACJ,CACJ,CAED,mCAAoC,CAChB,KAAK,qBAEb,QAAQlB,GAAU,CACtB,KAAK,iBAAiBA,CAAM,CACxC,CAAS,CACJ,CAKD,iBAAiBA,EAAQ,CACrB,MAAMmB,EAAa,OAAO,KAAK,KAAK,SAAS,EACvCC,EAAc,GACdC,EAAU,GAChBF,EAAW,QAAQ,CAACtB,EAAWpiD,IAAU,CACrC,MAAM9D,EAAQ,KAAK,UAAUkmD,CAAS,EAChCqB,EAAa,KAAK,eAAevnD,EAAOqmD,CAAM,EACpD,GAAIkB,EAAY,CACZE,EAAY3jD,CAAK,EAAIyjD,EAGrB,MAAML,EAAQjB,GAAiB,oBAAoBsB,EAAW,QAAQ,OAAQlB,CAAM,EACpFqB,EAAQ5jD,CAAK,EAAIojD,EAEZ,KAAK,QAAQ,UAAU,eAAeA,CAAK,GAC5C,OAAO,eAAe,KAAK,QAAQ,UAAWA,EAAOK,CAAU,CAEnF,MACgBE,EAAY3jD,CAAK,EAAI,KACrB4jD,EAAQ5jD,CAAK,EAAI,IAEjC,CAAS,EAED,IAAI1K,EAYJ,OAXAquD,EAAY,QAAQF,GAAc,CAC9B,GAAIA,EAAY,CACZ,MAAMI,EAAW,KAAK,mBAAmBJ,CAAU,EACnD,GAAInuD,GAASA,IAASuuD,EAAW,CAC7B,QAAQ,KAAK,sBAAsB,OAAAtB,EAAM,QAAO,YAAK,MAAM,KAAI,2BAA0B,EACzF,MACH,CACDjtD,EAAOuuD,CACV,CACb,CAAS,EAEMvuD,EAAI,CACP,IAAK,SACD,KAAK,iBAAiBitD,EAAQoB,EAAaC,CAAO,EAClD,MACJ,IAAK,SACD,KAAK,wBAAwBrB,CAAM,EACnC,MACJ,IAAK,WACD,QAAQ,KAAK,8EAA8E,EAC3F,KACP,CACJ,CAED,eAAermD,EAAOqmD,EAAQuB,EAAU,IAAM,GAAM,CAChD,IAAIxuD,EAAO4G,EACP6nD,EAAW7nD,EAEf,EAAG,CACC,MAAMunD,EAAa,OAAO,yBAAyBnuD,EAAK,UAAWitD,CAAM,EACzE,GAAIkB,GACIK,EAAQL,CAAU,EAClB,OAAAA,EAAW,QAAUM,EACdN,EAGfnuD,EAAO,OAAO,eAAeA,CAAI,EAC7BA,GAAQA,EAAK,eAAe,SAAS,IACrCyuD,EAAWzuD,EAE3B,OAAgBA,GAAQA,EAAK,UAExB,CAED,mBAAmBmuD,EAAY,CAC3B,OAAIA,EAAW,KAAOA,EAAW,IACtB,SAEH,OAAOA,EAAW,OAAU,WACrB,SAEA,UAGlB,CAED,OAAO,iBAAkB,CACrB,GAAI,KAAK,mBAAqB,OAAW,CACrC,KAAK,iBAAmB,GACxB,GAAI,CACa,IAAI,SAAS,iCAAiC,IAE3D,KAAK,iBAAmB,EACxC,OAAoB5uD,EAAG,CAAE,CAChB,CACD,OAAO,KAAK,gBACf,CAED,iBAAiB0tD,EAAQoB,EAAaC,EAAS,CAC3C,MAAMx3B,EAAO,CAET,sCACA,2BACZ,EACQ,IAAI82B,EAAMU,EAAQ,CAAC,EACnB,MAAMI,EAAiB7B,GAAiB,kBACxC,QAASvsD,EAAI,EAAGsK,EAAI0jD,EAAQ,OAAQhuD,EAAIsK,EAAGtK,IAAK,CAC5C,MAAMwtD,EAAQQ,EAAQhuD,CAAC,EACnBwtD,IAAUF,IACNA,EACIc,EACA53B,EAAK,KAAK,WAAW,OAAAx2B,EAAC,mBAAkB,OAAAstD,EAAG,yBAAwB,EAEnE92B,EAAK,KAAK,WAAW,OAAAx2B,EAAC,mBAAkB,OAAAstD,EAAG,kCAAiC,EAGhF92B,EAAK,KAAK,WAAW,OAAAx2B,EAAC,kBAAiB,GAG/CstD,EAAME,CACT,CACGF,EACIc,EACA53B,EAAK,KAAK,gBAAgB,OAAA82B,EAAG,oBAAmB,EAEhD92B,EAAK,KAAK,gBAAgB,OAAA82B,EAAG,6BAA4B,EAG7D92B,EAAK,KAAK,GAAG,EAEjB,MAAM63B,EAAe73B,EAAK,KAAK,IAAI,EAG7Bq3B,EAAa,CAAC,MAFL,IAAI,SAAS,CAAE,EAAEQ,CAAY,CAEX,EACjC,OAAO,eAAe,KAAK,QAAQ,UAAW1B,EAAQkB,CAAU,CACnE,CAED,wBAAwBlB,EAAQ,CAC5B,MAAMf,EAAS,KAAK,iBAAiBe,CAAM,EACrCroD,EAAS,KAAK,iBAAiBqoD,CAAM,EACrCkB,EAAa,CACf,IAAKjC,EACL,IAAKtnD,CACjB,EACQ,OAAO,eAAe,KAAK,QAAQ,UAAWqoD,EAAQkB,CAAU,CACnE,CAED,iBAAiBlB,EAAQ,CACrB,MAAMmB,EAAa,OAAO,KAAK,KAAK,SAAS,EAEvCE,EAAU,GAChBF,EAAW,QAAQ,CAACtB,EAAWpiD,IAAU,CACrC,MAAM9D,EAAQ,KAAK,UAAUkmD,CAAS,EAChCqB,EAAa,KAAK,eAAevnD,EAAOqmD,EAASkB,GAAcA,EAAW,KAChF,GAAIA,EAAY,CAIZ,MAAML,EAAQjB,GAAiB,oBAAoBsB,EAAW,QAAQ,OAAQlB,CAAM,EACpFqB,EAAQ5jD,CAAK,EAAIojD,EAEZ,KAAK,QAAQ,UAAU,eAAeA,CAAK,GAC5C,OAAO,eAAe,KAAK,QAAQ,UAAWA,EAAOK,CAAU,CAEnF,MAEgBG,EAAQ5jD,CAAK,EAAI,IAEjC,CAAS,EAED,MAAMosB,EAAO,CAET,sCACA,2BACZ,EACQ,IAAI82B,EAAMU,EAAQ,CAAC,EACnB,QAAShuD,EAAI,EAAGsK,EAAI0jD,EAAQ,OAAQhuD,EAAIsK,EAAGtK,IAAK,CAC5C,MAAMwtD,EAAQQ,EAAQhuD,CAAC,EACnBwtD,IAAUF,IACNA,EACA92B,EAAK,KAAK,WAAW,OAAAx2B,EAAC,mBAAkB,OAAAstD,EAAG,WAAU,EAErD92B,EAAK,KAAK,WAAW,OAAAx2B,EAAC,kBAAiB,GAG/CstD,EAAME,CACT,CACGF,EACA92B,EAAK,KAAK,gBAAgB,OAAA82B,EAAG,MAAK,EAElC92B,EAAK,KAAK,GAAG,EAEjB,MAAM63B,EAAe73B,EAAK,KAAK,IAAI,EAEnC,OADe,IAAI,SAAS,CAAE,EAAE63B,CAAY,CAE/C,CAED,iBAAiB1B,EAAQ,CACrB,MAAMmB,EAAa,OAAO,KAAK,KAAK,SAAS,EAEvCE,EAAU,GAChBF,EAAW,QAAQ,CAACtB,EAAWpiD,IAAU,CACrC,MAAM9D,EAAQ,KAAK,UAAUkmD,CAAS,EAChCqB,EAAa,KAAK,eAAevnD,EAAOqmD,EAASkB,GAAcA,EAAW,KAChF,GAAIA,EAAY,CAIZ,MAAML,EAAQjB,GAAiB,oBAAoBsB,EAAW,QAAQ,OAAQlB,CAAM,EACpFqB,EAAQ5jD,CAAK,EAAIojD,EAEZ,KAAK,QAAQ,UAAU,eAAeA,CAAK,GAC5C,OAAO,eAAe,KAAK,QAAQ,UAAWA,EAAOK,CAAU,CAEnF,MAEgBG,EAAQ5jD,CAAK,EAAI,IAEjC,CAAS,EAED,MAAMosB,EAAO,CAET,sCACA,2BACZ,EACQ,IAAI82B,EAAMU,EAAQ,CAAC,EACnB,QAAShuD,EAAI,EAAGsK,EAAI0jD,EAAQ,OAAQhuD,EAAIsK,EAAGtK,IAAK,CAC5C,MAAMwtD,EAAQQ,EAAQhuD,CAAC,EACnBwtD,IAAUF,IACNA,EACA92B,EAAK,KAAK,WAAW,OAAAx2B,EAAC,YAAW,OAAAstD,EAAG,iBAAgB,EAEpD92B,EAAK,KAAK,WAAW,OAAAx2B,EAAC,WAAU,GAGxCstD,EAAME,CACT,CACGF,EACA92B,EAAK,KAAK,SAAS,OAAA82B,EAAG,YAAW,EAEjC92B,EAAK,KAAK,GAAG,EAEjB,MAAM63B,EAAe73B,EAAK,KAAK,IAAI,EAEnC,OADe,IAAI,SAAS,CAAC,KAAK,EAAG63B,CAAY,CAEpD,CAED,OAAO,oBAAoBh2B,EAAMs0B,EAAQ,CACrC,MAAO,KAAOt0B,EAAOA,EAAO,IAAM,IAAMs0B,CAC3C,CAED,oBAAqB,CACjB,MAAM2B,EAAW,KAAK,UAChBz4B,EAAM,OAAO,KAAKy4B,CAAQ,EAChC,IAAIC,EAAU,IAAI,IAClB,OAAA14B,EAAI,QAAQ22B,GAAa,CACrB,GAAIA,IAAc,GAEd,OAEJ,MAAMlmD,EAAQgoD,EAAS9B,CAAS,EAClB,KAAK,qBAAqBlmD,CAAK,EACvC,QAAQyH,GAAQ,CAClBwgD,EAAQ,IAAIxgD,CAAI,CAChC,CAAa,CACb,CAAS,EACM,CAAC,GAAGwgD,CAAO,CACrB,CAED,qBAAqBjoD,EAAO,CACxB,IAAI5G,EAAO4G,EACPioD,EAAU,IAAI,IAClB,MAAMC,EAAS,KAAK,QAAUloD,EAC9B,GACkB,KAAK,4BAA4B5G,CAAI,EAC7C,QAAQqO,GAAQ,CAClBwgD,EAAQ,IAAIxgD,CAAI,CAChC,CAAa,EAEDrO,EAAO,OAAO,eAAeA,CAAI,QAC7BA,GAAQA,EAAK,YAAc,CAACA,EAAK,eAAe,SAAS,GAAK8uD,IAEtE,OAAOD,CACV,CAED,4BAA4B7uD,EAAM,CAE9B,OADoB,OAAO,oBAAoBA,EAAK,SAAS,EAC1C,OAAO6tD,GACdA,IAAe,eAAkB,CAAChB,GAAiB,oBAAoBgB,CAAU,CAC5F,CACJ,CAED,OAAO,oBAAoBA,EAAY,CACnC,OAAQA,IAAe,UAAcA,IAAe,OACvD,CAED,eAAef,EAAW,CACtB,GAAI,KAAK,UAAUA,CAAS,EACxB,OAAO,KAAK,UAAUA,CAAS,EAInC,MAAMzT,EAAQyT,EAAU,MAAM,GAAG,EACjC,KAAMzT,EAAM,OAAO,CACf,MAAMyT,EAAYzT,EAAM,KAAK,GAAG,EAChC,GAAI,KAAK,UAAUyT,CAAS,EACxB,OAAO,KAAK,UAAUA,CAAS,CAEtC,CACJ,CAED,cAAe,CACX,OAAK,KAAK,YACN,KAAK,UAAY,KAAK,mBAEnB,KAAK,SACf,CAED,iBAAkB,CACd,MAAM8B,EAAW,GACjB,YAAK,UAAU,KAAK,MAAO,KAAM,GAAIA,CAAQ,EACtCA,CACV,CAED,UAAUhoD,EAAOmoD,EAAa1gD,EAAMugD,EAAU,CAC1ChoD,EAAM,QAAU,GAChBA,EAAM,OAASyH,EAEf,KAAK,wBAAwBzH,EAAOmoD,CAAW,EAE/C,MAAMC,EAAcD,EAAcA,EAAY,OAAS,GACvD,IAAIp2B,GAAQq2B,EAAaA,EAAa,IAAM,IAAM3gD,EAClDzH,EAAM,OAAS+xB,EACf/xB,EAAM,QAAUmoD,EAAcA,EAAY,QAAU,EAAI,EACxDnoD,EAAM,SAAWmoD,EACjBnoD,EAAM,QAAU,OAAO,KAAKgoD,CAAQ,EAAE,OACtCA,EAASj2B,CAAI,EAAI/xB,EAEjB,MAAM+rB,EAAS/rB,EAAM,QACjB+rB,IAC+Bo8B,GAAeA,EAAY,UAAYp8B,GAEhD/rB,EAAM,UACd,QAAQqoD,GAAY,CAC1B,MAAMC,EAAYrC,GAAiB,cAAcoC,CAAQ,EACzD,KAAK,UAAUA,EAAUroD,EAAOsoD,EAAWN,CAAQ,CACvE,CAAiB,EAGZ,CAED,OAAO,cAAchoD,EAAO,CACxB,MAAMyH,EAAOzH,EAAM,KAEb8D,EAAQ2D,EAAK,QAAQ,GAAG,EAC9B,OAAI3D,EAAQ,EAED2D,EAAK,OAAO,EAAG3D,CAAK,EAGxB2D,CACV,CAED,wBAAwBzH,EAAOmoD,EAAa,CACpCA,IAC0BA,GAAe,CAACA,EAAY,SAElD,KAAK,QAAQnoD,EAAM,MAAM,EAAIA,EAE7BmoD,EAAYnoD,EAAM,MAAM,EAAIA,EAGvC,CAEL,CC9rBe,MAAMuoD,WAAkB/F,CAAQ,CAE3C,YAAYnyC,EAAOs1C,EAAY,CAC3B,MAAMt1C,CAAK,EAGX,KAAK,QAAU,GAEXsiC,EAAM,gBAAgBgT,CAAU,GAChC,OAAO,OAAO,KAAMA,CAAU,EAGlC,KAAK,cAAgB,GACrB,KAAK,cAAgB,GACrB,KAAK,cAAgB,GAErB,KAAK,UAAY,OAEjB,KAAK,cAAgB,OAErB,KAAK,YAAW,EAGhB,MAAMnS,EAAO,KAAK,YAAY,gBAAgB,IAAI,EAClDA,EAAK,EAAE,KAAMA,EAAK,CAAC,EAEnB,KAAK,OAAM,CACd,CAED,SAAU,CACNsS,GAAa,kBAAkB,IAAI,EACnC,KAAK,eAAiByC,GAAU,UAAU,eAC7C,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,WACf,CAED,iBAAkB,CAEV,KAAK,aACL,KAAK,YAAY,iBAExB,CAED,UAAW,CAEH,KAAK,aACL,KAAK,YAAY,iBAExB,CAED,OAAO,SAAS9gD,EAAM+rC,EAAO,KAAM,CAC/B,MAAO,CAAC,kBAAmB,GAAM,OAAQ/rC,EAAM,OAAQ+rC,CAAI,CAC9D,CAED,eAAegV,EAASC,EAAWC,EAAY,CAE3C,MAAMh/B,EAAM++B,EACNh+B,EAAOi+B,EACPC,EAAmB,MAAM,QAAQH,EAAQ,MAAM,EAAIA,EAAQ,OAAS,CAACA,EAAQ,MAAM,EAGzF,QAAS9uD,EAAI,EAAGA,EAAIivD,EAAiB,OAAQjvD,IAAK,CAC9C,MAAM2N,EAAWshD,EAAiBjvD,CAAC,EAC7B85C,EAAOgV,EAAQ,OAASA,EAAQ,OAAUhmD,GAAYA,EAAQ6E,CAAQ,EAEvE,KAAK,eAAeA,CAAQ,EAY7B,KAAK,mBAAmB,OAAAA,EAAU,EAAE,KAAK,CAAC,MAAOqiB,EAAK,OAAQe,EAAM,OAAQ+oB,CAAI,CAAC,GAXjF,KAAK,mBAAmB,OAAAnsC,EAAU,EAAI,CAAC,CAAC,MAAOqiB,EAAK,OAAQe,EAAM,OAAQ+oB,CAAI,CAAC,EAC/E,OAAO,eAAe,KAAMnsC,EAAU,CAClC,IAAMxJ,GAAU,CACZ,KAAK,UAAU,OAAAwJ,EAAU,EAAIxJ,EAC7B,SAAW,CAAC,MAAA+qD,EAAO,OAAAC,EAAQ,OAAAC,CAAM,IAAK,KAAK,mBAAmB,OAAAzhD,EAAU,EACpEuhD,EAAMC,CAAM,EAAIC,EAAO,IAAI,CAElC,EACD,IAAK,IAAM,KAAK,UAAU,OAAAzhD,EAAU,CACxD,CAAiB,EAIR,CACJ,CAKD,OAAO,gBAAgB0hD,EAAK,CAExB,MAAMthD,EAAO,gBAGPuhD,EAAU,QAAUvhD,EAC1B,OAAI,KAAKuhD,CAAO,IAAM,OAClB,KAAKA,CAAO,EAAI,KAChB,KAAKvhD,CAAI,EAAI,KAAK,cAAc,KAAK,UAAUshD,CAAG,CAAC,GAEhD,KAAKthD,CAAI,CACnB,CAED,OAAO,cAAciiB,EAAK,CACtB,MAAMlnB,EAAU,CACZ,IAAK,CAAE,EACP,MAAO,CAAE,EACT,IAAK,CACjB,EAEQ,KAAK,iBAAiBknB,EAAKlnB,EAAS,SAAS,EAE7C,MAAM0tB,EAAO1tB,EAAQ,IAAI,KAAK,KAAK,EAEnC,MAAO,CAAC,EADE,IAAI,SAAS,UAAW,QAAS0tB,CAAI,EACjC,EAAG1tB,EAAQ,KAAK,CACjC,CAED,OAAO,iBAAiBknB,EAAKlnB,EAASymD,EAAQ,CAC1C,MAAMC,EAAQ1mD,EAAQ,MAChB2mD,EAAM3mD,EAAQ,IACP,OAAO,KAAKknB,CAAG,EACvB,QAAQtpB,GAAO,CAChB,IAAIvC,EAAQ6rB,EAAItpB,CAAG,EACnB,GAAIuyC,EAAM,SAASvyC,EAAI,WAAW,CAAC,CAAC,EAEhC,GAAIuyC,EAAM,gBAAgB90C,CAAK,EAAG,CAE9B,MAAMurD,EAAc,IAAI,OAAAhpD,EAAI,QAAQ,cAAe,EAAE,EAAIoC,EAAQ,KACjE,IAAIpJ,EAAOyE,EAAM,KAAOA,EAAM,KAAO2kD,EACjCppD,IAASopD,EACT2G,EAAI,KAAK,OAAO,OAAAC,EAAW,mCAAkC,GAE7DF,EAAM,KAAK9vD,CAAI,EACf+vD,EAAI,KAAK,OAAO,OAAAC,EAAW,iBAAgB,OAAAF,EAAM,OAAS,EAAC,MAAK,OAAAD,EAAM,UAAS,GAEnFE,EAAI,KAAK,GAAG,OAAAC,EAAW,YAAW,OAAAhpD,EAAG,IAAG,EACxCoC,EAAQ,MAGR,KAAK,iBAAiB3E,EAAO2E,EAAS4mD,CAAW,EAEjDD,EAAI,KAAK,GAAG,OAAAF,EAAM,mBAAkB,OAAAG,EAAW,IAAG,CACrD,MAAUzW,EAAM,SAAS90C,CAAK,IAE3BqrD,EAAM,KAAKrrD,CAAK,EAChBsrD,EAAI,KAAK,GAAG,OAAAF,EAAM,yBAAwB,OAAAC,EAAM,OAAS,EAAC,KAAI,WAG9D9oD,IAAQ,OAAQ,CAChB,MAAMipD,EAAUJ,EAAS,SACzBE,EAAI,KAAK,OAAO,OAAAE,EAAO,OAAM,OAAAJ,EAAM,uBAAsB,EACrDprD,EAAM,oBAAsB,IAE5BqrD,EAAM,KAAKrrD,CAAK,EAChBsrD,EAAI,KAAK,gCAAgC,OAAAD,EAAM,OAAS,EAAC,OAAM,OAAAD,EAAM,OAAM,OAAA7oD,EAAG,KAAI,GAElF,KAAK,qBAAqBvC,EAAO2E,EAAS6mD,CAAO,CAEzE,SAA2BjpD,IAAQ,UAAYuyC,EAAM,gBAAgB90C,CAAK,EAAG,CACzD,MAAMyrD,EAAe,GAAG,OAAAL,EAAM,cAC9BC,EAAM,KAAKrrD,CAAK,EAChBsrD,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,eAAc,OAAA8oD,EAAM,OAAS,EAAC,IAAG,EAC3D,KAAK,sBAAsBrrD,EAAO2E,EAAS8mD,CAAY,CAC3E,SAA2BlpD,IAAQ,WAAauyC,EAAM,gBAAgB90C,CAAK,EAAG,CAC1D,MAAMwrD,EAAUJ,EAAS,YACnB7vD,EAAOyE,EAAM,KACfzE,GACA8vD,EAAM,KAAK9vD,CAAI,EACf+vD,EAAI,KAAK,OAAO,OAAAE,EAAO,iBAAgB,OAAAH,EAAM,OAAS,EAAC,MAAK,OAAAD,EAAM,UAAS,EAC3E,KAAK,qBAAqBprD,EAAO2E,EAAS6mD,CAAO,EACjDF,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,SAAQ,OAAAipD,EAAS,IAE3CF,EAAI,KAAK,GAAG,OAAAE,EAAO,OAAM,OAAAJ,EAAM,WAAU,EACzC,KAAK,qBAAqBprD,EAAO2E,EAAS6mD,CAAO,EAEzE,MAA2B1W,EAAM,gBAAgB90C,CAAK,GAAKA,EAAM,oBAAsB,IACnEqrD,EAAM,KAAKrrD,CAAK,EAChBsrD,EAAI,KAAK,gCAAgC,OAAAD,EAAM,OAAS,EAAC,OAAM,OAAAD,EAAM,OAAM,OAAA7oD,EAAG,KAAI,GAG9EuyC,EAAM,SAAS90C,CAAK,EACpBsrD,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,SAAQ,OAAAvC,EAAO,EAClC80C,EAAM,UAAU90C,CAAK,EAC5BsrD,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,SAAQ,OAAAvC,EAAQ,OAAS,QAAS,EACrD80C,EAAM,SAAS90C,CAAK,GAAK,MAAM,QAAQA,CAAK,GAGnDqrD,EAAM,KAAKrrD,CAAK,EAChBsrD,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,eAAc,OAAA8oD,EAAM,OAAS,EAAC,IAAG,GAG3DC,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,SAAQ,YAAK,UAAUvC,CAAK,EAAG,CAIjF,CAAS,CACJ,CAED,OAAO,qBAAqB6rB,EAAKlnB,EAASymD,EAAQ,CAC9C,MAAMC,EAAQ1mD,EAAQ,MAChB2mD,EAAM3mD,EAAQ,IACP,OAAO,KAAKknB,CAAG,EACvB,QAAQtpB,GAAO,CAChB,GAAIA,IAAQ,OAAQ,CAChB,MAAMvC,EAAQ6rB,EAAItpB,CAAG,EACjBuyC,EAAM,SAAS90C,CAAK,EACpBsrD,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,SAAQ,OAAAvC,EAAO,EAClC80C,EAAM,UAAU90C,CAAK,EAC5BsrD,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,SAAQ,OAAAvC,EAAQ,OAAS,QAAS,EACrD80C,EAAM,SAAS90C,CAAK,GAAKA,EAAM,oBAAsB,IAC5DqrD,EAAM,KAAKrrD,CAAK,EAChBsrD,EAAI,KAAK,gCAAgC,OAAAD,EAAM,OAAS,EAAC,OAAM,OAAAD,EAAM,OAAM,OAAA7oD,EAAG,KAAI,GAC3EuyC,EAAM,SAAS90C,CAAK,GAAK,MAAM,QAAQA,CAAK,GAGnDqrD,EAAM,KAAKrrD,CAAK,EAChBsrD,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,eAAc,OAAA8oD,EAAM,OAAS,EAAC,IAAG,GAG3DC,EAAI,KAAK,GAAG,OAAAF,EAAM,MAAK,OAAA7oD,EAAG,SAAQ,YAAK,UAAUvC,CAAK,EAAG,CAEhE,CACb,CAAS,CACJ,CAED,OAAO,sBAAsB6rB,EAAKlnB,EAASymD,EAAQ,CAC/C,MAAMC,EAAQ1mD,EAAQ,MAChB2mD,EAAM3mD,EAAQ,IACP,OAAO,KAAKknB,CAAG,EACvB,QAAQtpB,GAAO,CAChB,GAAIA,IAAQ,OAAQ,CAChB,MAAMvC,EAAQ6rB,EAAItpB,CAAG,EACjBuyC,EAAM,gBAAgB90C,CAAK,GAAKA,EAAM,oBAAsB,KAC5DqrD,EAAM,KAAKrrD,CAAK,EAChBsrD,EAAI,KAAK,gCAAgC,OAAAD,EAAM,OAAS,EAAC,OAAM,OAAAD,EAAM,OAAM,OAAA7oD,EAAG,KAAI,EAEzF,CACb,CAAS,CACJ,CAED,UAAW,CACF,KAAK,eACN,KAAK,OAAM,CAElB,CAED,QAAS,CACR,CAED,WAAY,CACH,KAAK,gBACN,KAAK,OAAM,EACX,KAAK,cAAgB,IAGzB,KAAK,QAAO,CACf,CAED,SAAU,CACT,CAED,WAAY,CACR,KAAK,QAAO,CACf,CAED,SAAU,CACT,CAED,YAAa,CACJ,KAAK,gBACN,KAAK,aAAY,EACjB,KAAK,cAAgB,IAGzB,KAAK,QAAO,CACf,CAED,cAAe,CACd,CAED,SAAU,CACT,CAED,aAAc,CACV,KAAK,SAAQ,CAChB,CAED,UAAW,CACV,CAED,WAAY,CACH,KAAK,gBACN,KAAK,aAAY,EACjB,KAAK,cAAgB,IAGzB,KAAK,QAAO,CACf,CAED,cAAe,CACd,CAED,SAAU,CACT,CAED,aAAc,CACV,KAAK,UAAS,CACjB,CAED,WAAY,CACX,CAED,IAAI,aAAc,CACd,OAAO,KAAK,MAAM,WACrB,CAED,aAAc,CACV,KAAK,WAAU,CAClB,CAED,YAAa,CACZ,CAED,QAAS,CACR,CAED,QAAS,CACL,KAAK,MAAK,CACb,CAED,OAAQ,CACP,CAED,OAAOmpD,EAAWC,EAAY,CAC7B,CAED,SAASD,EAAW,CACnB,CAED,aAAa5iD,EAAQ4iD,EAAW,CAC/B,CAED,aAAc,CAEV,OAAO,IACV,CAED,kBAAkBrgD,EAAU,CAE3B,CAED,qBAAqBA,EAAU,CAE9B,CAED,OAAO,WAAY,CACf,MAAO,EACV,CAED,eAAgB,CACZ,IAAI6oB,EAAO,KAAK,YAAY,WAC5B,OAAOA,GAAQA,EAAK,QAAUA,EAAKA,EAAK,OAAS,CAAC,IAAM,IAC3D,CAED,UAAW,CACP,IAAIA,EAAO,KAAK,YAAY,WAC5B,OAAOA,GAASA,EAAK,QAAQ,IAAI,GAAK,CACzC,CAED,IAAI,SAAU,CACV,OAAOw2B,GAAU,UAAU,IAAI,CAClC,CAED,mBAAmBnvD,EAAM,CACrB,IAAIgF,EAAI,KAAK,QACb,KAAOA,GAAG,CACN,GAAIA,EAAE,cAAgBhF,EAClB,OAAOgF,EAEXA,EAAIA,EAAE,OACT,CACJ,CAED,2BAA2B+xB,EAAS,CAChC,IAAIs5B,EAAW,KAAK,kBAAkBt5B,CAAO,EAC7C,KAAOs5B,GAAY,CAACA,EAAS,aACzBA,EAAWA,EAAS,OAExB,OAAOA,CACV,CAED,IAAI,SAAU,CACV,OAAO,KAAK,SACf,CAED,IAAI,QAAQ3qD,EAAG,CACN6zC,EAAM,gBAAgB7zC,CAAC,GACxB,KAAK,YAAY,yDAAyD,EAE9E,KAAK,UAAYA,CACpB,CAED,IAAI,aAAaA,EAAG,CACX6zC,EAAM,gBAAgB7zC,CAAC,GACxB,KAAK,YAAY,yDAAyD,EAEzE,KAAK,YACN,KAAK,UAAY,IAErB,QAASsB,KAAOtB,EACFA,EAAEsB,CAAG,IACL,OACN,OAAO,KAAK,UAAUA,CAAG,EAEzB,KAAK,UAAUA,CAAG,EAAItB,CAGjC,CAED,IAAI,aAAc,CACd,OAAO,KAAK,eAAiB,EAChC,CAED,IAAI,YAAYA,EAAG,CACf,KAAK,cAAgB,OAAO,OAAO,KAAK,eAAiB,GAAIA,CAAC,CACjE,CAED,IAAI,iBAAiBA,EAAG,CACf6zC,EAAM,gBAAgB7zC,CAAC,GACxB,KAAK,YAAY,yDAAyD,EAEzE,KAAK,gBACN,KAAK,cAAgB,IAEzB,QAASsB,KAAOtB,EACFA,EAAEsB,CAAG,IACL,OACN,OAAO,KAAK,cAAcA,CAAG,EAE7B,KAAK,cAAcA,CAAG,EAAItB,CAGrC,CAQD,OAAOtG,KAAU4wB,EAAM,CACnB,OAAO,KAAK,QAAQ5wB,EAAO4wB,CAAI,CAClC,CAED,QAAQ5wB,EAAO4wB,EAAM,CACjB,MAAMsgC,EAAe,KAAK,0BAC1B,GAAIA,EAAc,CACd,GAAI,KAAK,UAAW,CAChB,IAAIC,EAAY,KAAK,UAAUnxD,CAAK,EACpC,GAAImxD,IAAc,GAEd,OAEJ,GAAIA,EAAW,CAKX,GAJIA,IAAc,KACdA,EAAYnxD,GAGZm6C,EAAM,WAAWgX,CAAS,EAC1B,OAAOA,EAAU,GAAGvgC,CAAI,EAG5B,GAAIsgC,EAAa,WAAWC,CAAS,EACjC,OAAOD,EAAaC,CAAS,EAAE,GAAGvgC,CAAI,CAE7C,CACJ,CAED,IAAIwgC,EAAc,KAAK,eAAiB,KAAK,cAAcpxD,CAAK,EAChE,GAAIoxD,EAEA,OAAIA,GAAcA,IAAe,KAE7BpxD,EAAQoxD,GAGLF,EAAa,QAAQlxD,EAAO4wB,CAAI,CAE9C,CACJ,CAED,yBAA0B,CACtB,OAAO,KAAK,QAAU,KAAK,QAAQ,kBAAmB,EAAG,IAC5D,CAED,mBAAoB,CAChB,OAAI,KAAK,aACE,KAAK,QAAU,KAAK,QAAQ,kBAAmB,EAAG,KAEtD,IACV,CAED,IAAI,cAAe,CACf,MAAO,EACV,CAED,cAAc3hB,KAAS2hB,EAAM,CACzB,GAAI,CAAC3hB,EAAK,WAAW,GAAG,EACpB,MAAM,IAAI,MAAM,sDAAsD,EAG1E,MAAMiJ,EAAS,KAAK,0BACpB,GAAIA,EACA,OAAOA,EAAO,iBAAiBjJ,EAAM2hB,CAAI,CAEhD,CAED,iBAAiB3hB,EAAM2hB,EAAM,CACzB,GAAI,KAAK,WAAW3hB,CAAI,EACpB,OAAO,KAAK,KAAKA,EAAM,GAAG2hB,CAAI,EAC3B,CACH,MAAMsgC,EAAe,KAAK,0BAC1B,GAAIA,EACA,OAAOA,EAAa,iBAAiBjiD,EAAM2hB,CAAI,CAEtD,CACJ,CAED,OAAO,qBAAqBvoB,EAAMsvB,EAAS,CACvC,GAAIA,EAAQ,cAAe,CACvB,MAAMu1B,EAAYv1B,EAAQ,YAC1B,QAASz2B,EAAI,EAAGsK,EAAI0hD,EAAU,OAAQhsD,EAAIsK,EAAGtK,IAAK,CAC9C,MAAMqO,EAAQ29C,EAAU,MAAMhsD,CAAC,EAC3BqO,EAAM,YACNlH,EAAK,KAAKkH,CAAK,EAEfwgD,GAAU,qBAAqB1nD,EAAMkH,CAAK,CAEjD,CACJ,CACJ,CAED,OAAO,aAAaooB,EAAS,CACzB,IAAIzf,EAASyf,EACb,KAAOzf,GAAU,CAACA,EAAO,aACrBA,EAASA,EAAO,OAEpB,OAAOA,CACV,CAED,OAAO,UAAUyf,EAAS,CACtB,OAAOo4B,GAAU,aAAap4B,EAAQ,MAAM,CAC/C,CACL,CAEAo4B,GAAU,UAAU,YAAc,GC/iBnB,MAAMsB,EAAa,CAE9B,YAAYd,EAAK,CAEb,KAAK,IAAMA,EAEX,KAAK,aAAe,GAEpB,KAAK,aAAe,EACvB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,aAAa,MAC5B,CAED,OAAQ,CACJ,KAAK,aAAe,GACpB,KAAK,aAAe,GACpB,KAAK,WAAa,CACrB,CAED,WAAWjlD,EAAO,CACd,OAAO,KAAK,aAAaA,CAAK,EAAE,QACnC,CAED,eAAeA,EAAO,CAClB,OAAO,KAAK,aAAaA,CAAK,CACjC,CAED,WAAWA,EAAO,CACd,OAAO,KAAK,aAAaA,CAAK,CACjC,CAED,gBAAgBA,EAAO,CACnB,IAAI+1C,EAAgB,KAAK,aAAa/1C,CAAK,EAC3C,OAAI+1C,EAAc,EAEPA,EAAc,EAEd,KAAK,aAAa/1C,CAAK,EAAE,wBAAwB,CAE/D,CAED,iBAAiBA,EAAO,CACpB,IAAI+1C,EAAgB,KAAK,aAAa/1C,CAAK,EAC3C,OAAI+1C,EAAc,EAEPA,EAAc,EAEd,KAAK,aAAa/1C,CAAK,EAAE,wBAAwB,CAE/D,CAEL,CCnDe,MAAMgmD,WAA0BD,EAAa,CAExD,YAAYd,EAAK,CACb,MAAMA,CAAG,EAIT,MAAMgB,EAAWhB,EAAI,MAAM,UAAU,cAAc,EAEnD,KAAK,WAAa,EAElB,KAAK,KAAO,IAAI,YAAYgB,CAAQ,EACpC,KAAK,OAAS,IAAI,aAAa,KAAK,IAAI,EACxC,KAAK,MAAQ,IAAI,YAAY,KAAK,IAAI,CACzC,CAED,yBAAyBjmD,EAAO,CAE5B,OAAOA,EAAQ,EAClB,CAED,iBAAkB,CAEd,IAAIkmD,EAAS,KAAK,OACdC,EAAQ,KAAK,MACbrnC,EAAQ,GACZ,QAASlpB,EAAI,EAAGA,GAAK,KAAK,OAAQA,IAAK,CACnC,IAAI8B,EAAM,SAAW9B,EAAI,KACzB,QAASqL,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,IAAI/I,EAAItC,EAAI,GAAKqL,EAAI,EACrBvJ,GAAOwuD,EAAOhuD,CAAC,EAAI,IAAMguD,EAAOhuD,EAAE,CAAC,EAAI,IAAMguD,EAAOhuD,EAAE,CAAC,EAAI,IAAMguD,EAAOhuD,EAAE,CAAC,EAAI,IAAMiuD,EAAMjuD,EAAE,CAAC,EAAE,SAAS,EAAE,EAAI,IAClH,CACD4mB,EAAM,KAAKpnB,CAAG,CACjB,CAED,OAAOonB,CACV,CAGL,CCxCe,MAAMsnC,EAAkB,CAEnC,YAAYnB,EAAKt4C,EAAQ05C,EAAa1N,EAAmB2N,EAAStmD,EAAO,CAErE,KAAK,IAAMilD,EACX,KAAK,OAASt4C,EACd,KAAK,YAAc05C,EACnB,KAAK,kBAAoB1N,EACzB,KAAK,QAAU2N,EACf,KAAK,MAAQtmD,EACb,KAAK,OAAS,CAEjB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,IAAI,YAAY,KAC/B,CAED,WAAWA,EAAO,CACd,OAAO,KAAK,MAAM,WAAW,KAAK,MAAQA,CAAK,CAClD,CAED,eAAeA,EAAO,CAClB,OAAO,KAAK,MAAM,eAAe,KAAK,MAAQA,CAAK,CACtD,CAED,WAAWA,EAAO,CACd,OAAO,KAAK,MAAM,WAAW,KAAK,MAAQA,CAAK,CAClD,CAED,gBAAgBA,EAAO,CACnB,OAAO,KAAK,WAAWA,CAAK,EAAE,WACjC,CAED,iBAAiBA,EAAO,CACpB,OAAO,KAAK,WAAWA,CAAK,EAAE,YACjC,CAED,gBAAgBA,EAAO,CACnB,OAAO,KAAK,MAAM,gBAAgB,KAAK,MAAQA,CAAK,CACvD,CAED,iBAAiBA,EAAO,CACpB,OAAO,KAAK,MAAM,iBAAiB,KAAK,MAAQA,CAAK,CACxD,CAED,gBAAiB,CACb,OAAI,KAAK,kBACE,KAAK,kBAAkB,EAEvB,KAAK,IAAI,MAAM,CAE7B,CAED,iBAAkB,CACd,OAAI,KAAK,kBACE,KAAK,kBAAkB,EAEvB,KAAK,IAAI,MAAM,CAE7B,CAEL,CC7De,MAAMumD,WAA+BH,EAAkB,CAElE,YAAYnB,EAAKt4C,EAAQ05C,EAAa1N,EAAmB2N,EAAStmD,EAAO,CACrE,MAAMilD,EAAKt4C,EAAQ05C,EAAa1N,EAAmB2N,EAAStmD,CAAK,EAEjE,KAAK,2BAA6B,CACrC,CAED,yBAAyBA,EAAO,CAE5B,OAAO,KAAK,MAAM,yBAAyB,KAAK,MAAQA,CAAK,CAChE,CAQD,6BAA6B2L,EAAGC,EAAG,CAC/B,IAAI46C,EAAS,KAAK,YAAY,uBAAuB76C,EAAGC,CAAC,EACzD,OAAA46C,EAAO,CAAC,GAAK,KAAK,eAAc,EAChCA,EAAO,CAAC,GAAK,KAAK,gBAAe,EACjCA,EAAO,CAAC,EAAIA,EAAO,CAAC,EAAI,EAAI,EAC5BA,EAAO,CAAC,EAAI,EAAIA,EAAO,CAAC,EAAI,EACrBA,CACV,CAED,eAAgB,CACZ,OAAI,KAAK,oBAAsB,KACpB,KAAK,IAAI,WAAW,YAEpB,KAAK,kBAAkB,cAAc,UAEnD,CAEL,CCrCe,MAAMC,EAAmB,CAEpC,YAAYxB,EAAK,CACb,KAAK,IAAMA,EAEX,KAAK,YAAcA,EAAI,YAEvB,KAAK,GAAK,KAAK,IAAI,MAAM,EAC5B,CAED,SAAU,CACN,KAAK,IAAM,KACX,KAAK,YAAc,KACnB,KAAK,GAAK,KAEV,OAAO,KAAK,IACZ,OAAO,KAAK,YACZ,OAAO,KAAK,EACf,CAED,QAAS,CACL,KAAK,mBAAmB,IAAI,EAC5B,KAAK,YAAY,IAAI,EACrB,KAAK,oBAAmB,CAC3B,CAED,SAAU,CACN,KAAK,OAAM,EAEX,IAAIyB,EAAO,KAAK,YAAY,eAExB9wD,EAAI,EAAUsK,EAAIwmD,EAAK,OAC3B,KAAO9wD,EAAIsK,GACP,KAAK,sBAAsBwmD,EAAK9wD,CAAC,CAAC,EAClCA,GAEP,CAED,sBAAsB+wD,EAAe,CAC7BA,EAAc,mBAAqBA,EAAc,kBAAkB,SAKvE,KAAK,oBAAoBA,CAAa,EACtC,KAAK,mBAAmBA,CAAa,EAExC,CAED,oBAAoBA,EAAe,CAClC,CAED,mBAAmBC,EAAI,CAEnB,IAAI7Q,EAAgB6Q,EAAG,kBAAoBA,EAAG,kBAAkB,cAAgB,KAE5E,KAAK,iBAAmB7Q,GACxB,KAAK,mBAAmBA,CAAa,EAGrC6Q,EAAG,mBAAqB,CAACA,EAAG,kBAAkB,SAC9C,KAAK,YAAY,IAAI,EACrB,KAAK,oBAAmB,EACxBA,EAAG,kBAAkB,QAAU,GAC/B,KAAK,YAAYA,EAAG,OAAO,GAE3B,KAAK,YAAYA,EAAG,OAAO,EAG/B,KAAK,qBAAqBA,CAAE,CAC/B,CAED,qBAAqBA,EAAI,CACxB,CAED,mBAAmBC,EAAe,CAC9B,KAAK,eAAiBA,CACzB,CAED,oBAAoBA,EAAe,CAClC,CAED,YAAY1O,EAAM,CACjB,CAEL,CCpFe,MAAM2O,WAAgCL,EAAmB,CAEpE,YAAYxB,EAAK,CACb,MAAMA,CAAG,EAET,KAAK,GAAK,KAAK,IAAI,MAAM,GAEzB,KAAK,KAAI,CACZ,CAED,MAAO,CACH,IAAIh2C,EAAK,KAAK,GAGd,KAAK,eAAiBA,EAAG,eAEzB,IAAI83C,EAAW,KAAK,MAAM,KAAK,YAAY,MAAM,KAAK,WAAa,EAAE,EAGjEC,EAAa,IAAI,YAAYD,EAAW,CAAC,EAG7C,QAASnxD,EAAI,EAAGqL,EAAI,EAAGrL,EAAImxD,EAAUnxD,GAAK,EAAGqL,GAAK,EAC9C+lD,EAAWpxD,CAAC,EAAIqL,EAChB+lD,EAAWpxD,EAAI,CAAC,EAAIqL,EAAI,EACxB+lD,EAAWpxD,EAAI,CAAC,EAAIqL,EAAI,EACxB+lD,EAAWpxD,EAAI,CAAC,EAAIqL,EACpB+lD,EAAWpxD,EAAI,CAAC,EAAIqL,EAAI,EACxB+lD,EAAWpxD,EAAI,CAAC,EAAIqL,EAAI,EAI5B,KAAK,aAAegO,EAAG,eACvBA,EAAG,WAAWA,EAAG,qBAAsB,KAAK,YAAY,EACxDA,EAAG,WAAWA,EAAG,qBAAsB+3C,EAAY/3C,EAAG,WAAW,EAGjE,KAAK,YAAc,IAAI,aAAa,CAAC,EAAE,KAAK,IAAI,MAAM,YAAa,GAAG,KAAK,IAAI,MAAM,YAAY,CAAC,CAErG,CAED,SAAU,CACN,MAAM,QAAO,EACb,KAAK,GAAG,aAAa,KAAK,cAAc,EACxC,KAAK,GAAG,aAAa,KAAK,YAAY,EAEtC,KAAK,GAAK,KACV,OAAO,KAAK,EACf,CAED,QAAS,CACL,MAAM,OAAM,EAEZ,IAAIA,EAAK,KAAK,GACdA,EAAG,UAAUA,EAAG,IAAKA,EAAG,mBAAmB,EAC3CA,EAAG,OAAOA,EAAG,KAAK,EAClBA,EAAG,QAAQA,EAAG,UAAU,EAExB,KAAK,mBAAkB,EACvB,KAAK,cAAa,CACrB,CAED,eAAgB,CACZ,IAAIA,EAAK,KAAK,GACdA,EAAG,WAAWA,EAAG,qBAAsB,KAAK,YAAY,EACxD,IAAIod,EAAU,IAAI,aAAa,KAAK,YAAY,MAAM,KAAM,EAAG,KAAK,YAAY,MAAM,UAAU,EAChGpd,EAAG,WAAWA,EAAG,aAAc,KAAK,cAAc,EAClDA,EAAG,WAAWA,EAAG,aAAcod,EAASpd,EAAG,YAAY,CAC1D,CAED,oBAAoB03C,EAAe,CAC/B,MAAM,oBAAoBA,CAAa,EACvC,KAAK,kBAAkBA,EAAc,OAAQA,CAAa,CAC7D,CAED,qBAAqBC,EAAI,CACrB,IAAIj6C,EAASi6C,EAAG,QAEZA,EAAG,QAAUA,EAAG,OAAO,SAAQ,KAC/Bj6C,EAAO,WAAWi6C,CAAE,EACpBj6C,EAAO,KAAKi6C,CAAE,EACdj6C,EAAO,UAAUi6C,CAAE,EAE1B,CAMD,kBAAkBj6C,EAAQs6C,EAAW,CAC5Bt6C,EAAO,eAAe,KAAK,qBAAqB,IAC7C,KAAK,uBACL,KAAK,sBAAsB,cAE/BA,EAAO,WAAU,EACjB,KAAK,sBAAwBA,GAEjCA,EAAO,cAAcs6C,CAAS,CACjC,CAED,oBAAqB,CACb,KAAK,wBAEL,KAAK,sBAAsB,cAC3B,KAAK,sBAAwB,KAEpC,CAED,mBAAmBJ,EAAe,CAC9B,MAAM,mBAAmBA,CAAa,EAEtC,IAAI53C,EAAK,KAAK,GACT,KAAK,gBAINA,EAAG,gBAAgBA,EAAG,YAAa,KAAK,eAAe,WAAW,EAClEA,EAAG,SAAS,EAAE,EAAE,KAAK,eAAe,EAAG,KAAK,eAAe,CAAC,IAJ5DA,EAAG,gBAAgBA,EAAG,YAAa,IAAI,EACvCA,EAAG,SAAS,EAAE,EAAE,KAAK,IAAI,MAAM,EAAE,KAAK,IAAI,MAAM,CAAC,EAKxD,CAED,qBAAsB,CAClB,MAAM,oBAAmB,EACzB,IAAIA,EAAK,KAAK,GACd,GAAK,KAAK,eAQNA,EAAG,WAAW,EAAG,EAAG,EAAG,CAAC,EACxBA,EAAG,MAAMA,EAAG,gBAAgB,MATN,CACtB,IAAIi4C,EAAe,KAAK,IAAI,MAAM,cAAa,EAC3CA,IACAj4C,EAAG,WAAWi4C,EAAa,CAAC,EAAIA,EAAa,CAAC,EAAGA,EAAa,CAAC,EAAIA,EAAa,CAAC,EAAGA,EAAa,CAAC,EAAIA,EAAa,CAAC,EAAGA,EAAa,CAAC,CAAC,EACtIj4C,EAAG,MAAMA,EAAG,gBAAgB,EAE5C,CAKK,CAED,YAAYkpC,EAAM,CAGd,GAFA,MAAM,YAAYA,CAAI,EAElB,KAAK,WAAaA,EAClB,OAEJ,KAAK,SAAWA,EAEhB,IAAIlpC,EAAK,KAAK,GACd,GAAI,CAACkpC,EACDlpC,EAAG,QAAQA,EAAG,YAAY,MACvB,CACHA,EAAG,OAAOA,EAAG,YAAY,EACzB,IAAI+O,EAAY,KAAK,IAAI,MAAM,mBAAkB,EAC7CpS,EAAIusC,EAAK,CAAC,EACV,KAAK,iBAAmB,OAExBvsC,EAAK,KAAK,IAAI,MAAM,EAAIoS,GAAam6B,EAAK,CAAC,EAAIA,EAAK,CAAC,IAEzDlpC,EAAG,QAAQ,KAAK,MAAMkpC,EAAK,CAAC,EAAIn6B,CAAS,EAAG,KAAK,MAAMpS,EAAIoS,CAAS,EAAG,KAAK,MAAMm6B,EAAK,CAAC,EAAIn6B,CAAS,EAAG,KAAK,MAAMm6B,EAAK,CAAC,EAAIn6B,CAAS,CAAC,CAC1I,CACJ,CAEL,CClKe,MAAMmpC,EAAgB,CAEjC,YAAYlC,EAAK,CACb,KAAK,IAAMA,EAEX,KAAK,MAAQA,EAAI,MAEjB,KAAK,cAAgB,KAAK,MAAM,SAAS,iBAAiBA,CAAG,EAE7D,KAAK,SAAWA,EAAI,MAAM,SAE1B,KAAK,MAAQ,KAAK,SAAS,mBAAmBA,CAAG,CAEpD,CAED,OAAQ,CACJ,KAAK,mBAAqB,KAE1B,KAAK,SAAW,KAEhB,KAAK,QAAU,KAEf,KAAK,aAAe,KAEpB,KAAK,YAAc,KAEnB,KAAK,OAAS,GAEd,KAAK,eAAiB,GAEtB,KAAK,YAAc,KAEnB,KAAK,qBAAuB,GAE5B,KAAK,eAAiB,KAEtB,KAAK,MAAM,QAEX,KAAK,sBAAwB,GAE7B,KAAK,qBAAuB,EAE/B,CAED,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,aAAa,MAClC,CAED,UAAUt4C,EAAQrT,EAAO,EACjB,KAAK,eAAiBA,GAAS,KAAK,cAAgBqT,KAIpD,KAAK,YAAcA,EAEfA,EAAO,eAEPA,EAAS,KAAK,gBAEd,KAAK,UAAYA,GAAU,KAAK,eAAiBrT,KACjD,KAAK,QAAUqT,EACf,KAAK,aAAerT,EACpB,KAAK,OAAS,IAGzB,CAED,IAAI,mBAAoB,CACpB,OAAO,KAAK,kBACf,CAED,WAAW6+C,EAAM,CACT,KAAK,WAAaA,IACdA,EACA,KAAK,SAAWA,EAEhB,KAAK,SAAW,KAEpB,KAAK,OAAS,GAErB,CAED,YAAa,CACT,OAAO,KAAK,QACf,CAED,qBAAqBQ,EAAmB,CAChC,KAAK,qBAAuBA,IAC5B,KAAK,mBAAqBA,EAC1B,KAAK,SAAW,KAChB,KAAK,OAAS,GAErB,CAMD,cAAcyO,EAAYliB,EAAQ,GAAO,CACrC,KAAK,YAAckiB,EACnB,KAAK,iBAAmBliB,CAC3B,CAED,IAAI,oBAAoBlqC,EAAG,CACvB,KAAK,qBAAuBA,CAC/B,CAED,IAAI,qBAAsB,CACtB,OAAO,KAAK,oBACf,CAED,QAAQ66C,EAAa,CACZ,KAAK,eAEC,KAAK,QAAU,KAAK,YAAW,IACtC,KAAK,qBAAoB,EACzB,KAAK,OAAS,IAHd,KAAK,qBAAoB,EAM7B,IAAIE,EAAgB,KAChB,KAAK,cACLA,EAAgB,KAAK,YAAY,mBAE5B,KAAK,kBAEN,KAAK,sBAAsB,KAAK,KAAK,WAAW,GAInDA,IACDA,EAAgBF,EAAY,wBAAwB,eAGpD,KAAK,qBACD,KAAK,UAAY,KAAK,eAAiB,KAAK,mBAAmB,OAE/D,KAAK,mBAAmB,cAAgBE,EACxC,KAAK,mBAAmB,OAAS,KAAK,QAGtC,KAAK,mBAAmB,cAAgB,KAE5C,KAAK,mBAAmB,MAAQ,IAGpC,KAAK,MAAM,aAAa,KAAKA,CAAa,EAC1C,KAAK,MAAM,aAAa,KAAKF,CAAW,EAExC,KAAK,eAAe,SAEpB,KAAK,SAAS,QAAQ,KAAM,KAAK,MAAO,KAAK,OAAS,CAAC,CAC1D,CAED,uBAAwB,CAChB,KAAK,mBAAmB,gBAInB,KAAK,6BACN,KAAK,mBAAmB,cAAgB,MAGnD,CAED,0BAA2B,CACvB,MAAMn2B,EAAS,KAAK,mBAAmB,OACvC,OAAQ,KAAK,MAAM,aAAaA,CAAM,EAAE,IAAM,KAAK,mBAAmB,GACjE,KAAK,MAAM,aAAaA,CAAM,EAAE,IAAM,KAAK,mBAAmB,GAC/D,KAAK,SAAS,wBAAwB,KAAM,KAAK,kBAAkB,CAC1E,CAED,aAAc,CACV,IAAI7pB,EAAI,KAAK,eAIb,OAHI,KAAK,UAAYA,EAAE,QACnB,KAAK,eAAiBA,EAAE,aACxB,KAAK,qBAAuBA,EAAE,mBAC9B,KAAK,WAAaA,EAAE,UACf,KAAK,SAAS,CAAC,IAAMA,EAAE,QAAQ,CAAC,GAAO,KAAK,SAAS,CAAC,IAAMA,EAAE,QAAQ,CAAC,GAAO,KAAK,SAAS,CAAC,IAAMA,EAAE,QAAQ,CAAC,GAAO,KAAK,SAAS,CAAC,IAAMA,EAAE,QAAQ,CAAC,EAMjK,CAED,qBAAqBy+B,EAAS,GAAM,CAChC,GAAI,KAAK,eAAgB,CAQrB,IAPI,KAAK,eAAe,QAAU,KAAK,QAAQ,cACvC,CAAC,KAAK,eAAe,SAAa,KAAK,eAAe,QAAQ,CAAC,EAAI,GAAO,KAAK,eAAe,QAAQ,CAAC,EAAI,IAE3G,KAAK,eAAe,KAAK,KAAK,cAAc,EAIhD,KAAK,sBAAsB,OAAQ,CACnC,QAAS1+B,EAAI,EAAGsK,EAAI,KAAK,sBAAsB,OAAQtK,EAAIsK,EAAGtK,IAG1D,KAAK,sBAAsBA,CAAC,EAAE,qBAAoB,EAEtD,KAAK,sBAAwB,EAChC,CAED,KAAK,eAAiB,IACzB,CAEG0+B,GACA,KAAK,qBAAoB,CAEhC,CAED,sBAAuB,CACnB,KAAK,eAAiB,KAAK,SAAS,wBAChC,KAAK,IACL,KAAK,QACL,KAAK,aACL,KAAK,mBACL,KAAK,SACL,KAAK,MACjB,EACQ,KAAK,OAAS,EACjB,CAED,QAAS,CACD,KAAK,gBAEL,KAAK,qBAAqB,EAAK,EAGnC,KAAK,SAAS,kBAAkB,IAAI,CACvC,CAEL,CCrOe,MAAM+yB,EAAmB,CAEpC,YAAYC,EAAoBC,EAAsB,CAElD,KAAK,mBAAqBD,EAC1B,KAAK,qBAAuBC,EAE5B,KAAK,SAAW,KAChB,KAAK,GAAK,KAEV,KAAK,kBAAoB,IAAI,IAC7B,KAAK,oBAAsB,IAAI,IAE/B,KAAK,sBAAwB,EAChC,CAED,QAAQt4C,EAAI,CACR,GAAI,KAAK,SAAU,OAEnB,KAAK,GAAKA,EAEV,KAAK,SAAWA,EAAG,gBAEnB,IAAIu4C,EAAe,KAAK,WAAWv4C,EAAG,cAAe,KAAK,kBAAkB,EACxEw4C,EAAe,KAAK,WAAWx4C,EAAG,gBAAiB,KAAK,oBAAoB,EAEhFA,EAAG,aAAa,KAAK,SAAUu4C,CAAY,EAC3Cv4C,EAAG,aAAa,KAAK,SAAUw4C,CAAY,EAC3Cx4C,EAAG,YAAY,KAAK,QAAQ,EAGvBA,EAAG,oBAAoB,KAAK,SAAUA,EAAG,WAAW,IACrD,QAAQ,MAAM,iDAAiD,EAC/D,QAAQ,MAAM,iCAAkCA,EAAG,oBAAoB,KAAK,SAAUA,EAAG,eAAe,CAAC,EACzG,QAAQ,MAAM,4BAA6BA,EAAG,SAAU,GAGpDA,EAAG,kBAAkB,KAAK,QAAQ,IAAM,IACxC,QAAQ,KAAK,8CAA+CA,EAAG,kBAAkB,KAAK,QAAQ,CAAC,EAGnGA,EAAG,cAAc,KAAK,QAAQ,EAC9B,KAAK,SAAW,MAIpBA,EAAG,aAAau4C,CAAY,EAC5Bv4C,EAAG,aAAaw4C,CAAY,CAC/B,CAED,WAAWnyD,EAAMkB,EAAK,CAClB,IAAImW,EAAS,KAAK,GAAG,aAAarX,CAAI,EAKtC,GAHA,KAAK,GAAG,aAAaqX,EAAQnW,CAAG,EAChC,KAAK,GAAG,cAAcmW,CAAM,EAExB,CAAC,KAAK,GAAG,mBAAmBA,EAAQ,KAAK,GAAG,cAAc,EAAG,CAC7D,QAAQ,MAAM,cAAe,KAAK,YAAY,KAAM,UAAYrX,IAAS,KAAK,GAAG,cAAgB,gBAAkB,kBAAkB,EACrI,QAAQ,MAAM,cAAe,KAAK,GAAG,iBAAiBqX,CAAM,CAAC,EAC7D,IAAI0C,EAAM,EACV,eAAQ,MAAM,cAAe,iCAAmC7Y,EAAI,MAAM,IAAI,EAAE,IAAIwkB,GAAQ,IAAM,EAAE3L,EAAO,KAAO2L,CAAI,EAAE,KAAK,IAAI,CAAC,EAC3H,IACV,CAED,OAAOrO,CACV,CAED,mBAAmBhJ,EAAM,CACrB,IAAIwrB,EAAW,KAAK,kBAAkB,IAAIxrB,CAAI,EAC9C,OAAIwrB,IAAa,SACbA,EAAW,KAAK,GAAG,mBAAmB,KAAK,SAAUxrB,CAAI,EACzD,KAAK,kBAAkB,IAAIA,EAAMwrB,CAAQ,GAGtCA,CACV,CAED,kBAAkBxrB,EAAM,CACpB,IAAIwrB,EAAW,KAAK,oBAAoB,IAAIxrB,CAAI,EAChD,OAAIwrB,IAAa,SACbA,EAAW,KAAK,GAAG,kBAAkB,KAAK,SAAUxrB,CAAI,EACxD,KAAK,oBAAoB,IAAIA,EAAMwrB,CAAQ,GAGxCA,CACV,CAED,SAAU,CACF,KAAK,UACL,KAAK,GAAG,cAAc,KAAK,QAAQ,EAGvC,KAAK,oBAAsB,KAC3B,KAAK,sBAAwB,KAC7B,KAAK,qBAAuB,KAC5B,KAAK,SAAW,KAChB,KAAK,GAAK,KACV,KAAK,kBAAoB,KACzB,KAAK,mBAAqB,KAE1B,OAAO,KAAK,mBACZ,OAAO,KAAK,SACZ,OAAO,KAAK,sBACZ,OAAO,KAAK,qBACZ,OAAO,KAAK,GACZ,OAAO,KAAK,kBACZ,OAAO,KAAK,mBAEf,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,QACf,CAED,IAAI,UAAW,CACX,MAAO,CAAC,CAAC,KAAK,QACjB,CAED,aAAa8d,EAAIC,EAAI,CAEjB,GAAID,EAAG,QAAUC,EAAG,OAAQ,CACxB,QAAS,EAAI,EAAGhtC,EAAI+sC,EAAG,OAAQ,EAAI/sC,EAAG,IAClC,GAAI+sC,EAAG,CAAC,IAAMC,EAAG,CAAC,EAAG,MAAO,GAEhC,MAAO,EACnB,KACY,QAAQD,IAAOC,CAEtB,CAED,YAAYlyC,EAAG,CACX,OAAIA,EAAE,OACKA,EAAE,MAAM,CAAC,EAETA,CAEd,CAED,gBAAgB2I,EAAM5J,EAAO2tD,EAAY,CACrC,IAAI1sD,EAAI,KAAK,sBAAsB2I,CAAI,EACvC,GAAI3I,IAAM,QAAa,CAAC,KAAK,aAAaA,EAAGjB,CAAK,EAAG,CACjD,IAAI4tD,EAAc,KAAK,YAAY5tD,CAAK,EACxC,KAAK,sBAAsB4J,CAAI,EAAIgkD,EAEnC,IAAItC,EAAM,KAAK,mBAAmB1hD,CAAI,EAClC0hD,IACgBqC,IAAe,KAAK,GAAG,kBAAoBA,IAAe,KAAK,GAAG,kBAAoBA,IAAe,KAAK,GAAG,iBAEzHA,EAAW,KAAK,KAAK,GAAIrC,EAAK,GAAOsC,CAAW,EAEhDD,EAAW,KAAK,KAAK,GAAIrC,EAAKsC,CAAW,EAGpD,CACJ,CAEL,CC5Je,MAAMC,WAAoBjO,EAAO,CAE5C,YAAYsL,EAAK,CACb,MAAMA,CAAG,EAET,MAAM14C,EAAQ04C,EAAI,MAElB,KAAK,SAAW14C,EAAM,SAAS,eAAe,IAAI,KAAK,WAAW,EAC7D,KAAK,WACN,KAAK,SAAW,IAAI86C,GAAmB,KAAK,YAAY,mBAAoB,KAAK,YAAY,oBAAoB,EAGjH96C,EAAM,SAAS,eAAe,IAAI,KAAK,YAAa,KAAK,QAAQ,GAGrE,KAAK,GAAKA,EAAM,EACnB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,SAAS,SACxB,CAED,OAAQ,CACC,KAAK,eACN,KAAK,WAAU,EACf,KAAK,aAAe,GAE3B,CAED,YAAa,CACT,KAAK,SAAS,QAAQ,KAAK,EAAE,CAChC,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,SAAS5I,EAAM,CACX,OAAO,KAAK,SAAS,mBAAmBA,CAAI,CAC/C,CAED,QAAQA,EAAM,CACV,OAAO,KAAK,SAAS,kBAAkBA,CAAI,CAC9C,CAED,YAAYA,EAAM5J,EAAO2tD,EAAY,CACjC,KAAK,SAAS,gBAAgB/jD,EAAM5J,EAAO2tD,CAAU,CACxD,CAED,YAAa,CACT,KAAK,MAAK,EACV,KAAK,GAAG,WAAW,KAAK,SAAS,EACjC,KAAK,YAAW,EAChB,KAAK,cAAa,CACrB,CAED,aAAc,CACV,KAAK,WAAU,EACf,KAAK,eAAc,CACtB,CAED,eAAet7C,EAAO,CAElB,OAAQA,IAAWA,IAAU,MAAUA,EAAM,WAAa,KAAK,SAClE,CAED,aAAc,CAEb,CAED,YAAa,CAEZ,CAED,eAAgB,CAEf,CAED,gBAAiB,CAEhB,CAED,8BAA+B,CAC3B,MAAO,EACV,CAED,6BAA6B66C,EAAW,CACpC,OAAOA,EAAU,2BAA6BA,EAAU,MAAQ,EAAI,KAAK,8BAC5E,CAED,wBAAwBA,EAAW,CAGlC,CAED,cAAcA,EAAW,CAIxB,CAED,eAAeA,EAAW,CACtB,OAAOA,EAAU,eACpB,CAED,SAASA,EAAW,CAChB,OAAO,KAAK,eAAeA,CAAS,EAAE,CAAC,EAAI,CAC9C,CAED,WAAWA,EAAW,CACrB,CAED,KAAKA,EAAW,CACf,CAED,UAAUA,EAAW,CACpB,CAED,SAAU,CACN,KAAK,aAAe,EAEvB,CAEL,OC5He,cAA4BW,EAAY,CAEnD,eAAgB,CAEZ,IAAI34C,EAAK,KAAK,GACdA,EAAG,oBAAoB,KAAK,QAAQ,iBAAiB,EAAG,EAAGA,EAAG,MAAO,GAAO,GAAI,CAAC,EACjFA,EAAG,wBAAwB,KAAK,QAAQ,iBAAiB,CAAC,EAEtD,KAAK,QAAQ,eAAe,IAAM,KAClCA,EAAG,oBAAoB,KAAK,QAAQ,eAAe,EAAG,EAAGA,EAAG,MAAO,GAAO,GAAI,EAAI,CAAC,EACnFA,EAAG,wBAAwB,KAAK,QAAQ,eAAe,CAAC,GAGxD,KAAK,QAAQ,QAAQ,IAAM,KAE3BA,EAAG,oBAAoB,KAAK,QAAQ,QAAQ,EAAG,EAAGA,EAAG,cAAe,GAAM,GAAI,EAAI,CAAC,EACnFA,EAAG,wBAAwB,KAAK,QAAQ,QAAQ,CAAC,EAExD,CAED,gBAAiB,CAEb,IAAIA,EAAK,KAAK,GACdA,EAAG,yBAAyB,KAAK,QAAQ,iBAAiB,CAAC,EAEvD,KAAK,QAAQ,eAAe,IAAM,IAClCA,EAAG,yBAAyB,KAAK,QAAQ,eAAe,CAAC,EAGzD,KAAK,QAAQ,QAAQ,IAAM,IAC3BA,EAAG,yBAAyB,KAAK,QAAQ,QAAQ,CAAC,CAEzD,CAED,cAAcg4C,EAAW,CACrB,KAAK,YAAY,aAAc,KAAK,eAAeA,CAAS,EAAG,KAAK,GAAG,WAAY,EAAK,CAC3F,CAED,KAAKA,EAAW,CACZ,IAAIh4C,EAAK,KAAK,GAEVzM,EAASykD,EAAU,OAEvB,GAAIzkD,EAAQ,CACR,IAAIqlD,EAAYZ,EAAU,WAAW,CAAC,EAClClyD,EAAM,EACV,QAASa,EAAI,EAAGA,EAAI4M,EAAQ5M,IAAK,CAC7B,IAAIsjD,EAAK+N,EAAU,WAAWrxD,CAAC,EAC3BiyD,IAAc3O,IACdjqC,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EACvC54C,EAAG,aAAaA,EAAG,UAAW,GAAKrZ,EAAIb,GAAMka,EAAG,gBAAiBla,EAAMkyD,EAAU,OAAS,EAAI,CAAC,EAC/FY,EAAY3O,EACZnkD,EAAMa,EAEb,CAEDqZ,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EACvC54C,EAAG,aAAaA,EAAG,UAAW,GAAKzM,EAASzN,GAAMka,EAAG,gBAAiBla,EAAMkyD,EAAU,OAAS,EAAI,CAAC,CACvG,CACJ,CAEL,EAEA3yC,EAAc,mBAAqB,knBAsBnCA,EAAc,qBAAuB,yVCvFtB,MAAMwzC,EAAS,CAE1B,YAAYv7C,EAAO,CACf,KAAK,MAAQA,EACb,KAAK,eAAiB,MACzB,CAED,GAAGw7C,EAAY,CACd,CAED,SAAU,CACT,CAED,iBAAiB9C,EAAM,KAAK,MAAM,IAAK,CACnC,OAAK,KAAK,iBACN,KAAK,eAAiB,KAAK,qBAAqBA,CAAG,GAEhD,KAAK,cACf,CAED,qBAAqBA,EAAK,CACzB,CAED,kBAAkB/7C,EAAY,CAC1B,OAAQA,EAAW,qBAAqB,KAAK,mBAAkB,CAClE,CAED,aAAa+7C,EAAK7/C,EAAU,CACxB,MAAM8D,EAAa9D,EAAS,KAE5B,GAAK,KAAK,kBAAkB8D,CAAU,EAO/B,CACH,MAAMyD,EAAS,IAAIzD,EAAW+7C,CAAG,EACjC,OAAAzV,GAAK,YAAY,KAAMpqC,CAAQ,EACxBuH,CACV,KAXwC,CACrC,MAAMq7C,EAAsB,KAAK,sBAAsB9+C,CAAU,EACjE,OAAK8+C,EAIE,IAAIA,EAAoB/C,CAAG,GAH9B,QAAQ,KAAK,+DAAiE/7C,EAAW,IAAI,EACtF,KAAK,qBAAqB+7C,CAAG,EAGpD,CAKK,CAED,oBAAqB,CACpB,CAED,sBAAsB/7C,EAAY,CAC9B,OAAO,KAAK,kBACf,CAED,kBAAkB29C,EAAe9Q,EAAe/7C,EAAS,CACrD,QAAQ,KAAK,yDAAyD,CACzE,CACL,CC5Ce,MAAMiuD,WAAsBH,EAAS,CAEhD,YAAYv7C,EAAO,CACf,MAAMA,CAAK,EACX,KAAK,eAAiB,IAAI,IAC1B,KAAK,6BAA+B,CAChC,KAAMA,EAAM,GAAG,aAAa,+BAA+B,EAC3D,KAAMA,EAAM,GAAG,aAAa,+BAA+B,EAC3D,KAAMA,EAAM,GAAG,aAAa,+BAA+B,EAC3D,MAAOA,EAAM,GAAG,aAAa,gCAAgC,CAChE,CACJ,CAED,gCAAiC,CAC7B,OAAO,KAAK,4BACf,CAED,SAAU,CACN,KAAK,eAAe,QAAQ27C,GAAiBA,EAAc,QAAO,CAAE,EAEpE,KAAK,eAAiB,KACtB,KAAK,6BAA+B,KAEpC,OAAO,KAAK,eACZ,OAAO,KAAK,4BACf,CAED,qBAAqBjD,EAAK,CACtB,OAAO,IAAI3wC,EAAc2wC,CAAG,CAC/B,CAED,oBAAqB,CACjB,OAAO2C,EACV,CAED,sBAAsB1+C,EAAY,CAC9B,OAAOA,EAAW,UAAYA,EAAW,SAAQ,CACpD,CAED,mBAAmB+7C,EAAK,CACpB,OAAO,IAAIe,GAAkBf,CAAG,CACnC,CAED,wBAAwBA,EAAKt4C,EAAQ05C,EAAa1N,EAAmB2N,EAAStmD,EAAO,CACjF,OAAO,IAAIumD,GAAuBtB,EAAKt4C,EAAQ05C,EAAa1N,EAAmB2N,EAAStmD,CAAK,CAChG,CAED,yBAAyBilD,EAAK,CAC1B,OAAO,IAAI6B,GAAwB7B,CAAG,CACzC,CAED,sBAAsBA,EAAK,CACvB,OAAO,IAAIkC,GAAgBlC,CAAG,CACjC,CAED,oBAAoB9mC,EAAGC,EAAGq5B,EAAI0Q,EAAI,CAC9B,MAAMl5C,EAAK,KAAK,MAAM,GAChB44C,EAAY54C,EAAG,gBACrB,OAAAA,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EAEvC54C,EAAG,WAAWA,EAAG,WAAY,EAAGA,EAAG,KAAMwoC,EAAI0Q,EAAI,EAAGl5C,EAAG,KAAMA,EAAG,cAAe,IAAI,EAEnFA,EAAG,cAAcA,EAAG,WAAYA,EAAG,mBAAoBA,EAAG,MAAM,EAChEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,mBAAoBA,EAAG,MAAM,EAChEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,eAAgBA,EAAG,aAAa,EACnEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,eAAgBA,EAAG,aAAa,EAEnE44C,EAAU,OAAS,GACnBA,EAAU,OAAO54C,EAAG,kBAAkB,EAAIA,EAAG,OAC7C44C,EAAU,OAAO54C,EAAG,kBAAkB,EAAIA,EAAG,OAC7C44C,EAAU,OAAO54C,EAAG,cAAc,EAAIA,EAAG,cACzC44C,EAAU,OAAO54C,EAAG,cAAc,EAAIA,EAAG,cACzC44C,EAAU,QAAU,CAAE,OAAQ54C,EAAG,KAAM,eAAgBA,EAAG,KAAM,KAAMA,EAAG,aAAa,EAGtF44C,EAAU,YAAc54C,EAAG,oBAC3B44C,EAAU,WAAa,IAAI,aAAa,CAAC,EAAI1pC,EAAG,EAAIC,CAAC,CAAC,EAEtDnP,EAAG,gBAAgBA,EAAG,YAAa44C,EAAU,WAAW,EACxD54C,EAAG,qBAAqBA,EAAG,YAAaA,EAAG,kBAAmBA,EAAG,WAAY44C,EAAW,CAAC,EAElFA,CACV,CAED,kBAAkBA,EAAW,CACzB,IAAI54C,EAAK,KAAK,MAAM,GACpBA,EAAG,kBAAkB44C,EAAU,WAAW,EAC1C54C,EAAG,cAAc44C,CAAS,CAC7B,CAED,kBAAkBO,EAAK9yD,EAAM,CACzB,MAAM2Z,EAAK,KAAK,MAAM,GAEtB,GAAIm5C,IAAQn5C,EAAG,KACX,OAAQ3Z,EAAI,CACR,KAAK2Z,EAAG,cACJ,MAAO,GAEX,KAAKA,EAAG,uBACJ,MAAO,GAEX,KAAKA,EAAG,uBACJ,MAAO,GAEX,QACI,MAAM,IAAI,MAAM,2CAA2C,CAClE,SAEIm5C,IAAQn5C,EAAG,IAChB,OAAQ3Z,EAAI,CACR,KAAK2Z,EAAG,cACJ,MAAO,GAEX,KAAKA,EAAG,oBACJ,MAAO,GAEX,QACI,MAAM,IAAI,MAAM,0CAA0C,CACjE,KAGD,OAAM,IAAI,MAAM,yDAAyD,CAEhF,CAED,oBAAoB8G,EAAe/b,EAAS,CACxC,MAAMiV,EAAK,KAAK,MAAM,GAEhB5T,EAASrB,EAAQ,OACvB,IAAIquD,EAAa,GACbruD,EAAQ,aACRquD,EAAaruD,EAAQ,WAAW,YAAc,IAGlD,MAAMsuD,EAAS,CACX,iBAAkB,GAClB,SAAU,EACtB,EAEYtuD,GAAWA,EAAQ,eAAe,kBAAkB,IACpDsuD,EAAO,iBAAmBtuD,EAAQ,kBAGlCA,GAAWA,EAAQ,eAAe,aAAa,IAC/CsuD,EAAO,YAActuD,EAAQ,aAG7BA,GAAWA,EAAQ,eAAe,UAAU,IAC5CsuD,EAAO,SAAWtuD,EAAQ,UAGzBsuD,EAAO,WACRA,EAAO,iBAAmB,IAG9BA,EAAO,UAAYtuD,EAAQ,WAAa,CAAE,EAC1CsuD,EAAO,WAAatuD,EAAQ,YAAc,CAAE,EAE5C,IAAI6tD,EAAY54C,EAAG,gBACnBA,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EAEvC54C,EAAG,YAAYA,EAAG,+BAAgCq5C,EAAO,gBAAgB,EAErEzZ,EAAM,QACN5/B,EAAG,YAAYA,EAAG,qBAAsB,CAAC,CAACq5C,EAAO,WAAW,EAGhE,MAAM9K,EAAY8K,EAAO,UAWzB,GAVK9K,EAAUvuC,EAAG,kBAAkB,IAAGuuC,EAAUvuC,EAAG,kBAAkB,EAAIA,EAAG,QACxEuuC,EAAUvuC,EAAG,kBAAkB,IAAGuuC,EAAUvuC,EAAG,kBAAkB,EAAIA,EAAG,QACxEuuC,EAAUvuC,EAAG,cAAc,IAAGuuC,EAAUvuC,EAAG,cAAc,EAAIA,EAAG,eAChEuuC,EAAUvuC,EAAG,cAAc,IAAGuuC,EAAUvuC,EAAG,cAAc,EAAIA,EAAG,eAErE,OAAO,KAAKuuC,CAAS,EAAE,QAAQlhD,GAAO,CAClC,MAAMvC,EAAQyjD,EAAUlhD,CAAG,EAC3B2S,EAAG,cAAcA,EAAG,WAAY,SAAS3S,CAAG,EAAGvC,CAAK,CAChE,CAAS,EAEGsuD,EACA,YAAK,MAAM,SAAS,0BAA0Bp5C,EAAI8G,EAAe1a,CAAM,EAChEwsD,EAGX,MAAMU,EAAaD,EAAO,WAC1B,OAAAC,EAAW,OAASA,EAAW,SAAWD,EAAO,SAAWr5C,EAAG,KAAOA,EAAG,KACzEs5C,EAAW,KAAOA,EAAW,MAAQt5C,EAAG,cACxCs5C,EAAW,eAAiBA,EAAW,gBAAkBA,EAAW,OAChEvuD,GAAWA,EAAQ,WACnBuuD,EAAW,SAAWvuD,EAAQ,UAGlC,KAAK,MAAM,SAAS,gBAAgBiV,EAAI8G,EAAe1a,EAAQktD,CAAU,EAEzEV,EAAU,OAAShZ,EAAM,gBAAgB2O,CAAS,EAClDqK,EAAU,QAAUhZ,EAAM,gBAAgB0Z,CAAU,EAGpDV,EAAU,cAAgB,KAAK,kBAAkBU,EAAW,OAAQA,EAAW,IAAI,EAE5EV,CACV,CAED,kBAAkB9xC,EAAe,CAC7B,KAAK,MAAM,GAAG,cAAcA,EAAc,aAAa,CAC1D,CAED,QAAQyiC,EAAagQ,EAAOxoD,EAAO,CAC/B,IAAI0f,EAAU1f,EAAQ,GACtB,MAAM61C,EAAc2S,EAAM,aAAaxoD,CAAK,EAE5C,IAAI2R,EAAIkkC,EAAY,eAEhBqQ,EAAS1N,EAAY,MAAM,OAC3B2N,EAAQ3N,EAAY,MAAM,MAC9B,MAAMiQ,EAAMzb,EAAW,gBAEvB,GAAIr7B,EAAE,KAAO,GAAKA,EAAE,KAAO,EACvBu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GACrBu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GACrBu0C,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BqQ,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BsQ,EAAMzmC,GAAQ,EAAI+oC,EAAI5S,EAAY,SAAUlkC,EAAE,KAAK,EACnDu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GAC7Cu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GAC7Cu0C,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BqQ,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BsQ,EAAMzmC,GAAQ,EAAI+oC,EAAI5S,EAAY,SAAUlkC,EAAE,KAAK,EACnDu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GACrEu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GACrEu0C,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BqQ,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BsQ,EAAMzmC,GAAQ,EAAI+oC,EAAI5S,EAAY,SAAUlkC,EAAE,KAAK,EACnDu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GAC7Cu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GAC7Cu0C,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BqQ,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BsQ,EAAMzmC,CAAM,EAAI+oC,EAAI5S,EAAY,SAAUlkC,EAAE,KAAK,MAC9C,CAEH,IAAI+2C,EAAK/2C,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GAC/Bg3C,EAAKh3C,EAAE,GAAKkkC,EAAY,GAAKlkC,EAAE,GAEnCu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GACrBu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GACrBu0C,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BqQ,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BsQ,EAAMzmC,GAAQ,EAAI+oC,EAAI5S,EAAY,SAAUlkC,EAAE,KAAK,EACnDu0C,EAAOxmC,GAAQ,EAAIgpC,EACnBxC,EAAOxmC,GAAQ,EAAI/N,EAAE,GACrBu0C,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BqQ,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BsQ,EAAMzmC,GAAQ,EAAI+oC,EAAI5S,EAAY,SAAUlkC,EAAE,KAAK,EACnDu0C,EAAOxmC,GAAQ,EAAIgpC,EACnBxC,EAAOxmC,GAAQ,EAAIipC,EACnBzC,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BqQ,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BsQ,EAAMzmC,GAAQ,EAAI+oC,EAAI5S,EAAY,SAAUlkC,EAAE,KAAK,EACnDu0C,EAAOxmC,GAAQ,EAAI/N,EAAE,GACrBu0C,EAAOxmC,GAAQ,EAAIipC,EACnBzC,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BqQ,EAAOxmC,GAAQ,EAAIm2B,EAAY,KAC/BsQ,EAAMzmC,CAAM,EAAI+oC,EAAI5S,EAAY,SAAUlkC,EAAE,KAAK,CACpD,CACJ,CAED,wBAAwB6mC,EAAaG,EAAmB,CACpD,IAAIj5B,EAAU84B,EAAY,mBAAmB,OAAS,GAAM,EACxD0N,EAAS1N,EAAY,MAAM,OAC3B2N,EAAQ3N,EAAY,MAAM,MAC9B,OAAS0N,EAAOxmC,CAAM,IAAM,GACvBwmC,EAAOxmC,EAAS,CAAC,IAAM,GACvBwmC,EAAOxmC,EAAS,CAAC,IAAM,GACvBwmC,EAAOxmC,EAAS,CAAC,IAAM,GACvBymC,EAAMzmC,EAAS,CAAC,IAAM,YACtBwmC,EAAOxmC,EAAS,CAAC,IAAMi5B,EAAkB,GACzCuN,EAAOxmC,EAAS,CAAC,IAAM,GACvBwmC,EAAOxmC,EAAS,CAAC,IAAM,GACvBwmC,EAAOxmC,EAAS,CAAC,IAAM,GACvBymC,EAAMzmC,EAAS,CAAC,IAAM,YACtBwmC,EAAOxmC,EAAS,EAAE,IAAMi5B,EAAkB,GAC1CuN,EAAOxmC,EAAS,EAAE,IAAMi5B,EAAkB,GAC1CuN,EAAOxmC,EAAS,EAAE,IAAM,GACxBwmC,EAAOxmC,EAAS,EAAE,IAAM,GACxBymC,EAAMzmC,EAAS,EAAE,IAAM,YACvBwmC,EAAOxmC,EAAS,EAAE,IAAM,GACxBwmC,EAAOxmC,EAAS,EAAE,IAAMi5B,EAAkB,GAC1CuN,EAAOxmC,EAAS,EAAE,IAAM,GACxBwmC,EAAOxmC,EAAS,EAAE,IAAM,GACxBymC,EAAMzmC,EAAS,EAAE,IAAM,UAC/B,CAED,kBAAkB84B,EAAa,CAE3B,IAAI94B,EAAS84B,EAAY,OAAS,GAClC,QAAS,EAAI,EAAGt4C,EAAIs4C,EAAY,eAAe,OAAQ,EAAIt4C,EAAG,IAAK,CAC/Ds4C,EAAY,eAAe,CAAC,EAAE,2BAA6B94B,EAC3D,IAAIkpC,EAAQpQ,EAAY,eAAe,CAAC,EAAE,OAAO,6BAA8B,EAAG,EAAIA,EAAY,eAAe,CAAC,EAAE,OACpH94B,GAAUkpC,EACNA,GACApQ,EAAY,eAAe,CAAC,EAAE,OAAO,wBAAwBA,EAAY,eAAe,CAAC,EAAGA,EAAY,KAAK,CAEpH,CACDA,EAAY,MAAM,WAAa94B,CAClC,CAED,kBAAkBmnC,EAAe9Q,EAAe/7C,EAAS,CACrD,MAAMiV,EAAK,KAAK,MAAM,GACtBA,EAAG,YAAYA,EAAG,WAAY8mC,CAAa,EAC3C9mC,EAAG,gBAAgBA,EAAG,YAAa43C,EAAc,WAAW,EAC5D,MAAM7oC,EAAY6oC,EAAc,UAChC53C,EAAG,kBACCA,EAAG,WACH,EACA+O,GAAahkB,EAAQ,IAAM,GAC3BgkB,GAAahkB,EAAQ,IAAM,GAC3BgkB,GAAahkB,EAAQ,GAAK,GAC1BgkB,GAAahkB,EAAQ,GAAK,GAC1BgkB,GAAahkB,EAAQ,GAAK6sD,EAAc,IACxC7oC,GAAahkB,EAAQ,GAAK6sD,EAAc,GAAG,CAClD,CAEL,CCzUe,MAAMgC,WAAwB9C,EAAa,CAEtD,YAAYd,EAAK,CACb,MAAMA,CAAG,EAET,KAAK,eAAiB,GACtB,KAAK,MAAQ,EAChB,CAED,iBAAiBjlD,EAAOhF,EAAG,CACvB,KAAK,eAAegF,CAAK,EAAIhF,CAChC,CAED,YAAYgF,EAAOhF,EAAG,CACdA,EACA,KAAK,MAAMgF,CAAK,GAAK,EAErB,KAAK,MAAMA,CAAK,GAAM,KAAK,MAAMA,CAAK,EAAI,CAEjD,CAED,SAASA,EAAOhF,EAAG,CACXA,EACA,KAAK,MAAMgF,CAAK,GAAK,EAErB,KAAK,MAAMA,CAAK,GAAM,KAAK,MAAMA,CAAK,EAAI,CAEjD,CAED,iBAAiBA,EAAO,CACpB,OAAO,KAAK,eAAeA,CAAK,CACnC,CAED,YAAYA,EAAO,CACf,OAAQ,KAAK,MAAMA,CAAK,EAAI,CAC/B,CAED,SAASA,EAAO,CACZ,OAAQ,KAAK,MAAMA,CAAK,EAAI,CAC/B,CAEL,CCzCe,MAAM8oD,WAA6B1C,EAAkB,CAEhE,iBAAiBpmD,EAAO,CACpB,OAAO,KAAK,MAAM,iBAAiB,KAAK,MAAQA,CAAK,CACxD,CAED,YAAYA,EAAO,CACf,OAAO,KAAK,MAAM,YAAY,KAAK,MAAQA,CAAK,CACnD,CAED,SAASA,EAAO,CACZ,OAAO,KAAK,MAAM,SAAS,KAAK,MAAQA,CAAK,CAChD,CAEL,CCZe,MAAM+oD,WAA8BtC,EAAmB,CAElE,MAAO,CACH,KAAK,mBAAqB,KAAK,IAAI,MAAM,UAAS,CACrD,CAED,qBAAqBG,EAAI,CACrB,IAAIj6C,EAASi6C,EAAG,OAEhB,GAAIA,EAAG,QAAUA,EAAG,OAAO,SAAQ,EAAI,CACnC,MAAM/jD,EAAS,KAAK,gBAAkB,KAAK,mBAC3C8J,EAAO,WAAWi6C,EAAI/jD,CAAM,EAC5B8J,EAAO,KAAKi6C,EAAI/jD,CAAM,EACtB8J,EAAO,UAAUi6C,EAAI/jD,CAAM,CAC9B,CACJ,CAED,qBAAsB,CAClB,MAAMoiD,EAAM,KAAK,cAEjB,IAAItiC,EAAa,CAAC,EAAG,EAAG,EAAG,CAAC,EACxB,KAAK,mBAAmB,MAAQsiC,IAChCtiC,EAAa,KAAK,IAAI,MAAM,cAAa,GAG7C,MAAMkkC,EAAgB5B,EAAI,OAC1BA,EAAI,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC7B,CAACtiC,EAAW,CAAC,GAAK,CAACA,EAAW,CAAC,GAAK,CAACA,EAAW,CAAC,GAAK,CAACA,EAAW,CAAC,EACnEsiC,EAAI,UAAU,EAAG,EAAG4B,EAAc,MAAOA,EAAc,MAAM,GAE7D5B,EAAI,UAAYjY,EAAW,uBAAuBrqB,CAAU,EAE5DsiC,EAAI,yBAA2B,OAC/BA,EAAI,UAAS,EACbA,EAAI,KAAK,EAAG,EAAG4B,EAAc,MAAOA,EAAc,MAAM,EACxD5B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,yBAA2B,cAEtC,CAED,aAAc,CACV,OAAI,KAAK,eACE,KAAK,eAAe,IAEpB,KAAK,mBAAmB,GAEtC,CAED,iBAAkB,CACd,MAAMA,EAAM,KAAK,cACjBA,EAAI,QAAO,EACXA,EAAI,KAAI,EACRA,EAAI,SAAW,IAClB,CAED,YAAY9M,EAAM,CACd,MAAM8M,EAAM,KAAK,cAEjB,GAAI,CAAC8D,GAAsB,mBAAmB9D,EAAI,OAAQA,EAAI,SAAU9M,CAAI,EAAG,CAG3E,KAAK,gBAAe,EAEpB,IAAIn6B,EAAY,KAAK,IAAI,MAAM,mBAAkB,EAC7Cm6B,IACA8M,EAAI,UAAS,EACbA,EAAI,KAAK,KAAK,MAAM9M,EAAK,CAAC,EAAIn6B,CAAS,EAAG,KAAK,MAAMm6B,EAAK,CAAC,EAAIn6B,CAAS,EAAG,KAAK,MAAMm6B,EAAK,CAAC,EAAIn6B,CAAS,EAAG,KAAK,MAAMm6B,EAAK,CAAC,EAAIn6B,CAAS,CAAC,EAC3IinC,EAAI,UAAS,EACbA,EAAI,KAAI,GAEZA,EAAI,SAAW9M,CAClB,CACJ,CAED,OAAO,mBAAmBryC,EAAQqyC,EAAM3+C,EAAS,CAC7C,OAAK2+C,IACDA,EAAO,CAAC,EAAG,EAAGryC,EAAO,MAAOA,EAAO,MAAM,GAExCtM,IACDA,EAAU,CAAC,EAAG,EAAGsM,EAAO,MAAOA,EAAO,MAAM,GAEzC+oC,EAAM,YAAYsJ,EAAM3+C,CAAO,CACzC,CAEL,CCvFe,MAAMwvD,WAAkBrP,EAAO,CAE1C,WAAWsN,EAAW,CACrB,CAED,KAAKA,EAAW,CACf,CAED,UAAUA,EAAW,CACpB,CAEL,CCVe,MAAM3yC,WAAsB00C,EAAU,CAEjD,YAAY/D,EAAK,CACb,MAAMA,CAAG,EACT,KAAK,kBAAoBA,EAAI,MAAM,iBAAiB,OAAO,cAC3D,KAAK,aAAe,KAAK,IAAI,MAAM,SAAS,WAC/C,CAED,KAAKgC,EAAWpkD,EAAQ,CACpB,MAAMoiD,EAAMpiD,EAAO,IACnB,IAAIL,EAASykD,EAAU,OACvB,QAASrxD,EAAI,EAAGA,EAAI4M,EAAQ5M,IAAK,CAC7B,MAAMsjD,EAAK+N,EAAU,WAAWrxD,CAAC,EAC3BqzD,EAAKhC,EAAU,eAAerxD,CAAC,EAC/BszD,EAAKjC,EAAU,iBAAiBrxD,CAAC,EACjCuzD,EAAQlC,EAAU,SAASrxD,CAAC,EAC5BwzD,EAAMnC,EAAU,YAAYrxD,CAAC,EAG7BooB,EAAY,KAAK,IAAI,MAAM,mBAAkB,EACnDinC,EAAI,aAAaiE,EAAG,GAAKlrC,EAAWkrC,EAAG,GAAKlrC,EAAWkrC,EAAG,GAAKlrC,EAAWkrC,EAAG,GAAKlrC,EAAWkrC,EAAG,GAAKlrC,EAAWkrC,EAAG,GAAKlrC,CAAS,EAEjI,MAAMqrC,EAAQnQ,IAAO,KAAK,kBACpBoQ,EAAO,CAAC,UAAArC,EAAW,OAAApkD,EAAQ,MAAOjN,EAAG,KAAAyzD,CAAI,EAE/C,GAAIA,EAEIF,EACAlE,EAAI,UAAY,QAEhB,KAAK,kBAAkBA,EAAKgE,CAAE,EAGlChE,EAAI,YAAciE,EAAG,MACrB,KAAK,cAAcI,CAAI,EACvBrE,EAAI,SAAS,EAAG,EAAGgE,EAAG,EAAGA,EAAG,CAAC,EAC7B,KAAK,aAAaK,CAAI,EACtBrE,EAAI,YAAc,MACf,CAIHA,EAAI,YAAciE,EAAG,MACrB,KAAK,cAAcI,CAAI,EAMvB,MAAMC,EAAUH,EAAM,EAAKH,EAAG,KAAO/P,EAAG,EAClCsQ,EAAUJ,EAAM,EAAKH,EAAG,KAAO/P,EAAG,EAClCuQ,GAAWL,EAAM,EAAKH,EAAG,KAAOA,EAAG,MAAS/P,EAAG,EAC/CwQ,GAAWN,EAAM,EAAKH,EAAG,KAAOA,EAAG,MAAS/P,EAAG,EAGrD,GADe,CAACiQ,EACF,CAOV,IAAItiD,EAAQoiD,EAAG,UACXA,EAAG,WAAaA,EAAG,UAAYA,EAAG,WAAaA,EAAG,UAAYA,EAAG,WAAaA,EAAG,YACjFpiD,EAAQmmC,EAAW,sBAAsB,CAACic,EAAG,SAAUA,EAAG,SAAUA,EAAG,SAAUA,EAAG,QAAQ,CAAC,GAGjG,MAAMrsC,GAAU/V,EAAQ,SAAY,GAAK,IACzCo+C,EAAI,aAAeroC,EAEnB,MAAM+sC,EAAM9iD,EAAQ,SACd+iD,EAAc,KAAK,aAAa,eAAe1Q,EAAIyQ,CAAG,EAG5D1E,EAAI,UAAY,QAChBA,EAAI,UAAU2E,EAAaL,EAASC,EAASC,EAASC,EAAS,EAAG,EAAGT,EAAG,EAAGA,EAAG,CAAC,CACnG,MACoBhE,EAAI,UAAY,QAChBA,EAAI,UAAU/L,EAAIqQ,EAASC,EAASC,EAASC,EAAS,EAAG,EAAGT,EAAG,EAAGA,EAAG,CAAC,EAE1E,KAAK,aAAaK,CAAI,EACtBrE,EAAI,YAAc,CACrB,CACJ,CACJ,CAED,kBAAkBA,EAAKgE,EAAI9qC,EAAI8qC,EAAG,EAAG7qC,EAAI6qC,EAAG,EAAGY,EAAe,GAAM,CAChE,IAAIhjD,EAAQoiD,EAAG,SACXa,EAIAb,EAAG,WAAaA,EAAG,SACfA,EAAG,WAAaA,EAAG,WACfA,EAAG,WAAaA,EAAG,UAInBa,EAAW7E,EAAI,qBAAqB,EAAG,EAAG,EAAG7mC,CAAC,EAC1CyrC,GACAC,EAAS,aAAa,EAAG9c,EAAW,cAAcic,EAAG,QAAQ,CAAC,EAC9Da,EAAS,aAAa,EAAG9c,EAAW,cAAcic,EAAG,QAAQ,CAAC,IAE9Da,EAAS,aAAa,EAAG9c,EAAW,aAAaic,EAAG,QAAQ,CAAC,EAC7Da,EAAS,aAAa,EAAG9c,EAAW,aAAaic,EAAG,QAAQ,CAAC,KAQrEA,EAAG,WAAaA,EAAG,UAAYA,EAAG,WAAaA,EAAG,WAElDa,EAAW7E,EAAI,qBAAqB,EAAG,EAAG9mC,EAAG,CAAC,EAC1C0rC,GACAC,EAAS,aAAa,EAAG9c,EAAW,cAAcic,EAAG,QAAQ,CAAC,EAC9Da,EAAS,aAAa,EAAG9c,EAAW,cAAcic,EAAG,QAAQ,CAAC,IAE9Da,EAAS,aAAa,EAAG9c,EAAW,aAAaic,EAAG,QAAQ,CAAC,EAC7Da,EAAS,aAAa,EAAG9c,EAAW,aAAaic,EAAG,QAAQ,CAAC,IAKrEa,EACA7E,EAAI,UAAY6E,EAEhB7E,EAAI,UAAY4E,EAAe7c,EAAW,cAAcnmC,CAAK,EAAImmC,EAAW,aAAanmC,CAAK,CAErG,CAED,cAAcyiD,EAAM,CACnB,CAED,aAAaA,EAAM,CAClB,CAEL,CC7Ie,MAAMS,EAAsB,CAEvC,YAAYx9C,EAAO,CACf,KAAK,MAAQA,EACb,KAAK,YAAc,EACnB,KAAK,sBAAwB,IAAI,GACpC,CAED,SAAU,CACN,KAAK,GAAG,EAAI,EAEZ,KAAK,MAAQ,KACb,OAAO,KAAK,KACf,CAED,gBAAgBU,EAAO,CACnB,KAAK,aAAeA,EAEpB,KAAK,MAAM,eAAeA,CAAK,CAClC,CAED,OAAO8oC,EAAe,CAElB,GAAI,KAAK,UAAUA,CAAa,EAAG,CAC/B,MAAM7Q,EAAQ,KAAK,UAAU6Q,CAAa,EACpCiU,EAAe9kB,EAAM,YAC3BA,EAAM,MAAK,EACX,KAAK,sBAAsB,OAAO6Q,CAAa,EAC/C,KAAK,gBAAgB7Q,EAAM,YAAc8kB,CAAY,CACxD,CACJ,CAED,eAAejU,EAAelvC,EAAO,CACjC,MAAMojD,EAAQ,KAAK,MAAM,aAEzB,KAAK,sBAAsB,IAAIlU,CAAa,EAE5C,MAAM7Q,EAAQ,KAAK,UAAU6Q,CAAa,EAEpCp0C,EAAOujC,EAAM,IAAIr+B,CAAK,EAG5B,GAFAlF,EAAK,GAAKsoD,EAENtoD,EAAK,GACL,OAAIo0C,EAAc,OAASp0C,EAAK,GAE5B,KAAK,aAAaA,EAAK,GAAIo0C,EAAelvC,CAAK,EAG5ClF,EAAK,GACT,CACH,MAAMuoD,EAAShlB,EAAM,YAGrB,IAAIriC,EAASqiC,EAAM,aAAa+kB,CAAK,EACjCpnD,EACAA,EAAO,IAAI,UAAU,EAAG,EAAGA,EAAO,MAAOA,EAAO,MAAM,GAGtDA,EAAS,SAAS,cAAc,QAAQ,EACxCA,EAAO,MAAQkzC,EAAc,EAC7BlzC,EAAO,OAASkzC,EAAc,EAC9BlzC,EAAO,IAAMA,EAAO,WAAW,IAAI,GAGvC,KAAK,aAAaA,EAAQkzC,EAAelvC,CAAK,EAC9Cq+B,EAAM,IAAIr+B,EAAOhE,EAAQonD,CAAK,EAE9B,MAAMz+B,EAAQ0Z,EAAM,YAEpB,OAAI1Z,IAAU0+B,GACV,KAAK,gBAAgB1+B,EAAQ0+B,CAAM,EAGhCrnD,CACV,CACJ,CAED,aAAaA,EAAQxH,EAAQwL,EAAO,CAChC,IAAIsjD,EAAMtjD,EAAM,SAAS,EAAE,EAC3B,KAAOsjD,EAAI,OAAS,GAChBA,EAAM,IAAMA,EAEhBtnD,EAAO,IAAI,UAAY,IAAMsnD,EAC7BtnD,EAAO,IAAI,yBAA2B,OACtCA,EAAO,IAAI,SAAS,EAAG,EAAGxH,EAAO,EAAGA,EAAO,CAAC,EAC5CwH,EAAO,IAAI,yBAA2B,WACtCA,EAAO,IAAI,UAAUxH,EAAQ,EAAG,EAAGA,EAAO,EAAGA,EAAO,EAAG,EAAG,EAAGwH,EAAO,MAAOA,EAAO,MAAM,EAGxFA,EAAO,IAAI,yBAA2B,iBACtCA,EAAO,IAAI,UAAUxH,EAAQ,EAAG,EAAGA,EAAO,EAAGA,EAAO,EAAG,EAAG,EAAGwH,EAAO,MAAOA,EAAO,MAAM,CAC3F,CAED,UAAUkzC,EAAe,CACrB,MAAO,CAAC,CAACA,EAAc,UAC1B,CAED,UAAUA,EAAe,CACrB,OAAKA,EAAc,aACfA,EAAc,WAAa,IAAIqU,GAAarU,CAAa,GAEtDA,EAAc,UACxB,CAED,GAAGgS,EAAa,GAAO,CACnB,MAAMkC,EAAQ,KAAK,MAAM,aACzB,IAAIh9C,EAAQ,EACZ,KAAK,sBAAsB,QAAQnI,GAAW,CAC1C,MAAMogC,EAAQ,KAAK,UAAUpgC,CAAO,EACpC,GAAIijD,EACA96C,GAASi4B,EAAM,YACfA,EAAM,MAAK,MACR,CACH,MAAMglB,EAAShlB,EAAM,YACrBA,EAAM,QAAQ+kB,CAAK,EACnB/kB,EAAM,sBAAqB,EAC3Bj4B,GAAUi4B,EAAM,YAAcglB,CACjC,CACb,CAAS,EAEGnC,GACA,KAAK,sBAAsB,QAG3B96C,GACA,KAAK,gBAAgBA,CAAK,CAEjC,CAEL,CAEA,MAAMm9C,EAAa,CAEf,YAAYrU,EAAe,CACvB,KAAK,IAAMA,EACX,KAAK,QAAU,IAAI,IACnB,KAAK,gBAAkB,KACvB,KAAK,kBAAoB,EACzB,KAAK,aAAe,CACvB,CAED,IAAI,aAAc,CACd,OAAO,KAAK,aAAe,KAAK,IAAI,EAAI,KAAK,IAAI,CACpD,CAED,uBAAwB,CACpB,KAAK,cAAgB,KAAK,gBAAgB,OAC1C,KAAK,gBAAkB,EAC1B,CAED,OAAQ,CAEJ,KAAK,gBAAkB,KACvB,KAAK,QAAQ,QACb,KAAK,aAAe,CACvB,CAED,IAAIlvC,EAAO,CACP,IAAIlF,EAAO,KAAK,QAAQ,IAAIkF,CAAK,EACjC,OAAKlF,IACDA,EAAO,CAAC,GAAI,GAAI,GAAI,OAAW,EAAG,EAAE,EACpC,KAAK,QAAQ,IAAIkF,EAAOlF,CAAI,GAEzBA,CACV,CAED,IAAIkF,EAAO/B,EAASmlD,EAAO,CACvB,MAAMtoD,EAAO,KAAK,IAAIkF,CAAK,EAC3BlF,EAAK,GAAKsoD,EACVtoD,EAAK,GAAKmD,EACVnD,EAAK,EAAIsoD,EACT,KAAK,cACR,CAED,QAAQA,EAAO,CAEP,KAAK,oBAAsBA,IAG3B,KAAK,gBAAkB,GAEvB,KAAK,QAAQ,QAAQ,CAACtoD,EAAMkF,IAAU,CAE9BlF,EAAK,GAAKsoD,EAAQ,IACdtoD,EAAK,IAEL,KAAK,gBAAgB,KAAKA,EAAK,EAAE,EAErC,KAAK,QAAQ,OAAOkF,CAAK,EAE7C,CAAa,EAED,KAAK,kBAAoBojD,EAEhC,CAED,aAAaA,EAAO,CAGhB,GADA,KAAK,QAAQA,CAAK,EACd,KAAK,iBAAmB,KAAK,gBAAgB,OAC7C,YAAK,eACE,KAAK,gBAAgB,KAEnC,CAEL,CCpMe,MAAMI,WAAoBvC,EAAS,CAE9C,YAAYv7C,EAAO,CACf,MAAMA,CAAK,EAEX,KAAK,YAAc,IAAI+9C,GAAmB/9C,CAAK,EAE/C,KAAK,SAAS,KAAK,MAAM,IAAI,MAAM,CACtC,CAED,SAAU,CACN,KAAK,YAAY,UAEjB,KAAK,YAAc,KACnB,OAAO,KAAK,WACf,CAED,qBAAqB04C,EAAK,CACtB,OAAO,IAAI3wC,GAAc2wC,CAAG,CAC/B,CAED,oBAAqB,CACjB,OAAO+D,EACV,CAED,sBAAsB9/C,EAAY,CAC9B,OAAOA,EAAW,QAAUA,EAAW,OAAM,CAChD,CAED,mBAAmB+7C,EAAK,CACpB,OAAO,IAAI4D,GAAgB5D,CAAG,CACjC,CAED,wBAAwBA,EAAKt4C,EAAQ05C,EAAa1N,EAAmB2N,EAAStmD,EAAO,CACjF,OAAO,IAAI8oD,GAAqB7D,EAAKt4C,EAAQ05C,EAAa1N,EAAmB2N,EAAStmD,CAAK,CAC9F,CAED,yBAAyBilD,EAAK,CAC1B,OAAO,IAAI8D,GAAsB9D,CAAG,CACvC,CAED,sBAAsBA,EAAK,CACvB,OAAO,IAAIkC,GAAgBlC,CAAG,CACjC,CAED,oBAAoB9mC,EAAGC,EAAGq5B,EAAI0Q,EAAI,CAC9B,MAAMriD,EAAS,SAAS,cAAc,QAAQ,EAC9C,OAAAA,EAAO,MAAQ2xC,EACf3xC,EAAO,OAASqiD,EAChB,KAAK,SAASriD,CAAM,EACbA,CACV,CAED,kBAAkBiwC,EAAe,CAC7B,KAAK,YAAY,OAAOA,CAAa,CACxC,CAED,GAAGgS,EAAY,CACX,KAAK,YAAY,GAAGA,CAAU,CACjC,CAED,oBAAoBhyC,EAAe/b,EAAS,CAExC,GAAIA,EAAQ,OAAO,OAAQ,CAEvB,MAAM8L,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQ9L,EAAQ,EACvB8L,EAAO,OAAS9L,EAAQ,EAExB,MAAMuwD,EAAY,IAAI,UAAU,IAAI,kBAAkBvwD,EAAQ,OAAO,MAAM,EAAGA,EAAQ,EAAGA,EAAQ,CAAC,EAClG,OAAA8L,EAAO,WAAW,IAAI,EAAE,aAAaykD,EAAW,EAAG,CAAC,EAC7CzkD,CACV,CAED,OAAO9L,EAAQ,MAClB,CAED,kBAAkB+b,EAAe,CAC7B,KAAK,YAAY,OAAOA,EAAc,aAAa,CACtD,CAED,QAAQyiC,EAAagQ,EAAOxoD,EAAO,CAE/B,MAAM61C,EAAc2S,EAAM,aAAaxoD,CAAK,EAC5CwoD,EAAM,iBAAiBxoD,EAAO61C,EAAY,cAAc,EACxD2S,EAAM,SAASxoD,EAAO61C,EAAY,QAAS,GAC3C2S,EAAM,YAAYxoD,EAAO61C,EAAY,mBAAoB,EAC5D,CAED,wBAAwB2C,EAAaG,EAAmB,CAEpD,MAAO,EACV,CAED,kBAAkBH,EAAa,CAC9B,CAED,SAAS1yC,EAAQ,CACb,MAAMm/C,EAAMn/C,EAAO,WAAW,IAAI,EAClCA,EAAO,IAAMm/C,EAEbA,EAAI,SAAW,KAGfn/C,EAAO,IAAI,MACd,CAEL,CClHe,MAAM0kD,WAAoB5C,EAAY,CAEjD,eAAgB,CAEZ,IAAI34C,EAAK,KAAK,GACdA,EAAG,oBAAoB,KAAK,QAAQ,iBAAiB,EAAG,EAAGA,EAAG,MAAO,GAAO,GAAI,CAAC,EACjFA,EAAG,wBAAwB,KAAK,QAAQ,iBAAiB,CAAC,EAEtD,KAAK,QAAQ,eAAe,IAAM,KAClCA,EAAG,oBAAoB,KAAK,QAAQ,eAAe,EAAG,EAAGA,EAAG,MAAO,GAAO,GAAI,EAAI,CAAC,EACnFA,EAAG,wBAAwB,KAAK,QAAQ,eAAe,CAAC,GAGxD,KAAK,QAAQ,QAAQ,IAAM,KAE3BA,EAAG,oBAAoB,KAAK,QAAQ,QAAQ,EAAG,EAAGA,EAAG,cAAe,GAAM,GAAI,EAAI,CAAC,EACnFA,EAAG,wBAAwB,KAAK,QAAQ,QAAQ,CAAC,EAExD,CAED,gBAAiB,CAEb,IAAIA,EAAK,KAAK,GACdA,EAAG,yBAAyB,KAAK,QAAQ,iBAAiB,CAAC,EAEvD,KAAK,QAAQ,eAAe,IAAM,IAClCA,EAAG,yBAAyB,KAAK,QAAQ,eAAe,CAAC,EAGzD,KAAK,QAAQ,QAAQ,IAAM,IAC3BA,EAAG,yBAAyB,KAAK,QAAQ,QAAQ,CAAC,CAEzD,CAED,cAAcg4C,EAAW,CACrB,KAAK,YAAY,aAAc,KAAK,eAAeA,CAAS,EAAG,KAAK,GAAG,WAAY,EAAK,CAC3F,CAED,KAAKA,EAAW,CACZ,IAAIh4C,EAAK,KAAK,GAEVzM,EAASykD,EAAU,OAEvB,GAAIzkD,EAAQ,CACR,IAAIqlD,EAAYZ,EAAU,WAAW,CAAC,EAClClyD,EAAM,EACV,QAASa,EAAI,EAAGA,EAAI4M,EAAQ5M,IAAK,CAC7B,IAAIsjD,EAAK+N,EAAU,WAAWrxD,CAAC,EAC/B,GAAIiyD,IAAc3O,EAAI,CAClB,GAAI2O,EAAU,SAAWA,EAAU,QAAQ,SAAU,CACjD,IAAI4C,EAAkB70D,EAAI,EAAMA,EAAI,EAAKA,EACzC,MAAMooB,EAAY,KAAK,IAAI,MAAM,UAAU,WAAW,EACtD,IAAIirC,EAAKhC,EAAU,eAAewD,CAAc,EAChD,KAAK,IAAI,MAAM,SAAS,MAAMx7C,EAAI44C,EAAU,QAAQ,SAAUoB,EAAG,cAAc,GAAGjrC,EAAWirC,EAAG,cAAc,GAAGjrC,EAAWirC,EAAG,SAAUA,CAAE,CACnK,MACwBh6C,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EACvC54C,EAAG,aAAaA,EAAG,UAAW,GAAKrZ,EAAIb,GAAMka,EAAG,gBAAiBla,EAAMkyD,EAAU,OAAS,EAAI,CAAC,EAEnGY,EAAY3O,EACZnkD,EAAMa,CACT,CACJ,CACD,GAAIb,EAAMyN,EACN,GAAIqlD,EAAU,SAAWA,EAAU,QAAQ,SAAU,CACjD,MAAM7pC,EAAY,KAAK,IAAI,MAAM,UAAU,WAAW,EACtD,IAAIirC,EAAKhC,EAAU,eAAelyD,CAAG,EACrC,KAAK,IAAI,MAAM,SAAS,MAAMka,EAAI44C,EAAU,QAAQ,SAAUoB,EAAG,cAAc,GAAGjrC,EAAWirC,EAAG,cAAc,GAAGjrC,EAAWirC,EAAG,SAAUA,CAAE,CAC/J,MACoBh6C,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EACvC54C,EAAG,aAAaA,EAAG,UAAW,GAAKzM,EAASzN,GAAMka,EAAG,gBAAiBla,EAAMkyD,EAAU,OAAS,EAAI,CAAC,CAG/G,CACJ,CAEL,CAEAuD,GAAY,mBAAqB,knBAsBjCA,GAAY,qBAAuB,yVClGpB,MAAME,WAAsBzC,EAAc,CAErD,YAAY17C,EAAO,CACf,MAAMA,CAAK,CACd,CAED,qBAAqB04C,EAAK,CACtB,OAAO,IAAIuF,GAAYvF,CAAG,CAC7B,CAED,yBAAyBA,EAAK,CAC1B,OAAO,aAAY,EACnB,IAAI0F,EAAM,MAAM,yBAAyB1F,CAAG,EAC5C,cAAO,WAAU,EACV0F,CACV,CACL,CCnBe,MAAMC,EAAY,CAE7B,YAAY5wD,EAAU,GAAI,CACtB,KAAK,OAAS,IAAI,IAClB,KAAK,IAAM,EAEX,KAAK,YAAW,CACnB,CAED,SAAU,CACF,KAAK,SACL,KAAK,QAAQ,YAGjB,KAAK,OAAS,KACd,KAAK,QAAU,KAEf,OAAO,KAAK,OACZ,OAAO,KAAK,OACf,CAED,aAAc,CACV,MAAMoyB,EAAO,IAAI,OAAAy+B,GAAa,SAAQ,EAAE,OAClC71C,EAAO,IAAI,KAAK,CAACoX,EAAK,QAAQ,gBAAiB,EAAE,CAAC,CAAC,EACnD0+B,GAAW,OAAO,IAAM,IAAM,WAAW,gBAAgB91C,EAAM,CACjE,KAAM,uCAClB,CAAS,EACD,KAAK,QAAU,IAAI,OAAO81C,CAAO,EAEjC,KAAK,QAAQ,YAAY,CAAC,KAAM,SAAU,OAAQ,CAAC,KAAM,OAAO,SAAS,KAAM,SAAU,OAAO,SAAS,QAAQ,CAAC,CAAC,EAEnH,KAAK,QAAQ,UAAaj2D,GAAM,CAC5B,GAAIA,EAAE,MAAQA,EAAE,KAAK,GAAI,CACrB,MAAM2J,EAAK3J,EAAE,KAAK,GACZ8M,EAAO,KAAK,OAAO,IAAInD,CAAE,EAC3BmD,IACI9M,EAAE,KAAK,MAAQ,OACf,KAAK,OAAO8M,EAAM9M,EAAE,KAAK,IAAI,EAE7B,KAAK,MAAM8M,EAAM9M,EAAE,KAAK,IAAI,EAGvC,CACJ,CACJ,CAED,OAAO2B,EAAK,CACR,MAAMgI,EAAK,EAAE,KAAK,IACZmD,EAAO,IAAIopD,GAAiB,KAAMvsD,EAAIhI,CAAG,EAC/C,YAAK,OAAO,IAAIgI,EAAImD,CAAI,EACxB,KAAK,QAAQ,YAAY,CAAC,KAAM,MAAO,GAAInD,EAAI,IAAKhI,CAAG,CAAC,EACjDmL,CACV,CAED,OAAOqpD,EAAO,CACV,KAAK,QAAQ,YAAY,CAAC,KAAM,SAAU,GAAIA,EAAM,EAAE,CAAC,EACvD,KAAK,OAAO,OAAOA,EAAM,EAAE,CAC9B,CAED,MAAMA,EAAO1B,EAAM,CACf0B,EAAM,MAAM1B,CAAI,EAChB,KAAK,OAAO,OAAO0B,EAAM,EAAE,CAC9B,CAED,OAAOA,EAAO1B,EAAM,CAChB0B,EAAM,KAAK1B,CAAI,EACf,KAAK,OAAO,OAAO0B,EAAM,EAAE,CAC9B,CAEL,CAEA,MAAMD,EAAiB,CAEnB,YAAY9gD,EAASzL,EAAIhI,EAAK,CAC1B,KAAK,SAAWyT,EAChB,KAAK,IAAMzL,EACX,KAAK,KAAOhI,EACZ,KAAK,SAAW,KAChB,KAAK,QAAU,IAClB,CAED,IAAI,IAAK,CACL,OAAO,KAAK,GACf,CAED,IAAI,KAAM,CACN,OAAO,KAAK,IACf,CAED,IAAI,QAAQ09C,EAAG,CACX,KAAK,SAAWA,CACnB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,CAClB,CAED,QAAS,CACL,KAAK,SAAS,OAAO,IAAI,CAC5B,CAED,KAAKoV,EAAM,CACH,KAAK,SACL,KAAK,QAAQA,CAAI,CAExB,CAED,MAAMA,EAAM,CACJ,KAAK,UACL,KAAK,SAASA,CAAI,CAEzB,CAEL,CAMA,MAAMuB,GAAe,UAAW,CAE5B,SAASI,GAAoB,CAEzB,KAAK,MAAQ,IAAI,IAEjB,IAAI5sD,EAAI,KACR,UAAY,SAASxJ,EAAG,CACpBwJ,EAAE,gBAAgBxJ,CAAC,CACtB,CAEJ,CAEDo2D,EAAkB,eAAiB,SAASh9B,EAAM,CAC9C,MAAO,sBAAsB,KAAKA,CAAI,GAAKA,EAAK,OAAO,EAAG,CAAC,GAAK,OACxE,EAEIg9B,EAAkB,UAAU,gBAAkB,SAAS,EAAG,CACtD,GAAI,EAAE,KAAK,OAAS,SAAU,CAC1B,KAAK,OAAS,EAAE,KAAK,OAErB,IAAI78B,EAAO,KAAK,OAAO,KAGnB88B,EAAc,SACfA,EAAY,KAAK98B,CAAI,IACpBA,EAAOA,EAAK,QAAQ,OAAO,EAAE,GAGjC,IAAIugB,EAAQvgB,EAAK,MAAM,GAAG,EAC1BugB,EAAM,IAAG,EACT,KAAK,cAAgBA,EAAM,KAAK,GAAG,EAAI,GAE1C,MAAU,EAAE,KAAK,OAAS,MACvB,KAAK,IAAI,EAAE,KAAK,GAAI,EAAE,KAAK,GAAG,EACvB,EAAE,KAAK,OAAS,UACvB,KAAK,OAAO,EAAE,KAAK,EAAE,CAEjC,EAEIsc,EAAkB,UAAU,IAAM,SAASzsD,EAAIhI,EAAK,CAE3Cy0D,EAAkB,eAAez0D,CAAG,IACrCA,EAAM,KAAK,cAAgBA,GAG3BA,EAAI,OAAO,EAAE,CAAC,IAAM,OAEpBA,EAAM,KAAK,OAAO,SAAWA,GAGjC,IAAImL,EAAO,IAAIwpD,EAAsB3sD,EAAIhI,CAAG,EACxC6H,EAAI,KACRsD,EAAK,SAAW,SAAS/D,EAAQ,CAC7BS,EAAE,OAAOsD,EAAM/D,CAAM,CACjC,EACQ+D,EAAK,QAAU,SAAS2nD,EAAM,CAC1BjrD,EAAE,MAAMsD,EAAM2nD,CAAI,CAC9B,EACQ,KAAK,MAAM,IAAI9qD,EAAImD,CAAI,EACvBA,EAAK,MAAK,CAClB,EAEIspD,EAAkB,UAAU,OAAS,SAASzsD,EAAI,CAC9C,IAAImD,EAAO,KAAK,MAAM,IAAInD,CAAE,EACxBmD,IACAA,EAAK,OAAM,EACX,KAAK,MAAM,OAAOnD,CAAE,EAE3B,EAEDysD,EAAkB,UAAU,OAAS,SAAStpD,EAAM,CAAC,YAAAypD,EAAa,gBAAAC,CAAe,EAAG,CAChF,YAAY,CACR,KAAM,OACN,GAAI1pD,EAAK,GACT,KAAM,CACF,YAAAypD,EACA,gBAAAC,CACH,CACb,EAAW,CAACD,CAAW,CAAC,EAChB,KAAK,MAAM,OAAOzpD,EAAK,EAAE,CACjC,EAEIspD,EAAkB,UAAU,MAAQ,SAAStpD,EAAM,CAAC,KAAArM,EAAM,QAAAm5B,CAAO,EAAG,CAChE,YAAY,CACR,KAAM,QACN,GAAI9sB,EAAK,GACT,KAAM,CACF,KAAArM,EACA,QAAAm5B,CACH,CACb,CAAS,EACD,KAAK,MAAM,OAAO9sB,EAAK,EAAE,CACjC,EAEIspD,EAAkB,aAAe,UAAW,CACxC,OAAQ,UAAU,UAAU,QAAQ,KAAK,IAAM,EACvD,EAEI,SAASE,EAAsB3sD,EAAIhI,EAAK,CAEpC,KAAK,SAAW,OAChB,KAAK,UAAY,OACjB,KAAK,IAAMgI,EACX,KAAK,KAAOhI,EACZ,KAAK,KAAO,OACZ,KAAK,UAAY,OACjB,KAAK,UAAY,EAEpB,CAED,OAAO,eAAe20D,EAAsB,UAAW,KAAM,CACzD,IAAK,UAAW,CACZ,OAAO,KAAK,GACf,CACT,CAAK,EAED,OAAO,eAAeA,EAAsB,UAAW,WAAY,CAC/D,IAAK,UAAW,CACZ,OAAO,KAAK,SACf,EACD,IAAK,SAASjX,EAAG,CACb,KAAK,UAAYA,CACpB,CACT,CAAK,EAED,OAAO,eAAeiX,EAAsB,UAAW,UAAW,CAC9D,IAAK,UAAW,CACZ,OAAO,KAAK,QACf,EACD,IAAK,SAASjX,EAAG,CACb,KAAK,SAAWA,CACnB,CACT,CAAK,EAEDiX,EAAsB,UAAU,MAAQ,UAAW,CAC/C,KAAK,KAAO,IAAI,eAChB,KAAK,KAAK,KAAK,MAAO,KAAK,KAAM,EAAI,EACrC,KAAK,KAAK,aAAe,OAEzB,IAAI9sD,EAAI,KACR,KAAK,KAAK,QAAU,SAASitD,EAAQ,CACjCjtD,EAAE,MAAM,CAAC,KAAM,aAAc,QAAS,kBAAkB,CAAC,CACrE,EAEQ,KAAK,KAAK,OAAS,SAASitD,EAAQ,CAChC,IAAIt2C,EAAO3W,EAAE,KAAK,SAClBA,EAAE,UAAY2W,EAAK,KAEnB3W,EAAE,mBAAmB2W,CAAI,CACrC,EAEQ,KAAK,KAAK,MAClB,EAEIm2C,EAAsB,UAAU,mBAAqB,SAASn2C,EAAM,CAChE,IAAI3W,EAAI,KACR,kBAAkB2W,EAAM,CAAC,iBAAkB,cAAe,qBAAsB,OAAQ,iBAAkB,MAAM,CAAC,EAAE,KAAK,SAASo2C,EAAa,CAC1I/sD,EAAE,OAAO,CACL,YAAA+sD,EACA,gBAAiB/sD,EAAE,iBAAkB,CACrD,CAAa,CACb,CAAS,EAAE,MAAM,SAASxJ,EAAG,CACjBwJ,EAAE,MAAM,CAAC,KAAM,QAAS,QAAS,0BAA0B,CAAC,CACxE,CAAS,CACT,EAEI8sD,EAAsB,UAAU,iBAAmB,UAAW,CAC1D,OAAIF,EAAkB,eAIX,GAEC,KAAK,UAAU,QAAQ,WAAW,IAAM,EAE5D,EAEIE,EAAsB,UAAU,OAAS,UAAW,CAC5C,KAAK,YACL,KAAK,MACL,KAAK,KAAK,QAEd,KAAK,UAAY,GACzB,EAEIA,EAAsB,UAAU,MAAQ,SAAS71D,EAAMm5B,EAAS,CACxD,CAAC,KAAK,WAAa,KAAK,UACxB,KAAK,SAAS,CAAC,KAAAn5B,EAAM,QAAAm5B,CAAO,CAAC,CAEzC,EAEI08B,EAAsB,UAAU,OAAS,SAAS7B,EAAM,CAChD,CAAC,KAAK,WAAa,KAAK,WACxB,KAAK,UAAUA,CAAI,CAE/B,EAEiB,IAAI2B,CACrB,ECxTe,MAAMM,EAAY,CAE7B,KAAKh/C,EAAO,CACR,KAAK,MAAQA,EACb,KAAK,SAAW,GAChB,KAAK,cAAgB,GAGrB,KAAK,aAAe,KACpB,KAAK,iBAAmB,EACxB,KAAK,eAAiB,GAElB,KAAK,MAAM,UAAU,gBAAgB,IACjC,CAAC,OAAO,mBAAqB,CAAC,OAAO,OACrC,QAAQ,KAAK,2GAA2G,EAExH,KAAK,aAAe,IAAIq+C,IAIhC,KAAK,iCAAgC,CACxC,CAED,SAAU,CACF,KAAK,cACL,KAAK,aAAa,UAGtB,cAAc,KAAK,YAAY,EAE/B,KAAK,kBAAiB,EACtB,KAAK,oBAAmB,EACxB,KAAK,oBAAmB,EACxB,KAAK,0BAAyB,EAC9B,KAAK,+BAA8B,EAEnC,KAAK,MAAQ,KACb,OAAO,KAAK,KACf,CAED,WAAY,CACR,KAAK,SAAW,GACX,KAAK,eACN,KAAK,KAAI,CAEhB,CAED,UAAW,CACP,KAAK,SAAW,EACnB,CAED,YAAa,CACT,GAAI,KAAK,iBAAmB,KAAK,eAAgB,CAC7C,KAAK,mBACL,MACH,CACI,KAAK,MAAM,IAAI,iBAAgB,EAWhC,KAAK,iBAAmB,GAVxB,KAAK,SAAQ,EACb,KAAK,aAAe,YAAY,IAAM,CAClC,KAAK,MAAM,cACX,KAAK,MAAM,YACP,KAAK,MAAM,IAAI,iBAAgB,IAC/B,cAAc,KAAK,YAAY,EAC/B,KAAK,UAAS,IAEnB,IAAO,EAAE,EAInB,CAED,MAAO,CACH,IAAIpQ,EAAO,KACPgR,EAAK,UAAY,CACjBhR,EAAK,cAAgB,GACjBA,EAAK,WACLA,EAAK,MAAM,cACPA,EAAK,MAAM,UAAU,oBAAoB,GACzCA,EAAK,WAAU,EAEnBA,EAAK,MAAM,cACX,sBAAsBgR,CAAE,EACxBhR,EAAK,cAAgB,GAE5B,EACD,sBAAsBgR,CAAE,CAC3B,CAED,0BAA0Bv8C,EAAI8G,EAAe1a,EAAQrB,EAAS,CAC1D,MAAMyxD,EAAQpwD,EAAO,IAAwCA,EAAO,QAAQ,CAAC,EAAlD,IAAI,SAASA,EAAO,QAAQ,CAAC,CAAC,EACzD4T,EAAG,qBACCA,EAAG,WACH,EACA5T,EAAO,iBACPA,EAAO,WACPA,EAAO,YACP,EACAowD,CACH,EACDx8C,EAAG,cAAcA,EAAG,WAAYA,EAAG,eAAgBA,EAAG,aAAa,EACnEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,eAAgBA,EAAG,aAAa,EACnEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,mBAAoBA,EAAG,MAAM,EAChEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,mBAAoBA,EAAG,MAAM,CACnE,CAED,gBAAgBA,EAAI8G,EAAe1a,EAAQrB,EAAS,CAChD,GAAIqB,aAAkB,WAAaA,aAAkB,kBAAoBA,aAAkB,kBAAqB,OAAO,aAAeA,aAAkB,YAEpJ4T,EAAG,WAAWA,EAAG,WAAY,EAAGjV,EAAQ,eAAgBA,EAAQ,OAAQA,EAAQ,KAAMqB,CAAM,UACrFA,aAAkB,mBACzB,GAAIwzC,EAAM,SAAW,KAAK,MAAM,UAAU,qBAAqB,EAE3D5/B,EAAG,WAAWA,EAAG,WAAY,EAAGjV,EAAQ,eAAgBA,EAAQ,OAAQA,EAAQ,KAAMqB,CAAM,UACrFA,EAAO,MAAQ,GAAKA,EAAO,OAAS,EAAG,CAG9C,MAAM4pD,EAAM5pD,EAAO,WAAW,IAAI,EAClC4T,EAAG,WAAWA,EAAG,WAAY,EAAGjV,EAAQ,eAAgBA,EAAQ,OAAQA,EAAQ,KAAMirD,EAAI,aAAa,EAAG,EAAG5pD,EAAO,MAAOA,EAAO,MAAM,CAAC,CAC5I,OAED4T,EAAG,WAAWA,EAAG,WAAY,EAAGjV,EAAQ,eAAgB+b,EAAc,EAAGA,EAAc,EAAG,EAAG/b,EAAQ,OAAQA,EAAQ,KAAMqB,CAAM,CAExI,CAMD,cAAck6C,EAAI/+C,EAAK,CACnB,IAAIgkD,EAAO,KACX,OAAO,UAAY,CACf,IAAIkR,EAAc,KAAK,SACnBD,EAAO,IAAI,SAASC,CAAW,EAG/BC,EAAmB,WACnBA,IAAsBF,EAAK,UAAU,CAAC,EAAIA,EAAK,UAAU,CAAC,EAAIA,EAAK,UAAU,CAAC,GAC9ElW,EAAG,2CAA4C/+C,CAAG,EAGtD,IAAIo1D,EAAgBH,EAAK,UAAU,EAAE,IAAM,SACvC92D,EAAO,CACP,OAAQ82D,EAAK,UAAU,GAAIG,CAAY,EACvC,WAAYH,EAAK,UAAU,GAAIG,CAAY,EAC3C,SAAUH,EAAK,UAAU,GAAIG,CAAY,EACzC,iBAAkBH,EAAK,UAAU,GAAIG,CAAY,EACjD,qBAAsBH,EAAK,UAAU,GAAIG,CAAY,EACrD,WAAYH,EAAK,UAAU,GAAIG,CAAY,EAC3C,YAAaH,EAAK,UAAU,GAAIG,CAAY,EAC5C,WAAYH,EAAK,UAAU,GAAIG,CAAY,EAC3C,sBAAuBH,EAAK,UAAU,GAAIG,CAAY,EACtD,cAAeH,EAAK,UAAU,GAAIG,CAAY,EAC9C,qBAAsBH,EAAK,UAAU,GAAIG,CAAY,EACrD,oBAAqBH,EAAK,UAAU,GAAIG,CAAY,EACpD,KAAM,CAAE,EACR,QAAS,CAAE,EACX,IAAI,OAAQ,CAAE,OAAO,KAAK,UAAY,EACtC,IAAI,QAAS,CAAE,OAAO,KAAK,WAAa,CACxD,EAEY,MAAMxrD,EAASwlB,GAAQ,CACnB,MAAMvpB,EAAI,GACV,QAASrB,KAAK4qB,EACVvpB,EAAE,KAAKupB,EAAI5qB,CAAC,CAAC,EAEjB,OAAOqB,CACV,EAEe,OAAO,OAAOm+C,EAAK,MAAM,SAAS,gCAAgC,EAC7E,OAAQ50B,GAAQA,GAAO,IAAI,EAC3B,IAAKA,GAAQxlB,EAAMwlB,CAAG,CAAC,EACvB,OAAO,CAAC3nB,EAAMzE,IAAYyE,EAAK,OAAOzE,CAAO,CAAC,EAEtC,SAAS7E,EAAK,gBAAgB,GACvC,QAAQ,KAAK,qDAAsD6B,EAAK7B,EAAK,iBAAkB6lD,EAAK,MAAM,SAAS,+BAAgC,GAGvJ,IAAI96B,EAAS,GAGbA,GAAU/qB,EAAK,oBAEf,QAASiB,EAAI,EAAGA,EAAIjB,EAAK,qBAAsBiB,IAAK,CAChD,IAAIi2D,EAAYJ,EAAK,UAAU/rC,CAAM,EACrCA,GAAU,EACV/qB,EAAK,QAAQ,KAAK82D,EAAK,OAAO,MAAM/rC,EAAQmsC,CAAS,CAAC,EACtDnsC,GAAUmsC,CACb,CAEDtW,EAAG,KAAM,CACL,OAAQ5gD,EACR,WAAY,CAAE,IAAK6B,EAAK,WAAY,EAAM,CAC1D,CAAa,CACJ,CACJ,CAED,cAAc++C,EAAI/+C,EAAK,CACnB,OAAO,UAAY,CASf,MAAMs1D,EAAc,KAAK,SACnBC,EAAS,IAAI,WAAWD,EAAa,EAAG,EAAe,EACvDE,EAAaD,EAAO,EAAW,EAAI,GACnCE,EAAY,IAAI,WAAWH,EAAaE,CAAU,EAExD,IAAIr3D,EAAO,CACP,iBAAkB,MAClB,WAAYo3D,EAAO,CAAQ,EAC3B,YAAaA,EAAO,CAAS,EAC7B,qBAAsBA,EAAO,EAAc,EAC3C,QAAS,CAAE,EACX,IAAK,GACL,IAAI,OAAQ,CAAE,OAAO,KAAK,UAAY,EACtC,IAAI,QAAS,CAAE,OAAO,KAAK,WAAa,CACxD,EAEY,IAAIrsC,EAAS,EACTvqB,EAAQR,EAAK,WACbS,EAAST,EAAK,YAElB,QAASiB,EAAI,EAAGA,EAAIjB,EAAK,qBAAsBiB,IAAK,CAChD,MAAM6qD,GAAUtrD,EAAQ,GAAM,IAAOC,EAAS,GAAM,GAAK,EACnDq2D,EAAO,IAAI,WAAWK,EAAaG,EAAU,WAAavsC,EAAQ+gC,CAAK,EAC7E9rD,EAAK,QAAQ,KAAK82D,CAAI,EACtB/rC,GAAU+gC,EACVtrD,EAAQA,GAAS,EACjBC,EAASA,GAAU,CACtB,CAEDmgD,EAAG,KAAM,CACL,OAAQ5gD,EACR,WAAY,CAAE,IAAK6B,EAAK,WAAY,EAAM,CAC1D,CAAa,CACJ,CACJ,CAED,eAAe,CAAE,IAAAA,EAAK,SAAAkkD,CAAQ,EAAInF,EAAI,CAClC,IAAI2W,EACAC,EAAS31D,EAAI,YAAa,EAAC,QAAQ,MAAM,GAAK,GAAMA,EAAI,OAAO,EAAG,EAAE,GAAK,wBACzE41D,EAAQ51D,EAAI,QAAQ,MAAM,GAAK,EAC/B61D,EAAQ71D,EAAI,QAAQ,MAAM,GAAK,EACnC,GAAI41D,GAASC,EAAO,CAChB,IAAIC,EAAU,IAAI,eAClBA,EAAQ,iBACJ,OAAQF,EAAQ,KAAK,cAAc7W,EAAI/+C,CAAG,EAAI,KAAK,cAAc++C,EAAI/+C,CAAG,CACxF,EACY81D,EAAQ,KAAK,MAAO91D,CAAG,EACvB81D,EAAQ,aAAe,cACvBA,EAAQ,KAAI,EACZJ,EAAW,UAAY,CACnBI,EAAQ,MAAK,CAChB,CACb,SAAmB,KAAK,aAAc,CAE1B,MAAMtB,EAAQ,KAAK,aAAa,OAAOx0D,CAAG,EAC1Cw0D,EAAM,QAAU,SAAUxuD,EAAK,CAC3B,OAAO+4C,EAAG,kBAAkB,CAC5C,EACYyV,EAAM,OAAS,SAAU,CAAE,YAAAI,EAAa,gBAAAC,CAAe,EAAI,CACvD9V,EAAG,KAAM,CACL,OAAQ6V,EACR,WAAY,CAAE,IAAK50D,EAAK,WAAY,EAAO,EAC3C,SAAU60D,EACV,iBAAkB,EACtC,CAAiB,CACjB,EACYa,EAAW,UAAY,CACnBlB,EAAM,OAAM,CACf,CACb,KAAe,CACH,IAAIA,EAAQ,IAAI,MAIVx0D,EAAI,OAAO,EAAG,CAAC,GAAK,SAAY,CAACq4C,EAAM,QAEzCmc,EAAM,YAAc,aAExBA,EAAM,QAAU,SAAUxuD,EAAK,CAE3B,GAAIwuD,EAAM,IACN,OAAOzV,EAAG,kBAAkB,CAEhD,EACYyV,EAAM,OAAS,UAAY,CACvBzV,EAAG,KAAM,CACL,OAAQyV,EACR,WAAY,CAAE,IAAKx0D,EAAK,WAAY,EAAO,EAC3C,SAAU21D,GAASzR,CACvC,CAAiB,CACjB,EACYsQ,EAAM,IAAMx0D,EAEZ01D,EAAW,UAAY,CACnBlB,EAAM,QAAU,KAChBA,EAAM,OAAS,KACfA,EAAM,gBAAgB,KAAK,CAC9B,CACJ,CAED,OAAOkB,CACV,CAED,mBAAmB/tC,EAAGC,EAAG,CACrB,IAAItY,EAAS,KAAK,MAAM,UAAU,QAAQ,GAAK,SAAS,cAAc,QAAQ,EAE1EqY,GAAKC,IACLtY,EAAO,MAAQqY,EACfrY,EAAO,OAASsY,GAGpB,IAAImuC,EAAO,CACP,MAAO,GACP,UAAW,GACX,mBAAoB,GACpB,QAAS,GACT,sBAAuB,EACnC,EAEYt9C,EAAKnJ,EAAO,WAAW,QAASymD,CAAI,GAAKzmD,EAAO,WAAW,qBAAsBymD,CAAI,GAAKzmD,EAAO,WAAW,SAAUymD,CAAI,EAE9H,GAAI,CAACt9C,EACD,MAAM,IAAI,MAAM,sCAAsC,EAG1D,OAAOA,CACV,CAED,oBAAoBkP,EAAGC,EAAG,CACtB,IAAItY,EAAS,KAAK,MAAM,UAAU,QAAQ,GAAK,SAAS,cAAc,QAAQ,EAE1EqY,GAAKC,IACLtY,EAAO,MAAQqY,EACfrY,EAAO,OAASsY,GAGpB,IAAIouC,EAAM1mD,EAAO,WAAW,IAAI,EAChC,GAAI,CAAC0mD,EACD,MAAM,IAAI,MAAM,0CAA0C,EAG9D,OAAOA,CACV,CAED,WAAY,CACR,OAAO,OAAO,YAAc,OAAO,YAAY,IAAK,EAAI,IAAI,OAAQ,SACvE,CAED,kBAAmB,CAEf,OAAO,SAAS,cAAc,QAAQ,CACzC,CAED,kCAAkC1mD,EAAQ,CACtC,IAAI9L,EAAU,GACd,OAAAA,EAAQ,OAAS8L,EACV9L,CACV,CAED,UAAUyyD,EAAS,CAElB,CAED,uBAAuBC,EAAY,CAC/B,KAAK,iBAAoB,GAAM,CAC3BA,EAAW,CAAC,CACxB,EACQ,OAAO,iBAAiB,UAAW,KAAK,gBAAgB,CAC3D,CAED,qBAAqBA,EAAY,CAC7B,KAAK,eAAkB,GAAM,CACzBA,EAAW,CAAC,CACxB,EACQ,OAAO,iBAAiB,QAAS,KAAK,cAAc,CACvD,CAED,mBAAoB,CACZ,KAAK,kBACL,OAAO,oBAAoB,UAAW,KAAK,gBAAgB,EAG3D,KAAK,gBACL,OAAO,oBAAoB,QAAS,KAAK,cAAc,CAE9D,CAED,qBAAqBC,EAAc,CAC/B,KAAK,eAAiB,GAAK,CACvBA,EAAa,CAAC,CAC1B,EACQ,OAAO,iBAAiB,YAAa,KAAK,cAAc,CAC3D,CAED,qBAAsB,CACd,KAAK,gBACL,OAAO,oBAAoB,YAAa,KAAK,cAAc,CAElE,CAED,qBAAqBC,EAAc,CAC/B,KAAK,eAAiB,GAAK,CACvBA,EAAa,CAAC,CAC1B,EACQ,OAAO,iBAAiB,YAAa,KAAK,cAAc,CAC3D,CAED,qBAAsB,CACd,KAAK,gBACL,OAAO,oBAAoB,YAAa,KAAK,cAAc,CAElE,CAED,2BAA2BC,EAA4B,CACnD,KAAK,qBAAuB,GAAK,CAC7BA,EAA2B,CAAC,CAC/B,EACD,OAAO,iBAAiB,QAAS,KAAK,oBAAoB,CAC7D,CAED,2BAA4B,CACpB,KAAK,sBACL,OAAO,oBAAoB,QAAS,KAAK,oBAAoB,CAEpE,CAKD,kCAAmC,CAC/B,KAAK,yBAA2B,IAAM,CAC9B,SAAS,kBAAoB,YAC7B,KAAK,MAAM,KAAK,KAAK,oBAAoB,CAAC,EAC1C,KAAK,MAAM,cAElB,EACD,SAAS,iBAAiB,mBAAoB,KAAK,wBAAwB,CAC9E,CAED,gCAAiC,CACzB,KAAK,0BACL,SAAS,oBAAoB,mBAAoB,KAAK,wBAAwB,CAErF,CACL,CCtce,MAAMC,EAAe,CAChC,OAAO,KAAK9yD,EAAS,CACjB,OAAIA,EAAQ,SACDA,EAAQ,SAERuxD,EAEd,CACL,CCVA,MAAM1c,EAAM,CAER,OAAO,WAAW90C,EAAO,CACrB,OAAO,OAAOA,GAAU,UAC3B,CAED,OAAO,SAASA,EAAO,CACnB,OAAO,OAAOA,GAAU,QAC3B,CAED,OAAO,UAAUA,EAAO,CACpB,OAAQ,OAAOA,GAAU,UAAaA,EAAQ,IAAO,CACxD,CAED,OAAO,UAAUA,EAAO,CACpB,OAAOA,IAAU,IAAQA,IAAU,EACtC,CAED,OAAO,SAASA,EAAO,CACnB,OAAO,OAAOA,GAAS,QAC1B,CAED,OAAO,SAASA,EAAO,CACnB,IAAIzE,EAAO,OAAOyE,EAClB,MAAO,CAAC,CAACA,IAAUzE,GAAQ,UAAYA,GAAQ,WAClD,CAED,OAAO,cAAcyE,EAAO,CAExB,MAAO,CAAC,CAACA,GADE,OAAOA,GACS,QAC9B,CAED,OAAO,gBAAgBA,EAAM,CACzB,OAAO,OAAOA,GAAU,UAAYA,GAASA,EAAM,cAAgB,MACtE,CAED,OAAO,cAAciG,EAAOivC,EAAK,CAC7B,OAAOJ,GAAM,eAAe7uC,EAAOivC,EAAI,MAAM,CAChD,CAED,OAAO,YAAYhC,EAAIC,EAAI,CACvB,OAAK,OAAOD,GAAS,OAAOC,EAAY,GACpC2B,GAAM,gBAAgB5B,CAAE,EACjB4B,GAAM,gBAAgB3B,CAAE,GAAK2B,GAAM,oBAAoB5B,EAAIC,CAAE,EAC7D,MAAM,QAAQD,CAAE,EAChB,MAAM,QAAQC,CAAE,GAAK2B,GAAM,YAAY5B,EAAIC,CAAE,EAE7CD,IAAOC,CAErB,CAED,OAAO,oBAAoB6B,EAAMC,EAAM,CACnC,IAAIE,EAAQ,OAAO,KAAKH,CAAI,EACxBI,EAAQ,OAAO,KAAKH,CAAI,EAC5B,GAAIE,EAAM,SAAWC,EAAM,OACvB,MAAO,GAGX,QAASv5C,EAAI,EAAGsK,EAAIgvC,EAAM,OAAQt5C,EAAIsK,EAAGtK,IAAK,CAC1C,MAAMw5C,EAAKF,EAAMt5C,CAAC,EACZy5C,EAAKF,EAAMv5C,CAAC,EAClB,GAAIw5C,IAAOC,EACP,MAAO,GAGX,MAAMpC,EAAK8B,EAAKK,CAAE,EACZlC,EAAK8B,EAAKK,CAAE,EAElB,GAAI,CAACR,GAAM,YAAY5B,EAAIC,CAAE,EACzB,MAAO,EAEd,CAED,MAAO,EACV,CAED,OAAO,YAAYD,EAAIC,EAAI,CACvB,GAAID,EAAG,SAAWC,EAAG,OACjB,MAAO,GAEX,QAAS,EAAI,EAAGhtC,EAAI+sC,EAAG,OAAQ,EAAI/sC,EAAG,IAClC,GAAI,CAAC,KAAK,YAAY+sC,EAAG,CAAC,EAAGC,EAAG,CAAC,CAAC,EAC9B,MAAO,GAIf,MAAO,EACV,CAEL,CAKA,MAAM6f,EAAW,CAEb,YAAYvuD,EAAIyQ,EAAI,CAChB,KAAK,IAAMzQ,EACX,KAAK,IAAMyQ,EACX,KAAK,SAAW,OAChB,KAAK,SAAW,IAAI,IACpB,KAAK,cAAgB,IAAI,IACzB,KAAK,eAAiB,IAAI,IAG1B,KAAK,eAAiB,IAAI,MAAM,EAAE,EAClC,KAAK,iBAAmB,IAAI,IAC5B,KAAK,UAAY,IAAI,IACrB,KAAK,UAAY,IAAI,MAAM,CAAC,EAC5B,KAAK,YAAc,EACnB,KAAK,eAAiBA,EAAG,SACzB,KAAK,aAAe,IAAI,MAAM,CAAC,CAClC,CAED,gBAAgB+9C,EAAK,CACjB,OAAQA,IAAQ,KAAK,IAAI,MAC5B,CAED,QAAQA,EAAKhyD,EAAG,CACZ,MAAM42B,EAAM,KAAK,gBAAgBo7B,CAAG,EACpC,OAAIhyD,IAAM42B,EACC,KAAK,iBAAiB,OAAOo7B,CAAG,EAElC,KAAK,iBAAiB,IAAIA,CAAG,EAIvB,IAHP,KAAK,iBAAiB,IAAIA,CAAG,EACtB,GAKlB,CAED,UAAUnqD,EAAQwa,EAAQ,CACtB,MAAM4vC,EAAS,KAAK,SAAS,IAAIpqD,CAAM,IAAMwa,EAC7C,YAAK,SAAS,IAAIxa,EAAQwa,CAAM,EAE5B4vC,GAAWpqD,IAAW,KAAK,IAAI,eAE/B,KAAK,eAAiB,IAGnBoqD,CACV,CAED,eAAepqD,EAAQwa,EAAQ,CAC3B,MAAM4vC,EAAS,KAAK,cAAc,IAAIpqD,CAAM,IAAMwa,EAClD,YAAK,cAAc,IAAIxa,EAAQwa,CAAM,EAC9B4vC,CACV,CAED,gBAAgBpqD,EAAQwa,EAAQ,CAC5B,MAAM4vC,EAAS,KAAK,eAAe,IAAIpqD,CAAM,IAAMwa,EACnD,YAAK,eAAe,IAAIxa,EAAQwa,CAAM,EAC/B4vC,CACV,CAED,WAAWC,EAAS,CAChB,MAAMD,EAAS,KAAK,WAAaC,EACjC,YAAK,SAAWA,EACTD,CACV,CAED,WAAWvd,EAAM10C,EAAG,CAChB,MAAMf,EAAI,KAAK,UAAU,IAAIy1C,CAAI,EAC3Bud,EAAS,CAAChzD,GAAK,CAAC40C,GAAM,YAAY50C,EAAGe,CAAC,EAC5C,YAAK,UAAU,IAAI00C,EAAM10C,CAAC,EACnBiyD,CACV,CAED,yBAAyBjtD,EAAO,CAC5B,MAAMmtD,EAAK,KAAK,eAAentD,CAAK,EACpC,OAAImtD,GAAMA,EAAG,CAAC,GACVA,EAAG,CAAC,EAAI,GACD,IAEJ,EACV,CAED,wBAAwBntD,EAAO,CAC3B,MAAMmtD,EAAK,KAAK,eAAentD,CAAK,EACpC,GAAImtD,GACA,GAAI,CAACA,EAAG,CAAC,EACL,OAAAA,EAAG,CAAC,EAAI,GACD,OAGX,aAAK,eAAentD,CAAK,EAAI,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAI,EAC1C,GAEX,MAAO,EACV,CAED,oBAAoBA,EAAOI,EAAO,CAC9B,IAAI+sD,EAAK,KAAK,eAAentD,CAAK,EAC9B+0B,EAAQ,GASZ,OARIo4B,IACAp4B,EAAQo4B,EAAG,CAAC,IAAM/sD,EAAM,CAAC,GACrB+sD,EAAG,CAAC,IAAM/sD,EAAM,CAAC,GACjB+sD,EAAG,CAAC,IAAM/sD,EAAM,CAAC,GACjB+sD,EAAG,CAAC,IAAM/sD,EAAM,CAAC,GACjB+sD,EAAG,CAAC,IAAM/sD,EAAM,CAAC,GAGrB20B,EACO,IAEP30B,EAAM,CAAC,EAAI+sD,EAAKA,EAAG,CAAC,EAAI,GACjB,GAEd,CAED,iBAAiBroD,EAAS,CACtB,MAAMsoD,EAAU,KAAK,iBAAmBtoD,EACxC,YAAK,eAAiBA,EACfsoD,CACV,CAED,YAAYvqD,EAAQiC,EAAS,CACzB,MAAMuoD,EAAcN,GAAW,iBAAiB,KAAK,cAAc,EACnE,KAAK,YAAc,KAAK,IAAI,KAAK,YAAaM,EAAc,CAAC,EAC7D,MAAM7zD,EAAU,KAAK,UAAU6zD,CAAW,EACpCC,EAAcP,GAAW,uBAAuBlqD,CAAM,EAC5D,OAAIrJ,EACIA,EAAQ8zD,CAAW,IAAMxoD,EAClB,IAEXtL,EAAQ8zD,CAAW,EAAIxoD,EAChB,IAEHA,GACA,KAAK,UAAUuoD,CAAW,EAAI,GAC9B,KAAK,UAAUA,CAAW,EAAEC,CAAW,EAAIxoD,EACpC,IAEA,EAGlB,CAED,eAAeyoD,EAAOC,EAAO,CACzB,MAAM,EAAIT,GAAW,qBAAqBQ,CAAK,EACzCN,EAAS,CAACpe,GAAM,YAAY,KAAK,aAAa,CAAC,EAAG2e,CAAK,EAC7D,YAAK,aAAa,CAAC,EAAIA,EAChBP,CACV,CAED,QAAQhzD,EAAG,CACP,MAAMoE,EAAI,KAIV,KAAK,cAAcA,EAAGpE,CAAC,EAGnBA,EAAE,WAAaoE,EAAE,UACjB,KAAK,IAAI,YAAYpE,EAAE,QAAQ,EAGnC,KAAK,qBAAqBoE,EAAGpE,CAAC,EAC9B,KAAK,sBAAsBoE,EAAGpE,CAAC,EAE/B,MAAMwzD,EAAiB,KAAK,gBAAgBpvD,EAAGpE,CAAC,EAChD,KAAK,mBAAmBoE,EAAGpE,EAAGwzD,CAAc,EAE5C,KAAK,cAAcpvD,EAAGpE,CAAC,EAEvB,KAAK,iBAAiBoE,EAAGpE,CAAC,EAE1B,KAAK,oBAAoBoE,EAAGpE,CAAC,EAE7B,KAAK,iBAAiBoE,EAAGpE,CAAC,CAE7B,CAED,oBAAoB,EAAGA,EAAG,CACtB,QAAS,EAAI,EAAGiG,EAAI,EAAE,aAAa,OAAQ,EAAIA,EAAG,IAC9C,GAAI,EAAE,aAAa,CAAC,IAAMjG,EAAE,aAAa,CAAC,EAAG,CACzC,MAAMF,EAAQE,EAAE,aAAa,CAAC,IAAM,OAAYA,EAAE,aAAa,CAAC,EAAI8yD,GAAW,8BAA8B,CAAC,EAC9G,KAAK,IAAI,aAAaA,GAAW,uBAAuB,CAAC,EAAGhzD,CAAK,CACpE,CAER,CAED,iBAAiB,EAAGE,EAAG,CACnB,MAAMyzD,EAAM,KAAK,IAAI,EAAE,YAAazzD,EAAE,WAAW,EAEjD,IAAI0zD,EAAgB,EAAE,eAEtB,QAAS/3D,EAAI,EAAGA,EAAI83D,EAAK93D,IAAK,CAC1B,MAAMg4D,EAAW3zD,EAAE,UAAUrE,CAAC,EACxBi4D,EAAW,EAAE,UAAUj4D,CAAC,EACxBk4D,EAAcf,GAAW,mBAAmBn3D,CAAC,EAE7Cm4D,EAAY,KAAK,IAAIF,EAAWA,EAAS,OAAS,EAAGD,EAAWA,EAAS,OAAS,CAAC,EACzF,QAAS3sD,EAAI,EAAGf,EAAI6tD,EAAW9sD,EAAIf,EAAGe,IAAK,CACvC,MAAM4B,EAASkqD,GAAW,yBAAyB9rD,CAAC,EAChD0sD,IAAkBG,IAClB,KAAK,IAAI,eAAeA,CAAW,EACnCH,EAAgBG,GAGpB,MAAMhpD,EAAW8oD,GAAYA,EAAS3sD,CAAC,GAAM,KAC7C,KAAK,IAAI,aAAa4B,EAAQiC,CAAO,CACxC,CACJ,CAEG7K,EAAE,iBAAmB0zD,GACrB,KAAK,IAAI,eAAe1zD,EAAE,cAAc,CAE/C,CAED,gBAAgB,EAAGA,EAAG,CAClB,OAAAA,EAAE,SAAS,QAAQ,CAAC+zD,EAAanrD,IAAW,CACpC,EAAE,SAAS,IAAIA,CAAM,IAAMmrD,GAC3B,KAAK,IAAI,YAAYnrD,EAAQmrD,CAAW,CAExD,CAAS,EAED,EAAE,SAAS,QAAQ,CAAC3wC,EAAQxa,IAAW,CACzB5I,EAAE,SAAS,IAAI4I,CAAM,IACrB,QACN,KAAK,IAAI,YAAYA,EAAQ,IAAI,CAEjD,CAAS,EACO5I,EAAE,SAAS,IAAI,KAAK,IAAI,YAAY,IAAM,EAAE,SAAS,IAAI,KAAK,IAAI,YAAY,CACzF,CAED,qBAAqB,EAAGA,EAAG,CACvBA,EAAE,cAAc,QAAQ,CAAC+zD,EAAanrD,IAAW,CACzC,EAAE,cAAc,IAAIA,CAAM,IAAMmrD,GAChC,KAAK,IAAI,iBAAiBnrD,EAAQmrD,CAAW,CAE7D,CAAS,EAED,EAAE,cAAc,QAAQ,CAACA,EAAanrD,IAAW,CAClC5I,EAAE,cAAc,IAAI4I,CAAM,IAC1B,QACP,KAAK,IAAI,iBAAiBA,EAAQ,IAAI,CAEtD,CAAS,CACJ,CAED,sBAAsB,EAAG5I,EAAG,CACxBA,EAAE,eAAe,QAAQ,CAACg0D,EAAcprD,IAAW,CAC3C,EAAE,eAAe,IAAIA,CAAM,IAAMorD,GACjC,KAAK,IAAI,kBAAkBprD,EAAQorD,CAAY,CAE/D,CAAS,EAED,EAAE,eAAe,QAAQ,CAACA,EAAcprD,IAAW,CACpC5I,EAAE,eAAe,IAAI4I,CAAM,IAC3B,QACP,KAAK,IAAI,kBAAkBA,EAAQ,IAAI,CAEvD,CAAS,CACJ,CAED,mBAAmB,EAAG5I,EAAGwzD,EAAgB,CAEhCA,EAkBDxzD,EAAE,eAAe,QAAQ,CAACi0D,EAAQluD,IAAU,CACpCkuD,EAAO,CAAC,GAER,KAAK,IAAI,qBAAqBluD,EAAOkuD,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EAE1FA,EAAO,CAAC,GACR,KAAK,IAAI,yBAAyBluD,CAAK,CAE3D,CAAa,GAzBD,EAAE,eAAe,QAAQ,CAACkuD,EAAQluD,IAAU,CACnC/F,EAAE,eAAe+F,CAAK,GAEvB,KAAK,IAAI,0BAA0BA,CAAK,CAE5D,CAAa,EAED/F,EAAE,eAAe,QAAQ,CAACi0D,EAAQluD,IAAU,CACxC,KAAK,IAAI,qBAAqBA,EAAOkuD,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EAC3EA,EAAO,CAAC,EACR,KAAK,IAAI,yBAAyBluD,CAAK,EAEvC,KAAK,IAAI,0BAA0BA,CAAK,CAE5D,CAAa,EAaR,CAED,iBAAiB,EAAG/F,EAAG,CACnB,MAAMk0D,EAAW,KAAK,YAAY,mBAAkB,EACpD,EAAE,UAAU,QAAQ,CAACp0D,EAAO21C,IAAS,CACjC,MAAM/rC,EAAO+rC,EAAK,MAAQA,EAAK,MAC/B,GAAI,CAACz1C,EAAE,UAAU,IAAIy1C,CAAI,EAAG,CACxB,IAAIpqB,EAAO6oC,EAAS,IAAIxqD,CAAI,EACxBkrC,GAAM,WAAWvpB,CAAI,IACrBA,EAAOA,EAAK,KAAK,GAAG,GAGxBrrB,EAAE,UAAU,IAAIy1C,EAAMpqB,CAAI,EAC1BoqB,EAAK,MAAM,KAAK,IAAKpqB,CAAI,CAC5B,CACb,CAAS,EACDrrB,EAAE,UAAU,QAAQ,CAACF,EAAO21C,IAAS,CACjC,MAAM0e,EAAS,EAAE,UAAU,IAAI1e,CAAI,GAC/B,CAAC0e,GAAU,CAACvf,GAAM,YAAYuf,EAAQr0D,CAAK,IAC3C21C,EAAK,MAAM,KAAK,IAAK31C,CAAK,CAE1C,CAAS,CACJ,CAED,cAAc,EAAGE,EAAG,CAChB,EAAE,iBAAiB,QAAQo0D,GAAW,CAC7Bp0D,EAAE,iBAAiB,IAAIo0D,CAAO,IAC3B,KAAK,gBAAgBA,CAAO,EAC5B,KAAK,IAAI,QAAQA,CAAO,EAExB,KAAK,IAAI,SAASA,CAAO,EAG7C,CAAS,EACDp0D,EAAE,iBAAiB,QAAQo0D,GAAW,CAC7B,EAAE,iBAAiB,IAAIA,CAAO,IAC3B,KAAK,gBAAgBA,CAAO,EAC5B,KAAK,IAAI,SAASA,CAAO,EAEzB,KAAK,IAAI,QAAQA,CAAO,EAG5C,CAAS,CACJ,CAED,OAAO,oBAAqB,CACxB,GAAI,CAAC,KAAK,iBAAkB,CACxB,KAAK,iBAAmB,IAAI,IAC5B,MAAM9tD,EAAI,KAAK,iBACT4sC,EAAI,sBAAsB,UAChC5sC,EAAE,IAAI,WAAY,SAAS0O,EAAI,CAAC,MAAO,CAAC,EAAE,EAAEA,EAAG,OAAO,MAAOA,EAAG,OAAO,MAAM,CAAC,CAAC,EAC/E1O,EAAE,IAAI,UAAW,SAAS0O,EAAI,CAAC,MAAO,CAAC,EAAE,EAAEA,EAAG,OAAO,MAAOA,EAAG,OAAO,MAAM,CAAC,CAAC,EAC9E1O,EAAE,IAAI,aAAc,CAAC,EAAG,EAAG,EAAG,CAAC,CAAC,EAChCA,EAAE,IAAI,gBAAiB,CAAC4sC,EAAE,QAAQ,CAAC,EACnC5sC,EAAE,IAAI,wBAAyB,CAAC4sC,EAAE,SAAUA,EAAE,QAAQ,CAAC,EACvD5sC,EAAE,IAAI,YAAa,CAAC4sC,EAAE,IAAKA,EAAE,IAAI,CAAC,EAClC5sC,EAAE,IAAI,oBAAqB,CAAC4sC,EAAE,IAAKA,EAAE,KAAMA,EAAE,IAAKA,EAAE,IAAI,CAAC,EACzD5sC,EAAE,IAAI,aAAc,CAAC,EAAG,EAAG,EAAG,CAAC,CAAC,EAChCA,EAAE,IAAI,aAAc,CAAC,CAAC,CAAC,EACvBA,EAAE,IAAI,eAAgB,CAAC,CAAC,CAAC,EACzBA,EAAE,IAAI,YAAa,CAAC,GAAM,GAAM,GAAM,EAAI,CAAC,EAC3CA,EAAE,IAAI,WAAY,CAAC4sC,EAAE,IAAI,CAAC,EAC1B5sC,EAAE,IAAI,YAAa,CAAC4sC,EAAE,IAAI,CAAC,EAC3B5sC,EAAE,IAAI,YAAa,CAAC,EAAI,CAAC,EACzBA,EAAE,IAAI,aAAc,CAAC,EAAG,CAAC,CAAC,EAC1BA,EAAE,IAAI,YAAa,CAAC4sC,EAAE,GAAG,CAAC,EAC1B5sC,EAAE,IAAI,YAAa,CAAC,CAAC,CAAC,EACtBA,EAAE,IAAI,gBAAiB,CAAC,EAAG,CAAC,CAAC,EAC7BA,EAAE,IAAI,iBAAkB,CAAC,EAAG,EAAK,CAAC,EAClCA,EAAE,IAAI,cAAe,CAAC4sC,EAAE,OAAQ,EAAG,CAAC,CAAC,EACrC5sC,EAAE,IAAI,4BAA6B,CAAC4sC,EAAE,OAAQ,EAAG,CAAC,CAAC,EACnD5sC,EAAE,IAAI,2BAA4B,CAAC4sC,EAAE,OAAQ,EAAG,CAAC,CAAC,EAClD5sC,EAAE,IAAI,mCAAoC,CAAC4sC,EAAE,OAAQ,EAAG,CAAC,CAAC,EAC1D5sC,EAAE,IAAI,cAAe,CAAC,CAAC,CAAC,EACxBA,EAAE,IAAI,4BAA6B,CAAC,CAAC,CAAC,EACtCA,EAAE,IAAI,2BAA4B,CAAC,CAAC,CAAC,EACrCA,EAAE,IAAI,mCAAoC,CAAC,CAAC,CAAC,EAC7CA,EAAE,IAAI,YAAa,CAAC4sC,EAAE,KAAMA,EAAE,KAAMA,EAAE,IAAI,CAAC,EAC3C5sC,EAAE,IAAI,0BAA2B,CAAC4sC,EAAE,KAAMA,EAAE,KAAMA,EAAE,IAAI,CAAC,EACzD5sC,EAAE,IAAI,yBAA0B,CAAC4sC,EAAE,KAAMA,EAAE,KAAMA,EAAE,IAAI,CAAC,EACxD5sC,EAAE,IAAI,iCAAkC,CAAC4sC,EAAE,KAAMA,EAAE,KAAMA,EAAE,IAAI,CAAC,EAChE5sC,EAAE,IAAI,iBAAkB,EAAE,EAC1BA,EAAE,IAAI,kBAAmB,EAAE,EAC3BA,EAAE,IAAI,iBAAkB,EAAE,EAC1BA,EAAE,IAAI,kBAAmB,EAAE,EAC3BA,EAAE,IAAI,iBAAkB,EAAE,EAC1BA,EAAE,IAAI,kBAAmB,EAAE,EAC3BA,EAAE,IAAI,iBAAkB,EAAE,EAC1BA,EAAE,IAAI,kBAAmB,EAAE,CAC9B,CACD,OAAO,KAAK,gBACf,CAED,OAAO,uBAAuBsC,EAAQ,CAClC,OAAOA,EAAM,CACT,IAAK,MAED,MAAO,GACX,IAAK,OAED,MAAO,GACX,QAEI,MAAM,IAAI,MAAM,2BAA6BA,CAAM,CAC1D,CACJ,CAED,OAAO,yBAAyB7C,EAAO,CACnC,OAAK,KAAK,wBACN,KAAK,sBAAwB,CAAC,KAAQ,KAAM,GAEzC,KAAK,sBAAsBA,CAAK,CAC1C,CAED,OAAO,iBAAiBA,EAAO,CAC3B,OAAOA,EAAQ,KAClB,CAED,OAAO,mBAAmBA,EAAO,CAC7B,OAAOA,EAAQ,KAClB,CAED,OAAO,qBAAqButD,EAAO,CAC/B,OAAOA,EAAK,CACR,IAAK,MAED,MAAO,GACX,IAAK,MAED,MAAO,GACX,IAAK,OAED,MAAO,GACX,IAAK,OAED,MAAO,GACX,IAAK,OAED,MAAO,GAEX,IAAK,OAED,MAAO,GACX,QAEI,MAAM,IAAI,MAAM,wBAA0BA,CAAK,CACtD,CACJ,CAED,OAAO,uBAAuBvtD,EAAO,CACjC,OAAK,KAAK,sBACN,KAAK,oBAAsB,CAAC,KAAQ,KAAQ,MAAQ,MAAQ,KAAM,GAE/D,KAAK,oBAAoBA,CAAK,CACxC,CAED,OAAO,8BAA8BA,EAAO,CACxC,OAAK,KAAK,uBACN,KAAK,qBAAuB,CAAC,EAAG,EAAG,GAAO,GAAO,sBAAsB,UAAU,qBAAqB,GAEnG,KAAK,qBAAqBA,CAAK,CACzC,CACL,CAEA,MAAMsuD,EAAkB,CAEpB,kBAAkB9vD,EAAK,UAAW,CAC9B,KAAK,QAAU,GACf,KAAK,OAAS,KAAK,UAAUA,CAAE,CAClC,CAED,UAAUA,EAAI,CACV,OAAK,KAAK,QAAQA,CAAE,IAChB,KAAK,QAAQA,CAAE,EAAI,IAAIuuD,GAAWvuD,EAAI,IAAI,GAEvC,KAAK,QAAQA,CAAE,CACzB,CAED,YAAYA,EAAK,UAAW,CACxB,GAAI,KAAK,OAAO,MAAQA,EAAI,CACxB,MAAMikD,EAAW,KAAK,UAAUjkD,CAAE,EAClC,KAAK,OAAO,QAAQikD,CAAQ,EAC5B,KAAK,OAASA,CACjB,CACJ,CAED,YAAYyK,EAAS,CACb,KAAK,OAAO,WAAWA,CAAO,GAC9B,KAAK,YAAYA,CAAO,CAC/B,CAED,YAAYrqD,EAAQ0rD,EAAI,CAChB,KAAK,OAAO,UAAU1rD,EAAQ0rD,CAAE,GAChC,KAAK,YAAY1rD,EAAQ0rD,CAAE,CAClC,CAED,iBAAiB1rD,EAAQ0rD,EAAI,CACrB,KAAK,OAAO,eAAe1rD,EAAQ0rD,CAAE,GACrC,KAAK,iBAAiB1rD,EAAQ0rD,CAAE,CACvC,CAED,kBAAkB1rD,EAAQ0rD,EAAI,CACtB,KAAK,OAAO,gBAAgB1rD,EAAQ0rD,CAAE,GACtC,KAAK,kBAAkB1rD,EAAQ0rD,CAAE,CACxC,CAED,QAAQvB,EAAK,CACL,KAAK,OAAO,QAAQA,EAAK,EAAI,GAC7B,KAAK,QAAQA,CAAG,CACvB,CAED,SAASA,EAAK,CACN,KAAK,OAAO,QAAQA,EAAK,EAAK,GAC9B,KAAK,SAASA,CAAG,CACxB,CAED,UAAUrhD,EAAGC,EAAGuS,EAAGC,EAAG,CACd,KAAK,OAAO,WAAW,KAAK,UAAW,CAACzS,EAAGC,EAAGuS,EAAGC,CAAC,CAAC,GACnD,KAAK,UAAUzS,EAAGC,EAAGuS,EAAGC,CAAC,CAChC,CAED,SAASzS,EAAGC,EAAGuS,EAAGC,EAAG,CACb,KAAK,OAAO,WAAW,KAAK,SAAU,CAACzS,EAAGC,EAAGuS,EAAGC,CAAC,CAAC,GAClD,KAAK,SAASzS,EAAGC,EAAGuS,EAAGC,CAAC,CAC/B,CAED,0BAA0Bpe,EAAO,CACzB,KAAK,OAAO,yBAAyBA,CAAK,GAC1C,KAAK,0BAA0BA,CAAK,CAC3C,CAED,yBAAyBA,EAAO,CACxB,KAAK,OAAO,wBAAwBA,CAAK,GACzC,KAAK,yBAAyBA,CAAK,CAC1C,CAED,qBAAqBA,EAAOiV,EAAM3f,EAAM01B,EAAY9N,EAAQwC,EAAQ,CAC5D,KAAK,OAAO,oBAAoB1f,EAAO,CAACiV,EAAM3f,EAAM01B,EAAY9N,EAAQwC,CAAM,CAAC,GAC/E,KAAK,qBAAqB1f,EAAOiV,EAAM3f,EAAM01B,EAAY9N,EAAQwC,CAAM,CAC9E,CAED,eAAe5a,EAAS,CAChB,KAAK,OAAO,iBAAiBA,CAAO,GACpC,KAAK,eAAeA,CAAO,CAClC,CAED,aAAajC,EAAQiC,EAAS,CACtB,KAAK,OAAO,YAAYjC,EAAQiC,CAAO,GACvC,KAAK,aAAajC,EAAQiC,CAAO,CACxC,CAED,aAAayoD,EAAOC,EAAO,CACnB,KAAK,OAAO,eAAeD,EAAOC,CAAK,GACvC,KAAK,aAAaD,EAAOC,CAAK,CAErC,CAED,qBAAqBgB,EAAM9e,EAAMngC,EAAKk/C,EAAM,CACxC,IAAIva,EACJ,OAAOsa,EAAI,CACP,KAAK,KAAK,MACNta,EAAI,KAAK,0BACT,MACJ,KAAK,KAAK,KACNA,EAAI,KAAK,yBACT,MACJ,KAAK,KAAK,eACNA,EAAI,KAAK,iCACT,KACP,CAEG,KAAK,OAAO,WAAWA,EAAG,CAACxE,EAAMngC,EAAKk/C,CAAI,CAAC,GAC3Cva,EAAE,MAAM,KAAM,CAACxE,EAAMngC,EAAKk/C,CAAI,CAAC,CACtC,CAED,0BAA0B/e,EAAMngC,EAAKk/C,EAAM,CACvC,KAAK,qBAAqB,KAAK,MAAO/e,EAAMngC,EAAKk/C,CAAI,CACxD,CAED,yBAAyB/e,EAAMngC,EAAKk/C,EAAM,CACtC,KAAK,qBAAqB,KAAK,KAAM/e,EAAMngC,EAAKk/C,CAAI,CACvD,CAED,iCAAiC/e,EAAMngC,EAAKk/C,EAAM,CAC9C,KAAK,qBAAqB,KAAK,eAAgB/e,EAAMngC,EAAKk/C,CAAI,CACjE,CAED,qBAAqBD,EAAMC,EAAM,CAC7B,IAAIva,EACJ,OAAOsa,EAAI,CACP,KAAK,KAAK,MACNta,EAAI,KAAK,0BACT,MACJ,KAAK,KAAK,KACNA,EAAI,KAAK,yBACT,MACJ,KAAK,KAAK,eACNA,EAAI,KAAK,iCACT,KACP,CAEG,KAAK,OAAO,WAAWA,EAAG,CAACua,CAAI,CAAC,GAChCva,EAAE,MAAM,KAAM,CAACua,CAAI,CAAC,CAC3B,CAED,0BAA0BA,EAAM,CAC5B,KAAK,qBAAqB,KAAK,MAAOA,CAAI,CAC7C,CAED,yBAAyBA,EAAM,CAC3B,KAAK,qBAAqB,KAAK,KAAMA,CAAI,CAC5C,CAED,iCAAiCA,EAAM,CACnC,KAAK,qBAAqB,KAAK,eAAgBA,CAAI,CACtD,CAED,mBAAmBD,EAAME,EAAMC,EAAOC,EAAO,CACzC,IAAI1a,EACJ,OAAOsa,EAAI,CACP,KAAK,KAAK,MACNta,EAAI,KAAK,wBACT,MACJ,KAAK,KAAK,KACNA,EAAI,KAAK,uBACT,MACJ,KAAK,KAAK,eACNA,EAAI,KAAK,+BACT,KACP,CAEG,KAAK,OAAO,WAAWA,EAAG,CAACwa,EAAMC,EAAOC,CAAK,CAAC,GAC9C1a,EAAE,MAAM,KAAM,CAACwa,EAAMC,EAAOC,CAAK,CAAC,CACzC,CAED,wBAAwBF,EAAMC,EAAOC,EAAO,CACxC,KAAK,mBAAmB,KAAK,MAAOF,EAAMC,EAAOC,CAAK,CACzD,CAED,uBAAuBF,EAAMC,EAAOC,EAAO,CACvC,KAAK,mBAAmB,KAAK,KAAMF,EAAMC,EAAOC,CAAK,CACxD,CAED,+BAA+BF,EAAMC,EAAOC,EAAO,CAC/C,KAAK,mBAAmB,KAAK,eAAgBF,EAAMC,EAAOC,CAAK,CAClE,CAED,YAAYC,EAAKC,EAAOC,EAAMnyC,EAAO,CAC7B,KAAK,OAAO,WAAW,KAAK,YAAa,CAACiyC,EAAKC,EAAOC,EAAMnyC,CAAK,CAAC,GAClE,KAAK,YAAYiyC,EAAKC,EAAOC,EAAMnyC,CAAK,CAC/C,CAED,eAAegzB,EAAM,CACb,KAAK,OAAO,WAAW,KAAK,eAAgB,CAACA,CAAI,CAAC,GAClD,KAAK,eAAeA,CAAI,CAC/B,CAED,uBAAuBof,EAASC,EAAW,CACnC,KAAK,OAAO,WAAW,KAAK,uBAAwB,CAACD,EAASC,CAAS,CAAC,GACxE,KAAK,uBAAuBD,EAASC,CAAS,CACrD,CAED,WAAWC,EAASC,EAAS,CACrB,KAAK,OAAO,WAAW,KAAK,WAAY,CAACD,EAASC,CAAO,CAAC,GAC1D,KAAK,WAAWD,EAASC,CAAO,CACvC,CAED,mBAAmBC,EAAQC,EAAQC,EAAUC,EAAU,CAC/C,KAAK,OAAO,WAAW,KAAK,mBAAoB,CAACH,EAAQC,EAAQC,EAAUC,CAAQ,CAAC,GACpF,KAAK,mBAAmBH,EAAQC,EAAQC,EAAUC,CAAQ,CACjE,CAED,YAAYV,EAAKC,EAAOC,EAAMnyC,EAAO,CAC7B,KAAK,OAAO,WAAW,KAAK,YAAa,CAACiyC,EAAKC,EAAOC,EAAMnyC,CAAK,CAAC,GAClE,KAAK,YAAYiyC,EAAKC,EAAOC,EAAMnyC,CAAK,CAC/C,CAED,YAAYof,EAAO,CACX,KAAK,OAAO,WAAW,KAAK,YAAa,CAACA,CAAK,CAAC,GAChD,KAAK,YAAYA,CAAK,CAC7B,CAED,cAAc/hC,EAAG,CACT,KAAK,OAAO,WAAW,KAAK,cAAe,CAACA,CAAC,CAAC,GAC9C,KAAK,cAAcA,CAAC,CAC3B,CAED,WAAW40D,EAAKC,EAAOC,EAAMnyC,EAAO,CAC5B,KAAK,OAAO,WAAW,KAAK,WAAY,CAACiyC,EAAKC,EAAOC,EAAMnyC,CAAK,CAAC,GACjE,KAAK,WAAWiyC,EAAKC,EAAOC,EAAMnyC,CAAK,CAC9C,CAED,UAAUgzB,EAAM,CACR,KAAK,OAAO,WAAW,KAAK,UAAW,CAACA,CAAI,CAAC,GAC7C,KAAK,UAAUA,CAAI,CAC1B,CAED,WAAWF,EAAM,CACT,KAAK,OAAO,WAAW,KAAK,WAAY,CAACA,CAAI,CAAC,GAC9C,KAAK,WAAWA,CAAI,CAC3B,CAED,WAAW8f,EAAM,CACT,KAAK,OAAO,WAAW,KAAK,WAAY,CAACA,CAAI,CAAC,GAC9C,KAAK,WAAWA,CAAI,CAC3B,CAED,YAAYC,EAAOC,EAAM,CACjB,KAAK,OAAO,WAAW,KAAK,YAAa,CAACD,EAAOC,CAAI,CAAC,GACtD,KAAK,YAAYD,EAAOC,CAAI,CACnC,CAED,WAAW9f,EAAM,CACT,KAAK,OAAO,WAAW,KAAK,WAAY,CAACA,CAAI,CAAC,GAC9C,KAAK,WAAWA,CAAI,CAC3B,CAED,WAAWz6C,EAAO,CACV,KAAK,OAAO,WAAW,KAAK,WAAY,CAACA,CAAK,CAAC,GAC/C,KAAK,WAAWA,CAAK,CAC5B,CAED,eAAew6D,EAAQC,EAAO,CACtB,KAAK,OAAO,WAAW,KAAK,eAAgB,CAACD,EAAQC,CAAK,CAAC,GAC3D,KAAK,eAAeD,EAAQC,CAAK,CACxC,CAED,gBAAgB71D,EAAO81D,EAAQ,CACvB,KAAK,OAAO,WAAW,KAAK,gBAAiB,CAAC91D,EAAO81D,CAAM,CAAC,GAC5D,KAAK,gBAAgB91D,EAAO81D,CAAM,CACzC,CAED,aAAangB,EAAMngC,EAAKk/C,EAAM,CACtB,KAAK,OAAO,WAAW,KAAK,aAAc,CAAC/e,EAAMngC,EAAKk/C,CAAI,CAAC,GAC3D,KAAK,aAAa/e,EAAMngC,EAAKk/C,CAAI,CACxC,CAED,aAAaA,EAAM,CACX,KAAK,OAAO,WAAW,KAAK,aAAc,CAACA,CAAI,CAAC,GAChD,KAAK,aAAaA,CAAI,CAC7B,CAED,WAAWC,EAAMC,EAAOC,EAAO,CACvB,KAAK,OAAO,WAAW,KAAK,WAAY,CAACF,EAAMC,EAAOC,CAAK,CAAC,GAC5D,KAAK,WAAWF,EAAMC,EAAOC,CAAK,CACzC,CAED,gBAAgBkB,EAAMnkD,EAAG,CACjB,KAAK,OAAO,WAAW,KAAK,gBAAiB,CAACmkD,EAAMnkD,CAAC,CAAC,GACtD,KAAK,gBAAgBmkD,EAAMnkD,CAAC,CACnC,CAED,iBAAiBmkD,EAAMC,EAAQ,CACvB,KAAK,OAAO,WAAW,KAAK,iBAAkB,CAACD,EAAMC,CAAM,CAAC,GAC5D,KAAK,iBAAiBD,EAAMC,CAAM,CACzC,CAED,gBAAgBD,EAAMnkD,EAAGC,EAAG,CACpB,KAAK,OAAO,WAAW,KAAK,gBAAiB,CAACkkD,EAAMnkD,EAAGC,CAAC,CAAC,GACzD,KAAK,gBAAgBkkD,EAAMnkD,EAAGC,CAAC,CACtC,CAED,iBAAiBkkD,EAAMC,EAAQ,CACvB,KAAK,OAAO,WAAW,KAAK,iBAAkB,CAACD,EAAMC,CAAM,CAAC,GAC5D,KAAK,iBAAiBD,EAAMC,CAAM,CACzC,CAED,gBAAgBD,EAAMnkD,EAAGC,EAAG6B,EAAG,CACvB,KAAK,OAAO,WAAW,KAAK,gBAAiB,CAACqiD,EAAMnkD,EAAGC,EAAG6B,CAAC,CAAC,GAC5D,KAAK,gBAAgBqiD,EAAMnkD,EAAGC,EAAG6B,CAAC,CACzC,CAED,iBAAiBqiD,EAAMC,EAAQ,CACvB,KAAK,OAAO,WAAW,KAAK,iBAAkB,CAACD,EAAMC,CAAM,CAAC,GAC5D,KAAK,iBAAiBD,EAAMC,CAAM,CACzC,CAED,gBAAgBD,EAAMnkD,EAAGC,EAAG6B,EAAG0Q,EAAG,CAC1B,KAAK,OAAO,WAAW,KAAK,gBAAiB,CAAC2xC,EAAMnkD,EAAGC,EAAG6B,EAAG0Q,CAAC,CAAC,GAC/D,KAAK,gBAAgB2xC,EAAMnkD,EAAGC,EAAG6B,EAAG0Q,CAAC,CAC5C,CAED,iBAAiB2xC,EAAMC,EAAQ,CACvB,KAAK,OAAO,WAAW,KAAK,iBAAkB,CAACD,EAAMC,CAAM,CAAC,GAC5D,KAAK,iBAAiBD,EAAMC,CAAM,CACzC,CAOD,OAAO,OAAO9gD,EAAIzQ,EAAK,UAAW,CAC9B,MAAMixC,EAAQ,OAAO,oBAAoB6e,GAAkB,SAAS,EACjC,OAAAr/C,EAAG,UACtCwgC,EAAM,QAAQ9rC,GAAQ,CAClB,GAAIA,IAAS,cAAe,CACxB,MAAMqsD,EAAS1B,GAAkB,UAAU3qD,CAAI,EAC3CA,EAAK,OAAO,CAAC,IAAM,MACnBA,EAAOA,EAAK,OAAO,CAAC,GAEpBsL,EAAGtL,CAAI,IAAMqsD,IACT/gD,EAAGtL,CAAI,IACFsL,EAAGtL,CAAI,EAAE,OAEVsL,EAAGtL,CAAI,EAAE,MAAQA,GAErBsL,EAAG,IAAMtL,CAAI,EAAIsL,EAAGtL,CAAI,GAE5BsL,EAAGtL,CAAI,EAAIqsD,EAElB,CACb,CAAS,EAED1B,GAAkB,UAAU,kBAAkB,KAAKr/C,EAAIzQ,CAAE,EAElDyQ,CACV,CAEL,CAEA,MAAAghD,GAAe3B,GCz4BA,MAAM4B,EAAe,CAEhC,YAAY3jD,EAAO,CACf,KAAK,MAAQA,EAMb,KAAK,YAAc,EAMnB,KAAK,wBAA0B,GAM/B,KAAK,qBAAuB,IAAI,GAEnC,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,SAAU,CACN,QAAS3W,EAAI,EAAGsK,EAAI,KAAK,wBAAwB,OAAQtK,EAAIsK,EAAGtK,IAC5D,KAAK,yBAAyB,KAAK,wBAAwBA,CAAC,CAAC,EAGjE,KAAK,qBAAqB,QAC1B,KAAK,YAAc,CACtB,CAED,yBAAyB4I,EAAI,CACzB,OAAO,KAAK,qBAAqB,IAAIA,CAAE,CAC1C,CAED,iBAAiBkxC,EAAMlxC,EAAI,CAEvB,IAAIuX,EAAgBvX,EAAK,KAAK,qBAAqB,IAAIA,CAAE,EAAI,KAC7D,OAAKuX,IAEDA,EAAgB,IAAIs/B,GAAc,KAAM3F,CAAI,EAExClxC,IACAuX,EAAc,SAAWvX,EACzB,KAAK,qBAAqB,IAAIA,EAAIuX,CAAa,IAIhDA,CACV,CAED,oBAAoBA,EAAe/b,EAAS,CACxC,GAAI+b,EAAc,SAAQ,EAAI,OAE9B,KAAK,gBAAgBA,EAAc,EAAIA,EAAc,CAAC,EAGtD,MAAMggC,EAAgB,KAAK,2BAA2BhgC,EAAe/b,CAAO,EAE5E+b,EAAc,eAAiBggC,EAG/BA,EAAc,EAAIhgC,EAAc,EAChCggC,EAAc,EAAIhgC,EAAc,EAEhCggC,EAAc,OAAS,KAAK,MAAM,aAElC,KAAK,wBAAwB,KAAKhgC,CAAa,EAE/C,KAAK,eAAeA,CAAa,EAGjC,KAAK,iBAAiBA,EAAe,CAAC,CACzC,CAED,gBAAgB9I,EAAO,CACnB,KAAK,aAAeA,EACpB,KAAK,MAAM,eAAeA,CAAK,CAClC,CAED,iBAAiB8I,EAAeo6C,EAAM,CAClC,MAAMpa,EAAgBhgC,EAAc,cACpC,IAAIq6C,EAGCtrC,GAAM,iBAAkB,GAIxB/O,EAAc,SAAU,IAIzB,CAACggC,EAAc,eAAe,eAAe,GAAK,MAAMA,EAAc,aAAa,IAGvFqa,EAAQD,GAAQp6C,EAAc,EAAIA,EAAc,EAAIggC,EAAc,eAElE,KAAK,MAAM,aAAaqa,EAAOr6C,EAAc,QAAQ,GACxD,CAED,eAAeA,EAAe,CAC1B,MAAM+jC,EAAW/jC,EAAc,SAC3B+jC,IACK,KAAK,qBAAqB,IAAIA,CAAQ,GACvC,KAAK,qBAAqB,IAAIA,EAAU/jC,CAAa,EAGhE,CAED,IAAK,CACD,KAAK,yBAAwB,EAC7B,KAAK,kBAAiB,CACzB,CAED,0BAA2B,CACvB,IAAIs6C,EAA0B,GAC9B,QAASz6D,EAAI,EAAGsK,EAAI,KAAK,wBAAwB,OAAQtK,EAAIsK,EAAGtK,IAAK,CACjE,IAAI06D,EAAK,KAAK,wBAAwB16D,CAAC,EACnC06D,EAAG,eACH,KAAK,0BAA0BA,CAAE,EAEjCD,EAAwB,KAAKC,CAAE,CAEtC,CAED,KAAK,wBAA0BD,EAE/B,KAAK,kBAAiB,CACzB,CAED,0BAA0Bt6C,EAAe,CACjCA,EAAc,aACd,KAAK,yBAAyBA,CAAa,EAC3C,KAAK,gBAAgB,CAACA,EAAc,EAAIA,EAAc,CAAC,EAGvD,KAAK,iBAAiBA,EAAe,EAAE,GAI3CA,EAAc,aAAe,IAChC,CAED,mBAAoB,CAEhB,KAAK,qBAAqB,QAAQ,CAACA,EAAe+jC,IAAa,CACvD,EAAE/jC,EAAc,SAAQ,GAAMA,EAAc,UAAS,IAAO,CAACA,EAAc,UAC3E,KAAK,qBAAqB,OAAO+jC,CAAQ,CAEzD,CAAS,CACJ,CAMD,kBAAkB/jC,EAAe,CAC7B,MAAM/V,EAAQ,KAAK,wBAAwB,QAAQ+V,CAAa,EAC1Dw6C,EAAWvwD,IAAU,GAEvB+V,EAAc,aACVw6C,IACA,KAAK,gBAAgB,CAACx6C,EAAc,EAAIA,EAAc,CAAC,EACvD,KAAK,wBAAwB,OAAO/V,EAAO,CAAC,GAEhD,KAAK,yBAAyB+V,CAAa,GAI/CA,EAAc,aAAe,IAChC,CAED,2BAA2BA,EAAe/b,EAAS,CAC/C,OAAO,KAAK,MAAM,SAAS,oBAAoB+b,EAAe/b,CAAO,CACxE,CAED,yBAAyB+b,EAAe,CACpC,KAAK,MAAM,SAAS,kBAAkBA,CAAa,EACnDA,EAAc,mBAAkB,CACnC,CAEL,CC7Le,MAAMy6C,EAAiB,CAElC,YAAYjkD,EAAO,CACf,KAAK,MAAQA,EAEb,KAAK,gBAAmBwJ,GAAkB,CACtC,KAAK,QAAQA,CAAa,CACtC,EAEQ,KAAK,SAAW,GAChB,KAAK,MAAQ,EAChB,CAED,SAAU,CACN,KAAK,SAAW,GAChB,KAAK,MAAQ,GACb,KAAK,MAAQ,KAEb,OAAO,KAAK,SACZ,OAAO,KAAK,MACZ,OAAO,KAAK,KACf,CAED,aAAc,CACV,GAAI,KAAK,SAAS,OAAQ,CACtB,MAAMvU,EAAQ,KAAK,MACnB,GACI,KAAK,aAAY,QACb,KAAK,SAAS,QAAW,KAAK,IAAG,EAAKA,EAAQgvD,GAAiB,0BAC1E,CACJ,CAED,cAAe,CACX,MAAMn1D,EAAS,KAAK,SAAS,IAAG,EAC1B1G,EAAO,KAAK,MAAM,IAAG,EACvB0G,EAAO,aACPA,EAAO,oBAAoB1G,CAAI,CAEtC,CAED,IAAIohB,EAAephB,EAAM,CACrB,KAAK,SAAS,KAAKohB,CAAa,EAChC,KAAK,MAAM,KAAKphB,CAAI,CACvB,CAED,QAAQohB,EAAe,CACnB,MAAM/V,EAAQ,KAAK,SAAS,QAAQ+V,CAAa,EAC7C/V,GAAS,IACT,KAAK,SAAS,OAAOA,EAAO,CAAC,EAC7B,KAAK,MAAM,OAAOA,EAAO,CAAC,EAEjC,CAEL,CAEAwwD,GAAiB,0BAA4B,GCzD9B,MAAMC,EAAY,CAE7B,YAAYlkD,EAAO,CACf,KAAK,MAAQA,EAEb,KAAK,KAAO,KAEZ,KAAK,gBAAkB,EAEvB,KAAK,YAAc,KAAK,MAAM,SAAS,sBAAsB,IAAI,EAEjE,KAAK,WAAa,KAAK,MAAM,SAAS,yBAAyB,IAAI,EACnE,KAAK,WAAW,OAEhB,KAAK,YAAc,EACnB,KAAK,mBAAqB,GAE1B,KAAK,iBAAmB,EAExB,KAAK,QAAU,GAEf,KAAK,qBAAuB,CAC/B,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,SAAU,CACN,KAAK,mBAAmB,QAAQzH,GAAW,KAAK,mBAAmBA,CAAO,CAAC,EAC3E,KAAK,YAAc,EAEnB,KAAK,MAAQ,KACb,KAAK,KAAO,KAEZ,KAAK,YAAc,KACnB,KAAK,WAAa,KAClB,KAAK,mBAAqB,KAC1B,KAAK,QAAU,KAEf,OAAO,KAAK,MACZ,OAAO,KAAK,KACZ,OAAO,KAAK,YACZ,OAAO,KAAK,WACZ,OAAO,KAAK,mBACZ,OAAO,KAAK,OACf,CAED,kBAAmB,CACf,MAAO,CAAC,CAAC,KAAK,KAAK,QAAQ,iBAC9B,CAED,QAAS,CAEL,KAAK,KAAK,QAAQ,kBAAoB,EAEtC,KAAK,QAAO,CACf,CAED,QAAS,CACL,KAAK,QAAO,EAKR,KAAK,KAAK,aACV,KAAK,QAAO,EAGhB,KAAK,qBAAoB,CAC5B,CAKD,sBAAuB,CAEnB,GADU,KAAK,QAAQ,OAChB,CAEH,QAASlP,EAAI,EAAGsK,EAAI,KAAK,QAAQ,OAAQtK,EAAIsK,EAAGtK,IACxC,KAAK,QAAQA,CAAC,EAAE,OAChB,KAAK,QAAQA,CAAC,EAAE,qBAAoB,EAG5C,KAAK,QAAU,EAClB,CACJ,CAED,SAAU,CACN,KAAK,gBAAkB,EAEvB,KAAK,KAAK,QACb,CAED,SAAU,CACN,MAAM86D,EAAa,KAAK,MAAM,UAAU,YAAY,EAEpD,KAAK,iBAAgB,EAEjB,KAAK,MAAM,UAAU,sBAAsB,GAC3C,KAAK,YAAW,EAIpB,KAAK,eAAc,EAEfA,GACA,QAAQ,IAAI,qCAAqC,YAAK,qBAAsB,EAK5E,KAAK,MAAM,UAAU,qBAAqB,GAC1C,KAAK,sBAAwB,KAAK,MAAM,UAAU,8BAA8B,IAE5EA,GACA,QAAQ,IAAI,oDAAoD,EAEpE,KAAK,YAAW,GAGpB,KAAK,qBAAuB,CAC/B,CAED,aAAc,CACV,MAAMC,EAAS,IAAI,WAAW,CAAC,EACzB1hD,EAAK,KAAK,MAAM,GACtBA,EAAG,WAAW,EAAG,EAAG,EAAG,EAAGA,EAAG,KAAMA,EAAG,cAAe0hD,CAAM,CAC9D,CAED,kBAAmB,CACf,KAAK,YAAY,QACjB,KAAK,KAAK,SACV,KAAK,YAAY,QACpB,CAED,gBAAiB,CACb,KAAK,WAAW,SACnB,CAED,gBAAgB1jD,EAAO,CACnB,KAAK,aAAeA,EACpB,KAAK,MAAM,eAAeA,CAAK,CAClC,CAED,sBAAsBkR,EAAGC,EAAG,CACxB,IAAIwyC,EAAO,KAAK,MAAM,mBAAkB,EACpCnZ,EAAK,KAAK,IAAI,EAAG,KAAK,MAAMt5B,EAAIyyC,CAAI,CAAC,EACrCzI,EAAK,KAAK,IAAI,EAAG,KAAK,MAAM/pC,EAAIwyC,CAAI,CAAC,EAGzC,MAAM1wD,EAAI,KAAK,mBAAmB,OAClC,QAAStK,EAAIsK,EAAI,EAAGtK,GAAK,EAAGA,IAAK,CAC7B,MAAMkP,EAAU,KAAK,mBAAmBlP,CAAC,EAEzC,GAAIkP,EAAQ,IAAM2yC,GAAM3yC,EAAQ,IAAMqjD,GAAOrjD,EAAQ,SAAW,KAAK,MAAM,aACvE,OAAAA,EAAQ,EAAI,KAAK,MAAM,aACvB,KAAK,mBAAmB,OAAOlP,EAAG,CAAC,EAC5BkP,CAEd,CAED,MAAMA,EAAU,KAAK,qBAAqBqZ,EAAGC,EAAGq5B,EAAI0Q,CAAE,EACtD,OAAArjD,EAAQ,UAAY8rD,EACb9rD,CACV,CAED,qBAAqBA,EAAS,CAC1B,KAAK,mBAAmB,KAAKA,CAAO,CACvC,CAED,yBAAyB+rD,EAAS,GAAI,CAIlC,IAAIC,EAAQ,KAAK,MAAM,aAAeD,EAEtC,KAAK,mBAAqB,KAAK,mBAAmB,OAAO/rD,GACjDA,EAAQ,GAAKgsD,GACb,KAAK,mBAAmBhsD,CAAO,EACxB,IAEJ,EACV,CACJ,CAED,qBAAqBqZ,EAAGC,EAAGq5B,EAAI0Q,EAAI,CAC/B,KAAK,gBAAgB1Q,EAAK0Q,CAAE,EAE5B,MAAMrjD,EAAU,KAAK,MAAM,SAAS,oBAAoBqZ,EAAGC,EAAGq5B,EAAI0Q,CAAE,EACpE,OAAArjD,EAAQ,GAAK,KAAK,mBAClBA,EAAQ,EAAI,KAAK,MAAM,aACvBA,EAAQ,GAAKqZ,EACbrZ,EAAQ,GAAKsZ,EACbtZ,EAAQ,EAAI2yC,EACZ3yC,EAAQ,EAAIqjD,EAELrjD,CACV,CAED,mBAAmBixC,EAAe,CAC9B,KAAK,MAAM,SAAS,kBAAkBA,CAAa,EACnD,KAAK,gBAAgB,CAACA,EAAc,EAAIA,EAAc,CAAC,CAC1D,CAED,kBAAkB8Q,EAAe9Q,EAAe/7C,EAAS,CACrD,KAAK,MAAM,SAAS,kBAAkB6sD,EAAe9Q,EAAe/7C,CAAO,CAC9E,CAED,WAAW67C,EAAa,CACpB,KAAK,QAAQ,KAAKA,CAAW,CAChC,CAEL,CCnNe,MAAMkb,EAAmB,CACpC,YAAYxkD,EAAO,CACf,KAAK,MAAQA,EACb,KAAK,gBAAkB,OACvB,KAAK,oBAAsBygC,EAAW,kBAAkB,KAAK,eAAe,EAC5E,KAAK,MAAQ,EACb,KAAK,SAAW,GAChB,KAAK,OAAS,IACjB,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,eACf,CAED,IAAI,eAAehyC,EAAG,CAClB,KAAK,gBAAkBA,EACvB,KAAK,oBAAsBgyC,EAAW,kBAAkBhyC,CAAC,CAC5D,CAED,IAAI,oBAAqB,CACrB,OAAO,KAAK,mBACf,CAED,MAAMoK,EAAU,CACZoqC,GAAK,YAAY,KAAMpqC,CAAQ,CAClC,CACL,CAEA2rD,GAAmB,UAAU,qBAAuB,GC/BrC,MAAMC,EAAkB,CAEnC,YAAYzkD,EAAO,CACf,KAAK,MAAQA,EAEb,KAAK,MAAM,GAAG,aAAc,IAAM,KAAK,SAAQ,CAAE,EAOjD,KAAK,OAAS,IAAI,IAElB,KAAK,0BAA4B,IAAIwkD,GAAmB,KAAK,KAAK,CACrE,CAED,UAAW,CACP,GAAI,KAAK,OAAO,KAAM,CAClB,IAAIxnD,EAAK,KAAK,MAAM,GAEhBqmB,EAAS,GACb,KAAK,OAAO,QAAQ,SAAS33B,EAAG,CAC5BA,EAAE,SAASsR,CAAE,EACRtR,EAAE,cACH23B,EAAS,GAE7B,CAAa,EAEGA,IACA,KAAK,OAAS,IAAI,IAAI,CAAC,GAAG,KAAK,MAAM,EAAE,OAAOvxB,GAAMA,EAAE,UAAW,CAAC,CAAC,EAE1E,CACJ,CAED,eAAe+G,EAAU,CACrB,MAAM6rD,EAAqB,IAAIF,GAC/B,OAAAvhB,GAAK,YAAYyhB,EAAoB7rD,CAAQ,EACtC6rD,CACV,CAED,UAAUC,EAAY,CAClB,KAAK,OAAO,IAAIA,CAAU,CAC7B,CAED,aAAaA,EAAY,CACrB,KAAK,OAAO,OAAOA,CAAU,CAChC,CACL,CC9Ce,MAAMC,EAAY,CAE7B,aAAc,CACV,KAAK,OAAM,CACd,CAED,QAAS,CACL,KAAK,GAAK,GACV,KAAK,IAAM,GACX,KAAK,KAAO,GACZ,KAAK,GAAK,GACV,KAAK,GAAK,GACV,KAAK,IAAM,GACX,KAAK,IAAM,GACX,KAAK,GAAK,GACV,KAAK,IAAM,GACX,KAAK,KAAO,GACZ,KAAK,IAAM,GAEX,KAAK,QAAU,CAClB,CAED,MAAMh+C,EAAMye,EAAK,CACb,IAAI,EAAG1xB,EACF2uC,EAAM,gBAAgBjd,CAAG,IAC1BA,EAAM,CAAC,EAAGA,CAAG,GAGjB,IAAIw/B,EAAoB,GAEpBzwD,EAAQ,GACZ,QAASrE,KAAOs1B,EACZ,GAAIA,EAAI,eAAet1B,CAAG,EAAG,CACzB,IAAIspB,EAAMgM,EAAIt1B,CAAG,EACZuyC,EAAM,gBAAgBjpB,CAAG,IAC1BA,EAAM,CAAC,EAAGA,CAAG,GAGjB,IAAIvpB,EAAI,WAAWC,CAAG,EAElBA,IAAQ,KACR80D,EAAoBxrC,EAAI,EACjB,CAAC,MAAMvpB,CAAC,GAAKA,GAAK,GAAKA,GAAK,IACnCupB,EAAI,EAAIvpB,EAERupB,EAAI,EAAIipB,EAAM,WAAWjpB,EAAI,CAAC,EAC9BA,EAAI,GAAKA,EAAI,EAAIA,EAAI,EAAE,EAAG,CAAC,EAAIA,EAAI,EAEnCjlB,EAAM,KAAKilB,CAAG,EAErB,CAQL,IAJAjlB,EAAQA,EAAM,KAAK,SAAS,EAAGzI,EAAG,CAAC,OAAO,EAAE,EAAIA,EAAE,CAAC,CAAC,EAEpDgI,EAAIS,EAAM,OAEL,EAAI,EAAG,EAAIT,EAAG,IAAK,CACpB,IAAImxD,EAAQ,IAAMnxD,EAAI,EACtB,GAAI,CAACS,EAAM,CAAC,EAAE,eAAe,IAAI,EAE7BA,EAAM,CAAC,EAAE,GAAK0wD,EAAQ1wD,EAAM,CAAC,EAAE,GAAK,EAAI,EAAI,EAAiCA,EAAM,EAAI,CAAC,EAAE,MACvF,CAEH,MAAM+sD,EAAM,EAAIxtD,EAAI,EAAIS,EAAM,EAAI,CAAC,EAAE,EAAI,EACrCA,EAAM,CAAC,EAAE,GAAK+sD,IACd/sD,EAAM,CAAC,EAAE,GAAK+sD,EAErB,CACG/sD,EAAM,CAAC,EAAE,KAAOA,EAAM,CAAC,EAAE,EACzBA,EAAM,CAAC,EAAE,IAAM,EAEfA,EAAM,CAAC,EAAE,IAAM,GAAKA,EAAM,CAAC,EAAE,GAAKA,EAAM,CAAC,EAAE,EAElD,CAKD,IAAK,EAAI,EAAG,EAAIT,EAAG,IAKf,GAJKS,EAAM,CAAC,EAAE,eAAe,IAAI,IAE7BA,EAAM,CAAC,EAAE,GAAKywD,GAEd,CAACzwD,EAAM,CAAC,EAAE,eAAe,GAAG,EAE5B,GAAI,IAAM,GAAK,IAAMT,EAAI,GAAMS,EAAM,CAAC,EAAE,IAAM,EAE1CA,EAAM,CAAC,EAAE,EAAIwS,EAAO,CAAC,EAAG,EAAG,EAAG,CAAC,EAAI,MAChC,CACH,MAAMm+C,EAAK3wD,EAAM,EAAI,CAAC,EAChB4wD,EAAK5wD,EAAM,EAAI,CAAC,EACtB,GAAI2wD,EAAG,IAAMC,EAAG,EACZ5wD,EAAM,CAAC,EAAE,EAAIwS,EAAO,CAAC,EAAG,EAAG,EAAG,CAAC,EAAI,UAE/BA,EAAM,CACN,MAAMq+C,EAAKL,GAAY,kBAAkBI,EAAG,EAAE,EACxCE,EAAKN,GAAY,kBAAkBG,EAAG,EAAE,EACxC/wD,EAAI,GAAKgxD,EAAG,EAAID,EAAG,GACzB3wD,EAAM,CAAC,EAAE,EAAI,CACTJ,GAAKixD,EAAG,CAAC,EAAIC,EAAG,CAAC,GACjBlxD,GAAKixD,EAAG,CAAC,EAAIC,EAAG,CAAC,GACjBlxD,GAAKixD,EAAG,CAAC,EAAIC,EAAG,CAAC,GACjBlxD,GAAKixD,EAAG,CAAC,EAAIC,EAAG,CAAC,EACjD,CACA,MAC4B9wD,EAAM,CAAC,EAAE,GAAK4wD,EAAG,GAAKD,EAAG,KAAOC,EAAG,EAAID,EAAG,EAGrD,CAIT,IAAK,EAAI,EAAG,EAAIpxD,EAAI,EAAG,IAEnB,GAAI,CAACS,EAAM,CAAC,EAAE,EAAG,CAEb,IAAI0wD,EAAQ,IAAMnxD,EAAI,EACjBS,EAAM,CAAC,EAAE,eAAe,IAAI,IAC7BA,EAAM,CAAC,EAAE,GAAK0wD,EAAO1wD,EAAM,CAAC,EAAE,GAAKA,EAAM,EAAI,CAAC,EAAE,IAIhDkuC,EAAM,SAASluC,EAAM,CAAC,EAAE,CAAC,GAAKkuC,EAAM,SAASluC,EAAM,CAAC,EAAE,EAAE,IACnDA,EAAM,CAAC,EAAE,eAAe,KAAK,IAC9BA,EAAM,CAAC,EAAE,IAAM0wD,EAAOD,EAAoBzwD,EAAM,EAAI,CAAC,EAAE,IAEtDA,EAAM,CAAC,EAAE,eAAe,IAAI,IAC7BA,EAAM,CAAC,EAAE,GAAK0wD,EAAQl+C,EAAO,CAAC,EAAG,EAAG,EAAG,CAAC,EAAI,EAAKxS,EAAM,EAAI,CAAC,EAAE,GAI9DwS,EACAxS,EAAM,CAAC,EAAE,EAAIwwD,GAAY,2BAA2BxwD,EAAM,CAAC,EAAE,EAAGA,EAAM,CAAC,EAAE,GAAIA,EAAM,CAAC,EAAE,EAAGA,EAAM,CAAC,EAAE,GAAIA,EAAM,CAAC,EAAE,GAAIA,EAAM,CAAC,EAAE,IAAKA,EAAM,CAAC,EAAE,EAAGA,EAAM,CAAC,EAAE,EAAE,EAExJA,EAAM,CAAC,EAAE,EAAIwwD,GAAY,uBAAuBxwD,EAAM,CAAC,EAAE,EAAGA,EAAM,CAAC,EAAE,GAAIA,EAAM,CAAC,EAAE,EAAGA,EAAM,CAAC,EAAE,GAAIA,EAAM,CAAC,EAAE,GAAIA,EAAM,CAAC,EAAE,IAAKA,EAAM,CAAC,EAAE,EAAGA,EAAM,CAAC,EAAE,EAAE,EAGxJA,EAAM,CAAC,EAAE,EAAI,GAEpB,CAOL,IAJI,KAAK,QACL,KAAK,OAAM,EAGV,EAAI,EAAGT,EAAIS,EAAM,OAAQ,EAAIT,EAAG,IACjC,KAAK,KAAKS,EAAM,CAAC,CAAC,CAEzB,CAED,KAAKgB,EAAM,CACP,KAAK,GAAG,KAAKA,EAAK,GAAK,CAAC,EACxB,KAAK,IAAI,KAAKA,EAAK,IAAM,CAAC,EAC1B,KAAK,KAAK,KAAKA,EAAK,KAAO,CAAC,EAC5B,KAAK,GAAG,KAAKA,EAAK,GAAK,EAAK,EAC5B,KAAK,GAAG,KAAKA,EAAK,eAAe,GAAG,EAAIA,EAAK,EAAI,GACjD,KAAK,IAAI,KAAKA,EAAK,IAAM,CAAC,EAC1B,KAAK,IAAI,KAAKA,EAAK,IAAM,CAAC,EAC1B,KAAK,GAAG,KAAKA,EAAK,GAAK,CAAC,EACxB,KAAK,IAAI,KAAKA,EAAK,IAAM,CAAC,EAC1B,KAAK,KAAK,KAAKA,EAAK,KAAO,CAAC,EAC5B,KAAK,IAAI,KAAKA,EAAK,IAAM,CAAC,EAC1B,KAAK,SACR,CAED,SAAStF,EAAG,CACR,MAAM6D,EAAI,KAAK,QACf,GAAI,CAACA,EACD,MAAO,GAGX,GAAI7D,EAAI,KAAK,GAAG,CAAC,EACb,MAAO,GAGX,QAAS,EAAI,EAAG,EAAI6D,EAAG,IACnB,GAAI,KAAK,GAAG,CAAC,GAAK7D,GAAKA,EAAI,KAAK,IAAI,CAAC,EACjC,OAAO,EAIf,OAAO6D,EAAI,CACd,CAED,SAAS7D,EAAG,CACR,MAAMzG,EAAI,KAAK,SAASyG,CAAC,EACzB,GAAIzG,IAAM,GAGN,GAAI,KAAK,GAAGA,CAAC,EAAG,CACZ,MAAMoI,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI3B,EAAI,KAAK,GAAGzG,CAAC,GAAK,KAAK,KAAKA,CAAC,CAAC,CAAC,EAClE,OAAO,KAAK,GAAGA,CAAC,EAAEoI,CAAC,CACnC,KACgB,QAAO,KAAK,GAAGpI,CAAC,CAG3B,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,OAAO,kBAAkBw3C,EAAM,CAC3B,IAAIz7B,GAAMy7B,EAAO,MAAS,GAAK,IAC3BD,GAAMC,EAAO,IAAO,GAAK,IACzBl1C,EAAIk1C,EAAO,IACXn1C,EAAMm1C,EAAO,SAAY,EAC7B,MAAO,CAACz7B,EAAGw7B,EAAGj1C,EAAGD,CAAC,CACrB,CAED,OAAO,uBAAuBg1C,EAAIC,EAAIwkB,EAAIC,EAAI/S,EAAIgT,EAAIC,EAAIC,EAAI,CAE1D,IAAIC,EAAKJ,EAAKD,EACdG,GAAME,EACND,GAAMC,EAEN,IAAIC,EAAUb,GAAY,iBAAiBlkB,EAAIC,EAAI0R,EAAIgT,EAAIC,EAAIC,CAAE,EACjE,OAAKE,EAQM,SAAU31D,EAAG,CAChB,OAAIA,IAAM,EAAU4wC,EAChB5wC,IAAM,EAAU6wC,EACbikB,GAAY,gBAAgBa,EAAS31D,CAAC,CAC7D,EAXmB,SAAUA,EAAG,CAChB,OAAIA,IAAM,EAAU4wC,EAChB5wC,IAAM,EAAU6wC,EAEbA,EAAK7wC,EAAI4wC,GAAM,EAAI5wC,EAC1C,CAQK,CAED,OAAO,2BAA2B4wC,EAAIC,EAAIwkB,EAAIC,EAAI/S,EAAIgT,EAAIC,EAAIC,EAAI,CAE9D,IAAIC,EAAKJ,EAAKD,EACdG,EAAG,CAAC,GAAKE,EACTF,EAAG,CAAC,GAAKE,EACTF,EAAG,CAAC,GAAKE,EACTF,EAAG,CAAC,GAAKE,EACTD,EAAG,CAAC,GAAKC,EACTD,EAAG,CAAC,GAAKC,EACTD,EAAG,CAAC,GAAKC,EACTD,EAAG,CAAC,GAAKC,EAET,IAAIE,EAAMd,GAAY,kBAAkBlkB,CAAE,EACtCilB,EAAMf,GAAY,kBAAkBjkB,CAAE,EAEtC8kB,EAAU,CACVb,GAAY,iBAAiBc,EAAI,CAAC,EAAGC,EAAI,CAAC,EAAGtT,EAAIgT,EAAIC,EAAG,CAAC,EAAGC,EAAG,CAAC,CAAC,EACjEX,GAAY,iBAAiBc,EAAI,CAAC,EAAGC,EAAI,CAAC,EAAGtT,EAAIgT,EAAIC,EAAG,CAAC,EAAGC,EAAG,CAAC,CAAC,EACjEX,GAAY,iBAAiBc,EAAI,CAAC,EAAGC,EAAI,CAAC,EAAGtT,EAAIgT,EAAIC,EAAG,CAAC,EAAGC,EAAG,CAAC,CAAC,EACjEX,GAAY,iBAAiBc,EAAI,CAAC,EAAGC,EAAI,CAAC,EAAGtT,EAAIgT,EAAIC,EAAG,CAAC,EAAGC,EAAG,CAAC,CAAC,CAC7E,EAEQ,OAAKE,EAAQ,CAAC,EASH,SAAU31D,EAAG,CAChB,OAAIA,IAAM,EAAU4wC,EAChB5wC,IAAM,EAAU6wC,EAEbikB,GAAY,cAAc,CAC7B,KAAK,IAAI,IAAKA,GAAY,gBAAgBa,EAAQ,CAAC,EAAG31D,CAAC,CAAC,EACxD,KAAK,IAAI,IAAK80D,GAAY,gBAAgBa,EAAQ,CAAC,EAAG31D,CAAC,CAAC,EACxD,KAAK,IAAI,IAAK80D,GAAY,gBAAgBa,EAAQ,CAAC,EAAG31D,CAAC,CAAC,EACxD,KAAK,IAAI,IAAK80D,GAAY,gBAAgBa,EAAQ,CAAC,EAAG31D,CAAC,CAAC,CAC5E,CAAiB,CACjB,EAlBmB,SAAUA,EAAG,CAEhB,OAAIA,IAAM,EAAU4wC,EAChB5wC,IAAM,EAAU6wC,EAEbikB,GAAY,YAAYjkB,EAAID,EAAI5wC,CAAC,CACxD,CAeK,CAoBD,OAAO,iBAAiB4wC,EAAIC,EAAI0R,EAAIgT,EAAIC,EAAIC,EAAI,CAC5C,GAAI,CAAClT,GAAM,CAACgT,EAER,OAAO,KAKX,IAAIO,EAAMvT,EACNwT,EAAMnlB,EAAK4kB,EAAKjT,EAChByT,EAAM,EAAIT,EACVU,EAAMplB,EAAK4kB,EAAKF,EAEhB3jB,EAAK,EAAIkkB,EAAM,EAAIE,EAAM,EACzBrkB,EAAK,GAAKmkB,EAAM,EAAIE,EACpBtkB,EAAK,EAAIokB,EAET/jB,EAAK,EAAIgkB,EAAM,EAAIE,EAAMplB,EAAKD,EAC9BkB,EAAK,GAAKmkB,EAAMrlB,GAAM,EAAImlB,EAC1BlkB,EAAK,GAAKkkB,EAAMnlB,GAGpB,MAAO,CAACgB,EAAID,EAAID,EAAIK,EAAID,EAAID,EAFnBjB,CAEyB,CACrC,CASD,OAAO,gBAAgB+kB,EAAS31D,EAAG,CAC/B,IAAI4xC,EAAK+jB,EAAQ,CAAC,EACdhkB,EAAKgkB,EAAQ,CAAC,EACdjkB,EAAKikB,EAAQ,CAAC,EACd5jB,EAAK4jB,EAAQ,CAAC,EACd7jB,EAAK6jB,EAAQ,CAAC,EACd9jB,EAAK8jB,EAAQ,CAAC,EACdO,EAAKP,EAAQ,CAAC,EAElB,GAAI/jB,IAAO,IAAMG,IAAO,IAAML,IAAO,GAAKG,IAAO,EAE7C,OAAO7xC,EAIX,IAAIgC,EAAI,GAAKgwC,EAAKE,EAElB,QAASC,EAAK,EAAGA,EAAK,GAAIA,IAAM,CAK5B,GAHAH,EAAMhwC,GAAKA,GAAKA,EAAI4vC,EAAKD,GAAMD,GAE/BQ,EAAKlyC,EAAIgyC,EACLE,EAAK,OAASA,EAAK,KAEnB,OAAOlwC,GAAKA,GAAKA,EAAI+vC,EAAKD,GAAMD,GAAMqkB,EAI1C,IAAIjkB,EAAOjwC,GAAKA,GAAK,EAAI4vC,GAAM,EAAID,GAAMD,EAEzC,GAAIO,EAAO,OAASA,EAAO,MAEvB,MAGJjwC,GAAKkwC,EAAKD,CACb,CAGD,IAAIG,EAAO,EACPC,EAAO,EACX,QAASF,EAAK,EAAGA,EAAK,GAAIA,IAAM,CAO5B,GANAnwC,EAAI,IAAOowC,EAAOC,GAGlBL,EAAMhwC,GAAKA,GAAKA,EAAI4vC,EAAKD,GAAMD,GAE/BQ,EAAKlyC,EAAIgyC,EACLE,EAAK,OAASA,EAAK,KAEnB,OAAOlwC,GAAKA,GAAKA,EAAI+vC,EAAKD,GAAMD,GAAMqkB,EAGtChkB,EAAK,EACLG,EAAOrwC,EAEPowC,EAAOpwC,CAEd,CAED,OAAOA,CACV,CAED,OAAO,YAAYgvC,EAAIC,EAAIjxC,EAAG,CAC1B,IAAIkxC,GAAOF,EAAK,MAAS,GAAK,IAC1BG,GAAOH,EAAK,IAAO,GAAK,IACxBI,EAAKJ,EAAK,IACVK,EAAOL,EAAK,SAAY,EAExBM,GAAOL,EAAK,MAAS,GAAK,IAC1BM,GAAON,EAAK,IAAO,GAAK,IACxBO,EAAKP,EAAK,IACVQ,EAAOR,EAAK,SAAY,EAExB37B,EAAI47B,EAAKlxC,EAAIsxC,GAAM,EAAItxC,GACvB,EAAImxC,EAAKnxC,EAAIuxC,GAAM,EAAIvxC,GACvBnE,EAAIu1C,EAAKpxC,EAAIwxC,GAAM,EAAIxxC,GACvBpE,EAAIy1C,EAAKrxC,EAAIyxC,GAAM,EAAIzxC,GAE3B,OAAO,KAAK,MAAMpE,CAAC,EAAI,SAAW,KAAK,MAAM0Z,CAAC,EAAI,MAAQ,KAAK,MAAM,CAAC,EAAI,IAAM,KAAK,MAAMzZ,CAAC,CAC/F,CAED,OAAO,cAAcib,EAAM,CACvBA,EAAK,CAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,EAAK,CAAC,CAAC,CAAC,EAC5CA,EAAK,CAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,EAAK,CAAC,CAAC,CAAC,EAC5CA,EAAK,CAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,EAAK,CAAC,CAAC,CAAC,EAC5CA,EAAK,CAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,EAAK,CAAC,CAAC,CAAC,EAC5C,IAAInY,IAAMmY,EAAK,CAAC,EAAI,IAAM,MAAQA,EAAK,CAAC,EAAI,IAAM,MAAQA,EAAK,CAAC,EAAI,IAAM,IAAMA,EAAK,CAAC,EAAI,GAC1F,OAAInY,EAAI,IACJA,EAAI,WAAaA,EAAI,GAElBA,CACV,CACL,CC3ae,MAAMw3D,EAAwB,CAEzC,YAAY1qC,EAAmB,CAE3B,KAAK,kBAAoBA,EAMzB,KAAK,UAAY,GAOjB,KAAK,OAAS,IAAIqpC,GAMlB,KAAK,OAAS,GAMd,KAAK,aAAe,GAEpB,KAAK,YAAc,OACnB,KAAK,eAAiB,GAEtB,KAAK,kBAAoB,MAC5B,CAED,eAAgB,CACZ,OAAI,KAAK,eACE,KAAK,YAEL,KAAK,OAAO,SAAS,CAAC,CAEpC,CAED,MAAM9kC,EAAShwB,EAAGszD,EAAQ,CACtB,MAAM8C,EAAW,KAAK,oBAAoBpmC,CAAO,EAEjD,IAAIrxB,EAAI,KAAK,OAAO,SAASqB,CAAC,EAE9B,GAAIrB,IAAM,QAAa,CAACy3D,EAAS,OAC7B,OAGJ,GAAI9C,IAAW,EAAG,CAEd,IAAI+C,EAAK,KAAK,gBAEV7jB,EAAM,SAAS7zC,CAAC,GAAK6zC,EAAM,SAAS6jB,CAAE,IAClC,KAAK,mBACL13D,EAAIgyC,EAAW,YAAYhyC,EAAG03D,EAAI/C,CAAM,EAExC30D,EAAIgyC,EAAW,aAAahyC,EAAG03D,EAAI/C,CAAM,EAGpD,CAGD,MAAMzvD,EAAI,KAAK,aAAa,OAEtBmR,EAAIohD,EAAS,OACnB,QAASxxD,EAAI,EAAGA,EAAIoQ,EAAGpQ,IACnB,QAASrL,EAAI,EAAGA,EAAIsK,EAAGtK,IACnB,KAAK,aAAaA,CAAC,EAAE68D,EAASxxD,CAAC,EAAGjG,CAAC,CAG9C,CAED,oBAAoBqxB,EAAS,CACzB,OAAOA,EAAQ,OAAO,KAAK,SAAS,CACvC,CAED,MAAMA,EAAS,CACX,MAAMomC,EAAW,KAAK,oBAAoBpmC,CAAO,EAEjD,IAAIrxB,EAAI,KAAK,gBAEb,GAAIA,IAAM,QAAa,CAACy3D,EAAS,OAC7B,OAIJ,MAAMvyD,EAAI,KAAK,aAAa,OAEtBmR,EAAIohD,EAAS,OACnB,QAASxxD,EAAI,EAAGA,EAAIoQ,EAAGpQ,IACnB,QAASrL,EAAI,EAAGA,EAAIsK,EAAGtK,IACnB,KAAK,aAAaA,CAAC,EAAE68D,EAASxxD,CAAC,EAAGjG,CAAC,CAG9C,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAYA,CACpB,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,SAAWA,CACnB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,WAAWA,EAAG,CACd,KAAK,YAAcA,EACnB,KAAK,eAAkBA,IAAM,MAChC,CAED,IAAI,GAAGA,EAAG,CACN,KAAK,WAAaA,CACrB,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAAO,MAAM,KAAK,iBAAgB,EAAIA,CAAC,CAC/C,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,MAAQA,CAChB,CAED,IAAI,WAAWA,EAAG,CACT,MAAM,QAAQA,CAAC,IAChBA,EAAI,CAACA,CAAC,GAGV,KAAK,OAAS,GAEdA,EAAE,QAAS2rB,GAAS,CAChB,KAAK,OAAO,KAAKA,CAAI,EACrB,KAAK,aAAa,KAAK+3B,EAAQ,UAAU/3B,CAAI,CAAC,CAC1D,CAAS,CACJ,CAED,IAAI,SAAS3rB,EAAG,CACZ,KAAK,kBAAoB,OACzB,KAAK,WAAaA,CACrB,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,WAAaA,CACrB,CAED,MAAMoK,EAAU,CACZoqC,GAAK,YAAY,KAAMpqC,CAAQ,CAClC,CAED,kBAAmB,CACf,OAAI,KAAK,oBAAsB,SAC3B,KAAK,kBAAoB,KAAK,OAAO,OAASs5C,EAAQ,gBAAgB,KAAK,OAAO,CAAC,CAAC,EAAI,IAErF,KAAK,iBACf,CACL,CAEA8T,GAAwB,UAAU,0BAA4B,GCjK/C,MAAMG,EAAkB,CACnC,aAAc,CAIV,KAAK,SAAW,GAEhB,KAAK,MAAQ,EACb,KAAK,SAAW,EAEhB,KAAK,OAAS,EACd,KAAK,aAAe,EACpB,KAAK,YAAc,EAEnB,KAAK,SAAW,GAEhB,KAAK,WAAaA,GAAkB,aAAa,KACjD,KAAK,oBAAsB,OAC3B,KAAK,wBAA0B3lB,EAAW,kBAAkB,KAAK,mBAAmB,EACpF,KAAK,aAAe,EACpB,KAAK,UAAY,CACpB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQhyC,EAAG,CACX,KAAK,SAAW,GAChB,QAASpF,EAAI,EAAGsK,EAAIlF,EAAE,OAAQpF,EAAIsK,EAAGtK,IAAK,CACtC,MAAMf,EAAImG,EAAEpF,CAAC,EACb,GAAKf,EAAE,0BAKH,KAAK,SAAS,KAAKA,CAAC,MALU,CAC9B,MAAM+9D,EAAM,IAAIJ,GAAwB,IAAI,EAC5CI,EAAI,MAAM/9D,CAAC,EACX,KAAK,SAAS,KAAK+9D,CAAG,CACtC,CAGS,CACJ,CAQD,MAAMvmC,EAAShwB,EAAGszD,EAAS,EAAG,CAC1B,KAAK,SAAS,QAAQ,SAASkD,EAAQ,CACnCA,EAAO,MAAMxmC,EAAShwB,EAAGszD,CAAM,CAC3C,CAAS,CACJ,CAMD,MAAMtjC,EAAS,CACX,KAAK,SAAS,QAAQ,SAASwmC,EAAQ,CACnCA,EAAO,MAAMxmC,CAAO,CAChC,CAAS,CACJ,CAED,IAAI,oBAAqB,CACrB,OAAO,KAAK,mBACf,CAED,IAAI,mBAAmBrxB,EAAG,CACtB,KAAK,oBAAsBA,EAC3B,KAAK,wBAA0BgyC,EAAW,kBAAkBhyC,CAAC,CAChE,CAED,IAAI,wBAAyB,CACzB,OAAO,KAAK,uBACf,CAED,MAAMoK,EAAU,CACZoqC,GAAK,YAAY,KAAMpqC,CAAQ,CAClC,CAEL,CAEAutD,GAAkB,aAAe,CAC7B,KAAM,OACN,QAAS,UACT,QAAS,UACT,UAAW,YACX,SAAU,UACd,ECzFe,MAAMG,UAAkB3tD,CAAa,CAEhD,YAAY8E,EAAS7E,EAAUinB,EAAS,CACpC,QAEA,KAAK,QAAUpiB,EAEf,KAAK,UAAY7E,EAEjB,KAAK,SAAWinB,EAEhB,KAAK,OAASymC,EAAU,OAAO,KAE/B,KAAK,GAAK,EACV,KAAK,WAAa,EAClB,KAAK,aAAe,EAEpB,KAAK,eAAiB,EACtB,KAAK,OAAS,CACjB,CAED,OAAQ,CACA,KAAK,UAAY,KAAK,SAAS,UAC/B,KAAK,GAAK,EACV,KAAK,WAAa,KAAK,SAAS,MAChC,KAAK,aAAe,KAAK,SAAS,OAClC,KAAK,OAASA,EAAU,OAAO,QAC/B,KAAK,KAAK,OAAO,EACjB,KAAK,YAAW,GAEhB,QAAQ,KAAK,gEAAgE,CAEpF,CAED,MAAO,CACC,KAAK,SAAWA,EAAU,OAAO,QAEjC,KAAK,OAASA,EAAU,OAAO,QAC/B,KAAK,YAAW,EAChB,KAAK,KAAK,QAAQ,GACX,KAAK,QAAUA,EAAU,OAAO,UAAY,KAAK,SAAS,YAAcH,GAAkB,aAAa,SAE9G,KAAK,OAASG,EAAU,OAAO,QAC/B,KAAK,KAAK,cAAc,GACjB,KAAK,QAAUA,EAAU,OAAO,SAAW,KAAK,QAAUA,EAAU,OAAO,UAElF,KAAK,MAAK,CAEjB,CAED,OAAQ,CACA,KAAK,SAAWA,EAAU,OAAO,UACjC,KAAK,OAASA,EAAU,OAAO,OAC/B,KAAK,KAAK,OAAO,EAExB,CAED,QAAS,CACD,KAAK,QAAUA,EAAU,OAAO,SAChC,KAAK,MAAK,EAEV,KAAK,KAAI,CAEhB,CAED,WAAY,CACR,KAAK,WAAa,EAClB,KAAK,eAAiB,CACzB,CAED,QAAS,CACD,KAAK,SAAWA,EAAU,OAAO,SACjC,KAAK,WAAa,EAClB,KAAK,GAAK,GACH,KAAK,SAAWA,EAAU,OAAO,WACxC,KAAK,eAAiB,EACtB,KAAK,GAAK,EAEjB,CAED,MAAO,CACC,KAAK,SAAWA,EAAU,OAAO,SAAW,KAAK,SAAWA,EAAU,OAAO,OAEjF,KAAK,eAAiB,KAAK,SAAS,WAAa,EAE3C,KAAK,SAAS,aAAeH,GAAkB,aAAa,WAAc,CAAC,KAAK,gBAAmB,KAAK,WAAa,GAEvH,KAAK,OAASG,EAAU,OAAO,SAC/B,KAAK,KAAK,MAAM,IAEZ,KAAK,SAAS,aAAeH,GAAkB,aAAa,OAC5D,KAAK,OAAS,GAGlB,KAAK,OAASG,EAAU,OAAO,SAC/B,KAAK,KAAK,MAAM,GAGpB,KAAK,YAAW,EACnB,CAED,SAAU,EACF,KAAK,SAAWA,EAAU,OAAO,SAAW,KAAK,SAAWA,EAAU,OAAO,QAC7E,KAAK,OAASA,EAAU,OAAO,SAC/B,KAAK,GAAK,EACV,KAAK,KAAK,MAAM,EAChB,KAAK,MAAK,EACV,KAAK,OAASA,EAAU,OAAO,QAC/B,KAAK,KAAK,YAAY,EAE7B,CAED,UAAW,CACP,OAAO,KAAK,SAAWA,EAAU,OAAO,MAC3C,CAED,WAAY,CACR,OAAO,KAAK,SAAWA,EAAU,OAAO,OAC3C,CAED,YAAa,CACT,OAAO,KAAK,SAAWA,EAAU,OAAO,QAC3C,CAED,YAAa,CACT,OAAO,KAAK,SAAWA,EAAU,OAAO,QAC3C,CAED,aAAc,CACN,KAAK,YACL,KAAK,QAAQ,UAAU,IAAI,CAElC,CAED,UAAW,CACP,OAAQ,KAAK,QAAUA,EAAU,OAAO,SAAW,KAAK,QAAUA,EAAU,OAAO,WAAa,KAAK,UAAY,KAAK,SAAS,QAClI,CAED,SAASvpD,EAAI,CACJ,KAAK,WACV,KAAK,UAAUA,CAAE,EACjB,KAAK,MAAK,EACb,CAED,UAAUA,EAAI,CACV,GAAI,KAAK,QAAUupD,EAAU,OAAO,SAAU,CAC1C,KAAK,cAAcvpD,CAAE,EACrB,MACH,CAED,GAAI,KAAK,QAAUupD,EAAU,OAAO,QAIpC,IAAI,KAAK,WAAa,EAGlB,GAFA,KAAK,YAAcvpD,EAEf,KAAK,WAAa,EAClBA,EAAK,CAAC,KAAK,WACX,KAAK,WAAa,EAElB,KAAK,KAAK,UAAU,MAEpB,QAIJ,KAAK,SAAS,WAAa,EAC3B,KAAK,GAAK,EACH,KAAK,SAAS,SAAW,IAChC,KAAK,IAAMA,EAAK,KAAK,SAAS,UAE9B,KAAK,IAAM,EAEP,KAAK,SAAS,QAAU,IAAM,KAAK,aAAe,GAC9C,KAAK,aAAe,GACpB,KAAK,eAET,KAAK,GAAK,KAAK,SAAS,aACxB,KAAK,KAAK,WAAY,KAAK,EAAE,EAEzB,KAAK,SAAS,cACd,KAAK,WAAa,KAAK,SAAS,aAGpC,KAAK,KAAK,SAAU,KAAK,YAAY,IAErC,KAAK,GAAK,EACV,KAAK,KAAK,WAAY,KAAK,EAAE,EAE7B,KAAK,OAASupD,EAAU,OAAO,SAC/B,KAAK,KAAK,QAAQ,EACd,KAAK,SAAS,UACd,KAAK,KAAI,GAIjB,KAAK,KAAK,WAAY,KAAK,EAAE,EAEpC,CAED,cAAcvpD,EAAI,CACd,IAAIC,EAAW,KAAK,mBAEpB,GAAI,KAAK,eAAiB,EAGtB,GAFA,KAAK,gBAAkBD,EAEnB,KAAK,eAAiB,EACtBA,EAAK,CAAC,KAAK,eACX,KAAK,eAAiB,EAEtB,KAAK,KAAK,cAAc,MAExB,QAGJ,KAAK,SAAS,YAAcopD,GAAkB,aAAa,WAC3D,KAAK,OAASG,EAAU,OAAO,QAC/B,KAAK,KAAK,YAAY,GACf,KAAK,SAAS,YAAcH,GAAkB,aAAa,SAC9DnpD,IAAa,EACb,KAAK,GAAK,EACHA,EAAW,IAClB,KAAK,IAAMD,EAAKC,GAGhB,KAAK,IAAM,IACX,KAAK,GAAK,EACV,KAAK,OAASspD,EAAU,OAAO,QAC/B,KAAK,KAAK,YAAY,IAEnB,KAAK,SAAS,YAAcH,GAAkB,aAAa,MAClE,KAAK,wBAAwBppD,CAAE,EAC3B,KAAK,QAAU,IACf,KAAK,GAAK,EACV,KAAK,OAASupD,EAAU,OAAO,QAC/B,KAAK,KAAK,YAAY,IAEnB,KAAK,SAAS,YAAcH,GAAkB,aAAa,SAC9D,KAAK,GAAK,IACNnpD,IAAa,EACb,KAAK,GAAK,EACHA,EAAW,IACd,KAAK,GAAK,EACV,KAAK,IAAMD,EAAK,KAAK,SAAS,SAE9B,KAAK,IAAMA,EAAKC,GAGpB,KAAK,IAAM,GACX,KAAK,GAAK,EACV,KAAK,OAASspD,EAAU,OAAO,QAC/B,KAAK,KAAK,YAAY,GAEtB,KAAK,KAAK,WAAY,KAAK,EAAE,GAG9B,KAAK,SAAS,YAAcH,GAAkB,aAAa,SAC9D,KAAK,GAAK,IACN,KAAK,SAAS,UAAY,EAC1B,KAAK,GAAK,EAEV,KAAK,IAAMppD,EAAK,KAAK,SAAS,SAE9B,KAAK,IAAM,EACP,KAAK,SAAS,YAAcopD,GAAkB,aAAa,SAC3D,KAAK,GAAK,EACV,KAAK,OAASG,EAAU,OAAO,QAC/B,KAAK,KAAK,YAAY,GAElB,KAAK,aAAe,GACpB,KAAK,eACL,KAAK,GAAK,EACV,KAAK,KAAK,SAAU,KAAK,YAAY,IAErC,KAAK,GAAK,EACV,KAAK,OAASA,EAAU,OAAO,QAC/B,KAAK,KAAK,YAAY,GAI9B,KAAK,KAAK,WAAY,KAAK,EAAE,EAK5C,CAED,wBAAwBvpD,EAAI,CACxB,GAAI,KAAK,OAAS,EAAG,CACjB,GAAI,KAAK,eAAiB,EAGtB,GAFA,KAAK,gBAAkBA,EAEnB,KAAK,eAAiB,EACtBA,EAAK,CAAC,KAAK,eACX,KAAK,eAAiB,EAEtB,KAAK,KAAK,UAAU,MAEpB,QAIR,MAAMC,EAAW,KAAK,mBAElBA,GAAY,EACZ,KAAK,OAAS,EAEd,KAAK,QAAUD,EAAKC,EAEpB,KAAK,QAAU,IAEf,KAAK,OAAS,EAErB,CACJ,CAED,kBAAmB,CACf,OAAO,KAAK,SAAS,cAAgB,KAAK,SAAS,QACtD,CAED,OAAQ,CACJ,GAAI,KAAK,SAAWspD,EAAU,OAAO,QACjC,KAAK,MAAK,MACP,CACH,IAAInD,EAAS,EACT,KAAK,SAAWmD,EAAU,OAAO,UAAY,KAAK,SAAS,aAAeH,GAAkB,aAAa,OACzGhD,EAAU,EAAI,KAAK,SAAS,uBAAuB,KAAK,MAAM,GAElE,KAAK,UAAU,MAAM,KAAK,SAAU,KAAK,GAAIA,CAAM,CACtD,CACJ,CAED,OAAQ,CACJ,KAAK,UAAU,MAAM,KAAK,QAAQ,CACrC,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MAAM,KAAK,GAAK,KAAK,UAAU,SAAW,EAAE,CAC3D,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAEL,CAEAmD,EAAU,OAAS,CACf,KAAM,EACN,QAAS,EACT,SAAU,EACV,QAAS,EACT,SAAU,EACV,OAAQ,CACZ,ECrXe,MAAMjwC,EAAiB,CAElC,YAAYtW,EAAO,CACf,KAAK,MAAQA,EAEb,KAAK,MAAM,GAAG,aAAc,IAAM,KAAK,SAAQ,CAAE,EAMjD,KAAK,OAAS,IAAI,GACrB,CAED,UAAW,CACP,GAAI,KAAK,OAAO,KAAM,CAClB,IAAIhD,EAAK,KAAK,MAAM,GAEhBqmB,EAAS,GACb,KAAK,OAAO,QAAQ,SAAS33B,EAAG,CACxBA,EAAE,WACFA,EAAE,SAASsR,CAAE,EAEbqmB,EAAS,EAE7B,CAAa,EAEGA,IACA,KAAK,OAAS,IAAI,IAAI,CAAC,GAAG,KAAK,MAAM,EAAE,OAAOvxB,GAAKA,EAAE,SAAQ,CAAE,CAAC,EAEvE,CACJ,CAED,gBAAgBguB,EAASjnB,EAAU,CAC/B,OAAIypC,EAAM,gBAAgBzpC,CAAQ,IAE9BA,EAAW,KAAK,eAAeA,CAAQ,GAGpC,IAAI0tD,EACP,KACA1tD,EACAinB,CACZ,CACK,CAED,eAAejnB,EAAU,CACrB,MAAM0iB,EAAoB,IAAI6qC,GAC9B,OAAAnjB,GAAK,YAAY1nB,EAAmB1iB,CAAQ,EACrC0iB,CACV,CAED,UAAUopC,EAAY,CAClB,KAAK,OAAO,IAAIA,CAAU,CAC7B,CACL,CCrDe,MAAM6B,WAAyBj+C,EAAQ,CAElD,cAAe,CACX,MAAO,YACV,CAED,kBAAmB,CACf,OAAO,SAASygC,EAAI,CAChB,IAAIyd,EAAa,IAAI,WAAW,CAAC,IAAK,IAAK,IAAK,GAAG,CAAC,EACpDzd,EAAG,KAAM,CAAC,OAAQyd,EAAY,EAAG,EAAG,EAAG,EAAG,UAAW,EAAI,CAAC,CAC7D,CACJ,CAED,mBAAoB,CAChB,MAAO,EACV,CACL,CCLe,MAAMluC,WAAc3f,CAAa,CAE5C,YAAYnL,EAAU,GAAI,CACtB,QACA,KAAK,YAAYA,CAAO,EAExB,KAAK,YAAc,EACnB,KAAK,aAAe,EAGpB,KAAK,eAAiB,EACtB,KAAK,kBAAoB,EAEzB,MAAMi5D,EAAenuC,GAAM,SAAWA,GAAM,SAAWgoC,GAAe,KAAK9yD,CAAO,EAClF,KAAK,SAAW,IAAIi5D,EAEhB,KAAK,SAAS,MACd,KAAK,SAAS,KAAK,IAAI,EAG3B,KAAK,GAAK,KACV,KAAK,IAAM,KAEX,MAAMv0D,EAAU,KAAK,UAAU,SAAS,EA2BxC,GA1BIA,EACIA,EAAQ,WACR,KAAK,GAAKA,EAEV,KAAK,IAAMA,EAGXmwC,EAAM,QAAU,CAAC/pB,GAAM,iBAAkB,GAAI,KAAK,UAAU,UAAU,GACtE,KAAK,IAAM,KAAK,SAAS,oBAAoB,KAAK,UAAU,GAAG,EAAG,KAAK,UAAU,GAAG,CAAC,EAErF,KAAK,GAAK,KAAK,SAAS,mBAAmB,KAAK,UAAU,GAAG,EAAG,KAAK,UAAU,GAAG,CAAC,EAIvF,KAAK,IAMLwpC,GAAkB,OAAO,KAAK,GAAI,WAAW,EAGjD,KAAK,MAAQ,KAAK,GAAK,EAAI,EAGvB,KAAK,YAAa,CAClB,GAAI,KAAK,UAAU,kBAAkB,IAAM,EAAG,CAC1C,MAAM4E,EAAQ,KAAK,UAAU,kBAAkB,EAE/C,KAAK,YAAY,MAAM,MAAQ,KAAK,SAAS,EAAOA,EAAS,KAC7D,KAAK,YAAY,MAAM,OAAS,KAAK,SAAS,EAAOA,EAAQ,IAChE,CAGD,KAAK,SAAS,EAAI,KAAK,UAAS,EAAG,MACnC,KAAK,SAAS,EAAI,KAAK,UAAS,EAAG,MACtC,CAEG,KAAK,QAAU,EACXrkB,EAAM,QACN,KAAK,UAAY,IAAI6b,GAAc,IAAI,EAEvC,KAAK,UAAY,IAAIzC,GAAc,IAAI,EAG3C,KAAK,UAAY,IAAIoC,GAAY,IAAI,EAGzC,KAAK,cAAc,KAAK,UAAU,YAAY,CAAC,EAE/C,KAAK,aAAe,EAEpB,KAAK,YAAc,IAAI2G,GAAkB,IAAI,EAC7C,KAAK,WAAa,IAAInuC,GAAiB,IAAI,EAE3C,KAAK,eAAiB,IAAIqtC,GAAe,IAAI,EAC7C,KAAK,iBAAmB,IAAIM,GAAiB,IAAI,EAEjD,KAAK,UAAY,EACjB,KAAK,YAAc,EACnB,KAAK,GAAK,EAGV,KAAK,iBAAmB,IAAIuC,GAAiB,IAAI,EACjD,KAAK,iBAAiB,OAGtB,KAAK,iBAAiB,OAAO,UAAY,GAEzC,KAAK,IAAM,IAAItC,GAAY,IAAI,EAE/B,KAAK,sBAAwB,IAAI,GACpC,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,OAAO,kBAAmB,CACtB,GAAI5hB,EAAM,OACN,MAAO,GAGX,GAAI,CACA,MAAO,CAAC,CAAC,OAAO,qBACnB,OAAQh6C,EAAG,CACR,MAAO,EACV,CACJ,CAQD,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,SAAU,CACN,OAAO,KAAK,OAAS,CACxB,CAED,OAAQ,CACJ,OAAO,KAAK,OAAS,CACxB,CAED,UAAU8O,EAAM,CACZ,OAAO,KAAK,SAASA,CAAI,CAC5B,CAED,YAAY3F,EAAG,CACX,KAAK,SAAW,GAEhB,IAAIm1D,EAAM,CAACxvD,EAAMiuB,IAAQ,CACrB,IAAI73B,EAAQiE,EAAE2F,CAAI,EAEd5J,IAAU,OACV,KAAK,SAAS4J,CAAI,EAAIiuB,EAEtB,KAAK,SAASjuB,CAAI,EAAI5J,CAE7B,EAEDo5D,EAAI,SAAU,IAAI,EAClBA,EAAI,UAAW,IAAI,EACnBA,EAAI,IAAK,IAAI,EACbA,EAAI,IAAK,IAAI,EACbA,EAAI,cAAe,IAAI,EACvBA,EAAI,iBAAkB,IAAI,EAC1BA,EAAI,eAAgB,GAAG,EACvBA,EAAI,wBAAyB,CAAC,EAC9BA,EAAI,YAAa,CAAE,UAAW,YAAc,SAAU,GAAI,EAC1DA,EAAI,aAAc,CAAC,EAAG,EAAG,EAAG,CAAC,CAAC,EAC9BA,EAAI,kBAAmB,YAAY,EACnCA,EAAI,UAAW,CAAC,EAChBA,EAAI,iBAAkB,EAAI,EAC1BA,EAAI,YAAa,EAAI,EACrBA,EAAI,YAAa,CAAC,EAClBA,EAAI,WAAY,EAAK,EACrBA,EAAI,WAAY,IAAI,EACpBA,EAAI,uBAAwB,EAAK,EACjCA,EAAI,mBAAoB,CAAC,EACzBA,EAAI,sBAAuB,EAAK,EAChCA,EAAI,+BAAgC,CAAC,EACrCA,EAAI,aAAc,EAAK,EACvBA,EAAI,sBAAuB,EAAK,EAChCA,EAAI,qBAAsB,EAAK,EAE3Bn1D,EAAE,kBAAuB,MAAQA,EAAE,mBAAwB,IAC3D,KAAK,SAAS,WAAgBA,EAAE,iBAChC,KAAK,SAAS,GAAQA,EAAE,iBACxB,KAAK,SAAS,GAAQA,EAAE,iBAE/B,CAED,eAAelG,EAAK,CAChB,KAAK,YAAcA,CACtB,CAED,MAAO,CAEC,KAAK,YAAY,UAAU,OAAO,GAAK,KAAK,SAAS,cACrD,QAAQ,IAAI,iCAAiC,EAG7C,KAAK,YAAY,UAAU,OAAO,GAAK,KAAK,KAC5C,QAAQ,IAAI,qCAAqC,EAGrD,KAAK,YAAY,YACb,KAAK,UAAU,WAAW,GAC1B,KAAK,SAAS,WAErB,CAED,SAAU,CACN,KAAK,SAAS,WACd,KAAK,SAAS,UACd,KAAK,IAAI,UACT,KAAK,eAAe,UACpB,KAAK,UAAU,UAGX,KAAK,IACL,KAAK,GAAG,WAAW,EAAK,EAAK,EAAK,CAAG,EACrC,KAAK,GAAG,MAAM,KAAK,GAAG,gBAAgB,GAC/B,KAAK,KACZ,KAAK,IAAI,UACL,EAAG,EAAG,KAAK,IAAI,OAAO,MAAO,KAAK,IAAI,OAAO,MAC7D,EAGQ,KAAK,GAAK,KACV,KAAK,IAAM,KACX,KAAK,IAAM,KACX,KAAK,SAAW,KAChB,KAAK,SAAW,KAChB,KAAK,eAAiB,KACtB,KAAK,UAAY,KAEjB,OAAO,KAAK,GACZ,OAAO,KAAK,IACZ,OAAO,KAAK,IACZ,OAAO,KAAK,SACZ,OAAO,KAAK,SACZ,OAAO,KAAK,eACZ,OAAO,KAAK,SACf,CAED,MAAO,CACH,KAAK,SAAS,UACjB,CAED,QAAS,CACL,KAAK,SAAS,WACjB,CAED,IAAI,MAAO,CACP,OAAO,KAAK,WACf,CAED,WAAY,CACR,OAAO,KAAK,MAAQ,KAAK,IAAI,OAAS,KAAK,GAAG,MACjD,CAED,oBAAqB,CACjB,OAAO,KAAK,SAAS,SACxB,CAMD,uBAAuBgN,EAAS,CACxB,KAAK,eAELA,EAAQ,qBAAoB,EAE5B,KAAK,sBAAsB,IAAIA,CAAO,CAE7C,CAED,0BAA0BA,EAAS,CAC3B,KAAK,uBACL,KAAK,sBAAsB,OAAOA,CAAO,CAEhD,CAED,uBAAuBA,EAAS,CAC5B,OAAQ,KAAK,uBAAyB,KAAK,sBAAsB,IAAIA,CAAO,CAC/E,CAGD,sBAAuB,CACf,KAAK,sBAAsB,OAC3B,KAAK,sBAAsB,QAAQA,GAAW,CAC1CA,EAAQ,qBAAoB,CAC5C,CAAa,EACD,KAAK,sBAAwB,IAAI,IAExC,CAED,cAAe,CACX,KAAK,UAAY,KAAK,YACtB,KAAK,YAAc,KAAK,SAAS,UAAS,EAEtC,KAAK,SAAS,QACd,KAAK,GAAK,KAAK,SAAS,QAExB,KAAK,GAAO,KAAK,UAAmB,MAAQ,KAAK,YAAc,KAAK,WAAtC,GAErC,CAED,aAAc,CACV,KAAK,aAAY,EACjB,KAAK,KAAK,YAAY,EACtB,KAAK,qBAAoB,EACzB,KAAK,KAAK,QAAQ,CACrB,CAED,WAAY,CACR,KAAK,iBAAiB,cACtB,KAAK,KAAK,UAAU,EACpB,KAAK,cACR,CAED,aAAc,CACV,MAAM2nD,EAAU,KAAK,IAAI,iBAAgB,EAIzC,KAAK,iBAAiB,cAElBA,IACA,KAAK,eAAiB,GACtB,KAAK,IAAI,SACT,KAAK,IAAI,SACT,KAAK,eAAiB,IAG1B,KAAK,SAAS,UAAUA,CAAO,EAE/B,KAAK,KAAK,UAAU,EAEpB,KAAK,cACR,CAED,iBAAkB,CACd,OAAO,KAAK,cACf,CAED,WAAY,CAKR,KAAK,YAAW,EAChB,KAAK,YAAW,CACnB,CAED,mBAAoB,CAEZ,KAAK,MACL,KAAK,KAAK,KAAK,QAAQ,oBAAoB,CAAC,CAEnD,CAED,cAAc9pC,EAAY,CACtB,KAAK,kBAAiB,EAClBA,IAAe,KAEf,KAAK,YAAc,KACZ,MAAM,QAAQA,CAAU,EAC/B,KAAK,YAAcA,EAEnB,KAAK,YAAcqqB,EAAW,4BAA4BrqB,CAAU,CAE3E,CAED,eAAgB,CACZ,OAAO,KAAK,WACf,CAED,cAAcvd,EAAU,CACpB,OAAIA,EACO,KAAK,QAAQA,CAAQ,EAErB,IAAIs5C,EAAQ,IAAI,CAE9B,CAED,aAAat5C,EAAU,CACnB,OAAOu0C,GAAO,OAAO,KAAMv0C,CAAQ,CACtC,CAED,QAAQA,EAAU,CACd,GAAIA,EAAS,UAAW,OAAOA,EAE/B,IAAIinB,EACJ,OAAIjnB,EAAS,KACTinB,EAAU,IAAIjnB,EAAS,KAAK,IAAI,EAEhCinB,EAAU,IAAIqyB,EAAQ,IAAI,EAG9BryB,EAAQ,MAAMjnB,CAAQ,EAEfinB,CACV,CAED,EAAEjnB,EAAU,CACR,OAAO,KAAK,QAAQA,CAAQ,CAC/B,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,SAAS,CACxB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,SAAS,CACxB,CAED,IAAI,aAAc,CACd,OAAO,KAAK,EAAI,KAAK,SAAS,SACjC,CAED,IAAI,cAAe,CACf,OAAO,KAAK,EAAI,KAAK,SAAS,SACjC,CAED,eAAe6H,EAAO,CAClB,KAAK,aAAeA,EAChB,KAAK,eAAiB,KAAK,cACvB,KAAK,YAAc,KAAK,UAAU,gBAAgB,IAClD,KAAK,GAAG,EAAK,EACT,KAAK,YAAc,KAAK,UAAU,gBAAgB,EAAI,KAEtD,KAAK,GAAG,EAAI,EAI3B,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,aAAaA,EAAO2P,EAAO,CACnBA,EACA,KAAK,gBAAkB3P,EAGvB,KAAK,mBAAqBA,CAEjC,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,kBAAmB,CACnB,OAAO,KAAK,iBACf,CAED,IAAI,UAAW,CACX,OAAO,KAAK,eAAiB,KAAK,iBACrC,CAED,GAAG86C,EAAY,CACX,GAAI,KAAK,eAAiB,KAAK,aAAc,CACzC,KAAK,aAAe,KAAK,aACzB,MAAMqL,EAAoB,KAAK,YAK/B,GAJA,KAAK,gBAAgBrL,CAAU,EAC/B,KAAK,sBAAsBA,CAAU,EACrC,KAAK,SAAS,GAAGA,CAAU,EAEvB,KAAK,YAAY,UAAU,OAAO,EAAG,CACrC,QAAQ,IAAI,iBAAiB,OAAAA,EAAa,eAAiB,GAAE,YAAW,YAAK,aAAY,WAAY,SAAAqL,EAAoB,KAAK,aAAe,KAAK,QAAQ,CAAC,EAAC,mCAAmC,aAAK,YAAc,KAAK,QAAQ,CAAC,EAAC,KAAI,EACrO,MAAMhnD,EAAQ,KAAK,YAAc,KAAK,eAAe,WAAa,KAAK,IAAI,WAC3E,QAAQ,IAAI,yBAA0B,aAAK,eAAe,WAAa,KAAK,QAAQ,CAAC,EAAC,yBAAyB,aAAK,IAAI,WAAa,KAAK,QAAQ,CAAC,EAAC,yBAAyB,QAAAA,EAAQ,KAAK,QAAQ,CAAC,EAAC,KAAI,CAC3M,CACJ,CACJ,CAED,gBAAgB27C,EAAa,GAAO,CAC5BA,GAAc,KAAK,IAAI,KAAK,SAE5B,KAAK,IAAI,KAAK,QAAU,GACxB,KAAK,eAAe,KACpB,KAAK,IAAI,KAAK,QAAU,IAExB,KAAK,eAAe,IAE3B,CAED,sBAAsBA,EAAa,GAAO,CAClCA,GAAc,KAAK,KAAK,SAExB,KAAK,KAAK,QAAU,GACpB,KAAK,IAAI,yBAAyB,CAAC,EACnC,KAAK,KAAK,QAAU,IAEpB,KAAK,IAAI,yBAAyB,CAAC,CAE1C,CAED,kBAAmB,CACf,OAAO,KAAK,SAAS,kBACxB,CAED,QAAS,CACL,KAAK,IAAI,OAAQ,CACpB,CAED,mBAAmBsL,EAAiB,CAC5BxkB,EAAM,SACN,KAAK,SAAS,mBAAmBwkB,CAAe,CAEvD,CAED,sBAAsB1nD,EAAGC,EAAG,CACxB,MAAMjN,EAAW,GACjB,YAAK,KAAK,KAAK,SACf,KAAK,KAAK,KAAK,eAAegN,EAAGC,EAAGjN,CAAQ,EAErCA,CACV,CACL,CC5gBe,MAAM20D,WAAoB7O,EAAU,CAE/C,YAAYzqD,EAAU,CAAE,EAAE6nD,EAAY,CAElCyR,GAAY,cAAgBt5D,EAG5Bs5D,GAAY,QAAU,GACtB,MAAM/mD,EAAQ,IAAIuY,GAAM9qB,EAAQ,KAAK,EACrC,MAAMuS,EAAOs1C,CAAU,EACvByR,GAAY,QAAU,GAEtB,KAAK,qBAAuB,EAC5B,KAAK,iBAAmB,IAAI,IAC5B,KAAK,eAAiB,KAItB,KAAK,MAAM,OAGX,KAAK,oBAAmB,EAExB,KAAK,SAAW,KAAK,UAAU,MAAM,EAEjC,KAAK,WACL,KAAK,MAAM,SAAS,uBAAwBz+D,GAAM,CAC9C,KAAK,gBAAgBA,CAAC,CACtC,CAAa,EAED,KAAK,MAAM,SAAS,qBAAsBA,GAAM,CAC5C,KAAK,cAAcA,CAAC,CACpC,CAAa,GAGD,KAAK,UAAU,eAAe,IAC9B,KAAK,MAAM,SAAS,qBAAsBA,GAAM,CAC5C,KAAK,cAAcA,CAAC,CACpC,CAAa,EAED,KAAK,MAAM,SAAS,qBAAsBA,GAAM,CAC5C,KAAK,cAAcA,CAAC,CACpC,CAAa,EAED,KAAK,MAAM,SAAS,2BAA4BA,GAAM,CAClD,KAAK,oBAAoBA,CAAC,CAC1C,CAAa,EAED,KAAK,OAAS,UAErB,CAED,UAAU8O,EAAM,CACZ,OAAO,KAAK,UAAUA,CAAI,CAC7B,CAED,YAAY3F,EAAG,CACX,KAAK,UAAY,GAEjB,IAAIm1D,EAAM,CAACxvD,EAAMiuB,IAAQ,CACrB,IAAI73B,EAAQiE,EAAE2F,CAAI,EAEd5J,IAAU,OACV,KAAK,UAAU4J,CAAI,EAAIiuB,EAEvB,KAAK,UAAUjuB,CAAI,EAAI5J,CAE9B,EAEDo5D,EAAI,QAAS,EAAK,EAClBA,EAAI,OAAQ,CACR,GAAI,KACJ,GAAI,OACJ,GAAI,OACJ,GAAI,QACJ,GAAI,QACJ,EAAG,OACH,GAAI,MAChB,CAAS,EACDA,EAAI,gBAAiB,EAAK,CAC7B,CAED,aAAc,CACV,KAAK,MAAM,eAAe,IAAI,EAE9B,KAAK,YAAYG,GAAY,aAAa,EAC1C,OAAOA,GAAY,cAEnB,MAAM,YAAW,CACpB,CAED,QAAS,CACL,MAAM,OAAM,EACZ,KAAK,cAAa,CACrB,CAED,iBAAkB,CACd,KAAK,cAAa,CACrB,CAED,eAAgB,CACZ,MAAMC,EAAgB,KAAK,mBAEvB,CAACD,GAAY,SAAWC,GACxB,KAAK,oBAAmB,CAE/B,CAED,kBAAmB,CACf,MAAMC,EAAgB,EAAE,KAAK,qBAC7B,KAAK,gBAAkBA,EAEvB,MAAMC,EAAe,KAAK,iBACpBC,EAAsBD,EAAaA,EAAa,OAAS,CAAC,EAC1DE,EAAuB,KAAK,WAAa,KAAK,WAAW,KAAK,WAAW,OAAS,CAAC,EAAI,OAE7F,GAAKA,EAYE,CACH,IAAItiD,EAAI,KAAK,IAAI,KAAK,WAAW,OAAQoiD,EAAa,MAAM,EACxDzzD,EACJ,IAAKA,EAAQ,EAAGA,EAAQqR,GAChB,KAAK,WAAWrR,CAAK,IAAMyzD,EAAazzD,CAAK,EAD1BA,IACvB,CAKJ,GAAI,KAAK,WAAW,SAAWyzD,EAAa,QAAUzzD,IAAUyzD,EAAa,OAAQ,CAE7E,KAAK,UAAU,OAAO,GACtB,QAAQ,IAAI,8BAAgCC,EAAoB,kBAAmB,GAIvF,QAAS99D,EAAI,KAAK,WAAW,OAAS,EAAGA,GAAKoK,EAAOpK,IAIjD,GAHyB,KAAK,WAAW,IAAG,EAC3B,SAAS89D,EAAqBC,CAAoB,EAC1C,KAAK,kBAAoBH,EAE9C,MAAO,GAKf,QAAS59D,EAAIoK,EAAOE,EAAIuzD,EAAa,OAAQ79D,EAAIsK,EAAGtK,IAIhD,GAHA,KAAK,WAAW,KAAK69D,EAAa79D,CAAC,CAAC,EACpC,KAAK,WAAWA,CAAC,EAAE,OAAO89D,EAAqBC,CAAoB,EAC1C,KAAK,kBAAoBH,EAE9C,MAAO,GAKf,QAAS59D,EAAI,EAAGA,EAAIoK,EAAOpK,IACvB,KAAK,WAAWA,CAAC,EAAE,aAAa89D,EAAqBC,CAAoB,CAEhF,CACJ,KApD0B,CAEvB,KAAK,WAAa,GAClB,QAAS/9D,EAAI,EAAGsK,EAAIuzD,EAAa,OAAQ79D,EAAIsK,EAAGtK,IAI5C,GAHA,KAAK,WAAW,KAAK69D,EAAa79D,CAAC,CAAC,EACpC,KAAK,WAAWA,CAAC,EAAE,OAAO89D,EAAqB,MAAS,EAC/B,KAAK,kBAAoBF,EAE9C,MAAO,GAGf,MAAO,EACnB,CA0CQ,MAAO,EACV,CAED,qBAAsB,CAClB,MAAMI,EAAmB,KAAK,WAAW,KAAK,WAAW,OAAS,CAAC,EAI7DC,EAAgB,GAChBC,EAA0BrP,GAAU,UAAU,kBACpD,QAAS7uD,EAAI,EAAGsK,EAAI,KAAK,WAAW,OAAQtK,EAAIsK,EAAGtK,IAC3C,KAAK,WAAWA,CAAC,EAAE,oBAAsBk+D,GACzC,KAAK,WAAWl+D,CAAC,EAAE,kBAAkBi+D,CAAa,EAI1D,MAAME,EAA6BtP,GAAU,UAAU,qBACvD,QAAS7uD,EAAI,EAAGsK,EAAI,KAAK,WAAW,OAAQtK,EAAIsK,EAAGtK,IAC3C,KAAK,WAAWA,CAAC,EAAE,uBAAyBm+D,GAC5C,KAAK,WAAWn+D,CAAC,EAAE,qBAAqBi+D,EAAe,KAAK,oBAAqBD,CAAgB,EAIzG,KAAK,oBAAsBC,CAC9B,CAED,qBAAqBzuD,EAAU4uD,EAAcC,EAASC,EAAa,CAElE,CAED,gBAAiB,CACb,MAAMjmC,EAAO,CAAC,IAAI,EAClB,IAAIz0B,EAAU,KACd,EAAG,CACC,MAAM26D,EAAY36D,EAAQ,cAC1B,GAAI,CAAC26D,GAAcA,IAAc36D,EAE7B,MAIJ,IAAIs/C,EAAMqb,EAAU,QACpB,GAAIrb,IAAQt/C,EACRy0B,EAAK,KAAKkmC,CAAS,MAChB,CAEH,MAAMC,EAAW,CAACD,CAAS,EAC3B,GACSrb,GACDt/C,EAAQ,YAAY,kFAAoF26D,EAAU,kBAAiB,EAAK,GAAG,EAE/IC,EAAS,KAAKtb,CAAG,EACjBA,EAAMA,EAAI,cACLA,IAAQt/C,GAGjB,QAAS5D,EAAI,EAAGsK,EAAIk0D,EAAS,OAAQx+D,EAAIsK,EAAGtK,IACxCq4B,EAAK,KAAKmmC,EAASl0D,EAAItK,EAAI,CAAC,CAAC,CAEpC,CAED4D,EAAU26D,CACb,OAAQ,IAET,OAAOlmC,CACV,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAKD,kBAAkBomC,KAAW/uC,EAAM,CAC/B,MAAM2I,EAAO,KAAK,UACZ/tB,EAAI+tB,EAAK,OAGf,QAASr4B,EAAI,EAAGA,EAAIsK,EAAGtK,IAAK,CACxB,MAAMlB,EAAQu5B,EAAKr4B,CAAC,EAAE,8BAA8By+D,CAAM,EAC1D,GAAI3/D,IAAU,QACUu5B,EAAKr4B,CAAC,EAAElB,CAAK,EAAE,GAAG4wB,CAAI,IACtB,GAChB,MAAO,EAGlB,CAED,MAAO,EACV,CAKD,mBAAmB+uC,KAAW/uC,EAAM,CAChC,MAAM2I,EAAO,KAAK,UACZ/tB,EAAI+tB,EAAK,OAGf,QAASr4B,EAAIsK,EAAI,EAAGtK,GAAK,EAAGA,IAAK,CAC7B,MAAMlB,EAAQu5B,EAAKr4B,CAAC,EAAE,8BAA8By+D,CAAM,EAC1D,GAAI3/D,IAAU,QACUu5B,EAAKr4B,CAAC,EAAElB,CAAK,EAAE,GAAG4wB,CAAI,IACtB,GAChB,MAAO,EAGlB,CAED,MAAO,EACV,CAED,gBAAgBzwB,EAAG,CACf,MAAM+wB,EAAM/wB,EACNyH,EAAM,KAAK,SAASzH,EAAE,OAAO,EAC7Bo5B,EAAO,KAAK,UAElB,IAAIrrB,EAKJ,GAJItG,IACAsG,EAAO,MAAM,QAAQtG,CAAG,EAAIA,EAAM,CAACA,CAAG,GAGtCsG,EACA,QAAShN,EAAI,EAAGsK,EAAI0C,EAAK,OAAQhN,EAAIsK,EAAGtK,IAAK,CACzC,MAAM0+D,EAAW,KAAK,iBAAiB,IAAI1xD,EAAKhN,CAAC,CAAC,EAElD,GAAIq4B,EAAKA,EAAK,OAAS,CAAC,EAAE,WAAaqmC,EACnC,OAGC,KAAK,MAAM,YAAY,kBAAkB,CAAC,WAAW,OAAA1xD,EAAKhN,CAAC,GAAK,aAAa,EAAGgwB,CAAG,GACpF,KAAK,MAAM,YAAY,mBAAmB,CAAC,UAAU,OAAAhjB,EAAKhN,CAAC,GAAK,YAAY,EAAGgwB,CAAG,CAEzF,MAEI,KAAK,MAAM,YAAY,kBAAkB,CAAC,aAAa,EAAGA,CAAG,GAC9D,KAAK,MAAM,YAAY,mBAAmB,CAAC,YAAY,EAAGA,CAAG,EAIrE,KAAK,gBAAe,EAEpB,MAAM2uC,EAAWtmC,EAAKA,EAAK,OAAS,CAAC,EAErC,GAAIrrB,GAAQ2xD,EAAS,UACjB,QAAS3+D,EAAI,EAAGsK,EAAI0C,EAAK,OAAQhN,EAAIsK,EAAGtK,IACpC,KAAK,qBAAqBgN,EAAKhN,CAAC,EAAG2+D,CAAQ,CAGtD,CAUD,cAAc1/D,EAAG,CACb,MAAM+wB,EAAM/wB,EACNyH,EAAM,KAAK,SAASzH,EAAE,OAAO,EAEnC,IAAI+N,EAKJ,GAJItG,IACAsG,EAAO,MAAM,QAAQtG,CAAG,EAAIA,EAAM,CAACA,CAAG,GAGtCsG,EACA,QAAShN,EAAI,EAAGsK,EAAI0C,EAAK,OAAQhN,EAAIsK,EAAGtK,IAC/B,KAAK,MAAM,YAAY,kBAAkB,CAAC,WAAW,OAAAgN,EAAKhN,CAAC,EAAC,WAAW,oBAAoB,EAAGgwB,CAAG,GAClG,KAAK,MAAM,YAAY,mBAAmB,CAAC,UAAU,OAAAhjB,EAAKhN,CAAC,EAAC,WAAW,mBAAmB,EAAGgwB,CAAG,OAInG,KAAK,MAAM,YAAY,kBAAkB,CAAC,oBAAoB,EAAGA,CAAG,GACrE,KAAK,MAAM,YAAY,mBAAmB,CAAC,mBAAmB,EAAGA,CAAG,EAM5E,GAFA,KAAK,gBAAe,EAEhBhjB,EACA,QAAShN,EAAI,EAAGsK,EAAI0C,EAAK,OAAQhN,EAAIsK,EAAGtK,IAChC,KAAK,iBAAiB,IAAIgN,EAAKhN,CAAC,CAAC,IAEjC,aAAa,KAAK,iBAAiB,IAAIgN,EAAKhN,CAAC,CAAC,CAAC,EAE/C,KAAK,iBAAiB,OAAOgN,EAAKhN,CAAC,CAAC,EAInD,CAwBD,qBAAqB0G,EAAK+vB,EAAS,CAC/B,MAAMjH,EAASiH,EAAQ,UACjBzvB,EAASN,EAAI,cAEnB,GAAI8oB,EAAOxoB,CAAM,EAAG,CAChB,MAAM43D,EAAUpvC,EAAOxoB,CAAM,EACxBiyC,EAAM,SAAS2lB,CAAO,EAGvB,KAAK,iBAAiB,IAAIl4D,EAAK,WAAW,IAAM,CACvC,KAAK,MAAM,YAAY,kBAAkB,CAAC,WAAW,OAAAA,EAAG,QAAQ,aAAa,EAAG,CAAE,IACnF,KAAK,MAAM,YAAY,mBAAmB,CAAC,UAAU,OAAAA,EAAG,QAAQ,YAAY,EAAG,CAAE,GAGrF,KAAK,iBAAiB,OAAOA,CAAG,CACpD,EAAmBk4D,GAAW,GAAG,CAAmB,EARpCnoC,EAAQ,YAAY,6CAA6C,CAUxE,CAEJ,CAED,oBAAoBx3B,EAAG,CACnB,MAAM+wB,EAAM/wB,EACN,CAAE,QAAA4/D,EAAS,QAAAC,CAAS,EAAG9uC,EAEzB6uC,GAAW,KAAK,MAAM,GAAKC,GAAW,KAAK,MAAM,IAC5C,KAAK,8BAA8B,iBAAkB9uC,CAAG,GACzD,KAAK,+BAA+B,gBAAiBA,CAAG,EAGnE,CAED,8BAA8BlxB,EAAOkxB,EAAK,CACtC,IAAIjnB,EAAW,KAAK,MAAM,YAAY,SAClCg2D,EAAW,KAAK,cAAc,CAAE,EAAEh2D,CAAQ,EAAE,UAC5CuB,EAAIy0D,EAAS,OAEjB,KAAOz0D,KAAK,CACR,MAAM+D,EAAQ0wD,EAASz0D,CAAC,EACxB,GAAI+D,GAASA,EAAMvP,CAAK,EACpB,OAAAuP,EAAM,eAAe2hB,CAAG,EACjB,EAEd,CACD,MAAO,EACV,CAED,+BAA+BlxB,EAAOkxB,EAAK,CACvC,KAAM,CAAE,QAAA6uC,EAAS,QAAAC,CAAS,EAAG9uC,EAE7B,IAAI3hB,EADW,KAAK,gBAAgBwwD,EAASC,CAAO,EAIpD,KAAOzwD,IAAU,MAAM,CACnB,GAAIA,GAASA,EAAMvP,CAAK,EACpB,OAAAuP,EAAM,cAAc2hB,CAAG,EAChB,GAEX3hB,EAAQA,EAAM,MACjB,CACD,MAAO,EACV,CAED,cAAcpP,EAAG,CACb,MAAM+wB,EAAM/wB,EACN,CAAE,QAAA4/D,EAAS,QAAAC,CAAS,EAAG9uC,EAEzB6uC,GAAW,KAAK,MAAM,GAAKC,GAAW,KAAK,MAAM,GACjD,KAAK,MAAM,YAAY,yBAAyB9uC,CAAG,CAE1D,CAED,yBAAyBA,EAAK,CAC1B,KAAM,CAAE,QAAA6uC,EAAS,QAAAC,CAAS,EAAG9uC,EACvB/iB,EAAS,KAAK,gBAAgB4xD,EAASC,CAAO,EAC9C12C,EAAY,KAAK,MAAM,mBAAkB,EAAK,KAAK,MAAM,UAAU,kBAAkB,EAC3F,IAAI/Z,EAAQpB,EAGZ,KAAOoB,IAAU,MAAM,CACnB,GAAIA,GAASA,EAAM,aAAiB,CAChC,KAAM,CAAE,GAAAqyC,EAAI,GAAAC,CAAE,EAAKtyC,EAAM,KAAK,cACxBykD,EAAKpS,EAAKt4B,EACV2qC,EAAKpS,EAAKv4B,EAEV42C,EAAc,CAChB,EAAGH,EAAU/L,EACb,EAAGgM,EAAU/L,CAChB,EAGD,GADoB1kD,EAAM,aAAapB,EAAQ+xD,CAAW,IACtC,GAChB,KAEP,CACD3wD,EAAQA,EAAM,MACjB,CACJ,CAED,cAAcpP,EAAG,CACb,MAAM+wB,EAAM/wB,EACN,CAAE,QAAA4/D,EAAS,QAAAC,CAAS,EAAG9uC,EAEzB6uC,GAAW,KAAK,MAAM,GAAKC,GAAW,KAAK,MAAM,GACjD,KAAK,MAAM,YAAY,yBAAyB9uC,CAAG,CAE1D,CAED,yBAAyBA,EAAK,CAC1B,KAAM,CAAE,QAAA6uC,EAAS,QAAAC,CAAS,EAAG9uC,EACvB/iB,EAAS,KAAK,gBAAgB4xD,EAASC,CAAO,EAGpD,GAAI7xD,IAAW,KAAK,eAAgB,CAEhC,IAAIgyD,EAAgB,IAAI,IACpBC,EAAmB,IAAI,IAM3B,GAJIjyD,IACAiyD,EAAmB,IAAI,IAAIjyD,EAAO,aAAc,IAGhD,KAAK,eAAgB,CACrBgyD,EAAgB,IAAI,IAAI,KAAK,eAAe,aAAc,GAC1D,UAAWE,IAAQ,CAAC,GAAGF,CAAa,EAAE,OAAQhgE,GAAM,CAACigE,EAAiB,IAAIjgE,CAAC,CAAC,EAAG,CAC3E,MAAM,EAAI4vD,GAAU,aAAasQ,CAAI,EACjC,EAAE,gBACF,EAAE,eAAeA,CAAI,EAErBA,EAAK,QAAUA,EAAK,OAAO,SAC3B,KAAK,MAAM,YAAY,MAAM,OAASA,EAAK,OAAO,OAEzD,CACJ,CAED,KAAK,eAAiBlyD,EAEtB,MAAMmyD,EAAa,CAAC,GAAGF,CAAgB,EAAE,OAAQjgE,GAAM,CAACggE,EAAc,IAAIhgE,CAAC,CAAC,EAC5E,UAAWkgE,KAAQC,EAAY,CAC3B,MAAM,EAAIvQ,GAAU,aAAasQ,CAAI,EACjC,EAAE,cACF,EAAE,aAAaA,CAAI,CAE1B,CAGD,MAAME,EAAcD,EAAW,CAAC,EAOhC,GANIC,GAAeA,EAAY,SAC3B,KAAK,MAAM,UAAW,EAAC,MAAM,OAASA,EAAY,QAKlDD,EAAW,SAAW,GAAKnyD,EAAQ,CACnC,MAAMvI,EAAImqD,GAAU,aAAa5hD,CAAM,EACnCvI,EAAE,cACFA,EAAE,aAAauI,CAAM,CAE5B,CACJ,CACJ,CAED,gBAAgB4xD,EAASC,EAAS,CAC9B,IAAI/1D,EAAW,KAAK,MAAM,YAAY,SAClCg2D,EAAW,KAAK,cAAc,CAAE,EAAEh2D,CAAQ,EAC1Cu2D,EAAoB,KAAK,sBAAsBP,EAAUF,EAASC,CAAO,EAa7E,OAXAQ,EAAkB,KAAK,CAACj9D,EAAGC,IAEnBD,EAAE,OAASC,EAAE,OACN,EACAD,EAAE,OAASC,EAAE,OACb,GAEAD,EAAE,GAAKC,EAAE,GAAK,EAAI,EAEhC,EAEGg9D,EAAkB,OAEXA,EAAkB,MAAM,EAAE,EAAE,CAAC,EAE7B,IAEd,CAED,cAAcC,EAAQx2D,EAAU,CAC5B,IAAIuB,EAAIvB,EAAS,OACjB,KAAOuB,KAAK,CACR,MAAM+D,EAAQtF,EAASuB,CAAC,EAEpB+D,EAAM,UAAYA,EAAM,YACpBA,EAAM,YAAc,IACpBkxD,EAAO,KAAKlxD,CAAK,EAEjBA,EAAM,eACN,KAAK,cAAckxD,EAAQlxD,EAAM,QAAQ,EAGpD,CACD,OAAOkxD,CACV,CAED,sBAAsBC,EAAkBC,EAASC,EAAS,CACtD,IAAIp1D,EAAIk1D,EAAiB,OACzB,MAAMG,EAAa,GAInB,KAAOr1D,KAAK,CACR,MAAM+D,EAAQmxD,EAAiBl1D,CAAC,EAC1B8d,EAAY,KAAK,MAAM,mBAAkB,EAAK,KAAK,MAAM,UAAU,kBAAkB,EACrFinC,EAAMhhD,EAAM,KAAK,cAEjBykD,EAAKzD,EAAI,GAAKjnC,EACd2qC,EAAK1D,EAAI,GAAKjnC,EACdw3C,EAAKvxD,EAAM,OAASghD,EAAI,GAAKjnC,EAC7By3C,EAAKxxD,EAAM,OAASghD,EAAI,GAAKjnC,EAEnC,GAAI,EAAA0qC,EAAK,KAAK,MAAM,GAAKC,EAAK,KAAK,MAAM,GAIzC,IAAI1kD,EAAM,OAAO,KAAK,SAAU,CAC5B,MAAMqiD,EAAUriD,EAAM,OAAO,KAAK,SAAS,IAAKjJ,GAAMA,EAAIgjB,CAAS,EACnE,GAAI,CAAC,KAAK,eAAeq3C,EAASC,EAAS,GAAGhP,CAAO,EACjD,QACP,CAEG,KAAK,eAAe+O,EAASC,EAAS5M,EAAIC,EAAI6M,EAAIC,CAAE,GACpDF,EAAW,KAAKtxD,CAAK,EAE5B,CACD,OAAOsxD,CACV,CAED,eAAejf,EAAIC,EAAImS,EAAIC,EAAI6M,EAAIC,EAAI,CACnC,OAAInf,GAAMoS,GACNpS,GAAMoS,EAAK8M,GACXjf,GAAMoS,GACNpS,GAAMoS,EAAK8M,CAIlB,CAED,SAAU,CACD,KAAK,aACN,KAAK,SAAQ,EACb,KAAK,MAAM,UACX,KAAK,WAAa,GAEzB,CAED,UAAW,CAMP,GAJA,KAAK,MAAM,eAAe,MAAS,EACnC,KAAK,oBAAmB,EACxB,KAAK,mBAAkB,EAEnB,KAAK,iBAAiB,KAAM,CAC5B,UAAWC,KAAS,KAAK,iBAAiB,OAAM,EAC5C,aAAaA,CAAK,EAGtB,KAAK,iBAAiB,OACzB,CACJ,CAED,WAAY,CACR,OAAO,KAAK,MAAM,WACrB,CAEL,CCrpBe,MAAMC,WAA4B7gD,EAAQ,CAErD,YAAYvI,EAAO,CACf,MAAMA,CAAK,EACX,KAAK,SAAW,OAChB,KAAK,UAAY,MACpB,CAED,IAAI,QAAQ,CAAC,QAAAorB,EAAS,SAAAmiB,EAAW,MAAS,EAAG,CACzC,KAAK,SAAWniB,EAChB,KAAK,UAAYmiB,EACjB,KAAK,SAAQ,CAChB,CAED,aAAc,CACV,MAAO,CAAC,CAAC,KAAK,QACjB,CAED,cAAe,CACX,OAAO,KAAK,SACf,CAED,kBAAmB,CACf,MAAM5F,EAAI,KAAK,SACf,OAAQqB,GACGrB,EAAE,CAAC13C,EAAKsJ,IAAW,CACtB,GAAItJ,EACA,OAAO+4C,EAAG/4C,CAAG,EAEjB+4C,EAAG,KAAM,KAAK,MAAM,SAAS,kCAAkCzvC,CAAM,CAAC,CACtF,EAAe,KAAK,KAAK,CAEpB,CAEL,CChCe,MAAM8vD,EAAM,CAEvB,OAAO,iBAAiBC,EAAe/b,EAAU,CAC7C,MAAO,CAAC,KAAM6b,GAAqB,QAAS,CAAC,QAASE,EAAe,SAAU/b,CAAQ,CAAC,CAC3F,CAED,OAAO,aAAa37B,EAAGC,EAAGyJ,EAAQiuC,EAAaC,EAAaC,EAAMC,EAAW,CACpE,MAAM,QAAQpuC,CAAM,IAErBA,EAAS,CAACA,EAAQA,EAAQA,EAAQA,CAAM,GAG5C,IAAI8P,EAAU,CAAC4d,EAAIhpC,IAAU,CACrBsiC,EAAM,QACNtiC,EAAM,SAAS,gBAAgBgpC,EAAIhpC,EAAO4R,EAAGC,EAAGyJ,EAAQiuC,EAAaC,EAAaC,EAAMC,CAAS,EAEjG1gB,EAAG,KAAM,KAAK,gBAAgBhpC,EAAO4R,EAAGC,EAAGyJ,EAAQiuC,EAAaC,EAAaC,EAAMC,CAAS,CAAC,CAE7G,EACYz3D,EAAK,OAAS,CAAC2f,EAAGC,EAAG03C,EAAaC,EAAaC,EAAO,EAAI,EAAGC,CAAS,EAAE,OAAOpuC,CAAM,EAAE,KAAK,GAAG,EACnG,OAAO+tC,GAAM,iBAAiBj+B,EAASn5B,CAAE,CAC5C,CAED,OAAO,gBAAgB+N,EAAO4R,EAAGC,EAAGyJ,EAAQiuC,EAAaC,EAAaC,EAAMC,EAAW,CAC/ED,IAAS,SAAWA,EAAO,IAC3BF,IAAgB,SAAWA,EAAc,GAE7C,IAAIhwD,EAASyG,EAAM,SAAS,iBAAgB,EACxC04C,EAAMn/C,EAAO,WAAW,IAAI,EAChCm/C,EAAI,sBAAwB,GAE5Bn/C,EAAO,MAAQqY,EAAI23C,EAAc,EACjChwD,EAAO,OAASsY,EAAI03C,EAAc,EAElC7Q,EAAI,UAAS,EACb,IAAIt5C,EAAI,GAAMmqD,EAAc,EAAGlqD,EAAI,GAAMkqD,EAAc,EAEvD,OAAA7Q,EAAI,OAAOt5C,EAAIkc,EAAO,CAAC,EAAGjc,CAAC,EAC3Bq5C,EAAI,OAAOt5C,EAAIwS,EAAI0J,EAAO,CAAC,EAAGjc,CAAC,EAC/Bq5C,EAAI,MAAMt5C,EAAIwS,EAAGvS,EAAGD,EAAIwS,EAAGvS,EAAIic,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EACnDo9B,EAAI,OAAOt5C,EAAIwS,EAAGvS,EAAIwS,EAAIyJ,EAAO,CAAC,CAAC,EACnCo9B,EAAI,MAAMt5C,EAAIwS,EAAGvS,EAAIwS,EAAGzS,EAAIwS,EAAI0J,EAAO,CAAC,EAAGjc,EAAIwS,EAAGyJ,EAAO,CAAC,CAAC,EAC3Do9B,EAAI,OAAOt5C,EAAIkc,EAAO,CAAC,EAAGjc,EAAIwS,CAAC,EAC/B6mC,EAAI,MAAMt5C,EAAGC,EAAIwS,EAAGzS,EAAGC,EAAIwS,EAAIyJ,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EACnDo9B,EAAI,OAAOt5C,EAAGC,EAAIic,EAAO,CAAC,CAAC,EAC3Bo9B,EAAI,MAAMt5C,EAAGC,EAAGD,EAAIkc,EAAO,CAAC,EAAGjc,EAAGic,EAAO,CAAC,CAAC,EAC3Co9B,EAAI,UAAS,EAET+Q,IACInnB,EAAM,SAASonB,CAAS,EACxBhR,EAAI,UAAYjY,EAAW,cAAcipB,CAAS,EAElDhR,EAAI,UAAY,QAEpBA,EAAI,KAAI,GAGR6Q,IACIjnB,EAAM,SAASknB,CAAW,EAC1B9Q,EAAI,YAAcjY,EAAW,cAAc+oB,CAAW,EAEtD9Q,EAAI,YAAc,QAEtBA,EAAI,UAAY6Q,EAChB7Q,EAAI,OAAM,GAGPn/C,CACV,CAED,OAAO,cAAcqY,EAAGC,EAAGyJ,EAAS,EAAGquC,EAAO,EAAGC,EAASD,EAAO,EAAG,CAC3D,MAAM,QAAQruC,CAAM,IAErBA,EAAS,CAACA,EAAQA,EAAQA,EAAQA,CAAM,GAG5C,IAAI8P,EAAU,CAAC4d,EAAIhpC,IAAU,CACrBsiC,EAAM,QACNtiC,EAAM,SAAS,iBAAiBgpC,EAAIhpC,EAAO4R,EAAGC,EAAGyJ,EAAQquC,EAAMC,CAAM,EAErE5gB,EAAG,KAAM,KAAK,iBAAiBhpC,EAAO4R,EAAGC,EAAGyJ,EAAQquC,EAAMC,CAAM,CAAC,CAEjF,EACY33D,EAAK,SAAW,CAAC2f,EAAGC,EAAG83C,EAAMC,CAAM,EAAE,OAAOtuC,CAAM,EAAE,KAAK,GAAG,EAChE,OAAO+tC,GAAM,iBAAiBj+B,EAASn5B,CAAE,CAC5C,CAED,OAAO,iBAAiB+N,EAAO4R,EAAGC,EAAGyJ,EAAQquC,EAAMC,EAAQ,CACvD,IAAIrwD,EAASyG,EAAM,SAAS,iBAAgB,EACxC04C,EAAMn/C,EAAO,WAAW,IAAI,EAChCm/C,EAAI,sBAAwB,GAE5Bn/C,EAAO,MAAQqY,EAAIg4C,EAAS,EAC5BrwD,EAAO,OAASsY,EAAI+3C,EAAS,EAG7BlR,EAAI,YAAc,IAClBA,EAAI,SAAS,EAAG,EAAG,IAAM,GAAI,EAC7BA,EAAI,YAAc,EAElBA,EAAI,YAAcjY,EAAW,cAAc,UAAU,EACrDiY,EAAI,UAAYjY,EAAW,cAAc,UAAU,EACnDiY,EAAI,WAAaiR,EACjBjR,EAAI,cAAiB9mC,EAAI,GAAMg4C,EAC/BlR,EAAI,cAAgBkR,EAEpBlR,EAAI,UAAS,EACb,MAAMt5C,EAAI,EAAEwS,EAAI,IACVvS,EAAI,EAEV,OAAAq5C,EAAI,OAAOt5C,EAAIkc,EAAO,CAAC,EAAGjc,CAAC,EAC3Bq5C,EAAI,OAAOt5C,EAAIwS,EAAI0J,EAAO,CAAC,EAAGjc,CAAC,EAC/Bq5C,EAAI,MAAMt5C,EAAIwS,EAAGvS,EAAGD,EAAIwS,EAAGvS,EAAIic,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EACnDo9B,EAAI,OAAOt5C,EAAIwS,EAAGvS,EAAIwS,EAAIyJ,EAAO,CAAC,CAAC,EACnCo9B,EAAI,MAAMt5C,EAAIwS,EAAGvS,EAAIwS,EAAGzS,EAAIwS,EAAI0J,EAAO,CAAC,EAAGjc,EAAIwS,EAAGyJ,EAAO,CAAC,CAAC,EAC3Do9B,EAAI,OAAOt5C,EAAIkc,EAAO,CAAC,EAAGjc,EAAIwS,CAAC,EAC/B6mC,EAAI,MAAMt5C,EAAGC,EAAIwS,EAAGzS,EAAGC,EAAIwS,EAAIyJ,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EACnDo9B,EAAI,OAAOt5C,EAAGC,EAAIic,EAAO,CAAC,CAAC,EAC3Bo9B,EAAI,MAAMt5C,EAAGC,EAAGD,EAAIkc,EAAO,CAAC,EAAGjc,EAAGic,EAAO,CAAC,CAAC,EAC3Co9B,EAAI,UAAS,EACbA,EAAI,KAAI,EAEDn/C,CACV,CAED,OAAO,cAAcvP,EAAK4nB,EAAGC,EAAG,CAC5B,IAAIuZ,EAAU,CAAC4d,EAAIhpC,IAAU,CACrBsiC,EAAM,QACNtiC,EAAM,SAAS,UAAUgpC,EAAIhpC,EAAOhW,EAAK4nB,EAAGC,CAAC,EAE7C,KAAK,UAAUm3B,EAAIhpC,EAAOhW,EAAK4nB,EAAGC,CAAC,CAEnD,EACY5f,EAAK,MAAQ,CAAC2f,EAAGC,EAAG7nB,CAAG,EAAE,KAAK,GAAG,EACrC,OAAOq/D,GAAM,iBAAiBj+B,EAASn5B,CAAE,CAC5C,CAED,OAAO,UAAU+2C,EAAIhpC,EAAOhW,EAAK4nB,EAAGC,EAAG,CACnC,IAAItY,EAASyG,EAAM,SAAS,iBAAgB,EACxC04C,EAAMn/C,EAAO,WAAW,IAAI,EAChCm/C,EAAI,sBAAwB,GAE5B,IAAIjnB,EAAM,IAAI,MACdA,EAAI,OAAS,IAAM,CACfl4B,EAAO,MAAQqY,EACfrY,EAAO,OAASsY,EAChB6mC,EAAI,UAAUjnB,EAAK,EAAG,EAAGl4B,EAAO,MAAOA,EAAO,MAAM,EACpDyvC,EAAG,KAAMzvC,CAAM,CAClB,EACDk4B,EAAI,QAAWxhC,GAAQ,CACnB+4C,EAAG/4C,CAAG,CACT,EAIIqyC,EAAM,QACP7Q,EAAI,YAAc,aAGtBA,EAAI,IAAMznC,CACb,CAEL,CCpKe,MAAM6/D,EAAU,CAE3B,OAAO,KAAKliB,EAAG,CACX,OAAOrF,EAAM,WAAWqF,CAAC,GAAKA,EAAE,IACnC,CAED,OAAO,GAAGA,EAAG,CAET,OAAAA,EAAE,KAAO,GACFA,CACV,CAED,OAAO,MAAMj8C,EAAGC,EAAG,CACf,MAAMm+D,EAAM,OAAO,KAAKp+D,CAAC,EACnBq+D,EAAM,OAAO,KAAKp+D,CAAC,EAEzB,GAAI,CAACo+D,EAAI,OACL,OAAOr+D,EAIX,MAAMs+D,EAAK,GACLC,EAAK,GACX,QAAS5gE,EAAI,EAAGsK,EAAIo2D,EAAI,OAAQ1gE,EAAIsK,EAAGtK,IAAK,CACxC,MAAM0G,EAAMg6D,EAAI1gE,CAAC,EACjB2gE,EAAGj6D,CAAG,EAAI,GACVk6D,EAAGl6D,CAAG,EAAI1G,CACb,CACD,QAASA,EAAI,EAAGsK,EAAIm2D,EAAI,OAAQzgE,EAAIsK,EAAGtK,IAAK,CACxC,MAAM0G,EAAM+5D,EAAIzgE,CAAC,EACjB2gE,EAAGj6D,CAAG,EAAI1G,EACN4gE,EAAGl6D,CAAG,IAAM,SACZk6D,EAAGl6D,CAAG,EAAI,GAEjB,CAED,MAAMm6D,EAAOJ,EAAI,OAEXz4D,EAAS,GACf,QAAShI,EAAI,EAAGsK,EAAIo2D,EAAI,OAAQ1gE,EAAIsK,EAAGtK,IAAK,CACxC,MAAM0G,EAAMg6D,EAAI1gE,CAAC,EAGX8gE,EAASH,EAAGj6D,CAAG,EACrB,IAAIq6D,EAAWD,EACf,KAAM,EAAEC,GAAY,GAAG,CACnB,MAAMC,EAAOP,EAAIM,CAAQ,EACzB,GAAIH,EAAGI,CAAI,IAAM,GAGb,KAEP,CACD,KAAM,EAAED,EAAWD,GAAQ,CACvB,MAAME,EAAOP,EAAIM,CAAQ,EACzB/4D,EAAOg5D,CAAI,EAAI3+D,EAAE2+D,CAAI,CACxB,CAED,MAAMC,EAAK3+D,EAAEoE,CAAG,EACVw6D,EAAK7+D,EAAEqE,CAAG,EAChB,IAAIqV,EACA,KAAK,KAAKklD,CAAE,EACZllD,EAAIklD,EAAGC,CAAE,EAEL,CAACjoB,EAAM,gBAAgBioB,CAAE,GAAK,CAACjoB,EAAM,gBAAgBgoB,CAAE,EACvDllD,EAAIklD,EAEJllD,EAAIykD,GAAU,MAAMU,EAAID,CAAE,EAK9BllD,IAAM,SACN/T,EAAOtB,CAAG,EAAIqV,EAErB,CAGD,IAAIglD,EAAWF,EACf,KAAM,EAAEE,GAAY,GAAG,CACnB,MAAMC,EAAOP,EAAIM,CAAQ,EACzB,GAAIH,EAAGI,CAAI,IAAM,GACb,KAEP,CACD,KAAM,EAAED,EAAWF,GAAM,CACrB,MAAMG,EAAOP,EAAIM,CAAQ,EACzB/4D,EAAOg5D,CAAI,EAAI3+D,EAAE2+D,CAAI,CACxB,CAED,OAAOh5D,CACV,CAEL,CCzFe,MAAMm5D,WAAwBjZ,EAAW,CAEpD,YAAYj7C,EAAQ,CAChB,QACA,KAAK,QAAUA,CAClB,CAED,MAAMlB,EAAM3B,EAAO,CACf,KAAK,QAAQ,MAAM2B,EAAM3B,CAAK,CACjC,CAED,SAAS2B,EAAM3B,EAAO,CAClB,KAAK,QAAQ,SAASA,CAAK,CAC9B,CAED,OAAO2rB,EAASirB,EAAOC,EAAO,CAC1B,KAAK,QAAQ,YAAYA,CAAK,CACjC,CAED,MAAMl1C,EAAM3B,EAAO,CACf,KAAK,QAAQ,MAAM2B,EAAM3B,CAAK,CACjC,CAED,OAAO2B,EAAMm1C,EAAWC,EAAS,CAC7B,KAAK,QAAQ,MAAMp1C,EAAMo1C,CAAO,CACnC,CAED,WAAW0C,EAAQ,CACf,OAAO,KAAK,QAAQ,WAAWA,CAAM,CACxC,CAED,OAAOA,EAAQ,CACX,OAAO,KAAK,QAAQ,OAAOA,CAAM,CACpC,CAEL,CCnCe,MAAMud,WAA0BD,EAAgB,CAE3D,YAAYl0D,EAAQ+yB,EAAM,CACtB,MAAM/yB,CAAM,EACZ,KAAK,MAAQ+yB,CAChB,CAED,KAAKj0B,EAAM,CACP,IAAI03C,EAAU,KAAK,MAAM13C,CAAI,EAC7B,OAAAA,EAAK,SAAW03C,EACTA,CACV,CAED,MAAM13C,EAAM3B,EAAO,CACf2B,EAAO,KAAK,KAAKA,CAAI,EACrB,MAAM,MAAMA,EAAM3B,CAAK,CAC1B,CAED,SAAS2B,EAAM3B,EAAO,CAClB,MAAM,SAAS2B,EAAM3B,CAAK,CAC7B,CAED,OAAO2rB,EAASirB,EAAOC,EAAO,CAC1BD,EAAM,QAAQ3+C,GAAK,KAAK,KAAKA,CAAC,CAAC,EAC/B4+C,EAAQA,EAAM,IAAI5+C,GAAKA,EAAE,QAAQ,EACjC,MAAM,OAAO0zB,EAASirB,EAAOC,CAAK,CACrC,CAED,MAAMl1C,EAAM3B,EAAO,CACf2B,EAAO,KAAK,KAAKA,CAAI,EACrB,MAAM,MAAMA,EAAM3B,CAAK,CAC1B,CAED,OAAO2B,EAAMm1C,EAAWC,EAAS,CAC7B,MAAM,OAAOp1C,EAAMm1C,EAAWC,CAAO,CACxC,CAEL,CCzCe,MAAMzhC,WAAqBR,EAAQ,CAE9C,cAAe,CACX,MAAO,SACV,CAED,kBAAmB,CACf,MAAM7F,EAAK,KAAK,MAAM,GACtB,OAAO,SAASsmC,EAAI,CAChB,MAAM0hB,EAAQ,IAAI,WAAW,KAAa,EAC1C,QAASrhE,EAAI,EAAGA,EAAI,IAAM,IAAM,EAAGA,GAAG,EAAG,CACrC,MAAMoF,EAAI,KAAK,MAAM,KAAK,OAAM,EAAK,GAAG,EACxCi8D,EAAMrhE,CAAC,EAAIoF,EACXi8D,EAAMrhE,EAAE,CAAC,EAAIoF,EACbi8D,EAAMrhE,EAAE,CAAC,EAAIoF,EACbi8D,EAAMrhE,EAAE,CAAC,EAAI,GAChB,CACD,MAAM4nD,EAAY,CAAE,EAEhBvuC,IACAuuC,EAAUvuC,EAAG,cAAc,EAAIA,EAAG,OAClCuuC,EAAUvuC,EAAG,cAAc,EAAIA,EAAG,OAClCuuC,EAAUvuC,EAAG,kBAAkB,EAAIA,EAAG,QACtCuuC,EAAUvuC,EAAG,kBAAkB,EAAIA,EAAG,SAG1CsmC,EAAG,KAAM,CAAC,OAAQ0hB,EAAO,EAAG,IAAK,EAAG,IAAK,UAAWzZ,CAAS,CAAC,CACjE,CACJ,CAEL,CC9Be,MAAM0Z,WAAoBpiD,EAAQ,CAE7C,YAAYvI,EAAO,CACf,MAAMA,CAAK,EACX,KAAK,aAAe,OACpB,KAAK,OAAS,CACjB,CAED,IAAI,YAAYvR,EAAG,CACf,KAAK,aAAeA,EACpB,KAAK,SAAQ,CAChB,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAASA,EACd,KAAK,SAAQ,CAChB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,KAAKA,EAAG,CACR,GAAI,CAACA,EACD,KAAK,YAAc,WAChB,CACH,MAAMuF,EAAI,SAAS,cAAc,KAAK,EACtCA,EAAE,UAAY,QAAUvF,EAAI,SAC5B,KAAK,YAAcuF,EAAE,iBACxB,CACJ,CAED,IAAI,MAAO,CACP,OAAO,KAAK,aAAa,SAC5B,CAED,aAAc,CACV,OAAO,KAAK,WACf,CAED,cAAe,CACX,OAAO,KAAK,OAAS,IAAM,KAAK,aAAa,SAChD,CAED,kBAAmB,CACf,MAAM42D,EAAc,KAAK,aACnBl0B,EAAQ,KAAK,OACnB,OAAO,SAASsS,EAAI,CAChB,GAAI,CAAC,OAAO,YACR,OAAOA,EAAG,IAAI,MAAM,+DAA+D,CAAC,EAGxF,MAAM4C,EAAO+e,GAAY,iBACzB/e,EAAK,YAAYgf,CAAW,EAE5B,YAAYA,EAAa,CAAC,gBAAiB,KAAM,MAAOl0B,CAAK,CAAC,EAAE,KAAK,SAASn9B,EAAQ,CAElF,GADAqyC,EAAK,YAAYgf,CAAW,EACxBrxD,EAAO,SAAW,EAClB,OAAOyvC,EAAG,IAAI,MAAM,oBAAoB,CAAC,EAE7CA,EAAG,KAAM,CAAC,OAAQzvC,EAAQ,MAAOA,EAAO,MAAO,OAAQA,EAAO,MAAM,CAAC,CACrF,CAAa,EAAE,MAAMjR,GAAK,CACV,QAAQ,MAAM,cAAeA,CAAC,CAC9C,CAAa,CACJ,CACJ,CAED,OAAO,gBAAiB,CACpB,OAAK,KAAK,eAEN,KAAK,aAAe,SAAS,cAAc,KAAK,EAC5C,KAAK,aAAa,cAElB,KAAK,aAAa,aAAa,CAAC,KAAM,QAAQ,CAAC,EAEnD,KAAK,aAAa,MAAM,QAAU,EAClC,KAAK,aAAa,MAAM,cAAgB,OACxC,KAAK,aAAa,MAAM,SAAW,QACnC,KAAK,aAAa,MAAM,QAAU,QAClC,KAAK,aAAa,MAAM,IAAM,QAC9B,KAAK,aAAa,MAAM,SAAW,SACnC,SAAS,KAAK,YAAY,KAAK,YAAY,GAExC,KAAK,YACf,CACL,CCzFe,MAAMuiE,WAAsBtiD,EAAQ,CAE/C,YAAYvI,EAAOvS,EAAS,CACxB,MAAMuS,CAAK,EAEX,KAAK,SAAWvS,CACnB,CAED,IAAI,QAAQgB,EAAG,CACP,KAAK,WAAaA,IAClB,KAAK,SAAWA,EAChB,KAAK,SAAQ,EAEpB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,aAAc,CACV,MAAO,CAAC,CAAC,KAAK,QACjB,CAED,kBAAmB,CACf,OAAQu6C,GAAO,CACXA,EAAG,KAAM,KAAK,QAAQ,CACzB,CACJ,CACL,CC5Be,MAAM8hB,WAAsB5S,EAAU,CAEjD,YAAYl4C,EAAO,CACf,MAAMA,CAAK,EAEX,KAAK,SAAW,MAAM,UAAU,EAAE,CAAE,GAEpC,KAAK,uBAAyB,GAE9B,KAAK,cAAgB,IAAI,IAEzB,KAAK,OAAS,EAEd,KAAK,SAAW,GAMhB,KAAK,0BAA4B,KAAK,MAAM,YAAY,eAAe,EAAE,EAKzE,KAAK,UAAY,IAEjB,KAAK,sBAAwB,EAE7B,KAAK,kBAAoB,EAKzB,KAAK,MAAQ,GAKb,KAAK,SAAW,EAKhB,KAAK,SAAW,EAMhB,KAAK,mBAAqB,KAO1B,KAAK,iBAAmB,GAOxB,KAAK,YAAc,GAEnB,KAAK,SAAW,IAAI+qD,GAAU,IAAI,CACrC,CAED,sBAAuB,CACnB,MAAO,EACV,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,SAAS,KACxB,CAED,IAAI,MAAM34D,EAAU,CAChB,KAAK,SAAS,MAAMA,CAAQ,CAC/B,CAED,OAAQ,CACJ,KAAK,SAAS,WAAW,KAAK,SAAU,KAAK,yBAAyB,EACtE,KAAK,kBAAoB,KAAK,SAAS,WAAW,KAAK,QAAQ,EAC/D,KAAK,kBAAkB,GAAG,WAAYtC,GAAK,KAAK,OAAM,CAAE,EAExD,KAAK,SAAS,EAAG,GAAM,EAAI,EAE3B,KAAK,SAAW,GAEhB,KAAK,OAAM,CACd,CAED,SAAS2D,EAAOu3D,EAAY,GAAOC,EAAU,GAAO,CAChD,IAAIC,EAAY,KAAK,OACrB,GAAI,CAACA,EAAW,OAIhB,GAFA,KAAK,KAAK,UAAW,KAAK,WAAW,KAAK,SAAS,EAAG,KAAK,OAAQ,KAAK,SAAS,EAE7ED,EAAS,CAET,IAAI93C,EAASmvB,EAAM,eAAe7uC,EAAOy3D,CAAS,EAC9Cz5D,EAAI6wC,EAAM,eAAe,KAAK,MAAO4oB,CAAS,EAC9CC,EAAOh4C,EAAS1hB,EAChB05D,EAAO,GAAMD,EACbC,GAAQD,EACDC,EAAO,IAAOD,IACrBC,GAAQD,GAEZ,KAAK,QAAUC,CAC3B,MACY,KAAK,OAAS13D,GAGd,KAAK,OAAU,KAAK,aAAe,KAAK,UAAYy3D,KACpD,KAAK,OAAS5oB,EAAM,eAAe,KAAK,OAAQ4oB,CAAS,GAG7D,IAAIhwC,EAAa,KAAK,YAAc,KAAK,iBAAmB,GAAK,EAC7D1tB,EAAQ0tB,EAAY,KAAK,OAAS,KAAK,UAE3C,GAAI,KAAK,MAAO,CACZ,IAAIkwC,EAAKjK,EAAKkK,EACd,GAAInwC,GAAa,EACbimC,GAAO+J,EAAY,GAAK,KAAK,UAC7BG,EAAc,KAAK,sBAAwB,KAAK,aAAe,KAAK,kBAAoB,KAAK,UAE7FlK,GAAOkK,EAEPD,EAAM,KAAK,cAAgB,KAAK,UAAYC,GAExC,KAAK,WAAUD,GAAO,KAAK,UAC3B,KAAK,WAAUjK,GAAO,KAAK,UAE/B3zD,EAAQ,KAAK,IAAI,KAAK,IAAIA,EAAO2zD,CAAG,EAAGiK,CAAG,MACvC,CACHjK,EAAO+J,EAAY,KAAK,UAAY,KAAK,aACzCG,EAAc,KAAK,sBAAwB,KAAK,aAAe,KAAK,kBAAoB,KAAK,UAE7FlK,GAAOkK,EAEP,IAAID,EAAMC,EAEN,KAAK,WAAUD,GAAO,KAAK,UAC3B,KAAK,WAAUjK,GAAO,KAAK,UAE/B3zD,EAAQ,KAAK,IAAI,KAAK,IAAI,CAAC2zD,EAAK3zD,CAAK,EAAG,CAAC49D,CAAG,CAC/C,CACJ,CAED,KAAK,kBAAkB,MAAM59D,CAAK,EAE9Bw9D,GACA,KAAK,kBAAkB,SAG3B,KAAK,KAAK,QAAS,KAAK,WAAW,KAAK,SAAS,EAAG,KAAK,OAAQ,KAAK,SAAS,CAClF,CAED,iBAAkB,CACd,IAAI10D,EAAS,CAAC,KAAK,kBAAkB,aAGjC9I,EAAQ,EADK,KAAK,YAAc,KAAK,iBAAmB,GAAK,GACxC,KAAK,OAAS,KAAK,UAE5C,OAAO,KAAK,sBAAwB,KAAK,cAAgBA,EAAQ8I,EACpE,CAED,QAAS,CACL,GAAI,CAAC,KAAK,SAAU,OAEpB,IAAI40D,EAAY,KAAK,OACrB,GAAI,CAACA,EAAW,OAEhB,IAAIhwC,EAAa,KAAK,YAAc,KAAK,iBAAmB,GAAK,EAG7DzsB,EAAK,KAAK,YAAc,KAAK,SAAS,EAAI,KAAK,SAAS,EAExD68D,EAAe,KAAK,aACpBD,EAAc,KAAK,sBAAwBC,EAAe,KAAK,kBAAoB,KAAK,UAC5F78D,GAAK48D,EAEL,IAAI39D,EAAGpF,EAAGijE,EAAIC,EACVtwC,GAAa,IACbxtB,EAAI,KAAK,MAAM,CAACe,EAAI,KAAK,SAAS,EAClC88D,EAAK,GAAM,CAAC98D,EAAI,KAAK,UAAaf,GAClCpF,EAAI,KAAK,OAAOgjE,EAAe78D,GAAK,KAAK,SAAS,EAClD+8D,GAAQF,EAAe78D,GAAK,KAAK,UAAanG,IAE9CoF,EAAI,KAAK,KAAKe,EAAI,KAAK,SAAS,EAChC88D,EAAK,EAAK98D,EAAI,KAAK,UAAaf,EAChCpF,EAAI,KAAK,MAAMmG,EAAI68D,GAAgB,KAAK,SAAS,EACjDE,EAAKljE,GAAMmG,EAAI68D,GAAgB,KAAK,YAEpC,KAAK,OAAUA,EAAe,KAAK,UAAYJ,KAE3C5iE,GAAK4iE,IACL5iE,EAAI4iE,EAAY,EAChBM,EAAK,GAEL99D,GAAKw9D,IACLx9D,EAAIw9D,EAAY,EAChBK,EAAK,GAELjjE,GAAK,KACLA,EAAI,EACJkjE,EAAK,GAEL99D,GAAK,KACLA,EAAI,EACJ69D,EAAK,IAIb,IAAIp4C,EAAS,CAAC+H,EAAYxtB,EAAI,KAAK,UAE/B0H,EACJ,QAAS3B,EAAQ/F,EAAIwtB,GAAa,GAAKznB,GAASnL,EAAImL,GAASnL,EAAK4yB,GAAa,GAAKznB,IAAUA,IAAU,CACpG,IAAIg4D,EAAYnpB,EAAM,eAAe7uC,EAAOy3D,CAAS,EAEjDprC,EAAU,KAAK,WAAW2rC,CAAS,EACvCr2D,EAAO0qB,EAAQ,OACf,KAAK,cAAc,OAAO1qB,CAAI,EAC1B,KAAK,YACLA,EAAK,EAAI+d,EAASk4C,EAElBj2D,EAAK,EAAI+d,EAASk4C,EAGtB,IAAIK,EAAat2D,EAAK,QAUtB,GATAA,EAAK,QAAU,IAEX,CAACs2D,GAAc,KAAK,yBAEpB,KAAK,KAAK,UAAWj4D,EAAOg4D,CAAS,EAKrC,KAAK,mBAAoB,CACzB,IAAI37D,EAAI,EACJ2D,GAAS/F,EACToC,EAAIy7D,EACG93D,GAASnL,IAChBwH,EAAI07D,GAIR,KAAK,mBAAmB,MAAM1rC,EAAShwB,CAAC,CAC3C,CAEDqjB,GAAU,KAAK,SAClB,CAGD,IAAI86B,EAAO,KACX,KAAK,cAAc,QAAQ,SAAS0d,EAAe,CAC/CA,EAAc,QAAU,GACxB1d,EAAK,cAAc,OAAO0d,CAAa,CACnD,CAAS,EAED,QAASl4D,EAAQ/F,EAAIwtB,GAAa,GAAKznB,GAASnL,EAAImL,GAASnL,EAAK4yB,GAAa,GAAKznB,IAAUA,IAAU,CACpG,IAAIg4D,EAAYnpB,EAAM,eAAe7uC,EAAOy3D,CAAS,EACrD,KAAK,cAAc,IAAI,KAAK,WAAWO,CAAS,CAAC,CACpD,CAED,KAAK,uBAAyB,EACjC,CAED,aAAc,CACV,KAAK,SAAS,KAAK,OAAS,CAAC,CAChC,CAED,SAAU,CACN,KAAK,SAAS,KAAK,OAAS,CAAC,CAChC,CAED,WAAWh4D,EAAO,CACd,OAAO,KAAK,SAAS,SAASA,CAAK,CACtC,CAED,WAAWA,EAAO,CACd,IAAI,EAAI,KAAK,SAAS,SAASA,CAAK,EACpC,OAAO,EAAI,EAAE,SAAS,CAAC,EAAI,IAC9B,CAED,QAAS,CACL,KAAK,uBAAyB,GAC9B,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,IAAInL,EAAI,KAAK,SAAS,SAAS,KAAK,SAAS,EAC7C,OAAOA,EAAIA,EAAE,SAAS,CAAC,EAAI,IAC9B,CAED,IAAI,QAAS,CACT,OAAO,KAAK,SAAS,SAAS,MACjC,CAED,IAAI,UAAW,CACX,OAAO,KAAK,YAAc,IAAM,GACnC,CAED,IAAI,cAAe,CACf,OAAO,KAAK,YAAc,KAAK,EAAI,KAAK,CAC3C,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,WAAY,CACZ,OAAOg6C,EAAM,eAAe,KAAK,OAAQ,KAAK,MAAM,CACvD,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,SAAS7zC,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,OAAM,CACd,CAED,IAAI,sBAAuB,CACvB,OAAO,KAAK,qBACf,CAED,IAAI,qBAAqBA,EAAG,CACxB,KAAK,sBAAwBA,EAC7B,KAAK,OAAM,CACd,CAED,IAAI,kBAAmB,CACnB,OAAO,KAAK,iBACf,CAED,IAAI,iBAAiBA,EAAG,CACpB,KAAK,kBAAoBA,EACzB,KAAK,OAAM,CACd,CAED,IAAI,0BAA2B,CAC3B,OAAO,KAAK,yBACf,CAED,IAAI,yBAAyBA,EAAG,CAC5B,KAAK,0BAA0B,MAAMA,CAAC,CACzC,CAED,IAAI,iBAAiBA,EAAG,CACpB,KAAK,0BAA0B,MAAMA,CAAC,CACzC,CAED,IAAI,kBAAmB,CACnB,OAAO,KAAK,iBACf,CAED,IAAI,mBAAoB,CACpB,OAAO,KAAK,kBACf,CAED,IAAI,kBAAkBA,EAAG,CACjB6zC,EAAM,gBAAgB7zC,CAAC,EACvB,KAAK,mBAAqB,KAAK,MAAM,WAAW,eAAeA,CAAC,EAEhE,KAAK,mBAAqBA,EAE9B,KAAK,OAAM,CACd,CAED,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,IAAI,KAAKA,EAAG,CACR,KAAK,MAAQA,EACb,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,SAAWA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,SAAWA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,gBACf,CAED,IAAI,gBAAgBA,EAAG,CACd,KAAK,WACN,KAAK,iBAAmBA,EAE/B,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,WAAWA,EAAG,CACVA,IAAM,KAAK,cACN,KAAK,WACN,KAAK,YAAcA,GAG9B,CAEL,CAGA,MAAMs8D,WAAkBN,EAAkB,CACtC,YAAYv2D,EAAM,CACd,IAAIm1B,EAAQj0B,GAAQ,CAChB,IAAIiL,EAASjL,EAAK,MAAM,cAAa,EACrC,OAAAiL,EAAO,IAAIjL,CAAI,EACfiL,EAAO,QAAU,GACVA,CACnB,EAEQ,MAAMnM,EAAK,SAAS,UAAWm1B,CAAI,EACnC,KAAK,KAAOn1B,CACf,CAED,MAAMkB,EAAM3B,EAAO,CACf,MAAM,MAAM2B,EAAM3B,CAAK,EACvB,KAAK,aAAaA,CAAK,CAC1B,CAED,aAAaA,EAAO,CAChB,KAAK,KAAK,uBAAyB,GAC9B,KAAK,KAAK,UAGP,KAAK,KAAK,SAAW,EACrB,KAAK,KAAK,SAAS,EAAG,GAAM,EAAI,EAE5B,KAAK,KAAK,QAAU,KAAK,KAAK,QAC9B,KAAK,KAAK,SAAS,CAAC,EAG5B,KAAK,KAAK,UATV,KAAK,KAAK,OAWjB,CAED,SAAS2B,EAAM3B,EAAO,CAClB,MAAM,SAAS2B,EAAM3B,CAAK,EAC1B,IAAIm4D,EAAK,KAAK,KAAK,UACfA,IAAOn4D,GACHm4D,IAAO,KAAK,KAAK,QACjBA,IAEAA,GAAM,GACN,KAAK,KAAK,SAASA,CAAE,GAElBA,EAAKn4D,GACZ,KAAK,KAAK,SAASm4D,EAAK,CAAC,EAG7B,KAAK,KAAK,uBAAyB,EACtC,CAED,MAAMx2D,EAAM3B,EAAO,CACf,MAAM,MAAM2B,EAAM3B,CAAK,EACvB,KAAK,aAAaA,CAAK,CAC1B,CAED,OAAO2rB,EAASirB,EAAOC,EAAO,CAC1B,MAAM,OAAOlrB,EAASirB,EAAOC,CAAK,EAClC,KAAK,aAAa,CAAC,CACtB,CAED,IAAI,cAAe,CACf,MAAO,EACV,CAEL,CCzee,MAAMuhB,WAAyB9jD,CAAc,CAExD,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EAEb,KAAK,WAAa,IAAI,aAAa,CAAC,EAAG,CAAC,CAAC,EACzC,KAAK,cAAgB,CACxB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,WAAW,CAAC,CAC3B,CAED,IAAI,EAAE1D,EAAG,CACL,KAAK,WAAW,CAAC,EAAIA,EACrB,KAAK,OAAM,CACd,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,WAAW,CAAC,CAC3B,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,WAAW,CAAC,EAAIA,EACrB,KAAK,OAAM,CACd,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,IAAI,aAAaA,EAAG,CAChB,KAAK,cAAgBA,EACrB,KAAK,OAAM,CACd,CAGD,YAAa,CACT,OAAQ,KAAK,gBAAkB,CAClC,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,KAAK,YAAY,YAAa,KAAK,WAAY,KAAK,GAAG,UAAU,EACjE,KAAK,YAAY,eAAgB,KAAK,cAAe,KAAK,GAAG,SAAS,EAEtE,MAAM9oC,EAAI8oC,EAAU,iBACd7oC,EAAI6oC,EAAU,kBACpB,KAAK,YAAY,aAAc,IAAI,aAAa,CAAC9oC,EAAGC,CAAC,CAAC,EAAG,KAAK,GAAG,UAAU,CAC9E,CACL,CAEAg6C,GAAiB,qBAAuB,ioFCjDzB,MAAMC,WAAsB/jD,CAAc,CAErD,cAAc2yC,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,MAAM1Y,EAAK,EAAM0Y,EAAU,gBAAgB,CAAC,EACtCzQ,EAAK,EAAMyQ,EAAU,iBAAiB,CAAC,EAC7C,KAAK,YAAY,mBAAoB,IAAI,aAAa,CAAC1Y,EAAIiI,CAAE,CAAC,EAAG,KAAK,GAAG,UAAU,CACtF,CAEL,CAEA6hB,GAAc,mBAAqB,i+BA6BnCA,GAAc,qBAAuB,imBC3CtB,MAAMC,WAAmBhkD,EAAc,CAElD,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,cAAgB,CACxB,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,IAAI,aAAa1D,EAAG,CAChB,KAAK,cAAgBA,EACrB,KAAK,OAAM,CACd,CAED,YAAa,CACT,OAAO,KAAK,UAAY,CAC3B,CAED,cAAc,CAAC,OAAA6H,CAAM,EAAG,CACpBA,EAAO,IAAI,OAAS,QAAU,KAAK,cAAgB,KACtD,CAED,aAAa,CAAC,OAAAA,CAAM,EAAG,CACnBA,EAAO,IAAI,OAAS,MACvB,CAEL,CCtBe,MAAM01D,WAA0B9T,EAAU,CACrD,OAAO,WAAY,CACf,MAAO,CAAE,CACZ,CAED,IAAI,MAAO,CACP,OAAO,KAAK,IAAI,MAAM,CACzB,CAED,IAAI,QAAQzpD,EAAG,CACX,OAAO,KAAK,KAAK,QAAUA,CAC9B,CAED,IAAI,SAAU,CACV,OAAO,KAAK,KAAK,OACpB,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,KAAK,UAAYA,EACtB,KAAK,KAAK,UAAYA,EACtB,KAAK,KAAK,iBACb,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,KAAK,UAAYA,EACtB,KAAK,KAAK,iBACb,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,KAAK,UAAYA,EACtB,KAAK,KAAK,iBACb,CAED,IAAI,OAAOA,EAAG,CACV,OAAO,KAAK,KAAK,OAASA,CAC7B,CAED,IAAI,QAAS,CACT,OAAO,KAAK,KAAK,MACpB,CAED,WAAY,CACR,KAAK,KAAK,EAAI,KAAK,YACnB,KAAK,KAAK,EAAI,KAAK,YACtB,CAED,IAAI,cAAe,CACf,MAAO,EACV,CAED,QAAS,CACL,KAAK,MAAM,CACP,KAAM,CAAC,KAAM,KAAK,MAAM,GAAKw9D,GAAyBC,EAAoB,CACtF,CAAS,CACJ,CAEL,CAGA,MAAMA,WAA6BhU,EAAU,CAEzC,OAAO,WAAY,CACf,MAAO,CACH,mBAAoB,GACpB,IAAK,GACL,SAAU,CAAC,OAAQ,CAAC,KAAMiU,EAAa,EAAG,QAAS,EAAE,CACxD,CACJ,CAED,YAAYnsD,EAAO,CACf,MAAMA,CAAK,EACX,KAAK,UAAY,KAAK,IAAI,UAAU,EACpC,KAAK,SAAW,KAAK,IAAI,kBAAkB,EAE3C,KAAK,QAAU,EACf,KAAK,UAAY,EACjB,KAAK,UAAY,CAEpB,CAED,OAAO,WAAY,CACf,OAAK,KAAK,eACN,KAAK,aAAe,IAAI4kD,GACxB,KAAK,aAAa,MAAM,GAAO,CAAC,EAAG,EAAG,IAAM,IAAK,GAAK,IAAK,IAAM,GAAI,EAAG,EAAE,CAAC,GAExE,KAAK,YACf,CAED,IAAI,SAAU,CACV,OAAO,KAAK,IAAI,kBAAkB,CACrC,CAED,IAAI,QAAQn2D,EAAG,CACX,KAAK,IAAI,kBAAkB,EAAE,MAAMA,EAAG,EAAI,CAC7C,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,UAAYA,EACjB,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,iBAAkB,CACd,IAAImjB,EAAI,KAAK,YACTC,EAAI,KAAK,aAETu6C,EAAW,KAAK,UAChBC,EAAW,KAAK,UAEpB,KAAK,SAAS,EAAID,EAClB,KAAK,UAAU,EAAI,CAACA,EAEpB,KAAK,SAAS,EAAIC,EAClB,KAAK,UAAU,EAAI,CAACA,EAEpB,KAAK,UAAU,EAAIz6C,EAAIw6C,EAAW,EAClC,KAAK,UAAU,EAAIv6C,EAAIw6C,EAAW,CACrC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAOD,IAAI,OAAO59D,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,UAAU,OAAO,aAAey9D,GAAqB,sBAAsBz9D,CAAC,CACpF,CAED,OAAO,sBAAsBA,EAAG,CAC5B,OAAOy9D,GAAqB,UAAW,EAAC,SAAS,KAAK,IAAI,EAAGz9D,EAAI,GAAI,CAAC,CACzE,CAED,IAAI,cAAe,CACf,MAAO,EACV,CAEL,CAEA,MAAMw9D,WAA+B/T,EAAU,CAE3C,OAAO,WAAY,CACf,MAAMoU,EAAW,SAASxsC,EAASwpB,EAAa,CAC5C,GAAKA,EAAY,QAAW,IAAW,CACnC,MAAM13B,EAAI03B,EAAY,EAChBz3B,EAAIy3B,EAAY,EACtB,IAAIqN,EAAMrN,EACV,GACIqN,EAAMA,EAAI,UAAU,CAAC,EACrBA,EAAI,SAAS,EAAI/kC,EACjB+kC,EAAI,SAAS,EAAI9kC,QACb8kC,EAAI,UACf,CACb,EAEQ,MAAO,CACH,SAAU,CAAC,IAAK,GAAM,mBAAoB,GAAM,gBAAiB,GAAM,QAAS,EAAE,EAClF,OAAQ,CACJ,GAAI,CAAC,IAAK,GAAM,SAAU2V,EAAU,gBAAiB,GAAM,QAAS,GAAO,QAAS,CAAC,OAAQ,CAAC,KAAMR,EAAa,CAAC,CAAC,EACnH,GAAI,CAAC,IAAK,GAAM,SAAUQ,EAAU,gBAAiB,GAAM,QAAS,GAAO,QAAS,CAAC,OAAQ,CAAC,KAAMR,EAAa,CAAC,CAAC,EACnH,GAAI,CAAC,IAAK,GAAM,SAAUQ,EAAU,gBAAiB,GAAM,QAAS,GAAO,QAAS,CAAC,OAAQ,CAAC,KAAMR,EAAa,CAAC,CAAC,EACnH,GAAI,CAAC,IAAK,GAAM,SAAUQ,EAAU,gBAAiB,GAAM,QAAS,GAAO,QAAS,CAAC,OAAQ,CAAC,KAAMR,EAAa,CAAC,CAAC,CACtH,EACD,OAAQ,CAAC,OAAQ,CAAC,KAAMS,EAAoB,EAAG,QAAS,EAAK,CAChE,CACJ,CAED,IAAI,cAAe,CACf,MAAO,EACV,CAED,YAAYvsD,EAAO,CACf,MAAMA,CAAK,EACX,KAAK,UAAY,KAAK,IAAI,UAAU,EACpC,KAAK,SAAW,KAAK,IAAI,kBAAkB,EAC3C,KAAK,QAAU,KAAK,IAAI,QAAQ,EAChC,KAAK,QAAU,KAAK,IAAI,QAAQ,EAEhC,KAAK,QAAU,EACf,KAAK,UAAY,EACjB,KAAK,UAAY,CACpB,CAED,cAAe,CAEX,MAAMwsD,EADuB,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,aAAa,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,aAAa,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,EAAE,aAAa,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,IAAI,aAAa,CAAC,CAAC,EAC1F,IAAI9+D,GAC5B0/C,GAAO,OAAO,KAAK,MAAO,OAAO,OAAO,CAAC,KAAMye,EAAgB,EAAGn+D,CAAC,CAAC,CAEtF,EAED,KAAK,iBAAiB,KAAK,iBAAiB,CAAC,EAAG,KAAK,UAAU,aAAc,EAAE,EAC/E,KAAK,iBAAiB,KAAK,iBAAiB,CAAC,EAAG,KAAK,SAAS,CAAC,EAAE,WAAU,EAAI,CAAC8+D,EAAc,CAAC,EAAGA,EAAc,CAAC,CAAC,CAAC,EAGnH,KAAK,iBAAiB,KAAK,iBAAiB,CAAC,EAAG,KAAK,SAAS,CAAC,EAAE,WAAY,EAAE,CAACA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,CAAC,CAAC,EACvJ,KAAK,iBAAiB,KAAK,iBAAiB,CAAC,EAAG,KAAK,SAAS,CAAC,EAAE,WAAY,EAAE,CAACA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,CAAC,CAAC,CAC1J,CAED,iBAAiB1sC,EAASvnB,EAASk0D,EAAO,CACtC,GAAI,CAACA,EAAM,OACP3sC,EAAQ,QAAUvnB,MACf,CACH,MAAMm0D,EAAOD,EAAM,MACb/0D,EAAQooB,EAAQ,MAAM,EAAE,CAAC,IAAK,GAAM,OAAQ4sC,CAAI,CAAC,EAGvD,KAAK,iBAAiBh1D,EAAOa,EAASk0D,CAAK,EAE3C3sC,EAAQ,UAAU,IAAIpoB,CAAK,CAC9B,CACD,OAAOooB,CACV,CAED,IAAI,SAAU,CACV,OAAO,KAAK,IAAI,kBAAkB,CACrC,CAED,IAAI,QAAQrxB,EAAG,CACX,KAAK,IAAI,kBAAkB,EAAE,MAAMA,EAAG,EAAI,CAC7C,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,UAAYA,EACjB,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,SAASpF,EAAG,CACR,OAAO,KAAK,QAAQ,IAAI,IAAMA,CAAC,CAClC,CAED,iBAAiBA,EAAG,CAChB,OAAO,KAAK,SAASA,CAAC,EAAE,IAAI,SAAS,CACxC,CAED,WAAY,CACR,KAAK,gBAAe,CACvB,CAED,iBAAkB,CACd,IAAIuoB,EAAI,KAAK,YACTC,EAAI,KAAK,aAETu6C,EAAW,KAAK,UAChBC,EAAW,KAAK,UAEhBM,EAAK/6C,EAAIw6C,EAAW,EACpBQ,EAAK/6C,EAAIw6C,EAAW,EACxB,KAAK,UAAU,EAAIM,EACnB,KAAK,SAAS,EAAIP,EAClB,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIO,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,GACvD,KAAK,QAAQ,EAAI,CAACP,EAClB,KAAK,UAAU,EAAI,CAACA,EACpB,KAAK,QAAQ,EAAIO,EAEjB,KAAK,UAAU,EAAIC,EACnB,KAAK,SAAS,EAAIP,EAClB,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIO,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,GACvD,KAAK,QAAQ,EAAI,CAACP,EAClB,KAAK,UAAU,EAAI,CAACA,EACpB,KAAK,QAAQ,EAAIO,EAEjB,KAAK,EAAIh7C,EACT,KAAK,EAAIC,CACZ,CAOD,IAAI,OAAOpjB,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,QAAO,CACf,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,SAAU,CACN,IAAIA,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,OAAO,CAAC,EACzCA,IAAM,GACN,KAAK,UAAU,gBAAkB,GACjC,KAAK,QAAQ,OAAO,mBAAqB,KACzC,KAAK,QAAQ,QAAU,KAEvB,KAAK,UAAU,gBAAkB,GACjC,KAAK,QAAQ,QAAU,GAEvB,KAAK,SAAS,CAAC,EAAE,QAAWA,EAAI,EAChC,KAAK,SAAS,CAAC,EAAE,QAAWA,EAAI,EAChC,KAAK,SAAS,CAAC,EAAE,QAAWA,EAAI,EAChC,KAAK,SAAS,CAAC,EAAE,QAAWA,EAAI,EAE5BA,GAAK,GACL,KAAK,QAAQ,QAAU,KAAK,UAAU,WAAU,EAChD,KAAK,QAAQ,OAAO,mBAAqB,KAAK,SAAS,CAAC,EAAE,aAC1D,KAAK,QAAQ,OAAO,EAAIA,GACjBA,GAAK,GACZ,KAAK,QAAQ,QAAU,KAAK,SAAS,CAAC,EAAE,aACxC,KAAK,QAAQ,OAAO,mBAAqB,KAAK,SAAS,CAAC,EAAE,aAC1D,KAAK,QAAQ,OAAO,EAAIA,EAAI,GACrBA,GAAK,GACZ,KAAK,QAAQ,QAAU,KAAK,SAAS,CAAC,EAAE,aACxC,KAAK,QAAQ,OAAO,mBAAqB,KAAK,SAAS,CAAC,EAAE,aAC1D,KAAK,QAAQ,OAAO,EAAIA,EAAI,GACrBA,GAAK,IACZ,KAAK,QAAQ,QAAU,KAAK,SAAS,CAAC,EAAE,aACxC,KAAK,QAAQ,OAAO,mBAAqB,KAAK,SAAS,CAAC,EAAE,aAC1D,KAAK,QAAQ,OAAO,EAAIA,EAAI,GAGvC,CAED,IAAI,OAAOf,EAAG,CACV,MAAM,OAASA,EACV,KAAK,iBACN,QAAQ,KAAK,iEAAiE,CAErF,CAED,cAAe,CACX,KAAK,aAAY,CACpB,CAEL,CAKA,MAAM6+D,WAA6BxkD,CAAc,CAE7C,YAAY2wC,EAAK,CACb,MAAMA,CAAG,EAET,KAAK,GAAK,EACV,KAAK,oBAAsB,IAC9B,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEjqD,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,IAAI,mBAAmBA,EAAG,CACtB,KAAK,oBAAsBA,EAC3B,KAAK,OAAM,CACd,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,KAAK,YAAY,IAAK,KAAK,GAAI,KAAK,GAAG,SAAS,EAChD,KAAK,YAAY,YAAa,EAAG,KAAK,GAAG,SAAS,CACrD,CAED,WAAWA,EAAW,CAClB,IAAIY,EAAY,KAAK,oBAAsB,KAAK,oBAAoB,cAAgB,KAEhF54C,EAAK,KAAK,GACdA,EAAG,cAAcA,EAAG,QAAQ,EAC5BA,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EACvC54C,EAAG,cAAcA,EAAG,QAAQ,CAC/B,CACL,CAEA6pD,GAAqB,qBAAuB,+kBCnZ7B,MAAMM,WAAuB3U,EAAU,CAElD,OAAO,WAAY,CACf,MAAMoU,EAAW,SAASxsC,EAASwpB,EAAa,CAC5C,GAAKA,EAAY,QAAW,IAAW,CACnC,MAAM13B,EAAI03B,EAAY,EAChBz3B,EAAIy3B,EAAY,EACtB,IAAIqN,EAAMrN,EACV,GACIqN,EAAMA,EAAI,UAAU,CAAC,EACrBA,EAAI,SAAS,EAAI/kC,EACjB+kC,EAAI,SAAS,EAAI9kC,QACb8kC,EAAI,UACf,CACb,EAEQ,MAAO,CACH,SAAU,CAAC,IAAK,GAAM,mBAAoB,GAAM,gBAAiB,GAC7D,UAAW,CAAC,OAAQ,CAAC,KAAMmW,EAAe,EACtC,QAAS,CAAE,CACd,CACJ,EACD,OAAQ,CACJ,GAAI,CAAC,IAAK,GAAM,SAAUR,EAAU,MAAO,EAAG,MAAO,EAAG,QAAS,GAAO,QAAS,CAAC,OAAQ,CAAC,KAAMR,EAAa,CAAC,CAAC,EAChH,GAAI,CAAC,IAAK,GAAM,SAAUQ,EAAU,MAAO,EAAG,MAAO,EAAG,QAAS,GAAO,QAAS,CAAC,OAAQ,CAAC,KAAMR,EAAa,CAAC,CAAC,EAChH,GAAI,CAAC,IAAK,GAAM,SAAUQ,EAAU,MAAO,EAAG,MAAO,EAAG,QAAS,GAAO,QAAS,CAAC,OAAQ,CAAC,KAAMR,EAAa,CAAC,CAAC,EAChH,GAAI,CAAC,IAAK,GAAM,SAAUQ,EAAU,MAAO,GAAI,MAAO,EAAG,QAAS,GAAO,QAAS,CAAC,OAAQ,CAAC,KAAMR,EAAa,CAAC,CAAC,CACpH,CACJ,CACJ,CAED,IAAI,cAAe,CACf,MAAO,EACV,CAED,YAAY9rD,EAAO,CACf,MAAMA,CAAK,EACX,KAAK,UAAY,KAAK,IAAI,UAAU,EACpC,KAAK,SAAW,KAAK,IAAI,kBAAkB,EAC3C,KAAK,QAAU,KAAK,IAAI,QAAQ,EAEhC,KAAK,QAAU,EACf,KAAK,UAAY,EACjB,KAAK,UAAY,CACpB,CAED,QAAS,CAEL,MAAMwsD,EADuB,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,aAAa,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,aAAa,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,EAAE,aAAa,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,IAAI,aAAa,CAAC,CAAC,EAC1F,IAAI9+D,GAC5B,KAAK,MAAM,aAAa,OAAO,OAAO,CAAC,KAAMm+D,EAAgB,EAAGn+D,CAAC,CAAC,CAEpF,EAED,KAAK,iBAAiB,KAAK,iBAAiB,CAAC,EAAG,KAAK,UAAU,aAAc,EAAE,EAC/E,KAAK,iBAAiB,KAAK,iBAAiB,CAAC,EAAG,KAAK,SAAS,CAAC,EAAE,WAAU,EAAI,CAAC8+D,EAAc,CAAC,EAAGA,EAAc,CAAC,CAAC,CAAC,EAGnH,KAAK,iBAAiB,KAAK,iBAAiB,CAAC,EAAG,KAAK,SAAS,CAAC,EAAE,WAAY,EAAE,CAACA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,CAAC,CAAC,EACvJ,KAAK,iBAAiB,KAAK,iBAAiB,CAAC,EAAG,KAAK,SAAS,CAAC,EAAE,WAAY,EAAE,CAACA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,CAAC,CAAC,CAC1J,CAED,iBAAiB1sC,EAASvnB,EAASk0D,EAAO,CACtC,GAAI,CAACA,EAAM,OACP3sC,EAAQ,QAAUvnB,MACf,CACH,MAAMm0D,EAAOD,EAAM,MACb/0D,EAAQooB,EAAQ,MAAM,EAAE,CAAC,IAAK,GAAM,OAAQ4sC,CAAI,CAAC,EAGvD,KAAK,iBAAiBh1D,EAAOa,EAASk0D,CAAK,EAE3C3sC,EAAQ,UAAU,IAAIpoB,CAAK,CAC9B,CACD,OAAOooB,CACV,CAED,IAAI,SAAU,CACV,OAAO,KAAK,IAAI,kBAAkB,CACrC,CAED,IAAI,QAAQrxB,EAAG,CACX,KAAK,IAAI,kBAAkB,EAAE,MAAMA,CAAC,CACvC,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,UAAYA,EACjB,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,IAAI,SAASA,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,gBAAe,CACvB,CAED,SAASpF,EAAG,CACR,OAAO,KAAK,QAAQ,IAAI,IAAMA,CAAC,CAClC,CAED,iBAAiBA,EAAG,CAChB,OAAO,KAAK,SAASA,CAAC,EAAE,IAAI,SAAS,CACxC,CAED,WAAY,CACR,KAAK,gBAAe,CACvB,CAED,iBAAkB,CACd,IAAIuoB,EAAI,KAAK,YACTC,EAAI,KAAK,aAETu6C,EAAW,KAAK,UAChBC,EAAW,KAAK,UAEhBM,EAAK/6C,EAAIw6C,EAAW,EACpBQ,EAAK/6C,EAAIw6C,EAAW,EACxB,KAAK,UAAU,EAAIM,EACnB,KAAK,SAAS,EAAIP,EAClB,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIO,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,GACvD,KAAK,UAAU,EAAI,CAACP,EAEpB,KAAK,UAAU,EAAIQ,EACnB,KAAK,SAAS,EAAIP,EAClB,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIO,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,EACvD,KAAK,SAAS,CAAC,EAAE,EAAI,KAAK,iBAAiB,CAAC,EAAE,EAAIA,EAAK,GACvD,KAAK,UAAU,EAAI,CAACP,EAEpB,KAAK,EAAIz6C,EACT,KAAK,EAAIC,CACZ,CAOD,IAAI,OAAOpjB,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,QAAO,CACf,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,SAAU,CACN,IAAIA,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,OAAO,CAAC,EACzCA,EAAI,IACJ,KAAK,SAAS,CAAC,EAAE,QAAWA,EAAI,EAChC,KAAK,SAAS,CAAC,EAAE,QAAWA,EAAI,EAChC,KAAK,SAAS,CAAC,EAAE,QAAWA,EAAI,EAChC,KAAK,SAAS,CAAC,EAAE,QAAWA,EAAI,EAEvC,CAED,IAAI,OAAOf,EAAG,CACV,MAAM,OAASA,EACV,KAAK,iBACN,QAAQ,KAAK,iEAAiE,CAErF,CAED,cAAe,CACX,KAAK,OAAM,CACd,CAEL,CAEA,MAAMo/D,WAAwB/kD,CAAc,CAC5C,CAEA+kD,GAAgB,qBAAuB,yfCxLxB,MAAMC,WAA6B7U,EAAU,CAExD,OAAO,WAAY,CACf,MAAO,CACH,YAAa,CAAC,gBAAiB,GAAM,mBAAoB,GAAM,cAAe6U,GAAqB,kBAC/F,QAAS,CAAE,CACd,EACD,MAAO,CAAC,QAAS,EAAK,CACzB,CACJ,CAED,YAAY/sD,EAAO,CACf,MAAMA,CAAK,EAEX,KAAK,aAAe,EACpB,KAAK,YAAc,CACtB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,IAAI,SAAS,CAC5B,CAED,IAAI,QAAQvR,EAAG,CACX,KAAK,IAAI,SAAS,EAAE,MAAMA,EAAG,EAAI,CACpC,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,YAAYA,EAAG,CACf,GAAI,KAAK,eAAiBA,EAAG,CACzB,IAAIu+D,EAAM,EACV,KAAMv+D,EAAI,IAAOu+D,EAAM,IACnBA,IACAv+D,EAAIA,EAAI,EAGZ,KAAK,MAAQA,EACb,KAAK,eAAeu+D,CAAG,EAEvB,KAAK,aAAev+D,CACvB,CACJ,CAED,eAAeu+D,EAAK,CAChB,GAAI,KAAK,cAAgBA,EAAK,CAC1B,MAAMC,EAAU,KAAK,IAAI,OAAO,EAAE,UAC5Bv1B,EAAU,KAAK,IAAI,aAAa,EACtC,KAAOu1B,EAAQ,OAASD,GAAK,CAEzB,MAAMz0D,EADQ00D,EAAQ,SAAW,EACRv1B,EAAQ,WAAY,EAAGu1B,EAAQ,KAAK,WAAU,EACvEA,EAAQ,EAAE,CAAC,IAAK,GAAM,gBAAiB,GAAM,QAAS10D,CAAO,CAAC,CACjE,CAEDw0D,GAAqB,kBAAkB,KAAK,IAAI,aAAa,EAAG,EAAI,EAEpE,MAAMG,EAAcF,EAAM,EAC1B,KAAK,MAAM,CACP,YAAa,CAAC,gBAAiBE,CAAU,EACzC,MAAO,CAAC,QAASA,CAAU,CAC3C,CAAa,EAED,QAAS7jE,EAAI,EAAGsK,EAAIs5D,EAAQ,OAAQ5jE,EAAIsK,EAAGtK,IACvC4jE,EAAQ,MAAM5jE,CAAC,EAAE,MAAM,CACnB,QAASA,EAAI2jE,EACb,gBAAiB3jE,IAAM2jE,EAAM,CACjD,CAAiB,EAEL,KAAK,YAAcA,CACtB,CACJ,CAED,OAAO,kBAAkBG,EAAa7rC,EAAO,CACzC,MAAMoW,EAAUy1B,EAAY,SAAS,CAAC,EACtC,IAAIv7C,EAAI8lB,EAAQ,YACZ7lB,EAAI6lB,EAAQ,aAChB,GAAI9lB,IAAMu7C,EAAY,GAAKt7C,IAAMs7C,EAAY,GAAK7rC,EAAO,CACrD6rC,EAAY,EAAIv7C,EAChBu7C,EAAY,EAAIt7C,EAEhB,MAAMo7C,EAAUE,EAAY,OAAO,IAAI,OAAO,EAAE,SAChD,QAAS9jE,EAAI,EAAGsK,EAAIs5D,EAAQ,OAAQ5jE,EAAIsK,EAAGtK,IACvCuoB,EAAIA,EAAI,GACRC,EAAIA,EAAI,GACRo7C,EAAQ5jE,CAAC,EAAE,EAAIuoB,EACfq7C,EAAQ5jE,CAAC,EAAE,EAAIwoB,CAEtB,CACJ,CAED,IAAI,cAAe,CACf,MAAO,EACV,CAEL,CC/Fe,MAAMu7C,WAAwBlV,EAAU,CAEnD,OAAO,WAAY,CACf,MAAO,CACH,QAAS,CAAE,EACX,QAAS,CACL,IAAK,CAAC,KAAM,GAAM,QAAS,GAAO,OAAQ,CAAC,EAC3C,MAAO,CAAC,KAAM,GAAM,QAAS,EAAK,EAClC,OAAQ,CAAC,KAAM,GAAM,QAAS,EAAK,EACnC,KAAM,CAAC,KAAM,GAAM,QAAS,GAAO,OAAQ,CAAC,CAC/C,CACb,CACK,CAED,IAAI,cAAe,CACf,MAAO,EACV,CAED,YAAYl4C,EAAO,CACf,MAAMA,CAAK,EAEX,KAAK,WAAa,KAAK,IAAI,KAAK,EAChC,KAAK,aAAe,KAAK,IAAI,OAAO,EACpC,KAAK,cAAgB,KAAK,IAAI,QAAQ,EACtC,KAAK,YAAc,KAAK,IAAI,MAAM,EAElC,KAAK,cAAgB,SAAU8f,EAAS,CACpC,MAAM4X,EAAU5X,EAAQ,UAAU,MAClC,IAAIlO,EAAIkO,EAAQ,KAAK,GAAK4X,EAAQ,YAC9B7lB,EAAIiO,EAAQ,KAAK,GAAK4X,EAAQ,aAClC5X,EAAQ,WAAW,EAAIlO,EACvBkO,EAAQ,cAAc,EAAIjO,EAC1BiO,EAAQ,cAAc,EAAIlO,EAC1BkO,EAAQ,YAAY,EAAIjO,EAAIiO,EAAQ,WAAW,EAAIA,EAAQ,cAAc,EACzEA,EAAQ,YAAY,EAAI,CAACA,EAAQ,WAAW,EAC5CA,EAAQ,aAAa,EAAIlO,EACzBkO,EAAQ,aAAa,EAAIjO,EAAIiO,EAAQ,WAAW,EAAIA,EAAQ,cAAc,EAC1EA,EAAQ,aAAa,EAAI,CAACA,EAAQ,WAAW,CACzD,EAEQ,KAAK,YAAc,CACtB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,IAAI,SAAS,CAC5B,CAED,IAAI,QAAQrxB,EAAG,CACX,KAAK,IAAI,SAAS,EAAE,MAAMA,EAAG,EAAI,CACpC,CAED,IAAI,aAAc,CACd,OAAO,KAAK,cACf,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,WAAW,CAC1B,CAED,IAAI,kBAAmB,CACnB,OAAO,KAAK,aAAa,CAC5B,CAED,IAAI,mBAAoB,CACpB,OAAO,KAAK,cAAc,CAC7B,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,YAAY,CAC3B,CAED,IAAI,YAAYA,EAAG,CACf,KAAK,eAAiBA,EACtB,KAAK,iBAAmBA,EACxB,KAAK,kBAAoBA,EACzB,KAAK,gBAAkBA,CAC1B,CAED,IAAI,eAAeA,EAAG,CAClB,KAAK,WAAW,EAAIA,EACpB,KAAK,WAAW,QAAWA,EAAI,CAClC,CAED,IAAI,iBAAiBA,EAAG,CACpB,KAAK,aAAa,EAAIA,EACtB,KAAK,aAAa,QAAWA,EAAI,CACpC,CAED,IAAI,kBAAkBA,EAAG,CACrB,KAAK,cAAc,EAAIA,EACvB,KAAK,cAAc,QAAWA,EAAI,CACrC,CAED,IAAI,gBAAgBA,EAAG,CACnB,KAAK,YAAY,EAAIA,EACrB,KAAK,YAAY,QAAWA,EAAI,CACnC,CAED,IAAI,aAAc,CACd,OAAO,KAAK,cACf,CAED,IAAI,gBAAiB,CACjB,OAAO,KAAK,WAAW,KAC1B,CAED,IAAI,kBAAmB,CACnB,OAAO,KAAK,aAAa,KAC5B,CAED,IAAI,mBAAoB,CACpB,OAAO,KAAK,cAAc,KAC7B,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,YAAY,KAC3B,CAED,IAAI,YAAYA,EAAG,CACf,KAAK,eAAiBA,EACtB,KAAK,iBAAmBA,EACxB,KAAK,kBAAoBA,EACzB,KAAK,gBAAkBA,CAC1B,CAED,IAAI,eAAeA,EAAG,CAClB,KAAK,WAAW,MAAQA,CAC3B,CAED,IAAI,iBAAiBA,EAAG,CACpB,KAAK,aAAa,MAAQA,CAC7B,CAED,IAAI,kBAAkBA,EAAG,CACrB,KAAK,cAAc,MAAQA,CAC9B,CAED,IAAI,gBAAgBA,EAAG,CACnB,KAAK,YAAY,MAAQA,CAC5B,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUoK,EAAU,CACpB,KAAK,UAAU,MAAMA,CAAQ,CAChC,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,YAAYA,EAAU,CACtB,KAAK,YAAY,MAAMA,CAAQ,CAClC,CAED,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CAED,IAAI,aAAaA,EAAU,CACvB,KAAK,aAAa,MAAMA,CAAQ,CACnC,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,WAAWA,EAAU,CACrB,KAAK,WAAW,MAAMA,CAAQ,CACjC,CAED,IAAI,QAAQA,EAAU,CAClB,KAAK,UAAYA,EACjB,KAAK,WAAaA,EAClB,KAAK,aAAeA,EACpB,KAAK,YAAcA,CACtB,CAEL,CCnLO,MAAMw0D,WAA6BC,CAAmB,CAEzD,YAAYn7D,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,QAAU,CAClB,CAED,OAAO,QAAS,CACZ,OAAOo7D,EACV,CAGD,IAAI,OAAO9+D,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,YAAa,CACT,OAAO,KAAK,UAAY,CAC3B,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,KAAK,YAAY,SAAU,KAAK,QAAS,KAAK,GAAG,SAAS,CAC7D,CAEL,CAEA2S,GAAqB,qBAAuB,4iBAmBrC,MAAME,WAA2BC,EAAiB,CAErD,YAAYr7D,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,QAAU,CAClB,CAED,OAAO,UAAW,CACd,OAAOk7D,EACV,CAGD,IAAI,OAAO5+D,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,YAAa,CACT,OAAO,KAAK,UAAY,CAC3B,CAED,cAAc,CAAC,OAAA6H,CAAM,EAAG,CACpBA,EAAO,IAAI,OAAS,aAAe,KAAK,QAAU,GACrD,CAED,aAAa,CAAC,OAAAA,CAAM,EAAG,CACnBA,EAAO,IAAI,OAAS,MACvB,CAEL,CCjFe,MAAMm3D,WAAwB1lD,CAAc,CAEvD,YAAY2wC,EAAK,CACb,MAAMA,CAAG,EAET,KAAK,cAAgB,IAAI3vC,GAAa2vC,EAAI,KAAK,EAE/C,KAAK,UAAY,EAAE,IAEnB,KAAK,QAAU,EAClB,CAED,IAAI,SAASjqD,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,OAAM,CACd,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,wBAAwBisD,EAAW,CAE/B,KAAK,cAAc,OAEnB,IAAIvnC,EAASunC,EAAU,2BAA6B,EAChDf,EAASe,EAAU,MAAM,OAEzBzkD,EAASykD,EAAU,OAEvB,QAASrxD,EAAI,EAAGA,EAAI4M,EAAQ5M,IAAK,CAG7B,IAAIuhD,EAAM8P,EAAU,gBAAgBrxD,CAAC,EAAI,KAAK,cAAc,iBACxDwhD,EAAM6P,EAAU,iBAAiBrxD,CAAC,EAAI,KAAK,cAAc,kBAEzDqhD,EAAM,EACNC,EAAM,EACV,GAAI,KAAK,QAAS,CAOd,GANAD,EAAM,KAAK,SACXC,EAAM,KAAK,SAEXC,GAAOF,EACPG,GAAOF,EAEH,KAAK,OAAQ,EAAG,GAAK,CAErB,MAAM74C,EAAI44C,EACVA,EAAME,EACNA,EAAM94C,CACT,CAED,GAAI,KAAK,OAAQ,EAAG,GAAK,CAErB,MAAMA,EAAI64C,EACVA,EAAME,EACNA,EAAM/4C,CACT,CACJ,CAGD6nD,EAAOxmC,CAAM,EAAIu3B,EACjBiP,EAAOxmC,EAAS,CAAC,EAAIw3B,EAErBgP,EAAOxmC,EAAS,CAAC,EAAIy3B,EACrB+O,EAAOxmC,EAAS,CAAC,EAAIw3B,EAErBgP,EAAOxmC,EAAS,CAAC,EAAIy3B,EACrB+O,EAAOxmC,EAAS,CAAC,EAAI03B,EAErB8O,EAAOxmC,EAAS,CAAC,EAAIu3B,EACrBiP,EAAOxmC,EAAS,CAAC,EAAI03B,EAErB13B,GAAU,CACb,CACJ,CAED,WAAWunC,EAAW,CAClB,IAAIh4C,EAAK,KAAK,GACdA,EAAG,oBAAoB,KAAK,QAAQ,oBAAoB,EAAG,EAAGA,EAAG,MAAO,GAAO,EAAG,KAAK,6BAA6Bg4C,CAAS,CAAC,EAE9H,IAAIY,EAAY,KAAK,cAAc,OAAO,cAC1C54C,EAAG,cAAcA,EAAG,QAAQ,EAC5BA,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EACvC54C,EAAG,cAAcA,EAAG,QAAQ,CAC/B,CAED,8BAA+B,CAC3B,MAAO,EACV,CAED,cAAcg4C,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,KAAK,YAAY,gBAAiB,EAAG,KAAK,GAAG,SAAS,EACtD,KAAK,YAAY,WAAY,EAAI,KAAK,UAAW,KAAK,GAAG,SAAS,CACrE,CAED,eAAgB,CACZ,MAAM,cAAa,EACV,KAAK,GACX,wBAAwB,KAAK,QAAQ,oBAAoB,CAAC,CAChE,CAED,gBAAiB,CACb,MAAM,eAAc,EACX,KAAK,GACX,yBAAyB,KAAK,QAAQ,oBAAoB,CAAC,CACjE,CAED,YAAa,CACT,OAAO,KAAK,YAAc,CAC7B,CAED,UAAUA,EAAW,CACb,KAAK,SACL,KAAK,OAAM,CAElB,CAEL,CAEA+S,GAAgB,mBAAqB,kvBAyBrCA,GAAgB,qBAAuB,kkBCtJxB,MAAMC,WAA2B3lD,CAAc,CAE1D,YAAY2wC,EAAK,CACb,MAAMA,CAAG,EAET,KAAK,YAAc,EAEnB,KAAK,eAAiB,IAEtB,KAAK,iBAAmB,EAGxB,KAAK,QAAU,EAEf,KAAK,QAAU,GAEf,KAAK,aAAe,EAEpB,KAAK,SAAW,EAEhB,KAAK,SAAW,EAEhB,KAAK,QAAU,GAClB,CAED,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CAED,IAAI,YAAYjqD,EAAG,CACf,KAAK,aAAeA,EACpB,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,SAAWA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,SAAWA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,WAAWA,EAAG,CACd,KAAK,YAAcA,CACtB,CAED,IAAI,YAAa,CACb,OAAO,KAAK,WACf,CAED,IAAI,cAAcA,EAAG,CACjB,KAAK,eAAiBA,CACzB,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CAED,IAAI,QAAQA,EAAG,CACPA,EAAI,MACJ,QAAQ,KAAK,0DAA0D,EACvEA,EAAI,KAIR,KAAK,SAAWA,EAGhB,KAAK,QAAU,IAAI,WAAW,KAAK,WAAWA,CAAC,CAAC,EAEhD,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,WAAWkF,EAAG,CACV,MAAMlF,EAAI,GACV,QAAS,EAAI,EAAG,EAAIkF,EAAG,IACnBlF,EAAE,KAAK,KAAK,WAAW,EAE3B,OAAOA,CACV,CAOD,SAASgD,EAAG,CACR,KAAK,SAAWA,EAAI,KAAK,SACzB,MAAMk8D,EAAO,KAAK,MAAM,KAAK,OAAO,EACpC,KAAK,SAAWA,EAChB,KAAK,cAAcA,CAAI,EACvB,KAAK,OAAM,CACd,CAED,cAAch6D,EAAG,CACb,QAAStK,EAAI,KAAK,SAAW,EAAGA,GAAK,EAAGA,IAAK,CACzC,MAAM03D,EAAc13D,EAAIsK,EACpBotD,EAAc,GACd,KAAK,iBAAmB,KAAK,IAAI,KAAK,iBAAmB,KAAK,eAAgB,KAAK,IAAI,KAAK,iBAAmB,KAAK,eAAgB,KAAK,WAAW,CAAC,EACrJ,KAAK,QAAQ13D,CAAC,EAAI,IAAM,KAAK,kBAE7B,KAAK,QAAQA,CAAC,EAAI,KAAK,QAAQ03D,CAAW,CAEjD,CACJ,CAED,IAAI,OAAOtyD,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,KAAK,YAAY,cAAe,KAAK,aAAc,KAAK,GAAG,SAAS,EACpE,KAAK,YAAY,UAAW,KAAK,SAAU,KAAK,GAAG,SAAS,EAC5D,KAAK,YAAY,UAAW,KAAK,SAAU,KAAK,GAAG,SAAS,EAC5D,KAAK,YAAY,SAAU,KAAK,QAAS,KAAK,GAAG,SAAS,EAC1D,KAAK,YAAY,SAAU,KAAK,QAAS,KAAK,GAAG,SAAS,EAC1D,KAAK,YAAY,UAAW,KAAK,SAAU,KAAK,GAAG,SAAS,EAC5D,KAAK,YAAY,gBAAiB,EAAG,KAAK,GAAG,SAAS,CACzD,CAED,YAAa,CACT,OAAO,KAAK,UAAY,CAC3B,CAED,WAAWA,EAAW,CAClB,MAAMh4C,EAAK,KAAK,GAChBA,EAAG,cAAcA,EAAG,QAAQ,EACvB,KAAK,eAYNA,EAAG,YAAYA,EAAG,WAAY,KAAK,cAAc,GAXjD,KAAK,eAAiBA,EAAG,gBACzBA,EAAG,YAAYA,EAAG,WAAY,KAAK,cAAc,EACjDA,EAAG,cAAcA,EAAG,WAAYA,EAAG,mBAAoBA,EAAG,MAAM,EAChEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,mBAAoBA,EAAG,MAAM,EAChEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,eAAgBA,EAAG,aAAa,EACnEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,eAAgBA,EAAG,aAAa,EAC/D4/B,EAAM,QACN5/B,EAAG,YAAYA,EAAG,qBAAsB,EAAK,EAEjDA,EAAG,YAAYA,EAAG,+BAAgC,EAAK,GAM3DA,EAAG,WAAWA,EAAG,WAAY,EAAGA,EAAG,MAAO,KAAK,SAAU,EAAG,EAAGA,EAAG,MAAOA,EAAG,cAAe,KAAK,OAAO,EACvGA,EAAG,cAAcA,EAAG,QAAQ,CAC/B,CAED,SAAU,CACF,KAAK,gBACL,KAAK,GAAG,cAAc,KAAK,cAAc,CAEhD,CAGL,CAEAgrD,GAAmB,mBAAqB,63BA8BxCA,GAAmB,qBAAuB,utBCpN3B,MAAME,WAAwB7lD,CAAc,CAEvD,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,QAAU,CAClB,CAED,IAAI,OAAO1D,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,YAAa,CACT,OAAO,KAAK,UAAY,CAC3B,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,KAAK,YAAY,SAAU,KAAK,QAAS,KAAK,GAAG,SAAS,CAC7D,CAEL,CAEAkT,GAAgB,qBAAuB,0eC1BxB,MAAMC,WAAsB9lD,CAAc,CAErD,YAAY2wC,EAAK,CACb,MAAMA,CAAG,EACT,KAAK,OAAS,EACd,KAAK,KAAO,WACZ,KAAK,OAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CACzB,CAED,IAAI,MAAMjqD,EAAG,CACT,KAAK,OAASA,EACd,KAAK,OAAM,CACd,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,IACf,CAED,IAAI,MAAMA,EAAG,CACT,GAAI,KAAK,OAASA,EAAG,CACjB,MAAMmvD,EAAMnd,EAAW,4BAA4BhyC,CAAC,EACpDmvD,EAAI,CAAC,EAAIA,EAAI,CAAC,EAAIA,EAAI,CAAC,EACvBA,EAAI,CAAC,EAAIA,EAAI,CAAC,EAAIA,EAAI,CAAC,EACvBA,EAAI,CAAC,EAAIA,EAAI,CAAC,EAAIA,EAAI,CAAC,EAEvB,KAAK,OAASA,EAEd,KAAK,OAAM,EAEX,KAAK,KAAOnvD,CACf,CACJ,CAED,YAAa,CACT,OAAQ,KAAK,SAAW,GAAK,KAAK,KAAK,CAAC,IAAM,CACjD,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,IAAIh4C,EAAK,KAAK,GACd,KAAK,YAAY,QAAS,IAAI,aAAa,KAAK,MAAM,EAAGA,EAAG,UAAU,CACzE,CAED,eAAgB,CACZ,MAAM,cAAa,EACnB,KAAK,GAAG,wBAAwB,KAAK,QAAQ,SAAS,CAAC,CAC1D,CAED,gBAAiB,CACb,MAAM,eAAc,EACpB,KAAK,GAAG,yBAAyB,KAAK,QAAQ,SAAS,CAAC,CAC3D,CAED,wBAAwBg4C,EAAW,CAC/B,IAAIvnC,EAASunC,EAAU,2BAA6B,EAChDf,EAASe,EAAU,MAAM,OAEzBzkD,EAASykD,EAAU,OAEvB,QAASrxD,EAAI,EAAGA,EAAI4M,EAAQ5M,IAAK,CAE7B,MAAMigD,EAAcoR,EAAU,eAAerxD,CAAC,EAGxCykE,EAAM,KAAK,OAASxkB,EAAY,EAChCykB,EAAKD,GAAO,EAAI,EAAIA,GACpBE,EAAM,KAAK,OAAS1kB,EAAY,EAChC2kB,EAAKD,GAAO,EAAI,EAAIA,GAG1BrU,EAAOxmC,CAAM,EAAI,CAAC46C,EAClBpU,EAAOxmC,EAAS,CAAC,EAAI,CAAC86C,EAEtBtU,EAAOxmC,EAAS,CAAC,EAAI,EAAI46C,EACzBpU,EAAOxmC,EAAS,CAAC,EAAI,CAAC86C,EAEtBtU,EAAOxmC,EAAS,CAAC,EAAI,EAAI46C,EACzBpU,EAAOxmC,EAAS,CAAC,EAAI,EAAI86C,EAEzBtU,EAAOxmC,EAAS,CAAC,EAAI,CAAC46C,EACtBpU,EAAOxmC,EAAS,CAAC,EAAI,EAAI86C,EAEzB96C,GAAU,CACb,CACJ,CAED,WAAWunC,EAAW,CAClB,IAAIh4C,EAAK,KAAK,GACdA,EAAG,oBAAoB,KAAK,QAAQ,SAAS,EAAG,EAAGA,EAAG,MAAO,GAAO,EAAG,KAAK,6BAA6Bg4C,CAAS,CAAC,CACtH,CAED,8BAA+B,CAC3B,MAAO,EACV,CAEL,CAEAmT,GAAc,mBAAqB,ssBAyBnCA,GAAc,qBAAuB,ggBCxHtB,MAAMK,WAAuBnmD,CAAc,CAEtD,YAAY2wC,EAAK,CACb,MAAMA,CAAG,EAET,KAAK,MAAQ,IAAI,aAAa,CAAC,EAAG,CAAC,CAAC,CACvC,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,MAAM,CAAC,CACtB,CAED,IAAI,EAAEjqD,EAAG,CACL,KAAK,MAAM,CAAC,EAAIA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,MAAM,CAAC,CACtB,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,MAAM,CAAC,EAAIA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,MAAO,CACP,OAAO,KAAK,MAAM,CAAC,CACtB,CAED,IAAI,KAAKA,EAAG,CACR,KAAK,MAAM,CAAC,EAAIA,EAChB,KAAK,MAAM,CAAC,EAAIA,EAChB,KAAK,OAAM,CACd,CAED,YAAa,CACT,OAAS,KAAK,MAAM,CAAC,IAAM,GAAO,KAAK,MAAM,CAAC,IAAM,CACvD,CAED,OAAO,cAAe,CAClB,OAAO,uBACV,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,IAAIh4C,EAAK,KAAK,GACd,KAAK,YAAY,OAAQ,IAAI,aAAa,KAAK,KAAK,EAAGA,EAAG,UAAU,CACvE,CAED,8BAA+B,CAC3B,MAAO,EACV,CAED,eAAgB,CACZ,MAAM,cAAa,EACnB,KAAK,GAAG,wBAAwB,KAAK,QAAQ,aAAa,CAAC,CAC9D,CAED,gBAAiB,CACb,MAAM,eAAc,EACpB,KAAK,GAAG,yBAAyB,KAAK,QAAQ,aAAa,CAAC,CAC/D,CAED,wBAAwBg4C,EAAW,CAC/B,IAAIvnC,EAASunC,EAAU,2BAA6B,EAChDf,EAASe,EAAU,MAAM,OAEzBzkD,EAASykD,EAAU,OACvB,QAASrxD,EAAI,EAAGA,EAAI4M,EAAQ5M,IAAK,CAC7B,IAAIuoB,EAAI8oC,EAAU,MAAM,gBAAgBA,EAAU,MAAQrxD,CAAC,EACvDwoB,EAAI6oC,EAAU,MAAM,iBAAiBA,EAAU,MAAQrxD,CAAC,EAE5DswD,EAAOxmC,CAAM,EAAIvB,EACjB+nC,EAAOxmC,EAAS,CAAC,EAAItB,EACrB8nC,EAAOxmC,EAAS,CAAC,EAAIvB,EACrB+nC,EAAOxmC,EAAS,CAAC,EAAItB,EACrB8nC,EAAOxmC,EAAS,CAAC,EAAIvB,EACrB+nC,EAAOxmC,EAAS,CAAC,EAAItB,EACrB8nC,EAAOxmC,EAAS,CAAC,EAAIvB,EACrB+nC,EAAOxmC,EAAS,CAAC,EAAItB,EAErBsB,GAAU,CACb,CACJ,CAED,WAAWunC,EAAW,CAClB,IAAIh4C,EAAK,KAAK,GACdA,EAAG,oBAAoB,KAAK,QAAQ,aAAa,EAAG,EAAGA,EAAG,MAAO,GAAO,KAAK,6BAA8B,EAAE,KAAK,6BAA6Bg4C,CAAS,CAAC,CAC5J,CACL,CAEAwT,GAAe,mBAAqB,stBAyBpCA,GAAe,qBAAuB,21BCxHvB,MAAMC,WAA2BpmD,CAAc,CAC1D,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,QAAU,EACf,KAAK,QAAU,CAClB,CAED,IAAI,OAAO1D,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,YAAa,CACT,OAAO,KAAK,UAAY,CAC3B,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAE7B,KAAK,YAAY,SAAU,GAAK,KAAK,QAAU,IAAOA,EAAU,eAAgB,EAAE,KAAK,GAAG,SAAS,EACnG,KAAK,YAAY,SAAU,GAAMA,EAAU,iBAAmB,KAAK,QAAS,KAAK,GAAG,SAAS,CAChG,CAEL,CAEAyT,GAAmB,mBAAqB,wqBAwBxCA,GAAmB,qBAAuB,kjBC7D3B,MAAMC,WAA+BrmD,CAAc,CAC9D,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,OAAS,EACd,KAAK,QAAU,CAAC,EAAG,EAAG,EAAG,CAAC,EAC1B,KAAK,QAAU,EACf,KAAK,IAAM,SACX,KAAK,WAAa,KAAK,oBAAoB,UAAU,EACrD,KAAK,aAAe,KAAK,oBAAoB,QAAU,CAC1D,CAED,IAAI,MAAMrC,EAAG,CACT,KAAK,OAAS,KAAK,IAAI,KAAK,IAAIA,EAAG,CAAC,EAAG,CAAC,CAC3C,CAED,IAAI,OAAOrB,EAAG,CACP,MAAM,QAAQA,CAAC,EACXA,EAAE,SAAW,EACZ,KAAK,QAAU,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAElCA,EAAE,SAAW,EACjB,KAAK,QAAU,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAG,KAAK,QAAQ,CAAC,CAAC,EAE5CA,EAAE,SAAW,EAClB,KAAK,QAAUA,EAGf,KAAK,QAAU,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAI1C,KAAK,QAAU,CAACA,EAAGA,EAAGA,EAAGA,CAAC,EAE9B,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,QAAQzD,EAAK,CACb,KAAK,QAAQ,CAAC,EAAIA,EAClB,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QAAQ,CAAC,CACxB,CAED,IAAI,SAASA,EAAK,CACd,KAAK,QAAQ,CAAC,EAAIA,EAClB,KAAK,OAAM,CACd,CAED,IAAI,UAAW,CACX,OAAO,KAAK,QAAQ,CAAC,CACxB,CAED,IAAI,YAAYA,EAAK,CACjB,KAAK,QAAQ,CAAC,EAAIA,EAClB,KAAK,OAAM,CACd,CAED,IAAI,aAAc,CACd,OAAO,KAAK,QAAQ,CAAC,CACxB,CAED,IAAI,WAAWA,EAAK,CAChB,KAAK,QAAQ,CAAC,EAAIA,EAClB,KAAK,OAAM,CACd,CAED,IAAI,YAAa,CACb,OAAO,KAAK,QAAQ,CAAC,CACxB,CAED,IAAI,YAAY61C,EAAM,CAClB,KAAK,IAAMA,EACX,KAAK,aAAe,KAAK,oBAAoBA,CAAI,EACjD,KAAK,OAAM,CACd,CAED,IAAI,aAAc,CACd,OAAO,KAAK,GACf,CAED,IAAI,UAAUA,EAAM,CAChB,KAAK,IAAMA,EACX,KAAK,WAAa,KAAK,oBAAoBA,CAAI,EAC/C,KAAK,OAAM,CACd,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,GACf,CAED,IAAI,OAAO71C,EAAK,CACZ,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,oBAAoBsP,EAAO,CACvB,MAAMsjD,EAAMnd,EAAW,4BAA4BnmC,CAAK,EACxD,OAAAsjD,EAAI,CAAC,GAAKA,EAAI,CAAC,EACfA,EAAI,CAAC,GAAKA,EAAI,CAAC,EACfA,EAAI,CAAC,GAAKA,EAAI,CAAC,EACR,IAAI,aAAaA,CAAG,CAC9B,CAED,cAAclD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,MAAM3tD,EAAQ2tD,EAAU,YAClB2T,EAAkB,KAAK,IAAI,MAAM,mBAAkB,EACnDC,EAAU,KAAK,QAAQ,IAAK,IAAO,EAAI,IAAOD,CAAe,EACnE,KAAK,YAAY,SAAU,IAAI,aAAaC,CAAO,EAAG,KAAK,GAAG,UAAU,EACxE,KAAK,YAAY,QAAS5T,EAAU,eAAe,CAAC,EAAE,cAAc,MAAO,KAAK,GAAG,SAAS,EAC5F,KAAK,YAAY,QAAS,KAAK,OAAQ,KAAK,GAAG,SAAS,EACxD,KAAK,YAAY,cAAe,KAAK,aAAc,KAAK,GAAG,UAAU,EACrE,KAAK,YAAY,YAAa,KAAK,WAAY,KAAK,GAAG,UAAU,EACjE,KAAK,YAAY,SAAW,KAAK,QAAU2T,EAAiB,KAAK,GAAG,SAAS,EAC7E,KAAK,YAAY,aAAc,IAAI,aAAa,CAACthE,EAAM,GAAKshE,EAAiBthE,EAAM,GAAKshE,CAAe,CAAC,EAAG,KAAK,GAAG,UAAU,CAChI,CACL,CAEAD,GAAuB,mBAAqB,snBAwB5CA,GAAuB,qBAAuB,0xDCzJ/B,MAAMG,WAAsBxmD,CAAc,CACrD,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,MAAQ,CAAC,EAAG,EAAG,EAAG,CAAC,CAC3B,CAED,IAAI,IAAInH,EAAK,CACT,KAAK,MAAM,CAAC,EAAIA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,KAAM,CACN,OAAO,KAAK,MAAM,CAAC,CACtB,CAED,IAAI,MAAMA,EAAK,CACX,KAAK,MAAM,CAAC,EAAIA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MAAM,CAAC,CACtB,CAED,IAAI,OAAOA,EAAK,CACZ,KAAK,MAAM,CAAC,EAAIA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,MAAM,CAAC,CACtB,CAED,IAAI,KAAKA,EAAK,CACV,KAAK,MAAM,CAAC,EAAIA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,MAAO,CACP,OAAO,KAAK,MAAM,CAAC,CACtB,CAED,IAAI,KAAKyD,EAAG,CACL,MAAM,QAAQA,CAAC,EACXA,EAAE,SAAW,EACZ,KAAK,MAAQ,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAEhCA,EAAE,SAAW,EACjB,KAAK,MAAQ,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAG,KAAK,MAAM,CAAC,CAAC,EAExCA,EAAE,SAAW,EAClB,KAAK,MAAQA,EAGb,KAAK,MAAQ,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAIxC,KAAK,MAAQ,CAACA,EAAGA,EAAGA,EAAGA,CAAC,EAE5B,KAAK,OAAM,CACd,CAED,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,MAAM3tD,EAAQ2tD,EAAU,YAElB2T,EAAkB,KAAK,IAAI,MAAM,mBAAkB,EACnDG,EAAO,KAAK,MAAM,IAAK7mB,GAAMA,EAAI0mB,CAAe,EACtD,KAAK,YAAY,OAAS,IAAI,aAAaG,CAAI,EAAG,KAAK,GAAG,UAAU,EACpE,KAAK,YAAY,aAAc,IAAI,aAAa,CAACzhE,EAAM,GAAKshE,EAAiBthE,EAAM,GAAKshE,CAAe,CAAC,EAAG,KAAK,GAAG,UAAU,CAChI,CACL,CAEAE,GAAc,qBAAuB,4hEC9EtB,MAAME,WAAuB1mD,CAAc,CACtD,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,WAAa,IAClB,KAAK,WAAa,GAClB,KAAK,OAAS,CAAC,GAAK,EAAG,CAC1B,CAED,cAAcuoD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAE7B,KAAK,YAAY,YAAa,KAAK,WAAa,KAAK,GAAG,SAAS,EACjE,KAAK,YAAY,YAAa,KAAK,WAAY,KAAK,GAAG,SAAS,EAChE,KAAK,YAAY,QAAS,IAAI,aAAa,KAAK,MAAM,EAAG,KAAK,GAAG,UAAU,EAC3E,KAAK,OAAQ,CAChB,CAED,IAAI,MAAMjsD,EAAG,CACN,MAAM,QAAQA,CAAC,EACd,KAAK,OAASA,EAGd,KAAK,OAAS,CAACA,EAAGA,CAAC,EAEvB,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,CAAC,CACvB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,CAAC,EAAIA,EACjB,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,CAAC,CACvB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,CAAC,EAAIA,EACjB,KAAK,OAAM,CACd,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,UAAUA,EAAG,CACb,KAAK,WAAaA,EAClB,KAAK,OAAM,CACd,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UAEf,CAED,IAAI,UAAUA,EAAG,CACb,KAAK,WAAaA,EAClB,KAAK,OAAM,CACd,CACL,CAEAggE,GAAe,mBAAqB1mD,EAAc,mBAElD0mD,GAAe,qBAAuB,4uBClEvB,MAAMC,WAAsB3mD,CAAc,CAErD,YAAY2wC,EAAK,CACb,MAAMA,CAAG,EACT,KAAK,QAAU,IACf,KAAK,OAAS,GACd,KAAK,QAAU,EACf,KAAK,OAAS,GACd,KAAK,QAAU,KACf,KAAK,OAAS,WACd,KAAK,iBAAmB,WACxB,KAAK,MAAQ,KAAK,KACrB,CAED,IAAI,OAAOjqD,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAASA,EACd,KAAK,OAAM,CACd,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAASA,EACd,KAAK,OAAM,CACd,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAASA,EACd,KAAK,OAAM,CACd,CAED,IAAI,gBAAgBA,EAAG,CACnB,KAAK,iBAAmBA,EACxB,KAAK,OAAM,CACd,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,MAAM3tD,EAAQ2tD,EAAU,YAExB,KAAK,YAAY,QAAS,KAAK,IAAG,EAAK,KAAK,MAAO,KAAK,GAAG,SAAS,EAEpE,MAAM2T,EAAkB,KAAK,IAAI,MAAM,mBAAkB,EACzD,KAAK,YAAY,SAAU,KAAK,QAAUA,EAAiB,KAAK,GAAG,SAAS,EAC5E,KAAK,YAAY,QAAS,KAAK,OAASA,EAAiB,KAAK,GAAG,SAAS,EAC1E,KAAK,YAAY,SAAU,KAAK,QAAS,KAAK,GAAG,SAAS,EAC1D,KAAK,YAAY,QAAS,KAAK,OAAQ,KAAK,GAAG,SAAS,EACxD,KAAK,YAAY,SAAU,KAAK,QAAS,KAAK,GAAG,SAAS,EAC1D,KAAK,YAAY,QAAS,IAAI,aAAa5tB,EAAW,4BAA4B,KAAK,MAAM,CAAC,EAAG,KAAK,GAAG,UAAU,EACnH,KAAK,YAAY,kBAAmB,IAAI,aAAaA,EAAW,4BAA4B,KAAK,gBAAgB,CAAC,EAAG,KAAK,GAAG,UAAU,EACvI,KAAK,YAAY,aAAc,IAAI,aAAa,CAAC1zC,EAAM,GAAKshE,EAAiBthE,EAAM,GAAKshE,CAAe,CAAC,EAAG,KAAK,GAAG,UAAU,EAE7H,KAAK,OAAQ,CAChB,CACL,CAEAK,GAAc,mBAAqB3mD,EAAc,mBAEjD2mD,GAAc,qBAAuB,upFCxEtB,MAAMC,WAAmB5mD,CAAc,CAElD,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,QAAU,CAClB,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAE1D,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,cAAcisD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAE7B,MAAM3tD,EAAQ2tD,EAAU,YAClB2T,EAAkB,KAAK,IAAI,MAAM,mBAAoB,EAE3D,KAAK,YAAY,IAAK,KAAK,GAAKA,EAAiB,KAAK,GAAG,SAAS,EAClE,KAAK,YAAY,IAAK,KAAK,GAAKA,EAAiB,KAAK,GAAG,SAAS,EAClE,KAAK,YAAY,IAAK,KAAK,GAAKA,EAAiB,KAAK,GAAG,SAAS,EAClE,KAAK,YAAY,IAAK,KAAK,GAAKA,EAAiB,KAAK,GAAG,SAAS,EAClE,KAAK,YAAY,UAAY,KAAK,QAAU,IAAMA,EAAiB,KAAK,GAAG,SAAS,EACpF,KAAK,YAAY,aAAc,IAAI,aAAa,CAACthE,EAAM,GAAKshE,EAAiBthE,EAAM,GAAKshE,CAAe,CAAC,EAAG,KAAK,GAAG,UAAU,CAChI,CAED,YAAa,CACT,OAAQ,KAAK,KAAO,GAAK,KAAK,KAAO,GAAK,KAAK,KAAO,GAAK,KAAK,KAAO,CAC1E,CACL,CAEAM,GAAW,mBAAqB5mD,EAAc,mBAE9C4mD,GAAW,qBAAuB,y1BC5EnB,MAAMC,WAA6B7mD,CAAc,CAC5D,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,OAAS,CAAC,EAAG,CAAC,EACnB,KAAK,IAAM,WACX,KAAK,cAAgB,KAAK,oBAAoB,KAAK,GAAG,EACtD,KAAK,IAAM,SACX,KAAK,cAAgB,KAAK,oBAAoB,KAAK,GAAG,EACtD,KAAK,QAAU,CAClB,CAED,IAAI,QAAQ1D,EAAG,CACX,KAAK,OAASA,CACjB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,OACf,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,SAAWA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,WAAWoyC,EAAM,CACjB,KAAK,IAAMA,EACX,KAAK,cAAgB,KAAK,oBAAoBA,CAAI,EAClD,KAAK,OAAM,CACd,CAED,IAAI,YAAa,CACb,OAAO,KAAK,GACf,CAED,IAAI,WAAWA,EAAM,CACjB,KAAK,IAAMA,EACX,KAAK,cAAgB,KAAK,oBAAoBA,CAAI,EAClD,KAAK,OAAM,CACd,CAED,IAAI,MAAMA,EAAM,CACZ,KAAK,WAAaA,CACrB,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,UACf,CAED,IAAI,YAAa,CACb,OAAO,KAAK,GACf,CAED,IAAI,EAAE8G,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,IAAI,MAAMl5C,EAAG,CACN,MAAM,QAAQA,CAAC,GAAKA,EAAE,SAAW,EAChC,KAAK,OAASA,EAEV,MAAM,QAAQA,CAAC,EACnB,KAAK,OAAS,CAACA,EAAE,CAAC,EAAGA,EAAE,CAAC,GAAKA,EAAE,CAAC,CAAC,EAGjC,KAAK,OAAS,CAACA,EAAGA,CAAC,EAEvB,KAAK,OAAM,CACd,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,OAAO,CAAC,CACvB,CAED,IAAI,OAAOk5C,EAAG,CACV,KAAK,OAAO,CAAC,EAAIA,EACjB,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,CAAC,CACvB,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,OAAO,CAAC,EAAIA,EACjB,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OAAO,CAAC,CACvB,CAED,oBAAoBrtC,EAAO,CACvB,MAAMsjD,EAAMnd,EAAW,4BAA4BnmC,CAAK,EACxD,OAAAsjD,EAAI,CAAC,GAAKA,EAAI,CAAC,EACfA,EAAI,CAAC,GAAKA,EAAI,CAAC,EACfA,EAAI,CAAC,GAAKA,EAAI,CAAC,EACR,IAAI,aAAaA,CAAG,CAC9B,CAED,cAAclD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,MAAM3tD,EAAQ2tD,EAAU,YAErB,KAAK,KACJ,KAAK,OAAO,CAAC,EAAI,KAAK,GAAK3tD,EAAM,GAElC,KAAK,KACJ,KAAK,OAAO,CAAC,EAAI,KAAK,GAAKA,EAAM,GAGlC,KAAK,UAAY,IAChB,KAAK,QAAUA,EAAM,EAAI,IAG7B,KAAK,YAAY,aAAc,KAAK,cAAe,KAAK,GAAG,UAAU,EACrE,KAAK,YAAY,OAAQ0zC,EAAW,4BAA4B,KAAK,GAAG,EAAE,CAAC,EAAG,KAAK,GAAG,SAAS,EAC/F,KAAK,YAAY,aAAc,KAAK,cAAe,KAAK,GAAG,UAAU,EACrE,KAAK,YAAY,QAAS,IAAI,aAAa,KAAK,MAAM,EAAI,KAAK,GAAG,UAAU,EAC5E,KAAK,YAAY,aAAc,IAAI,aAAa,CAAC1zC,EAAM,GAAIA,EAAM,EAAE,CAAC,EAAI,KAAK,GAAG,UAAU,EAC1F,KAAK,YAAY,QAAS2tD,EAAU,eAAe,CAAC,EAAE,cAAc,MAAO,KAAK,GAAG,SAAS,EAC5F,KAAK,YAAY,SAAW,KAAK,QAAS,KAAK,GAAG,SAAS,EAC3D,KAAK,YAAY,UAAa,KAAK,UAAY,KAAK,QAAU,KAAK,GAAG,SAAS,CAClF,CACL,CAEAkU,GAAqB,qBAAuB,48BC7I7B,MAAMC,WAAsB9mD,CAAc,CAErD,YAAY2wC,EAAK,CACb,MAAMA,CAAG,EAET,KAAK,UAAY,GACjB,KAAK,SAAW,GAChB,KAAK,OAAS,GAEd,KAAK,IAAM,EACX,KAAK,IAAM,EAEX,KAAK,GAAK,EACV,KAAK,QAAU,IACf,KAAK,QAAU,IACf,KAAK,QAAU,EAEf,KAAK,QAAU,EACf,KAAK,QAAU,CAClB,CAED,cAAcgC,EAAW,CACrB,MAAM,cAAcA,CAAS,EAE7B,IAAIoU,EAAKpU,EAAU,YACf56B,EAAUgvC,EAAG,QAEbC,EAAS,MAAM,KAAK,OAAO,EAAIjvC,EAAQ,OAASgvC,EAAG,EAAI,KAAK,QAC5DE,EAAS,MAAM,KAAK,OAAO,EAAIlvC,EAAQ,OAASgvC,EAAG,EAAI,KAAK,QAC5D7U,EAAS6U,EAAG,uBAAuBC,EAAQC,CAAM,EAIjDC,EAAK,CAAC,KAAK,MAAMH,EAAG,eAAe,GAAIA,EAAG,eAAe,EAAE,EAE3DpsD,EAAK,KAAK,GACd,KAAK,YAAY,QAAS,IAAI,aAAa,CAACu3C,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAG,KAAK,OAAO,CAAC,EAAGv3C,EAAG,UAAU,EAC/F,KAAK,YAAY,MAAO,IAAI,aAAa,CAAC,KAAK,IAAK,KAAK,IAAKusD,CAAE,CAAC,EAAGvsD,EAAG,UAAU,EAEjF,KAAK,YAAY,IAAK,KAAK,GAAIA,EAAG,SAAS,EAC3C,KAAK,YAAY,SAAU,KAAK,OAAQA,EAAG,SAAS,EACpD,KAAK,YAAY,SAAU,KAAK,OAAQA,EAAG,SAAS,EACpD,KAAK,YAAY,WAAY,KAAK,UAAWA,EAAG,SAAS,EACzD,KAAK,YAAY,UAAW,KAAK,SAAUA,EAAG,SAAS,EACvD,KAAK,YAAY,QAAS,KAAK,OAAQA,EAAG,SAAS,CACtD,CAED,IAAI,SAASjU,EAAG,CACZ,KAAK,UAAYA,EACjB,KAAK,OAAM,CACd,CAED,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CAED,IAAI,QAAQA,EAAG,CACX,KAAK,SAAWA,EAChB,KAAK,OAAM,CACd,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,MAAMA,EAAG,CACT,KAAK,OAASA,EACd,KAAK,OAAM,CACd,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,IAAK,CACL,OAAO,KAAK,GACf,CAED,IAAI,GAAGA,EAAG,CACN,KAAK,IAAMA,EACX,KAAK,OAAM,CACd,CAED,IAAI,IAAK,CACL,OAAO,KAAK,GACf,CAED,IAAI,GAAGA,EAAG,CACN,KAAK,IAAMA,EACX,KAAK,OAAM,CACd,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EAAI,EACnB,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EAAI,EACnB,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,OAAOA,EAAG,CACV,KAAK,QAAUA,EACf,KAAK,OAAM,CACd,CAED,YAAa,CACT,OAAQ,KAAK,MAAQ,GAAK,KAAK,MAAQ,GAAK,KAAK,KAAO,GAAK,KAAK,YAAc,GAAK,KAAK,WAAa,CAC1G,CAEL,CAEAogE,GAAc,mBAAqB,ylEAyEnCA,GAAc,qBAAuB,mkBCjOtB,MAAMK,WAA0BnnD,CAAc,CAEzD,YAAY2wC,EAAK,CACb,MAAMA,CAAG,EAET,KAAK,OAAS,GACd,KAAK,IAAM,EACX,KAAK,IAAM,EACX,KAAK,GAAK,CACb,CAED,cAAcgC,EAAW,CACrB,MAAM,cAAcA,CAAS,EAE7B,MAAMoU,EAAKpU,EAAU,YACf56B,EAAUgvC,EAAG,QAEbC,EAASjvC,EAAQ,OAASgvC,EAAG,EAC7BE,EAASlvC,EAAQ,OAASgvC,EAAG,EAC7B7U,EAAS6U,EAAG,uBAAuBC,EAAQC,CAAM,EAGjDC,EAAK,CAAC,KAAK,MAAMH,EAAG,eAAe,GAAIA,EAAG,eAAe,EAAE,EAE3DpsD,EAAK,KAAK,GAChB,KAAK,YAAY,QAAS,IAAI,aAAa,CAACu3C,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAG,CAAC,CAAC,EAAGv3C,EAAG,UAAU,EACpF,KAAK,YAAY,MAAO,IAAI,aAAa,CAAC,KAAK,IAAK,KAAK,IAAKusD,CAAE,CAAC,EAAGvsD,EAAG,UAAU,EACjF,KAAK,YAAY,IAAK,KAAK,GAAIA,EAAG,SAAS,EAC3C,KAAK,YAAY,QAAS,KAAK,OAAQA,EAAG,SAAS,CACtD,CAED,IAAI,MAAMjU,EAAG,CACT,KAAK,OAASA,EACd,KAAK,OAAM,CACd,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,MACf,CAED,IAAI,IAAK,CACL,OAAO,KAAK,GACf,CAED,IAAI,GAAGA,EAAG,CACN,KAAK,IAAMA,EACX,KAAK,OAAM,CACd,CAED,IAAI,IAAK,CACL,OAAO,KAAK,GACf,CAED,IAAI,GAAGA,EAAG,CACN,KAAK,IAAMA,EACX,KAAK,OAAM,CACd,CAED,IAAI,GAAI,CACJ,OAAO,KAAK,EACf,CAED,IAAI,EAAEA,EAAG,CACL,KAAK,GAAKA,EACV,KAAK,OAAM,CACd,CAED,YAAa,CACT,OAAQ,KAAK,MAAQ,GAAK,KAAK,MAAQ,GAAK,KAAK,KAAO,CAC3D,CAEL,CAEAygE,GAAkB,mBAAqB,0uDA4DvCA,GAAkB,qBAAuB,m1BCrI1B,MAAMC,WAAwBpnD,CAAc,CAC1D,YAAY5V,EAAS,CACnB,MAAMA,CAAO,EACb,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,QAAU,EACf,KAAK,eAAiB,EACvB,CAED,IAAI,GAAI,CACN,OAAO,KAAK,EACb,CAED,IAAI,EAAE1D,EAAG,CACP,KAAK,GAAKA,EACV,KAAK,OAAM,CACZ,CAED,IAAI,GAAI,CACN,OAAO,KAAK,EACb,CAED,IAAI,EAAEA,EAAG,CACP,KAAK,GAAKA,EACV,KAAK,OAAM,CACZ,CAED,IAAI,GAAI,CACN,OAAO,KAAK,EACb,CAED,IAAI,EAAEA,EAAG,CACP,KAAK,GAAKA,EACV,KAAK,OAAM,CACZ,CAED,IAAI,GAAI,CACN,OAAO,KAAK,EACb,CAED,IAAI,EAAEA,EAAG,CACP,KAAK,GAAKA,EACV,KAAK,OAAM,CACZ,CAED,IAAI,eAAgB,CAClB,OAAO,KAAK,cACb,CAED,IAAI,cAAcA,EAAG,CACnB,KAAK,eAAiBA,EACtB,KAAK,OAAM,CACZ,CAED,IAAI,QAAS,CACX,OAAO,KAAK,OACb,CAED,IAAI,OAAOA,EAAG,CACZ,KAAK,QAAUA,EACf,KAAK,OAAM,CACZ,CAED,cAAcisD,EAAW,CACvB,MAAM,cAAcA,CAAS,EAE7B,MAAM3tD,EAAQ2tD,EAAU,YAClB2T,EAAkB,KAAK,IAAI,MAAM,mBAAkB,EACzD,KAAK,YAAY,IAAK,KAAK,GAAKA,EAAiB,KAAK,GAAG,SAAS,EAClE,KAAK,YAAY,IAAK,KAAK,GAAKA,EAAiB,KAAK,GAAG,SAAS,EAClE,KAAK,YAAY,IAAK,KAAK,GAAKA,EAAiB,KAAK,GAAG,SAAS,EAClE,KAAK,YAAY,IAAK,KAAK,GAAKA,EAAiB,KAAK,GAAG,SAAS,EAClE,KAAK,YAAY,gBAAiB,KAAK,eAAgB,KAAK,GAAG,SAAS,EACxE,KAAK,YACN,UACC,KAAK,QAAU,IAAOA,EACvB,KAAK,GAAG,SACV,EACG,KAAK,YACN,aACA,IAAI,aAAa,CACfthE,EAAM,GAAKshE,EACXthE,EAAM,GAAKshE,CACf,CAAG,EACD,KAAK,GAAG,UACV,CACE,CAED,YAAa,CACX,OAAO,KAAK,KAAO,GAAK,KAAK,KAAO,CACrC,CACC,CAEDc,GAAgB,mBAAqBpnD,EAAc,mBAEnDonD,GAAgB,qBAAuB,2kCChG1B,MAAMC,WAAuBrnD,CAAc,CACtD,YAAY5V,EAAS,CACjB,MAAMA,CAAO,EACb,KAAK,QAAU,EACf,KAAK,QAAU,EACf,KAAK,SAAW,GAChB,KAAK,WAAa,GAClB,KAAK,IAAM,WACX,KAAK,cAAgB,KAAK,oBAAoB,KAAK,GAAG,EACtD,KAAK,GAAK,WACV,KAAK,aAAe,KAAK,oBAAoB,KAAK,EAAE,CACvD,CAED,IAAI,OAAO1D,EAAG,CACPA,IAAM,IACLA,EAAI,GAER,KAAK,QAAUA,CAClB,CAED,IAAI,OAAOjB,EAAO,CACd,KAAK,QAAU,KAAK,IAAIA,CAAK,CAChC,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,IAAI,MAAMqzC,EAAM,CACZ,KAAK,GAAKA,EACV,KAAK,aAAe,KAAK,oBAAoBA,CAAI,CACpD,CAED,IAAI,OAAQ,CACR,OAAO,KAAK,EACf,CAED,IAAI,gBAAgBA,EAAM,CACtB,KAAK,IAAMA,EACX,KAAK,cAAgB,KAAK,oBAAoBA,CAAI,CACrD,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,GACf,CAED,IAAI,QAAQwuB,EAAM,CACd,KAAK,SAAWA,CACnB,CAED,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CAED,IAAI,UAAUA,EAAM,CAChB,KAAK,WAAaA,CACrB,CAED,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CAED,IAAI,OAAO5gE,EAAG,CACV,KAAK,QAAUA,CAClB,CAED,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CAED,oBAAoB6L,EAAO,CACvB,MAAMsjD,EAAMnd,EAAW,4BAA4BnmC,CAAK,EACxD,OAAAsjD,EAAI,CAAC,GAAKA,EAAI,CAAC,EACfA,EAAI,CAAC,GAAKA,EAAI,CAAC,EACfA,EAAI,CAAC,GAAKA,EAAI,CAAC,EACR,IAAI,aAAaA,CAAG,CAC9B,CAED,cAAclD,EAAW,CACrB,MAAM,cAAcA,CAAS,EAC7B,MAAM3tD,EAAQ2tD,EAAU,YAClBp/B,EAAS,KAAK,SAAYvuB,EAAM,GAAK,EAExC,KAAK,UAAY,IAChB,KAAK,QAAUuuB,EAAS,KAG5B,KAAK,YAAY,aAAc,IAAI,aAAa,CAACvuB,EAAM,GAAIA,EAAM,EAAE,CAAC,EAAI,KAAK,GAAG,UAAU,EAC1F,KAAK,YAAY,QAAS,KAAK,aAAc,KAAK,GAAG,UAAU,EAC/D,KAAK,YAAY,kBAAmB,KAAK,cAAe,KAAK,GAAG,UAAU,EAC1E,KAAK,YAAY,SAAW,KAAK,QAAS,KAAK,GAAG,SAAS,EAC3D,KAAK,YAAY,SAAWuuB,EAAQ,KAAK,GAAG,SAAS,EACrD,KAAK,YAAY,YAAc,KAAK,WAAa,GAAK,EAAG,KAAK,GAAG,SAAS,EAC1E,KAAK,YAAY,UAAW,CAAC,CAAC,KAAK,SAAU,KAAK,GAAG,SAAS,EAC9D,KAAK,YAAY,OAAQ,KAAK,IAAG,EAAK8zC,GAAe,SAAU,KAAK,GAAG,SAAS,EAChF,KAAK,YAAY,SAAU,KAAK,QAAS,KAAK,GAAG,SAAS,EAC1D,KAAK,YAAY,QAAS1U,EAAU,eAAe,CAAC,EAAE,cAAc,MAAO,KAAK,GAAG,SAAS,GAEzF,KAAK,MAAQ,KAAK,KAAO,KAAK,UAAYp/B,EAAS,KAClD,KAAK,OAAM,CAElB,CACL,CAEA8zC,GAAe,SAAW,KAAK,MAE/BA,GAAe,qBAAuB,u/CCjDtC,MAAME,GAAY,CACd,YAAAvI,GACA,UAAA7O,GACA,KAAAjV,GACJ,MAAIX,EACA,WAAA7B,EACA,QAAA0R,EACA,MAAAkX,GACA,MAAA9wC,GACA,YAAAkxB,GACA,kBAAAJ,GACA,QAAA9gC,GACA,aAAA3P,EACA,QAAS,CACL,UAAWy0D,GACX,QAASvB,GACT,UAAW2B,GACX,aAAcC,GACd,UAAWE,GACX,WAAY/B,GACZ,QAASgC,GACT,SAAUK,GACV,aAAcC,GACd,iBAAkBC,GAClB,SAAUgB,GACV,QAASb,GACT,KAAMI,GACN,SAAUF,GACV,QAASC,GACT,eAAgBE,GAChB,QAASC,GACT,YAAaK,GACb,UAAWC,GACX,YAAA9T,GACR,mBAAQiS,EACA,UAAA7Q,GACR,iBAAQ+Q,GACA,IAAK,CACD,UAAWD,GACX,KAAMpB,EACT,CACJ,EACD,SAAU,CACN,iBAAA3F,GACA,aAAAz9C,GACA,YAAAioC,GACA,aAAAnoC,GACA,YAAA8hD,GACA,cAAAE,GACA,oBAAAzB,GACA,cAAA/X,EACH,EACD,WAAY,CACR,kBAAA2a,GACA,eAAAa,GACA,qBAAAE,GACA,gBAAAK,GACA,cAAAtC,EACH,EACD,MAAO,CACH,UAAAjB,GACA,gBAAAW,GACA,kBAAAC,EACH,CACL,EAEInoB,EAAM,QACN,OAAO,IAAMgtB,IAGjB,MAAA7yC,GAAe6yC,GClITz2D,GAAW,CAAE,EACb02D,GAAc,CAAE,EAQhBC,GAAU,CAACz/D,EAAKvC,IAAU,CAC9B+hE,GAAYx/D,CAAG,GAAKw/D,GAAYx/D,CAAG,EAAE,QAAQ0/D,GAAcA,EAAWjiE,CAAK,CAAC,CAC9E,EAEMkiE,GAAU,CAACr2C,EAAM,CAAE,EAAEtpB,IAAQ,CACjC,GAAIspB,IAAQ,KAAM,OAClB,MAAMhjB,EAAOtG,EAAI,MAAM,GAAG,EAC1B,QAAS,EAAI,EAAG,EAAIsG,EAAK,OAAQ,IAC/BgjB,EAAMA,EAAIhjB,EAAK,CAAC,CAAC,EAAIgjB,EAAIhjB,EAAK,CAAC,CAAC,IAAM,OAAYgjB,EAAIhjB,EAAK,CAAC,CAAC,EAAI,CAAE,EAErE,OAAO,OAAOgjB,GAAQ,UAAYA,IAAQ,KAAQ,OAAO,KAAKA,CAAG,EAAE,OAASA,EAAM,OAAaA,CACjG,EAEes2C,GAAA,CACb,IAAI5mE,EAAMgH,EAAKuH,EAAW,OAAW,CACnC,MAAM5G,EAAMg/D,GAAQ72D,GAAS9P,CAAI,EAAGgH,CAAG,EACvC,OAAOW,IAAQ,OAAYA,EAAM4G,CAClC,EACD,IAAIvO,EAAMgH,EAAK,CACb,MAAO,CAAC,CAAC,KAAK,IAAIhH,EAAMgH,CAAG,CAC5B,EACD,IAAIA,EAAKvC,EAAO,CACdqL,GAAS,KAAQ9I,CAAG,EAAIvC,EACxBgiE,GAAQz/D,EAAKvC,CAAK,CACnB,EACD,UAAUuC,EAAKypB,EAAU,CACvB+1C,GAAYx/D,CAAG,EAAIw/D,GAAYx/D,CAAG,GAAK,CAAE,EACzCw/D,GAAYx/D,CAAG,EAAE,KAAKypB,CAAQ,CAC/B,EACD,YAAYzpB,EAAKypB,EAAU,CACzB,GAAIA,EAAU,CACZ,MAAM/lB,EAAQ87D,GAAYx/D,CAAG,GAAKw/D,GAAYx/D,CAAG,EAAE,UAAUi5C,GAAMA,IAAOxvB,CAAQ,EAClF/lB,EAAQ,IAAM87D,GAAYx/D,CAAG,EAAE,OAAO0D,EAAO,CAAC,CACpD,MACU1D,KAAOw/D,KACTA,GAAYx/D,CAAG,EAAI,CAAE,EAG1B,EACD,kBAAmB,CACjB,UAAWA,KAAO,OAAO,oBAAoBw/D,EAAW,EACtD,OAAOA,GAAYx/D,CAAG,CAEzB,CACH,ECrDa6/D,GAAW,6BACXC,GAAa,UACbC,GAAc,uBACdC,GAAe,OAQfC,GAAa,CAACxsC,EAAOhP,EAAO,OAInCo7C,GAAS,KAAKpsC,CAAK,IACrBA,EAAQA,EAAM,QAAQosC,GAAUp7C,CAAI,GAE/BgP,GCbIysC,GAAiB3nB,GAAS,CACrC,MAAMjjC,EAAM,IAAI,IAGf,OAAC,GAAG,OAAO,KAAKijC,CAAK,EAAG,GAAG,OAAO,sBAAsBA,CAAK,CAAC,EAAE,QAAQv4C,GAAO,CAC9EsV,EAAI,IAAItV,EAAKu4C,EAAMv4C,CAAG,CAAC,CAC3B,CAAG,EACMsV,CACT,ECXM6qD,GAAU,CAACnnE,EAAMgwB,IAAS,CAC9B,MAAMjS,EAAS,CACb,KAAM,QACN,MAAO,OACP,KAAM,SACN,MAAO,KACR,EAED,OAAAiS,EAAO,MAAM,KAAKA,CAAI,EACf,CACL,MAAQA,EAAK,OAAS,GAAK,OAAOA,EAAK,CAAC,GAAM,SAAWA,EAAK,MAAK,EAAKhwB,GACxE,qBAAuB+d,EAAO/d,CAAI,EAAI,uDACtCgwB,CACD,CACH,EAEeo3C,GAAA,CACb,MAAO,CACLC,GAAS,IAAI,WAAY,KAAK,GAAK,QAAQ,IAAI,MAAM,QAASF,GAAQ,OAAQ,SAAS,CAAC,CACzF,EACD,OAAQ,CACNE,GAAS,IAAI,WAAY,KAAK,GAAK,QAAQ,MAAM,MAAM,QAASF,GAAQ,QAAS,SAAS,CAAC,CAC5F,EACD,OAAQ,CACNE,GAAS,IAAI,WAAY,KAAK,GAAK,QAAQ,MAAM,MAAM,QAASF,GAAQ,QAAS,SAAS,CAAC,CAC5F,EACD,MAAO,CACLE,GAAS,IAAI,WAAY,KAAK,GAAK,QAAQ,KAAK,MAAM,QAASF,GAAQ,OAAQ,SAAS,CAAC,CAC1F,CACH,EC3Be,MAAMG,EAAQ,CAC3B,YAAYvqC,EAAO,GAAIwqC,EAASC,EAAa,CAM3C,KAAK,MAAQzqC,EAOb,KAAK,aAAeyqC,EAOpB,KAAK,UAAY,IAAI,IAQrB,KAAK,WAAa,GAQlB,KAAK,kBAAoB,GAOzB,KAAK,WAAa,GAQlB,KAAK,oBAAsB,KAIvBC,GAASF,CAAO,EAClB,KAAK,UAAYL,GAAeK,CAAO,EAC9BG,GAAUH,CAAO,IAI1B,KAAK,aAAeA,GAItB,KAAK,UAAU,IAAII,GAAQ,MAAO,KAAK,YAAY,CACpD,CAED,QAAS,CACPC,GAAI,MAAM,YAAa,aAAa,YAAK,MAAO,EAChD,KAAK,WAAa,EACnB,CAED,IAAI,KAAM,CACR,OAAO,KAAK,KACb,CAED,IAAI,UAAW,CACb,OAAO,KAAK,SACb,CAED,IAAI,MAAO,CACT,OAAO,KAAK,KACb,CAED,IAAI,KAAK53C,EAAM,CACb,KAAK,MAAQA,CACd,CAED,IAAI,OAAQ,CACV,OAAO,KAAK,MACb,CAED,IAAI,MAAMA,EAAM,CACd,KAAK,OAASA,CACf,CAED,IAAI,UAAW,CACb,OAAO,KAAK,SACb,CAED,IAAI,SAASA,EAAM,CACjB,KAAK,UAAYA,CAClB,CAED,IAAI,cAAe,CACjB,OAAO,KAAK,aACb,CAED,IAAI,aAAaA,EAAM,CACrB,KAAK,cAAgBA,CACtB,CAED,IAAI,KAAKA,EAAM,CACb,KAAK,MAAQA,CACd,CAED,IAAI,MAAO,CACT,OAAO,KAAK,KACb,CAED,IAAI,UAAUA,EAAM,CAClB,KAAK,WAAaA,CACnB,CAED,IAAI,WAAY,CACd,OAAO,KAAK,UACb,CAED,IAAI,kBAAmB,CACrB,OAAO,KAAK,iBACb,CAED,IAAI,iBAAiBA,EAAM,CACzB,KAAK,kBAAoBA,CAC1B,CAED,IAAI,aAAc,CAChB,OAAO,KAAK,UACb,CAED,IAAI,mBAAmBtqB,EAAG,CACxB,KAAK,oBAAsBA,CAC5B,CAED,IAAI,oBAAqB,CACvB,OAAO,KAAK,mBACb,CACH,CCvJe,MAAMq6B,EAAM,CACzB,YAAYjQ,EAAS,GAAI,CAEvB,IAAI9vB,EAAO,CAAC,KAAM,SAAU,OAAO,EAAE,OAAO,CAACme,EAAKne,IACzCysD,GAAW38B,EAAO9vB,CAAI,CAAC,EAAIA,EAAOme,EACxC,MAAS,EAEZ,KAAK,KAAO2R,EACR9vB,IACF,KAAK,UAAY,CACf,KAAAA,EACA,QAAS8vB,EAAO9vB,CAAI,CACrB,EAEJ,CAED,IAAI,MAAO,CACT,OAAO,KAAK,KAAK,IAClB,CAED,IAAI,MAAO,CACT,OAAO,KAAK,KAAK,IAClB,CAED,IAAI,WAAY,CACd,OAAO,KAAK,KAAK,SAClB,CAED,IAAI,SAAU,CACZ,OAAO,KAAK,KAAK,OAClB,CAED,IAAI,SAAU,CACZ,OAAO,KAAK,KAAK,OAClB,CAED,IAAI,OAAQ,CACV,OAAO,KAAK,KAAK,KAClB,CAED,IAAI,MAAO,CACT,OAAO,KAAK,KAAK,IAClB,CAED,IAAI,gBAAiB,CACnB,OAAO,KAAK,KAAK,cAClB,CAED,IAAI,UAAW,CACb,OAAO,KAAK,SACb,CACH,CC1CO,MAAM6nE,GAAWptC,GACfwsC,GAAWxsC,CAAK,EAAE,MAAM,GAAG,EAAE,OAQhCqtC,GAAmBC,GAAS,CAChC,MAAM1lE,EAAU,CAAE,EAElB,OAAS,CAACo4B,CAAK,IAAKwB,GAAO,QAAO,EAC5B4rC,GAASptC,CAAK,IAAMstC,GACtB1lE,EAAQ,KAAKo4B,CAAK,EAGtB,OAAOp4B,CACT,EASa2lE,GAAiBjrC,GAAQ,CAEpCA,EAAOA,EAAK,QAAQ,KAAM,EAAE,EAE5B,MAAMkrC,EAAc,gBAEdhI,EAAa6H,GAAiBD,GAAS9qC,CAAI,CAAC,EAE5CmrC,EAAYnrC,EAAK,MAAMkrC,CAAW,GAAK,CAAE,EAM/C,IAAIE,EAAa,CAAE,EAEf9lE,EAAU49D,EAAW,OAAOxlC,GAAS,CACvC,IAAI2tC,EAAa,GAEjB,GAAIvB,GAAS,KAAKpsC,CAAK,EAAG,CACxB,MAAM4tC,EAAa5tC,EAAM,MAAMosC,EAAQ,EACnCwB,GAAcA,EAAW,SAC3B5tC,EAAQ4tC,EAAW,OAAO,CAACC,EAAWC,IAAU,CAC9C,MAAM/jB,EAAW2jB,EAAW,OAC5B,OAAAG,EAAYA,EAAU,QAAQC,EAAO,KAAK,OAAA/jB,EAAQ,KAAI,EACtD2jB,EAAW,KAAKI,EAAM,UAAU,EAAGA,EAAM,OAAS,CAAC,CAAC,EAC7CD,CACR,EAAE7tC,CAAK,EAEX,CAED,MAAM+tC,EAAa/tC,EAAM,MAAMwtC,CAAW,GAAK,CAAE,EAEjD,QAAS3nE,EAAI,EAAGqL,EAAI68D,EAAW,OAAQloE,EAAIqL,EAAGrL,IAAK,CACjD,MAAMmoE,EAAYD,EAAWloE,CAAC,EACxBooE,EAAWR,EAAU5nE,CAAC,EAK5B,GAAIymE,GAAY,KAAK0B,CAAS,EAAG,CAE/B,MAAME,EADe5B,GAAY,KAAK0B,CAAS,EAClB,CAAC,EACxBG,EAAaT,EAAWQ,CAAO,EAKvBN,EAAa,2BAA2B,KAAKO,CAAU,EAErE,GAAIP,GAAcA,EAAW,OAAQ,CACnC,MAAMQ,EAAaR,EAAW,CAAC,EACzBS,EAAYT,EAAW,CAAC,EAEhB,IAAI,OAAO,KAAK,OAAAQ,EAAU,KAAKC,CAAS,EAE3C,KAAKJ,CAAQ,IACtBN,EAAa,GAEhB,CACF,KAAM,IAAIpB,GAAa,KAAKyB,CAAS,EAGpC,SACSC,GAAYD,EAAU,YAAW,IAAOC,EAAS,gBAC1DN,EAAa,IAEhB,CACD,OAAOA,CACX,CAAG,EAED,GAAI/lE,EAAQ,QACV,GAAIA,EAAQ,QAAQ06B,CAAI,IAAM,GAAI,CAChC,MAAM/C,EAAQ33B,EAAQA,EAAQ,QAAQ06B,CAAI,CAAC,EAC3C,OAAOd,GAAO,IAAIjC,CAAK,CAC7B,SAEM33B,EAAUA,EAAQ,KAAKM,GACdqkE,GAAa,KAAKrkE,CAAC,EAAI,GAAK,CACpC,EAGGomE,GAAY1mE,EAAQ,CAAC,CAAC,EACxB,OAAO45B,GAAO,IAAI55B,EAAQ,CAAC,CAAC,EAIlC,MAAO,EACT,EAEa2mE,GAAoB,CAACjsC,EAAO,GAAIpE,IAAS,CAGpDA,EAAOsuC,GAAWtuC,EAAM,EAAE,EAE1B,MAAMsvC,EAAc,sBACdC,EAAYnrC,EAAK,MAAMkrC,CAAW,GAAK,CAAE,EACzCO,EAAa7vC,EAAK,MAAMsvC,CAAW,GAAK,CAAE,EAC1CgB,EAAgB,kBAEtB,OAAOT,EAAW,OAAO,CAACU,EAASzkE,EAAOiG,IAAU,CAClD,MAAMsvB,EAAQivC,EAAc,KAAKxkE,CAAK,EACtC,OAAIu1B,GAASA,EAAM,QACjBkvC,EAAQ,IAAIlvC,EAAM,CAAC,EAAG,mBAAmBkuC,EAAUx9D,CAAK,EAAE,QAAQ,MAAO,EAAE,CAAC,CAAC,EAExEw+D,CACX,EAAK,IAAI,GAAK,CACd,EAEaC,GAAY,CAAChtC,EAAO9K,IAAS,CAEtC,GAAG8K,GAASA,EAAM,eAAe9K,CAAI,EACrC,OAAO8K,EAAM9K,CAAI,CAIrB,EAMa+3C,GAAct5C,GAAU,CAGnC,GAAIA,EAAO,OAAS,IAAK,CACvB,IAAIprB,EAAU,CACZ,eAAgB,EACjB,EACG+iE,GAAS33C,EAAO,OAAO,IACzBprB,EAAU,CACR,GAAGorB,EAAO,QACV,GAAGprB,CACJ,GAEHorB,EAAO,QAAUprB,EAGb2kE,KACFv5C,EAAO,MAAQu5C,GAElB,CACD,OAAO,IAAItpC,GAAMjQ,CAAM,CACzB,EASaw5C,GAAgB,CAACroE,EAAK+uB,EAAM8/B,IAChC,IAAIwX,GAAQrmE,EAAK+uB,EAAM8/B,CAAK,EAGxByZ,GAAgBj5C,GAAO,CAClC,GAAI,CAACA,EAAI,IAAM,CAACA,EAAI,KAClB,MAAO,GAET,MAAMmK,EAAQ+uC,GAAel5C,EAAI,IAAMA,EAAI,IAAI,EACzCm5C,EAAkB,iBACxB,IAAI1sC,EAAOtC,EAIX,OAAIgvC,EAAgB,KAAKhvC,CAAK,IACxBnK,EAAI,SAENyM,EADa,OAAO,KAAKzM,EAAI,MAAM,EACvB,OAAO,CAACnS,EAAKnX,IAChBmX,EAAI,QAAQ,IAAI,OAAAnX,GAAOspB,EAAI,OAAOtpB,CAAG,CAAC,EAC5CyzB,CAAK,GAENnK,EAAI,OACC,GAAG,OAAAyM,GAAO,OAAA2sC,GAAoBp5C,EAAI,KAAK,GAG3CyM,CACT,EAEMysC,GAAiBn7D,GAAQ,CAC7B,OAAS,CAACsqB,EAAM8B,CAAK,IAAKwB,GAAO,QAAO,EACtC,GAAIxB,EAAM,OAASpsB,EACjB,OAAOsqB,EAGX,MAAO,EACT,EAEagxC,GAAsB,CAAClvC,EAAOu8B,IAAY,CACrD,GAAI9mC,GAASuK,CAAK,EAAG,CACnB,MAAMwB,EAAS2tC,GAAW,EAC1B,GAAI3tC,EAAO,IAAIxB,CAAK,EAClBA,EAAQwB,EAAO,IAAIxB,CAAK,MAExB,OAAO,EAEV,CAED,MAAMovC,EAAW7S,EAAQ,SACnB8S,EAAervC,EAAM,QAE3B,OAAIovC,EAAS,IAAI,WAAW,EACnBA,EAAS,IAAI,WAAW,EACtBC,GAAgBA,EAAa,UAC/BA,EAAa,UAGf,EACT,ECrPeC,GAAA,CAACx7B,EAAMwwB,EAAS,GAAIzlC,EAAS,KAAO,CAC5CrxB,GAAQ82D,CAAM,IACjBA,EAAS,CAACA,CAAM,GAElBA,EAAO,QAAQx/D,GAAK,CAClB,MAAMH,EAAQ,MAAM,OAAA4qE,GAAQzqE,CAAC,GACzBktD,GAAWle,EAAKnvC,CAAK,CAAC,GACxBmvC,EAAKnvC,CAAK,EAAEk6B,CAAM,CAExB,CAAG,CACH,ECRA,IAAI2wC,GAAe,KAEZ,MAAMC,GAAgB,IAAM,CACjC,GAAKC,GAGL,OAAOA,GAAY,IAAK,EAAC,OAAO,CAACjB,EAASkB,IAAW,CACnD,MAAMpjE,EAAMojE,EAAO,IAAI,YAAa,EACpC,OAAAlB,EAAQliE,CAAG,EAAIojE,EACRlB,CACR,EAAE,EAAE,CACP,EAOamB,GAAgB,CAACC,EAAS/7B,IAAS,CAE9C,MAAMg8B,GAAcD,GAAW,CAAE,GAAE,IAAIrwD,GAAOA,EAAI,aAAa,EAE/DkwD,GAAY,QAAQC,GAAU,CAC5BA,EAAO,QAAUG,EAAW,QAAQH,EAAO,IAAI,aAAa,IAAM,GAC9DA,EAAO,SACTL,GAAKK,EAAQ,CAAC,WAAW,EAAG77B,CAAI,CAEtC,CAAG,EACG/rC,EAAI,QAAU,WAAaynE,IAAgB,CAACA,GAAa,SAC3DznE,EAAI,UAAU,EAAE,CAEpB,EAEMgoE,GAAkBn8D,IACtBA,EAAO27D,GAAQ37D,CAAI,EACZ87D,GAAY,SAAS97D,CAAI,GAAK,IAO1Bo8D,GAAcp8D,GAAQ,CACjC,MAAM+7D,EAASI,GAAgBn8D,CAAI,EAC/B+7D,IACFM,GAAgBN,CAAM,EAMlB5nE,EAAI,QAAU,UAChBA,EAAI,OAAOynE,EAAY,EAEvBznE,EAAI,UAAU,UAAW,CAACynE,EAAY,CAAC,EAG7C,EAUaU,GAAe,IAAM,CAChCV,GAAe,KACfznE,EAAI,UAAU,EAAE,CAClB,EAEaooE,GAAkB,IACtBX,GAGIS,GAAkBG,GAAY,CACzCZ,GAAeY,CACjB,EChFap+D,GAAkB,CAACwK,EAAOjX,IAC9BiX,EAAM,EAAE,CACb,KAAAjX,EACA,QAAS,GACT,QAASkqE,GAAe,CAC5B,CAAG,ECGH,IAAI7+B,GAAU,CAAE,EAET,MAAMy/B,GAAgB9T,GAAW,CACtC,MAAMj6B,EAAOguC,GAAe,EAC5B,GAAI,CAAChuC,EACH,OAKF,MAAMiuC,EADWhU,EAAQ,SACW,IAAI2Q,GAAQ,KAAK,EAG/CsD,EAAcjD,GAAejrC,CAAI,EACjCmuC,EAAiB/B,GAAU8B,EAAY,QAAS,gBAAgB,EAKtE,GAFYvD,GAAUsD,CAAkB,EAAIA,EAAqB,CAACE,EAEvD,CACT,MAAMC,EAAUpuC,EAAK,QAAQ,MAAO,EAAE,EAChClD,EAAWuxC,GAAkBD,CAAO,EACpCE,EAAcC,GAAeC,GAAa,EAAIvU,CAAO,EACrDwU,EAAeC,GAAiB,EAItC,GAAI5xC,IAAa,IAAM2xC,EAAa,IAAI,eAAe,EACrDngC,GAAQ,KAAK,CAAE,KAAM8/B,EAAS,MAAOE,EAAa,MAC7C,CAEL,MAAM1iE,EAAO0iC,GAAQ,OAAOxR,EAAU,CAAC,EAAE,CAAC,EAC1CwR,GAAQ,KAAK,CAAE,KAAM1iC,EAAK,KAAM,MAAO0iE,EAAa,CACrD,CACF,CACH,EAEMD,GAAoBruC,GAAQ,CAChC,QAASz8B,EAAI,EAAGA,EAAI+qC,GAAQ,OAAQ/qC,IAClC,GAAI+qC,GAAQ/qC,CAAC,EAAE,OAASy8B,EACtB,OAAOz8B,EAGX,MAAO,EACT,EAEaorE,GAAkB3uC,GAAQ,CACrC,IAAIn2B,EAAQ,KACZ,OAAIykC,GAAQ,SAGLtO,EAKCquC,GAAkBruC,CAAI,IAAM,KAE9Bn2B,EADeykC,GAAQ+/B,GAAkBruC,CAAI,CAAC,EAC/B,OAJjBn2B,EAFeykC,GAAQA,GAAQ,OAAS,CAAC,EAE1B,OAQZzkC,CACT,EAEa+kE,GAAsB,CAAC/kE,EAAQ,KAAMm2B,IAAS,CACzD,GAAI,CAACsO,GAAQ,OACX,OAEF,MAAMxR,EAAWkD,EAAOquC,GAAkBruC,CAAI,EAAIsO,GAAQ,OAAS,EAC/DxR,IAAa,IAAM4tC,GAAS7gE,CAAK,IACnCykC,GAAQxR,CAAQ,EAAE,MAAQjzB,EAE9B,EAEM0kE,GAAiB,CAAC/8B,EAAMyoB,IAAY,CAGxC,GAAIA,EAAQ,kBACV,GAAIA,EAAQ,mBACV,OAAOA,EAAQ,2BAERzoB,GAAQke,GAAWle,EAAK,YAAY,EAC7C,OAAOA,EAAK,aAAc,EAE5B,OAAO,IACT,EAEaq9B,GAAa,IACjBvgC,GAAQ,MAAM,CAAC,EAGXwgC,GAAa,CAAClyB,EAAM,KAAO,CAClC1xC,GAAQ0xC,CAAG,IACbtO,GAAUsO,EAEd,ECxGe,MAAMmyB,WAAmBC,GAAU,QAAQ,kBAAmB,CAC3E,IAAI,WAAWrmE,EAAG,CAChB,KAAK,aAAeA,EAAI,IAAM,IAC9B,KAAK,OAAQ,CACd,CAED,IAAI,SAASA,EAAG,CACd,KAAK,WAAaA,EAAI,IAAM,IAC5B,KAAK,OAAQ,CACd,CAED,IAAI,MAAMA,EAAG,CACX,KAAK,QAAUA,EAAI,IAAM,IACzB,KAAK,OAAQ,CACd,CAED,cAAcisD,EAAW,CACvB,MAAM,cAAcA,CAAS,EAC7B,MAAMh4C,EAAK,KAAK,GAChB,KAAK,YACH,cACA,CAAC,KAAK,aAAe,EAAK,KAAK,WAAa,EAAK,KAAK,QAAU,CAAG,EACnEA,EAAG,UACJ,CACF,CACH,CAEAmyD,GAAW,OAAS,ihBAkBpBA,GAAW,MAAQ,stBC7CJ,MAAME,WAAyBF,EAAW,CAAE,CAE3DE,GAAiB,qBAAuB,SAClC,OAAAF,GAAW,OAAM,inBAiBjB,OAAAA,GAAW,MAAK,OCpBP,MAAMG,WAA2BH,EAAW,CAAE,CAE7DG,GAAmB,qBAAuB,SACpC,OAAAH,GAAW,OAAM,6mBAiBjB,OAAAA,GAAW,MAAK,UCpBP,MAAMI,WAAyBJ,EAAW,CAAE,CAE3DI,GAAiB,qBAAuB,SAClC,OAAAJ,GAAW,OAAM,4oBAiBjB,OAAAA,GAAW,MAAK,OCpBP,MAAMK,WAAsBL,EAAW,CAAE,CAExDK,GAAc,qBAAuB,SAC/B,OAAAL,GAAW,OAAM,8EAKjB,OAAAA,GAAW,MAAK,MCRP,MAAMM,WAA2BN,EAAW,CAAE,CAE7DM,GAAmB,qBAAuB,SACpC,OAAAN,GAAW,OAAM,gLAMjB,OAAAA,GAAW,MAAK,MCVtB,SAAS7nC,GAAeC,EAAS,GAAI,CACnC,MAAMC,EAAkB,CAAE,EAE1B,QAAS7jC,EAAI,EAAGA,EAAI4jC,EAAO,SACrB,OAAOA,EAAO5jC,CAAC,GAAM,UAAY,CAAC4jC,EAAO5jC,CAAC,EAAE,SAAS,QAAQ,GADhCA,IAE/B6jC,EAAgB,KAAKD,EAAO5jC,CAAC,CAAC,EASlC,MAAO,CAAC6jC,EAAgB,KAAK,MAAM,CAAC,EAAE,OAAOD,EAAO,MAAM5jC,CAAC,CAAC,CAC9D,CAEA,SAAS8jC,GAAMC,EAAO,CACpB,OAAO,IAAI,QAAQvvB,GAAW,CAC5B,WAAWA,EAASuvB,CAAK,CAC7B,CAAG,CACH,CASA,SAASC,GAAMC,EAAQC,EAAYC,EAAO,QAAS,CACjD,MAAMC,EAAQ,OAAO,gBACrB,OAAO,IAAI,QAAQ,CAAC5vB,EAAS6vB,IAAW,CACtC,MAAMC,EAAY,IAAI,yBAAyBL,CAAM,EACrDK,EAAU,KAAOH,EACjBG,EAAU,MAAQ,IAAM,CACtB9vB,EAAS,CACV,EACD8vB,EAAU,QAAUrlC,GAAK,CACvBolC,EAAOplC,CAAC,CACT,EACDilC,EAAW,KAAKI,CAAS,EACzBF,EAAM,MAAME,CAAS,CACzB,CAAG,CACH,CAEA,SAASC,GAAYX,EAAQO,EAAMtgC,EAAO,GAAM,CAC9C,MAAMugC,EAAQ,OAAO,gBACfI,EAAmBb,GAAe,MAAM,QAAQC,CAAM,EAAIA,EAAS,CAACA,CAAM,CAAC,EAC3Ea,EAAsB,CAAE,EAMxBP,EAAa,CAAE,EACrB,IAAIQ,EAAS,GA0Db,MAAO,CACL,QAzDmB,SAAY,CAC/B,GAAI,CACF,KAAOA,GAAUF,EAAiB,QAAQ,CACxC,MAAMP,EAAS,MAAM,QAAQ,QAAQO,EAAiB,MAAK,CAAE,EAC7D,GAAKE,GAIE,GAAI,OAAOT,GAAW,UAAYA,EAAO,SAAS,QAAQ,EAAG,CAElE,IAAIF,EAAQE,EAAO,MAAM,QAAQ,EAAE,CAAC,EAAI,IACpC,MAAMF,CAAK,IACbA,EAAQ,GAEV,MAAMD,GAAMC,CAAK,CAClB,SAAU,OAAOE,GAAW,UAAYA,EAAO,OAAQ,CAGtD,IAAIU,EAAc,EAClB,KAAOD,GAAUC,EAAc,GAC7B,GAAI,CACF,MAAMX,GAAMC,EAAQC,EAAYC,CAAI,EACpCQ,EAAc,CACf,OAAQ1lC,EAAG,CAEV,GAAIA,aAAa,0BACf,GAAIA,EAAE,QAAU,UACd0lC,IACA,QAAQ,KAAK,iDAAiD,OAAAA,EAAa,EAC3E,MAAMb,GAAM,KAAO,EAAea,EAAY,UACrC1lC,EAAE,QAAU,YAAcA,EAAE,QAAU,cAE/C0lC,EAAc,MAEd,OAAM,IAAI,MAAM,8BAA8B,OAAA1lC,EAAE,MAAO,MAGzD,OAAMA,CAET,CAEb,SAAmB,OAAOglC,GAAW,WAAY,CACvC,MAAMW,EAAeL,GAAYN,EAAM,EAAIE,EAAM,EAAK,EACtDM,EAAoB,KAAKG,CAAY,EACrC,MAAMA,EAAa,MACpB,SAAU,MAAM,QAAQX,CAAM,EAAG,CAEhC,MAAMW,EAAeL,GAAYN,EAAQE,EAAM,EAAK,EACpDM,EAAoB,KAAKG,CAAY,EACrC,MAAMA,EAAa,MACpB,MA3CC,MA4CH,CACP,QAAc,CACRF,EAAS,EACV,CACL,GAAM,EAGF,IAAI,QAAS,CACX,OAAOA,CACR,EACD,OAAQG,GAAW,CACjBL,EAAiB,KAAKK,CAAO,CAC9B,EACD,OAAQ,IAAM,CACPH,IAGD7gC,GACFugC,EAAM,OAAQ,EAEhBK,EAAoB,QAAQA,GAAuB,CACjDA,EAAoB,OAAQ,CACpC,CAAO,EACDC,EAAS,GACV,CACF,CACH,CAEA,IAAII,GACW,SAAAqB,GAAStB,EAASV,EAAM,CACrC,OAAAW,IAAiBA,GAAc,OAAQ,EACvCA,GAAgBP,GAAYM,EAASV,CAAI,EAClCW,EACT,CCxIO,SAASa,GAAW7C,EAAK,CAC9B,OAAOA,EAAI,KAAOA,EAAI,YAAY,IACpC,CAgBO,SAASkC,GAAS8U,EAAMhwC,EAAM63D,EAAW,CAC9C,IAAI/C,EAASlvC,EAAM5mB,EAASijE,EAAW/jE,EAC3B8B,GAAR,OAAcA,EAAO,KAEzB,SAASkiE,GAAQ,CACf,IAAIvQ,EAAO,KAAK,IAAG,EAAKsQ,EAEpBtQ,EAAO3xD,GAAQ2xD,GAAQ,EACzBmD,EAAU,WAAWoN,EAAOliE,EAAO2xD,CAAI,GAEvCmD,EAAU,KACL+C,IACH35D,EAAS8xC,EAAK,MAAMhxC,EAAS4mB,CAAI,EACjC5mB,EAAU4mB,EAAO,MAGtB,CAED,IAAI+V,EAAY,UAAW,CACzB38B,EAAU,KACV4mB,EAAO,UACPq8C,EAAY,KAAK,IAAK,EACtB,IAAIE,EAAUtK,GAAa,CAAC/C,EAC5B,OAAKA,IAASA,EAAU,WAAWoN,EAAOliE,CAAI,GAC1CmiE,IACFjkE,EAAS8xC,EAAK,MAAMhxC,EAAS4mB,CAAI,EACjC5mB,EAAU4mB,EAAO,MAGZ1nB,CACR,EAED,OAAAy9B,EAAU,MAAQ,UAAW,CACvBm5B,IACF,aAAaA,CAAO,EACpBA,EAAU,KAEb,EAEDn5B,EAAU,MAAQ,UAAW,CACvBm5B,IACF52D,EAAS8xC,EAAK,MAAMhxC,EAAS4mB,CAAI,EACjC5mB,EAAU4mB,EAAO,KAEjB,aAAakvC,CAAO,EACpBA,EAAU,KAEb,EAEMn5B,CACT,CCxEA,IAAIN,GACAvC,GAAgB,CAAE,EAClBwC,GACAC,GAAmB,GACvB,MAAMC,GAAc,IAEpB,SAASM,GAAkBxD,EAAY,GAAI,CACzC,GAAI,CAACyD,GAAU,QACb,OAGF,MAAMC,EAAS1D,EAAU,MAAMU,GAAO,CAACA,EAAI,OAAO,EAC5CiD,EAAY3D,EAAU,OAAOU,GAAO,CAACF,GAAc,SAASE,CAAG,CAAC,EAItE,GAFAqC,GAAqB,EAEjB,CAACW,EAAQ,CACXD,GAAU,cAAe,EACzB,MACD,CAEDjD,GAAgBR,EAAU,MAAM,CAAC,EAEjC,IAAI4D,EAAiB,CAAE,EACnBC,EAAaF,EAAU,OAAO,CAACloB,EAAKilB,KAClCA,EAAI,UACNjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,WAAYA,EAAI,QAAQ,CAAC,EACpDkD,EAAe,KAAKlD,EAAI,QAAQ,GACvBA,EAAI,QACbjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,QAASA,EAAI,KAAK,CAAC,EAC9CkD,EAAe,KAAKlD,EAAI,KAAK,GAExBjlB,GACN,EAAE,EAgBL,GAdAkoB,EAAU,QAAS,EAAC,OAAO,CAACloB,EAAKilB,KAC3BA,EAAI,iBACNjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,UAAWA,EAAI,eAAe,CAAC,EAC1DkD,EAAe,KAAKlD,EAAI,eAAe,GAEvCjlB,EAAI,KAAK,CAAC8nB,GAAW7C,CAAG,EAAG,aAAc,EAAE,CAAC,EAEvCjlB,GACNooB,CAAU,EAETJ,GAAU,OACZ,QAAQ,MAAMI,CAAU,EAGtBD,EAAe,OACjB,OAAOH,GAAU,MAAMG,EAAe,OAAO,CAACnoB,EAAKxW,IAAQwW,EAAI,OAAOxW,CAAG,EAAG,CAAE,EAAC,CAEnF,CAEA,SAAS6+B,GAAarB,EAAS,CAC7B,GAAI,CAAAQ,GAIJ,OAAQD,GAAoBe,GAAatB,CAAO,CAClD,CAEA,MAAMgB,GAAY,CAChB,QAAS,GACT,MAAO,GACP,OAAQ,UAAW,CACjBT,IAAqBA,GAAkB,OAAQ,CAChD,EACD,eAAgB,SAASgB,EAAQ,EAAG,CAClCxD,GAAgBA,GAAc,MAAM,EAAGwD,CAAK,EAC5CjB,GAAqB,CACtB,EACD,MAAO,SAAS/iB,EAAM,CAAE,OAAAikB,EAAS,GAAO,aAAAC,EAAe,EAAO,EAAG,GAAI,CACnE,OAAIT,GAAU,UACZA,GAAU,cAAc,MAAO,EAC3BQ,GAAUjB,IAAqBA,GAAkB,OACnDA,GAAkB,OAAOhjB,CAAI,GAE7ByjB,GAAU,OAAQ,EAClBK,GAAa9jB,CAAI,GAGfkkB,IACFjB,GAAmB,GACnBD,GAAkB,OAAO,QAAQ,IAAM,CACrCC,GAAmB,GACnBQ,GAAU,QAAS,CAC7B,CAAS,IAIET,EACR,EACD,YAAa,SAAS,CAAE,cAAAmB,EAAgB,IAAK,mBAAAC,EAAqBlB,EAAa,EAAG,GAAI,CACpFO,GAAU,cAAgBb,GAASY,GAAmBW,CAAa,EAEnEpB,GAAsBH,GAAS,IAAM,CAEnCpC,GAAgB,CAAE,CACnB,EAAE4D,CAAkB,CACtB,CACH,EACAX,GAAU,YAAW,ECzGd,IAAIyhC,GACAP,GACAmF,GACAC,GACAV,GCEPW,GAAa,CAAC1sE,EAAMZ,EAAOk6B,IAAW,CACxCsuC,GAAI,KAAK,iBAAkB5nE,EAAMZ,EAAOk6B,CAAM,CAChD,EAGA,MAAMqzC,GAAU,CACd,IAAK,CAAC,SAAU,SAAU,QAAS,OAAO,EAC1C,KAAM,CAAC,OAAQ,OAAO,EACtB,KAAM,CAAC,QAAS,OAAO,EACvB,MAAO,CACL,QACA,UACA,QACA,QACA,OAGA,eACA,UACA,UACA,QACD,CACH,EAGMC,GAAc,CAAC5sE,EAAMm5B,EAASrC,EAAMsrB,EAAS9oB,EAAS,KAAO,CACjEA,EAAS,CAAE,OAAAA,EAAa,QAAAH,EAAS,KAAArC,EAAM,QAAAsrB,CAAW,EAClDsqB,GAAW1sE,EAAM,QAASs5B,CAAM,CAClC,EAEMuzC,GAAS,CAAC7sE,EAAM++D,EAAQr6D,EAAU,KAC/Bq6D,EAAO,OACZ,CAACzuC,EAAKlxB,KACJkxB,EAAIlxB,CAAK,EAAI,CAACiP,EAAMirB,EAAS,KAAO,CAClCA,EAAS,CAAE,GAAG50B,EAAS,GAAI2J,EAAO,CAAE,KAAAA,GAAS,GAAK,GAAGirB,CAAQ,EAC7DozC,GAAW1sE,EAAMZ,EAAOk6B,CAAM,CAC/B,EACMhJ,GAET,CACE,MAAM6I,EAASrC,EAAMwC,EAAQ,CAC3BszC,GAAY5sE,EAAMm5B,EAASrC,EAAMwC,CAAM,CACxC,EACD,MAAMjrB,EAAMirB,EAAQ,CAClBozC,GAAW1sE,EAAMqO,EAAMirB,CAAM,CAC9B,CACF,CACF,EAGGwzC,GAAUC,GACP,OAAO,KAAKA,CAAK,EAAE,OACxB,CAACz8C,EAAKtwB,KAIJA,IAAS,QACJswB,EAAItwB,CAAI,EAAIiB,GAAO4rE,GAAO7sE,EAAM+sE,EAAM/sE,CAAI,EAAG,CAAE,IAAAiB,EAAK,EACpDqvB,EAAItwB,CAAI,EAAI6sE,GAAO7sE,EAAM+sE,EAAM/sE,CAAI,CAAC,EAClCswB,GAET,CAAE,MAAOs8C,GAAa,MAAOF,EAAY,CAC1C,EAGYM,GAAAF,GAAQH,EAAO,EC5Db,IAAI,KAAK,IAAI,KAAS,GAAK,EAAI,GAAI,EAAE,YAAa,EACnD,GAAK,GAYJ,IAAI,KAAK,IAAI,KAAS,GAAK,GAAK,GAAI,EAAE,YAAa,EACpD,GAAK,GAYJ,IAAI,KAAK,IAAI,KAAS,GAAK,GAAK,GAAI,EAAE,YAAa,EACpD,GAAK,GCzDrB,MAAeM,GAAA,CAACvS,EAAQ1qC,EAAO,KAAM5mB,EAAU,OAAS,CACtD,IAAId,EACJ,GAAIoyD,GAAU,OAAOA,GAAW,WAC9B,GAAI,CACFpyD,EAASoyD,EAAO,MAAMtxD,EAAS4mB,CAAI,CACpC,OAAQzwB,EAAG,CACV+I,EAAS/I,CACV,MAED+I,EAASoyD,EAIX,OACEpyD,IAAW,MACX,OAAOA,GAAW,UAClBA,EAAO,MACP,OAAOA,EAAO,MAAS,WAEhBA,EAIA,IAAI,QAAQ,CAACwM,EAAS6vB,IAAW,CAClCr8B,aAAkB,MACpBq8B,EAAOr8B,CAAM,EAEbwM,EAAQxM,CAAM,CAEtB,CAAK,CAEL,ECZey2D,GAAA,CACb,MAAO,QACP,QAAS,UACT,eAAgB,iBAChB,eAAgB,iBAChB,QAAS,UACT,UAAW,YACX,MAAO,QACP,MAAO,QACP,eAAgB,iBAChB,aAAc,eACd,WAAY,aACZ,eAAgB,iBAChB,UAAW,YACX,MAAO,QACP,KAAM,OACN,QAAS,UACT,SAAU,WACV,WAAY,aACZ,OAAQ,SACR,QAAS,UACT,QAAS,UAET,WAAY,aACZ,aAAc,eACd,QAAS,SACX,EC1BAmO,GAAe,CAACC,EAAcC,EAAQ,IAAM,KAAO,CACjD,IAAIC,EAAQ,GAEZ,MAAMC,EAAU,IAAM,CAChBD,IAAU,KACZD,EAAO,EACPC,EAAQ,GAEX,EAED,OAAO,OAAO,KAAKF,CAAY,EAAE,OAAO,CAAC78C,EAAKtpB,KACxC,OAAOmmE,EAAanmE,CAAG,GAAM,WAC/BspB,EAAItpB,CAAG,EAAI,UAAW,CACpB,OAAAsmE,EAAS,EACFH,EAAanmE,CAAG,EAAE,MAAMmmE,EAAc,SAAS,CACvD,EACQ,OAAO,OAAO,yBAAyBA,EAAcnmE,CAAG,EAAE,KAAQ,WAC3EspB,EAAI,iBAAiBtpB,EAAK,UAAW,CACnC,OAAAsmE,EAAS,EACF,OAAO,yBAAyBH,EAAcnmE,CAAG,EAAE,IAAI,MAAMmmE,CAAY,CACxF,CAAO,EACQ,OAAO,OAAO,yBAAyBA,EAAcnmE,CAAG,EAAE,KAAQ,WAC3EspB,EAAI,iBAAiBtpB,EAAK,UAAW,CACnC,OAAAsmE,EAAS,EACF,OAAO,yBAAyBH,EAAcnmE,CAAG,EAAE,IAAI,aAAaA,CAAG,EAAE,MAC9EmmE,EACA,SACD,CACT,CAAO,EAED78C,EAAItpB,CAAG,EAAImmE,EAAanmE,CAAG,EAEtBspB,GACN,EAAE,CACP,EClCA,IAAI4uC,GAAU,KAEd,MAAAqO,GAAe,CAACttB,EAAI7b,IAAU,CAC5B,aAAa86B,EAAO,EACpBA,GAAU,WAAW,IAAM,CACzBjf,EAAI,CACL,EAAE7b,CAAK,CACV,ECLAopC,GAAe,IACN,cAA2BzB,GAAU,SAAU,CACpD,OAAO,WAAY,CACjB,MAAO,CACL,MAAO,CACL,MAAO,EACP,QAAS,GACT,MAAO,GACP,QAAS,CAAE,KAAMA,GAAU,SAAS,cAAe,QAAS,EAAI,CACjE,CACF,CACF,CAED,IAAI,QAAQrmE,EAAG,CACb,KAAK,SAAWA,CACjB,CAED,IAAI,SAAU,CACZ,OAAO,KAAK,QACb,CAED,IAAI,WAAY,CACd,OAAO,KAAK,IAAI,OAAO,CACxB,CAED,IAAI,cAAe,CACjB,OAAO,KAAK,UAAU,OACvB,CAED,IAAI,WAAY,CACd,OAAO,KAAK,UAAU,QAAU,GAAK,KAAK,UAAU,UAAY,EACjE,CAED,OAAQ,CACN,KAAK,oBAAqB,CAC3B,CAED,qBAAsB,CAGpB,MAAMiU,EAFQ,KAAK,MAEF,GACX44C,EAAY54C,EAAG,cAAe,EACpCA,EAAG,YAAYA,EAAG,WAAY44C,CAAS,EACvC54C,EAAG,cAAcA,EAAG,WAAYA,EAAG,mBAAoBA,EAAG,MAAM,EAChEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,mBAAoBA,EAAG,MAAM,EAChEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,eAAgBA,EAAG,aAAa,EACnEA,EAAG,cAAcA,EAAG,WAAYA,EAAG,eAAgBA,EAAG,aAAa,EACnE,KAAK,aAAa,QAAU,CAC1B,OAAQ44C,EACR,EAAG,KAAK,QAAQ,MAChB,EAAG,KAAK,QAAQ,MACjB,EAED,KAAK,UAAU,EAAI,KAAK,QAAQ,MAAQ,KAAK,MAAM,mBAAoB,EACvE,KAAK,UAAU,EAAI,KAAK,QAAQ,OAAS,KAAK,MAAM,mBAAoB,CACzE,CAED,OAAQ,CACN,MAAMt7C,EAAQ,KAAK,MACnB,KAAK,UAAY,EACZ,KAAK,sBACR,KAAK,oBAAsB,IAAM,CAC/B,GAAI,KAAK,aAAa,QAAQ,QAAU,KAAK,QAAQ,YAAc,KAAK,OAAQ,CAC9E,MAAM0C,EAAK1C,EAAM,GAEXrY,EAAc,IAAI,KAAM,EAAC,QAAS,EAClC6uE,EAA0B,KAAK,QAAQ,wBAAyB,EAKhEC,EAAaD,EACfA,EAAwB,iBACxB,KAAK,QAAQ,wBAMjB,GAJmBC,EACf,KAAK,aAAeA,EACpB,KAAK,UAAY9uE,EAAc,GAEnB,CACd,KAAK,UAAYA,EACjB,KAAK,WAAa8uE,EAClB,GAAI,CACF/zD,EAAG,YAAYA,EAAG,WAAY,KAAK,aAAa,QAAQ,MAAM,EAC9DA,EAAG,YAAYA,EAAG,+BAAgC,EAAK,EACvDA,EAAG,WAAWA,EAAG,WAAY,EAAGA,EAAG,KAAMA,EAAG,KAAMA,EAAG,cAAe,KAAK,OAAO,EAChF,KAAK,WAAa,KAAK,QAAQ,wBAC/B,KAAK,UAAU,QAAU,GAEzB,KAAK,aAAa,QAAQ,EAAI,KAAK,QAAQ,MAC3C,KAAK,aAAa,QAAQ,EAAI,KAAK,QAAQ,OAC3C,MAAMg0D,EAAsB,KAAK,UAAU,EAAI,KAAK,UAAU,EACxDC,EAAkB,KAAK,QAAQ,MAAQ,KAAK,QAAQ,OAEtDD,EAAsBC,GACxB,KAAK,UAAU,OAASA,EAAkBD,EAC1C,KAAK,UAAU,OAAS,IAExB,KAAK,UAAU,OAASA,EAAsBC,EAC9C,KAAK,UAAU,OAAS,EAE3B,OAAQruE,EAAG,CACVqoE,GAAI,MAAM,mBAAoBroE,CAAC,EAC/B,KAAK,KAAM,CACZ,CACD,KAAK,aAAa,OAAO,kBAAmB,CAC7C,CACF,CACF,GAEE,KAAK,wBACR0X,EAAM,GAAG,aAAc,KAAK,mBAAmB,EAC/C,KAAK,sBAAwB,GAEhC,CAED,MAAO,CACL,MAAMA,EAAQ,KAAK,MAKnB,GAJAA,EAAM,eAAe,aAAc,KAAK,mBAAmB,EAC3D,KAAK,sBAAwB,GAC7B,KAAK,UAAU,QAAU,GAErB,KAAK,aAAa,QAAQ,OAAQ,CACpC,MAAM0C,EAAK1C,EAAM,GACjB0C,EAAG,YAAYA,EAAG,WAAY,KAAK,aAAa,QAAQ,MAAM,EAC9DA,EAAG,WAAW,EAAG,EAAG,EAAG,CAAC,EACxBA,EAAG,MAAMA,EAAG,gBAAgB,CAC7B,CACF,CAED,SAASgqB,EAAKC,EAAM,CAClB,KAAK,UAAU,MAAM,CACnB,EAAGA,EACH,EAAGD,CACX,CAAO,CACF,CAED,KAAK9jC,EAAOC,EAAQ,CAClB,KAAK,UAAU,MAAM,CACnB,EAAGD,EACH,EAAGC,CACX,CAAO,CACF,CAED,MAAO,CACL,KAAK,UAAU,MAAQ,CACxB,CAED,MAAO,CACL,KAAK,UAAU,MAAQ,CACxB,CACF,EC/II,IAAI+tE,GAAW5sE,GAAOA,EACzB6sE,EACAC,GACApB,GACA1N,GACAv2C,GAAY,EACZslD,GAAc,GASdC,GAAgB,CAAE,EAEtB,MAAMrnE,GAAQ,CACZ,WAAY,GACZ,QAAS,GACT,YAAa,GACb,IAAI,YAAa,CACf,OAAO,KAAK,WACb,EACD,IAAI,WAAWe,EAAK,CACd,KAAK,cAAgBA,IACvB,KAAK,YAAcA,EACnBumE,GAAevmE,IAAQ,GAAO,UAAY,OAAO,EAEpD,EACD,SAAU,GACV,cAAe,IACjB,EAEMwmE,GAAQ,CACZ,MAAO,CACLvnE,GAAM,QAAU,EACjB,EACD,OAAQ,CACNA,GAAM,QAAU,EACjB,EACD,QAAS,CACPA,GAAM,gBAAkB,IAAQwnE,GAAkB,KAAM,EACxDxnE,GAAM,cAAgB,IACvB,EACD,OAAQ,CACNynE,GAA0B,CAC3B,CACH,EAEMC,GAAgB3mE,GAAO,KAAK,MAAM+gB,GAAY/gB,CAAG,EAAI,KAErDumE,GAAiB,CAAC9uE,EAAO4wB,IAAS,CAClCivC,KACFA,GAAS,KAAK,eAAiB7/D,EAAO4wB,EAAM89C,EAAQ,WAAW,EAC/D7O,GAAS,KAAK,oBAAqB7/D,EAAO4wB,EAAM89C,EAAQ,WAAW,EAEvE,EAEMS,GAAW,CAACnvE,EAAO4wB,IAAS,CAChCm+C,GAAM/uE,CAAK,GAAK,OAAO+uE,GAAM/uE,CAAK,GAAM,YAAc+uE,GAAM/uE,CAAK,EAAE,KAAK,KAAMA,EAAO4wB,CAAI,CAC3F,EAEA,IAAIw+C,GAAe,KACfC,GAAiB,KAErB,MAAMzuB,GAAS,CAAC/+C,EAAK6sE,EAASh+C,IACrB0+C,IAAgB,OAAOA,IAAiB,WAC3CA,GAAavtE,EAAK6sE,EAASh+C,CAAM,EACjC,IAAI,QAAQhb,GAAW,CACrB7T,EAAM4sE,GAAS5sE,CAAG,EAClB6sE,EAAQ,aAAa,MAAO7sE,CAAG,EAC/B6sE,EAAQ,KAAM,EACdh5D,EAAS,CACjB,CAAO,EAGD45D,GAAWZ,GACRW,IAAkB,OAAOA,IAAmB,WAC/CA,GAAeX,CAAO,EACtB,IAAI,QAAQh5D,GAAW,CACrBg5D,EAAQ,gBAAgB,KAAK,EAC7BA,EAAQ,KAAM,EACdh5D,EAAS,CACjB,CAAO,EAGM65D,GAAgB,IAAM,CACjC,MAAMC,EAAW,SAAS,qBAAqB,OAAO,EACtD,GAAIA,GAAYA,EAAS,OACvB,OAAOA,EAAS,CAAC,EACZ,CACL,MAAMd,EAAU,SAAS,cAAc,OAAO,EACxCe,EAAwBxH,GAAS,IAAI,WAAY,OAAO,EAC1DA,GAAS,IAAI,WAAY,OAAO,EAChC,KACEyH,EAAyBzH,GAAS,IAAI,WAAY,QAAQ,EAC5DA,GAAS,IAAI,WAAY,QAAQ,EACjC,KACJ,OAAAyG,EAAQ,aAAa,KAAM,cAAc,EACzCA,EAAQ,aAAa,QAASQ,GAAcO,CAAqB,CAAC,EAClEf,EAAQ,aAAa,SAAUQ,GAAcQ,CAAsB,CAAC,EACpEhB,EAAQ,MAAM,SAAW,WACzBA,EAAQ,MAAM,OAAS,IACvBA,EAAQ,MAAM,QAAU,OACxBA,EAAQ,MAAM,WAAa,SAC3BA,EAAQ,MAAM,IAAMQ,GAAc,CAAC,EACnCR,EAAQ,MAAM,KAAOQ,GAAc,CAAC,EACpCR,EAAQ,MAAM,MAAQQ,GAAcO,CAAqB,EACzDf,EAAQ,MAAM,OAASQ,GAAcQ,CAAsB,EAC3D,SAAS,KAAK,YAAYhB,CAAO,EAC1BA,CACR,CACH,EAEaiB,GAAoB,IAAM,CACrC,GAAI,CAACvC,GAAoB,IAAI,cAAc,EAAG,CAC5C,MAAMj2C,EAAKi2C,GAAoB,MAAM,EAAE,CACrC,KAAMgB,GAAc,EACpB,IAAK,eACL,OAAQ,EACR,QAAAM,CACN,CAAK,EACDtB,GAAoB,UAAU,MAAMj2C,EAAI,CAAC,CAC1C,CACD,OAAOi2C,GAAoB,IAAI,cAAc,CAC/C,EAEMwC,GAAyB,IAAM,CACnCpH,GAAI,KAAK,cAAe,6BAA6B,EACrD,OAAO,KAAK7I,EAAM,EAAE,QAAQ3/D,GAAS,CACnC,MAAM44B,EAAU,GAAK,CAEf20C,IAAWA,GAAQvtE,CAAK,GAAK,OAAOutE,GAAQvtE,CAAK,GAAM,YACzDutE,GAAQvtE,CAAK,EAAE,CAAE,YAAa0uE,EAAQ,WAAW,CAAE,EAGrDS,GAASnvE,EAAO,CAAE,aAAc0uE,EAAS,MAAO,EAAG,EAGnDI,GAAenP,GAAO3/D,CAAK,EAAG,CAAE,aAAc0uE,EAAS,MAAO,EAAG,CAClE,EAEDG,GAAc7uE,CAAK,EAAI44B,EACvB81C,EAAQ,iBAAiB1uE,EAAO44B,CAAO,CAC3C,CAAG,CACH,EAEMq2C,GAA2B,IAAM,CACrCzG,GAAI,KAAK,cAAe,+BAA+B,EACvD,OAAO,KAAKqG,EAAa,EAAE,QAAQ7uE,GAAS,CAC1C0uE,EAAQ,oBAAoB1uE,EAAO6uE,GAAc7uE,CAAK,CAAC,CAC3D,CAAG,EACD6uE,GAAgB,CAAE,CACpB,EAEMG,GAAoB,CACxB,SAAS1yC,EAAW,CAClBujC,GAAWvjC,CACZ,EAED,OAAOuzC,EAAU,CACfT,GAAeS,CAChB,EAED,SAASC,EAAY,CACnBT,GAAiBS,CAClB,EAED,SAASvrC,EAAM,EAAGC,EAAO,EAAG,CAC1BkqC,EAAQ,MAAM,KAAOQ,GAAc1qC,CAAI,EACvCkqC,EAAQ,MAAM,IAAMQ,GAAc3qC,CAAG,EACjCqqC,KAAgB,IAClBD,GAAa,SAASpqC,EAAKC,CAAI,CAElC,EAED,KAAK/jC,EAAQ,KAAMC,EAAS,KAAM,CAChCguE,EAAQ,MAAM,MAAQQ,GAAczuE,CAAK,EACzCiuE,EAAQ,MAAM,OAASQ,GAAcxuE,CAAM,EAC3CguE,EAAQ,MAAQ,WAAWA,EAAQ,MAAM,KAAK,EAC9CA,EAAQ,OAAS,WAAWA,EAAQ,MAAM,MAAM,EAC5CE,KAAgB,IAClBD,GAAa,KAAKluE,EAAOC,CAAM,CAElC,EAED,KAAK6jC,EAAM,EAAGE,EAAQ,KAAMC,EAAS,KAAMF,EAAO,EAAG,CACnD,KAAK,SAASD,EAAKC,CAAI,EACvB,KAAK,KAAKC,EAAQD,EAAME,EAASH,CAAG,CACrC,EAED,KAAK1iC,EAAK6uB,EAAS,GAAI,CACrB,GAAK,KAAK,YAMV,GALA68C,GAAUG,GAAQ,MAAM7rE,CAAG,EAE3B,KAAK,KAAM,EACXotE,GAA0B,EAEtB,KAAK,KAAOptE,EACd,KAAK,MAAK,EAAG,KAAK,KAAK,KAAKA,EAAK6uB,CAAM,CAAC,MACnC,CACL,MAAMq/C,EAAW,CAAE,QAASvoE,GAAM,WAAY,SAAU,GAAK,EACzDkpB,EAAO,UACTq/C,EAAS,KAAOr/C,EAAO,SAEzB28C,GAAI,IAAI0C,EAAUlQ,EAAQ,EAAE,KAAKmQ,GAAO,CACtCxoE,GAAM,WAAa,GACnBwoE,EAAI,WAAW,KAAK,IAAM,CACxBxoE,GAAM,WAAa,GACnBo5C,GAAO/+C,EAAK6sE,EAASh+C,CAAM,EACxB,KAAK,IAAM,CACVk/C,GAAwB,EACxB,KAAK,KAAM,EACX,KAAK,KAAM,CACzB,CAAa,EACA,MAAMzvE,GAAK,CACV2uE,GAAe,QAAS,CAAE,aAAcJ,EAAS,MAAOvuE,EAAG,EAK3D2uE,GAAe,QAAS,CAAE,aAAcJ,EAAS,MAAOvuE,EAAG,CACzE,CAAa,CACb,CAAS,CACT,CAAO,CACF,CACF,EAED,QAAS,CACP,GAAI,CAAC,KAAK,YAAa,OACvB,MAAM0B,EAAM6sE,EAAQ,aAAa,KAAK,EACtC,KAAK,MAAO,EACZ,KAAK,KAAK7sE,CAAG,CACd,EAED,OAAQ,CACNwrE,GAAI,OAAQ,EACR7lE,GAAM,aACRA,GAAM,WAAa,GACnB6lE,GAAI,KAAM,EAEV,WAAW,IAAM,CACf,KAAK,MAAO,CACpB,CAAO,GAEE,KAAK,cACV,KAAK,MAAO,EACZ,KAAK,KAAM,EACX4B,GAA0B,EAC3B,EAED,OAAQ,CACN,GAAK,KAAK,YAEV,YAAK,MAAO,EACRL,KAAgB,IAAMD,GAAa,KAAM,EACtCW,GAASZ,CAAO,EAAE,KAAK,IAAM,CAClCI,GAAe,QAAS,CAAE,aAAcJ,CAAO,CAAE,CACvD,CAAK,CACF,EAED,MAAO,CACA,KAAK,cACNE,KAAgB,IAAMD,GAAa,MAAO,EAC9Cd,GAAiBa,EAAQ,KAAM,KAAMA,CAAO,EAAE,MAAMvuE,GAAK,CACvD2uE,GAAe,QAAS,CAAE,aAAcJ,EAAS,MAAOvuE,EAAG,EAK3D2uE,GAAe,QAAS,CAAE,aAAcJ,EAAS,MAAOvuE,EAAG,CACjE,CAAK,EACF,EAED,OAAQ,CACD,KAAK,aACVuuE,EAAQ,MAAO,CAChB,EAED,WAAY,CACL,KAAK,cACV,KAAK,UAAY,GAAO,KAAK,MAAO,EAAG,KAAK,KAAM,EACnD,EAED,KAAKuB,EAAQ,GAAM,CACZ,KAAK,cACVvB,EAAQ,MAAQuB,EACjB,EAED,KAAKC,EAAS,GAAM,CAClBxB,EAAQ,KAAOwB,CAChB,EAED,KAAK7tE,EAAM,CACJ,KAAK,aACL,KAAK,MAENmF,GAAM,gBAAkB,OAC1BA,GAAM,cAAgB,CAAC,CAACA,GAAM,SAGhC,KAAK,MAAO,EAEZknE,EAAQ,YAAc,KAAK,IAAI,EAAG,KAAK,IAAIrsE,EAAM,KAAK,SAAW,EAAG,CAAC,EACtE,EAED,KAAKd,EAAS,CACP,KAAK,aACL,KAAK,MAEViG,GAAM,UAAYA,GAAM,UAAYknE,EAAQ,aAAentE,EAC3D4sE,GAAc,IAAM,CAClB,KAAK,KAAK3mE,GAAM,QAAQ,EACxBA,GAAM,SAAW,EAClB,EAAE,GAAG,EACP,EAED,MAAO,CACA,KAAK,cACNonE,KAAgB,GAClBD,GAAa,KAAM,GAEnBD,EAAQ,MAAM,QAAU,QACxBA,EAAQ,MAAM,WAAa,WAE9B,EAED,MAAO,CACA,KAAK,cACNE,KAAgB,GAClBD,GAAa,KAAM,GAEnBD,EAAQ,MAAM,QAAU,OACxBA,EAAQ,MAAM,WAAa,UAE9B,EAED,UAAUljC,EAAU,GAAM,CACxBhkC,GAAM,WAAagkC,CACpB,EAGD,IAAI,UAAW,CACb,OAAOkjC,IAAY,MAAMA,EAAQ,QAAQ,EAAI,IAAWA,EAAQ,SACjE,EAED,IAAI,aAAc,CAChB,OAAOA,GAAWA,EAAQ,WAC3B,EAED,IAAI,OAAQ,CACV,OAAOA,GAAWA,EAAQ,KAC3B,EAED,IAAI,QAAS,CACX,OAAOA,GAAWA,EAAQ,IAC3B,EAED,IAAI,KAAM,CACR,OAAOA,GAAWA,EAAQ,aAAa,KAAK,CAC7C,EAED,IAAI,SAAU,CACZ,OAAOlnE,GAAM,OACd,EAED,IAAI,YAAa,CACf,OAAOA,GAAM,UACd,EAED,IAAI,aAAc,CAEhB,OAAOA,GAAM,aAAe,EAC7B,EAED,IAAI,KAAM,CACR,OAAOknE,GAAW,WAAWA,EAAQ,MAAM,GAAG,CAC/C,EAED,IAAI,MAAO,CACT,OAAOA,GAAW,WAAWA,EAAQ,MAAM,IAAI,CAChD,EAED,IAAI,QAAS,CACX,OAAOA,GAAW,WAAWA,EAAQ,MAAM,IAAMA,EAAQ,MAAM,MAAM,CACtE,EAED,IAAI,OAAQ,CACV,OAAOA,GAAW,WAAWA,EAAQ,MAAM,KAAOA,EAAQ,MAAM,KAAK,CACtE,EAED,IAAI,OAAQ,CACV,OAAOA,GAAW,WAAWA,EAAQ,MAAM,KAAK,CACjD,EAED,IAAI,QAAS,CACX,OAAOA,GAAW,WAAWA,EAAQ,MAAM,MAAM,CAClD,EAED,IAAI,SAAU,CACZ,OAAIE,KAAgB,GACXD,GAAa,UAEbD,GAAWA,EAAQ,MAAM,UAAY,OAE/C,EAED,IAAI,YAAa,CACf,OAAOlnE,GAAM,UACd,EAID,IAAI,UAAW,CACb,OAAOknE,CACR,EAED,IAAI,WAAY,CACd,OAAO7O,EACR,CACH,EAEeiO,GAAekB,GAAmB,IAAM,CACrD1lD,GAC0GA,GAE1GolD,EAAUa,GAAe,EAEzBX,GAAc3G,GAAS,IAAI,WAAY,cAAe,EAAK,EACvD2G,KAAgB,KAClBF,EAAQ,aAAa,cAAe,WAAW,EAC/CC,GAAegB,GAAmB,EAEtC,CAAC,EC1bc,MAAMQ,WAAqBxD,GAAU,SAAU,CAC5D,OAAO,WAAY,CACjB,MAAO,CACL,KAAM,GACN,MAAO,WACP,EAAG,GACH,EAAG,IACH,EAAGljD,GAAKA,EAAI,GACZ,EAAGC,GAAKA,EAAI,GACZ,MAAO,EACP,KAAM,CACJ,EAAGD,GAAKA,EACR,EAAGC,GAAKA,EACR,EAAG,EACH,EAAG,GACH,KAAM,CACJ,SAAU,GACV,WAAY,EACb,CACF,CACF,CACF,CAED,cAAe,CACb,KAAK,IAAI,MAAM,EAAE,KAAO,UAAU,YAAK,QAAO,aAAY,YAAK,YAC/D,KAAK,IAAI,MAAM,EAAE,YAAa,EAC9B,KAAK,EAAI,KAAK,IAAI,MAAM,EAAE,YAAc,GACxC,KAAK,EAAI,KAAK,IAAI,MAAM,EAAE,aAAe,CAC1C,CACH,CC5Be,MAAM0mD,WAAqBzD,GAAU,SAAU,CAC5D,OAAO,WAAY,CACjB,MAAO,CACL,KAAM,GACN,MAAO,WACP,QAASA,GAAU,MAAM,aAAa,GAAI,GAAI,EAAE,EAChD,EAAG,GACH,EAAG,GACH,EAAG,IACH,EAAG,IACH,MAAO,EACP,WAAY,CACV,EAAG,EACH,EAAG,EACH,QAASA,GAAU,MAAM,aAAa,GAAI,GAAI,EAAE,EAChD,MAAO,UACR,EACD,QAAS,CACP,EAAGljD,GAAKA,EACR,EAAGC,GAAKA,EACR,EAAG,GACH,KAAM,CACJ,SAAU,GACV,UAAW,QACZ,CACF,EACD,KAAM,CACJ,EAAGD,GAAKA,EACR,EAAGC,GAAKA,EACR,EAAG,GACH,KAAM,CACJ,SAAU,GACV,UAAW,SACX,KAAM,KACP,CACF,CACF,CACF,CAED,QAAS,CACP,KAAK,OAAS,CAEV,IAAK,GACL,SAAU,IACV,UAAW,EAEb,GAAGu+C,GAAS,IAAI,WAAY,SAAS,CACtC,EAED,KAAK,IAAM,EACX,KAAK,QAAU,KAAK,IAAM,KAAK,OAAO,UAEtC,MAAMoI,EAAgB,IAAM,CAC1B,KAAK,IAAM,CAAC,EAAE,EAAI,KAAK,MAAM,GAC9B,EACD,KAAK,MAAM,GAAG,aAAcA,CAAa,EACzC,KAAK,MAAM,IAAI,aAAcA,CAAa,EAC1C,KAAK,SAAW,YAAY,KAAK,QAAQ,KAAK,IAAI,EAAG,KAAK,OAAO,QAAQ,CAC1E,CAED,cAAe,CACb,KAAK,QAAS,CACf,CAED,SAAU,CACR,cAAc,KAAK,QAAQ,CAC5B,CAED,SAAU,CACR,GAAI,KAAK,IAAI,KAAK,QAAU,KAAK,GAAG,GAAK,KAAK,OAAO,UAAW,OAChE,KAAK,QAAU,KAAK,IAEpB,IAAIC,EAAU,WAEV,KAAK,KAAO,IAAM,KAAK,IAAM,GAAIA,EAAU,UAEtC,KAAK,KAAO,KAAIA,EAAU,YAEnC,KAAK,IAAI,YAAY,EAAE,UAAU,QAASA,CAAO,EACjD,KAAK,IAAI,SAAS,EAAE,KAAO,GAAG,YAAK,KAEnC,KAAK,OAAO,KAAO9H,GAAI,KAAK,MAAO,KAAK,GAAG,CAC5C,CACH,CCpFA,MAAM+H,EAAW,CACf,eAAgB,CAAE,EAClB,SAAU,CAAE,EACZ,UAAW,CAAE,EACb,QAAS,CAAE,CACb,EAEeC,GAAA,CAEb,WAAW3vB,EAAIif,KAAY5lC,EAAQ,CACjC,MAAMiM,EAAY,WAChB,IAAM,CACJoqC,EAAS,SAAWA,EAAS,SAAS,OAAOzmE,GAAMA,IAAOq8B,CAAS,EACnE0a,EAAG,MAAM,KAAM3mB,CAAM,CACtB,EACD4lC,EACA5lC,CACD,EACDsuC,UAAI,KAAK,cAAe,OAASriC,CAAS,EAC1CoqC,EAAS,SAAS,KAAKpqC,CAAS,EACzBA,CACR,EAED,aAAaA,EAAW,CAClBoqC,EAAS,SAAS,QAAQpqC,CAAS,EAAI,IACzCoqC,EAAS,SAAWA,EAAS,SAAS,OAAOzmE,GAAMA,IAAOq8B,CAAS,EACnEqiC,GAAI,KAAK,gBAAiB,OAASriC,CAAS,EAC5C,aAAaA,CAAS,GAEtBqiC,GAAI,MAAM,gBAAiB,MAAQriC,EAAY,YAAY,CAE9D,EAED,eAAgB,CACdoqC,EAAS,SAAS,QAAQpqC,GAAa,CACrC,KAAK,aAAaA,CAAS,CACjC,CAAK,CACF,EAGD,YAAY0a,EAAI4vB,KAAav2C,EAAQ,CACnC,MAAMw2C,EAAa,YACjB,IAAM,CACJH,EAAS,UAAU,OAAOzmE,GAAMA,IAAO4mE,CAAU,EACjD7vB,EAAG,MAAM,KAAM3mB,CAAM,CACtB,EACDu2C,EACAv2C,CACD,EACDsuC,UAAI,KAAK,eAAgB,OAASkI,CAAU,EAC5CH,EAAS,UAAU,KAAKG,CAAU,EAC3BA,CACR,EAED,cAAcA,EAAY,CACpBH,EAAS,UAAU,QAAQG,CAAU,EAAI,IAC3CH,EAAS,UAAYA,EAAS,UAAU,OAAOzmE,GAAMA,IAAO4mE,CAAU,EACtElI,GAAI,KAAK,iBAAkB,OAASkI,CAAU,EAC9C,cAAcA,CAAU,GAExBlI,GAAI,MAAM,iBAAkB,MAAQkI,EAAa,YAAY,CAEhE,EAED,gBAAiB,CACfH,EAAS,UAAU,QAAQG,GAAc,CACvC,KAAK,cAAcA,CAAU,CACnC,CAAK,CACF,EAGD,iBAAiBviE,EAAQnO,EAAO44B,EAAS,CACvCzqB,EAAO,iBAAiBnO,EAAO44B,CAAO,EACtC,MAAMggC,EACJ2X,EAAS,QAAQ,QAAQpiE,CAAM,EAAI,GAC/BoiE,EAAS,QAAQ,QAAQpiE,CAAM,EAC/BoiE,EAAS,QAAQ,KAAKpiE,CAAM,EAAI,EAEtCoiE,EAAS,eAAe3X,CAAW,EAAI2X,EAAS,eAAe3X,CAAW,GAAK,CAAE,EACjF2X,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,EAAIuwE,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,GAAK,CAAE,EAC/FuwE,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,EAAE,KAAK44B,CAAO,EACxD4vC,GAAI,KACF,oBACA,UACAr6D,EACA,UAAYnO,EACZ,WACA44B,EAAQ,SAAU,CACnB,CACF,EAED,oBAAoBzqB,EAAQnO,EAAO44B,EAAS,CAC1C,MAAMggC,EAAc2X,EAAS,QAAQ,QAAQpiE,CAAM,EAEjDyqD,EAAc,IACd2X,EAAS,eAAe3X,CAAW,GACnC2X,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,GAC1CuwE,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,EAAE,QAAQ44B,CAAO,EAAI,IAE/D23C,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,EAAIuwE,EAAS,eAAe3X,CAAW,EAC/E54D,CACD,EAAC,OAAOyE,GAAMA,IAAOm0B,CAAO,EAC7B4vC,GAAI,KACF,uBACA,UACAr6D,EACA,UAAYnO,EACZ,WACA44B,EAAQ,SAAU,CACnB,EACDzqB,EAAO,oBAAoBnO,EAAO44B,CAAO,EAEzC,OAAO,KAAK23C,EAAS,eAAe3X,CAAW,CAAC,EAAE,QAAQ54D,GAAS,CAC7DuwE,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,EAAE,SAAW,GACzD,OAAOuwE,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,CAE3D,CAAO,EAEG,OAAO,KAAKuwE,EAAS,eAAe3X,CAAW,CAAC,EAAE,SAAW,IAC/D2X,EAAS,QAAQ,OAAO3X,EAAa,CAAC,EACtC2X,EAAS,eAAe,OAAO3X,EAAa,CAAC,IAG/C4P,GAAI,MACF,uBACA,YACA,SACAr6D,EACA,UAAYnO,EACZ,UACA44B,EAAQ,SAAU,CACnB,CAEJ,EAID,qBAAqBzqB,EAAQnO,EAAO,CAClC,GAAImO,GAAUnO,EAAO,CACnB,MAAM44D,EAAc2X,EAAS,QAAQ,QAAQpiE,CAAM,EAC/CyqD,EAAc,IAChB2X,EAAS,eAAe3X,CAAW,EAAE54D,CAAK,EAAE,QAAQ44B,GAAW,CAC7D,KAAK,oBAAoBzqB,EAAQnO,EAAO44B,CAAO,CACzD,CAAS,CAEJ,SAAUzqB,EAAQ,CACjB,MAAMyqD,EAAc2X,EAAS,QAAQ,QAAQpiE,CAAM,EAC/CyqD,EAAc,IAChB,OAAO,KAAK2X,EAAS,eAAe3X,CAAW,CAAC,EAAE,QAAQ+X,GAAU,CAClE,KAAK,qBAAqBxiE,EAAQwiE,CAAM,CAClD,CAAS,CAET,MACM,OAAO,KAAKJ,EAAS,cAAc,EAAE,QAAQ3X,GAAe,CAC1D,KAAK,qBAAqB2X,EAAS,QAAQ3X,CAAW,CAAC,CAC/D,CAAO,CAEJ,EAGD,OAAQ,CACN,KAAK,cAAe,EACpB,KAAK,eAAgB,EACrB,KAAK,qBAAsB,EAC3B2X,EAAS,eAAiB,CAAE,EAC5BA,EAAS,SAAW,CAAE,EACtBA,EAAS,UAAY,CAAE,EACvBA,EAAS,QAAU,CAAE,CACtB,CACH,EC1JO,IAAIK,GCMAC,GAMAztE,EAMA0tE,GAKAj5D,GAMAu0D,GAMArB,GAOPgG,GAOO9G,GAOA+G,GAAa,GAUbC,GAAkB,MAAOt3C,EAAMT,IACjC,GAOEg4C,GAAiB,IAAM,CAAE,EAMzBr0C,GAAS,IAAI,IAMbze,GAAa,IAAI,IAMxB+yD,GAAc,GAMdC,GAAa,KACbC,GACAxF,GAQAyF,GAOAC,GAEJ,MAAMC,GAAQpuE,GAAO,CAGfA,EAAI,QACN0tE,GAAY1tE,EAAI,MAAM,WAIpBA,EAAI,SAAWA,EAAI,QAAQ,WAC7B2nE,GAAc3nE,EAAI,QAAQ,UAE1B2nE,GAAY,QAAQthD,GAAMA,EAAE,QAAU,EAAM,GAE9CrmB,EAAI,YAAcjD,GAAK,CACrBokE,GAAK,EAAE,EACPpkE,EAAE,eAAgB,CACnB,CACH,EAEasxE,GAAa,CAAC/gD,EAAQ+6C,IAAa,CAC9C,GAAI,CAAE,YAAAiG,EAAa,OAAA70C,CAAM,EAAKnM,EAG1B+6C,GAAYkG,GAAOlG,CAAQ,IAC7BroE,EAAMqoE,GAEHroE,IACHA,EAAMsuE,GAAed,IAGvBC,GAAcztE,EAAI,YAClB0tE,GAAYD,GAAY,UACxBh5D,GAAQzU,EAAI,MACZgpE,GAAewF,GAAc,EAE7BJ,GAAMpuE,CAAG,EAELyF,GAAQg0B,CAAM,EAChBmxC,GAAMt9C,CAAM,EACH28B,GAAWxwB,CAAM,IAC1B,QAAQ,KAAK,0DAA0D,EACvE,QAAQ,KACN,8FACD,EAEL,EAEMmxC,GAAQt9C,GAAU,CACjBygD,IACHvmE,GAAK8lB,CAAM,EAEbA,EAAO,OAAO,QAAQzT,GAAK,CACzB,MAAMsc,EAAOs4C,GAAU50D,EAAE,IAAI,EAC7B,GAAK0sD,GAAYpwC,CAAI,EAiBnB,QAAQ,MAAM,GAAG,OAAAA,EAAI,0CAAyC,MAjBxC,CACtB,MAAM8B,EAAQ2uC,GAAY/sD,CAAC,EAK3B,GAJA4f,GAAO,IAAItD,EAAM8B,CAAK,EAIlBA,EAAM,UAAW,CACnB,IAAIz6B,EAAOy6B,EAAM,UACby2C,GAAuBlxE,CAAI,IACxBwrE,GAAa,IAAI,YAAY,IAChCxrE,EAAOyM,GAAgBwK,GAAOjX,CAAI,EAClCkwE,GAAU,EAAElwE,CAAI,IAGpBwd,GAAW,IAAImb,EAAM34B,CAAI,CAC1B,CACP,CAGA,CAAG,CACH,EAEMgK,GAAO8lB,GAAU,CACrBqgD,GAAWrgD,EAAO,KACd28B,GAAW38B,EAAO,IAAI,IACxBu5C,GAAcv5C,EAAO,MAEnB43C,GAAU53C,EAAO,UAAU,IAC7BsgD,GAAatgD,EAAO,YAElB28B,GAAW38B,EAAO,eAAe,IACnCugD,GAAkBvgD,EAAO,iBAEvB28B,GAAW38B,EAAO,cAAc,IAClCwgD,GAAiBxgD,EAAO,gBAEtBA,EAAO,gBACT,QAAQ,KACN,4JACD,EACD,QAAQ,KACN,qFACD,EACGihD,GAAOjhD,EAAO,aAAa,EAC7BA,EAAO,OAAO,KAAK,CACjB,KAAM,IACN,UAAWA,EAAO,cAGlB,MAAOu5C,IAAe,KACtB,QAAS,CACP,eAAgB,EACjB,CACT,CAAO,EAED,QAAQ,MAAM,aAAa,OAAAv5C,EAAO,cAAa,iCAAgC,GAGnFA,EAAO,OAAO,QAAQzjB,GAAQ,CAE5B,MAAM8kE,EAAelK,GAAW56D,EAAK,IAAI,EAUzC,GAFgB,eAEJ,KAAK8kE,CAAY,EAAG,CAC9B,MAAMC,EAAe/kE,EAAK,KAAK,UAAU,EAAGA,EAAK,KAAK,YAAY,GAAG,CAAC,EAChE0vB,EAAe1vB,EAAK,KAAK,UAAU,EAAGA,EAAK,KAAK,YAAY,GAAG,CAAC,EACtEA,EAAK,KAAO0vB,EAEZ,IAAIs1C,EAAe,CAAE,GAAGhlE,CAAM,EAC9BglE,EAAa,KAAOD,EACpBthD,EAAO,OAAO,KAAKuhD,CAAY,CAChC,CACL,CAAG,EACDd,GAAc,EAChB,EAEae,GAAiB,CAAC72C,EAAOz6B,IAAS,CACzCwd,GAAW,IAAIid,CAAK,GACtBjd,GAAW,IAAIid,EAAOz6B,CAAI,CAE9B,EAEauxE,GAAe92C,GACtBjd,GAAW,IAAIid,CAAK,EACfjd,GAAW,IAAIid,CAAK,EAEtB,KAII+2C,GAAwB/2C,GAAS,CACxCjd,GAAW,IAAIid,CAAK,GAAKy1C,GAAU,SAAS1yD,GAAW,IAAIid,CAAK,CAAC,IAAM,KACzEy1C,GAAU,OAAO1yD,GAAW,IAAIid,CAAK,CAAC,EACtC62C,GAAe72C,EAAOjd,GAAW,IAAIid,CAAK,EAAE,aAAejd,GAAW,IAAIid,CAAK,EAAE,WAAW,EAEhG,EAMag3C,GAAyB,IAAM,CAC1C,GAAI,CAACjG,IAAgB,CAACA,GAAa,KACjC,MAAO,GAIT,MAAMkG,EAAelG,GAAa,IAAI,YAAY,EAClD,MAAO,EAAG9D,GAAUgK,CAAY,GAAK,CAACA,GAAkBhK,GAAU0I,EAAU,GAAK,CAACA,GACpF,EAOauB,GAAoB3a,GAAW,CAC1C,MAAMj6B,EAAOi6B,EAAQ,KACfv8B,EAAQu8B,EAAQ,MAChB6S,EAAW7S,EAAQ,SACnBzoB,EAAOyoB,EAAQ,KAGjBmS,GAAU1uC,EAAM,QAAS,cAAc,EACzCoxC,GAAW,EAAE,EACJ9uC,GAAQ,CAAC+pC,GAAW,KAAKrsC,EAAM,IAAI,GAC5CqwC,GAAc9T,CAAO,EAKvBsa,GAAe72C,EAAM,KAAM8T,CAAI,EAE3ByoB,EAAQ,kBAAoB,CAACA,EAAQ,UACvC+S,GAAKx7B,EAAM,SAAS,EACXyoB,EAAQ,WACjB+S,GAAKx7B,EAAM,SAAS,EAIlB47B,IACFE,GAAc5vC,EAAM,QAAS8T,CAAI,EAM/Bg9B,GAAe,GAAI,CAACvU,EAAQ,kBAC9B4a,GAAQpB,GAAYxZ,CAAO,EAIzB6S,EAAS,IAAIlC,GAAQ,YAAY,GAAKlb,GAAWle,EAAK,YAAY,GACpEA,EAAK,aAAas7B,EAAS,IAAIlC,GAAQ,YAAY,CAAC,EAGtDkK,GAActjC,CAAI,EAElBkiC,GAAazZ,EAAQ,KACrBiU,GAAcxwC,EAAM,KAGpB,QAASu8B,KAAW8a,GAAc,SAC5B9a,EAAQ,aAAeA,EAAQ,MACjC8a,GAAc,OAAO9a,EAAQ,IAAI,EAIrCsZ,GAAetZ,CAAO,EAEtB4Q,GAAI,KAAK,WAAYntC,EAAM,IAAI,EAC/BmtC,GAAI,KAAK,UAAW7qC,CAAI,CAC1B,EAEM60C,GAAU,CAACrjC,EAAMyoB,IAAY,CACjC,MAAMv8B,EAAQwwC,GACRpB,EAAW7S,EAAQ,SACnB+a,EAAcvG,GAAa,IAAI,aAAa,EAC5CwG,EAAgBxG,GAAa,IAAI,sBAAsB,EACvDyG,EAAYpI,EAAS,IAAI,WAAW,EACpCqI,EAAgBrI,EAAS,IAAIlC,GAAQ,SAAS,EAEpD,IAAIwK,EAAY,GAKZD,IAAkBF,GAAiBD,KACrCI,EAAY,IAKVJ,GAAe,CAACE,IAClBE,EAAY,IAIVlH,KAAgBjU,EAAQ,MAAM,OAChCmb,EAAY,IAGVA,GAGFb,GAAe72C,EAAO8T,EAAK,aAAeA,EAAK,WAAW,EAG1D2hC,GAAU,OAAO3hC,CAAI,EAIjBi9B,GAAa,IAAI,YAAY,GAC/Bv0D,GAAM,GAAI,GAKZs3B,EAAK,MAAM,CACT,EAAG,EACH,EAAG,EACH,MAAO,EACP,QAAS,GACT,MAAO,CACb,CAAK,CAEL,EAEaw8B,GAAgB,IACpB0F,GAOIoB,GAAgBtjC,GAAQ,CACnCiiC,GAAajiC,CACf,EAEag9B,GAAgB,IACpBiF,GAGI4B,GAAiB,IACrBnH,GAGIoH,GAAc,IAClB3B,GAGI4B,GAAcv1C,GAAQ,CACjC2zC,GAAmB3zC,CACrB,EAEaw1C,GAAmB3rE,GAAS,CACvC+pE,GAAgB/pE,CAClB,EAEa4rE,GAAmB,IACvB7B,GAGI5H,GAAc/hE,GAClBi1B,GAAO,IAAIj1B,CAAG,EAGVyrE,GAAc,IAClBtC,GAGIuC,GAAiB,IACrBrJ,GAGIoC,GAAkB,IACtBD,GAGI5B,GAAY,IAChB3tC,GCtdIwwB,GAAa/mD,GACjB,OAAOA,GAAM,WAGT+hE,GAAW/hE,GACf,OAAOA,GAAM,UAAYA,IAAM,KAG3BgiE,GAAYhiE,GAChB,OAAOA,GAAM,UAGTqrE,GAASrrE,GAChB,GAAAA,aAAaqmE,GAAU,SAAWmF,GAAuBxrE,CAAC,GAMnDwrE,GAAyBlxE,GAC7BA,EAAK,WAAa,gBAAiBA,EAAK,UAGpCiI,GAAUvC,GACd,MAAM,QAAQA,CAAC,EAGXskE,GAAUtkE,GACd,GAAG,OAAAA,EAAE,OAAO,CAAC,EAAE,YAAa,GAAG,OAAAA,EAAE,MAAM,CAAC,GAGpCwqB,GAAWxqB,GACf,OAAOA,GAAM,SAGTD,GAAYi1D,GAAU,CACjC,IAAIpyD,EACJ,GAAImkD,GAAWiO,CAAM,EACnB,GAAI,CACFpyD,EAASoyD,EAAO,MAAM,IAAI,CAC3B,OAAQ,EAAG,CACVpyD,EAAS,CACV,MAEDA,EAASoyD,EAEX,OAAO+M,GAASn/D,CAAM,GAAKmkD,GAAWnkD,EAAO,IAAI,CACnD,EAEa2oE,GAAY,CAACl0C,EAAO,KACxBA,EAAK,QAAQ,KAAM,EAAE,EAAE,QAAQ,OAAQ,EAAE,EAGrCi0C,GAAe,IAAM,CAChC,MAAM2B,EAAiBtL,GAAS,IAAI,WAAY,QAAQ,EAClDuL,EAAQnL,GAASkL,CAAc,EACrC,MAAO,CACL,YACA,aACA,uBACA,aACA,cACA,gBACA,oBACA,mBACA,aACA,eACJ,EAAI,OAAO,CAAC7iD,EAAQ9oB,KAChB8oB,EAAO,IAAI9oB,EAAK4rE,EAAQD,EAAe3rE,CAAG,EAAIqgE,GAAS,IAAI,WAAYrgE,CAAG,CAAC,EACpE8oB,GACN,IAAI,GAAK,CACd,EAkBa+iD,GAAuB,CAAC91C,EAAOguC,OAAoB,CAC9D,MAAM+H,EAAaC,GAAe,GAC7Bh2C,IAAS,KAAO,CAACA,IAAS+1C,GACzB5iD,GAAS4iD,CAAU,IACrB/1C,EAAO+1C,GAIX,IAAIE,EAAQ,GAEZ,MAAM3wE,EADW,WACQ,KAAK06B,CAAI,EAC5BzD,EAAS,CAAE,EAMjB,GAJI,SAAS,UAAY,SAAS,SAAS,SACzC05C,EAAQ,SAAS,SAAS,QAGxB3wE,GAAWA,EAAQ,OAAQ,CAC7B,IAAI4wE,EAAa5wE,EAAQ,CAAC,EACtB2wE,GAIFC,EAAaA,EAAW,QAAQ,MAAO,EAAE,EAGzCD,EAAQ,GAAG,OAAAA,EAAK,KAAI,OAAAC,IAEpBD,EAAQC,CAEX,CAED,GAAID,EAAO,CACT,MAAME,EAAY,IAAI,gBAAgBF,CAAK,EAC3C,SAAW,CAAChsE,EAAKvC,CAAK,IAAKyuE,EAAU,QAAO,EAC1C55C,EAAOtyB,CAAG,EAAIvC,EAEhB,OAAO60B,CACX,KACI,OAAO,EAEX,EAEaowC,GAAsBp5C,GAC5Bm3C,GAASn3C,CAAG,EAIf,IACA,OAAO,KAAKA,CAAG,EACZ,IAAItpB,GACI,GAAG,OAAAA,EAAG,KAAI,OAAAspB,EAAItpB,CAAG,EACzB,EACA,KAAK,GAAG,EARJ,GAYE2gE,GAAU,CACrB,MAAO,OAAO,OAAO,EACrB,KAAM,OAAO,MAAM,EACnB,MAAO,OAAO,OAAO,EACrB,YAAa,OAAO,aAAa,EACjC,QAAS,OAAO,SAAS,EACzB,OAAQ,OAAO,QAAQ,EACvB,UAAW,OAAO,WAAW,EAC7B,aAAc,OAAO,cAAc,EACnC,YAAa,OAAO,aAAa,CACnC,EC5JawL,GAAY,CACvB,GAAInc,IACFub,GAAiB/vE,EAAI,OAAS,EAAE,EAChCA,EAAI,UAAU,SAAS,EAChB4wE,GAAapc,CAAO,GAE7B,OAAQA,GACCoc,GAAapc,CAAO,EAE7B,MAAOA,GAAW,CAChB,GAAI,CACFoc,GAAapc,EAAS,EAAI,CAC3B,OAAQz3D,EAAG,CAEX,CACD,OAAO,QAAQ,QAAS,CACzB,CACH,EAEM6zE,GAAe,CAACpc,EAASqc,IAAiB,CAC9C,MAAM54C,EAAQu8B,EAAQ,MAChBxf,EAAW/c,EAAM,SACjB64C,EAAU74C,EAAM,MAAQA,EAAM,MAAQ,IAAO,EAC7CnB,EAASi6C,GAAevc,CAAO,EACrC,OAAOxf,EACJ,QAAQwf,EAAQ,KAAM,CAAE,GAAG19B,CAAM,CAAE,EACnC,KAAK,IAAM,CACV09B,EAAQ,KAAK2Q,GAAQ,OAAO,EAAI,KAAK,IAAG,EAAK2L,EACzCD,GACFtJ,GAAK/S,EAAQ,KAAM,cAAc,CAEzC,CAAK,EACA,MAAMz3D,GAAK,CACV,MAAAy3D,EAAQ,KAAK2Q,GAAQ,OAAO,EAAI,KAAK,IAAK,EACpCpoE,CACZ,CAAK,CACL,EAEag0E,GAAiB,CAAC,CAAE,KAAAhlC,EAAM,MAAA9T,EAAO,KAAAsC,EAAM,SAAA8sC,EAAW,IAAI,OAAY,CAC7E,MAAM2J,EAAYxK,GAAkBjsC,EAAMtC,EAAM,IAAI,EAC9Cg5C,EAAcZ,GAAqB91C,CAAI,EACvC22C,EAAW,IAAI,IAAI,CAAC,GAAGF,EAAW,GAAG3J,CAAQ,CAAC,EAC9CvwC,EAAS,CAAE,EAIjB,OAAS,CAACjrB,EAAM5J,CAAK,IAAKivE,EACxBp6C,EAAOjrB,CAAI,EAAI5J,EAQjB,GALIgvE,IACFn6C,EAAOquC,GAAQ,WAAW,EAAI8L,GAI5B5J,EAAS,KAAM,CACjB,MAAMv5C,EAAM,CAAE,EACd,OAAS,CAACxiB,EAAGpI,CAAC,IAAKmkE,EACjBv5C,EAAIxiB,CAAC,EAAIpI,EAEX6oC,EAAK,QAAUje,CAChB,CAID,OAAAie,EAAK,OAASjV,EACdywC,GAAKx7B,EAAM,CAAC,WAAW,EAAGjV,CAAM,EAEzBA,CACT,EAOaq6C,GAAgBplC,GAAQ,CACnC,GAAI,CAACA,EAAKo5B,GAAQ,OAAO,EACvB,MAAO,GAGT,MAAM2L,EAAU/kC,EAAKo5B,GAAQ,OAAO,EAGpC,OAFY,KAAK,IAAK,GAER2L,CAChB,EAEaM,GAAcj7C,GACrBowC,GAAYpwC,CAAI,EAEX,CAAC,CADOsD,GAAO,IAAItD,CAAI,EACd,SAEX,GAGIk7C,GAAcp5C,GAAS,CAElC,GAAIsuC,GAAYtuC,EAAM,IAAI,EAAG,CAC3B,KAAM,CAAE,SAAA+c,CAAQ,EAAKvb,GAAO,IAAIxB,EAAM,IAAI,EAC1C,MAAO,CACL,KAAM+c,EAAS,KACf,SAAUA,EAAS,OACpB,CACF,CACH,EC7GMiuB,GAAO,CAACnlE,EAAGoI,IACR,IAAI,QAAQoM,GAAW,CAC5BxU,EAAE,MAAM,CACN,MAAO,EACP,QAAS,GACT,OAAQ,CACN,MAAO,CAAC,EAAG,CAAE,SAAU,GAAK,MAAO,GAAK,CACzC,CACP,CAAK,EAEDA,EAAE,WAAW,OAAO,EAAE,GAAG,SAAU,IAAM,CACnCoI,IACFA,EAAE,QAAU,IAEdoM,EAAS,CACf,CAAK,CACL,CAAG,EAGGg/D,GAAY,CAACxzE,EAAGoI,IACb,IAAI,QAAQoM,GAAW,CAC5BxU,EAAE,MAAM,CACN,MAAO,EACP,QAAS,GACT,OAAQ,CACN,MAAO,CAAC,EAAG,CAAE,SAAU,GAAK,MAAO,GAAK,CACzC,CACP,CAAK,EACGoI,GACFA,EAAE,MAAM,CACN,OAAQ,CACN,MAAO,CAAC,EAAG,CAAE,SAAU,GAAK,MAAO,GAAK,CACzC,CACT,CAAO,EAGHpI,EAAE,WAAW,OAAO,EAAE,GAAG,SAAU,IAAM,CACvCwU,EAAS,CACf,CAAK,CACL,CAAG,EAGGi/D,GAAa,CAACC,EAAM7hD,EAAW7xB,EAAGoI,IAAM,CAC5C,MAAMurE,EAASD,IAAS,IAAM,KAAO,KACrC,OAAO,IAAI,QAAQl/D,GAAW,CAC5BxU,EAAE,MAAM,CACN,CAAC,GAAG,OAAA0zE,EAAM,EAAG7hD,EAAY8hD,EAAS,GAAKA,EACvC,QAAS,GACT,OAAQ,CACN,CAAC,GAAG,OAAAD,EAAM,EAAG,CAAC,EAAG,CAAE,SAAU,GAAK,MAAO,GAAK,CAC/C,CACP,CAAK,EAEGtrE,GACFA,EAAE,MAAM,CACN,CAAC,GAAG,OAAAsrE,EAAM,EAAG,EACb,OAAQ,CACN,CAAC,GAAG,OAAAA,EAAM,EAAG,CAAC7hD,EAAY8hD,EAASA,EAAS,GAAI,CAAE,SAAU,GAAK,MAAO,EAAG,CAAE,CAC9E,CACT,CAAO,EAGH3zE,EAAE,WAAW0zE,CAAI,EAAE,GAAG,SAAU,IAAM,CACpCl/D,EAAS,CACf,CAAK,CACL,CAAG,CACH,EAEMizB,GAAK,CAACznC,EAAGoI,IACNqrE,GAAW,IAAK,EAAGzzE,EAAGoI,CAAC,EAG1Bs/B,GAAO,CAAC1nC,EAAGoI,IACRqrE,GAAW,IAAK,EAAGzzE,EAAGoI,CAAC,EAG1Bk7B,GAAO,CAACtjC,EAAGoI,IACRqrE,GAAW,IAAK,EAAGzzE,EAAGoI,CAAC,EAG1Bm7B,GAAQ,CAACvjC,EAAGoI,IACTqrE,GAAW,IAAK,EAAGzzE,EAAGoI,CAAC,EAGjBwrE,GAAA,CACb,KAAAzO,GACA,UAAAqO,GACA,GAAA/rC,GACA,KAAAC,GACA,KAAApE,GACA,MAAAC,EACF,EChFaswC,GAAoB,CAACC,EAAQC,EAAU,OAAS,CAC3D,MAAMzY,EAAawY,EAAO,gBAAkBA,EAAO,OAC7CE,EAAuB,CAAC,EAAEF,EAAO,UAAYA,EAAO,aAAexY,GACnE2Y,EAAsB9I,KAAkB,IAAI,oBAAoB,EAOtE,GALI2I,EAAO,QACT,QAAQ,KAAK,yEAAyE,EAIpF,CAACE,GAAwBC,EAC3B,OAAAH,EAAO,QAAU,GACbC,IACFA,EAAQ,QAAU,IAEb,QAAQ,QAAS,EAG1B,GAAIzY,EAAY,CACd,IAAI57D,EACJ,GAAI,CACFA,EAAO47D,EAAW,KAAKwY,EAAQA,EAAQC,CAAO,CAC/C,OAAQ90E,EAAG,CACVS,EAAO,WACR,CAED,GAAIyF,GAAUzF,CAAI,EAChB,OAAOA,EAGT,GAAIkwB,GAASlwB,CAAI,EAAG,CAClB,MAAM6D,EAAKqwE,GAAYl0E,CAAI,EAC3B,GAAI6D,EACF,OAAOA,EAAGuwE,EAAQC,CAAO,CAE5B,CAGD,GAAID,EAAO,SAAU,CAGnB,MAAMI,EAAS,CAACztE,EAAGrB,EAAGsqB,EAAO,KACpB,IAAI,QAAQlb,GAAW,CAC5Bs/D,EAAO,QAAU,GACjBA,EAAO,UAAUrtE,EAAGrB,EAAGsqB,CAAI,EAC3BokD,EAAO,WAAWrtE,CAAC,EAAE,GAAG,SAAU,IAAM,CACtC+N,EAAS,CACrB,CAAW,CACX,CAAS,EAEH,OAAOs/D,EAAO,SAAS,CAAE,OAAAA,EAAQ,OAAAI,CAAM,CAAE,CAC1C,CACF,CACD,OAAON,GAAY,UAAUE,EAAQC,CAAO,CAC9C,ECrCajtE,GAAO,MAAM4vD,GAAW,CACnC,IAAIyd,EAAU,GACd,GAAI,CAqBF,GApBAzd,EAAU,MAAMhX,GAAOgX,CAAO,EAC1BA,GAAW,CAACA,EAAQ,aAGlBx0D,EAAI,QAAU,YACZgwE,GAAkB,IAAK,UACzBhwE,EAAI,UAAU,UAAW,CAACooE,GAAiB,EAAC,EAE5CpoE,EAAI,UAAU,EAAE,GAKhB,CAACw0D,EAAQ,kBAAoB,CAACA,EAAQ,aACxC,MAAMmd,GAAkBnd,EAAQ,KAAMuU,GAAa,CAAE,GAGvDkJ,EAAU,GAGRA,GAAWzd,EAAQ,YACrB4Q,GAAI,MAAM,YAAa,YAAY,OAAA5Q,EAAQ,KAAI,sBAAqB,OAAAqb,KAAa,WAAU,EACvFrb,EAAQ,WAAa,CAACA,EAAQ,kBAEhCkZ,GAAU,OAAOlZ,EAAQ,IAAI,MAG/B,QAAA2a,GAAkB3a,CAAO,EAElBA,EAAQ,IAElB,OAAQA,EAAS,CAChB,GAAI,CAACA,EAAQ,MACX,QAAQ,MAAMA,CAAO,UACZ,CAACyd,EAAS,CAEnB,KAAM,CAAE,MAAAh6C,CAAK,EAAKu8B,EAEdmS,GAAU1uC,EAAM,QAAS,cAAc,EACzCoxC,GAAW,EAAE,EACH/E,GAAW,KAAKrsC,EAAM,IAAI,GACpCqwC,GAAc9T,CAAO,EAGnBA,EAAQ,WAAa,CAACA,EAAQ,kBAEhCkZ,GAAU,OAAOlZ,EAAQ,IAAI,EAE/BnuD,GAAYmuD,CAAO,CACpB,CACF,CACH,EAEMhX,GAAS,MAAMgX,GAAW,CAC9B,MAAMv8B,EAAQu8B,EAAQ,MAChBj6B,EAAOi6B,EAAQ,KACf6S,EAAW7S,EAAQ,SAGzB,IAAIh3D,EAAOuxE,GAAa92C,EAAM,IAAI,EAC9Bi6C,EAAcxD,GAAuBlxE,CAAI,EACzC20E,EAAU,GAYd,GARI,CAACD,GAAe,CAAC7K,EAAS,IAAIlC,GAAQ,SAAS,IAC5CiN,GAAUn6C,CAAK,IAClBz6B,EAAOA,EAAK,YACZ00E,EAAc,KAKbA,EAuBH1d,EAAQ,KAAOvqD,GAAgBwK,GAAOjX,CAAI,EAC1CkwE,GAAU,EAAElZ,EAAQ,IAAI,EAEpB4c,GAAYn5C,EAAM,IAAI,IACxBk6C,EAAU,IAEZ3d,EAAQ,UAAY,OA7BJ,CAChBA,EAAQ,KAAOh3D,EAEX4zE,GAAYn5C,EAAM,IAAI,IACpBk5C,GAAc3zE,CAAI,GAAKA,EAAK2nE,GAAQ,IAAI,IAAM5qC,KAChD43C,EAAU,IAGd,IAAIE,EAAetJ,GAAe,GAAIA,GAAa,EAAG5D,GAAQ,KAAK,EAK/DltC,EAAM,OAASo6C,IACjB7d,EAAQ,iBAAmB,GAIvBvK,GAAWuK,EAAQ,KAAK,YAAY,IACtCA,EAAQ,mBAAqBA,EAAQ,KAAK,aAAc,GAGhE,CAYEA,EAAQ,KAAK2Q,GAAQ,IAAI,EAAI5qC,EAC7Bi6B,EAAQ,KAAK2Q,GAAQ,KAAK,EAAIltC,EAAM,KAEpC,GAAI,CACF,GAAIk6C,EAAS,CAGX,KAAM,CAAE,KAAMG,EAAU,SAAAt9B,CAAQ,EAAKq8B,GAAYp5C,CAAK,EAStD,OANAu8B,EAAQ,SAAWxf,EACnBwf,EAAQ,aAAe8d,EAEvB,MAAM3B,GAAU2B,CAAQ,EAAE9d,CAAO,EAG7Bj6B,IAASs1C,KACJ,IAEHrb,EAAQ,eAAiB,SAC3B+S,GAAK/S,EAAQ,KAAM,cAAc,EAG5BA,EAEf,KACM,QAAAuc,GAAevc,CAAO,EACfA,CAEV,OAAQz3D,EAAG,CACV,OAAAy3D,EAAQ,MAAQz3D,EACT,QAAQ,OAAOy3D,CAAO,CAC9B,CACH,EAEMnuD,GAAcmuD,GAAW,CACzBA,GAAWA,EAAQ,MACrB,QAAQ,MAAMA,EAAQ,KAAK,EAClBA,GACT4Q,GAAI,MAAM5Q,CAAO,EAGfA,EAAQ,MAAQ+R,GAAY,GAAG,GACjCx/B,GAAS,IAAK,CAAE,QAAAytB,CAAO,EAAI,EAAK,CAEpC,EAEa4d,GAAYn6C,GAAS,CAChC,MAAMojC,EAAMsL,GAAU1uC,EAAM,QAAS,eAAe,EAC9C3K,EAAS07C,GAAa,IAAI,eAAe,EAG/C,OAAI9D,GAAU7J,CAAG,EACRA,EAEF,EAAE6J,GAAU53C,CAAM,GAAKA,IAAW,GAC3C,EC7LO,MAAMilD,WAAkBhJ,GAAU,SAAU,CACjD,OAAO,WAAY,CACjB,MAAO,CACL,MAAO,CACL,mBAAoB,EACrB,EAKD,QAAS,CACP,KAAM,GACN,EAAG,KACH,EAAG,KACH,MAAO,WACP,QAAS,GACT,OAAQ,GACR,MAAO,CACL,MAAO,GACP,EAAG,IACH,EAAG,IACH,KAAM,CACJ,KAAM,WACP,CACF,CACF,CACF,CACF,CAED,OAAO,SAAU,CACf,MAAO,CACL,cAAsB,IAAK,CACzB,QAAS,CACP,KAAK,IAAI,SAAS,EAAE,QAAU,EAC/B,CAED,OAAQ,CACN,KAAK,IAAI,SAAS,EAAE,QAAU,EAC/B,CACF,EACD,cAAsB,IAAK,CACzB,OAAO/7C,EAAMo6C,EAAQ,CAEnB,KAAK,QAAUA,EAKf,KAAK,SAAU,CAChB,CAED,aAAc,CAGZ,OAAO,KAAK,OACb,CAGD,OAAOA,EAAQ,CACb,KAAK,QAAUA,EACf,KAAK,SAAU,CAChB,CAED,YAAa,CACX,MAAMO,EAAea,GAAa,IAAI,mBAAmB,GAOrD,CAAC9D,GAAUiD,CAAY,GAAKA,IAAiB,KAC/CqK,GAAO,UAAW,CAErB,CACF,CACF,CACF,CAKD,IAAI,OAAQ,CACV,OAAO,KAAK,IAAI,OAAO,CACxB,CAKD,IAAI,SAAU,CACZ,OAAO,KAAK,IAAI,SAAS,CAC1B,CAOD,aAAc,CAAE,CAMhB,aAAc,CACZ,OAAOA,GAAO,cAAe,CAC9B,CACH,CChEO,IAAIlD,GAAgB,IAAI,IAC3BmD,GAAa,GACbnC,GAAa,GAOjB,MAAMoC,GAAc,CAACplD,EAAQ+6C,IAAa,CACxCgG,GAAW/gD,EAAQ+6C,CAAQ,EAC3BsK,GAAkB,EAClBjpE,GAAO,CACT,EAGMA,GAAQ,IAAM,CAClB,IAAI6wB,GAAQq4C,GAAS,GAAI,IAAI,QAAQ,KAAM,EAAE,EAC7C,MAAMC,EAAU,IACV/7C,EAASu5C,GAAqB91C,CAAI,EAClCssC,EAAcqJ,GAAgB,EAC9BvC,EAAWsC,GAAa,EACxB6C,EAAev4C,EAAK,QAAQs4C,CAAO,IAAM,GAI3CvO,GAAW,KAAK/pC,CAAI,GAAKA,IAASs4C,IACpCt4C,EAAO,IAIT+1C,GAAawC,EAAenF,EAAWpzC,GAAQozC,EAE/C,MAAM9C,EAAQ,IAAM,CACd,CAACtwC,GAAQozC,EACPjgD,GAASigD,CAAQ,EACnB5mC,GAAS4mC,CAAQ,EACR1jB,GAAW0jB,CAAQ,GAC5BA,EAAU,EAAC,KAAK9lE,GAAO,CACjBo9D,GAASp9D,CAAG,EACdk/B,GAASl/B,EAAI,KAAMA,EAAI,MAAM,EAE7Bk/B,GAASl/B,CAAG,CAExB,CAAS,GAGHE,GAAMwyB,CAAI,EACVw4C,GAAkB,EACf,KAAK,IAAM,CACV/yE,EAAI,SAAU,CACxB,CAAS,EACA,MAAMjD,GAAK,CACV,QAAQ,MAAMA,CAAC,CACzB,CAAS,EAEN,EAED,GAAIwpE,GAAYsM,CAAO,EAAG,CACxB,GAAIt4C,GAAQ,CAACu4C,GACP,CAACtN,GAAejrC,CAAI,EAAG,CACzBwM,GAAS,IAAK,CAAE,WAAYxM,CAAI,CAAE,EAClC,MACD,CAEHwM,GACE8rC,EACA,CACE,OAAQvC,GACR,OAAQuC,IAAYt4C,CACrB,EACD,EACD,CACL,MAAa0vB,GAAW4c,CAAW,EAC/BA,EAAY/vC,CAAM,EACf,KAAK,IAAM,CACV+zC,EAAO,CACf,CAAO,EACA,MAAM9tE,GAAK,CACVi2E,GAAgBj2E,CAAC,CACzB,CAAO,EAEH8tE,EAAO,CAEX,EAEMmI,GAAkBj2E,GAAK,CACvBwpE,GAAY,GAAG,EACjBx/B,GAAS,IAAK,CAAE,QAAS,CAAE,MAAOhqC,CAAC,EAAI,EAEvC,QAAQ,MAAMA,CAAC,CAEnB,EAQagqC,GAAW,CAACtoC,EAAK+uB,EAAO,GAAI8/B,IAAU,CACjD,GAAI2X,GAASxmE,CAAG,IACdA,EAAMsoE,GAActoE,CAAG,EACnB,CAACA,GACH,OAIJ,IAAI87B,EAAOq4C,GAAS,EAChB,CAAC3D,GAAwB,GAAIwD,KAC/Bl4C,EAAOk4C,IAELl4C,EAAK,QAAQ,KAAM,EAAE,IAAM97B,GAE7BsJ,GAAMtJ,EAAK+uB,EAAM8/B,CAAK,EAElB2hB,GAAsB,EACxBgE,GAAQx0E,CAAG,GAEXg0E,GAAah0E,EACbs0E,GAAiBt0E,CAAG,EACjB,KAAK,IAAM,CACVuB,EAAI,SAAU,CACxB,CAAS,EACA,MAAMjD,GAAK,CACV,QAAQ,MAAMA,CAAC,CACzB,CAAS,IAEIywB,EAAK,SAEdzlB,GAAMtJ,EAAK+uB,EAAM8/B,CAAK,EAEtBylB,GAAiBt0E,CAAG,EACjB,KAAK,IAAM,CACVuB,EAAI,SAAU,CACtB,CAAO,EACA,MAAMjD,GAAK,CACV,QAAQ,MAAMA,CAAC,CACvB,CAAO,EAEP,EAEMgL,GAAQ,CAACwyB,EAAM/M,EAAO,GAAI8/B,IAAU,CAExC,GADA/yB,EAAOk0C,GAAUl0C,CAAI,EACjB,CAAC+0C,GAAc,IAAI/0C,CAAI,EAAG,CAC5B,QAASi6B,KAAW8a,GAAc,SAChC9a,EAAQ,OAAQ,EAElB,MAAMA,EAAUsS,GAAcvsC,EAAM/M,EAAM8/B,CAAK,EAC/C,OAAAgiB,GAAc,IAAI,mBAAmB/0C,CAAI,EAAGi6B,CAAO,EAE5CA,CACR,CACD,MAAO,EACT,EAOMue,GAAmB,MAAMG,GAAY,CACzC,MAAM34C,EAAOk0C,GAAUyE,GAAYN,GAAO,CAAE,EACtCO,EAAU,mBAAmB54C,CAAI,EACvC,IAAIi6B,EAAU8a,GAAc,IAAI6D,CAAO,EAGnC,CAAC3e,GAAW,CAAC8a,GAAc,OAC7B9a,EAAUzsD,GAAMwyB,CAAI,GAGtB,MAAMtC,EAAQutC,GAAejrC,CAAI,EAEjC,GAAI,CAACtC,EAAO,CACNsuC,GAAY,GAAG,EACjBx/B,GAAS,IAAK,CAAE,WAAYxM,CAAI,CAAE,EAElC,QAAQ,MAAM,0BAA0B,OAAAA,EAAM,EAEhD,MACD,CAGDi6B,EAAQ,KAAOj6B,EACfi6B,EAAQ,MAAQv8B,EAEhB,IAAInyB,EAAS,MAAM+nE,GAAgBtF,GAAa,EAAI/T,CAAO,EAO3D,GAJI1uD,GAAUmyB,EAAM,iBAClBnyB,EAAS,MAAMmyB,EAAM,eAAeswC,GAAa,EAAI/T,CAAO,GAG1D0Q,GAAUp/D,CAAM,GAGlB,GAAIA,EACF,OAAOstE,GAAkB5e,CAAO,UAKlCA,EAAQ,OAAQ,EAChB8a,GAAc,OAAO6D,CAAO,EAExBzlD,GAAS5nB,CAAM,EACjBihC,GAASjhC,CAAM,UACNm/D,GAASn/D,CAAM,EAAG,CAC3B,IAAIwnD,EAAQ,GACR4X,GAAUp/D,EAAO,KAAK,IACxBwnD,EAAQxnD,EAAO,OAEjBihC,GAASjhC,EAAO,KAAMA,EAAO,OAAQwnD,CAAK,CAC3C,CAEL,EAOM8lB,GAAoB5e,GAAW,CACnC,MAAMj6B,EAAOi6B,EAAQ,KACfv8B,EAAQu8B,EAAQ,MAChB2e,EAAU,mBAAmB54C,CAAI,EAMvC,GAFAu1C,GAAYv1C,CAAI,EAEZtC,EAAM,KAAM,CACd,MAAMiB,EAAY61C,GAAa92C,EAAM,IAAI,EAEzC,GAAIgyB,GAAWhyB,EAAM,IAAI,EAAG,CAC1B,MAAMy4C,EAAYlK,GAAkBjsC,EAAMtC,EAAM,IAAI,EAC9CnB,EAAS,CAAE,EACjB,UAAWtyB,KAAOksE,EAAU,OAC1B55C,EAAOtyB,CAAG,EAAIksE,EAAU,IAAIlsE,CAAG,EAEjCyzB,EAAM,KAAKj4B,EAAK,CAAE,GAAG82B,CAAM,CAAE,CAC9B,CAED,GAAIoC,EAAW,CAEb,MAAM80C,EAAajF,GAAe,EAClC,GAAIiF,EAAY,CACd,MAAMyB,EAAYtI,GAAoByI,GAAc,EAAIpb,CAAO,EAC3DwZ,GAAc/1C,EAAM,OAAS23C,GAAgB,GAAI,CAACH,GACpDzB,EAAW,UAAU,EAAE,CAE1B,CAEGO,GAAOr1C,CAAgB,EACzBt0B,GAAK4vD,CAAO,EAAE,KAAK,IAAM,CACvBx0D,EAAI,SAAU,EACdsvE,GAAc,OAAO6D,CAAO,CACtC,CAAS,EAKDj6C,EAAW,EACR,KAAKgT,GACGA,EAAS,OACjB,EACA,KAAKxf,IACJoiD,GAAe72C,EAAM,KAAMvL,CAAM,EAC1B9nB,GAAK4vD,CAAO,EACpB,EACA,KAAK,IAAM,CACVx0D,EAAI,SAAU,EACdsvE,GAAc,OAAO6D,CAAO,CACxC,CAAW,CAEX,MACM7D,GAAc,OAAO6D,CAAO,CAE/B,CACH,EAMahS,GAAO,CAACxY,EAAQ,IAAM,CACjC,GAAI,CAACA,GAAS,MAAMA,CAAK,EACvB,MAAO,GAET,MAAM9f,EAAUugC,GAAY,EAK5B,GAHAzgB,EAAQ,KAAK,IAAIA,CAAK,EAGlB9f,EAAQ,OAAQ,CAElB,MAAM5Q,EAAQ4Q,EAAQ,OAAOA,EAAQ,OAAS8f,EAAOA,CAAK,EAAE,CAAC,EAE7D,OAAA0gB,GAAWxgC,CAAO,EACX9B,GACL9O,EAAM,KACN,CACE,CAACktC,GAAQ,SAAS,EAAG,GACrB,CAACA,GAAQ,YAAY,EAAGltC,EAAM,KAC/B,EACD,EACD,CACF,SAAU+wC,GAAa,IAAI,WAAW,EAAG,CACxC,MAAMqK,EAAe,mBACrB,IAAI94C,EAAOkqC,GAAWmO,IAAS,EAC3BrN,EAAQF,GAAS9qC,CAAI,EAGzB,GAAIgrC,EAAQ,GACV,KAAOA,KAKL,GAHAhrC,EAAOA,EAAK,QAAQ84C,EAAc,EAAE,EAGhC7N,GAAejrC,CAAI,EACrB,OAAOwM,GAASxM,EAAM,CAAE,CAAC4qC,GAAQ,SAAS,EAAG,EAAM,EAAE,EAAK,EAIjE,CAID,OAAIxc,EAAQ9f,EAAQ,OACdohB,GAAWjqD,EAAI,eAAe,EACzBA,EAAI,gBAAiB,EAEvBA,EAAI,YAAY,SAAU,EAE5B,EACT,EAMMszE,GAAS,IAAM,CACf5lD,GAAS4iD,EAAU,GACrBvpC,GAASupC,GAAY,EAAK,EAC1BA,GAAa,IACJrmB,GAAWqmB,EAAU,EAC9BA,GAAY,EAAC,KAAKzoE,GAAO,CACvByoE,GAAa,GACTrL,GAASp9D,CAAG,EACdk/B,GAASl/B,EAAI,KAAMA,EAAI,MAAM,EAE7Bk/B,GAASl/B,CAAG,CAEpB,CAAK,EAED,QAAQ,KAAK,6CAA6C,CAE9D,EAKM0rE,GAAS,IAAM,CACnB,GAAI,CAACC,GAAY,EAAI,CACnB,MAAMj5C,EAAOguC,GAAe,EAC5BxhC,GAASxM,EAAM,CAAE,OAAQ,EAAI,EAAI,EAAK,CACvC,CACH,EAMMi5C,GAAe,IAAM,CACzB,GAAIlE,GAAc,KAAM,CACtB,IAAImE,EAAe,GACnB,QAASjf,KAAW8a,GAAc,SAC3B9a,EAAQ,cACXif,EAAe,IAGnB,OAAOA,CACR,CACD,MAAO,EACT,EAEalD,GAAgB,IACpBD,GAOT,IAAIsC,GAAU,IACL,SAAS,SAAS,KAOvBK,GAAUx0E,GAAO,CACnB,SAAS,SAAS,KAAOA,CAC3B,EAmBA,MAAMk0E,GAAmB,IAAM,CAC7BvF,GAAS,iBAAiB,OAAQ,aAAc,SAAY,CAC1D,GAAI6B,GAAsB,EACxB,GAAI,CACF,MAAM8D,GAAkB,CACzB,OAAQh2E,EAAG,CACV,QAAQ,MAAMA,CAAC,CAChB,CAEP,CAAG,CACH,EAKM4E,GAAO,IAAM,CACjB,MAAMgsE,EAAWsC,GAAa,EAC1BviD,GAASigD,CAAQ,EACnB5mC,GAAS4mC,CAAQ,EACR1jB,GAAW0jB,CAAQ,GAC5BA,EAAU,EAAC,KAAK9lE,GAAO,CACjBo9D,GAASp9D,CAAG,EACdk/B,GAASl/B,EAAI,KAAMA,EAAI,MAAM,EAE7Bk/B,GAASl/B,CAAG,CAEpB,CAAK,CAEL,EAEM6rE,GAAche,GAAU,CAC5BsZ,GAAsBtZ,CAAK,CAC7B,EAGe8c,GAAA,CACb,YAAAE,GACA,SAAA3rC,GACA,OAAAusC,GACA,KAAAnS,GACA,GAAIA,GACJ,KAAMA,GAAK,KAAK,KAAM,EAAE,EACxB,WAAY4H,GACZ,eAAgB,CAEd,OAAOA,GAAe,CACvB,EACD,WAAA2K,GACA,eAAA9D,GACA,cAAArH,GACA,YAAAN,GACA,gBAAAG,GACA,aAAAD,GACA,aAAAqL,GACA,WAAApK,GACA,WAAAC,GACA,gBAAAH,GACA,oBAAAC,GACA,qBAAAkH,GACA,OAAAkD,GACA,QAAApO,GACA,IAAKoN,GAEL,UAAWpK,GACX,KAAMxmE,GAIN,aAAc,CACZ,QAAQ,KAAK,mEAAmE,EAChF,QAAQ,KAAK,2EAA2E,CACzF,EACD,IAAK,CACH,QAAQ,KAAK,2DAA2D,EACxE,QAAQ,KAAK,2EAA2E,CACzF,EACD,QAAS,CACP,QAAQ,KAAK,+DAA+D,EAC5E,QAAQ,KAAK,2EAA2E,CACzF,EACD,OAAQ,CACN,QAAQ,KAAK,8DAA8D,EAC3E,QAAQ,KAAK,2EAA2E,CACzF,CACH,EC9iBe,SAASgyE,GAAWrrE,EAA2B,CAC5D+oB,QAAQ9D,IAAIjlB,EAAM9K,IAAI,EAEtB,MAAMoxC,EAAU5pC,GAAe,IACtB,CACR,EAEK,CAACksC,EAAMC,CAAO,EAAInvC,EAAasG,EAAMuL,CAAC,EAE5C,SAAS+/D,EAAQviC,EAAK,CACpBhgB,QAAQ9D,IAAI,MAAO8jB,CAAG,EACnBA,EAAIpM,WAAa,EAClBkM,EAAQ,EAAE,EAEVA,EAAQE,EAAIpM,SAAW,CAACoM,EAAIxqC,SAAS,CAAC,EAAEgtE,OAAS,EAAE,CAGvD,CAQA,OAAAp3C,EACG7L,EAAI,CAACojB,SAAQ,OAAC3O,OAAK,QAAE9U,GAAO0jB,cAAc,MAAAptC,UAAA,QAAA41B,EACxC8O,GAAO,CACNlF,QAAO,GACPpX,IAAK,GAAE,IACPpb,GAAC,QAAEq9B,EAAI,CAAE,MACTp9B,GAAC,QAAExL,EAAMwL,CAAC,EACVzW,MAAO,KAAI,IACXgoC,OAAK,QAAE9U,GAAOoU,GAAG,EACjBG,eAAgB,YAAW,IAC3B8E,WAAS,QAAEgF,EAAQ,CAAC,CAAC,EACrBwC,kBAAmBwiC,EAAO,IAC1B/qE,OAAK,QAAEP,EAAMzL,IAAI,MACjBqoC,SAAO,QAAE58B,EAAM48B,OAAO,MACtBsC,SAAO,QAAEl/B,EAAMk/B,OAAO,MAI9B,CC3CA,MAAMgN,GAASA,IAAM,CACnB,MAAM1d,EAASiC,KACe/2B,EAAa,CAAC,EAC5C,KAAM,CAACyyC,EAAYC,CAAa,EAAI1yC,EAAY,EAC3BmB,GAAesxC,EAAYE,EAAsB,EACtE,KAAM,CAACzJ,EAAa0J,CAAc,EAAI5yC,EAAa,CAAE,GAC/C+kC,EAAWlO,KACD7zB,GAAe,IACtB,CACR,EAED,MAAMgwC,EAAWhyC,GAAW,IACnB4oC,GAAqBmG,GAAejb,EAAOgB,QAAU,MAAO,CAAC,CAAC,CACtE,EACDl1B,GAAa2C,GAAG8G,GAAgBu0B,GAAQ,CAClCA,EAAIkG,UACNnB,GAAoB/E,EAAIkG,QAAQ,EAK9BlG,EAAIsK,aACN0J,EAAehU,EAAIsK,WAAW,CAGlC,EAAG,CAAEvlC,MAAO,EAAK,EAAC,EAGlB,SAAS6hC,GAA2B,CAClC,IAAIgJ,EAAS,KAAK3pC,SAASo+B,SAC3B/3B,EAAasjC,GAAUA,EAAO3R,IAAI,EAClCkI,EAASyJ,EAAO3R,IAAI,CACtB,CAEA,OAAApC,EACGzwB,GAAI,KAACsxB,MAAI,QAAE0X,EAAU,EAACnJ,MAAO,EAACnhC,MAAM,MAAA7D,UAAA,QAAA41B,EAClC6W,GAAYtO,GAAA,CAAClxB,EAAG,IAAKD,EAAG,EAAE,EAAMq3B,CAAW,GAAAzO,EAC3Ck3C,GAAU,CAAC9/D,EAAG,GAAKC,EAAG,GAAI0zB,QAASA,EAAO,IAAE3qC,MAAI,OAAE,CAAC,GAAGm4C,EAAU,EAACnJ,MAAK,EAAG,CAAC,CAAC,CAAC,OAGnF,EC3CAioC,GAAO/uD,MAAQ,GACf+uD,GAAOC,aAAa9vD,WAAa,SACjC6vD,GAAOC,aAAahlE,MAAQ,WAI5B+hB,GAAO,IAAA2L,EACJzL,GAAM,CAAC9uB,QAAS,CACfuqB,oBAAqB4c,GACrB2qC,qBAA6DC,OAC7DtmE,wBAAyB,GACzBF,SAAU,KAAMC,UAAW,IAC5B,MAAA7G,UAAA,QAAA41B,EACE6C,GAAU,CAAC39B,KAAMumC,GAAG,IAAArhC,UAAA,OAAA41B,GAClBc,GAAK,CAACpH,KAAI,IAAK+C,UAAWoQ,GAAQ7M,IAClCc,GAAK,CAACpH,KAAI,UAAW+C,UAAWg7C,GAAUz3C,IAC1Cc,GAAK,CAACpH,KAAI,UAAW+C,UAAWi7C,GAAM13C,IACtCc,GAAK,CAACpH,KAAI,MAAO+C,UAAWgX,GAAQzT,IACpCc,GAAK,CAACpH,KAAI,QAAS+C,UAAW4Y,GAAQrV,IACtCc,GAAK,CAACpH,KAAI,QAAS+C,UAAWk7C,EAAY,SAGhD","names":["Logic1","Logic2","player","video","videoControls","playpause","mute","fullScreen","backward","forward","currentTime","remainTime","progress","progressBar","videoSource","numType","hls","initVideoQualityOptions","event","data","changeControlsToLive","e","changeButtonState","pos","secondsToTime","toggleFullScreen","currPlayer","width","height","newTime","type","qualityBtn","quality","makeActive","qualities","qAuto","i","q","elems","UserSelectionEvent","q_level","seconds","hours","minutes","remainingSeconds","timeString","playVideo","url","src","initApp","closeVideo","changeControlsToVideo","replaceDOM","old_element","new_element","time","live","backwardTime","attrType","forwardTime","upControls","activeID","qualityDetail","num","extractNumber","downControls","str","matches","createHtml","htmlString","app","div","equalFn","a","b","$PROXY","$TRACK","signalOptions","runEffects","runQueue","STALE","PENDING","UNOWNED","NO_INIT","Owner","Transition","Listener","Updates","Effects","ExecCount","createRoot","fn","detachedOwner","listener","owner","unowned","current","root","updateFn","untrack","cleanNode","runUpdates","createSignal","value","options","s","setter","writeSignal","readSignal","createComputed","c","createComputation","updateComputation","createRenderEffect","createEffect","runUserEffects","SuspenseContext","useContext","createMemo","isPromise","v","createResource","pSource","pFetcher","pOptions","source","fetcher","pr","initP","scheduled","resolved","dynamic","contexts","setValue","error","setError","track","trigger","state","setState","loadEnd","p","key","completeLoad","err","read","load","refetching","lookup","castError","createSelector","subs","node","val","l","onCleanup","batch","on","deps","isArray","prevInput","defer","prevValue","input","result","onMount","getOwner","runWithOwner","o","prev","prevListener","handleError","startTransition","t","createContext","defaultValue","id","createProvider","context","children","memo","resolveChildren","updates","lookUpstream","sSlot","isComp","TransitionRunning","markDownstream","runComputation","nextValue","init","pure","runTop","ancestors","wait","res","completeUpdates","queue","userLength","ignore","index","obs","n","results","props","FALLBACK","dispose","d","mapArray","list","mapFn","items","mapped","disposers","len","indexes","newItems","j","newLen","newIndices","newIndicesNext","temp","tempdisposers","tempIndexes","start","end","newEnd","item","disposer","mapper","set","createComponent","Comp","trueFn","propTraps","_","property","receiver","resolveSource","resolveSources","length","mergeProps","sources","proxy","keys","target","sourcesMap","defined","sourceKeys","desc","splitProps","blocked","k","otherObject","objects","propName","isDefaultDesc","objectIndex","narrowedError","name","For","fallback","Show","keyed","condition","child","DEV","activeElement","setActiveElement","TextureUsageTracker","releaseCallback","__publicField","ManualCountTextureUsageTracker","_a","_b","now","thresholdMs","textureRefInfo","texture","textureId","assertTruthy","FinalizationRegistryTextureUsageTracker","RendererMain","EventEmitter","settings","driver","resolvedSettings","appWidth","appHeight","deviceLogicalPixelRatio","devicePhysicalPixelRatio","useFinalizationRegistryTracker","deviceLogicalWidth","deviceLogicalHeight","canvas","targetEl","fps","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","_m","_n","color","colorTl","colorTr","colorBl","colorBr","_o","_p","_q","_r","_s","_t","_u","_v","_w","_x","_y","_z","_A","_B","_C","_D","_F","_E","_H","_G","_I","_K","_J","_M","_L","_N","_P","_O","_R","_Q","_S","textureType","shaderType","CoreAnimation","getTimingFunction","startValue","endValue","dt","duration","loop","easing","stopMethod","propValue","easingProgressValue","easingColorValue","mergeColorProgress","CoreAnimationController","manager","animation","promise","resolve","m0","m1","m2","m3","m4","m5","m6","m7","m8","Matrix3d","entries","tempMatrix","out","e0","e1","e2","e3","e4","e5","e6","e7","e8","x","y","sx","sy","angle","cos","sin","dst","transpose","other","UpdateType","CoreNode","stage","dimensions","txManager","shManager","shader","parent","pivotTranslateX","pivotTranslateY","mountTranslateX","mountTranslateY","delta","parentClippingRect","childUpdateType","mergeColorAlphaPremultiplied","gt","isRotated","clippingRect","intersectRect","z","zIndex","renderer","textureOptions","shaderProps","premultipliedColorTl","premultipliedColorTr","premultipliedColorBl","premultipliedColorBr","worldAlpha","newParent","oldParent","nextId","getNewId","MainOnlyNode","rendererMain","coreNode","payload","imageUrl","startLoop","runLoop","getTimeStamp","WebGlCoreShader","textures","gl","DefaultShaderBatched","samplers","textureUnits","idx","ShaderEffect","ref","uniformInfo","passParameters","declaredUniforms","uniforms","u","unif","uniType","uniformName","define","uni","_DynamicShader","effectContructors","effects","eff","effect","fxClass","uniInfo","fxProp","propInfo","effectNameCount","methods","declareUniforms","uFx","baseClass","nr","effectMethods","fx","fxProps","remap","m","cm","fxMethod","onShaderMask","onColorize","onEffectMask","r","reg","methodParameters","pm","sharedMethods","currentMask","drawEffects","currentClass","next","effectMethod","methodCollection","increment","DynamicShader","RoundedRectangle","propsA","propsB","IDENTITY_MATRIX_3x3","_SdfShader","resolvedProps","components","getNormalizedRgbaComponents","SdfShader","RadiusEffect","BorderEffect","rgba","LinearGradientEffect","colors","stops","calc","rgbas","acc","tmp","amount","GrayscaleEffect","BorderRightEffect","BorderTopEffect","BorderBottomEffect","BorderLeftEffect","GlitchEffect","FadeOutEffect","RadialGradientEffect","RadialProgressEffect","CoreShaderManager","DefaultShader","shType","shClass","effectType","effectClass","ShaderClass","cacheKey","AnimationManager$1","Texture","premultiplyAlpha","blob","size","pixelData8","CoreTextureManager","ImageTexture","ColorTexture","NoiseTexture","SubTexture","textureClass","TextureClass","descId","textureDescId","textureIdCache","textureRefCountMap","refCountObj","textureSource","TrFontManager","textRenderers","font","trId","tr","familyMapsByPriority","closeFaces","fontFamiles","fontFaces","fontFacesCopy","fontFace","trPropSetterDefaults","TextRenderer","propSetters","status","FLOATS_PER_GLYPH","getStartConditions","fontSize","offsetY","fontSizeRatio","sdfLineHeight","renderWindow","lineCache","textH","startLineIndex","startX","startY","PeekableIterator","iterator","indexBase","nextResult","getUnicodeCodepoints","text","codePoint","measureText","shaperProps","shaper","glyphs","glyph","layoutText","curLineIndex","textAlign","letterSpacing","vertexBuffer","contain","trFontFace","forceFullLayoutCalc","scrollable","vertexLineHeight","vertexW","vertexLSpacing","startingLineCacheEntry","startingCodepointIndex","startingMaxX","startingMaxY","maxX","maxY","curX","curY","bufferOffset","lastWord","glyphResult","curLineBufferStart","bufferLineInfos","truncateSeq","vertexTruncateHeight","truncateSeqVertexWidth","moreLines","nextLineWillFit","lineVertexW","xStartLastWordBoundary","charEndX","quadX","quadY","lineIsBelowWindowTop","lineIsAboveWindowBottom","atlasEntry","uvWidth","uvHeight","vertexTextW","line","lineWidth","xOffset","makeRenderWindow","scrollY","lineHeight","numExtraLines","visibleWindow","bufferMargin","x1","y1","isBoundPositive","tmpElementBounds","createBound","SdfTextRenderer","fontFamily","SdfTrFontFace","familyName","faceSet","debugData","msg","neededLength","elementBounds","intersectBound","visibleWindowHeight","maxLinesPerCanvasPage","out2","transform","alpha","debug","textW","distanceRange","bufferUploaded","webGlBuffers","stride","webGlBuffer","BufferCollection","buffer","renderOp","WebGlCoreRenderOp","mergeColorAlpha","ctxTexture","MAX_TEXTURE_DIMENSION","LightningTextTextureRenderer","ff","ffs","fontSetting","renderInfo","precision","paddingLeft","paddingRight","w","h","wordWrapWidth","cutSx","cutEx","cutSy","cutEy","textIndent","innerWidth","suffix","linesInfo","lines","usedLines","otherLines","al","maxLineWidth","lineWidths","baselineOffset","linesOverride","linePositionX","linePositionY","drawLines","hlHeight","offset","hlPaddingLeft","hlPaddingRight","getRgbaString","drawLine","prevShadowSettings","textSplit","word","suffixWidth","wordLen","wordWidth","cutoffIndex","truncWordWidth","indent","allLines","realNewlines","resultLines","spaceLeft","words","wordWidthWithSpace","space","char","resolvedGlobal","globalFontSet","getFontCssString","fontStyle","fontWeight","fontStretch","CanvasTextRenderer","WebTrFontFace","cssString","canvasPages","renderWindowScreenX1","renderWindowScreenY1","renderWindowScreenX2","renderWindowScreenY2","pageHeight","page1Block","page1LineStart","page0LineStart","page2LineStart","scrollYNearestPage","pageInfo","elementRect","pageSize","combinedAlpha","getNormalizedAlphaComponent","quadColor","bufferMemory","clearColor","rootId","AnimationManager","debugInfo","WebGlCoreRenderer","rootNode","animationManager","renderRequested","fpsUpdateInterval","trProps","textRendererOverride","rendererId","overrideFallback","possibleRenderer","resolvedTextRenderer","CoreTextNode","setWidth","setHeight","calcWidth","calcHeight","textRendererState","prevState","eventName","MainOnlyTextNode","classExtendsCoreExtension","Class","CoreExtension","loadCoreExtension","coreExtensionModule","module","__vitePreload","ExtensionClass","coreExtension","MainCoreDriver","rendererSettings","Stage","createShader","startLightningRenderer","Children","beforeNode","nodeIndexToRemove","config","log","args","isFunc","isString","isNumber","isInteger","keyExists","obj","getAnimatableValue","States","callback","initialState","__super","_key","stateIndexToRemove","calculateFlex","numChildren","isRow","dimension","crossDimension","marginOne","marginTwo","prop","crossProp","containerSize","containerCrossSize","gap","justify","align","itemSize","crossAlignChild","toPad","defaultAnimationSettings","convertEffectsToShader","styleEffects","borderAccessor","direction","LightningRendererNumberProps","LightningRendererNonAnimatingProps","ElementNode","radius","animationSettings","_node","loadedPayload","states","stylesToUndo","undoStyles","newStyles","styles","Text","_el$","_$createElement","_$spread","View","renderTopDown","render","forEach","Canvas","then","lng","onFirstRender","catch","console","_ref$","_$use","_$insert","createRenderer$1","createElement","createTextNode","isTextNode","replaceText","insertNode","removeNode","setProperty","getParentNode","getFirstChild","getNextSibling","insert","accessor","marker","initial","insertExpression","unwrapArray","multi","cleanChildren","array","normalizeIncomingArray","replacement","appendNodes","reconcileArrays","replaceNode","normalized","unwrap","parentNode","bLength","aEnd","bEnd","aStart","bStart","after","map","sequence","removed","inserted","el","isParent","newNode","oldNode","spreadExpression","prevProps","skipChildren","code","element","arg","createRenderer","universalLightning","anchor","solidRenderer","spread","setProp","use","hexColor","deg2rad","deg","$$EVENTS","delegateEvents","eventNames","document","eventHandler","handler","isServer","createBeforeLeave","listeners","subscribe","confirm","to","force","hasSchemeRegex","trimPathRegex","normalizePath","path","omitSlash","resolvePath","base","from","basePath","fromPath","invariant","message","joinPaths","extractSearchParams","params","createMatcher","partial","matchFilters","pattern","splat","segments","location","locSegments","lenDiff","match","matchFilter","segment","locSegment","matchSegment","remainder","filter","isEqual","scoreRoute","route","score","createMemoObject","expandOptionals","prefix","prefixes","expansion","MAX_REDIRECTS","RouterContextObj","RouteContextObj","useRouter","useRoute","useNavigate","useLocation","useParams","createRoutes","routeDef","component","metadata","isLeaf","shared","asArray","originalPath","createBranch","routes","createBranches","stack","branches","routeDefs","def","isEmptyArray","branch","getRouteMatches","createLocation","origin","path_","pathname","search","hash","intent","createRouterContext","integration","getBranches","setSource","utils","parsePath","renderPath","beforeLeave","isRouting","setIsRouting","reference","setReference","referrers","submissions","baseRoute","navigatorFactory","preloadRoute","navigateFromRoute","replace","scroll","nextState","resolvedTo","navigateEnd","first","preloadData","prevIntent","createRouteContext","router","outlet","createRouterComponent","routerState","create","_$createComponent","Provider","Routes","Object","assign","routeStates","nextMatches","prevMatches","equal","prevMatch","nextMatch","createOutlet","splice","when","Route","childRoutes","intercept","get","querySelector","selector","createRouter","wrap","signal","bindEvent","scrollToHash","fallbackTop","actions","setupNativeEvents","preload","explicitLinks","actionBase","preloadTimeout","isSvg","handleAnchor","evt","svg","href","rel","handleAnchorClick","handleAnchorPreload","handleAnchorIn","handleAnchorOut","handleFormSubmit","actionRef","hashParser","HashRouter","hashIndex","notify","isDev","tryOnCleanup","makeEventListener","createSingletonRoot","factory","disposeRoot","useKeyDownEvent","setEvent","keyMap","focusPath","setFocusPath","useFocusManager","userKeyMap","keypressEvent","keyMapEntries","currentFocusedElm","prevFocusedElm","prevFocusPath","fp","elm","foundKeyEntry","mappedKeyEvent","onKeyHandler","withPadding","padding","pad","top","left","right","bottom","firstChild","maxHeight","flattenStrings","series","flattenedSeries","delay","pause","speak","phrase","utterances","lang","synth","reject","utterance","speakSeries","remainingPhrases","nestedSeriesResults","active","retriesLeft","seriesResult","toSpeak","currentSeries","SpeechEngine$1","debounce","timeoutId","clear","resetFocusPathTimer","currentlySpeaking","voiceOutDisabled","fiveMinutes","debounceWithFlush","scopedValue","debounced","newValue","getElmName","onFocusChangeCore","Announcer","loaded","focusDiff","toAnnounceText","toAnnounce","textToSpeech","SpeechEngine","depth","append","notification","focusDebounce","focusChangeTimeout","useAnnouncer","handleNavigation","lastSelected","lastSelectedChild","Row","defaultStyle","display","justifyContent","_$setProp","_$mergeProps","selected","onFocus","skipFocus","setFocus","style","Column","up","down","flexDirection","globalBackground","setGlobalBackground","focusMenu","setFocusMenu","Background","bg1","bg2","bgStyles","img","startsWith","r$","animate","_ref$2","radialGradient","pivot","theme","menuIconStyle","styles$5","import","Menu","backdrop","navigate","add","onBlur","remove","MenuWrapper","mennuItems","menuItem","icon","forwardStates","onEnter","menuLineStyle","MenuText","styles$4","Button","TopBar","ButtonText","buttonStyles","MaterialButton","menuItems","App","announcer","enabled","navDrawer","lastFocused","localtionActive","setLocaltionActive","Escape","window","APP","onLast","history","back","onMenu","onLeft","has","onRight","plinko","pageWrapper","coreExtensionModuleUrl","HomePage","OverviewContainer","SublineContainer","Title","Overview","Subline","autofocus","keyBoards","keyboardContainerStyle","KeyboardMainStyle","KeyboardChooseStyle","KeyboardRowStyle","backdropKeyboardStyle","KeyboardItemStyle","KeyboardTextStyle","inputSearchStyle","resultSearchStyle","KeyboardItemSpecalStyle","KeyboardItemSpecalIconStyle","spaceSearchStyle","resultVideosStyle","resultVideoItemStyle","KeyboardItemNormalStyle","noDataStyle","styles$3","Thumbnail","focusRingRef","setTimeout","heroContent","scale","createAnimation","onRowFocus","FocusRing","TileRow","local","others","each","container","createInfiniteScroll","pages","setPages","page","setPage","setEnd","contents","content","VITE_API_KEY_V4","VITE_REQUEST_TOKEN","API_BASE","tmdbConfig","baseImageUrl","basePosterSize","defaultFetchParams","getImageUrl","posterSize","_get","loadConfig","api","truncateString","maxLength","chunkArray","convertItemsToTiles","cache","leftoverTiles","searchProvider","query","pageIndex","sizePage","trending","tiles","chunks","Search","backdropKeyboardRef","inputSearchRef","resultSearchRef","keyboardContainerRef","keyboardMainRef","resultVideosRef","keyboardChooseRef","resultVideosMainRef","KeyboardItemSpecalRef","searchValue","setSearchValue","columnY","setcolumnY","searchResultProvider","isFirst","selectKeySpace","selectKeyBackSpace","slice","selectKeyBoard","renderKeyboard","elementsPerDiv","divElements","push","numPages","_ref$3","_ref$4","marginLeft","_ref$5","onDown","_ref$6","_ref$7","_ref$8","focus","_ref$9","_ref$10","_$memo","TiviPage","_props","backdropAlpha","setBackdropAlpha","isPlayVideo","setIsPlayVideo","entity","videoRef","onEscape","demos","title","description","DemoTile","Container","borderRadius","setColor","rowX","setRowX","onSelectedChanged","row","videoLeft","videoRight","videoRUp","videoDown","colorTop","colorBottom","demo","onUp","NotFound","browseProvider","blockWidth","HeadlineStyles","typography","display2","Headline","DescriptionStyles","body1","BadgeStyle","Description","getReviews","reviews","rtCrit","marginRight","MetaTextStyle","rtFan","Badge","border","body2","Metadata","flexRow","metaText","badges","ContentBlock","flexColumn","minutesToHMM","remainingMinutes","justYear","dateString","getInfo","rt","styles$2","ListColumn","clipping","itemsContainer","announce","styles$1","Notification","isOpen","NotifiWrapper","NotifiText","Browse","entityInfo","setEntityInfo","entityProvider","setHeroContent","isOpenNotification","setNotification","buttonNoti","provider","showNotification","StageUtils","v1","v2","g","argb","c1","c2","r1","g1","b1","a1","r2","g2","b2","a2","xc","xb","xa","yc","yb","ya","cbx","cbxd","dx","it","minT","maxT","parts","Utils$1","Utils","clone","obj1","obj2","arr","keys1","keys2","k1","k2","iteratorResult","charcode","Base","names","func","SpacingCalculator","mode","numberOfItems","remainingSpace","itemGaps","spacePerGap","spacingBefore","spacingBetween","ContentAligner","layout","growSize","currentPos","crossAxisLayoutOffset","aligner","finalCrossAxisLayoutSize","total","FlexUtils","horizontal","flexParent","minSize","flexItemMinSize","flex","flexItem","SizeShrinker","totalShrinkAmount","amountPerShrink","shrinkAmount","shrink","maxShrink","finalSize","SizeGrower","totalGrowAmount","amountPerGrow","growAmount","grow","maxSize","maxGrow","ItemPositioner","lineLayout","ItemAligner","itemCrossAxisSize","center","mainAxisLayoutSizeBeforeResize","crossAxisMinSizeSetting","crossAxisMaxSizeSetting","hasFixedCrossAxisSize","forceStretch","LineLayout","startIndex","endIndex","availableSpace","grower","shrinker","mainAxisMinSize","noSpecifiedCrossAxisSize","crossAxisMaxSize","LineLayouter","itemMainAxisSize","crossAxisMinSize","itemCrossAxisMinSize","ItemCoordinatesUpdater","parentFlex","validCache","crossAxisSize","endPos","reversedPos","FlexLayout","flexContainer","isShrinking","FlexContainer","Layout","f","FlexItem","FlexTarget","originalX","originalY","changeWidth","changeHeight","changeExternalWidth","changeExternalHeight","recalc","newRecalcFlags","flags","childRecalc","newRecalc","mainAxisRecalcFlag","crossAxisRecalcFlag","isWidthDynamic","isHeightDynamic","localRecalc","TextureSource","loader","cb","forceSync","textureThrottler","newNativeTexture","prevNativeTexture","ElementTexturizer","elementCore","resultTexture","nativeTexture","ElementCore","ElementCoreContext","_sr","_cr","pivotXMul","pivotYMul","px","py","dy","prevIsZContext","prevParent","newShaderOwner","added","order","fromIndex","toIndex","isEstimate","ulx","uly","brx","bry","newZParent","hadZContextUsage","prevZContext","prevShader","pw","visible","useRenderToTexture","bboxW","bboxH","ex","ey","rComplex","nx","ny","area","lx","ly","withinMargin","changedDims","renderState","hasRenderUpdates","mustRenderChildren","renderTextureInfo","prevRenderTextureInfo","updateResultTexture","ptr","mergeResult","relX","relY","tx","ty","sc","wrapper","arg1","arg2","arg3","object","cls","Shader","coreContext","reusable","lookupId","newSource","oldSource","loadError","clipX","clipY","scaleX","scaleY","desiredSize","choppedOffPixels","self","nonDefaults","hasAlpha","fc","getFontSetting","defaultFontFace","curFf","isZeroWidthSpace","isSpace","tokenizeString","tokenRegex","delimeters","final","wrapText","spaceRegex","spaces","TextTextureRenderer","loadPromise","TextTextureRendererAdvanced","wrapWidth","lineNo","baselineOffsetInPx","vaOffset","firstWord","lastLineText","spl","canvasWidth","canvasHeight","hlColor","hlOffset","lineNum","defaultColor","currentColor","tokens","italic","bold","colorStack","colorRegexp","matched","baseFont","parsed","breakIndex","totalWidth","letters","initialX","prevWidth","prevX","TextTexture","texParams","sharpCfg","sharpen","proto","SourceTexture","targetValue","ObjectList","currentIndex","existingItem","prevItem","refs","crefs","cref","same","prevItems","ElementChildList","prevChildList","gc","Element","levels","o1","o2","l1","l2","newAttached","newEnabled","prevTexture","prevSource","sourceChanged","unknownSize","displayedTexture","displayedTextureSource","tx1","ty1","tx2","ty2","iw","ih","rw","rh","tempty","tag","tags","tagSet","parentTreeTags","comp","removes","adds","currentTags","level","resn","selectors","pointIdx","arrowIdx","isRef","subPath","localTags","colorKeys","childStr","isEmpty","childArray","missing","tnd","propertyPath","getter","paths","firstCharCode","tree","childList","properties","getBoolean","isFunction","StateMachine","targetConstructor","stateMachineType","StateMachineType","statePath","currentStatePath","currentState","member","setStateId","newState","hasDifferentEnterMethod","hasDifferentExitMethod","sharedState","sharedLevel","exitStates","enterStates","hasParent","memberNames","cur","memberName","alias","state1","state2","state1Array","state2Array","descriptor","statePaths","descriptors","aliases","descType","isValid","curState","supportsSpread","functionBody","stateMap","members","isRoot","parentState","parentPath","subState","stateName","Component","propObj","targetObj","targetProp","propDependencies","__obj","__prop","__func","ctx","hasName","cursor","store","loc","childCursor","propKey","shaderCursor","newTarget","prevTarget","ancestor","signalParent","fireEvent","passSignal","CoreQuadList","WebGLCoreQuadList","byteSize","floats","uints","CoreQuadOperation","shaderOwner","scissor","WebGLCoreQuadOperation","coords","CoreRenderExecutor","qops","quadOperation","op","renderTexture","WebGLCoreRenderExecutor","maxQuads","allIndices","operation","glClearColor","CoreRenderState","texturizer","WebGLShaderProgram","vertexShaderSource","fragmentShaderSource","glVertShader","glFragShader","glFunction","clonedValue","WebGLShader","glTexture","Renderer","aggressive","convertedShaderType","WebGLRenderer","shaderProgram","ph","fmt","compressed","format","texOptions","quads","mca","cx","cy","extra","C2dCoreQuadList","C2dCoreQuadOperation","C2dCoreRenderExecutor","C2dShader","vc","rc","white","stc","rect","info","sourceX","sourceY","sourceW","sourceH","rgb","tintTexture","transparency","gradient","C2dTextureTintManager","prevMemUsage","frame","before","col","C2dTintCache","C2dRenderer","TextureTintManager","imageData","SparkShader","elementPostion","SparkRenderer","ret","ImageWorker","createWorker","blobURL","ImageWorkerImage","image","ImageWorkerServer","hasHashPath","ImageWorkerServerItem","imageBitmap","hasAlphaChannel","oEvent","WebPlatform","lp","view","arraybuffer","targetIdentifier","littleEndian","imageSize","arrayBuffer","header","dataOffset","pvrtcData","cancelCb","isPng","isKtx","isPvr","request","opts","c2d","changes","keyhandler","clickHandler","hoverHandler","registerScrollWheelHandler","PlatformLoader","WebGLState","cap","change","program","va","changed","activeIndex","targetIndex","pname","param","buffersChanged","max","activeTexture","sTargets","tTargets","textureNumb","targetMax","framebuffer","renderbuffer","attrib","defaults","tValue","setting","WebGLStateManager","fb","face","mask","fail","zfail","zpass","red","green","blue","modeRGB","modeAlpha","sfactor","dfactor","srcRGB","dstRGB","srcAlpha","dstAlpha","flag","zNear","zFar","factor","units","invert","indx","values","method","WebGLStateManager$1","TextureManager","sign","usage","remainingTextureSources","ts","managed","TextureThrottler","CoreContext","debugFrame","pixels","prec","maxAge","limit","TransitionSettings","TransitionManager","transitionSettings","transition","MultiSpline","defaultSmoothness","last","pi","ni","nc","pc","p1","p2","i2","s1","s2","dp","helpers","cv1","cv2","csx","csy","cex","cey","yd","AnimationActionSettings","elements","sv","AnimationSettings","aas","action","Animation","RectangleTexture","whitePixel","platformType","ratio","opt","memoryUsageBefore","serviceprovider","Application","notOverridden","updateFocusId","newFocusPath","newFocusedComponent","prevFocusedComponent","focusedComponent","focusSettings","defaultSetFocusSettings","defaultHandleFocusSettings","prevSettings","focused","prevFocused","nextFocus","newParts","events","hasTimer","consumer","timeout","clientX","clientY","affected","localCoords","hoveredBranch","newHoveredBranch","elem","diffBranch","lastElement","hoverableChildren","bucket","affectedChildren","cursorX","cursorY","candidates","cw","ch","timer","StaticCanvasTexture","Tools","canvasFactory","strokeWidth","strokeColor","fill","fillColor","blur","margin","ObjMerger","aks","bks","ai","bi","aksl","aIndex","curIndex","akey","bv","av","ObjectListProxy","ObjectListWrapper","noise","HtmlTexture","htmlElement","StaticTexture","ListComponent","ListItems","immediate","closest","nElements","diff","min","scrollDelta","viewportSize","ps","pe","realIndex","wasVisible","invisibleItem","ri","LinearBlurShader","BoxBlurShader","BlurShader","FastBlurComponent","WebGLFastBlurComponent","C2dFastBlurComponent","C2dBlurShader","paddingX","paddingY","onUpdate","FastBlurOutputShader","filterShaders","steps","step","fw","fh","BloomComponent","BloomBaseShader","SmoothScaleComponent","its","scalers","useScalers","contentWrap","BorderComponent","WebGLGrayscaleShader","WebGLDefaultShader","C2dGrayscaleShader","C2dDefaultShader","DitheringShader","CircularPushShader","full","InversionShader","OutlineShader","ddw","dw","ddh","dh","PixelateShader","RadialFilterShader","RoundedRectangleShader","renderPrecision","_radius","FadeOutShader","fade","VignetteShader","SpinnerShader","HoleShader","RadialGradientShader","Light3dShader","vr","pivotX","pivotY","rz","PerspectiveShader","MagnifierShader","SpinnerShader2","bool","lightning","subscribers","publish","subscriber","dotGrab","Settings$1","hasRegex","isWildcard","hasLookupId","isNamedGroup","stripRegex","createRegister","prepLog","Log$1","Settings","Request","navArgs","storeCaller","isObject","isBoolean","symbols","Log","getFloor","getRoutesByFloor","floor","getRouteByHash","getUrlParts","hashParts","regexStore","isMatching","regMatches","fullRoute","regex","routeParts","routePart","hashPart","storeId","routeRegex","expression","modifiers","routeExists","getValuesFromHash","getNamedGroup","storage","getOption","createRoute","bootRequest","createRequest","getHashByName","getRouteByName","hasDynamicGroup","objectToQueryString","keepActivePageAlive","getRoutes","register","routeOptions","emit","ucfirst","activeWidget","getReferences","widgetsHost","widget","updateWidgets","widgets","configured","getWidgetByName","focusWidget","setActiveWidget","restoreFocus","getActiveWidget","instance","updateHistory","getActiveHash","forceNavigateStore","activeRoute","preventStorage","toStore","locationInHistory","stateObject","getStateObject","getActivePage","routerConfig","getRouterConfig","getHistoryState","replaceHistoryState","getHistory","setHistory","ColorShift","Lightning","ProtanopiaShader","DeuteranopiaShader","TritanopiaShader","NeutralShader","MonochromacyShader","timestamp","later","callNow","ApplicationInstance","Ads","sendMetric","metrics","errorMetric","Metric","Metrics","types","Metrics$1","executeAsPromise","autoSetupMixin","sourceObject","setup","ready","doSetup","easeExecution","VideoTexture","getVideoPlaybackQuality","frameCount","expectedAspectRatio","realAspectRatio","mediaUrl","videoEl","videoTexture","textureMode","eventHandlers","fireOnConsumer","hooks","videoPlayerPlugin","deregisterEventListeners","withPrecision","fireHook","customLoader","customUnloader","unloader","setupVideoTag","videoEls","platformSettingsWidth","platformSettingsHeight","setUpVideoTexture","registerEventListeners","loaderFn","unloaderFn","adConfig","ads","muted","looped","VersionLabel","FpsIndicator","fpsCalculator","bgColor","registry","Registry","interval","intervalId","_event","AppInstance","application","pagesHost","rootHash","updateHash","beforeEachRoute","afterEachRoute","initialised","activePage","activeHash","lastAcceptedHash","previousState","mixin","bootRouter","appInstance","isPage","getConfigMap","cleanHash","isComponentConstructor","strippedPath","optionalPath","optionalItem","storeComponent","getComponent","deleteCurrentInstance","mustUpdateLocationHash","updateConfig","onRequestResolved","cleanUp","setActivePage","navigateQueue","lazyDestroy","destroyOnBack","keepAlive","isFromHistory","doCleanup","getActiveRoute","getLastHash","setLastHash","setPreviousState","getPreviousState","getRootHash","getBootRequest","routerSettings","isObj","getQueryStringParams","resumeHash","getResumeHash","parse","hashParams","urlParams","dataHooks","execProvider","emitProvided","expires","addPersistData","urlValues","queryParams","pageData","isPageExpired","hasProvider","getProvider","crossFade","moveOnAxes","axis","bounds","Transitions","executeTransition","pageIn","pageOut","hasCustomTransitions","transitionsDisabled","smooth","expired","isConstruct","provide","mustReuse","currentRoute","loadType","RoutedApp","Router","forcedHash","startRouter","registerListener","getHash","bootKey","isDirectLoad","handleHashChange","handleBootError","setHash","override","queueId","resolveHashChange","hashLastPart","resume","reload","isNavigating","isProcessing","deletePage","ListSlider","moveRow","_width","Config","fontSettings","threadXCoreWorkerUrl","undefined","SearchPage","Videos","EXListSlider"],"sources":["../../main-video.js","../../node_modules/.pnpm/solid-js@1.8.7/node_modules/solid-js/dist/solid.js","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/activeElement.ts","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/main-api/texture-usage-trackers/TextureUsageTracker.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/main-api/texture-usage-trackers/ManualCountTextureUsageTracker.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/main-api/texture-usage-trackers/FinalizationRegistryTextureUsageTracker.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/main-api/RendererMain.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/animations/CoreAnimation.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/animations/CoreAnimationController.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/lib/Matrix3d.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/CoreNode.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/render-drivers/main/MainOnlyNode.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/platform.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/DefaultShader.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/DefaultShaderBatched.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/ShaderEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/DynamicShader.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/RoundedRectangle.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/SdfShader.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/RadiusEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/LinearGradientEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/GrayscaleEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderRightEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderTopEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderBottomEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderLeftEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/GlitchEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/FadeOutEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/RadialGradientEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/RadialProgressEffect.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/CoreShaderManager.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/animations/AnimationManager.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/textures/ImageTexture.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/textures/NoiseTexture.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/CoreTextureManager.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/TrFontManager.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/TextRenderer.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/constants.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/getStartConditions.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/PeekableGenerator.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/getUnicodeCodepoints.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/measureText.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/layoutText.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/makeRenderWindow.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/SdfTextRenderer.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/LightningTextTextureRenderer.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/CanvasTextRenderer.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/Stage.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/core/CoreTextNode.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/render-drivers/main/MainOnlyTextNode.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/render-drivers/utils.js","../../node_modules/.pnpm/@lightningjs+renderer@0.6.1/node_modules/@lightningjs/renderer/dist/src/render-drivers/main/MainCoreDriver.js","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/renderer/index.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/node/children.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/config.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/utils.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/node/states.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/flex.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/node/index.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/components/Text.tsx","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/components/View.tsx","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/components/Canvas.tsx","../../node_modules/.pnpm/solid-js@1.8.7/node_modules/solid-js/universal/dist/universal.js","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/universal/lightning.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/core/render.ts","../../node_modules/.pnpm/@lightningjs+solid@0.10.3_@babel+core@7.23.2_solid-js@1.8.7_vite@4.5.0/node_modules/@lightningjs/solid/src/utils.ts","../../node_modules/.pnpm/solid-js@1.8.7/node_modules/solid-js/web/dist/web.js","../../node_modules/.pnpm/@solidjs+router@0.10.5_solid-js@1.8.7/node_modules/@solidjs/router/dist/lifecycle.js","../../node_modules/.pnpm/@solidjs+router@0.10.5_solid-js@1.8.7/node_modules/@solidjs/router/dist/utils.js","../../node_modules/.pnpm/@solidjs+router@0.10.5_solid-js@1.8.7/node_modules/@solidjs/router/dist/routing.js","../../node_modules/.pnpm/@solidjs+router@0.10.5_solid-js@1.8.7/node_modules/@solidjs/router/dist/routers/components.jsx","../../node_modules/.pnpm/@solidjs+router@0.10.5_solid-js@1.8.7/node_modules/@solidjs/router/dist/routers/createRouter.js","../../node_modules/.pnpm/@solidjs+router@0.10.5_solid-js@1.8.7/node_modules/@solidjs/router/dist/data/action.js","../../node_modules/.pnpm/@solidjs+router@0.10.5_solid-js@1.8.7/node_modules/@solidjs/router/dist/data/events.js","../../node_modules/.pnpm/@solidjs+router@0.10.5_solid-js@1.8.7/node_modules/@solidjs/router/dist/routers/HashRouter.js","../../node_modules/.pnpm/@solid-primitives+utils@6.2.1_solid-js@1.8.7/node_modules/@solid-primitives/utils/dist/chunk/R5675YMU.js","../../node_modules/.pnpm/@solid-primitives+event-listener@2.3.0_solid-js@1.8.7/node_modules/@solid-primitives/event-listener/dist/index.js","../../node_modules/.pnpm/@solid-primitives+rootless@1.4.2_solid-js@1.8.7/node_modules/@solid-primitives/rootless/dist/index.js","../../node_modules/.pnpm/@solid-primitives+keyboard@1.2.5_solid-js@1.8.7/node_modules/@solid-primitives/keyboard/dist/index.js","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/utils.js","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/useFocusManager.js","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/withPadding.js","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/announcer/speech.js","../../node_modules/.pnpm/@solid-primitives+scheduled@1.4.1_solid-js@1.8.7/node_modules/@solid-primitives/scheduled/dist/index.js","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/announcer/announcer.js","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/announcer/index.js","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/navigation.js","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/Row.jsx","../../node_modules/.pnpm/@lightningjs+solid-primitives@0.4.7_@lightningjs+renderer@0.6.1_@lightningjs+solid@0.10.3_solid-js@1.8.7/node_modules/@lightningjs/solid-primitives/dist/packages/Column.jsx","../../src/state.ts","../../src/components/Background.tsx","../../assets/styles/menuStyle.ts","../../src/components/Menu/Menu.styles.ts","../../src/components/Menu/Menu.tsx","../../src/styles.ts","../../src/components/Menu/constant.ts","../../src/pages/App.tsx","../../AppCoreExtensions.js?importChunkUrl","../../src/pages/Home.tsx","../../keyBoards.ts","../../assets/styles/keyboardStyle.ts","../../src/components/Thumnail/Thumnail.styles.ts","../../src/components/Thumnail/index.tsx","../../src/components/index.tsx","../../src/components/pagination.ts","../../src/api/index.ts","../../src/api/formatters/ItemFormatter.ts","../../src/api/providers/search.ts","../../src/pages/Search.tsx","../../src/pages/Tivi.tsx","../../src/pages/NotFound.tsx","../../src/api/providers/browse.ts","../../src/components/ContentBlock.tsx","../../src/api/providers/entity.js","../../src/components/ListColumn/ListColumn.style.ts","../../src/components/ListColumn/index.tsx","../../src/components/Notification/Thumnail.styles.ts","../../src/components/Notification/index.tsx","../../src/pages/Videos.tsx","../../src/components/ListSlider/ListSlider.style.ts","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/StageUtils.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/Utils.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/Base.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/SpacingCalculator.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/ContentAligner.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/FlexUtils.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/line/SizeShrinker.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/line/SizeGrower.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/line/ItemPositioner.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/line/ItemAligner.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/line/LineLayout.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/LineLayouter.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/ItemCoordinatesUpdater.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/layout/FlexLayout.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/FlexContainer.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/FlexItem.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/flex/FlexTarget.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/TextureSource.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/core/ElementTexturizer.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/core/ElementCore.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/EventEmitter.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/Shader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/Texture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/ImageTexture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/TextTextureRendererUtils.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/TextTextureRenderer.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/TextTextureRendererAdvanced.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/TextTexture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/SourceTexture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/animation/Transition.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/ObjectList.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/ElementChildList.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/Element.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/application/StateMachine.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/application/Component.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/core/CoreQuadList.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/WebGLCoreQuadList.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/core/CoreQuadOperation.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/WebGLCoreQuadOperation.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/core/CoreRenderExecutor.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/WebGLCoreRenderExecutor.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/core/CoreRenderState.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/WebGLShaderProgram.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/WebGLShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/DefaultShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/Renderer.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/WebGLRenderer.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/c2d/C2dCoreQuadList.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/c2d/C2dCoreQuadOperation.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/c2d/C2dCoreRenderExecutor.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/c2d/C2dShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/c2d/shaders/DefaultShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/c2d/C2dTextureTintManager.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/c2d/C2dRenderer.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/spark/shaders/SparkShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/spark/SparkRenderer.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/platforms/browser/ImageWorker.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/platforms/browser/WebPlatform.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/platforms/PlatformLoader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tools/WebGLStateManager.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/TextureManager.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/TextureThrottler.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/core/CoreContext.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/animation/TransitionSettings.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/animation/TransitionManager.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tools/MultiSpline.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/animation/AnimationActionSettings.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/animation/AnimationSettings.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/animation/Animation.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/animation/AnimationManager.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/RectangleTexture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tree/Stage.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/application/Application.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/StaticCanvasTexture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tools/Tools.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tools/ObjMerger.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tools/ObjectListProxy.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/tools/ObjectListWrapper.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/NoiseTexture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/HtmlTexture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/textures/StaticTexture.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/components/ListComponent.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/LinearBlurShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/BoxBlurShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/c2d/shaders/BlurShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/components/FastBlurComponent.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/components/BloomComponent.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/components/SmoothScaleComponent.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/components/BorderComponent.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/common/shaders/GrayscaleShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/DitheringShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/CircularPushShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/InversionShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/OutlineShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/PixelateShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/RadialFilterShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/RoundedRectangleShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/FadeOutShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/VignetteShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/SpinnerShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/HoleShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/RadialGradientShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/Light3dShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/PerspectiveShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/MagnifierShader.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/renderer/webgl/shaders/SpinnerShader2.mjs","../../node_modules/.pnpm/@lightningjs+core@2.12.0/node_modules/@lightningjs/core/dist/src/lightning.mjs","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Settings/index.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/regex.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/register.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Log/index.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/model/Request.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/model/Route.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/route.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/emit.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/widgets.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/components.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/history.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/shaders/ColorShift.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/shaders/ProtanopiaShader.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/shaders/DeuteranopiaShader.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/shaders/TritanopiaShader.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/shaders/NormalShader.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/shaders/MonochromacyShader.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/Announcer/Speech.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/Announcer/utils.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Accessibility/Announcer/index.js","../../node_modules/.pnpm/@metrological+sdk@1.0.2/node_modules/@metrological/sdk/src/LightningSdkPlugins/index.js","../../node_modules/.pnpm/@metrological+sdk@1.0.2/node_modules/@metrological/sdk/src/Metrics/index.js","../../node_modules/.pnpm/@metrological+sdk@1.0.2/node_modules/@metrological/sdk/src/TV/defaults.js","../../node_modules/.pnpm/@michieljs+execute-as-promise@1.0.0/node_modules/@michieljs/execute-as-promise/src/execute-as-promise.js","../../node_modules/.pnpm/@metrological+sdk@1.0.2/node_modules/@metrological/sdk/src/VideoPlayer/events.js","../../node_modules/.pnpm/@metrological+sdk@1.0.2/node_modules/@metrological/sdk/src/helpers/autoSetupMixin.js","../../node_modules/.pnpm/@metrological+sdk@1.0.2/node_modules/@metrological/sdk/src/helpers/easeExecution.js","../../node_modules/.pnpm/@metrological+sdk@1.0.2/node_modules/@metrological/sdk/src/VideoPlayer/VideoTexture.js","../../node_modules/.pnpm/@metrological+sdk@1.0.2/node_modules/@metrological/sdk/src/VideoPlayer/index.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/VersionLabel/index.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/FpsCounter/index.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Registry/index.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Application/index.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/router.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/helpers.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/provider.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/transitions.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/transition.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/utils/loader.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/base.js","../../node_modules/.pnpm/@lightningjs+sdk@5.5.0/node_modules/@lightningjs/sdk/src/Router/index.js","../../src/components/ListSlider/index.tsx","../../src/pages/EXListSlider.tsx","../../src/index.tsx"],"sourcesContent":["function Logic1 () {\r\n\t'use strict';\r\n\r\n\t// Hide controls in case of no mouse or touch activity for 10 seconds\r\n\tvar videoControls = document.getElementById('video-controls'),\r\n\t\tvideo = document.getElementById('video'),\r\n\t\tplayer = document.getElementById('player');\r\n\r\n\t// Make mouse out function for nested children\r\n\tfunction makeMouseOutFn(elem) {\r\n\t\tvar list = traverseChildren(elem);\r\n\t\treturn function onMouseOut(event) {\r\n\t\t\tvar e = event.toElement || event.relatedTarget;\r\n\t\t\tif (!!~list.indexOf(e)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tisOnPlayer = false;\r\n\t\t\thideControls();\r\n\t\t};\r\n\t}\r\n\r\n\tfunction hideControls() {\r\n\t\tif (!video.paused) {\r\n\t\t\t// videoControls.classList.remove('display-control');\r\n\t\t}\r\n\t};\r\n\r\n\t// Utility function for traverse children nodes\r\n\tfunction traverseChildren(elem) {\r\n\t\tvar children = [];\r\n\t\tvar q = [];\r\n\t\tq.push(elem);\r\n\t\twhile (q.length > 0) {\r\n\t\t\tvar elem = q.pop();\r\n\t\t\tchildren.push(elem);\r\n\t\t\tpushAll(elem.children);\r\n\t\t}\r\n\t\tfunction pushAll(elemArray) {\r\n\t\t\tfor (var i = 0; i < elemArray.length; i++) {\r\n\t\t\t\tq.push(elemArray[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn children;\r\n\t};\r\n\r\n};\r\n\r\nfunction Logic2 () {\r\n\t'use strict';\r\n\r\n\tvar player = document.getElementById('player'),\r\n\t\tvideo = document.getElementById('video'),\r\n\t\tvideoControls = document.getElementById('video-controls'),\r\n\t\tplaypause = document.getElementById('playpause'),\r\n\t\tmute = document.getElementById('mute'),\r\n\t\tfullScreen = document.getElementById('max'),\r\n\t\tbackward = document.getElementById('back'),\r\n\t\tforward = document.getElementById('next'),\r\n\t\tcurrentTime = document.getElementById('current-time'),\r\n\t\tremainTime = document.getElementById('end-time'),\r\n\t\tprogress = document.getElementById('progress'),\r\n\t\tprogressBar = document.getElementById('progress-bar');\r\n\t\r\n\tvar\tvideoSource = video.getAttribute('data-src');\r\n\tvar numType = 0;\r\n\tvideo.controls = false;\r\n\r\n\t// HLS video init\r\n\tif (Hls.isSupported()) {\r\n\t\tvar hls = new Hls();\r\n\t\thls.loadSource(videoSource);\r\n\t\thls.attachMedia(video);\r\n\t\thls.on(Hls.Events.MANIFEST_PARSED, function () {\r\n\t\t\t// NOTICE: 1\r\n\t\t\tvideo.hidden = false;\r\n\t\t\tvideo.play();\r\n\t\t\tinitVideoQualityOptions(hls);\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tplaypause.focus()\r\n\t\t\t}, 500);\r\n\t\t});\r\n\t\thls.on(Hls.Events.LEVEL_LOADED, function (event, data) {\r\n\t\t\tif (numType === 0) {\r\n\t\t\t\t(data.details || {}).live ? numType = 1 : numType = 2;\r\n\t\t\t\tif (numType === 1) {\r\n\t\t\t\t\tchangeControlsToLive();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Add events for buttons\r\n\tplaypause.addEventListener('click', function (e) {\r\n\t\tif (video.paused || video.ended) video.play();\r\n\t\telse video.pause();\r\n\t});\r\n\r\n\tmute.addEventListener('click', function (e) {\r\n\t\tvideo.muted = !video.muted;\r\n\t\tchangeButtonState('mute');\r\n\t});\r\n\r\n\t// React to the user clicking within the progress bar\r\n\tprogress.addEventListener('click', function (e) {\r\n\t\tvar pos = (e.pageX - (this.offsetLeft + this.offsetParent.offsetLeft + player.offsetLeft)) / this.offsetWidth;\r\n\t\tvideo.currentTime = pos * video.duration;\r\n\t\tcurrentTime.innerHTML = secondsToTime(video.currentTime)\r\n\t});\r\n\r\n\t// handle full screen function \r\n\tfunction toggleFullScreen() {\r\n\t\tvar currPlayer = document.getElementById('player');\r\n\t\t// offsetWidth offsetHeight\r\n\t\tvar width = window.innerWidth\r\n\t\t\t|| document.documentElement.clientWidth\r\n\t\t\t|| document.body.clientWidth;\r\n\r\n\t\tvar height = window.innerHeight\r\n\t\t\t|| document.documentElement.clientHeight\r\n\t\t\t|| document.body.clientHeight;\r\n\t\tif (width - currPlayer.offsetWidth > 40 ||  height - currPlayer.offsetHeight > 40) {\r\n\t\t\tcurrPlayer.style.width = '100%';\r\n\t\t\tcurrPlayer.style.top = '0';\r\n\t\t} else {\r\n\t\t\tcurrPlayer.style.width = '80%';\r\n\t\t\tcurrPlayer.style.top = '20px';\r\n\t\t}\r\n\t}\r\n\r\n\tfullScreen.addEventListener('click', function (event) {\r\n\t\ttoggleFullScreen();\r\n\t});\r\n\r\n\tbackward.addEventListener('click', function (event) {\r\n\t\tvideo.currentTime = Math.max(video.currentTime - 10, 0);\r\n\t\tcurrentTime.innerHTML = secondsToTime(video.currentTime);\r\n\t});\r\n\r\n\tforward.addEventListener('click', function (event) {\r\n\t\tvideo.currentTime = Math.min(video.currentTime + 10, video.duration);\r\n\t\tcurrentTime.innerHTML = secondsToTime(video.currentTime);\r\n\t});\r\n\r\n\t// Wait for the video's meta data to be loaded, then set the progress bar's max value to the duration of the video\r\n\tvideo.addEventListener('loadedmetadata', function () {\r\n        // Calculate new time, but don't exceed video duration\r\n        var newTime = Math.min(video.currentTime, video.duration);\r\n        video.currentTime = newTime;\r\n\t\tcurrentTime.innerHTML = secondsToTime(video.currentTime);\r\n\t\tremainTime.innerHTML = secondsToTime(video.duration);\r\n\t});\r\n\r\n\t// Add event listeners for video specific events\r\n\tvideo.addEventListener('play', function () {\r\n\t\tchangeButtonState('playpause');\r\n\t}, false);\r\n\tvideo.addEventListener('pause', function () {\r\n\t\tchangeButtonState('playpause');\r\n\t}, false);\r\n\r\n\t// As the video is playing, update the progress bar\r\n\tvideo.addEventListener('timeupdate', function () {\r\n\t\tif (!progress.getAttribute('max')) progress.setAttribute('max', video.duration);\r\n\t\tprogress.value = video.currentTime;\r\n\t\tcurrentTime.innerHTML = secondsToTime(video.currentTime);\r\n\t\tprogressBar.style.width = Math.floor((video.currentTime / video.duration) * 100) + '%';\r\n\t});\r\n\r\n\t// Changes the button state of certain button's so the correct visuals can be displayed with CSS\r\n\tfunction changeButtonState(type) {\r\n\t\t// Play/Pause button\r\n\t\tif (type == 'playpause') {\r\n\t\t\tif (video.paused || video.ended) {\r\n\t\t\t\tplaypause.setAttribute('data-state', 'play');\r\n\t\t\t\tvideoControls.classList.add('display-control');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tplaypause.setAttribute('data-state', 'pause');\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Mute button\r\n\t\telse if (type == 'mute') {\r\n\t\t\tmute.setAttribute('data-state', video.muted ? 'unmute' : 'mute');\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\nfunction initVideoQualityOptions(hls) {\r\n\r\n\tvar qualityBtn = document.getElementById('quality-btn');\r\n\tvar quality = document.getElementById('quality');\r\n\tqualityBtn.addEventListener('click', function namedListener (event) {\r\n\t\tmakeActive();\r\n\t\tquality.classList.toggle(\"show\");\r\n\t});\r\n\r\n\t//Create and append the options\r\n\tvar qualities = hls.levels;\r\n\tconsole.log(qualities);\r\n\twhile (quality.firstChild) {\r\n\t\tquality.removeChild(quality.firstChild);\r\n\t}\r\n\tvar qAuto = document.createElement(\"a\");\r\n\tqAuto.setAttribute(\"data-value\", -1);\r\n\tqAuto.setAttribute(\"class\", \"quality\");\r\n\tqAuto.setAttribute(\"tabindex\", \"0\");\r\n\tqAuto.setAttribute(\"id\", \"quality-0\");\r\n\r\n\tqAuto.text = 'Auto';\r\n\tquality.appendChild(qAuto);\r\n\tfor (var i = 0; i < qualities.length; i++) {\r\n\t\tvar q = document.createElement(\"a\");\r\n\t\tq.setAttribute(\"data-value\", i);\r\n\t\tq.setAttribute(\"class\", \"quality\");\r\n\t\tq.setAttribute(\"tabindex\", \"0\");\r\n\t\tq.setAttribute(\"id\", \"quality-\" + (i + 1));\r\n\t\tq.text = (qualities[i].name || qualities[i].height) + 'p';\r\n\t\tquality.appendChild(q);\r\n\t}\r\n\r\n\t// update dropdown selection\r\n\tvar elems = document.querySelectorAll('#quality a');\r\n\r\n\tfunction makeActive(UserSelectionEvent) {\r\n\t\tfor (var i = 0; i < elems.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(!UserSelectionEvent && i == hls.currentLevel + 1) {\r\n\t\t\t\t\tif (hls.autoLevelEnabled) {\r\n\t\t\t\t\t\telems[0].classList.add('active');\r\n\t\t\t\t\t\telems[i].classList.remove('active');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\telems[i].classList.add('active');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else{\r\n\t\t\t\t\telems[i].classList.remove('active');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(UserSelectionEvent){\r\n\t\t\t\tvar q_level = parseInt(this.getAttribute('data-value'));\r\n\t\t\t\thls.currentLevel = q_level;\r\n\t\t\t\tthis.classList.add('active');\r\n\t\t\t}\r\n\t};\r\n\r\n\tfor (var i = 0; i < elems.length; i++)\r\n\t\telems[i].addEventListener('mousedown', makeActive);\r\n};\r\n\r\nfunction secondsToTime(seconds) {\r\n\tvar hours = Math.floor(seconds / 3600);\r\n\tvar minutes = Math.floor((seconds % 3600) / 60);\r\n\tvar remainingSeconds = Math.floor(seconds % 60);\r\n\r\n\tvar timeString = \"\";\r\n\r\n\tif (hours > 0) {\r\n\t\ttimeString += `${hours.toString().padStart(2, '0')}:`;\r\n\t}\r\n\r\n\ttimeString += `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;\r\n\r\n\treturn timeString;\r\n}\r\n\r\nexport function playVideo(url) {\r\n\tvar src = url || \"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8\";\r\n\tvar video = document.getElementById('video');\r\n\tvideo.setAttribute('data-src', src);\r\n\tinitApp();\r\n}\r\n\r\nexport function closeVideo() {\r\n\tvar video = document.getElementById('video');\r\n\tvideo.hidden = true;\r\n\tvideo.pause();\r\n\tchangeControlsToVideo();\r\n\tvar quality = document.getElementById('quality');\r\n\tquality.className = \"dropdown-content\";\r\n\treplaceDOM();\r\n}\r\n\r\nfunction replaceDOM() {\r\n\tvar old_element = document.getElementById(\"player\");\r\n\tvar new_element = old_element.cloneNode(true);\r\n\told_element.parentNode.replaceChild(new_element, old_element);\r\n}\r\n\r\nfunction changeControlsToLive() {\r\n\tvar time = document.getElementById('time'),\r\n\t\tlive = document.getElementById('live-indicator');\r\n\ttime.className = \"display_none\";\r\n\tlive.className = \"\";\r\n\tlive.setAttribute('data-type', 'live');\r\n}\r\n\r\nexport function backwardTime() {\r\n\tvar video = document.getElementById('video'),\r\n\tlive = document.getElementById('live-indicator'),\r\n\tcurrentTime = document.getElementById('current-time');\r\n\tvar attrType = live.getAttribute('data-type');\r\n\tif (attrType === 'video') {\r\n\t\tvideo.currentTime = Math.max(video.currentTime - 10, 0);\r\n\t\tcurrentTime.innerHTML = secondsToTime(video.currentTime);\r\n\t}\r\n}\r\n\r\nexport function forwardTime() {\r\n\tvar video = document.getElementById('video'),\r\n\tlive = document.getElementById('live-indicator'),\r\n\tcurrentTime = document.getElementById('current-time');\r\n\tvar attrType = live.getAttribute('data-type');\r\n\tif (attrType === 'video') {\r\n\t\tvideo.currentTime = Math.min(video.currentTime + 10, video.duration);\r\n\t\tcurrentTime.innerHTML = secondsToTime(video.currentTime);\r\n\t}\r\n}\r\n\r\nexport function upControls() {\r\n\tvar activeID = document.activeElement.getAttribute('id');\r\n\tif (!activeID) {\r\n\t\tvar playpause = document.getElementById('playpause');\r\n\t\tplaypause.focus();\r\n\t\treturn;\r\n\t}\r\n\tif (activeID === 'playpause') {\r\n\t\tvar playpause = document.getElementById('max');\r\n\t\tplaypause.focus();\r\n\t\treturn;\r\n\t}\r\n\tif (activeID === 'max') {\r\n\t\tvar playpause = document.getElementById('mute');\r\n\t\tplaypause.focus();\r\n\t\treturn;\r\n\t}\r\n\tif (activeID === 'mute') {\r\n\t\tvar playpause = document.getElementById('quality-btn');\r\n\t\tplaypause.focus();\r\n\t\treturn;\r\n\t}\r\n\tif (activeID === 'quality-btn') {\r\n\t\tvar quality = document.getElementById('quality');\r\n\t\tif (quality.className === \"dropdown-content show\") {\r\n\t\t\tvar qualityDetail = document.getElementById('quality-0');\r\n\t\t\tif (qualityDetail) {\r\n\t\t\t\tqualityDetail.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tif (activeID.includes('quality-')) {\r\n\t\tconst num = parseInt(extractNumber(activeID), 10);\r\n\t\tvar quality = document.getElementById('quality-' + (num + 1));\r\n\t\tif (quality) {\r\n\t\t\tquality.focus();\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n}\r\n\r\nexport function downControls() {\r\n\tvar activeID = document.activeElement.getAttribute('id');\r\n\tif (!activeID) {\r\n\t\tvar playpause = document.getElementById('playpause');\r\n\t\tplaypause.focus();\r\n\t\treturn;\r\n\t}\r\n\tif (activeID === 'max') {\r\n\t\tvar playpause = document.getElementById('playpause');\r\n\t\tplaypause.focus();\r\n\t\treturn;\r\n\t}\r\n\tif (activeID === 'mute') {\r\n\t\tvar playpause = document.getElementById('max');\r\n\t\tplaypause.focus();\r\n\t\treturn;\r\n\t}\r\n\tif (activeID === 'quality-btn') {\r\n\t\tvar playpause = document.getElementById('mute');\r\n\t\tplaypause.focus();\r\n\t\treturn;\r\n\t}\r\n\tif (activeID.includes('quality-')) {\r\n\t\tconst num = parseInt(extractNumber(activeID), 10);\r\n\t\tif (num === 0) {\r\n\t\t\tvar quality = document.getElementById('quality-btn');\r\n\t\t\tquality.focus();\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tvar quality = document.getElementById('quality-' + (num - 1));\r\n\t\t\tquality.focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction extractNumber(str) {\r\n    var matches = str.match(/quality-(\\d+)/);\r\n\r\n    if (matches && matches[1]) {\r\n        return parseInt(matches[1], 10);\r\n    } else {\r\n        return null; // or any default value you prefer\r\n    }\r\n}\r\n\r\nfunction changeControlsToVideo() {\r\n\tvar time = document.getElementById('time'),\r\n\t\tlive = document.getElementById('live-indicator');\r\n\tlive.className = \"display_none\";\r\n\ttime.className = \"\";\r\n\tlive.setAttribute('data-type', 'video');\r\n}\r\n\r\nfunction initApp() {\r\n\tLogic1();\r\n\tLogic2();\r\n}\r\nfunction createHtml () {\r\n\tvar htmlString = '<video id=\"video\" tabindex=\"0\" hidden></video><div id=\"video-controls\" class=\"controls display-control\"><button id=\"playpause\" tabindex=\"0\" type=\"button\" data-state=\"play\">Play/Pause</button><button id=\"back\" tabindex=\"0\" type=\"button\" data-state=\"back\"></button><button id=\"next\" tabindex=\"0\" type=\"button\" data-state=\"next\"></button><button id=\"max\" tabindex=\"0\" type=\"button\" data-state=\"max\"></button><button id=\"mute\" type=\"button\" data-state=\"mute\">Mute/Unmute</button><div class=\"dropdown\"><button id=\"quality-btn\" class=\"dropbtn btn-settings\"></button><div id=\"quality\" class=\"dropdown-content\"></div></div><div data-type=\"video\" id=\"live-indicator\" class=\"display_none\"><span id=\"red-dot\"></span><span id=\"live-text\">Live</span></div><div id=\"time\"><span id=\"current-time\">10:11</span>/<span id=\"end-time\">11:23</span></div><div class=\"progress\"><progress id=\"progress\" tabindex=\"0\" value=\"0\" min=\"0\"><span id=\"progress-bar\"></span></progress></div></div>'\r\n\tvar app = document.getElementById(\"app\");\r\n\tvar div = document.createElement('div');\r\n\tdiv.id = \"player\"\r\n\tdiv.innerHTML = htmlString.trim();\r\n\tapp.parentNode.insertBefore(div, app.nextSibling)\r\n}\r\ndocument.addEventListener('DOMContentLoaded', createHtml);","let taskIdCounter = 1,\n  isCallbackScheduled = false,\n  isPerformingWork = false,\n  taskQueue = [],\n  currentTask = null,\n  shouldYieldToHost = null,\n  yieldInterval = 5,\n  deadline = 0,\n  maxYieldInterval = 300,\n  scheduleCallback = null,\n  scheduledCallback = null;\nconst maxSigned31BitInt = 1073741823;\nfunction setupScheduler() {\n  const channel = new MessageChannel(),\n    port = channel.port2;\n  scheduleCallback = () => port.postMessage(null);\n  channel.port1.onmessage = () => {\n    if (scheduledCallback !== null) {\n      const currentTime = performance.now();\n      deadline = currentTime + yieldInterval;\n      const hasTimeRemaining = true;\n      try {\n        const hasMoreWork = scheduledCallback(hasTimeRemaining, currentTime);\n        if (!hasMoreWork) {\n          scheduledCallback = null;\n        } else port.postMessage(null);\n      } catch (error) {\n        port.postMessage(null);\n        throw error;\n      }\n    }\n  };\n  if (navigator && navigator.scheduling && navigator.scheduling.isInputPending) {\n    const scheduling = navigator.scheduling;\n    shouldYieldToHost = () => {\n      const currentTime = performance.now();\n      if (currentTime >= deadline) {\n        if (scheduling.isInputPending()) {\n          return true;\n        }\n        return currentTime >= maxYieldInterval;\n      } else {\n        return false;\n      }\n    };\n  } else {\n    shouldYieldToHost = () => performance.now() >= deadline;\n  }\n}\nfunction enqueue(taskQueue, task) {\n  function findIndex() {\n    let m = 0;\n    let n = taskQueue.length - 1;\n    while (m <= n) {\n      const k = (n + m) >> 1;\n      const cmp = task.expirationTime - taskQueue[k].expirationTime;\n      if (cmp > 0) m = k + 1;\n      else if (cmp < 0) n = k - 1;\n      else return k;\n    }\n    return m;\n  }\n  taskQueue.splice(findIndex(), 0, task);\n}\nfunction requestCallback(fn, options) {\n  if (!scheduleCallback) setupScheduler();\n  let startTime = performance.now(),\n    timeout = maxSigned31BitInt;\n  if (options && options.timeout) timeout = options.timeout;\n  const newTask = {\n    id: taskIdCounter++,\n    fn,\n    startTime,\n    expirationTime: startTime + timeout\n  };\n  enqueue(taskQueue, newTask);\n  if (!isCallbackScheduled && !isPerformingWork) {\n    isCallbackScheduled = true;\n    scheduledCallback = flushWork;\n    scheduleCallback();\n  }\n  return newTask;\n}\nfunction cancelCallback(task) {\n  task.fn = null;\n}\nfunction flushWork(hasTimeRemaining, initialTime) {\n  isCallbackScheduled = false;\n  isPerformingWork = true;\n  try {\n    return workLoop(hasTimeRemaining, initialTime);\n  } finally {\n    currentTask = null;\n    isPerformingWork = false;\n  }\n}\nfunction workLoop(hasTimeRemaining, initialTime) {\n  let currentTime = initialTime;\n  currentTask = taskQueue[0] || null;\n  while (currentTask !== null) {\n    if (currentTask.expirationTime > currentTime && (!hasTimeRemaining || shouldYieldToHost())) {\n      break;\n    }\n    const callback = currentTask.fn;\n    if (callback !== null) {\n      currentTask.fn = null;\n      const didUserCallbackTimeout = currentTask.expirationTime <= currentTime;\n      callback(didUserCallbackTimeout);\n      currentTime = performance.now();\n      if (currentTask === taskQueue[0]) {\n        taskQueue.shift();\n      }\n    } else taskQueue.shift();\n    currentTask = taskQueue[0] || null;\n  }\n  return currentTask !== null;\n}\n\nconst sharedConfig = {\n  context: undefined,\n  registry: undefined\n};\nfunction setHydrateContext(context) {\n  sharedConfig.context = context;\n}\nfunction nextHydrateContext() {\n  return {\n    ...sharedConfig.context,\n    id: `${sharedConfig.context.id}${sharedConfig.context.count++}-`,\n    count: 0\n  };\n}\n\nconst equalFn = (a, b) => a === b;\nconst $PROXY = Symbol(\"solid-proxy\");\nconst $TRACK = Symbol(\"solid-track\");\nconst $DEVCOMP = Symbol(\"solid-dev-component\");\nconst signalOptions = {\n  equals: equalFn\n};\nlet ERROR = null;\nlet runEffects = runQueue;\nconst STALE = 1;\nconst PENDING = 2;\nconst UNOWNED = {\n  owned: null,\n  cleanups: null,\n  context: null,\n  owner: null\n};\nconst NO_INIT = {};\nvar Owner = null;\nlet Transition = null;\nlet Scheduler = null;\nlet ExternalSourceFactory = null;\nlet Listener = null;\nlet Updates = null;\nlet Effects = null;\nlet ExecCount = 0;\nfunction createRoot(fn, detachedOwner) {\n  const listener = Listener,\n    owner = Owner,\n    unowned = fn.length === 0,\n    current = detachedOwner === undefined ? owner : detachedOwner,\n    root = unowned\n      ? UNOWNED\n      : {\n          owned: null,\n          cleanups: null,\n          context: current ? current.context : null,\n          owner: current\n        },\n    updateFn = unowned ? fn : () => fn(() => untrack(() => cleanNode(root)));\n  Owner = root;\n  Listener = null;\n  try {\n    return runUpdates(updateFn, true);\n  } finally {\n    Listener = listener;\n    Owner = owner;\n  }\n}\nfunction createSignal(value, options) {\n  options = options ? Object.assign({}, signalOptions, options) : signalOptions;\n  const s = {\n    value,\n    observers: null,\n    observerSlots: null,\n    comparator: options.equals || undefined\n  };\n  const setter = value => {\n    if (typeof value === \"function\") {\n      if (Transition && Transition.running && Transition.sources.has(s)) value = value(s.tValue);\n      else value = value(s.value);\n    }\n    return writeSignal(s, value);\n  };\n  return [readSignal.bind(s), setter];\n}\nfunction createComputed(fn, value, options) {\n  const c = createComputation(fn, value, true, STALE);\n  if (Scheduler && Transition && Transition.running) Updates.push(c);\n  else updateComputation(c);\n}\nfunction createRenderEffect(fn, value, options) {\n  const c = createComputation(fn, value, false, STALE);\n  if (Scheduler && Transition && Transition.running) Updates.push(c);\n  else updateComputation(c);\n}\nfunction createEffect(fn, value, options) {\n  runEffects = runUserEffects;\n  const c = createComputation(fn, value, false, STALE),\n    s = SuspenseContext && useContext(SuspenseContext);\n  if (s) c.suspense = s;\n  if (!options || !options.render) c.user = true;\n  Effects ? Effects.push(c) : updateComputation(c);\n}\nfunction createReaction(onInvalidate, options) {\n  let fn;\n  const c = createComputation(\n      () => {\n        fn ? fn() : untrack(onInvalidate);\n        fn = undefined;\n      },\n      undefined,\n      false,\n      0\n    ),\n    s = SuspenseContext && useContext(SuspenseContext);\n  if (s) c.suspense = s;\n  c.user = true;\n  return tracking => {\n    fn = tracking;\n    updateComputation(c);\n  };\n}\nfunction createMemo(fn, value, options) {\n  options = options ? Object.assign({}, signalOptions, options) : signalOptions;\n  const c = createComputation(fn, value, true, 0);\n  c.observers = null;\n  c.observerSlots = null;\n  c.comparator = options.equals || undefined;\n  if (Scheduler && Transition && Transition.running) {\n    c.tState = STALE;\n    Updates.push(c);\n  } else updateComputation(c);\n  return readSignal.bind(c);\n}\nfunction isPromise(v) {\n  return v && typeof v === \"object\" && \"then\" in v;\n}\nfunction createResource(pSource, pFetcher, pOptions) {\n  let source;\n  let fetcher;\n  let options;\n  if ((arguments.length === 2 && typeof pFetcher === \"object\") || arguments.length === 1) {\n    source = true;\n    fetcher = pSource;\n    options = pFetcher || {};\n  } else {\n    source = pSource;\n    fetcher = pFetcher;\n    options = pOptions || {};\n  }\n  let pr = null,\n    initP = NO_INIT,\n    id = null,\n    loadedUnderTransition = false,\n    scheduled = false,\n    resolved = \"initialValue\" in options,\n    dynamic = typeof source === \"function\" && createMemo(source);\n  const contexts = new Set(),\n    [value, setValue] = (options.storage || createSignal)(options.initialValue),\n    [error, setError] = createSignal(undefined),\n    [track, trigger] = createSignal(undefined, {\n      equals: false\n    }),\n    [state, setState] = createSignal(resolved ? \"ready\" : \"unresolved\");\n  if (sharedConfig.context) {\n    id = `${sharedConfig.context.id}${sharedConfig.context.count++}`;\n    let v;\n    if (options.ssrLoadFrom === \"initial\") initP = options.initialValue;\n    else if (sharedConfig.load && (v = sharedConfig.load(id))) initP = v;\n  }\n  function loadEnd(p, v, error, key) {\n    if (pr === p) {\n      pr = null;\n      key !== undefined && (resolved = true);\n      if ((p === initP || v === initP) && options.onHydrated)\n        queueMicrotask(() =>\n          options.onHydrated(key, {\n            value: v\n          })\n        );\n      initP = NO_INIT;\n      if (Transition && p && loadedUnderTransition) {\n        Transition.promises.delete(p);\n        loadedUnderTransition = false;\n        runUpdates(() => {\n          Transition.running = true;\n          completeLoad(v, error);\n        }, false);\n      } else completeLoad(v, error);\n    }\n    return v;\n  }\n  function completeLoad(v, err) {\n    runUpdates(() => {\n      if (err === undefined) setValue(() => v);\n      setState(err !== undefined ? \"errored\" : resolved ? \"ready\" : \"unresolved\");\n      setError(err);\n      for (const c of contexts.keys()) c.decrement();\n      contexts.clear();\n    }, false);\n  }\n  function read() {\n    const c = SuspenseContext && useContext(SuspenseContext),\n      v = value(),\n      err = error();\n    if (err !== undefined && !pr) throw err;\n    if (Listener && !Listener.user && c) {\n      createComputed(() => {\n        track();\n        if (pr) {\n          if (c.resolved && Transition && loadedUnderTransition) Transition.promises.add(pr);\n          else if (!contexts.has(c)) {\n            c.increment();\n            contexts.add(c);\n          }\n        }\n      });\n    }\n    return v;\n  }\n  function load(refetching = true) {\n    if (refetching !== false && scheduled) return;\n    scheduled = false;\n    const lookup = dynamic ? dynamic() : source;\n    loadedUnderTransition = Transition && Transition.running;\n    if (lookup == null || lookup === false) {\n      loadEnd(pr, untrack(value));\n      return;\n    }\n    if (Transition && pr) Transition.promises.delete(pr);\n    const p =\n      initP !== NO_INIT\n        ? initP\n        : untrack(() =>\n            fetcher(lookup, {\n              value: value(),\n              refetching\n            })\n          );\n    if (!isPromise(p)) {\n      loadEnd(pr, p, undefined, lookup);\n      return p;\n    }\n    pr = p;\n    if (\"value\" in p) {\n      if (p.status === \"success\") loadEnd(pr, p.value, undefined, lookup);\n      else loadEnd(pr, undefined, undefined, lookup);\n      return p;\n    }\n    scheduled = true;\n    queueMicrotask(() => (scheduled = false));\n    runUpdates(() => {\n      setState(resolved ? \"refreshing\" : \"pending\");\n      trigger();\n    }, false);\n    return p.then(\n      v => loadEnd(p, v, undefined, lookup),\n      e => loadEnd(p, undefined, castError(e), lookup)\n    );\n  }\n  Object.defineProperties(read, {\n    state: {\n      get: () => state()\n    },\n    error: {\n      get: () => error()\n    },\n    loading: {\n      get() {\n        const s = state();\n        return s === \"pending\" || s === \"refreshing\";\n      }\n    },\n    latest: {\n      get() {\n        if (!resolved) return read();\n        const err = error();\n        if (err && !pr) throw err;\n        return value();\n      }\n    }\n  });\n  if (dynamic) createComputed(() => load(false));\n  else load(false);\n  return [\n    read,\n    {\n      refetch: load,\n      mutate: setValue\n    }\n  ];\n}\nfunction createDeferred(source, options) {\n  let t,\n    timeout = options ? options.timeoutMs : undefined;\n  const node = createComputation(\n    () => {\n      if (!t || !t.fn)\n        t = requestCallback(\n          () => setDeferred(() => node.value),\n          timeout !== undefined\n            ? {\n                timeout\n              }\n            : undefined\n        );\n      return source();\n    },\n    undefined,\n    true\n  );\n  const [deferred, setDeferred] = createSignal(\n    Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value,\n    options\n  );\n  updateComputation(node);\n  setDeferred(() =>\n    Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value\n  );\n  return deferred;\n}\nfunction createSelector(source, fn = equalFn, options) {\n  const subs = new Map();\n  const node = createComputation(\n    p => {\n      const v = source();\n      for (const [key, val] of subs.entries())\n        if (fn(key, v) !== fn(key, p)) {\n          for (const c of val.values()) {\n            c.state = STALE;\n            if (c.pure) Updates.push(c);\n            else Effects.push(c);\n          }\n        }\n      return v;\n    },\n    undefined,\n    true,\n    STALE\n  );\n  updateComputation(node);\n  return key => {\n    const listener = Listener;\n    if (listener) {\n      let l;\n      if ((l = subs.get(key))) l.add(listener);\n      else subs.set(key, (l = new Set([listener])));\n      onCleanup(() => {\n        l.delete(listener);\n        !l.size && subs.delete(key);\n      });\n    }\n    return fn(\n      key,\n      Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value\n    );\n  };\n}\nfunction batch(fn) {\n  return runUpdates(fn, false);\n}\nfunction untrack(fn) {\n  if (Listener === null) return fn();\n  const listener = Listener;\n  Listener = null;\n  try {\n    return fn();\n  } finally {\n    Listener = listener;\n  }\n}\nfunction on(deps, fn, options) {\n  const isArray = Array.isArray(deps);\n  let prevInput;\n  let defer = options && options.defer;\n  return prevValue => {\n    let input;\n    if (isArray) {\n      input = Array(deps.length);\n      for (let i = 0; i < deps.length; i++) input[i] = deps[i]();\n    } else input = deps();\n    if (defer) {\n      defer = false;\n      return undefined;\n    }\n    const result = untrack(() => fn(input, prevInput, prevValue));\n    prevInput = input;\n    return result;\n  };\n}\nfunction onMount(fn) {\n  createEffect(() => untrack(fn));\n}\nfunction onCleanup(fn) {\n  if (Owner === null);\n  else if (Owner.cleanups === null) Owner.cleanups = [fn];\n  else Owner.cleanups.push(fn);\n  return fn;\n}\nfunction catchError(fn, handler) {\n  ERROR || (ERROR = Symbol(\"error\"));\n  Owner = createComputation(undefined, undefined, true);\n  Owner.context = {\n    ...Owner.context,\n    [ERROR]: [handler]\n  };\n  if (Transition && Transition.running) Transition.sources.add(Owner);\n  try {\n    return fn();\n  } catch (err) {\n    handleError(err);\n  } finally {\n    Owner = Owner.owner;\n  }\n}\nfunction getListener() {\n  return Listener;\n}\nfunction getOwner() {\n  return Owner;\n}\nfunction runWithOwner(o, fn) {\n  const prev = Owner;\n  const prevListener = Listener;\n  Owner = o;\n  Listener = null;\n  try {\n    return runUpdates(fn, true);\n  } catch (err) {\n    handleError(err);\n  } finally {\n    Owner = prev;\n    Listener = prevListener;\n  }\n}\nfunction enableScheduling(scheduler = requestCallback) {\n  Scheduler = scheduler;\n}\nfunction startTransition(fn) {\n  if (Transition && Transition.running) {\n    fn();\n    return Transition.done;\n  }\n  const l = Listener;\n  const o = Owner;\n  return Promise.resolve().then(() => {\n    Listener = l;\n    Owner = o;\n    let t;\n    if (Scheduler || SuspenseContext) {\n      t =\n        Transition ||\n        (Transition = {\n          sources: new Set(),\n          effects: [],\n          promises: new Set(),\n          disposed: new Set(),\n          queue: new Set(),\n          running: true\n        });\n      t.done || (t.done = new Promise(res => (t.resolve = res)));\n      t.running = true;\n    }\n    runUpdates(fn, false);\n    Listener = Owner = null;\n    return t ? t.done : undefined;\n  });\n}\nconst [transPending, setTransPending] = /*@__PURE__*/ createSignal(false);\nfunction useTransition() {\n  return [transPending, startTransition];\n}\nfunction resumeEffects(e) {\n  Effects.push.apply(Effects, e);\n  e.length = 0;\n}\nfunction createContext(defaultValue, options) {\n  const id = Symbol(\"context\");\n  return {\n    id,\n    Provider: createProvider(id),\n    defaultValue\n  };\n}\nfunction useContext(context) {\n  return Owner && Owner.context && Owner.context[context.id] !== undefined\n    ? Owner.context[context.id]\n    : context.defaultValue;\n}\nfunction children(fn) {\n  const children = createMemo(fn);\n  const memo = createMemo(() => resolveChildren(children()));\n  memo.toArray = () => {\n    const c = memo();\n    return Array.isArray(c) ? c : c != null ? [c] : [];\n  };\n  return memo;\n}\nlet SuspenseContext;\nfunction getSuspenseContext() {\n  return SuspenseContext || (SuspenseContext = createContext());\n}\nfunction enableExternalSource(factory) {\n  if (ExternalSourceFactory) {\n    const oldFactory = ExternalSourceFactory;\n    ExternalSourceFactory = (fn, trigger) => {\n      const oldSource = oldFactory(fn, trigger);\n      const source = factory(x => oldSource.track(x), trigger);\n      return {\n        track: x => source.track(x),\n        dispose() {\n          source.dispose();\n          oldSource.dispose();\n        }\n      };\n    };\n  } else {\n    ExternalSourceFactory = factory;\n  }\n}\nfunction readSignal() {\n  const runningTransition = Transition && Transition.running;\n  if (this.sources && (runningTransition ? this.tState : this.state)) {\n    if ((runningTransition ? this.tState : this.state) === STALE) updateComputation(this);\n    else {\n      const updates = Updates;\n      Updates = null;\n      runUpdates(() => lookUpstream(this), false);\n      Updates = updates;\n    }\n  }\n  if (Listener) {\n    const sSlot = this.observers ? this.observers.length : 0;\n    if (!Listener.sources) {\n      Listener.sources = [this];\n      Listener.sourceSlots = [sSlot];\n    } else {\n      Listener.sources.push(this);\n      Listener.sourceSlots.push(sSlot);\n    }\n    if (!this.observers) {\n      this.observers = [Listener];\n      this.observerSlots = [Listener.sources.length - 1];\n    } else {\n      this.observers.push(Listener);\n      this.observerSlots.push(Listener.sources.length - 1);\n    }\n  }\n  if (runningTransition && Transition.sources.has(this)) return this.tValue;\n  return this.value;\n}\nfunction writeSignal(node, value, isComp) {\n  let current =\n    Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value;\n  if (!node.comparator || !node.comparator(current, value)) {\n    if (Transition) {\n      const TransitionRunning = Transition.running;\n      if (TransitionRunning || (!isComp && Transition.sources.has(node))) {\n        Transition.sources.add(node);\n        node.tValue = value;\n      }\n      if (!TransitionRunning) node.value = value;\n    } else node.value = value;\n    if (node.observers && node.observers.length) {\n      runUpdates(() => {\n        for (let i = 0; i < node.observers.length; i += 1) {\n          const o = node.observers[i];\n          const TransitionRunning = Transition && Transition.running;\n          if (TransitionRunning && Transition.disposed.has(o)) continue;\n          if (TransitionRunning ? !o.tState : !o.state) {\n            if (o.pure) Updates.push(o);\n            else Effects.push(o);\n            if (o.observers) markDownstream(o);\n          }\n          if (!TransitionRunning) o.state = STALE;\n          else o.tState = STALE;\n        }\n        if (Updates.length > 10e5) {\n          Updates = [];\n          if (false);\n          throw new Error();\n        }\n      }, false);\n    }\n  }\n  return value;\n}\nfunction updateComputation(node) {\n  if (!node.fn) return;\n  cleanNode(node);\n  const time = ExecCount;\n  runComputation(\n    node,\n    Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value,\n    time\n  );\n  if (Transition && !Transition.running && Transition.sources.has(node)) {\n    queueMicrotask(() => {\n      runUpdates(() => {\n        Transition && (Transition.running = true);\n        Listener = Owner = node;\n        runComputation(node, node.tValue, time);\n        Listener = Owner = null;\n      }, false);\n    });\n  }\n}\nfunction runComputation(node, value, time) {\n  let nextValue;\n  const owner = Owner,\n    listener = Listener;\n  Listener = Owner = node;\n  try {\n    nextValue = node.fn(value);\n  } catch (err) {\n    if (node.pure) {\n      if (Transition && Transition.running) {\n        node.tState = STALE;\n        node.tOwned && node.tOwned.forEach(cleanNode);\n        node.tOwned = undefined;\n      } else {\n        node.state = STALE;\n        node.owned && node.owned.forEach(cleanNode);\n        node.owned = null;\n      }\n    }\n    node.updatedAt = time + 1;\n    return handleError(err);\n  } finally {\n    Listener = listener;\n    Owner = owner;\n  }\n  if (!node.updatedAt || node.updatedAt <= time) {\n    if (node.updatedAt != null && \"observers\" in node) {\n      writeSignal(node, nextValue, true);\n    } else if (Transition && Transition.running && node.pure) {\n      Transition.sources.add(node);\n      node.tValue = nextValue;\n    } else node.value = nextValue;\n    node.updatedAt = time;\n  }\n}\nfunction createComputation(fn, init, pure, state = STALE, options) {\n  const c = {\n    fn,\n    state: state,\n    updatedAt: null,\n    owned: null,\n    sources: null,\n    sourceSlots: null,\n    cleanups: null,\n    value: init,\n    owner: Owner,\n    context: Owner ? Owner.context : null,\n    pure\n  };\n  if (Transition && Transition.running) {\n    c.state = 0;\n    c.tState = state;\n  }\n  if (Owner === null);\n  else if (Owner !== UNOWNED) {\n    if (Transition && Transition.running && Owner.pure) {\n      if (!Owner.tOwned) Owner.tOwned = [c];\n      else Owner.tOwned.push(c);\n    } else {\n      if (!Owner.owned) Owner.owned = [c];\n      else Owner.owned.push(c);\n    }\n  }\n  if (ExternalSourceFactory) {\n    const [track, trigger] = createSignal(undefined, {\n      equals: false\n    });\n    const ordinary = ExternalSourceFactory(c.fn, trigger);\n    onCleanup(() => ordinary.dispose());\n    const triggerInTransition = () => startTransition(trigger).then(() => inTransition.dispose());\n    const inTransition = ExternalSourceFactory(c.fn, triggerInTransition);\n    c.fn = x => {\n      track();\n      return Transition && Transition.running ? inTransition.track(x) : ordinary.track(x);\n    };\n  }\n  return c;\n}\nfunction runTop(node) {\n  const runningTransition = Transition && Transition.running;\n  if ((runningTransition ? node.tState : node.state) === 0) return;\n  if ((runningTransition ? node.tState : node.state) === PENDING) return lookUpstream(node);\n  if (node.suspense && untrack(node.suspense.inFallback)) return node.suspense.effects.push(node);\n  const ancestors = [node];\n  while ((node = node.owner) && (!node.updatedAt || node.updatedAt < ExecCount)) {\n    if (runningTransition && Transition.disposed.has(node)) return;\n    if (runningTransition ? node.tState : node.state) ancestors.push(node);\n  }\n  for (let i = ancestors.length - 1; i >= 0; i--) {\n    node = ancestors[i];\n    if (runningTransition) {\n      let top = node,\n        prev = ancestors[i + 1];\n      while ((top = top.owner) && top !== prev) {\n        if (Transition.disposed.has(top)) return;\n      }\n    }\n    if ((runningTransition ? node.tState : node.state) === STALE) {\n      updateComputation(node);\n    } else if ((runningTransition ? node.tState : node.state) === PENDING) {\n      const updates = Updates;\n      Updates = null;\n      runUpdates(() => lookUpstream(node, ancestors[0]), false);\n      Updates = updates;\n    }\n  }\n}\nfunction runUpdates(fn, init) {\n  if (Updates) return fn();\n  let wait = false;\n  if (!init) Updates = [];\n  if (Effects) wait = true;\n  else Effects = [];\n  ExecCount++;\n  try {\n    const res = fn();\n    completeUpdates(wait);\n    return res;\n  } catch (err) {\n    if (!wait) Effects = null;\n    Updates = null;\n    handleError(err);\n  }\n}\nfunction completeUpdates(wait) {\n  if (Updates) {\n    if (Scheduler && Transition && Transition.running) scheduleQueue(Updates);\n    else runQueue(Updates);\n    Updates = null;\n  }\n  if (wait) return;\n  let res;\n  if (Transition) {\n    if (!Transition.promises.size && !Transition.queue.size) {\n      const sources = Transition.sources;\n      const disposed = Transition.disposed;\n      Effects.push.apply(Effects, Transition.effects);\n      res = Transition.resolve;\n      for (const e of Effects) {\n        \"tState\" in e && (e.state = e.tState);\n        delete e.tState;\n      }\n      Transition = null;\n      runUpdates(() => {\n        for (const d of disposed) cleanNode(d);\n        for (const v of sources) {\n          v.value = v.tValue;\n          if (v.owned) {\n            for (let i = 0, len = v.owned.length; i < len; i++) cleanNode(v.owned[i]);\n          }\n          if (v.tOwned) v.owned = v.tOwned;\n          delete v.tValue;\n          delete v.tOwned;\n          v.tState = 0;\n        }\n        setTransPending(false);\n      }, false);\n    } else if (Transition.running) {\n      Transition.running = false;\n      Transition.effects.push.apply(Transition.effects, Effects);\n      Effects = null;\n      setTransPending(true);\n      return;\n    }\n  }\n  const e = Effects;\n  Effects = null;\n  if (e.length) runUpdates(() => runEffects(e), false);\n  if (res) res();\n}\nfunction runQueue(queue) {\n  for (let i = 0; i < queue.length; i++) runTop(queue[i]);\n}\nfunction scheduleQueue(queue) {\n  for (let i = 0; i < queue.length; i++) {\n    const item = queue[i];\n    const tasks = Transition.queue;\n    if (!tasks.has(item)) {\n      tasks.add(item);\n      Scheduler(() => {\n        tasks.delete(item);\n        runUpdates(() => {\n          Transition.running = true;\n          runTop(item);\n        }, false);\n        Transition && (Transition.running = false);\n      });\n    }\n  }\n}\nfunction runUserEffects(queue) {\n  let i,\n    userLength = 0;\n  for (i = 0; i < queue.length; i++) {\n    const e = queue[i];\n    if (!e.user) runTop(e);\n    else queue[userLength++] = e;\n  }\n  if (sharedConfig.context) {\n    if (sharedConfig.count) {\n      sharedConfig.effects || (sharedConfig.effects = []);\n      sharedConfig.effects.push(...queue.slice(0, userLength));\n      return;\n    } else if (sharedConfig.effects) {\n      queue = [...sharedConfig.effects, ...queue];\n      userLength += sharedConfig.effects.length;\n      delete sharedConfig.effects;\n    }\n    setHydrateContext();\n  }\n  for (i = 0; i < userLength; i++) runTop(queue[i]);\n}\nfunction lookUpstream(node, ignore) {\n  const runningTransition = Transition && Transition.running;\n  if (runningTransition) node.tState = 0;\n  else node.state = 0;\n  for (let i = 0; i < node.sources.length; i += 1) {\n    const source = node.sources[i];\n    if (source.sources) {\n      const state = runningTransition ? source.tState : source.state;\n      if (state === STALE) {\n        if (source !== ignore && (!source.updatedAt || source.updatedAt < ExecCount))\n          runTop(source);\n      } else if (state === PENDING) lookUpstream(source, ignore);\n    }\n  }\n}\nfunction markDownstream(node) {\n  const runningTransition = Transition && Transition.running;\n  for (let i = 0; i < node.observers.length; i += 1) {\n    const o = node.observers[i];\n    if (runningTransition ? !o.tState : !o.state) {\n      if (runningTransition) o.tState = PENDING;\n      else o.state = PENDING;\n      if (o.pure) Updates.push(o);\n      else Effects.push(o);\n      o.observers && markDownstream(o);\n    }\n  }\n}\nfunction cleanNode(node) {\n  let i;\n  if (node.sources) {\n    while (node.sources.length) {\n      const source = node.sources.pop(),\n        index = node.sourceSlots.pop(),\n        obs = source.observers;\n      if (obs && obs.length) {\n        const n = obs.pop(),\n          s = source.observerSlots.pop();\n        if (index < obs.length) {\n          n.sourceSlots[s] = index;\n          obs[index] = n;\n          source.observerSlots[index] = s;\n        }\n      }\n    }\n  }\n  if (Transition && Transition.running && node.pure) {\n    if (node.tOwned) {\n      for (i = node.tOwned.length - 1; i >= 0; i--) cleanNode(node.tOwned[i]);\n      delete node.tOwned;\n    }\n    reset(node, true);\n  } else if (node.owned) {\n    for (i = node.owned.length - 1; i >= 0; i--) cleanNode(node.owned[i]);\n    node.owned = null;\n  }\n  if (node.cleanups) {\n    for (i = node.cleanups.length - 1; i >= 0; i--) node.cleanups[i]();\n    node.cleanups = null;\n  }\n  if (Transition && Transition.running) node.tState = 0;\n  else node.state = 0;\n}\nfunction reset(node, top) {\n  if (!top) {\n    node.tState = 0;\n    Transition.disposed.add(node);\n  }\n  if (node.owned) {\n    for (let i = 0; i < node.owned.length; i++) reset(node.owned[i]);\n  }\n}\nfunction castError(err) {\n  if (err instanceof Error) return err;\n  return new Error(typeof err === \"string\" ? err : \"Unknown error\", {\n    cause: err\n  });\n}\nfunction runErrors(err, fns, owner) {\n  try {\n    for (const f of fns) f(err);\n  } catch (e) {\n    handleError(e, (owner && owner.owner) || null);\n  }\n}\nfunction handleError(err, owner = Owner) {\n  const fns = ERROR && owner && owner.context && owner.context[ERROR];\n  const error = castError(err);\n  if (!fns) throw error;\n  if (Effects)\n    Effects.push({\n      fn() {\n        runErrors(error, fns, owner);\n      },\n      state: STALE\n    });\n  else runErrors(error, fns, owner);\n}\nfunction resolveChildren(children) {\n  if (typeof children === \"function\" && !children.length) return resolveChildren(children());\n  if (Array.isArray(children)) {\n    const results = [];\n    for (let i = 0; i < children.length; i++) {\n      const result = resolveChildren(children[i]);\n      Array.isArray(result) ? results.push.apply(results, result) : results.push(result);\n    }\n    return results;\n  }\n  return children;\n}\nfunction createProvider(id, options) {\n  return function provider(props) {\n    let res;\n    createRenderEffect(\n      () =>\n        (res = untrack(() => {\n          Owner.context = {\n            ...Owner.context,\n            [id]: props.value\n          };\n          return children(() => props.children);\n        })),\n      undefined\n    );\n    return res;\n  };\n}\nfunction onError(fn) {\n  ERROR || (ERROR = Symbol(\"error\"));\n  if (Owner === null);\n  else if (Owner.context === null || !Owner.context[ERROR]) {\n    Owner.context = {\n      ...Owner.context,\n      [ERROR]: [fn]\n    };\n    mutateContext(Owner, ERROR, [fn]);\n  } else Owner.context[ERROR].push(fn);\n}\nfunction mutateContext(o, key, value) {\n  if (o.owned) {\n    for (let i = 0; i < o.owned.length; i++) {\n      if (o.owned[i].context === o.context) mutateContext(o.owned[i], key, value);\n      if (!o.owned[i].context) {\n        o.owned[i].context = o.context;\n        mutateContext(o.owned[i], key, value);\n      } else if (!o.owned[i].context[key]) {\n        o.owned[i].context[key] = value;\n        mutateContext(o.owned[i], key, value);\n      }\n    }\n  }\n}\n\nfunction observable(input) {\n  return {\n    subscribe(observer) {\n      if (!(observer instanceof Object) || observer == null) {\n        throw new TypeError(\"Expected the observer to be an object.\");\n      }\n      const handler =\n        typeof observer === \"function\" ? observer : observer.next && observer.next.bind(observer);\n      if (!handler) {\n        return {\n          unsubscribe() {}\n        };\n      }\n      const dispose = createRoot(disposer => {\n        createEffect(() => {\n          const v = input();\n          untrack(() => handler(v));\n        });\n        return disposer;\n      });\n      if (getOwner()) onCleanup(dispose);\n      return {\n        unsubscribe() {\n          dispose();\n        }\n      };\n    },\n    [Symbol.observable || \"@@observable\"]() {\n      return this;\n    }\n  };\n}\nfunction from(producer) {\n  const [s, set] = createSignal(undefined, {\n    equals: false\n  });\n  if (\"subscribe\" in producer) {\n    const unsub = producer.subscribe(v => set(() => v));\n    onCleanup(() => (\"unsubscribe\" in unsub ? unsub.unsubscribe() : unsub()));\n  } else {\n    const clean = producer(set);\n    onCleanup(clean);\n  }\n  return s;\n}\n\nconst FALLBACK = Symbol(\"fallback\");\nfunction dispose(d) {\n  for (let i = 0; i < d.length; i++) d[i]();\n}\nfunction mapArray(list, mapFn, options = {}) {\n  let items = [],\n    mapped = [],\n    disposers = [],\n    len = 0,\n    indexes = mapFn.length > 1 ? [] : null;\n  onCleanup(() => dispose(disposers));\n  return () => {\n    let newItems = list() || [],\n      i,\n      j;\n    newItems[$TRACK];\n    return untrack(() => {\n      let newLen = newItems.length,\n        newIndices,\n        newIndicesNext,\n        temp,\n        tempdisposers,\n        tempIndexes,\n        start,\n        end,\n        newEnd,\n        item;\n      if (newLen === 0) {\n        if (len !== 0) {\n          dispose(disposers);\n          disposers = [];\n          items = [];\n          mapped = [];\n          len = 0;\n          indexes && (indexes = []);\n        }\n        if (options.fallback) {\n          items = [FALLBACK];\n          mapped[0] = createRoot(disposer => {\n            disposers[0] = disposer;\n            return options.fallback();\n          });\n          len = 1;\n        }\n      } else if (len === 0) {\n        mapped = new Array(newLen);\n        for (j = 0; j < newLen; j++) {\n          items[j] = newItems[j];\n          mapped[j] = createRoot(mapper);\n        }\n        len = newLen;\n      } else {\n        temp = new Array(newLen);\n        tempdisposers = new Array(newLen);\n        indexes && (tempIndexes = new Array(newLen));\n        for (\n          start = 0, end = Math.min(len, newLen);\n          start < end && items[start] === newItems[start];\n          start++\n        );\n        for (\n          end = len - 1, newEnd = newLen - 1;\n          end >= start && newEnd >= start && items[end] === newItems[newEnd];\n          end--, newEnd--\n        ) {\n          temp[newEnd] = mapped[end];\n          tempdisposers[newEnd] = disposers[end];\n          indexes && (tempIndexes[newEnd] = indexes[end]);\n        }\n        newIndices = new Map();\n        newIndicesNext = new Array(newEnd + 1);\n        for (j = newEnd; j >= start; j--) {\n          item = newItems[j];\n          i = newIndices.get(item);\n          newIndicesNext[j] = i === undefined ? -1 : i;\n          newIndices.set(item, j);\n        }\n        for (i = start; i <= end; i++) {\n          item = items[i];\n          j = newIndices.get(item);\n          if (j !== undefined && j !== -1) {\n            temp[j] = mapped[i];\n            tempdisposers[j] = disposers[i];\n            indexes && (tempIndexes[j] = indexes[i]);\n            j = newIndicesNext[j];\n            newIndices.set(item, j);\n          } else disposers[i]();\n        }\n        for (j = start; j < newLen; j++) {\n          if (j in temp) {\n            mapped[j] = temp[j];\n            disposers[j] = tempdisposers[j];\n            if (indexes) {\n              indexes[j] = tempIndexes[j];\n              indexes[j](j);\n            }\n          } else mapped[j] = createRoot(mapper);\n        }\n        mapped = mapped.slice(0, (len = newLen));\n        items = newItems.slice(0);\n      }\n      return mapped;\n    });\n    function mapper(disposer) {\n      disposers[j] = disposer;\n      if (indexes) {\n        const [s, set] = createSignal(j);\n        indexes[j] = set;\n        return mapFn(newItems[j], s);\n      }\n      return mapFn(newItems[j]);\n    }\n  };\n}\nfunction indexArray(list, mapFn, options = {}) {\n  let items = [],\n    mapped = [],\n    disposers = [],\n    signals = [],\n    len = 0,\n    i;\n  onCleanup(() => dispose(disposers));\n  return () => {\n    const newItems = list() || [];\n    newItems[$TRACK];\n    return untrack(() => {\n      if (newItems.length === 0) {\n        if (len !== 0) {\n          dispose(disposers);\n          disposers = [];\n          items = [];\n          mapped = [];\n          len = 0;\n          signals = [];\n        }\n        if (options.fallback) {\n          items = [FALLBACK];\n          mapped[0] = createRoot(disposer => {\n            disposers[0] = disposer;\n            return options.fallback();\n          });\n          len = 1;\n        }\n        return mapped;\n      }\n      if (items[0] === FALLBACK) {\n        disposers[0]();\n        disposers = [];\n        items = [];\n        mapped = [];\n        len = 0;\n      }\n      for (i = 0; i < newItems.length; i++) {\n        if (i < items.length && items[i] !== newItems[i]) {\n          signals[i](() => newItems[i]);\n        } else if (i >= items.length) {\n          mapped[i] = createRoot(mapper);\n        }\n      }\n      for (; i < items.length; i++) {\n        disposers[i]();\n      }\n      len = signals.length = disposers.length = newItems.length;\n      items = newItems.slice(0);\n      return (mapped = mapped.slice(0, len));\n    });\n    function mapper(disposer) {\n      disposers[i] = disposer;\n      const [s, set] = createSignal(newItems[i]);\n      signals[i] = set;\n      return mapFn(s, i);\n    }\n  };\n}\n\nlet hydrationEnabled = false;\nfunction enableHydration() {\n  hydrationEnabled = true;\n}\nfunction createComponent(Comp, props) {\n  if (hydrationEnabled) {\n    if (sharedConfig.context) {\n      const c = sharedConfig.context;\n      setHydrateContext(nextHydrateContext());\n      const r = untrack(() => Comp(props || {}));\n      setHydrateContext(c);\n      return r;\n    }\n  }\n  return untrack(() => Comp(props || {}));\n}\nfunction trueFn() {\n  return true;\n}\nconst propTraps = {\n  get(_, property, receiver) {\n    if (property === $PROXY) return receiver;\n    return _.get(property);\n  },\n  has(_, property) {\n    if (property === $PROXY) return true;\n    return _.has(property);\n  },\n  set: trueFn,\n  deleteProperty: trueFn,\n  getOwnPropertyDescriptor(_, property) {\n    return {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return _.get(property);\n      },\n      set: trueFn,\n      deleteProperty: trueFn\n    };\n  },\n  ownKeys(_) {\n    return _.keys();\n  }\n};\nfunction resolveSource(s) {\n  return !(s = typeof s === \"function\" ? s() : s) ? {} : s;\n}\nfunction resolveSources() {\n  for (let i = 0, length = this.length; i < length; ++i) {\n    const v = this[i]();\n    if (v !== undefined) return v;\n  }\n}\nfunction mergeProps(...sources) {\n  let proxy = false;\n  for (let i = 0; i < sources.length; i++) {\n    const s = sources[i];\n    proxy = proxy || (!!s && $PROXY in s);\n    sources[i] = typeof s === \"function\" ? ((proxy = true), createMemo(s)) : s;\n  }\n  if (proxy) {\n    return new Proxy(\n      {\n        get(property) {\n          for (let i = sources.length - 1; i >= 0; i--) {\n            const v = resolveSource(sources[i])[property];\n            if (v !== undefined) return v;\n          }\n        },\n        has(property) {\n          for (let i = sources.length - 1; i >= 0; i--) {\n            if (property in resolveSource(sources[i])) return true;\n          }\n          return false;\n        },\n        keys() {\n          const keys = [];\n          for (let i = 0; i < sources.length; i++)\n            keys.push(...Object.keys(resolveSource(sources[i])));\n          return [...new Set(keys)];\n        }\n      },\n      propTraps\n    );\n  }\n  const target = {};\n  const sourcesMap = {};\n  const defined = new Set();\n  for (let i = sources.length - 1; i >= 0; i--) {\n    const source = sources[i];\n    if (!source) continue;\n    const sourceKeys = Object.getOwnPropertyNames(source);\n    for (let i = 0, length = sourceKeys.length; i < length; i++) {\n      const key = sourceKeys[i];\n      if (key === \"__proto__\" || key === \"constructor\") continue;\n      const desc = Object.getOwnPropertyDescriptor(source, key);\n      if (!defined.has(key)) {\n        if (desc.get) {\n          defined.add(key);\n          Object.defineProperty(target, key, {\n            enumerable: true,\n            configurable: true,\n            get: resolveSources.bind((sourcesMap[key] = [desc.get.bind(source)]))\n          });\n        } else {\n          if (desc.value !== undefined) defined.add(key);\n          target[key] = desc.value;\n        }\n      } else {\n        const sources = sourcesMap[key];\n        if (sources) {\n          if (desc.get) {\n            sources.push(desc.get.bind(source));\n          } else if (desc.value !== undefined) {\n            sources.push(() => desc.value);\n          }\n        } else if (target[key] === undefined) target[key] = desc.value;\n      }\n    }\n  }\n  return target;\n}\nfunction splitProps(props, ...keys) {\n  if ($PROXY in props) {\n    const blocked = new Set(keys.length > 1 ? keys.flat() : keys[0]);\n    const res = keys.map(k => {\n      return new Proxy(\n        {\n          get(property) {\n            return k.includes(property) ? props[property] : undefined;\n          },\n          has(property) {\n            return k.includes(property) && property in props;\n          },\n          keys() {\n            return k.filter(property => property in props);\n          }\n        },\n        propTraps\n      );\n    });\n    res.push(\n      new Proxy(\n        {\n          get(property) {\n            return blocked.has(property) ? undefined : props[property];\n          },\n          has(property) {\n            return blocked.has(property) ? false : property in props;\n          },\n          keys() {\n            return Object.keys(props).filter(k => !blocked.has(k));\n          }\n        },\n        propTraps\n      )\n    );\n    return res;\n  }\n  const otherObject = {};\n  const objects = keys.map(() => ({}));\n  for (const propName of Object.getOwnPropertyNames(props)) {\n    const desc = Object.getOwnPropertyDescriptor(props, propName);\n    const isDefaultDesc =\n      !desc.get && !desc.set && desc.enumerable && desc.writable && desc.configurable;\n    let blocked = false;\n    let objectIndex = 0;\n    for (const k of keys) {\n      if (k.includes(propName)) {\n        blocked = true;\n        isDefaultDesc\n          ? (objects[objectIndex][propName] = desc.value)\n          : Object.defineProperty(objects[objectIndex], propName, desc);\n      }\n      ++objectIndex;\n    }\n    if (!blocked) {\n      isDefaultDesc\n        ? (otherObject[propName] = desc.value)\n        : Object.defineProperty(otherObject, propName, desc);\n    }\n  }\n  return [...objects, otherObject];\n}\nfunction lazy(fn) {\n  let comp;\n  let p;\n  const wrap = props => {\n    const ctx = sharedConfig.context;\n    if (ctx) {\n      const [s, set] = createSignal();\n      sharedConfig.count || (sharedConfig.count = 0);\n      sharedConfig.count++;\n      (p || (p = fn())).then(mod => {\n        setHydrateContext(ctx);\n        sharedConfig.count--;\n        set(() => mod.default);\n        setHydrateContext();\n      });\n      comp = s;\n    } else if (!comp) {\n      const [s] = createResource(() => (p || (p = fn())).then(mod => mod.default));\n      comp = s;\n    }\n    let Comp;\n    return createMemo(\n      () =>\n        (Comp = comp()) &&\n        untrack(() => {\n          if (false);\n          if (!ctx) return Comp(props);\n          const c = sharedConfig.context;\n          setHydrateContext(ctx);\n          const r = Comp(props);\n          setHydrateContext(c);\n          return r;\n        })\n    );\n  };\n  wrap.preload = () => p || ((p = fn()).then(mod => (comp = () => mod.default)), p);\n  return wrap;\n}\nlet counter = 0;\nfunction createUniqueId() {\n  const ctx = sharedConfig.context;\n  return ctx ? `${ctx.id}${ctx.count++}` : `cl-${counter++}`;\n}\n\nconst narrowedError = name => `Stale read from <${name}>.`;\nfunction For(props) {\n  const fallback = \"fallback\" in props && {\n    fallback: () => props.fallback\n  };\n  return createMemo(mapArray(() => props.each, props.children, fallback || undefined));\n}\nfunction Index(props) {\n  const fallback = \"fallback\" in props && {\n    fallback: () => props.fallback\n  };\n  return createMemo(indexArray(() => props.each, props.children, fallback || undefined));\n}\nfunction Show(props) {\n  const keyed = props.keyed;\n  const condition = createMemo(() => props.when, undefined, {\n    equals: (a, b) => (keyed ? a === b : !a === !b)\n  });\n  return createMemo(\n    () => {\n      const c = condition();\n      if (c) {\n        const child = props.children;\n        const fn = typeof child === \"function\" && child.length > 0;\n        return fn\n          ? untrack(() =>\n              child(\n                keyed\n                  ? c\n                  : () => {\n                      if (!untrack(condition)) throw narrowedError(\"Show\");\n                      return props.when;\n                    }\n              )\n            )\n          : child;\n      }\n      return props.fallback;\n    },\n    undefined,\n    undefined\n  );\n}\nfunction Switch(props) {\n  let keyed = false;\n  const equals = (a, b) =>\n    a[0] === b[0] && (keyed ? a[1] === b[1] : !a[1] === !b[1]) && a[2] === b[2];\n  const conditions = children(() => props.children),\n    evalConditions = createMemo(\n      () => {\n        let conds = conditions();\n        if (!Array.isArray(conds)) conds = [conds];\n        for (let i = 0; i < conds.length; i++) {\n          const c = conds[i].when;\n          if (c) {\n            keyed = !!conds[i].keyed;\n            return [i, c, conds[i]];\n          }\n        }\n        return [-1];\n      },\n      undefined,\n      {\n        equals\n      }\n    );\n  return createMemo(\n    () => {\n      const [index, when, cond] = evalConditions();\n      if (index < 0) return props.fallback;\n      const c = cond.children;\n      const fn = typeof c === \"function\" && c.length > 0;\n      return fn\n        ? untrack(() =>\n            c(\n              keyed\n                ? when\n                : () => {\n                    if (untrack(evalConditions)[0] !== index) throw narrowedError(\"Match\");\n                    return cond.when;\n                  }\n            )\n          )\n        : c;\n    },\n    undefined,\n    undefined\n  );\n}\nfunction Match(props) {\n  return props;\n}\nlet Errors;\nfunction resetErrorBoundaries() {\n  Errors && [...Errors].forEach(fn => fn());\n}\nfunction ErrorBoundary(props) {\n  let err;\n  if (sharedConfig.context && sharedConfig.load)\n    err = sharedConfig.load(sharedConfig.context.id + sharedConfig.context.count);\n  const [errored, setErrored] = createSignal(err, undefined);\n  Errors || (Errors = new Set());\n  Errors.add(setErrored);\n  onCleanup(() => Errors.delete(setErrored));\n  return createMemo(\n    () => {\n      let e;\n      if ((e = errored())) {\n        const f = props.fallback;\n        return typeof f === \"function\" && f.length ? untrack(() => f(e, () => setErrored())) : f;\n      }\n      return catchError(() => props.children, setErrored);\n    },\n    undefined,\n    undefined\n  );\n}\n\nconst suspenseListEquals = (a, b) =>\n  a.showContent === b.showContent && a.showFallback === b.showFallback;\nconst SuspenseListContext = createContext();\nfunction SuspenseList(props) {\n  let [wrapper, setWrapper] = createSignal(() => ({\n      inFallback: false\n    })),\n    show;\n  const listContext = useContext(SuspenseListContext);\n  const [registry, setRegistry] = createSignal([]);\n  if (listContext) {\n    show = listContext.register(createMemo(() => wrapper()().inFallback));\n  }\n  const resolved = createMemo(\n    prev => {\n      const reveal = props.revealOrder,\n        tail = props.tail,\n        { showContent = true, showFallback = true } = show ? show() : {},\n        reg = registry(),\n        reverse = reveal === \"backwards\";\n      if (reveal === \"together\") {\n        const all = reg.every(inFallback => !inFallback());\n        const res = reg.map(() => ({\n          showContent: all && showContent,\n          showFallback\n        }));\n        res.inFallback = !all;\n        return res;\n      }\n      let stop = false;\n      let inFallback = prev.inFallback;\n      const res = [];\n      for (let i = 0, len = reg.length; i < len; i++) {\n        const n = reverse ? len - i - 1 : i,\n          s = reg[n]();\n        if (!stop && !s) {\n          res[n] = {\n            showContent,\n            showFallback\n          };\n        } else {\n          const next = !stop;\n          if (next) inFallback = true;\n          res[n] = {\n            showContent: next,\n            showFallback: !tail || (next && tail === \"collapsed\") ? showFallback : false\n          };\n          stop = true;\n        }\n      }\n      if (!stop) inFallback = false;\n      res.inFallback = inFallback;\n      return res;\n    },\n    {\n      inFallback: false\n    }\n  );\n  setWrapper(() => resolved);\n  return createComponent(SuspenseListContext.Provider, {\n    value: {\n      register: inFallback => {\n        let index;\n        setRegistry(registry => {\n          index = registry.length;\n          return [...registry, inFallback];\n        });\n        return createMemo(() => resolved()[index], undefined, {\n          equals: suspenseListEquals\n        });\n      }\n    },\n    get children() {\n      return props.children;\n    }\n  });\n}\nfunction Suspense(props) {\n  let counter = 0,\n    show,\n    ctx,\n    p,\n    flicker,\n    error;\n  const [inFallback, setFallback] = createSignal(false),\n    SuspenseContext = getSuspenseContext(),\n    store = {\n      increment: () => {\n        if (++counter === 1) setFallback(true);\n      },\n      decrement: () => {\n        if (--counter === 0) setFallback(false);\n      },\n      inFallback,\n      effects: [],\n      resolved: false\n    },\n    owner = getOwner();\n  if (sharedConfig.context && sharedConfig.load) {\n    const key = sharedConfig.context.id + sharedConfig.context.count;\n    let ref = sharedConfig.load(key);\n    if (ref && (typeof ref !== \"object\" || ref.status !== \"success\")) p = ref;\n    if (p && p !== \"$$f\") {\n      const [s, set] = createSignal(undefined, {\n        equals: false\n      });\n      flicker = s;\n      p.then(() => {\n        sharedConfig.gather(key);\n        setHydrateContext(ctx);\n        set();\n        setHydrateContext();\n      }).catch(err => {\n        if (err || sharedConfig.done) {\n          err && (error = err);\n          return set();\n        }\n      });\n    }\n  }\n  const listContext = useContext(SuspenseListContext);\n  if (listContext) show = listContext.register(store.inFallback);\n  let dispose;\n  onCleanup(() => dispose && dispose());\n  return createComponent(SuspenseContext.Provider, {\n    value: store,\n    get children() {\n      return createMemo(() => {\n        if (error) throw error;\n        ctx = sharedConfig.context;\n        if (flicker) {\n          flicker();\n          return (flicker = undefined);\n        }\n        if (ctx && p === \"$$f\") setHydrateContext();\n        const rendered = createMemo(() => props.children);\n        return createMemo(prev => {\n          const inFallback = store.inFallback(),\n            { showContent = true, showFallback = true } = show ? show() : {};\n          if ((!inFallback || (p && p !== \"$$f\")) && showContent) {\n            store.resolved = true;\n            dispose && dispose();\n            dispose = ctx = p = undefined;\n            resumeEffects(store.effects);\n            return rendered();\n          }\n          if (!showFallback) return;\n          if (dispose) return prev;\n          return createRoot(disposer => {\n            dispose = disposer;\n            if (ctx) {\n              setHydrateContext({\n                id: ctx.id + \"f\",\n                count: 0\n              });\n              ctx = undefined;\n            }\n            return props.fallback;\n          }, owner);\n        });\n      });\n    }\n  });\n}\n\nconst DEV = undefined;\n\nexport {\n  $DEVCOMP,\n  $PROXY,\n  $TRACK,\n  DEV,\n  ErrorBoundary,\n  For,\n  Index,\n  Match,\n  Show,\n  Suspense,\n  SuspenseList,\n  Switch,\n  batch,\n  cancelCallback,\n  catchError,\n  children,\n  createComponent,\n  createComputed,\n  createContext,\n  createDeferred,\n  createEffect,\n  createMemo,\n  createReaction,\n  createRenderEffect,\n  createResource,\n  createRoot,\n  createSelector,\n  createSignal,\n  createUniqueId,\n  enableExternalSource,\n  enableHydration,\n  enableScheduling,\n  equalFn,\n  from,\n  getListener,\n  getOwner,\n  indexArray,\n  lazy,\n  mapArray,\n  mergeProps,\n  observable,\n  on,\n  onCleanup,\n  onError,\n  onMount,\n  requestCallback,\n  resetErrorBoundaries,\n  runWithOwner,\n  sharedConfig,\n  splitProps,\n  startTransition,\n  untrack,\n  useContext,\n  useTransition\n};\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { createSignal } from 'solid-js';\nimport type { ElementNode } from './node/index.js';\nexport const [activeElement, setActiveElement] =\n  createSignal<ElementNode | null>(null);\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Texture Usage Tracker for Usage Based Texture Garbage Collection\n */\nexport class TextureUsageTracker {\n    releaseCallback;\n    constructor(releaseCallback) {\n        this.releaseCallback = releaseCallback;\n    }\n}\n//# sourceMappingURL=TextureUsageTracker.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../utils.js';\nimport { TextureUsageTracker } from './TextureUsageTracker.js';\n/**\n * Usage-based Texture Garbage Collection Registry\n */\nexport class ManualCountTextureUsageTracker extends TextureUsageTracker {\n    textureMap = new Map();\n    zeroReferenceTextureSet = new Set();\n    options;\n    constructor(releaseCallback, options) {\n        super(releaseCallback);\n        this.options = {\n            textureCleanupIntervalMs: options.textureCleanupIntervalMs ?? 10000,\n            textureCleanupAgeThreadholdMs: options.textureCleanupAgeThreadholdMs ?? 60000,\n        };\n        // Periodically check for textures that are no longer referenced by any\n        // Nodes and notify RendererMain to release them.\n        setInterval(() => {\n            const now = Date.now();\n            const thresholdMs = this.options.textureCleanupAgeThreadholdMs;\n            for (const textureRefInfo of this.zeroReferenceTextureSet) {\n                if (now - textureRefInfo.lastUpdate > thresholdMs) {\n                    this.releaseCallback(textureRefInfo.id);\n                    this.textureMap.delete(textureRefInfo.id);\n                    this.zeroReferenceTextureSet.delete(textureRefInfo);\n                }\n            }\n        }, this.options.textureCleanupIntervalMs);\n    }\n    registerTexture(texture) {\n        const textureId = texture.options?.id;\n        assertTruthy(textureId, 'Texture must have an id to be registered');\n        if (!this.textureMap.has(textureId)) {\n            const textureRefInfo = {\n                id: textureId,\n                nodeRefCount: 0,\n                lastUpdate: Date.now(),\n            };\n            this.textureMap.set(textureId, textureRefInfo);\n            this.zeroReferenceTextureSet.add(textureRefInfo);\n        }\n    }\n    incrementTextureRefCount(texture) {\n        const textureId = texture.options?.id;\n        assertTruthy(textureId, 'Texture must have an id to be registered');\n        let textureRefInfo = this.textureMap.get(textureId);\n        if (!textureRefInfo) {\n            // Texture has not been registered yet, so register it now.\n            // This may happen if the TextureRef was cleaned up from the registry\n            // but was still alive in memory and eventually re-used.\n            this.registerTexture(texture);\n            textureRefInfo = this.textureMap.get(textureId);\n        }\n        assertTruthy(textureRefInfo, 'Texture must have been registered');\n        if (texture.txType === 'SubTexture') {\n            // If this is a SubTexture, then increment the reference count of the\n            // parent texture as well.\n            this.incrementTextureRefCount(texture.props.texture);\n        }\n        textureRefInfo.nodeRefCount++;\n        textureRefInfo.lastUpdate = Date.now();\n        if (this.zeroReferenceTextureSet.has(textureRefInfo)) {\n            this.zeroReferenceTextureSet.delete(textureRefInfo);\n        }\n    }\n    decrementTextureRefCount(texture) {\n        const textureId = texture.options?.id;\n        assertTruthy(textureId, 'Texture must have an id to be registered');\n        const textureRefInfo = this.textureMap.get(textureId);\n        assertTruthy(textureRefInfo, 'Texture must have been registered');\n        textureRefInfo.nodeRefCount--;\n        textureRefInfo.lastUpdate = Date.now();\n        if (textureRefInfo.nodeRefCount === 0) {\n            this.zeroReferenceTextureSet.add(textureRefInfo);\n        }\n        if (texture.txType === 'SubTexture') {\n            // If this is a SubTexture, then decrement the reference count of the\n            // parent texture as well.\n            this.decrementTextureRefCount(texture.props.texture);\n        }\n    }\n}\n//# sourceMappingURL=ManualCountTextureUsageTracker.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../utils.js';\nimport { TextureUsageTracker } from './TextureUsageTracker.js';\nexport class FinalizationRegistryTextureUsageTracker extends TextureUsageTracker {\n    registry;\n    constructor(releaseCallback) {\n        super(releaseCallback);\n        this.registry = new FinalizationRegistry(releaseCallback);\n    }\n    registerTexture(texture) {\n        assertTruthy(texture.options?.id, 'Texture must have an ID to be registered');\n        this.registry.register(texture, texture.options?.id);\n    }\n    incrementTextureRefCount() {\n        // No-op for FinalizationRegistry\n    }\n    decrementTextureRefCount() {\n        // No-op for FinalizationRegistry\n    }\n}\n//# sourceMappingURL=FinalizationRegistryTextureUsageTracker.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ManualCountTextureUsageTracker, } from './texture-usage-trackers/ManualCountTextureUsageTracker.js';\nimport { FinalizationRegistryTextureUsageTracker } from './texture-usage-trackers/FinalizationRegistryTextureUsageTracker.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\n/**\n * The Renderer Main API\n *\n * @remarks\n * This is the primary class used to configure and operate the Renderer.\n *\n * It is used to create and destroy Nodes, as well as Texture and Shader\n * references.\n *\n * Example:\n * ```ts\n * import { RendererMain, MainCoreDriver } from '@lightningjs/renderer';\n *\n * // Initialize the Renderer\n * const renderer = new RendererMain(\n *   {\n *     appWidth: 1920,\n *     appHeight: 1080\n *   },\n *   'app',\n *   new MainCoreDriver(),\n * );\n * ```\n */\nexport class RendererMain extends EventEmitter {\n    root = null;\n    driver;\n    canvas;\n    settings;\n    nodes = new Map();\n    nextTextureId = 1;\n    /**\n     * Texture Usage Tracker for Usage Based Texture Garbage Collection\n     *\n     * @remarks\n     * For internal use only. DO NOT ACCESS.\n     */\n    textureTracker;\n    /**\n     * Constructs a new Renderer instance\n     *\n     * @param settings Renderer settings\n     * @param target Element ID or HTMLElement to insert the canvas into\n     * @param driver Core Driver to use\n     */\n    constructor(settings, target, driver) {\n        super();\n        const resolvedSettings = {\n            appWidth: settings.appWidth || 1920,\n            appHeight: settings.appHeight || 1080,\n            deviceLogicalPixelRatio: settings.deviceLogicalPixelRatio || 1,\n            devicePhysicalPixelRatio: settings.devicePhysicalPixelRatio || window.devicePixelRatio,\n            clearColor: settings.clearColor ?? 0x00000000,\n            coreExtensionModule: settings.coreExtensionModule || null,\n            experimental_FinalizationRegistryTextureUsageTracker: settings.experimental_FinalizationRegistryTextureUsageTracker ?? false,\n            textureCleanupOptions: settings.textureCleanupOptions || {},\n            fpsUpdateInterval: settings.fpsUpdateInterval || 0,\n        };\n        this.settings = resolvedSettings;\n        const { appWidth, appHeight, deviceLogicalPixelRatio, devicePhysicalPixelRatio, } = resolvedSettings;\n        const releaseCallback = (textureId) => {\n            this.driver.releaseTexture(textureId);\n        };\n        const useFinalizationRegistryTracker = resolvedSettings.experimental_FinalizationRegistryTextureUsageTracker &&\n            typeof FinalizationRegistry === 'function';\n        this.textureTracker = useFinalizationRegistryTracker\n            ? new FinalizationRegistryTextureUsageTracker(releaseCallback)\n            : new ManualCountTextureUsageTracker(releaseCallback, this.settings.textureCleanupOptions);\n        const deviceLogicalWidth = appWidth * deviceLogicalPixelRatio;\n        const deviceLogicalHeight = appHeight * deviceLogicalPixelRatio;\n        this.driver = driver;\n        const canvas = document.createElement('canvas');\n        this.canvas = canvas;\n        canvas.width = deviceLogicalWidth * devicePhysicalPixelRatio;\n        canvas.height = deviceLogicalHeight * devicePhysicalPixelRatio;\n        canvas.style.width = `${deviceLogicalWidth}px`;\n        canvas.style.height = `${deviceLogicalHeight}px`;\n        let targetEl;\n        if (typeof target === 'string') {\n            targetEl = document.getElementById(target);\n        }\n        else {\n            targetEl = target;\n        }\n        if (!targetEl) {\n            throw new Error('Could not find target element');\n        }\n        // Hook up the driver's callbacks\n        driver.onCreateNode = (node) => {\n            this.nodes.set(node.id, node);\n        };\n        driver.onBeforeDestroyNode = (node) => {\n            this.nodes.delete(node.id);\n        };\n        driver.onFpsUpdate = (fps) => {\n            this.emit('fpsUpdate', fps);\n        };\n        targetEl.appendChild(canvas);\n    }\n    /**\n     * Initialize the renderer\n     *\n     * @remarks\n     * This method must be called and resolved asyncronously before any other\n     * methods are called.\n     */\n    async init() {\n        await this.driver.init(this, this.settings, this.canvas);\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n        this.root = this.driver.getRootNode();\n    }\n    /**\n     * Create a new scene graph node\n     *\n     * @remarks\n     * A node is the main graphical building block of the Renderer scene graph. It\n     * can be a container for other nodes, or it can be a leaf node that renders a\n     * solid color, gradient, image, or specific texture, using a specific shader.\n     *\n     * To create a text node, see {@link createTextNode}.\n     *\n     * See {@link INode} for more details.\n     *\n     * @param props\n     * @returns\n     */\n    createNode(props) {\n        return this.driver.createNode(this.resolveNodeDefaults(props));\n    }\n    /**\n     * Create a new scene graph text node\n     *\n     * @remarks\n     * A text node is the second graphical building block of the Renderer scene\n     * graph. It renders text using a specific text renderer that is automatically\n     * chosen based on the font requested and what type of fonts are installed\n     * into an app via a CoreExtension.\n     *\n     * See {@link ITextNode} for more details.\n     *\n     * @param props\n     * @returns\n     */\n    createTextNode(props) {\n        return this.driver.createTextNode({\n            ...this.resolveNodeDefaults(props),\n            text: props.text ?? '',\n            textRendererOverride: props.textRendererOverride ?? null,\n            fontSize: props.fontSize ?? 16,\n            fontFamily: props.fontFamily ?? 'sans-serif',\n            fontStyle: props.fontStyle ?? 'normal',\n            fontWeight: props.fontWeight ?? 'normal',\n            fontStretch: props.fontStretch ?? 'normal',\n            textAlign: props.textAlign ?? 'left',\n            contain: props.contain ?? 'none',\n            scrollable: props.scrollable ?? false,\n            scrollY: props.scrollY ?? 0,\n            offsetY: props.offsetY ?? 0,\n            letterSpacing: props.letterSpacing ?? 0,\n            debug: props.debug ?? {},\n        });\n    }\n    /**\n     * Resolves the default property values for a Node\n     *\n     * @remarks\n     * This method is used internally by the RendererMain to resolve the default\n     * property values for a Node. It is exposed publicly so that it can be used\n     * by Core Driver implementations.\n     *\n     * @param props\n     * @returns\n     */\n    resolveNodeDefaults(props) {\n        const color = props.color ?? 0xffffffff;\n        const colorTl = props.colorTl ?? props.colorTop ?? props.colorLeft ?? color;\n        const colorTr = props.colorTr ?? props.colorTop ?? props.colorRight ?? color;\n        const colorBl = props.colorBl ?? props.colorBottom ?? props.colorLeft ?? color;\n        const colorBr = props.colorBr ?? props.colorBottom ?? props.colorRight ?? color;\n        return {\n            x: props.x ?? 0,\n            y: props.y ?? 0,\n            width: props.width ?? 0,\n            height: props.height ?? 0,\n            alpha: props.alpha ?? 1,\n            clipping: props.clipping ?? false,\n            color,\n            colorTop: props.colorTop ?? color,\n            colorBottom: props.colorBottom ?? color,\n            colorLeft: props.colorLeft ?? color,\n            colorRight: props.colorRight ?? color,\n            colorBl,\n            colorBr,\n            colorTl,\n            colorTr,\n            zIndex: props.zIndex ?? 0,\n            zIndexLocked: props.zIndexLocked ?? 0,\n            parent: props.parent ?? null,\n            texture: props.texture ?? null,\n            shader: props.shader ?? null,\n            // Since setting the `src` will trigger a texture load, we need to set it after\n            // we set the texture. Otherwise, problems happen.\n            src: props.src ?? '',\n            scale: props.scale ?? null,\n            scaleX: props.scaleX ?? props.scale ?? 1,\n            scaleY: props.scaleY ?? props.scale ?? 1,\n            mount: props.mount ?? 0,\n            mountX: props.mountX ?? props.mount ?? 0,\n            mountY: props.mountY ?? props.mount ?? 0,\n            pivot: props.pivot ?? 0.5,\n            pivotX: props.pivotX ?? props.pivot ?? 0.5,\n            pivotY: props.pivotY ?? props.pivot ?? 0.5,\n            rotation: props.rotation ?? 0,\n        };\n    }\n    /**\n     * Destroy a node\n     *\n     * @remarks\n     * This method destroys a node but does not destroy its children.\n     *\n     * @param node\n     * @returns\n     */\n    destroyNode(node) {\n        return this.driver.destroyNode(node);\n    }\n    /**\n     * Create a new texture reference\n     *\n     * @remarks\n     * This method creates a new reference to a texture. The texture is not\n     * loaded until it is used on a node.\n     *\n     * It can be assigned to a node's `texture` property, or it can be used\n     * when creating a SubTexture.\n     *\n     * @param textureType\n     * @param props\n     * @param options\n     * @returns\n     */\n    createTexture(textureType, props, options) {\n        const id = this.nextTextureId++;\n        const desc = {\n            descType: 'texture',\n            txType: textureType,\n            props,\n            options: {\n                ...options,\n                // This ID is used to identify the texture in the CoreTextureManager's\n                // ID Texture Map cache.\n                id,\n            },\n        };\n        this.textureTracker.registerTexture(desc);\n        return desc;\n    }\n    /**\n     * Create a new shader reference\n     *\n     * @remarks\n     * This method creates a new reference to a shader. The shader is not\n     * loaded until it is used on a Node.\n     *\n     * It can be assigned to a Node's `shader` property.\n     *\n     * @param shaderType\n     * @param props\n     * @returns\n     */\n    createShader(shaderType, props) {\n        return {\n            descType: 'shader',\n            shType: shaderType,\n            props: props,\n        };\n    }\n    /**\n     * Get a Node by its ID\n     *\n     * @param id\n     * @returns\n     */\n    getNodeById(id) {\n        return this.nodes.get(id) || null;\n    }\n    toggleFreeze() {\n        throw new Error('Not implemented');\n    }\n    advanceFrame() {\n        throw new Error('Not implemented');\n    }\n    /**\n     * Re-render the current frame without advancing any running animations.\n     *\n     * @remarks\n     * Any state changes will be reflected in the re-rendered frame. Useful for\n     * debugging.\n     *\n     * May not do anything if the render loop is running on a separate worker.\n     */\n    rerender() {\n        throw new Error('Not implemented');\n    }\n}\n//# sourceMappingURL=RendererMain.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getTimingFunction } from '../utils.js';\nimport { mergeColorProgress } from '../../utils.js';\nimport { EventEmitter } from '../../common/EventEmitter.js';\nexport class CoreAnimation extends EventEmitter {\n    node;\n    props;\n    settings;\n    propStartValues = {};\n    restoreValues = {};\n    progress = 0;\n    timingFunction;\n    propsList; //fixme - aint got not time for this\n    constructor(node, props, settings) {\n        super();\n        this.node = node;\n        this.props = props;\n        this.settings = settings;\n        this.propStartValues = {};\n        this.propsList = Object.keys(props);\n        this.propsList.forEach((propName) => {\n            this.propStartValues[propName] = node[propName];\n        });\n        this.timingFunction = (t) => t;\n        if (settings.easing && typeof settings.easing === 'string') {\n            this.timingFunction = getTimingFunction(settings.easing);\n        }\n    }\n    reset() {\n        this.progress = 0;\n        this.update(0);\n    }\n    restore() {\n        this.reset();\n        Object.keys(this.props).forEach((propName) => {\n            this.node[propName] = this.propStartValues[propName];\n        });\n    }\n    reverse() {\n        this.progress = 0;\n        Object.keys(this.props).forEach((propName) => {\n            // set the start value to the current value\n            const startValue = this.props[propName];\n            const endValue = this.propStartValues[propName];\n            // swap the start and end values\n            this.props[propName] = endValue;\n            this.propStartValues[propName] = startValue;\n        });\n        // restore stop method if we are not looping\n        if (!this.settings.loop) {\n            this.settings.stopMethod = false;\n        }\n    }\n    applyEasing(p, s, e) {\n        return (this.timingFunction(p) || p) * (e - s) + s;\n    }\n    update(dt) {\n        const { duration, loop, easing, stopMethod } = this.settings;\n        if (!duration) {\n            this.emit('finished', {});\n            return;\n        }\n        this.progress += dt / duration;\n        if (this.progress > 1) {\n            this.progress = loop ? 0 : 1;\n            if (stopMethod) {\n                // If there's a stop method emit finished so the stop method can be applied.\n                // TODO: We should probably reevaluate how stopMethod is implemented as currently\n                // stop method 'reset' does not work when looping.\n                this.emit('finished', {});\n                return;\n            }\n        }\n        for (let i = 0; i < this.propsList.length; i++) {\n            const propName = this.propsList[i];\n            const propValue = this.props[propName];\n            const startValue = this.propStartValues[propName];\n            const endValue = propValue;\n            if (propName.indexOf('color') !== -1) {\n                // check if we have to change the color to begin with\n                if (startValue === endValue) {\n                    this.node[propName] = startValue;\n                    continue;\n                }\n                if (easing) {\n                    const easingProgressValue = this.timingFunction(this.progress) || this.progress;\n                    const easingColorValue = mergeColorProgress(startValue, endValue, easingProgressValue);\n                    this.node[propName] = easingColorValue;\n                    continue;\n                }\n                this.node[propName] = mergeColorProgress(startValue, endValue, this.progress);\n                continue;\n            }\n            if (easing) {\n                this.node[propName] = this.applyEasing(this.progress, startValue, endValue);\n                continue;\n            }\n            this.node[propName] =\n                startValue + (endValue - startValue) * this.progress;\n        }\n        if (this.progress === 1) {\n            this.emit('finished', {});\n        }\n    }\n}\n//# sourceMappingURL=CoreAnimation.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../utils.js';\nexport class CoreAnimationController {\n    manager;\n    animation;\n    stoppedPromise = null;\n    /**\n     * If this is null, then the animation is in a finished / stopped state.\n     */\n    stoppedResolve = null;\n    constructor(manager, animation) {\n        this.manager = manager;\n        this.animation = animation;\n        this.state = 'stopped';\n    }\n    state;\n    start() {\n        this.makeStoppedPromise();\n        this.animation.once('finished', this.finished.bind(this));\n        // prevent registering the same animation twice\n        if (!this.manager.activeAnimations.has(this.animation)) {\n            this.manager.registerAnimation(this.animation);\n        }\n        this.state = 'running';\n        return this;\n    }\n    stop() {\n        this.manager.unregisterAnimation(this.animation);\n        if (this.stoppedResolve !== null) {\n            this.stoppedResolve();\n            this.stoppedResolve = null;\n        }\n        this.animation.reset();\n        this.state = 'stopped';\n        return this;\n    }\n    pause() {\n        this.manager.unregisterAnimation(this.animation);\n        this.state = 'paused';\n        return this;\n    }\n    restore() {\n        this.stoppedResolve = null;\n        this.animation.restore();\n        return this;\n    }\n    waitUntilStopped() {\n        this.makeStoppedPromise();\n        const promise = this.stoppedPromise;\n        assertTruthy(promise);\n        return promise;\n    }\n    makeStoppedPromise() {\n        if (this.stoppedResolve === null) {\n            this.stoppedPromise = new Promise((resolve) => {\n                this.stoppedResolve = resolve;\n            });\n        }\n    }\n    finished() {\n        assertTruthy(this.stoppedResolve);\n        // If the animation is looping, then we need to restart it.\n        const { loop, stopMethod } = this.animation.settings;\n        if (stopMethod === 'reverse') {\n            this.animation.reverse();\n            this.start();\n            return;\n        }\n        // resolve promise\n        this.stoppedResolve();\n        this.stoppedResolve = null;\n        if (loop) {\n            return;\n        }\n        // unregister animation\n        this.manager.unregisterAnimation(this.animation);\n    }\n}\n//# sourceMappingURL=CoreAnimationController.js.map","/* eslint-disable @typescript-eslint/no-non-null-assertion */\n// Matrix3d is a 3x3 matrix in column-major order because that's how WebGL likes it.\n// The matrix is stored in a Float32Array in the following order:\n// | 0 3 6 |\n// | 1 4 7 |\n// | 2 5 8 |\n// The following constants are used to index into the array in a row-major way.\nconst m0 = 0;\nconst m1 = 3;\nconst m2 = 6;\nconst m3 = 1;\nconst m4 = 4;\nconst m5 = 7;\nconst m6 = 2;\nconst m7 = 5;\nconst m8 = 8;\n/**\n * A 3x3 matrix representing a 2D transformation.\n *\n * @remarks\n * The matrix is stored in column-major order in the `data` property which can\n * be passed directly to a WebGL shader uniform.\n *\n * The matrix is stored in a Float32Array in the following index order:\n * | 0 3 6 |\n * | 1 4 7 |\n * | 2 5 8 |\n *\n * Only the first two rows are really used for the transformation. The last row is\n * generally always `[0, 0, 1]` if you only use the 2D transformation methods\n * provided by this class.\n *\n * For convenience, entries in the first two rows can be accessed by the following\n * getter properties:\n * | ta tb tx |\n * | tc td ty |\n * | 0  0  1  |\n */\nexport class Matrix3d {\n    data;\n    /**\n     * Creates a new 3x3 matrix.\n     *\n     * @param entries Row-major 3x3 matrix\n     */\n    constructor(entries) {\n        if (entries) {\n            // Transpose the input matrix so that it's in column-major order.\n            this.data = new Float32Array(9);\n            this.data[m0] = entries[0];\n            this.data[m1] = entries[3];\n            this.data[m2] = entries[6];\n            this.data[m3] = entries[1];\n            this.data[m4] = entries[4];\n            this.data[m5] = entries[7];\n            this.data[m6] = entries[2];\n            this.data[m7] = entries[5];\n            this.data[m8] = entries[8];\n        }\n        else {\n            this.data = new Float32Array(9);\n        }\n    }\n    /**\n     * Returns a temporary matrix that can be used for calculations.\n     *\n     * @remarks\n     * This is useful for avoiding allocations in tight loops.\n     *\n     * The matrix is not guaranteed to be the same between calls.\n     *\n     * @returns\n     */\n    static get temp() {\n        return tempMatrix;\n    }\n    static multiply(a, b, out) {\n        const e0 = a.data[m0] * b.data[m0] +\n            a.data[m1] * b.data[m3] +\n            a.data[m2] * b.data[m6];\n        const e1 = a.data[m0] * b.data[m1] +\n            a.data[m1] * b.data[m4] +\n            a.data[m2] * b.data[m7];\n        const e2 = a.data[m0] * b.data[m2] +\n            a.data[m1] * b.data[m5] +\n            a.data[m2] * b.data[m8];\n        const e3 = a.data[m3] * b.data[m0] +\n            a.data[m4] * b.data[m3] +\n            a.data[m5] * b.data[m6];\n        const e4 = a.data[m3] * b.data[m1] +\n            a.data[m4] * b.data[m4] +\n            a.data[m5] * b.data[m7];\n        const e5 = a.data[m3] * b.data[m2] +\n            a.data[m4] * b.data[m5] +\n            a.data[m5] * b.data[m8];\n        const e6 = a.data[m6] * b.data[m0] +\n            a.data[m7] * b.data[m3] +\n            a.data[m8] * b.data[m6];\n        const e7 = a.data[m6] * b.data[m1] +\n            a.data[m7] * b.data[m4] +\n            a.data[m8] * b.data[m7];\n        const e8 = a.data[m6] * b.data[m2] +\n            a.data[m7] * b.data[m5] +\n            a.data[m8] * b.data[m8];\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.data[m0] = e0;\n        out.data[m1] = e1;\n        out.data[m2] = e2;\n        out.data[m3] = e3;\n        out.data[m4] = e4;\n        out.data[m5] = e5;\n        out.data[m6] = e6;\n        out.data[m7] = e7;\n        out.data[m8] = e8;\n        return out;\n    }\n    static identity(out) {\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.data[m0] = 1;\n        out.data[m1] = 0;\n        out.data[m2] = 0;\n        out.data[m3] = 0;\n        out.data[m4] = 1;\n        out.data[m5] = 0;\n        out.data[m6] = 0;\n        out.data[m7] = 0;\n        out.data[m8] = 1;\n        return out;\n    }\n    static translate(x, y, out) {\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.data[m0] = 1;\n        out.data[m1] = 0;\n        out.data[m2] = x;\n        out.data[m3] = 0;\n        out.data[m4] = 1;\n        out.data[m5] = y;\n        out.data[m6] = 0;\n        out.data[m7] = 0;\n        out.data[m8] = 1;\n        return out;\n    }\n    static scale(sx, sy, out) {\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.data[m0] = sx;\n        out.data[m1] = 0;\n        out.data[m2] = 0;\n        out.data[m3] = 0;\n        out.data[m4] = sy;\n        out.data[m5] = 0;\n        out.data[m6] = 0;\n        out.data[m7] = 0;\n        out.data[m8] = 1;\n        return out;\n    }\n    static rotate(angle, out) {\n        const cos = Math.cos(angle);\n        const sin = Math.sin(angle);\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.data[m0] = cos;\n        out.data[m1] = -sin;\n        out.data[m2] = 0;\n        out.data[m3] = sin;\n        out.data[m4] = cos;\n        out.data[m5] = 0;\n        out.data[m6] = 0;\n        out.data[m7] = 0;\n        out.data[m8] = 1;\n        return out;\n    }\n    static copy(src, dst, transpose) {\n        if (!dst) {\n            dst = new Matrix3d();\n        }\n        dst.data[0] = src.data[0];\n        dst.data[1] = src.data[1];\n        dst.data[2] = src.data[2];\n        dst.data[3] = src.data[3];\n        dst.data[4] = src.data[4];\n        dst.data[5] = src.data[5];\n        dst.data[6] = src.data[6];\n        dst.data[7] = src.data[7];\n        dst.data[8] = src.data[8];\n        return dst;\n    }\n    translate(x, y) {\n        this.data[m2] = this.data[m0] * x + this.data[m1] * y + this.data[m2];\n        this.data[m5] = this.data[m3] * x + this.data[m4] * y + this.data[m5];\n        return this;\n    }\n    scale(sx, sy) {\n        this.data[m0] = this.data[m0] * sx;\n        this.data[m1] = this.data[m1] * sy;\n        this.data[m3] = this.data[m3] * sx;\n        this.data[m4] = this.data[m4] * sy;\n        return this;\n    }\n    rotate(angle) {\n        if (angle === 0 || !((angle % Math.PI) * 2)) {\n            return this;\n        }\n        const cos = Math.cos(angle);\n        const sin = Math.sin(angle);\n        const e0 = this.data[m0] * cos + this.data[m1] * sin;\n        const e1 = this.data[m1] * cos - this.data[m0] * sin;\n        const e3 = this.data[m3] * cos + this.data[m4] * sin;\n        const e4 = this.data[m4] * cos - this.data[m3] * sin;\n        this.data[m0] = e0;\n        this.data[m1] = e1;\n        this.data[m3] = e3;\n        this.data[m4] = e4;\n        return this;\n    }\n    multiply(other) {\n        return Matrix3d.multiply(this, other, this);\n    }\n    get tx() {\n        return this.data[m2];\n    }\n    get ty() {\n        return this.data[m5];\n    }\n    get ta() {\n        return this.data[m0];\n    }\n    get tb() {\n        return this.data[m1];\n    }\n    get tc() {\n        return this.data[m3];\n    }\n    get td() {\n        return this.data[m4];\n    }\n    transformPoint(x, y) {\n        return [\n            this.data[m0] * x + this.data[m1] * y + this.data[m2],\n            this.data[m3] * x + this.data[m4] * y + this.data[m3],\n        ];\n    }\n}\nconst tempMatrix = new Matrix3d();\n//# sourceMappingURL=Matrix3d.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy, mergeColorAlphaPremultiplied } from '../utils.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport { getNormalizedAlphaComponent, intersectRect, } from './lib/utils.js';\nimport { Matrix3d } from './lib/Matrix3d.js';\nvar UpdateType;\n(function (UpdateType) {\n    /**\n     * Child updates\n     */\n    UpdateType[UpdateType[\"Children\"] = 1] = \"Children\";\n    /**\n     * Scale/Rotate transform update\n     */\n    UpdateType[UpdateType[\"ScaleRotate\"] = 2] = \"ScaleRotate\";\n    /**\n     * Translate transform update (x/y/width/height/pivot/mount)\n     */\n    UpdateType[UpdateType[\"Local\"] = 4] = \"Local\";\n    /**\n     * Global transform update\n     */\n    UpdateType[UpdateType[\"Global\"] = 8] = \"Global\";\n    /**\n     * Clipping rect update\n     */\n    UpdateType[UpdateType[\"Clipping\"] = 16] = \"Clipping\";\n    /**\n     * Calculated ZIndex update\n     */\n    UpdateType[UpdateType[\"CalculatedZIndex\"] = 32] = \"CalculatedZIndex\";\n    /**\n     * Z-Index Sorted Children update\n     */\n    UpdateType[UpdateType[\"ZIndexSortedChildren\"] = 64] = \"ZIndexSortedChildren\";\n    /**\n     * Premultiplied Colors\n     */\n    UpdateType[UpdateType[\"PremultipliedColors\"] = 128] = \"PremultipliedColors\";\n    /**\n     * World Alpha\n     *\n     * @remarks\n     * World Alpha = Parent World Alpha * Alpha\n     */\n    UpdateType[UpdateType[\"WorldAlpha\"] = 256] = \"WorldAlpha\";\n    /**\n     * None\n     */\n    UpdateType[UpdateType[\"None\"] = 0] = \"None\";\n    /**\n     * All\n     */\n    UpdateType[UpdateType[\"All\"] = 511] = \"All\";\n})(UpdateType || (UpdateType = {}));\nexport class CoreNode extends EventEmitter {\n    stage;\n    children = [];\n    props;\n    updateType = UpdateType.All;\n    globalTransform;\n    scaleRotateTransform;\n    localTransform;\n    clippingRect = null;\n    isRenderable = false;\n    parentClippingRect = null;\n    worldAlpha = 1;\n    premultipliedColorTl = 0;\n    premultipliedColorTr = 0;\n    premultipliedColorBl = 0;\n    premultipliedColorBr = 0;\n    calcZIndex = 0;\n    isComplex = false;\n    constructor(stage, props) {\n        super();\n        this.stage = stage;\n        this.props = {\n            ...props,\n            parent: null,\n        };\n        // Allow for parent to be processed appropriately\n        this.parent = props.parent;\n        this.updateScaleRotateTransform();\n    }\n    //#region Textures\n    loadTexture(textureType, props, options = null) {\n        // First unload any existing texture\n        if (this.props.texture) {\n            this.unloadTexture();\n        }\n        const { txManager } = this.stage;\n        const texture = txManager.loadTexture(textureType, props, options);\n        this.props.texture = texture;\n        this.props.textureOptions = options;\n        this.checkIsRenderable();\n        // If texture is already loaded / failed, trigger loaded event manually\n        // so that users get a consistent event experience.\n        // We do this in a microtask to allow listeners to be attached in the same\n        // synchronous task after calling loadTexture()\n        queueMicrotask(() => {\n            if (texture.state === 'loaded') {\n                this.onTextureLoaded(texture, texture.dimensions);\n            }\n            else if (texture.state === 'failed') {\n                this.onTextureFailed(texture, texture.error);\n            }\n            texture.on('loaded', this.onTextureLoaded);\n            texture.on('failed', this.onTextureFailed);\n        });\n    }\n    unloadTexture() {\n        if (this.props.texture) {\n            this.props.texture.off('loaded', this.onTextureLoaded);\n            this.props.texture.off('failed', this.onTextureFailed);\n        }\n        this.props.texture = null;\n        this.props.textureOptions = null;\n        this.checkIsRenderable();\n    }\n    onTextureLoaded = (target, dimensions) => {\n        // Texture was loaded. In case the RAF loop has already stopped, we request\n        // a render to ensure the texture is rendered.\n        this.stage.requestRender();\n        this.emit('loaded', {\n            type: 'texture',\n            dimensions,\n        });\n    };\n    onTextureFailed = (target, error) => {\n        this.emit('failed', {\n            type: 'texture',\n            error,\n        });\n    };\n    //#endregion Textures\n    loadShader(shaderType, props) {\n        const shManager = this.stage.renderer.getShaderManager();\n        assertTruthy(shManager);\n        const { shader, props: p } = shManager.loadShader(shaderType, props);\n        this.props.shader = shader;\n        this.props.shaderProps = p;\n        this.checkIsRenderable();\n    }\n    /**\n     * Change types types is used to determine the scope of the changes being applied\n     *\n     * @remarks\n     * See {@link UpdateType} for more information on each type\n     *\n     * @param type\n     */\n    setUpdateType(type) {\n        this.updateType |= type;\n        // If we're updating this node at all, we need to inform the parent\n        // (and all ancestors) that their children need updating as well\n        const parent = this.props.parent;\n        if (parent && !(parent.updateType & UpdateType.Children)) {\n            parent.setUpdateType(UpdateType.Children);\n        }\n    }\n    sortChildren() {\n        this.children.sort((a, b) => a.calcZIndex - b.calcZIndex);\n    }\n    updateScaleRotateTransform() {\n        this.scaleRotateTransform = Matrix3d.rotate(this.props.rotation, this.scaleRotateTransform).scale(this.props.scaleX, this.props.scaleY);\n    }\n    updateLocalTransform() {\n        assertTruthy(this.scaleRotateTransform);\n        const pivotTranslateX = this.props.pivotX * this.props.width;\n        const pivotTranslateY = this.props.pivotY * this.props.height;\n        const mountTranslateX = this.props.mountX * this.props.width;\n        const mountTranslateY = this.props.mountY * this.props.height;\n        this.localTransform = Matrix3d.translate(pivotTranslateX - mountTranslateX + this.props.x, pivotTranslateY - mountTranslateY + this.props.y, this.localTransform)\n            .multiply(this.scaleRotateTransform)\n            .translate(-pivotTranslateX, -pivotTranslateY);\n        this.setUpdateType(UpdateType.Global);\n    }\n    /**\n     * @todo: test for correct calculation flag\n     * @param delta\n     */\n    update(delta, parentClippingRect = null) {\n        if (this.updateType & UpdateType.ScaleRotate) {\n            this.updateScaleRotateTransform();\n            this.setUpdateType(UpdateType.Local);\n        }\n        if (this.updateType & UpdateType.Local) {\n            this.updateLocalTransform();\n            this.setUpdateType(UpdateType.Global);\n        }\n        const parent = this.props.parent;\n        let childUpdateType = UpdateType.None;\n        if (this.updateType & UpdateType.Global) {\n            assertTruthy(this.localTransform);\n            this.globalTransform = Matrix3d.copy(parent?.globalTransform || this.localTransform, this.globalTransform);\n            if (parent) {\n                this.globalTransform.multiply(this.localTransform);\n            }\n            this.setUpdateType(UpdateType.Clipping | UpdateType.Children);\n            childUpdateType |= UpdateType.Global;\n        }\n        if (this.updateType & UpdateType.Clipping) {\n            this.calculateClippingRect(parentClippingRect);\n            this.checkIsRenderable();\n            this.setUpdateType(UpdateType.Children);\n            childUpdateType |= UpdateType.Clipping;\n        }\n        if (this.updateType & UpdateType.WorldAlpha) {\n            if (parent) {\n                this.worldAlpha = parent.worldAlpha * this.props.alpha;\n            }\n            else {\n                this.worldAlpha = this.props.alpha;\n            }\n            this.setUpdateType(UpdateType.Children | UpdateType.PremultipliedColors);\n            childUpdateType |= UpdateType.WorldAlpha;\n        }\n        if (this.updateType & UpdateType.PremultipliedColors) {\n            this.premultipliedColorTl = mergeColorAlphaPremultiplied(this.props.colorTl, this.worldAlpha, true);\n            this.premultipliedColorTr = mergeColorAlphaPremultiplied(this.props.colorTr, this.worldAlpha, true);\n            this.premultipliedColorBl = mergeColorAlphaPremultiplied(this.props.colorBl, this.worldAlpha, true);\n            this.premultipliedColorBr = mergeColorAlphaPremultiplied(this.props.colorBr, this.worldAlpha, true);\n            this.checkIsRenderable();\n            this.setUpdateType(UpdateType.Children);\n            childUpdateType |= UpdateType.PremultipliedColors;\n        }\n        // No need to update zIndex if there is no parent\n        if (parent && this.updateType & UpdateType.CalculatedZIndex) {\n            this.calculateZIndex();\n            // Tell parent to re-sort children\n            parent.setUpdateType(UpdateType.ZIndexSortedChildren);\n        }\n        if (this.updateType & UpdateType.Children && this.children.length) {\n            this.children.forEach((child) => {\n                // Trigger the depenedent update types on the child\n                child.setUpdateType(childUpdateType);\n                // If child has no updates, skip\n                if (child.updateType === 0) {\n                    return;\n                }\n                child.update(delta, this.clippingRect);\n            });\n        }\n        // Sorting children MUST happen after children have been updated so\n        // that they have the oppotunity to update their calculated zIndex.\n        if (this.updateType & UpdateType.ZIndexSortedChildren) {\n            // reorder z-index\n            this.sortChildren();\n        }\n        // reset update type\n        this.updateType = 0;\n    }\n    // This function checks if the current node is renderable based on certain properties.\n    // It returns true if any of the specified properties are truthy or if any color property is not 0, otherwise it returns false.\n    checkIsRenderable() {\n        if (this.props.texture) {\n            return (this.isRenderable = true);\n        }\n        if (this.props.shader) {\n            return (this.isRenderable = true);\n        }\n        if (this.props.clipping) {\n            return (this.isRenderable = true);\n        }\n        const colors = [\n            'color',\n            'colorTop',\n            'colorBottom',\n            'colorLeft',\n            'colorRight',\n            'colorTl',\n            'colorTr',\n            'colorBl',\n            'colorBr',\n        ];\n        if (colors.some((color) => this.props[color] !== 0)) {\n            return (this.isRenderable = true);\n        }\n        return (this.isRenderable = false);\n    }\n    /**\n     * This function calculates the clipping rectangle for a node.\n     *\n     * If the parent clipping rectangle has not changed and the node's clipping rectangle is already set, the function returns immediately.\n     *\n     * The function then checks if the node is rotated. If the node requires clipping and is not rotated, a new clipping rectangle is created based on the node's global transform and dimensions.\n     * If a parent clipping rectangle exists, it is intersected with the node's clipping rectangle (if it exists), or replaces the node's clipping rectangle.\n     *\n     * Finally, the node's parentClippingRect and clippingRect properties are updated.\n     */\n    calculateClippingRect(parentClippingRect = null) {\n        assertTruthy(this.globalTransform);\n        if (this.parentClippingRect === parentClippingRect && this.clippingRect) {\n            return;\n        }\n        const gt = this.globalTransform;\n        const isRotated = gt.tb !== 0 || gt.tc !== 0;\n        let clippingRect = this.props.clipping && !isRotated\n            ? {\n                x: gt.tx,\n                y: gt.ty,\n                width: this.width * gt.ta,\n                height: this.height * gt.td,\n            }\n            : null;\n        if (parentClippingRect && clippingRect) {\n            clippingRect = intersectRect(parentClippingRect, clippingRect);\n        }\n        else if (parentClippingRect) {\n            clippingRect = parentClippingRect;\n        }\n        this.parentClippingRect = parentClippingRect;\n        this.clippingRect = clippingRect;\n    }\n    calculateZIndex() {\n        const props = this.props;\n        const z = props.zIndex || 0;\n        const p = props.parent?.zIndex || 0;\n        let zIndex = z;\n        if (props.parent?.zIndexLocked) {\n            zIndex = z < p ? z : p;\n        }\n        this.calcZIndex = zIndex;\n    }\n    renderQuads(renderer) {\n        const { width, height, texture, textureOptions, shader, shaderProps } = this.props;\n        const { premultipliedColorTl, premultipliedColorTr, premultipliedColorBl, premultipliedColorBr, } = this;\n        const { zIndex, worldAlpha, globalTransform: gt, clippingRect } = this;\n        assertTruthy(gt);\n        // add to list of renderables to be sorted before rendering\n        renderer.addQuad({\n            width,\n            height,\n            colorTl: premultipliedColorTl,\n            colorTr: premultipliedColorTr,\n            colorBl: premultipliedColorBl,\n            colorBr: premultipliedColorBr,\n            texture,\n            textureOptions,\n            zIndex,\n            shader,\n            shaderProps,\n            alpha: worldAlpha,\n            clippingRect,\n            tx: gt.tx,\n            ty: gt.ty,\n            ta: gt.ta,\n            tb: gt.tb,\n            tc: gt.tc,\n            td: gt.td,\n        });\n        // Calculate absolute X and Y based on all ancestors\n        // renderer.addQuad(absX, absY, w, h, color, texture, textureOptions, zIndex);\n    }\n    //#region Properties\n    get id() {\n        return this.props.id;\n    }\n    get x() {\n        return this.props.x;\n    }\n    set x(value) {\n        if (this.props.x !== value) {\n            this.props.x = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get absX() {\n        return (this.props.x +\n            (this.props.parent?.absX || this.props.parent?.globalTransform?.tx || 0));\n    }\n    get absY() {\n        return this.props.y + (this.props.parent?.absY ?? 0);\n    }\n    get y() {\n        return this.props.y;\n    }\n    set y(value) {\n        if (this.props.y !== value) {\n            this.props.y = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get width() {\n        return this.props.width;\n    }\n    set width(value) {\n        if (this.props.width !== value) {\n            this.props.width = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get height() {\n        return this.props.height;\n    }\n    set height(value) {\n        if (this.props.height !== value) {\n            this.props.height = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get scale() {\n        // The CoreNode `scale` property is only used by Animations.\n        // Unlike INode, `null` should never be possibility for Animations.\n        return this.scaleX;\n    }\n    set scale(value) {\n        // The CoreNode `scale` property is only used by Animations.\n        // Unlike INode, `null` should never be possibility for Animations.\n        this.scaleX = value;\n        this.scaleY = value;\n    }\n    get scaleX() {\n        return this.props.scaleX;\n    }\n    set scaleX(value) {\n        if (this.props.scaleX !== value) {\n            this.props.scaleX = value;\n            this.setUpdateType(UpdateType.ScaleRotate);\n        }\n    }\n    get scaleY() {\n        return this.props.scaleY;\n    }\n    set scaleY(value) {\n        if (this.props.scaleY !== value) {\n            this.props.scaleY = value;\n            this.setUpdateType(UpdateType.ScaleRotate);\n        }\n    }\n    get mount() {\n        return this.props.mount;\n    }\n    set mount(value) {\n        if (this.props.mountX !== value || this.props.mountY !== value) {\n            this.props.mountX = value;\n            this.props.mountY = value;\n            this.props.mount = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get mountX() {\n        return this.props.mountX;\n    }\n    set mountX(value) {\n        if (this.props.mountX !== value) {\n            this.props.mountX = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get mountY() {\n        return this.props.mountY;\n    }\n    set mountY(value) {\n        if (this.props.mountY !== value) {\n            this.props.mountY = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get pivot() {\n        return this.props.pivot;\n    }\n    set pivot(value) {\n        if (this.props.pivotX !== value || this.props.pivotY !== value) {\n            this.props.pivotX = value;\n            this.props.pivotY = value;\n            this.props.pivot = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get pivotX() {\n        return this.props.pivotX;\n    }\n    set pivotX(value) {\n        if (this.props.pivotX !== value) {\n            this.props.pivotX = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get pivotY() {\n        return this.props.pivotY;\n    }\n    set pivotY(value) {\n        if (this.props.pivotY !== value) {\n            this.props.pivotY = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get rotation() {\n        return this.props.rotation;\n    }\n    set rotation(value) {\n        if (this.props.rotation !== value) {\n            this.props.rotation = value;\n            this.setUpdateType(UpdateType.ScaleRotate);\n        }\n    }\n    get alpha() {\n        return this.props.alpha;\n    }\n    set alpha(value) {\n        this.props.alpha = value;\n        this.setUpdateType(UpdateType.PremultipliedColors | UpdateType.WorldAlpha);\n    }\n    get clipping() {\n        return this.props.clipping;\n    }\n    set clipping(value) {\n        this.props.clipping = value;\n        this.setUpdateType(UpdateType.Clipping);\n    }\n    get color() {\n        return this.props.color;\n    }\n    set color(value) {\n        if (this.props.colorTl !== value ||\n            this.props.colorTr !== value ||\n            this.props.colorBl !== value ||\n            this.props.colorBr !== value) {\n            this.colorTl = value;\n            this.colorTr = value;\n            this.colorBl = value;\n            this.colorBr = value;\n        }\n        this.props.color = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorTop() {\n        return this.props.colorTop;\n    }\n    set colorTop(value) {\n        if (this.props.colorTl !== value || this.props.colorTr !== value) {\n            this.colorTl = value;\n            this.colorTr = value;\n        }\n        this.props.colorTop = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorBottom() {\n        return this.props.colorBottom;\n    }\n    set colorBottom(value) {\n        if (this.props.colorBl !== value || this.props.colorBr !== value) {\n            this.colorBl = value;\n            this.colorBr = value;\n        }\n        this.props.colorBottom = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorLeft() {\n        return this.props.colorLeft;\n    }\n    set colorLeft(value) {\n        if (this.props.colorTl !== value || this.props.colorBl !== value) {\n            this.colorTl = value;\n            this.colorBl = value;\n        }\n        this.props.colorLeft = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorRight() {\n        return this.props.colorRight;\n    }\n    set colorRight(value) {\n        if (this.props.colorTr !== value || this.props.colorBr !== value) {\n            this.colorTr = value;\n            this.colorBr = value;\n        }\n        this.props.colorRight = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorTl() {\n        return this.props.colorTl;\n    }\n    set colorTl(value) {\n        this.props.colorTl = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorTr() {\n        return this.props.colorTr;\n    }\n    set colorTr(value) {\n        this.props.colorTr = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorBl() {\n        return this.props.colorBl;\n    }\n    set colorBl(value) {\n        this.props.colorBl = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorBr() {\n        return this.props.colorBr;\n    }\n    set colorBr(value) {\n        this.props.colorBr = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    // we're only interested in parent zIndex to test\n    // if we should use node zIndex is higher then parent zIndex\n    get zIndexLocked() {\n        return this.props.zIndexLocked || 0;\n    }\n    set zIndexLocked(value) {\n        this.props.zIndexLocked = value;\n        this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);\n        this.children.forEach((child) => {\n            child.setUpdateType(UpdateType.CalculatedZIndex);\n        });\n    }\n    get zIndex() {\n        return this.props.zIndex;\n    }\n    set zIndex(value) {\n        this.props.zIndex = value;\n        this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);\n        this.children.forEach((child) => {\n            child.setUpdateType(UpdateType.CalculatedZIndex);\n        });\n    }\n    get parent() {\n        return this.props.parent;\n    }\n    set parent(newParent) {\n        const oldParent = this.props.parent;\n        if (oldParent === newParent) {\n            return;\n        }\n        this.props.parent = newParent;\n        if (oldParent) {\n            const index = oldParent.children.indexOf(this);\n            assertTruthy(index !== -1, \"CoreNode.parent: Node not found in old parent's children!\");\n            oldParent.children.splice(index, 1);\n        }\n        if (newParent) {\n            newParent.children.push(this);\n            // Since this node has a new parent, to be safe, have it do a full update.\n            this.setUpdateType(UpdateType.All);\n            // Tell parent that it's children need to be updated and sorted.\n            newParent.setUpdateType(UpdateType.Children | UpdateType.ZIndexSortedChildren);\n        }\n        this.updateScaleRotateTransform();\n    }\n}\n//# sourceMappingURL=CoreNode.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../utils.js';\nimport { CoreAnimation } from '../../core/animations/CoreAnimation.js';\nimport { CoreAnimationController } from '../../core/animations/CoreAnimationController.js';\nimport { CoreNode } from '../../core/CoreNode.js';\nimport { EventEmitter } from '../../common/EventEmitter.js';\nlet nextId = 1;\nexport function getNewId() {\n    return nextId++;\n}\nexport class MainOnlyNode extends EventEmitter {\n    rendererMain;\n    stage;\n    id;\n    coreNode;\n    // Prop stores\n    _children = [];\n    _src = '';\n    _parent = null;\n    _texture = null;\n    _shader = null;\n    constructor(props, rendererMain, stage, coreNode) {\n        super();\n        this.rendererMain = rendererMain;\n        this.stage = stage;\n        this.id = coreNode?.id ?? getNewId();\n        this.coreNode =\n            coreNode ||\n                new CoreNode(this.stage, {\n                    id: this.id,\n                    x: props.x,\n                    y: props.y,\n                    width: props.width,\n                    height: props.height,\n                    alpha: props.alpha,\n                    clipping: props.clipping,\n                    color: props.color,\n                    colorTop: props.colorTop,\n                    colorBottom: props.colorBottom,\n                    colorLeft: props.colorLeft,\n                    colorRight: props.colorRight,\n                    colorTl: props.colorTl,\n                    colorTr: props.colorTr,\n                    colorBl: props.colorBl,\n                    colorBr: props.colorBr,\n                    zIndex: props.zIndex,\n                    zIndexLocked: props.zIndexLocked,\n                    scaleX: props.scaleX,\n                    scaleY: props.scaleY,\n                    mountX: props.mountX,\n                    mountY: props.mountY,\n                    mount: props.mount,\n                    pivot: props.pivot,\n                    pivotX: props.pivotX,\n                    pivotY: props.pivotY,\n                    rotation: props.rotation,\n                    parent: null,\n                    shader: null,\n                    shaderProps: null,\n                    texture: null,\n                    textureOptions: null,\n                });\n        // Forward loaded/failed events\n        this.coreNode.on('loaded', this.onTextureLoaded);\n        this.coreNode.on('failed', this.onTextureFailed);\n        // Assign properties to this object\n        this.parent = props.parent;\n        this.shader = props.shader;\n        this.texture = props.texture;\n        this.src = props.src;\n    }\n    get x() {\n        return this.coreNode.x;\n    }\n    set x(value) {\n        this.coreNode.x = value;\n    }\n    get y() {\n        return this.coreNode.y;\n    }\n    set y(value) {\n        this.coreNode.y = value;\n    }\n    get width() {\n        return this.coreNode.width;\n    }\n    set width(value) {\n        this.coreNode.width = value;\n    }\n    get height() {\n        return this.coreNode.height;\n    }\n    set height(value) {\n        this.coreNode.height = value;\n    }\n    get alpha() {\n        return this.coreNode.alpha;\n    }\n    set alpha(value) {\n        this.coreNode.alpha = value;\n    }\n    get clipping() {\n        return this.coreNode.clipping;\n    }\n    set clipping(value) {\n        this.coreNode.clipping = value;\n    }\n    get color() {\n        return this.coreNode.color;\n    }\n    set color(value) {\n        this.coreNode.color = value;\n    }\n    get colorTop() {\n        return this.coreNode.colorTop;\n    }\n    set colorTop(value) {\n        this.coreNode.colorTop = value;\n    }\n    get colorBottom() {\n        return this.coreNode.colorBottom;\n    }\n    set colorBottom(value) {\n        this.coreNode.colorBottom = value;\n    }\n    get colorLeft() {\n        return this.coreNode.colorLeft;\n    }\n    set colorLeft(value) {\n        this.coreNode.colorLeft = value;\n    }\n    get colorRight() {\n        return this.coreNode.colorRight;\n    }\n    set colorRight(value) {\n        this.coreNode.colorRight = value;\n    }\n    get colorTl() {\n        return this.coreNode.colorTl;\n    }\n    set colorTl(value) {\n        this.coreNode.colorTl = value;\n    }\n    get colorTr() {\n        return this.coreNode.colorTr;\n    }\n    set colorTr(value) {\n        this.coreNode.colorTr = value;\n    }\n    get colorBl() {\n        return this.coreNode.colorBl;\n    }\n    set colorBl(value) {\n        this.coreNode.colorBl = value;\n    }\n    get colorBr() {\n        return this.coreNode.colorBr;\n    }\n    set colorBr(value) {\n        this.coreNode.colorBr = value;\n    }\n    get scale() {\n        if (this.scaleX !== this.scaleY) {\n            return null;\n        }\n        return this.coreNode.scaleX;\n    }\n    set scale(value) {\n        // We ignore `null` when it's set.\n        if (value === null) {\n            return;\n        }\n        this.coreNode.scaleX = value;\n        this.coreNode.scaleY = value;\n    }\n    get scaleX() {\n        return this.coreNode.scaleX;\n    }\n    set scaleX(value) {\n        this.coreNode.scaleX = value;\n    }\n    get scaleY() {\n        return this.coreNode.scaleY;\n    }\n    set scaleY(value) {\n        this.coreNode.scaleY = value;\n    }\n    get mount() {\n        return this.coreNode.mount;\n    }\n    set mount(value) {\n        this.coreNode.mount = value;\n    }\n    get mountX() {\n        return this.coreNode.mountX;\n    }\n    set mountX(value) {\n        this.coreNode.mountX = value;\n    }\n    get mountY() {\n        return this.coreNode.mountY;\n    }\n    set mountY(value) {\n        this.coreNode.mountY = value;\n    }\n    get pivot() {\n        return this.coreNode.pivot;\n    }\n    set pivot(value) {\n        this.coreNode.pivot = value;\n    }\n    get pivotX() {\n        return this.coreNode.pivotX;\n    }\n    set pivotX(value) {\n        this.coreNode.pivotX = value;\n    }\n    get pivotY() {\n        return this.coreNode.pivotY;\n    }\n    set pivotY(value) {\n        this.coreNode.pivotY = value;\n    }\n    get rotation() {\n        return this.coreNode.rotation;\n    }\n    set rotation(value) {\n        this.coreNode.rotation = value;\n    }\n    get parent() {\n        return this._parent;\n    }\n    set parent(newParent) {\n        const oldParent = this._parent;\n        this._parent = newParent;\n        this.coreNode.parent = newParent?.coreNode ?? null;\n        if (oldParent) {\n            const index = oldParent.children.indexOf(this);\n            assertTruthy(index !== -1, \"MainOnlyNode.parent: Node not found in old parent's children!\");\n            oldParent.children.splice(index, 1);\n        }\n        if (newParent) {\n            newParent.children.push(this);\n        }\n    }\n    get children() {\n        return this._children;\n    }\n    get zIndex() {\n        return this.coreNode.zIndex;\n    }\n    set zIndex(value) {\n        this.coreNode.zIndex = value;\n    }\n    get zIndexLocked() {\n        return this.coreNode.zIndexLocked;\n    }\n    set zIndexLocked(value) {\n        this.coreNode.zIndexLocked = value;\n    }\n    get src() {\n        return this._src;\n    }\n    set src(imageUrl) {\n        if (this._src === imageUrl) {\n            return;\n        }\n        this._src = imageUrl;\n        if (!imageUrl) {\n            this.texture = null;\n            return;\n        }\n        this.texture = this.rendererMain.createTexture('ImageTexture', {\n            src: imageUrl,\n        });\n    }\n    //#region Texture\n    get texture() {\n        return this._texture;\n    }\n    set texture(texture) {\n        if (this._texture === texture) {\n            return;\n        }\n        if (this._texture) {\n            this.rendererMain.textureTracker.decrementTextureRefCount(this._texture);\n        }\n        if (texture) {\n            this.rendererMain.textureTracker.incrementTextureRefCount(texture);\n        }\n        this._texture = texture;\n        if (texture) {\n            this.coreNode.loadTexture(texture.txType, texture.props, texture.options);\n        }\n        else {\n            this.coreNode.unloadTexture();\n        }\n    }\n    onTextureLoaded = (target, payload) => {\n        this.emit('loaded', payload);\n    };\n    onTextureFailed = (target, payload) => {\n        this.emit('failed', payload);\n    };\n    //#endregion Texture\n    get shader() {\n        return this._shader;\n    }\n    set shader(shader) {\n        if (this._shader === shader) {\n            return;\n        }\n        this._shader = shader;\n        if (shader) {\n            this.coreNode.loadShader(shader.shType, shader.props);\n        }\n    }\n    destroy() {\n        this.emit('beforeDestroy', {});\n        this.parent = null;\n        this.texture = null;\n        this.emit('afterDestroy', {});\n        this.removeAllListeners();\n    }\n    flush() {\n        // No-op\n    }\n    animate(props, settings) {\n        const animation = new CoreAnimation(this.coreNode, props, settings);\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n        const controller = new CoreAnimationController(this.stage.animationManager, animation);\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return controller;\n    }\n}\n//# sourceMappingURL=MainOnlyNode.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Platform render loop initiator\n */\nexport const startLoop = (stage) => {\n    const runLoop = () => {\n        stage.updateAnimations();\n        if (!stage.hasSceneUpdates()) {\n            setTimeout(runLoop, 16.666666666666668);\n            return;\n        }\n        stage.drawFrame();\n        requestAnimationFrame(runLoop);\n    };\n    requestAnimationFrame(runLoop);\n};\n/**\n * Return unix timestamp\n * @return {number}\n */\nexport const getTimeStamp = () => {\n    return performance ? performance.now() : Date.now();\n};\n//# sourceMappingURL=platform.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\nexport class DefaultShader extends WebGlCoreShader {\n    constructor(renderer) {\n        super({\n            renderer,\n            attributes: ['a_position', 'a_textureCoordinate', 'a_color'],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_texture', uniform: 'uniform2fv' },\n            ],\n        });\n    }\n    bindTextures(textures) {\n        const { gl } = this;\n        if (gl.getParameter(gl.TEXTURE_BINDING_2D) === textures[0].ctxTexture) {\n            return;\n        }\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, textures[0].ctxTexture);\n    }\n    static shaderSources = {\n        vertex: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    `,\n        fragment: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    `,\n    };\n}\n//# sourceMappingURL=DefaultShader.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\n// import type { Texture } from '../textures/Texture';\nexport class DefaultShaderBatched extends WebGlCoreShader {\n    supportsIndexedTextures = true;\n    constructor(renderer) {\n        super({\n            renderer,\n            attributes: [\n                'a_position',\n                'a_textureCoordinate',\n                'a_color',\n                'a_textureIndex',\n            ],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_textures[0]', uniform: 'uniform1iv' },\n            ],\n        });\n    }\n    bindTextures(texture) {\n        const { renderer, gl } = this;\n        if (texture.length > renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS) {\n            throw new Error(`DefaultShaderBatched: Cannot bind more than ${renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`);\n        }\n        texture.forEach((t, i) => {\n            gl.activeTexture(gl.TEXTURE0 + i);\n            gl.bindTexture(gl.TEXTURE_2D, t.ctxTexture);\n        });\n        const samplers = Array.from(Array(texture.length).keys());\n        this.setUniform('u_textures[0]', samplers);\n    }\n    static shaderSources = {\n        vertex: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    `,\n        fragment: (textureUnits) => `\n      #define txUnits ${textureUnits}\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[${textureUnits}], int idx, vec2 uv) {\n        ${Array.from(Array(textureUnits).keys())\n            .map((idx) => `\n          ${idx !== 0 ? 'else ' : ''}if (idx == ${idx}) {\n            return texture2D(textures[${idx}], uv);\n          }\n        `)\n            .join('')}\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    `,\n    };\n}\n//# sourceMappingURL=DefaultShaderBatched.js.map","export class ShaderEffect {\n    priority = 1;\n    name = '';\n    ref;\n    target;\n    passParameters = '';\n    declaredUniforms = '';\n    uniformInfo = {};\n    static uniforms = {};\n    static methods;\n    static onShaderMask;\n    static onColorize;\n    static onEffectMask;\n    static getEffectKey(props) {\n        return '';\n    }\n    static getMethodParameters(uniforms, props) {\n        const res = [];\n        for (const u in uniforms) {\n            const uni = uniforms[u];\n            let define = '';\n            if (uni.size) {\n                define = `[${uni.size(props)}]`;\n            }\n            res.push(`${uni.type} ${u}${define}`);\n        }\n        return res.join(',');\n    }\n    constructor(options) {\n        const { ref, target, props = {} } = options;\n        this.ref = ref;\n        this.target = target;\n        const uniformInfo = {};\n        const passParameters = [];\n        let declaredUniforms = '';\n        const uniforms = this.constructor.uniforms || {};\n        for (const u in uniforms) {\n            const unif = uniforms[u];\n            const uniType = unif.type;\n            //make unique uniform name\n            const uniformName = `${ref}_${u}`;\n            let define = '';\n            if (unif.size) {\n                define = `[${unif.size(props)}]`;\n            }\n            passParameters.push(uniformName);\n            declaredUniforms += `uniform ${uniType} ${uniformName}${define};`;\n            uniformInfo[u] = { name: uniformName, uniform: uniforms[u].method };\n        }\n        this.passParameters = passParameters.join(',');\n        this.declaredUniforms = declaredUniforms;\n        this.uniformInfo = uniformInfo;\n    }\n    static resolveDefaults(props) {\n        return {};\n    }\n    static makeEffectKey(props) {\n        return false;\n    }\n}\n//# sourceMappingURL=ShaderEffect.js.map","import { WebGlCoreShader, } from '../WebGlCoreShader.js';\nimport { ShaderEffect } from './effects/ShaderEffect.js';\nexport class DynamicShader extends WebGlCoreShader {\n    effects = [];\n    constructor(renderer, props, effectContructors) {\n        const shader = DynamicShader.createShader(props, effectContructors);\n        super({\n            renderer,\n            attributes: ['a_position', 'a_textureCoordinate', 'a_color'],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_texture', uniform: 'uniform2fv' },\n                { name: 'u_dimensions', uniform: 'uniform2fv' },\n                { name: 'u_alpha', uniform: 'uniform1f' },\n                ...shader.uniforms,\n            ],\n            shaderSources: {\n                vertex: shader.vertex,\n                fragment: shader.fragment,\n            },\n        });\n        this.effects = shader.effects;\n    }\n    bindTextures(textures) {\n        const { gl } = this;\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, textures[0].ctxTexture);\n    }\n    bindProps(props) {\n        const effects = this.renderer.shManager.getRegisteredEffects();\n        props.effects?.forEach((eff, index) => {\n            const effect = this.effects[index];\n            const fxClass = effects[effect.name];\n            const props = eff.props ?? {};\n            const uniInfo = effect.uniformInfo;\n            Object.keys(props).forEach((p) => {\n                const fxProp = fxClass.uniforms[p];\n                const propInfo = uniInfo[p];\n                let value = fxProp.validator\n                    ? fxProp.validator(props[p], props)\n                    : props[p];\n                if (Array.isArray(value)) {\n                    value = new Float32Array(value);\n                }\n                this.setUniform(propInfo.name, value);\n            });\n        });\n    }\n    static createShader(props, effectContructors) {\n        //counts duplicate effects\n        const effectNameCount = {};\n        const methods = {};\n        let declareUniforms = '';\n        const uniforms = [];\n        const uFx = [];\n        const effects = props.effects.map((effect) => {\n            const baseClass = effectContructors[effect.type];\n            const key = baseClass.getEffectKey(effect.props || {});\n            effectNameCount[key] = effectNameCount[key] ? ++effectNameCount[key] : 1;\n            const nr = effectNameCount[key];\n            if (nr === 1) {\n                uFx.push({ key, type: effect.type, props: effect.props });\n            }\n            //initialize new effect class;\n            const fxClass = new baseClass({\n                ref: `${key}${nr === 1 ? '' : nr}`,\n                target: key,\n                props: effect.props,\n            });\n            declareUniforms += fxClass.declaredUniforms;\n            uniforms.push(...Object.values(fxClass.uniformInfo));\n            return fxClass;\n        });\n        //build source\n        let effectMethods = '';\n        uFx?.forEach((fx) => {\n            const fxClass = effectContructors[fx.type];\n            const fxProps = fxClass.resolveDefaults((fx.props ?? {}));\n            const remap = [];\n            for (const m in fxClass.methods) {\n                let cm = m;\n                const fxMethod = fxClass.methods[m];\n                if (methods[m] && methods[m] !== fxMethod) {\n                    cm = DynamicShader.resolveMethodDuplicate(m, fxMethod, methods);\n                }\n                methods[cm] = fxMethod.replace('function', cm);\n                remap.push({ m, cm });\n            }\n            let onShaderMask = fxClass.onShaderMask instanceof Function\n                ? fxClass.onShaderMask(fxProps)\n                : fxClass.onShaderMask;\n            let onColorize = fxClass.onColorize instanceof Function\n                ? fxClass.onColorize(fxProps)\n                : fxClass.onColorize;\n            let onEffectMask = fxClass.onEffectMask instanceof Function\n                ? fxClass.onEffectMask(fxProps)\n                : fxClass.onEffectMask;\n            remap.forEach((r) => {\n                const { m, cm } = r;\n                const reg = new RegExp(`\\\\$${m}`, 'g');\n                if (onShaderMask) {\n                    onShaderMask = onShaderMask.replace(reg, cm);\n                }\n                if (onColorize) {\n                    onColorize = onColorize.replace(reg, cm);\n                }\n                if (onEffectMask) {\n                    onEffectMask = onEffectMask.replace(reg, cm);\n                }\n            });\n            const methodParameters = fxClass.getMethodParameters(fxClass.uniforms, fxProps);\n            const pm = methodParameters.length > 0 ? `, ${methodParameters}` : '';\n            if (onShaderMask) {\n                effectMethods += `\n        float fx_${fx.key}_onShaderMask(float shaderMask ${pm}) {\n          ${onShaderMask}\n        }\n        `;\n            }\n            if (onColorize) {\n                effectMethods += `\n          vec4 fx_${fx.key}_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${pm}) {\n            ${onColorize}\n          }\n        `;\n            }\n            if (onEffectMask) {\n                effectMethods += `\n          vec4 fx_${fx.key}_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${pm}) {\n            ${onEffectMask}\n          }\n        `;\n            }\n        });\n        let sharedMethods = '';\n        for (const m in methods) {\n            sharedMethods += methods[m];\n        }\n        //fill main functions\n        let currentMask = `mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))`;\n        let drawEffects = `\n\n    `;\n        for (let i = 0; i < effects.length; i++) {\n            const current = effects[i];\n            const pm = current.passParameters.length > 0 ? `, ${current.passParameters}` : '';\n            const currentClass = effectContructors[current.name];\n            if (currentClass.onShaderMask) {\n                drawEffects += `\n        shaderMask = fx_${current.target}_onShaderMask(shaderMask ${pm});\n        `;\n            }\n            if (currentClass.onColorize) {\n                drawEffects += `\n        maskColor = fx_${current.target}_onColorize(shaderMask, maskColor, shaderColor${pm});\n        `;\n            }\n            if (currentClass.onEffectMask) {\n                currentMask = `fx_${current.target}_onEffectMask(shaderMask, maskColor, shaderColor${pm})`;\n            }\n            const next = effects[i + 1];\n            if (next === undefined ||\n                effectContructors[next.name].onEffectMask) {\n                drawEffects += `\n          shaderColor = ${currentMask};\n        `;\n            }\n        }\n        return {\n            effects,\n            uniforms,\n            fragment: DynamicShader.fragment(declareUniforms, sharedMethods, effectMethods, drawEffects),\n            vertex: DynamicShader.vertex(),\n        };\n    }\n    static resolveMethodDuplicate(key, effectMethod, methodCollection, increment = 0) {\n        const m = key + (increment > 0 ? increment : '');\n        if (methodCollection[m] && methodCollection[m] !== effectMethod) {\n            return this.resolveMethodDuplicate(key, effectMethod, methodCollection, ++increment);\n        }\n        return m;\n    }\n    static resolveDefaults(props, effectContructors) {\n        return {\n            effects: (props.effects ?? []).map((effect) => ({\n                type: effect.type,\n                props: effectContructors[effect.type].resolveDefaults((effect.props || {})),\n            })),\n            $dimensions: {\n                width: 0,\n                height: 0,\n            },\n            $alpha: 0,\n        };\n    }\n    static makeCacheKey(props, effectContructors) {\n        let fx = '';\n        props.effects?.forEach((effect) => {\n            const baseClass = effectContructors[effect.type];\n            const key = baseClass.getEffectKey(effect.props || {});\n            fx += `,${key}`;\n        });\n        return `DynamicShader${fx}`;\n    }\n    static z$__type__Props;\n    static vertex = () => `\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  `;\n    static fragment = (uniforms, methods, effectMethods, drawEffects) => `\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    ${uniforms}\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n\n    ${methods}\n\n    ${effectMethods}\n\n    void main() {\n      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ${drawEffects}\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  `;\n}\n//# sourceMappingURL=DynamicShader.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { WebGlCoreShader, } from '../WebGlCoreShader.js';\n/**\n * Similar to the {@link DefaultShader} but cuts out 4 rounded rectangle corners\n * as defined by the specified corner {@link RoundedRectangleProps.radius}\n */\nexport class RoundedRectangle extends WebGlCoreShader {\n    constructor(renderer) {\n        super({\n            renderer,\n            attributes: ['a_position', 'a_textureCoordinate', 'a_color'],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_texture', uniform: 'uniform2f' },\n                { name: 'u_dimensions', uniform: 'uniform2fv' },\n                { name: 'u_radius', uniform: 'uniform1f' },\n            ],\n        });\n    }\n    static z$__type__Props;\n    static resolveDefaults(props) {\n        return {\n            radius: props.radius || 10,\n            $dimensions: {\n                width: 0,\n                height: 0,\n            },\n        };\n    }\n    bindTextures(textures) {\n        const { gl } = this;\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, textures[0].ctxTexture);\n    }\n    bindProps(props) {\n        this.setUniform('u_radius', props.radius);\n    }\n    canBatchShaderProps(propsA, propsB) {\n        return (propsA.radius === propsB.radius &&\n            propsA.$dimensions.width === propsB.$dimensions.width &&\n            propsA.$dimensions.height === propsB.$dimensions.height);\n    }\n    static shaderSources = {\n        vertex: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    `,\n        fragment: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    `,\n    };\n}\n//# sourceMappingURL=RoundedRectangle.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../lib/utils.js';\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\nconst IDENTITY_MATRIX_3x3 = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);\n/**\n * SdfShader supports multi-channel and single-channel signed distance field textures.\n *\n * @remarks\n * This Shader is used by the {@link SdfTextRenderer}. Do not use thie Shader\n * directly. Instead create a Text Node and assign a SDF font family to it.\n *\n * @internalRemarks\n * The only thing this shader does to support multi-channel SDFs is to\n * add a median function to the fragment shader. If this one function call\n * ends up being a performance bottleneck we can always look at ways to\n * remove it.\n */\nexport class SdfShader extends WebGlCoreShader {\n    constructor(renderer) {\n        super({\n            renderer,\n            attributes: ['a_position', 'a_textureCoordinate'],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_transform', uniform: 'uniformMatrix3fv' },\n                { name: 'u_scrollY', uniform: 'uniform1f' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_texture', uniform: 'uniform2f' },\n                { name: 'u_color', uniform: 'uniform4fv' },\n                { name: 'u_size', uniform: 'uniform1f' },\n                { name: 'u_distanceRange', uniform: 'uniform1f' },\n                { name: 'u_debug', uniform: 'uniform1i' },\n            ],\n        });\n    }\n    bindTextures(textures) {\n        const { gl } = this;\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, textures[0].ctxTexture);\n    }\n    bindProps(props) {\n        const resolvedProps = SdfShader.resolveDefaults(props);\n        for (const key in resolvedProps) {\n            if (key === 'transform') {\n                this.setUniform('u_transform', false, resolvedProps[key]);\n            }\n            else if (key === 'scrollY') {\n                this.setUniform('u_scrollY', resolvedProps[key]);\n            }\n            else if (key === 'color') {\n                const components = getNormalizedRgbaComponents(resolvedProps.color);\n                this.setUniform('u_color', components);\n            }\n            else if (key === 'size') {\n                this.setUniform('u_size', resolvedProps[key]);\n            }\n            else if (key === 'distanceRange') {\n                this.setUniform('u_distanceRange', resolvedProps[key]);\n            }\n            else if (key === 'debug') {\n                this.setUniform('u_debug', resolvedProps[key] ? 1.0 : 0.0);\n            }\n        }\n    }\n    static resolveDefaults(props = {}) {\n        return {\n            transform: props.transform ?? IDENTITY_MATRIX_3x3,\n            scrollY: props.scrollY ?? 0,\n            color: props.color ?? 0xffffffff,\n            size: props.size ?? 16,\n            distanceRange: props.distanceRange ?? 1.0,\n            debug: props.debug ?? false,\n        };\n    }\n    static shaderSources = {\n        vertex: `\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n        gl_Position = vec4((transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1), 0, 1);\n        v_texcoord = a_textureCoordinate;\n      }\n    `,\n        fragment: `\n      precision highp float;\n\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    `,\n    };\n}\n//# sourceMappingURL=SdfShader.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * Masks the current maskcolor with rounded corners similar to {@link RoundedRectangle}\n */\nexport class RadiusEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'radius';\n    static getEffectKey() {\n        return `radius`;\n    }\n    static uniforms = {\n        radius: {\n            value: 0,\n            method: 'uniform4fv',\n            type: 'vec4',\n            validator: (value) => {\n                let r = value;\n                if (Array.isArray(r)) {\n                    if (r.length === 2) {\n                        r = [r[0], r[1], r[0], r[1]];\n                    }\n                    else if (r.length === 3) {\n                        r = [r[0], r[1], r[2], r[0]];\n                    }\n                    else if (r.length !== 4) {\n                        r = [r[0], r[0], r[0], r[0]];\n                    }\n                }\n                else if (typeof r === 'number') {\n                    r = [r, r, r, r];\n                }\n                return r;\n            },\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        boxDist: `\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    `,\n    };\n    static resolveDefaults(props) {\n        return {\n            radius: props.radius ?? 10,\n        };\n    }\n    static onShaderMask = `\n  vec2 halfDimensions = u_dimensions * 0.5;\n  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);\n  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);\n  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);\n  `;\n    static onEffectMask = `\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  `;\n}\n//# sourceMappingURL=RadiusEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderEffect renders a border along all edges of an element\n */\nexport class BorderEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'border';\n    static getEffectKey() {\n        return `border`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            validator: (rgba) => getNormalizedRgbaComponents(rgba),\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static onEffectMask = `\n  float mask = clamp(shaderMask + width, 0.0, 1.0) - clamp(shaderMask, 0.0, 1.0);\n  return mix(shaderColor, maskColor, mask);\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * Linear Gradient effect over a effect mask\n */\nexport class LinearGradientEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'linearGradient';\n    static getEffectKey(props) {\n        return `linearGradient${props.colors.length}`;\n    }\n    static resolveDefaults(props) {\n        const colors = props.colors ?? [0xff000000, 0xffffffff];\n        let stops = props.stops;\n        if (!stops) {\n            stops = [];\n            const calc = colors.length - 1;\n            for (let i = 0; i < colors.length; i++) {\n                stops.push(i * (1 / calc));\n            }\n        }\n        return {\n            colors,\n            stops,\n            angle: props.angle ?? 0,\n        };\n    }\n    static uniforms = {\n        angle: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        colors: {\n            value: 0xffffffff,\n            validator: (rgbas) => {\n                const cols = rgbas.map((rgbas) => getNormalizedRgbaComponents(rgbas));\n                return cols.reduce((acc, val) => acc.concat(val), []);\n            },\n            size: (props) => props.colors.length,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n        stops: {\n            value: [],\n            validator: (value, props) => {\n                const colors = props.colors ?? [];\n                let stops = value;\n                const tmp = value;\n                if (stops.length === 0 || (stops && stops.length !== colors.length)) {\n                    for (let i = 0; i < colors.length; i++) {\n                        if (stops[i]) {\n                            tmp[i] = stops[i];\n                            if (stops[i - 1] === undefined && tmp[i - 2] !== undefined) {\n                                tmp[i - 1] = tmp[i - 2] + (stops[i] - tmp[i - 2]) / 2;\n                            }\n                        }\n                        else {\n                            tmp[i] = i * (1 / (colors.length - 1));\n                        }\n                    }\n                    stops = tmp;\n                }\n                return tmp;\n            },\n            size: (props) => props.colors.length,\n            method: 'uniform1fv',\n            type: 'float',\n        },\n    };\n    static methods = {\n        fromLinear: `\n      vec4 function(vec4 linearRGB) {\n        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n        vec4 lower = linearRGB * vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    `,\n        toLinear: `\n      vec4 function(vec4 sRGB) {\n        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));\n        vec4 lower = sRGB/vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    `,\n        calcPoint: `\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    `,\n    };\n    static ColorLoop = (amount) => {\n        let loop = '';\n        for (let i = 2; i < amount; i++) {\n            loop += `colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i - 1}]) / (stops[${i}] - stops[${i - 1}]), 0.0, 1.0));`;\n        }\n        return loop;\n    };\n    static onColorize = (props) => {\n        const colors = props.colors.length || 1;\n        return `\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));\n      for(int i = 1; i < ${colors}-1; i++) {\n        stopCalc = (dist - stops[i]) / (stops[i + 1] - stops[i]);\n        colorOut = mix(colorOut, colors[i + 1], clamp(stopCalc, 0.0, 1.0));\n      }\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    `;\n    };\n}\n//# sourceMappingURL=LinearGradientEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ShaderEffect } from './ShaderEffect.js';\n/**\n * Grayscale effect grayscales the color values of the current mask color\n */\nexport class GrayscaleEffect extends ShaderEffect {\n    name = 'grayscale';\n    static getEffectKey() {\n        return `grayscale`;\n    }\n    static onColorize = `\n    vec3 color = pow(maskColor.rgb, vec3(2.0));\n    float gray = dot(color, vec3(0.2126, 0.7152, 0.0722));\n    float gammaGray = sqrt(gray);\n    return vec4(gammaGray, gammaGray, gammaGray, 1.0);\n  `;\n}\n//# sourceMappingURL=GrayscaleEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderBottomEffect renders a border on the right side of an element\n */\nexport class BorderRightEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'borderRight';\n    static getEffectKey() {\n        return `borderRight`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            validator: (rgba) => getNormalizedRgbaComponents(rgba),\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n    };\n    static onEffectMask = `\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderRightEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderBottomEffect renders a border on the top side of an element\n */\nexport class BorderTopEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'borderTop';\n    static getEffectKey() {\n        return `borderTop`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            validator: (rgba) => getNormalizedRgbaComponents(rgba),\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n    };\n    static onEffectMask = `\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderTopEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderBottomEffect renders a border on the bottom side of an element\n */\nexport class BorderBottomEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'borderBottom';\n    static getEffectKey() {\n        return `borderBottom`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            validator: (rgba) => getNormalizedRgbaComponents(rgba),\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n    };\n    static onEffectMask = `\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderBottomEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderBottomEffect renders a border on the left of an element\n */\nexport class BorderLeftEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'borderLeft';\n    static getEffectKey() {\n        return `borderLeft`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            validator: (rgba) => getNormalizedRgbaComponents(rgba),\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n    };\n    static onEffectMask = `\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderLeftEffect.js.map","import { ShaderEffect, } from './ShaderEffect.js';\n/**\n * Renders a Glitch effect using the incoming texture\n */\nexport class GlitchEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'glitch';\n    static getEffectKey(props) {\n        return `glitch`;\n    }\n    static resolveDefaults(props) {\n        return {\n            amplitude: props.amplitude ?? 0.2,\n            narrowness: props.narrowness ?? 4.0,\n            blockiness: props.blockiness ?? 2.0,\n            minimizer: props.minimizer ?? 8.0,\n            time: props.time ?? Date.now(),\n        };\n    }\n    static uniforms = {\n        amplitude: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        narrowness: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        blockiness: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        minimizer: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        time: {\n            value: 0,\n            method: 'uniform1f',\n            validator: (value) => {\n                return (Date.now() - value) % 1000;\n            },\n            type: 'float',\n        },\n    };\n    static methods = {\n        rand: `\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    `,\n        noise: `\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    `,\n        fbm: `\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    `,\n    };\n    static onColorize = `\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  `;\n}\n//# sourceMappingURL=GlitchEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ShaderEffect, } from './ShaderEffect.js';\nexport class FadeOutEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'fadeOut';\n    static getEffectKey() {\n        return `fadeOut`;\n    }\n    static uniforms = {\n        fade: {\n            value: 0,\n            method: 'uniform4fv',\n            type: 'vec4',\n            validator: (value) => {\n                let r = value;\n                if (Array.isArray(r)) {\n                    if (r.length === 2) {\n                        r = [r[0], r[1], r[0], r[1]];\n                    }\n                    else if (r.length === 3) {\n                        r = [r[0], r[1], r[2], r[0]];\n                    }\n                    else if (r.length !== 4) {\n                        r = [r[0], r[0], r[0], r[0]];\n                    }\n                }\n                else if (typeof r === 'number') {\n                    r = [r, r, r, r];\n                }\n                return r;\n            },\n        },\n    };\n    static resolveDefaults(props) {\n        return {\n            fade: props.fade ?? 10,\n        };\n    }\n    static onColorize = `\n  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  `;\n}\n//# sourceMappingURL=FadeOutEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\nexport class RadialGradientEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'radialGradient';\n    static getEffectKey(props) {\n        return `radialGradient${props.colors.length}`;\n    }\n    static resolveDefaults(props) {\n        const colors = props.colors ?? [0xff000000, 0xffffffff];\n        let stops = props.stops;\n        if (!stops) {\n            stops = [];\n            const calc = colors.length - 1;\n            for (let i = 0; i < colors.length; i++) {\n                stops.push(i * (1 / calc));\n            }\n        }\n        return {\n            colors,\n            stops,\n            width: props.width ?? 0,\n            height: props.height ?? props.width ?? 0,\n            pivot: props.pivot ?? [0.5, 0.5],\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        height: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        pivot: {\n            value: [0.5, 0.5],\n            method: 'uniform2fv',\n            type: 'vec2',\n        },\n        colors: {\n            value: 0xffffffff,\n            validator: (rgbas) => {\n                const cols = rgbas.map((rgbas) => getNormalizedRgbaComponents(rgbas));\n                return cols.reduce((acc, val) => acc.concat(val), []);\n            },\n            size: (props) => props.colors.length,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n        stops: {\n            value: [],\n            validator: (value, props) => {\n                const colors = props.colors ?? [];\n                let stops = value;\n                const tmp = value;\n                if (stops.length === 0 || (stops && stops.length !== colors.length)) {\n                    for (let i = 0; i < colors.length; i++) {\n                        if (stops[i]) {\n                            tmp[i] = stops[i];\n                            if (stops[i - 1] === undefined && tmp[i - 2] !== undefined) {\n                                tmp[i - 1] = tmp[i - 2] + (stops[i] - tmp[i - 2]) / 2;\n                            }\n                        }\n                        else {\n                            tmp[i] = i * (1 / (colors.length - 1));\n                        }\n                    }\n                    stops = tmp;\n                }\n                return tmp;\n            },\n            size: (props) => props.colors.length,\n            method: 'uniform1fv',\n            type: 'float',\n        },\n    };\n    static onColorize = (props) => {\n        const colors = props.colors.length || 1;\n        return `\n      vec2 point = v_textureCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = mix(colors[0], colors[1], stopCalc);\n      for(int i = 1; i < ${colors}-1; i++) {\n        stopCalc = (dist - stops[i]) / (stops[i + 1] - stops[i]);\n        colorOut = mix(colorOut, colors[i + 1], clamp(stopCalc, 0.0, 1.0));\n      }\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    `;\n    };\n}\n//# sourceMappingURL=RadialGradientEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The RadialProgressEffect renders a border along all edges of an element\n */\nexport class RadialProgressEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'radialProgress';\n    static getEffectKey() {\n        return `radialProgress`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            progress: props.progress ?? 0.5,\n            offset: props.offset ?? 0,\n            range: props.range ?? Math.PI * 2,\n            rounded: props.rounded ?? false,\n            radius: props.radius ?? 1,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        progress: {\n            value: 0.5,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        offset: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        range: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        rounded: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n            validator: (value) => {\n                return value ? 1 : 0;\n            },\n        },\n        radius: {\n            value: 1,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            validator: (rgba) => getNormalizedRgbaComponents(rgba),\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        rotateUV: `\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    `,\n        drawDot: `\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    `,\n    };\n    static onEffectMask = `\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=RadialProgressEffect.js.map","import { DefaultShader } from './renderers/webgl/shaders/DefaultShader.js';\nimport { DefaultShaderBatched } from './renderers/webgl/shaders/DefaultShaderBatched.js';\nimport { DynamicShader, } from './renderers/webgl/shaders/DynamicShader.js';\nimport { RoundedRectangle } from './renderers/webgl/shaders/RoundedRectangle.js';\nimport { SdfShader } from './renderers/webgl/shaders/SdfShader.js';\nimport { RadiusEffect } from './renderers/webgl/shaders/effects/RadiusEffect.js';\nimport { BorderEffect } from './renderers/webgl/shaders/effects/BorderEffect.js';\nimport { LinearGradientEffect } from './renderers/webgl/shaders/effects/LinearGradientEffect.js';\nimport { GrayscaleEffect } from './renderers/webgl/shaders/effects/GrayscaleEffect.js';\nimport { BorderRightEffect } from './renderers/webgl/shaders/effects/BorderRightEffect.js';\nimport { BorderTopEffect } from './renderers/webgl/shaders/effects/BorderTopEffect.js';\nimport { BorderBottomEffect } from './renderers/webgl/shaders/effects/BorderBottomEffect.js';\nimport { BorderLeftEffect } from './renderers/webgl/shaders/effects/BorderLeftEffect.js';\nimport { GlitchEffect } from './renderers/webgl/shaders/effects/GlitchEffect.js';\nimport { FadeOutEffect } from './renderers/webgl/shaders/effects/FadeOutEffect.js';\nimport { RadialGradientEffect } from './renderers/webgl/shaders/effects/RadialGradientEffect.js';\nimport { RadialProgressEffect } from './renderers/webgl/shaders/effects/RadialProgressEffect.js';\nexport class CoreShaderManager {\n    shCache = new Map();\n    shConstructors = {};\n    attachedShader = null;\n    effectConstructors = {};\n    renderer;\n    constructor() {\n        this.registerShaderType('DefaultShader', DefaultShader);\n        this.registerShaderType('DefaultShaderBatched', DefaultShaderBatched);\n        this.registerShaderType('RoundedRectangle', RoundedRectangle);\n        this.registerShaderType('DynamicShader', DynamicShader);\n        this.registerShaderType('SdfShader', SdfShader);\n        this.registerEffectType('border', BorderEffect);\n        this.registerEffectType('borderBottom', BorderBottomEffect);\n        this.registerEffectType('borderLeft', BorderLeftEffect);\n        this.registerEffectType('borderRight', BorderRightEffect);\n        this.registerEffectType('borderTop', BorderTopEffect);\n        this.registerEffectType('fadeOut', FadeOutEffect);\n        this.registerEffectType('linearGradient', LinearGradientEffect);\n        this.registerEffectType('radialGradient', RadialGradientEffect);\n        this.registerEffectType('grayscale', GrayscaleEffect);\n        this.registerEffectType('glitch', GlitchEffect);\n        this.registerEffectType('radius', RadiusEffect);\n        this.registerEffectType('radialProgress', RadialProgressEffect);\n    }\n    registerShaderType(shType, shClass) {\n        this.shConstructors[shType] = shClass;\n    }\n    registerEffectType(effectType, effectClass) {\n        this.effectConstructors[effectType] = effectClass;\n    }\n    getRegisteredEffects() {\n        return this.effectConstructors;\n    }\n    getRegisteredShaders() {\n        return this.shConstructors;\n    }\n    loadShader(shType, props) {\n        if (!this.renderer) {\n            throw new Error(`Renderer is not been defined`);\n        }\n        const ShaderClass = this.shConstructors[shType];\n        if (!ShaderClass) {\n            throw new Error(`Shader type \"${shType}\" is not registered`);\n        }\n        if (shType === 'DynamicShader') {\n            return this.loadDynamicShader(props);\n        }\n        const resolvedProps = ShaderClass.resolveDefaults(props);\n        const cacheKey = ShaderClass.makeCacheKey(resolvedProps) || ShaderClass.name;\n        if (cacheKey && this.shCache.has(cacheKey)) {\n            return {\n                shader: this.shCache.get(cacheKey),\n                props: resolvedProps,\n            };\n        }\n        // @ts-expect-error ShaderClass WILL accept a Renderer\n        const shader = new ShaderClass(this.renderer, props);\n        if (cacheKey) {\n            this.shCache.set(cacheKey, shader);\n        }\n        return {\n            shader,\n            props: resolvedProps,\n        };\n    }\n    loadDynamicShader(props) {\n        if (!this.renderer) {\n            throw new Error(`Renderer is not been defined`);\n        }\n        const resolvedProps = DynamicShader.resolveDefaults(props, this.effectConstructors);\n        const cacheKey = DynamicShader.makeCacheKey(resolvedProps, this.effectConstructors);\n        if (cacheKey && this.shCache.has(cacheKey)) {\n            return {\n                shader: this.shCache.get(cacheKey),\n                props: resolvedProps,\n            };\n        }\n        const shader = new DynamicShader(this.renderer, props, this.effectConstructors);\n        if (cacheKey) {\n            this.shCache.set(cacheKey, shader);\n        }\n        return {\n            shader: shader,\n            props: resolvedProps,\n        };\n    }\n    useShader(shader) {\n        if (this.attachedShader === shader) {\n            return;\n        }\n        if (this.attachedShader) {\n            this.attachedShader.detach();\n        }\n        shader.attach();\n        this.attachedShader = shader;\n    }\n}\n//# sourceMappingURL=CoreShaderManager.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CoreAnimation } from './CoreAnimation.js';\nexport class AnimationManager {\n    activeAnimations = new Set();\n    registerAnimation(animation) {\n        this.activeAnimations.add(animation);\n    }\n    unregisterAnimation(animation) {\n        this.activeAnimations.delete(animation);\n    }\n    update(dt) {\n        this.activeAnimations.forEach((animation) => {\n            animation.update(dt);\n        });\n    }\n}\n//# sourceMappingURL=AnimationManager.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Texture } from './Texture.js';\n/**\n * Texture consisting of an image loaded from a URL\n *\n * @remarks\n * The ImageTexture's {@link ImageTextureProps.src} prop defines the image URL\n * to be downloaded.\n *\n * By default, the texture's alpha values will be premultiplied into its color\n * values which is generally the desired setting before they are sent to the\n * texture's associated {@link Shader}. However, in special cases you may want\n * the Shader to receive straight (non-premultiplied) values. In that case you\n * can disable the default behavior by setting the\n * {@link ImageTextureProps.premultiplyAlpha} prop to `false`.\n */\nexport class ImageTexture extends Texture {\n    props;\n    constructor(txManager, props) {\n        super(txManager);\n        this.props = ImageTexture.resolveDefaults(props);\n    }\n    async getTextureData() {\n        const { src, premultiplyAlpha } = this.props;\n        if (!src) {\n            return {\n                data: null,\n            };\n        }\n        if (src instanceof ImageData) {\n            return {\n                data: src,\n                premultiplyAlpha,\n            };\n        }\n        const response = await fetch(src);\n        const blob = await response.blob();\n        return {\n            data: await createImageBitmap(blob, {\n                premultiplyAlpha: premultiplyAlpha ? 'premultiply' : 'none',\n                colorSpaceConversion: 'none',\n                imageOrientation: 'none',\n            }),\n        };\n    }\n    static makeCacheKey(props) {\n        const resolvedProps = ImageTexture.resolveDefaults(props);\n        // ImageTextures sourced by ImageData are non-cacheable\n        if (resolvedProps.src instanceof ImageData) {\n            return false;\n        }\n        return `ImageTexture,${resolvedProps.src},${resolvedProps.premultiplyAlpha}`;\n    }\n    static resolveDefaults(props) {\n        return {\n            src: props.src ?? '',\n            premultiplyAlpha: props.premultiplyAlpha ?? true,\n        };\n    }\n    static z$__type__Props;\n}\n//# sourceMappingURL=ImageTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Texture } from './Texture.js';\n/**\n * Texture consisting of a random grid of greyscale pixels\n *\n * @remarks\n * The width and height of the NoiseTexture are defined by it's\n * {@link NoiseTextureProps.width} and {@link NoiseTextureProps.height}\n * properties. The {@link NoiseTextureProps.cacheId} prop can be varied in order\n * to bypass cache and get newly randomized texture data.\n */\nexport class NoiseTexture extends Texture {\n    props;\n    constructor(txManager, props) {\n        super(txManager);\n        this.props = NoiseTexture.resolveDefaults(props);\n    }\n    async getTextureData() {\n        const { width, height } = this.props;\n        const size = width * height * 4;\n        const pixelData8 = new Uint8ClampedArray(size);\n        for (let i = 0; i < size; i += 4) {\n            const v = Math.floor(Math.random() * 256);\n            pixelData8[i] = v;\n            pixelData8[i + 1] = v;\n            pixelData8[i + 2] = v;\n            pixelData8[i + 3] = 255;\n        }\n        return {\n            data: new ImageData(pixelData8, width, height),\n        };\n    }\n    static makeCacheKey(props) {\n        const resolvedProps = NoiseTexture.resolveDefaults(props);\n        return `NoiseTexture,${resolvedProps.width},${resolvedProps.height},${resolvedProps.cacheId}`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 128,\n            height: props.height ?? 128,\n            cacheId: props.cacheId ?? 0,\n        };\n    }\n    static z$__type__Props;\n}\n//# sourceMappingURL=NoiseTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../utils.js';\nimport { ColorTexture } from './textures/ColorTexture.js';\nimport { ImageTexture } from './textures/ImageTexture.js';\nimport { NoiseTexture } from './textures/NoiseTexture.js';\nimport { SubTexture } from './textures/SubTexture.js';\nexport class CoreTextureManager {\n    /**\n     * Amount of used memory defined in pixels\n     */\n    usedMemory = 0;\n    txConstructors = {};\n    textureKeyCache = new Map();\n    textureIdCache = new Map();\n    ctxTextureCache = new WeakMap();\n    textureRefCountMap = new WeakMap();\n    /**\n     * Renderer that this texture manager is associated with\n     *\n     * @remarks\n     * This MUST be set before the texture manager is used. Otherwise errors\n     * will occur when using the texture manager.\n     */\n    renderer;\n    constructor() {\n        // Register default known texture types\n        this.registerTextureType('ImageTexture', ImageTexture);\n        this.registerTextureType('ColorTexture', ColorTexture);\n        this.registerTextureType('NoiseTexture', NoiseTexture);\n        this.registerTextureType('SubTexture', SubTexture);\n    }\n    registerTextureType(textureType, textureClass) {\n        this.txConstructors[textureType] = textureClass;\n    }\n    loadTexture(textureType, props, options = null) {\n        const TextureClass = this.txConstructors[textureType];\n        if (!TextureClass) {\n            throw new Error(`Texture type \"${textureType}\" is not registered`);\n        }\n        let texture;\n        // If an ID is specified, try to get the texture from the ID cache first\n        if (options?.id !== undefined && this.textureIdCache.has(options.id)) {\n            // console.log('Getting texture by texture desc ID', options.id);\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            texture = this.textureIdCache.get(options.id);\n        }\n        // If the texture is not found in the ID cache, try to get it from the key cache\n        if (!texture) {\n            const descId = options?.id;\n            const cacheKey = options?.cacheKey ?? TextureClass.makeCacheKey(props);\n            if (cacheKey && this.textureKeyCache.has(cacheKey)) {\n                // console.log('Getting texture by cache key', cacheKey);\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                texture = this.textureKeyCache.get(cacheKey);\n            }\n            else {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-explicit-any\n                texture = new TextureClass(this, props);\n            }\n            if (descId) {\n                this.addTextureIdToCache(descId, cacheKey, texture);\n            }\n        }\n        if (options?.preload) {\n            const ctxTx = this.getCtxTexture(texture);\n            ctxTx.load();\n        }\n        return texture;\n    }\n    /**\n     * Add a `Texture` to the texture cache by its texture desc ID and cache key\n     *\n     * @remarks\n     * This is used internally by the `CoreTextureManager` to cache textures\n     * when they are created.\n     *\n     * It handles updating the texture ID cache, texture key cache, and texture\n     * reference count map.\n     *\n     * @param textureDescId\n     * @param cacheKey\n     * @param texture\n     */\n    addTextureIdToCache(textureDescId, cacheKey, texture) {\n        const { textureIdCache, textureRefCountMap } = this;\n        textureIdCache.set(textureDescId, texture);\n        if (textureRefCountMap.has(texture)) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            textureRefCountMap.get(texture).count++;\n        }\n        else {\n            textureRefCountMap.set(texture, { cacheKey, count: 1 });\n            if (cacheKey) {\n                this.textureKeyCache.set(cacheKey, texture);\n            }\n        }\n    }\n    /**\n     * Remove a `Texture` from the texture cache by its texture desc ID\n     *\n     * @remarks\n     * This is called externally by when we know (at least reasonably well) that\n     * the `TextureRef` in the Main API space has been is no longer used. This\n     * allows us to remove the `Texture` from the Usage Cache so that it can be\n     * garbage collected as well.\n     *\n     * @param textureDescId\n     */\n    removeTextureIdFromCache(textureDescId) {\n        const { textureIdCache, textureRefCountMap } = this;\n        const texture = textureIdCache.get(textureDescId);\n        if (!texture) {\n            // Sometimes a texture is removed from the cache before it ever gets\n            // added to the cache. This is fine and not an error.\n            return;\n        }\n        textureIdCache.delete(textureDescId);\n        if (textureRefCountMap.has(texture)) {\n            const refCountObj = textureRefCountMap.get(texture);\n            assertTruthy(refCountObj);\n            refCountObj.count--;\n            if (refCountObj.count === 0) {\n                textureRefCountMap.delete(texture);\n                // If the texture is not referenced anywhere else, remove it from the key cache\n                // as well.\n                // This should allow the `Texture` instance to be garbage collected.\n                if (refCountObj.cacheKey) {\n                    this.textureKeyCache.delete(refCountObj.cacheKey);\n                }\n            }\n        }\n    }\n    /**\n     * Get an object containing debug information about the texture manager.\n     *\n     * @returns\n     */\n    getDebugInfo() {\n        // const textureSet = new Set<Texture>();\n        // for (const texture of this.textureIdCache.values()) {\n        //   textureSet.add(texture);\n        // }\n        // for (const texture of this.textureKeyCache.values()) {\n        //   textureSet.add(texture);\n        // }\n        // TODO: Output number of bytes used by textures\n        return {\n            keyCacheSize: this.textureKeyCache.size,\n            idCacheSize: this.textureIdCache.size,\n        };\n    }\n    /**\n     * Get a CoreContextTexture for the given Texture source.\n     *\n     * @remarks\n     * If the texture source already has an allocated CoreContextTexture, it will be\n     * returned from the cache. Otherwise, a new CoreContextTexture will be created\n     * and cached.\n     *\n     * ContextTextures are stored in a WeakMap, so they will be garbage collected\n     * when the Texture source is no longer referenced.\n     *\n     * @param textureSource\n     * @returns\n     */\n    getCtxTexture(textureSource) {\n        if (this.ctxTextureCache.has(textureSource)) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            return this.ctxTextureCache.get(textureSource);\n        }\n        const texture = this.renderer.createCtxTexture(textureSource);\n        this.ctxTextureCache.set(textureSource, texture);\n        return texture;\n    }\n}\n//# sourceMappingURL=CoreTextureManager.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { SdfTrFontFace } from './font-face-types/SdfTrFontFace/SdfTrFontFace.js';\nimport { WebTrFontFace } from './font-face-types/WebTrFontFace.js';\nexport class TrFontManager {\n    textRenderers;\n    constructor(textRenderers) {\n        this.textRenderers = textRenderers;\n        // Intentionally left blank\n    }\n    addFontFace(font) {\n        // All the font face to all of the text renderers that support it\n        for (const trId in this.textRenderers) {\n            const tr = this.textRenderers[trId];\n            if (tr && tr.isFontFaceSupported(font)) {\n                tr.addFontFace(font);\n            }\n        }\n    }\n    /**\n     * Utility method to resolve a single font face from a list of prioritized family maps based on\n     * a set of font properties.\n     *\n     * @remarks\n     * These are to be used by a text renderer to resolve a font face if needed.\n     *\n     * @param familyMapsByPriority\n     * @param props\n     * @returns\n     */\n    static resolveFontFace(familyMapsByPriority, props) {\n        const closeFaces = [];\n        const exactMatch = familyMapsByPriority.reduce((prev, fontFamiles) => {\n            if (prev) {\n                return prev;\n            }\n            const fontFaces = fontFamiles[props.fontFamily];\n            if (!fontFaces) {\n                return undefined;\n            }\n            const fontFacesCopy = new Set(fontFaces);\n            // Remove any font faces that don't match the style exactly\n            // TODO: In the future we may enhance this to find the best match\n            // based on font weight, style, etc.\n            // See https://www.w3.org/TR/2018/REC-css-fonts-3-20180920/#font-matching-algorithm\n            for (const fontFace of fontFacesCopy) {\n                if (fontFace.descriptors.stretch !== props.fontStretch ||\n                    fontFace.descriptors.style !== props.fontStyle ||\n                    fontFace.descriptors.weight !== props.fontWeight) {\n                    fontFacesCopy.delete(fontFace);\n                }\n            }\n            // Return the first font face that matches the style exactly\n            return fontFacesCopy.values().next().value;\n        }, undefined);\n        return exactMatch || closeFaces[0];\n    }\n}\n//# sourceMappingURL=TrFontManager.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst trPropSetterDefaults = {\n    x: (state, value) => {\n        state.props.x = value;\n    },\n    y: (state, value) => {\n        state.props.y = value;\n    },\n    width: (state, value) => {\n        state.props.width = value;\n    },\n    height: (state, value) => {\n        state.props.height = value;\n    },\n    color: (state, value) => {\n        state.props.color = value;\n    },\n    zIndex: (state, value) => {\n        state.props.zIndex = value;\n    },\n    fontFamily: (state, value) => {\n        state.props.fontFamily = value;\n    },\n    fontWeight: (state, value) => {\n        state.props.fontWeight = value;\n    },\n    fontStyle: (state, value) => {\n        state.props.fontStyle = value;\n    },\n    fontStretch: (state, value) => {\n        state.props.fontStretch = value;\n    },\n    fontSize: (state, value) => {\n        state.props.fontSize = value;\n    },\n    text: (state, value) => {\n        state.props.text = value;\n    },\n    textAlign: (state, value) => {\n        state.props.textAlign = value;\n    },\n    contain: (state, value) => {\n        state.props.contain = value;\n    },\n    offsetY: (state, value) => {\n        state.props.offsetY = value;\n    },\n    scrollable: (state, value) => {\n        state.props.scrollable = value;\n    },\n    scrollY: (state, value) => {\n        state.props.scrollY = value;\n    },\n    letterSpacing: (state, value) => {\n        state.props.letterSpacing = value;\n    },\n    debug: (state, value) => {\n        state.props.debug = value;\n    },\n};\nexport class TextRenderer {\n    stage;\n    set;\n    constructor(stage) {\n        this.stage = stage;\n        const propSetters = {\n            ...trPropSetterDefaults,\n            ...this.getPropertySetters(),\n        };\n        // For each prop setter add a wrapper method that checks if the prop is\n        // different before calling the setter\n        this.set = Object.freeze(Object.fromEntries(Object.entries(propSetters).map(([key, setter]) => {\n            return [\n                key,\n                (state, value) => {\n                    if (state.props[key] !== value) {\n                        setter(state, value);\n                    }\n                },\n            ];\n        })));\n    }\n    setStatus(state, status, error) {\n        // Don't emit the same status twice\n        if (state.status === status) {\n            return;\n        }\n        state.status = status;\n        state.emitter.emit(status, error);\n    }\n    /**\n     * Schedule a state update via queueMicrotask\n     *\n     * @remarks\n     * This method is used to schedule a state update via queueMicrotask. This\n     * method should be called whenever a state update is needed, and it will\n     * ensure that the state is only updated once per microtask.\n     * @param state\n     * @returns\n     */\n    scheduleUpdateState(state) {\n        if (state.updateScheduled) {\n            return;\n        }\n        state.updateScheduled = true;\n        queueMicrotask(() => {\n            state.updateScheduled = false;\n            this.updateState(state);\n        });\n    }\n}\n//# sourceMappingURL=TextRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Number of floating point numbers that represent a single glyph in the SDF vertex buffer.\n *\n * @remarks\n * The vertex buffer contains:\n *  - 6 vertex positions\n *  - 6 texture coordinates\n *  - = 12 positions/coordinates per glyph\n *\n * Each vertex position and texture coordinate consist of 2 floating point numbers (x/y).\n * So there are 12 * 2 = 24 floating point numbers that make up a single glyph.\n */\nexport const FLOATS_PER_GLYPH = 24;\n//# sourceMappingURL=constants.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Gets the start conditions for the layout loop.\n *\n * @remarks\n * Returns `undefined` if the layout loop should not be run.\n *\n * @param fontSize\n * @param fontSizeRatio\n * @param sdfLineHeight\n * @param renderWindow\n * @param lineCache\n * @param textH\n * @returns\n */\nexport function getStartConditions(fontSize, offsetY, fontSizeRatio, sdfLineHeight, renderWindow, lineCache, textH) {\n    // State variables\n    let startLineIndex = 0;\n    if (renderWindow) {\n        startLineIndex = Math.min(Math.max(Math.floor(renderWindow.y1 / fontSize), 0), lineCache.length);\n    }\n    // TODO: Possibly break out startX / startY into a separate function\n    // TODO: (fontSize / 6.4286 / fontSizeRatio) Adding this to the startY helps the text line up better with Canvas rendered text\n    const startX = 0;\n    const startY = offsetY / fontSizeRatio + startLineIndex * sdfLineHeight; // TODO: Figure out what determines the initial y offset of text.\n    // Don't attempt to render anything if we know we're starting past the established end of the text\n    if (textH && startY >= textH / fontSizeRatio) {\n        return;\n    }\n    return {\n        x: startX,\n        y: startY,\n        lineIndex: startLineIndex,\n    };\n}\n//# sourceMappingURL=getStartConditions.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * A wrapper Generator class that makes a generator peekable.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport class PeekableIterator {\n    iterator;\n    peekBuffer = [];\n    _lastIndex;\n    constructor(iterator, indexBase = 0) {\n        this.iterator = iterator;\n        this.iterator = iterator;\n        this._lastIndex = indexBase - 1;\n        this.peekBuffer = [];\n    }\n    next() {\n        const nextResult = this.peekBuffer.length > 0\n            ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                this.peekBuffer.pop()\n            : this.iterator.next();\n        if (nextResult.done) {\n            this._lastIndex = -1;\n        }\n        else {\n            this._lastIndex++;\n        }\n        return nextResult;\n    }\n    peek() {\n        if (this.peekBuffer.length > 0) {\n            // We know that the buffer is not empty, so we can safely use the\n            // non-null assertion operator\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            return this.peekBuffer[0];\n        }\n        const result = this.iterator.next();\n        this.peekBuffer.push(result);\n        return result;\n    }\n    get lastIndex() {\n        return this._lastIndex;\n    }\n}\n//# sourceMappingURL=PeekableGenerator.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Reversible Generator Wrapper Class\n/**\n * Generator function that yields each Unicode code point in the given string.\n */\nexport function* getUnicodeCodepoints(text, start = 0) {\n    let i = start;\n    while (i < text.length) {\n        const codePoint = text.codePointAt(i);\n        if (codePoint === undefined) {\n            throw new Error('Invalid Unicode code point');\n        }\n        yield codePoint;\n        i += codePoint <= 0xffff ? 1 : 2;\n    }\n}\n//# sourceMappingURL=getUnicodeCodepoints.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { PeekableIterator } from './PeekableGenerator.js';\nimport { getUnicodeCodepoints } from './getUnicodeCodepoints.js';\n/**\n * Measures a single-line of text width ignoring any unmapped glyphs including line breaks\n *\n * @param text\n * @param shaperProps\n * @param shaper\n * @returns\n */\nexport function measureText(text, shaperProps, shaper) {\n    const glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, 0), 0));\n    let width = 0;\n    for (const glyph of glyphs) {\n        if (glyph.mapped) {\n            width += glyph.xAdvance;\n        }\n    }\n    return width;\n}\n//# sourceMappingURL=measureText.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../../../../utils.js';\nimport { PeekableIterator } from './PeekableGenerator.js';\nimport { getUnicodeCodepoints } from './getUnicodeCodepoints.js';\nimport { measureText } from './measureText.js';\nexport function layoutText(curLineIndex, startX, startY, text, textAlign, width, height, fontSize, letterSpacing, \n/**\n * Mutated\n */\nvertexBuffer, contain, \n/**\n * Mutated\n */\nlineCache, renderWindow, trFontFace, forceFullLayoutCalc, scrollable) {\n    assertTruthy(trFontFace, 'Font face must be loaded');\n    assertTruthy(trFontFace.loaded, 'Font face must be loaded');\n    assertTruthy(trFontFace.data, 'Font face must be loaded');\n    assertTruthy(trFontFace.shaper, 'Font face must be loaded');\n    // Regardless of fontSize (or other scaling properties), we layout the vertices of each glyph\n    // using the fixed coordinate space determined by font size used to produce the atlas.\n    // Scaling for display is handled by shader uniforms inexpensively.\n    // So we have:\n    //  - vertex space: the space in which the vertices of each glyph are laid out\n    //  - screen space: the screen pixel space\n    // Input properties such as x, y, w, fontSize, letterSpacing, etc. are all expressed in screen space.\n    // We convert these to the vertex space by dividing them the `fontSizeRatio` factor.\n    /**\n     * `lineHeight` in vertex coordinates\n     */\n    const vertexLineHeight = trFontFace.data.info.size;\n    /**\n     * See above\n     */\n    const fontSizeRatio = fontSize / vertexLineHeight;\n    /**\n     * `w` in vertex coordinates\n     */\n    const vertexW = width / fontSizeRatio;\n    /**\n     * `letterSpacing` in vertex coordinates\n     */\n    const vertexLSpacing = letterSpacing / fontSizeRatio;\n    const startingLineCacheEntry = lineCache[curLineIndex];\n    const startingCodepointIndex = startingLineCacheEntry?.codepointIndex || 0;\n    const startingMaxX = startingLineCacheEntry?.maxX || 0;\n    const startingMaxY = startingLineCacheEntry?.maxY || 0;\n    let maxX = startingMaxX;\n    let maxY = startingMaxY;\n    let curX = startX;\n    let curY = startY;\n    let bufferOffset = 0;\n    /**\n     * Buffer offset to last word boundry. This is -1 when we aren't in a word boundry.\n     */\n    const lastWord = {\n        codepointIndex: -1,\n        bufferOffset: -1,\n        xStart: -1,\n    };\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const shaper = trFontFace.shaper;\n    const shaperProps = {\n        letterSpacing: vertexLSpacing,\n    };\n    // Get glyphs\n    let glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, startingCodepointIndex), startingCodepointIndex));\n    let glyphResult;\n    let curLineBufferStart = -1;\n    const bufferLineInfos = [];\n    const truncateSeq = '...';\n    const vertexTruncateHeight = height / fontSizeRatio;\n    const truncateSeqVertexWidth = measureText(truncateSeq, shaperProps, shaper);\n    // Line-by-line layout\n    let moreLines = true;\n    while (moreLines) {\n        const nextLineWillFit = contain !== 'both' ||\n            scrollable ||\n            curY + vertexLineHeight + vertexLineHeight <= vertexTruncateHeight;\n        const lineVertexW = nextLineWillFit\n            ? vertexW\n            : vertexW - truncateSeqVertexWidth;\n        /**\n         * Vertex X position to the beginning of the last word boundary. This becomes -1 when we start traversing a word.\n         */\n        let xStartLastWordBoundary = 0;\n        // Layout glyphs in this line\n        // Any break statements in this while loop will trigger a line break\n        while ((glyphResult = glyphs.next()) && !glyphResult.done) {\n            const glyph = glyphResult.value;\n            if (curLineIndex === lineCache.length) {\n                lineCache.push({\n                    codepointIndex: glyph.cluster,\n                    maxY,\n                    maxX,\n                });\n            }\n            else if (curLineIndex > lineCache.length) {\n                throw new Error('Unexpected lineCache length');\n            }\n            // If we encounter a word boundary (white space or newline) we invalidate\n            // the lastWord and set the xStartLastWordBoundary if we haven't already.\n            if (glyph.codepoint === 32 || glyph.codepoint === 10) {\n                if (lastWord.codepointIndex !== -1) {\n                    lastWord.codepointIndex = -1;\n                    xStartLastWordBoundary = curX;\n                }\n            }\n            else if (lastWord.codepointIndex === -1) {\n                lastWord.codepointIndex = glyph.cluster;\n                lastWord.bufferOffset = bufferOffset;\n                lastWord.xStart = xStartLastWordBoundary;\n            }\n            if (glyph.mapped) {\n                // Mapped glyph\n                const charEndX = curX + glyph.xOffset + glyph.width;\n                // Word wrap check\n                if (\n                // We are containing the text\n                contain !== 'none' &&\n                    // The current glyph reaches outside the contained width\n                    charEndX >= lineVertexW &&\n                    // There is a last word that we can break to the next line\n                    lastWord.codepointIndex !== -1 &&\n                    // We have advanced at least one character since the last word started\n                    lastWord.codepointIndex < glyph.cluster &&\n                    // Prevents infinite loop when a single word is longer than the width\n                    lastWord.xStart > 0) {\n                    // The current word is about to go off the edge of the container width\n                    // Reinitialize the iterator starting at the last word\n                    // and proceeding to the next line\n                    if (nextLineWillFit) {\n                        glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, lastWord.codepointIndex), lastWord.codepointIndex));\n                        bufferOffset = lastWord.bufferOffset;\n                        break;\n                    }\n                    else {\n                        glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(truncateSeq, 0), 0));\n                        curX = lastWord.xStart;\n                        bufferOffset = lastWord.bufferOffset;\n                    }\n                }\n                else {\n                    // This glyph fits, so we can add it to the buffer\n                    const quadX = curX + glyph.xOffset;\n                    const quadY = curY + glyph.yOffset;\n                    const lineIsBelowWindowTop = renderWindow\n                        ? curY + vertexLineHeight >= renderWindow.y1 / fontSizeRatio\n                        : true;\n                    const lineIsAboveWindowBottom = renderWindow\n                        ? curY <= renderWindow.y2 / fontSizeRatio\n                        : true;\n                    // Only add to buffer for rendering if the line is within the render window\n                    if (lineIsBelowWindowTop && lineIsAboveWindowBottom) {\n                        if (curLineBufferStart === -1) {\n                            curLineBufferStart = bufferOffset;\n                        }\n                        const atlasEntry = trFontFace.getAtlasEntry(glyph.glyphId);\n                        // Add texture coordinates\n                        const u = atlasEntry.x / trFontFace.data.common.scaleW;\n                        const v = atlasEntry.y / trFontFace.data.common.scaleH;\n                        const uvWidth = atlasEntry.width / trFontFace.data.common.scaleW;\n                        const uvHeight = atlasEntry.height / trFontFace.data.common.scaleH;\n                        // TODO: (Performance) We can optimize this by using ELEMENT_ARRAY_BUFFER\n                        // eliminating the need to duplicate vertices\n                        // Top-left\n                        vertexBuffer[bufferOffset++] = quadX;\n                        vertexBuffer[bufferOffset++] = quadY;\n                        vertexBuffer[bufferOffset++] = u;\n                        vertexBuffer[bufferOffset++] = v;\n                        // Top-right\n                        vertexBuffer[bufferOffset++] = quadX + glyph.width;\n                        vertexBuffer[bufferOffset++] = quadY;\n                        vertexBuffer[bufferOffset++] = u + uvWidth;\n                        vertexBuffer[bufferOffset++] = v;\n                        // Bottom-left\n                        vertexBuffer[bufferOffset++] = quadX;\n                        vertexBuffer[bufferOffset++] = quadY + glyph.height;\n                        vertexBuffer[bufferOffset++] = u;\n                        vertexBuffer[bufferOffset++] = v + uvHeight;\n                        // Bottom-right\n                        vertexBuffer[bufferOffset++] = quadX + glyph.width;\n                        vertexBuffer[bufferOffset++] = quadY + glyph.height;\n                        vertexBuffer[bufferOffset++] = u + uvWidth;\n                        vertexBuffer[bufferOffset++] = v + uvHeight;\n                    }\n                    maxY = Math.max(maxY, quadY + glyph.height);\n                    curX += glyph.xAdvance;\n                    maxX = Math.max(maxX, curX);\n                }\n            }\n            else {\n                // Unmapped character\n                // Handle newlines\n                if (glyph.codepoint === 10) {\n                    break;\n                }\n            }\n        }\n        // Prepare for the next line...\n        if (curLineBufferStart !== -1) {\n            bufferLineInfos.push({\n                bufferStart: curLineBufferStart,\n                bufferEnd: bufferOffset,\n            });\n            curLineBufferStart = -1;\n        }\n        curX = 0;\n        curY += vertexLineHeight;\n        curLineIndex++;\n        lastWord.codepointIndex = -1;\n        xStartLastWordBoundary = 0;\n        // Figure out if there are any more lines to render...\n        if (!forceFullLayoutCalc &&\n            contain === 'both' &&\n            renderWindow &&\n            curY > renderWindow.y2 / fontSizeRatio) {\n            // Stop layout calculation early (for performance purposes) if:\n            // - We're not forcing a full layout calculation (for width/height calculation)\n            // - ...and we're containing the text vertically+horizontally (contain === 'both')\n            // - ...and we have a render window\n            // - ...and the next line is below the bottom of the render window\n            moreLines = false;\n        }\n        else if (glyphResult && glyphResult.done) {\n            // If we've reached the end of the text, we know we're done\n            moreLines = false;\n        }\n        else if (contain === 'both' && !scrollable && !nextLineWillFit) {\n            // If we're contained vertically+horizontally (contain === 'both')\n            // but not scrollable and the next line won't fit, we're done.\n            moreLines = false;\n        }\n    }\n    // Use textAlign to determine if we need to adjust the x position of the text\n    // in the buffer line by line\n    if (textAlign === 'center') {\n        const vertexTextW = contain === 'none' ? maxX : vertexW;\n        for (let i = 0; i < bufferLineInfos.length; i++) {\n            const line = bufferLineInfos[i];\n            // - 4 = the x position of a rightmost vertex\n            const lineWidth = \n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            vertexBuffer[line.bufferEnd - 4] - vertexBuffer[line.bufferStart];\n            const xOffset = (vertexTextW - lineWidth) / 2;\n            for (let j = line.bufferStart; j < line.bufferEnd; j += 4) {\n                vertexBuffer[j] += xOffset;\n            }\n        }\n    }\n    else if (textAlign === 'right') {\n        const vertexTextW = contain === 'none' ? maxX : vertexW;\n        for (let i = 0; i < bufferLineInfos.length; i++) {\n            const line = bufferLineInfos[i];\n            const lineWidth = line.bufferEnd === line.bufferStart\n                ? 0\n                : // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                    vertexBuffer[line.bufferEnd - 4] - vertexBuffer[line.bufferStart];\n            const xOffset = vertexTextW - lineWidth;\n            for (let j = line.bufferStart; j < line.bufferEnd; j += 4) {\n                vertexBuffer[j] += xOffset;\n            }\n        }\n    }\n    assertTruthy(glyphResult);\n    return {\n        bufferNumFloats: bufferOffset,\n        bufferNumQuads: bufferOffset / 16,\n        layoutNumCharacters: glyphResult.done\n            ? text.length - startingCodepointIndex\n            : glyphResult.value.cluster - startingCodepointIndex + 1,\n        fullyProcessed: !!glyphResult.done,\n        maxX,\n        maxY,\n    };\n}\n//# sourceMappingURL=layoutText.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { isBoundPositive } from '../../../../lib/utils.js';\n/**\n * Create a render window from the given parameters.\n *\n * @remarks\n * The render window is a rectangle that defines the area of the text that\n * should be rendered. It is used to skip rendering parts of the text that\n * are outside of the render window. The render window is relative to the\n * text's top left corner of the overrall text.\n *\n * @param x The x coordinate of the text element's top left corner relative to the screen.\n * @param y The y coordinate of the text element's top left corner relative to the screen.\n * @param scrollY The amount of pixels to scroll the text vertically.\n * @param lineHeight The height of a single line of text.\n * @param numExtraLines The number of extra lines to render above and below the visible window.\n * @param visibleWindow The visible window of the text element relative to the screen\n * @returns\n */\nexport function makeRenderWindow(x, y, scrollY, lineHeight, numExtraLines, visibleWindow) {\n    const bufferMargin = lineHeight * numExtraLines;\n    const x1 = visibleWindow.x1 - x;\n    const y1 = visibleWindow.y1 - y;\n    return isBoundPositive(visibleWindow)\n        ? {\n            x1: x1,\n            y1: y1 + scrollY - bufferMargin,\n            x2: x1 + (visibleWindow.x2 - visibleWindow.x1),\n            y2: y1 + scrollY + (visibleWindow.y2 - visibleWindow.y1) + bufferMargin,\n        }\n        : {\n            x1: 0,\n            y1: 0,\n            x2: 0,\n            y2: 0,\n        };\n}\n//# sourceMappingURL=makeRenderWindow.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { intersectBound, createBound, } from '../../../lib/utils.js';\nimport { TextRenderer, } from '../TextRenderer.js';\nimport { SdfTrFontFace } from '../../font-face-types/SdfTrFontFace/SdfTrFontFace.js';\nimport { FLOATS_PER_GLYPH } from './internal/constants.js';\nimport { getStartConditions } from './internal/getStartConditions.js';\nimport { layoutText } from './internal/layoutText.js';\nimport { makeRenderWindow } from './internal/makeRenderWindow.js';\nimport { TrFontManager } from '../../TrFontManager.js';\nimport { assertTruthy, mergeColorAlpha } from '../../../../utils.js';\nimport { WebGlCoreRenderOp } from '../../../renderers/webgl/WebGlCoreRenderOp.js';\nimport { BufferCollection } from '../../../renderers/webgl/internal/BufferCollection.js';\nimport { EventEmitter } from '../../../../common/EventEmitter.js';\n/**\n * Ephemeral bounds object used for intersection calculations\n *\n * @remarks\n * Used to avoid creating a new object every time we need to intersect\n * element bounds.\n */\nconst tmpElementBounds = createBound(0, 0, 0, 0);\n/**\n * Singleton class for rendering text using signed distance fields.\n *\n * @remarks\n * SdfTextRenderer supports both single-channel and multi-channel signed distance fields.\n */\nexport class SdfTextRenderer extends TextRenderer {\n    /**\n     * Map of font family names to a set of font faces.\n     */\n    ssdfFontFamilies = {};\n    msdfFontFamilies = {};\n    sdfShader;\n    rendererBounds;\n    constructor(stage) {\n        super(stage);\n        this.sdfShader = this.stage.shManager.loadShader('SdfShader').shader;\n        this.rendererBounds = {\n            x1: 0,\n            y1: 0,\n            x2: this.stage.options.appWidth,\n            y2: this.stage.options.appHeight,\n        };\n    }\n    //#region Overrides\n    getPropertySetters() {\n        return {\n            fontFamily: (state, value) => {\n                state.props.fontFamily = value;\n                state.trFontFace = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontWeight: (state, value) => {\n                state.props.fontWeight = value;\n                state.trFontFace = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontStyle: (state, value) => {\n                state.props.fontStyle = value;\n                state.trFontFace = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontStretch: (state, value) => {\n                state.props.fontStretch = value;\n                state.trFontFace = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontSize: (state, value) => {\n                state.props.fontSize = value;\n                this.invalidateLayoutCache(state);\n            },\n            text: (state, value) => {\n                state.props.text = value;\n                this.invalidateLayoutCache(state);\n            },\n            textAlign: (state, value) => {\n                state.props.textAlign = value;\n                this.invalidateLayoutCache(state);\n            },\n            color: (state, value) => {\n                state.props.color = value;\n            },\n            x: (state, value) => {\n                state.props.x = value;\n                this.invalidateVisibleWindowCache(state);\n            },\n            y: (state, value) => {\n                state.props.y = value;\n                this.invalidateVisibleWindowCache(state);\n            },\n            contain: (state, value) => {\n                state.props.contain = value;\n                this.invalidateLayoutCache(state);\n            },\n            width: (state, value) => {\n                state.props.width = value;\n                this.invalidateLayoutCache(state);\n            },\n            height: (state, value) => {\n                state.props.height = value;\n                this.invalidateLayoutCache(state);\n            },\n            offsetY: (state, value) => {\n                state.props.offsetY = value;\n                this.invalidateLayoutCache(state);\n            },\n            scrollable: (state, value) => {\n                state.props.scrollable = value;\n                this.invalidateLayoutCache(state);\n            },\n            scrollY: (state, value) => {\n                state.props.scrollY = value;\n                // Scrolling doesn't need to invalidate any caches, but it does need to\n                // schedule an update\n                this.scheduleUpdateState(state);\n            },\n            letterSpacing: (state, value) => {\n                state.props.letterSpacing = value;\n                this.invalidateLayoutCache(state);\n            },\n            debug: (state, value) => {\n                state.props.debug = value;\n            },\n        };\n    }\n    canRenderFont(props) {\n        // TODO: Support matching on font stretch, weight and style (if/when needed)\n        // For now we just match on the font family name\n        // '$$SDF_FAILURE_TEST$$' is used to test the 'failure' event coming from text\n        const { fontFamily } = props;\n        return (fontFamily in this.ssdfFontFamilies ||\n            fontFamily in this.msdfFontFamilies ||\n            fontFamily === '$$SDF_FAILURE_TEST$$');\n    }\n    isFontFaceSupported(fontFace) {\n        return fontFace instanceof SdfTrFontFace;\n    }\n    addFontFace(fontFace) {\n        // Make sure the font face is an SDF font face (it should have already passed\n        // the `isFontFaceSupported` check)\n        assertTruthy(fontFace instanceof SdfTrFontFace);\n        const familyName = fontFace.fontFamily;\n        const fontFamiles = fontFace.type === 'ssdf'\n            ? this.ssdfFontFamilies\n            : fontFace.type === 'msdf'\n                ? this.msdfFontFamilies\n                : undefined;\n        if (!fontFamiles) {\n            console.warn(`Invalid font face type: ${fontFace.type}`);\n            return;\n        }\n        let faceSet = fontFamiles[familyName];\n        if (!faceSet) {\n            faceSet = new Set();\n            fontFamiles[familyName] = faceSet;\n        }\n        faceSet.add(fontFace);\n    }\n    createState(props) {\n        return {\n            props,\n            status: 'initialState',\n            updateScheduled: false,\n            emitter: new EventEmitter(),\n            lineCache: [],\n            forceFullLayoutCalc: false,\n            renderWindow: undefined,\n            visibleWindow: {\n                x1: 0,\n                y1: 0,\n                x2: 0,\n                y2: 0,\n                valid: false,\n            },\n            bufferNumFloats: 0,\n            bufferNumQuads: 0,\n            vertexBuffer: undefined,\n            webGlBuffers: null,\n            bufferUploaded: false,\n            textH: undefined,\n            textW: undefined,\n            distanceRange: 0,\n            trFontFace: undefined,\n            debugData: {\n                updateCount: 0,\n                layoutCount: 0,\n                lastLayoutNumCharacters: 0,\n                layoutSum: 0,\n                drawSum: 0,\n                drawCount: 0,\n                bufferSize: 0,\n            },\n        };\n    }\n    updateState(state) {\n        let { trFontFace } = state;\n        const { textH, lineCache, debugData, forceFullLayoutCalc } = state;\n        debugData.updateCount++;\n        // On the first update call we need to set the status to loading\n        if (state.status === 'initialState') {\n            this.setStatus(state, 'loading');\n        }\n        // Resolve font face if we haven't yet\n        if (!trFontFace) {\n            trFontFace = this.resolveFontFace(state.props);\n            state.trFontFace = trFontFace;\n            if (!trFontFace) {\n                const msg = `SdfTextRenderer: Could not resolve font face for family: '${state.props.fontFamily}'`;\n                console.error(msg);\n                this.setStatus(state, 'failed', new Error(msg));\n                return;\n            }\n        }\n        // If the font hasn't been loaded yet, stop here.\n        // Listen for the 'loaded' event and forward fontLoaded event\n        if (!trFontFace.loaded) {\n            trFontFace.once('loaded', () => {\n                this.scheduleUpdateState(state);\n            });\n            return;\n        }\n        // If the font is loaded then so should the data\n        assertTruthy(trFontFace.data, 'Font face data should be loaded');\n        const { text, fontSize, x, y, contain, width, height, scrollable } = state.props;\n        // scrollY only has an effect when contain === 'both' and scrollable === true\n        const scrollY = contain === 'both' && scrollable ? state.props.scrollY : 0;\n        let { renderWindow } = state;\n        // Needed in renderWindow calculation\n        const sdfLineHeight = trFontFace.data.info.size;\n        /**\n         * Divide screen space points by this to get the SDF space points\n         * Mulitple SDF space points by this to get screen space points\n         */\n        const fontSizeRatio = fontSize / sdfLineHeight;\n        state.distanceRange =\n            fontSizeRatio * trFontFace.data.distanceField.distanceRange;\n        // Allocate buffers if needed\n        const neededLength = text.length * FLOATS_PER_GLYPH;\n        let vertexBuffer = state.vertexBuffer;\n        if (!vertexBuffer || vertexBuffer.length < neededLength) {\n            vertexBuffer = new Float32Array(neededLength * 2);\n        }\n        const visibleWindow = state.visibleWindow;\n        // If the visibleWindow is not valid, calculate it\n        if (!visibleWindow.valid) {\n            // Figure out whats actually in the bounds of the renderer/canvas (visibleWindow)\n            const elementBounds = createBound(x, y, contain !== 'none' ? x + width : Infinity, contain === 'both' ? y + height : Infinity, tmpElementBounds);\n            /**\n             * Area that is visible on the screen.\n             */\n            intersectBound(this.rendererBounds, elementBounds, state.visibleWindow);\n            visibleWindow.valid = true;\n        }\n        // Return early if we're still viewing inside the established render window\n        // No need to re-render what we've already rendered\n        // (Only if there's an established renderWindow and we're not suppressing early exit)\n        if (!forceFullLayoutCalc && renderWindow) {\n            if (x + renderWindow.x1 <= visibleWindow.x1 &&\n                x + renderWindow.x2 >= visibleWindow.x2 &&\n                y - scrollY + renderWindow.y1 <= visibleWindow.y1 &&\n                y - scrollY + renderWindow.y2 >= visibleWindow.y2) {\n                this.setStatus(state, 'loaded');\n                return;\n            }\n            // Otherwise clear the renderWindow so it can be redone\n            renderWindow = state.renderWindow = undefined;\n            this.setStatus(state, 'loading');\n        }\n        const { offsetY, textAlign } = state.props;\n        // Create a new renderWindow if needed\n        if (!renderWindow) {\n            const visibleWindowHeight = visibleWindow.y2 - visibleWindow.y1;\n            const maxLinesPerCanvasPage = Math.ceil(visibleWindowHeight / sdfLineHeight);\n            renderWindow = makeRenderWindow(x, y, scrollY, sdfLineHeight, maxLinesPerCanvasPage, visibleWindow);\n        }\n        const start = getStartConditions(fontSize, offsetY, fontSizeRatio, sdfLineHeight, renderWindow, lineCache, textH);\n        if (!start) {\n            // Nothing to render, return early, but still mark as loaded (since the text is just scrolled\n            // out of view)\n            this.setStatus(state, 'loaded');\n            return;\n        }\n        const { letterSpacing } = state.props;\n        const out2 = layoutText(start.lineIndex, start.x, start.y, text, textAlign, width, height, fontSize, letterSpacing, vertexBuffer, contain, lineCache, renderWindow, trFontFace, forceFullLayoutCalc, scrollable);\n        state.bufferUploaded = false;\n        state.bufferNumFloats = out2.bufferNumFloats;\n        state.bufferNumQuads = out2.bufferNumQuads;\n        state.vertexBuffer = vertexBuffer;\n        state.renderWindow = renderWindow;\n        debugData.lastLayoutNumCharacters = out2.layoutNumCharacters;\n        debugData.bufferSize = vertexBuffer.byteLength;\n        // If we didn't exit early, we know we have completely computed w/h\n        if (out2.fullyProcessed) {\n            state.textW = out2.maxX * fontSizeRatio;\n            state.textH = out2.maxY * fontSizeRatio;\n        }\n        // if (state.props.debug.printLayoutTime) {\n        //   debugData.layoutSum += performance.now() - updateStartTime;\n        //   debugData.layoutCount++;\n        // }\n        this.setStatus(state, 'loaded');\n    }\n    renderQuads(state, transform, clippingRect, alpha) {\n        if (!state.vertexBuffer) {\n            // Nothing to draw\n            return;\n        }\n        const drawStartTime = performance.now();\n        const { sdfShader } = this;\n        const { renderer } = this.stage;\n        const { appWidth, appHeight } = this.stage.options;\n        const { fontSize, color, contain, scrollable, zIndex, debug } = state.props;\n        // scrollY only has an effect when contain === 'both' and scrollable === true\n        const scrollY = contain === 'both' && scrollable ? state.props.scrollY : 0;\n        const { textW = 0, textH = 0, distanceRange, vertexBuffer, bufferUploaded, trFontFace, } = state;\n        let { webGlBuffers } = state;\n        if (!webGlBuffers) {\n            const gl = renderer.gl;\n            const stride = 4 * Float32Array.BYTES_PER_ELEMENT;\n            const webGlBuffer = gl.createBuffer();\n            assertTruthy(webGlBuffer);\n            state.webGlBuffers = new BufferCollection([\n                {\n                    buffer: webGlBuffer,\n                    attributes: {\n                        a_position: {\n                            name: 'a_position',\n                            size: 2,\n                            type: gl.FLOAT,\n                            normalized: false,\n                            stride,\n                            offset: 0, // start at the beginning of the buffer\n                        },\n                        a_textureCoordinate: {\n                            name: 'a_textureCoordinate',\n                            size: 2,\n                            type: gl.FLOAT,\n                            normalized: false,\n                            stride,\n                            offset: 2 * Float32Array.BYTES_PER_ELEMENT,\n                        },\n                    },\n                },\n            ]);\n            state.bufferUploaded = false;\n            assertTruthy(state.webGlBuffers);\n            webGlBuffers = state.webGlBuffers;\n        }\n        if (!bufferUploaded) {\n            const gl = renderer.gl;\n            const buffer = webGlBuffers?.getBuffer('a_textureCoordinate') ?? null;\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n            gl.bufferData(gl.ARRAY_BUFFER, vertexBuffer, gl.STATIC_DRAW);\n            state.bufferUploaded = true;\n        }\n        assertTruthy(trFontFace);\n        const renderOp = new WebGlCoreRenderOp(renderer.gl, renderer.options, webGlBuffers, this.sdfShader, {\n            transform: transform.data,\n            // IMPORTANT: The SDF Shader expects the color NOT to be premultiplied\n            // for the best blending results. Which is why we use `mergeColorAlpha`\n            // instead of `mergeColorAlphaPremultiplied` here.\n            color: mergeColorAlpha(color, alpha),\n            size: fontSize / (trFontFace.data?.info.size || 0),\n            scrollY,\n            distanceRange,\n            debug: debug.sdfShaderDebug,\n        }, alpha, clippingRect, { height: textH, width: textW }, 0, zIndex);\n        const texture = state.trFontFace?.texture;\n        assertTruthy(texture);\n        const ctxTexture = this.stage.txManager.getCtxTexture(texture);\n        renderOp.addTexture(ctxTexture);\n        renderOp.length = state.bufferNumFloats;\n        renderOp.numQuads = state.bufferNumQuads;\n        renderer.addRenderOp(renderOp);\n        // const elementRect = {\n        //   x: x,\n        //   y: y,\n        //   w: contain !== 'none' ? width : textW,\n        //   h: contain === 'both' ? height : textH,\n        // };\n        // const visibleRect = intersectRect(\n        //   {\n        //     x: 0,\n        //     y: 0,\n        //     w: renderer.w,\n        //     h: renderer.h,\n        //   },\n        //   elementRect,\n        // );\n        // if (!debug.disableScissor) {\n        //   renderer.enableScissor(\n        //     visibleRect.x,\n        //     visibleRect.y,\n        //     visibleRect.w,\n        //     visibleRect.h,\n        //   );\n        // }\n        // Draw the arrays\n        // gl.drawArrays(\n        //   gl.TRIANGLES, // Primitive type\n        //   0,\n        //   bufferNumVertices, // Number of verticies\n        // );\n        // renderer.disableScissor();\n        // if (debug.showElementRect) {\n        //   this.renderer.drawBorder(\n        //     Colors.Blue,\n        //     elementRect.x,\n        //     elementRect.y,\n        //     elementRect.w,\n        //     elementRect.h,\n        //   );\n        // }\n        // if (debug.showVisibleRect) {\n        //   this.renderer.drawBorder(\n        //     Colors.Green,\n        //     visibleRect.x,\n        //     visibleRect.y,\n        //     visibleRect.w,\n        //     visibleRect.h,\n        //   );\n        // }\n        // if (debug.showRenderWindow && renderWindow) {\n        //   this.renderer.drawBorder(\n        //     Colors.Red,\n        //     x + renderWindow.x1,\n        //     y + renderWindow.y1 - scrollY,\n        //     x + renderWindow.x2 - (x + renderWindow.x1),\n        //     y + renderWindow.y2 - scrollY - (y + renderWindow.y1 - scrollY),\n        //   );\n        // }\n        // if (debug.printLayoutTime) {\n        //   debugData.drawSum += performance.now() - drawStartTime;\n        //   debugData.drawCount++;\n        // }\n    }\n    //#endregion Overrides\n    resolveFontFace(props) {\n        return TrFontManager.resolveFontFace([this.msdfFontFamilies, this.ssdfFontFamilies], props);\n    }\n    /**\n     * Invalidate the visible window stored in the state. This will cause a new\n     * visible window to be calculated on the next update.\n     *\n     * @param state\n     */\n    invalidateVisibleWindowCache(state) {\n        state.visibleWindow.valid = false;\n        this.scheduleUpdateState(state);\n    }\n    /**\n     * Invalidate the layout cache stored in the state. This will cause the text\n     * to be re-layed out on the next update.\n     *\n     * @remarks\n     * This also invalidates the visible window cache.\n     *\n     * @param state\n     */\n    invalidateLayoutCache(state) {\n        state.visibleWindow.valid = false;\n        state.renderWindow = undefined;\n        state.textH = undefined;\n        state.textW = undefined;\n        state.lineCache = [];\n        this.setStatus(state, 'loading');\n        this.scheduleUpdateState(state);\n    }\n}\n//# sourceMappingURL=SdfTextRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { getRgbaString } from '../../lib/utils.js';\nconst MAX_TEXTURE_DIMENSION = 2048;\nexport class LightningTextTextureRenderer {\n    _canvas;\n    _context;\n    _settings;\n    renderInfo;\n    constructor(canvas, context) {\n        this._canvas = canvas;\n        this._context = context;\n        this._settings = this.mergeDefaults({});\n    }\n    set settings(v) {\n        this._settings = this.mergeDefaults(v);\n    }\n    get settings() {\n        return this._settings;\n    }\n    getPrecision() {\n        return this._settings.precision;\n    }\n    setFontProperties() {\n        this._context.font = this._getFontSetting();\n        this._context.textBaseline = this._settings.textBaseline;\n    }\n    _getFontSetting() {\n        const ff = [this._settings.fontFace];\n        const ffs = [];\n        for (let i = 0, n = ff.length; i < n; i++) {\n            if (ff[i] === 'serif' || ff[i] === 'sans-serif') {\n                ffs.push(ff[i]);\n            }\n            else {\n                ffs.push(`\"${ff[i]}\"`);\n            }\n        }\n        return `${this._settings.fontStyle} ${this._settings.fontSize * this.getPrecision()}px ${ffs.join(',')}`;\n    }\n    _load() {\n        if (true && document.fonts) {\n            const fontSetting = this._getFontSetting();\n            try {\n                if (!document.fonts.check(fontSetting, this._settings.text)) {\n                    // Use a promise that waits for loading.\n                    return document.fonts\n                        .load(fontSetting, this._settings.text)\n                        .catch((err) => {\n                        // Just load the fallback font.\n                        console.warn('[Lightning] Font load error', err, fontSetting);\n                    })\n                        .then(() => {\n                        if (!document.fonts.check(fontSetting, this._settings.text)) {\n                            console.warn('[Lightning] Font not found', fontSetting);\n                        }\n                    });\n                }\n            }\n            catch (e) {\n                console.warn(\"[Lightning] Can't check font loading for \" + fontSetting);\n            }\n        }\n    }\n    calculateRenderInfo() {\n        const renderInfo = {};\n        const precision = this.getPrecision();\n        const paddingLeft = this._settings.paddingLeft * precision;\n        const paddingRight = this._settings.paddingRight * precision;\n        const fontSize = this._settings.fontSize * precision;\n        let offsetY = this._settings.offsetY === null\n            ? null\n            : this._settings.offsetY * precision;\n        let lineHeight = (this._settings.lineHeight || fontSize) * precision;\n        const w = this._settings.w * precision;\n        const h = this._settings.h * precision;\n        let wordWrapWidth = this._settings.wordWrapWidth * precision;\n        const cutSx = this._settings.cutSx * precision;\n        const cutEx = this._settings.cutEx * precision;\n        const cutSy = this._settings.cutSy * precision;\n        const cutEy = this._settings.cutEy * precision;\n        const letterSpacing = (this._settings.letterSpacing || 0) * precision;\n        const textIndent = this._settings.textIndent * precision;\n        // Set font properties.\n        this.setFontProperties();\n        // Total width.\n        let width = w || 2048 / this.getPrecision();\n        // Inner width.\n        let innerWidth = width - paddingLeft;\n        if (innerWidth < 10) {\n            width += 10 - innerWidth;\n            innerWidth = 10;\n        }\n        if (!wordWrapWidth) {\n            wordWrapWidth = innerWidth;\n        }\n        // Text overflow\n        if (this._settings.textOverflow && !this._settings.wordWrap) {\n            let suffix;\n            switch (this._settings.textOverflow) {\n                case 'clip':\n                    suffix = '';\n                    break;\n                case 'ellipsis':\n                    suffix = this._settings.maxLinesSuffix;\n                    break;\n                default:\n                    suffix = this._settings.textOverflow;\n            }\n            this._settings.text = this.wrapWord(this._settings.text, wordWrapWidth - textIndent, suffix);\n        }\n        // word wrap\n        // preserve original text\n        let linesInfo;\n        if (this._settings.wordWrap) {\n            linesInfo = this.wrapText(this._settings.text, wordWrapWidth, letterSpacing, textIndent);\n        }\n        else {\n            linesInfo = { l: this._settings.text.split(/(?:\\r\\n|\\r|\\n)/), n: [] };\n            const n = linesInfo.l.length;\n            for (let i = 0; i < n - 1; i++) {\n                linesInfo.n.push(i);\n            }\n        }\n        let lines = linesInfo.l;\n        if (this._settings.maxLines && lines.length > this._settings.maxLines) {\n            const usedLines = lines.slice(0, this._settings.maxLines);\n            let otherLines = null;\n            if (this._settings.maxLinesSuffix) {\n                // Wrap again with max lines suffix enabled.\n                const w = this._settings.maxLinesSuffix\n                    ? this.measureText(this._settings.maxLinesSuffix)\n                    : 0;\n                const al = this.wrapText(usedLines[usedLines.length - 1], wordWrapWidth - w, letterSpacing, textIndent);\n                usedLines[usedLines.length - 1] = `${al.l[0]}${this._settings.maxLinesSuffix}`;\n                otherLines = [al.l.length > 1 ? al.l[1] : ''];\n            }\n            else {\n                otherLines = [''];\n            }\n            // Re-assemble the remaining text.\n            let i;\n            const n = lines.length;\n            let j = 0;\n            const m = linesInfo.n.length;\n            for (i = this._settings.maxLines; i < n; i++) {\n                otherLines[j] += `${otherLines[j] ? ' ' : ''}${lines[i]}`;\n                if (i + 1 < m && linesInfo.n[i + 1]) {\n                    j++;\n                }\n            }\n            renderInfo.remainingText = otherLines.join('\\n');\n            renderInfo.moreTextLines = true;\n            lines = usedLines;\n        }\n        else {\n            renderInfo.moreTextLines = false;\n            renderInfo.remainingText = '';\n        }\n        // calculate text width\n        let maxLineWidth = 0;\n        const lineWidths = [];\n        for (let i = 0; i < lines.length; i++) {\n            const lineWidth = this.measureText(lines[i], letterSpacing) + (i === 0 ? textIndent : 0);\n            lineWidths.push(lineWidth);\n            maxLineWidth = Math.max(maxLineWidth, lineWidth);\n        }\n        renderInfo.lineWidths = lineWidths;\n        if (!w) {\n            // Auto-set width to max text length.\n            width = maxLineWidth + paddingLeft + paddingRight;\n            innerWidth = maxLineWidth;\n        }\n        // calculate text height\n        lineHeight = lineHeight || fontSize;\n        let height;\n        if (h) {\n            height = h;\n        }\n        else {\n            const baselineOffset = this._settings.textBaseline != 'bottom' ? 0.5 * fontSize : 0;\n            height =\n                lineHeight * (lines.length - 1) +\n                    baselineOffset +\n                    Math.max(lineHeight, fontSize) +\n                    (offsetY || 0);\n        }\n        if (offsetY === null) {\n            offsetY = fontSize;\n        }\n        renderInfo.w = width;\n        renderInfo.h = height;\n        renderInfo.lines = lines;\n        renderInfo.precision = precision;\n        if (!width) {\n            // To prevent canvas errors.\n            width = 1;\n        }\n        if (!height) {\n            // To prevent canvas errors.\n            height = 1;\n        }\n        if (cutSx || cutEx) {\n            width = Math.min(width, cutEx - cutSx);\n        }\n        if (cutSy || cutEy) {\n            height = Math.min(height, cutEy - cutSy);\n        }\n        renderInfo.width = width;\n        renderInfo.innerWidth = innerWidth;\n        renderInfo.height = height;\n        renderInfo.fontSize = fontSize;\n        renderInfo.cutSx = cutSx;\n        renderInfo.cutSy = cutSy;\n        renderInfo.cutEx = cutEx;\n        renderInfo.cutEy = cutEy;\n        renderInfo.lineHeight = lineHeight;\n        renderInfo.lineWidths = lineWidths;\n        renderInfo.offsetY = offsetY;\n        renderInfo.paddingLeft = paddingLeft;\n        renderInfo.paddingRight = paddingRight;\n        renderInfo.letterSpacing = letterSpacing;\n        renderInfo.textIndent = textIndent;\n        return renderInfo;\n    }\n    draw(renderInfo, linesOverride) {\n        const precision = this.getPrecision();\n        // Allow lines to be overriden for partial rendering.\n        const lines = linesOverride?.lines || renderInfo.lines;\n        const lineWidths = linesOverride?.lineWidths || renderInfo.lineWidths;\n        const height = linesOverride\n            ? linesOverride.lines.length * renderInfo.lineHeight\n            : renderInfo.height;\n        // Add extra margin to prevent issue with clipped text when scaling.\n        this._canvas.width = Math.min(Math.ceil(renderInfo.width + this._settings.textRenderIssueMargin), MAX_TEXTURE_DIMENSION);\n        this._canvas.height = Math.min(Math.ceil(height), MAX_TEXTURE_DIMENSION);\n        // Canvas context has been reset.\n        this.setFontProperties();\n        if (renderInfo.fontSize >= 128) {\n            // WpeWebKit bug: must force compositing because cairo-traps-compositor will not work with text first.\n            this._context.globalAlpha = 0.01;\n            this._context.fillRect(0, 0, 0.01, 0.01);\n            this._context.globalAlpha = 1.0;\n        }\n        if (renderInfo.cutSx || renderInfo.cutSy) {\n            this._context.translate(-renderInfo.cutSx, -renderInfo.cutSy);\n        }\n        let linePositionX;\n        let linePositionY;\n        const drawLines = [];\n        // Draw lines line by line.\n        for (let i = 0, n = lines.length; i < n; i++) {\n            linePositionX = i === 0 ? renderInfo.textIndent : 0;\n            // By default, text is aligned to top\n            linePositionY = i * renderInfo.lineHeight + renderInfo.offsetY;\n            if (this._settings.verticalAlign == 'middle') {\n                linePositionY += (renderInfo.lineHeight - renderInfo.fontSize) / 2;\n            }\n            else if (this._settings.verticalAlign == 'bottom') {\n                linePositionY += renderInfo.lineHeight - renderInfo.fontSize;\n            }\n            if (this._settings.textAlign === 'right') {\n                linePositionX += renderInfo.innerWidth - lineWidths[i];\n            }\n            else if (this._settings.textAlign === 'center') {\n                linePositionX += (renderInfo.innerWidth - lineWidths[i]) / 2;\n            }\n            linePositionX += renderInfo.paddingLeft;\n            drawLines.push({\n                text: lines[i],\n                x: linePositionX,\n                y: linePositionY,\n                w: lineWidths[i],\n            });\n        }\n        // Highlight.\n        if (this._settings.highlight) {\n            const color = this._settings.highlightColor;\n            const hlHeight = this._settings.highlightHeight * precision || renderInfo.fontSize * 1.5;\n            const offset = this._settings.highlightOffset * precision;\n            const hlPaddingLeft = this._settings.highlightPaddingLeft !== null\n                ? this._settings.highlightPaddingLeft * precision\n                : renderInfo.paddingLeft;\n            const hlPaddingRight = this._settings.highlightPaddingRight !== null\n                ? this._settings.highlightPaddingRight * precision\n                : renderInfo.paddingRight;\n            this._context.fillStyle = getRgbaString(color);\n            for (let i = 0; i < drawLines.length; i++) {\n                const drawLine = drawLines[i];\n                this._context.fillRect(drawLine.x - hlPaddingLeft, drawLine.y - renderInfo.offsetY + offset, drawLine.w + hlPaddingRight + hlPaddingLeft, hlHeight);\n            }\n        }\n        // Text shadow.\n        let prevShadowSettings = null;\n        if (this._settings.shadow) {\n            prevShadowSettings = [\n                this._context.shadowColor,\n                this._context.shadowOffsetX,\n                this._context.shadowOffsetY,\n                this._context.shadowBlur,\n            ];\n            this._context.shadowColor = getRgbaString(this._settings.shadowColor);\n            this._context.shadowOffsetX = this._settings.shadowOffsetX * precision;\n            this._context.shadowOffsetY = this._settings.shadowOffsetY * precision;\n            this._context.shadowBlur = this._settings.shadowBlur * precision;\n        }\n        this._context.fillStyle = getRgbaString(this._settings.textColor);\n        for (let i = 0, n = drawLines.length; i < n; i++) {\n            const drawLine = drawLines[i];\n            if (renderInfo.letterSpacing === 0) {\n                this._context.fillText(drawLine.text, drawLine.x, drawLine.y);\n            }\n            else {\n                const textSplit = drawLine.text.split('');\n                let x = drawLine.x;\n                for (let i = 0, j = textSplit.length; i < j; i++) {\n                    this._context.fillText(textSplit[i], x, drawLine.y);\n                    x += this.measureText(textSplit[i], renderInfo.letterSpacing);\n                }\n            }\n        }\n        if (prevShadowSettings) {\n            this._context.shadowColor = prevShadowSettings[0];\n            this._context.shadowOffsetX = prevShadowSettings[1];\n            this._context.shadowOffsetY = prevShadowSettings[2];\n            this._context.shadowBlur = prevShadowSettings[3];\n        }\n        if (renderInfo.cutSx || renderInfo.cutSy) {\n            this._context.translate(renderInfo.cutSx, renderInfo.cutSy);\n        }\n        this.renderInfo = renderInfo;\n    }\n    wrapWord(word, wordWrapWidth, suffix) {\n        const suffixWidth = this._context.measureText(suffix).width;\n        const wordLen = word.length;\n        const wordWidth = this._context.measureText(word).width;\n        /* If word fits wrapWidth, do nothing */\n        if (wordWidth <= wordWrapWidth) {\n            return word;\n        }\n        /* Make initial guess for text cuttoff */\n        let cutoffIndex = Math.floor((wordWrapWidth * wordLen) / wordWidth);\n        let truncWordWidth = this._context.measureText(word.substring(0, cutoffIndex)).width +\n            suffixWidth;\n        /* In case guess was overestimated, shrink it letter by letter. */\n        if (truncWordWidth > wordWrapWidth) {\n            while (cutoffIndex > 0) {\n                truncWordWidth =\n                    this._context.measureText(word.substring(0, cutoffIndex)).width +\n                        suffixWidth;\n                if (truncWordWidth > wordWrapWidth) {\n                    cutoffIndex -= 1;\n                }\n                else {\n                    break;\n                }\n            }\n            /* In case guess was underestimated, extend it letter by letter. */\n        }\n        else {\n            while (cutoffIndex < wordLen) {\n                truncWordWidth =\n                    this._context.measureText(word.substring(0, cutoffIndex)).width +\n                        suffixWidth;\n                if (truncWordWidth < wordWrapWidth) {\n                    cutoffIndex += 1;\n                }\n                else {\n                    // Finally, when bound is crossed, retract last letter.\n                    cutoffIndex -= 1;\n                    break;\n                }\n            }\n        }\n        /* If wrapWidth is too short to even contain suffix alone, return empty string */\n        return (word.substring(0, cutoffIndex) +\n            (wordWrapWidth >= suffixWidth ? suffix : ''));\n    }\n    /**\n     * Applies newlines to a string to have it optimally fit into the horizontal\n     * bounds set by the Text object's wordWrapWidth property.\n     */\n    wrapText(text, wordWrapWidth, letterSpacing, indent = 0) {\n        // Greedy wrapping algorithm that will wrap words as the line grows longer.\n        // than its horizontal bounds.\n        const lines = text.split(/\\r?\\n/g);\n        let allLines = [];\n        const realNewlines = [];\n        for (let i = 0; i < lines.length; i++) {\n            const resultLines = [];\n            let result = '';\n            let spaceLeft = wordWrapWidth - indent;\n            const words = lines[i].split(' ');\n            for (let j = 0; j < words.length; j++) {\n                const wordWidth = this.measureText(words[j], letterSpacing);\n                const wordWidthWithSpace = wordWidth + this.measureText(' ', letterSpacing);\n                if (j === 0 || wordWidthWithSpace > spaceLeft) {\n                    // Skip printing the newline if it's the first word of the line that is.\n                    // greater than the word wrap width.\n                    if (j > 0) {\n                        resultLines.push(result);\n                        result = '';\n                    }\n                    result += words[j];\n                    spaceLeft = wordWrapWidth - wordWidth - (j === 0 ? indent : 0);\n                }\n                else {\n                    spaceLeft -= wordWidthWithSpace;\n                    result += ` ${words[j]}`;\n                }\n            }\n            resultLines.push(result);\n            result = '';\n            allLines = allLines.concat(resultLines);\n            if (i < lines.length - 1) {\n                realNewlines.push(allLines.length);\n            }\n        }\n        return { l: allLines, n: realNewlines };\n    }\n    measureText(word, space = 0) {\n        if (!space) {\n            return this._context.measureText(word).width;\n        }\n        return word.split('').reduce((acc, char) => {\n            return acc + this._context.measureText(char).width + space;\n        }, 0);\n    }\n    mergeDefaults(settings) {\n        return {\n            text: '',\n            w: 0,\n            h: 0,\n            fontStyle: 'normal',\n            fontSize: 40,\n            fontFace: null,\n            wordWrap: true,\n            wordWrapWidth: 0,\n            wordBreak: false,\n            textOverflow: '',\n            lineHeight: null,\n            textBaseline: 'alphabetic',\n            textAlign: 'left',\n            verticalAlign: 'top',\n            offsetY: null,\n            maxLines: 0,\n            maxLinesSuffix: '..',\n            textColor: [1.0, 1.0, 1.0, 1.0],\n            paddingLeft: 0,\n            paddingRight: 0,\n            shadow: false,\n            shadowColor: [0.0, 0.0, 0.0, 1.0],\n            shadowOffsetX: 0,\n            shadowOffsetY: 0,\n            shadowBlur: 5,\n            highlight: false,\n            highlightHeight: 0,\n            highlightColor: [0.0, 0.0, 0.0, 1.0],\n            highlightOffset: 0,\n            highlightPaddingLeft: 0,\n            highlightPaddingRight: 0,\n            letterSpacing: 0,\n            textIndent: 0,\n            cutSx: 0,\n            cutEx: 0,\n            cutSy: 0,\n            cutEy: 0,\n            advancedRenderer: false,\n            fontBaselineRatio: 0,\n            precision: 1,\n            textRenderIssueMargin: 0,\n            ...settings,\n        };\n    }\n}\n//# sourceMappingURL=LightningTextTextureRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { EventEmitter } from '../../../common/EventEmitter.js';\nimport { assertTruthy, mergeColorAlphaPremultiplied } from '../../../utils.js';\nimport { intersectRect, intersectBound, getNormalizedRgbaComponents, getNormalizedAlphaComponent, createBound, } from '../../lib/utils.js';\nimport { WebTrFontFace } from '../font-face-types/WebTrFontFace.js';\nimport { LightningTextTextureRenderer, } from './LightningTextTextureRenderer.js';\nimport { TextRenderer, } from './TextRenderer.js';\nconst resolvedGlobal = typeof self === 'undefined' ? globalThis : self;\n/**\n * Global font set regardless of if run in the main thread or a web worker\n */\nconst globalFontSet = (resolvedGlobal.document?.fonts ||\n    resolvedGlobal.fonts);\nfunction getFontCssString(props) {\n    const { fontFamily, fontStyle, fontWeight, fontStretch, fontSize } = props;\n    return [fontStyle, fontWeight, fontStretch, `${fontSize}px`, fontFamily].join(' ');\n}\n/**\n * Ephemeral bounds object used for intersection calculations\n *\n * @remarks\n * Used to avoid creating a new object every time we need to intersect\n * element bounds.\n */\nconst tmpElementBounds = createBound(0, 0, 0, 0);\nexport class CanvasTextRenderer extends TextRenderer {\n    canvas;\n    context;\n    rendererBounds;\n    constructor(stage) {\n        super(stage);\n        if (typeof OffscreenCanvas !== 'undefined') {\n            this.canvas = new OffscreenCanvas(0, 0);\n        }\n        else {\n            this.canvas = document.createElement('canvas');\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n        let context = this.canvas.getContext('2d');\n        if (!context) {\n            // A browser may appear to support OffscreenCanvas but not actually support the Canvas '2d' context\n            // Here we try getting the context again after falling back to an HTMLCanvasElement.\n            // See: https://github.com/lightning-js/renderer/issues/26#issuecomment-1750438486\n            this.canvas = document.createElement('canvas');\n            context = this.canvas.getContext('2d');\n        }\n        assertTruthy(context);\n        this.context = context;\n        this.rendererBounds = {\n            x1: 0,\n            y1: 0,\n            x2: this.stage.options.appWidth,\n            y2: this.stage.options.appHeight,\n        };\n    }\n    //#region Overrides\n    getPropertySetters() {\n        return {\n            fontFamily: (state, value) => {\n                state.props.fontFamily = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontWeight: (state, value) => {\n                state.props.fontWeight = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontStyle: (state, value) => {\n                state.props.fontStyle = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontStretch: (state, value) => {\n                state.props.fontStretch = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontSize: (state, value) => {\n                state.props.fontSize = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            text: (state, value) => {\n                state.props.text = value;\n                this.invalidateLayoutCache(state);\n            },\n            textAlign: (state, value) => {\n                state.props.textAlign = value;\n                this.invalidateLayoutCache(state);\n            },\n            color: (state, value) => {\n                state.props.color = value;\n                this.invalidateLayoutCache(state);\n            },\n            x: (state, value) => {\n                state.props.x = value;\n                this.invalidateVisibleWindowCache(state);\n            },\n            y: (state, value) => {\n                state.props.y = value;\n                this.invalidateVisibleWindowCache(state);\n            },\n            contain: (state, value) => {\n                state.props.contain = value;\n                this.invalidateLayoutCache(state);\n            },\n            width: (state, value) => {\n                state.props.width = value;\n                this.invalidateLayoutCache(state);\n            },\n            height: (state, value) => {\n                state.props.height = value;\n                this.invalidateLayoutCache(state);\n            },\n            offsetY: (state, value) => {\n                state.props.offsetY = value;\n                this.invalidateLayoutCache(state);\n            },\n            scrollY: (state, value) => {\n                state.props.scrollY = value;\n            },\n            letterSpacing: (state, value) => {\n                state.props.letterSpacing = value;\n                this.invalidateLayoutCache(state);\n            },\n            // debug: (state, value) => {\n            //   state.props.debug = value;\n            // },\n        };\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    canRenderFont(props) {\n        // The canvas renderer can render any font because it automatically\n        // falls back to system fonts. The CanvasTextRenderer should be\n        // checked last if other renderers are preferred.\n        return true;\n    }\n    isFontFaceSupported(fontFace) {\n        return fontFace instanceof WebTrFontFace;\n    }\n    addFontFace(fontFace) {\n        // Make sure the font face is an Canvas font face (it should have already passed\n        // the `isFontFaceSupported` check)\n        assertTruthy(fontFace instanceof WebTrFontFace);\n        // We simply add the font face to the document\n        // @ts-expect-error `add()` method should be available from a FontFaceSet\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n        globalFontSet.add(fontFace.fontFace);\n    }\n    createState(props) {\n        return {\n            props,\n            status: 'initialState',\n            updateScheduled: false,\n            emitter: new EventEmitter(),\n            canvasPages: undefined,\n            lightning2TextRenderer: new LightningTextTextureRenderer(this.canvas, this.context),\n            renderWindow: undefined,\n            visibleWindow: {\n                x1: 0,\n                y1: 0,\n                x2: 0,\n                y2: 0,\n                valid: false,\n            },\n            renderInfo: undefined,\n            forceFullLayoutCalc: false,\n            textW: 0,\n            textH: 0,\n            fontInfo: undefined,\n            fontFaceLoadedHandler: undefined,\n            debugData: {\n                updateCount: 0,\n                layoutCount: 0,\n                drawCount: 0,\n                lastLayoutNumCharacters: 0,\n                layoutSum: 0,\n                drawSum: 0,\n                bufferSize: 0,\n            },\n        };\n    }\n    updateState(state) {\n        // On the first update call we need to set the status to loading\n        if (state.status === 'initialState') {\n            this.setStatus(state, 'loading');\n        }\n        // If fontInfo is invalid, we need to establish it\n        if (!state.fontInfo) {\n            const cssString = getFontCssString(state.props);\n            state.fontInfo = {\n                cssString: cssString,\n                // TODO: For efficiency we would use this here but it's not reliable on WPE -> document.fonts.check(cssString),\n                loaded: false,\n            };\n            // If font is not loaded, set up a handler to update the font info when the font loads\n            if (!state.fontInfo.loaded) {\n                globalFontSet\n                    .load(cssString)\n                    .then(this.onFontLoaded.bind(this, state, cssString))\n                    .catch(this.onFontLoadError.bind(this, state, cssString));\n                return;\n            }\n        }\n        // If we're waiting for a font face to load, don't render anything\n        if (!state.fontInfo.loaded) {\n            return;\n        }\n        if (!state.renderInfo) {\n            state.lightning2TextRenderer.settings = {\n                text: state.props.text,\n                textAlign: state.props.textAlign,\n                fontFace: state.props.fontFamily,\n                fontSize: state.props.fontSize,\n                fontStyle: [\n                    state.props.fontStretch,\n                    state.props.fontStyle,\n                    state.props.fontWeight,\n                ].join(' '),\n                textColor: getNormalizedRgbaComponents(state.props.color),\n                offsetY: state.props.fontSize + state.props.offsetY,\n                wordWrap: state.props.contain !== 'none',\n                wordWrapWidth: state.props.contain === 'none' ? undefined : state.props.width,\n                letterSpacing: state.props.letterSpacing,\n            };\n            // const renderInfoCalculateTime = performance.now();\n            state.renderInfo = state.lightning2TextRenderer.calculateRenderInfo();\n            // console.log(\n            //   'Render info calculated in',\n            //   performance.now() - renderInfoCalculateTime,\n            //   'ms',\n            // );\n            state.textH = state.renderInfo.lineHeight * state.renderInfo.lines.length;\n            state.textW = state.renderInfo.width;\n            // Invalidate renderWindow because the renderInfo changed\n            state.renderWindow = undefined;\n        }\n        const { x, y, width, height, scrollY, contain } = state.props;\n        const { visibleWindow } = state;\n        let { renderWindow, canvasPages } = state;\n        if (!visibleWindow.valid) {\n            // Figure out whats actually in the bounds of the renderer/canvas (visibleWindow)\n            const elementBounds = createBound(x, y, contain !== 'none' ? x + width : Infinity, contain === 'both' ? y + height : Infinity, tmpElementBounds);\n            /**\n             * Area that is visible on the screen.\n             */\n            intersectBound(this.rendererBounds, elementBounds, visibleWindow);\n            visibleWindow.valid = true;\n        }\n        const visibleWindowHeight = visibleWindow.y2 - visibleWindow.y1;\n        const maxLinesPerCanvasPage = Math.ceil(visibleWindowHeight / state.renderInfo.lineHeight);\n        if (visibleWindowHeight === 0) {\n            // Nothing to render. Clear any canvasPages and existing renderWindow\n            // Return early.\n            canvasPages = undefined;\n            renderWindow = undefined;\n            this.setStatus(state, 'loaded');\n            return;\n        }\n        else if (renderWindow && canvasPages) {\n            // Return early if we're still viewing inside the established render window\n            // No need to re-render what we've already rendered\n            const renderWindowScreenX1 = x + renderWindow.x1;\n            const renderWindowScreenY1 = y - scrollY + renderWindow.y1;\n            const renderWindowScreenX2 = x + renderWindow.x2;\n            const renderWindowScreenY2 = y - scrollY + renderWindow.y2;\n            if (renderWindowScreenX1 <= visibleWindow.x1 &&\n                renderWindowScreenX2 >= visibleWindow.x2 &&\n                renderWindowScreenY1 <= visibleWindow.y1 &&\n                renderWindowScreenY2 >= visibleWindow.y2) {\n                this.setStatus(state, 'loaded');\n                return;\n            }\n            if (renderWindowScreenY2 < visibleWindow.y2) {\n                // We've scrolled up, so we need to render the next page\n                renderWindow.y1 += maxLinesPerCanvasPage * state.renderInfo.lineHeight;\n                renderWindow.y2 += maxLinesPerCanvasPage * state.renderInfo.lineHeight;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                canvasPages.push(canvasPages.shift());\n                canvasPages[2].lineNumStart =\n                    canvasPages[1].lineNumStart + maxLinesPerCanvasPage;\n                canvasPages[2].lineNumEnd =\n                    canvasPages[2].lineNumStart + maxLinesPerCanvasPage;\n                canvasPages[2].valid = false;\n            }\n            else if (renderWindowScreenY1 > visibleWindow.y1) {\n                // We've scrolled down, so we need to render the previous page\n                renderWindow.y1 -= maxLinesPerCanvasPage * state.renderInfo.lineHeight;\n                renderWindow.y2 -= maxLinesPerCanvasPage * state.renderInfo.lineHeight;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                canvasPages.unshift(canvasPages.pop());\n                canvasPages[0].lineNumStart =\n                    canvasPages[1].lineNumStart - maxLinesPerCanvasPage;\n                canvasPages[0].lineNumEnd =\n                    canvasPages[0].lineNumStart + maxLinesPerCanvasPage;\n                canvasPages[0].valid = false;\n            }\n        }\n        else {\n            const pageHeight = state.renderInfo.lineHeight * maxLinesPerCanvasPage;\n            const page1Block = Math.ceil(scrollY / pageHeight);\n            const page1LineStart = page1Block * maxLinesPerCanvasPage;\n            const page0LineStart = page1LineStart - maxLinesPerCanvasPage;\n            const page2LineStart = page1LineStart + maxLinesPerCanvasPage;\n            // We haven't rendered anything yet, so we need to render the first page\n            // If canvasPages already exist, let's re-use the textures\n            canvasPages = [\n                {\n                    texture: canvasPages?.[0].texture,\n                    lineNumStart: page0LineStart,\n                    lineNumEnd: page0LineStart + maxLinesPerCanvasPage,\n                    valid: false,\n                },\n                {\n                    texture: canvasPages?.[1].texture,\n                    lineNumStart: page1LineStart,\n                    lineNumEnd: page1LineStart + maxLinesPerCanvasPage,\n                    valid: false,\n                },\n                {\n                    texture: canvasPages?.[2].texture,\n                    lineNumStart: page2LineStart,\n                    lineNumEnd: page2LineStart + maxLinesPerCanvasPage,\n                    valid: false,\n                },\n            ];\n            state.canvasPages = canvasPages;\n            const scrollYNearestPage = page1Block * pageHeight;\n            renderWindow = {\n                x1: 0,\n                y1: scrollYNearestPage - pageHeight,\n                x2: width,\n                y2: scrollYNearestPage + pageHeight * 2,\n            };\n        }\n        state.renderWindow = renderWindow;\n        const pageDrawTime = performance.now();\n        for (const pageInfo of canvasPages) {\n            if (pageInfo.valid)\n                continue;\n            if (pageInfo.lineNumStart < 0) {\n                pageInfo.texture = this.stage.txManager.loadTexture('ImageTexture', {\n                    src: '',\n                });\n                pageInfo.valid = true;\n                continue;\n            }\n            state.lightning2TextRenderer.draw(state.renderInfo, {\n                lines: state.renderInfo.lines.slice(pageInfo.lineNumStart, pageInfo.lineNumEnd),\n                lineWidths: state.renderInfo.lineWidths.slice(pageInfo.lineNumStart, pageInfo.lineNumEnd),\n            });\n            if (!(this.canvas.width === 0 || this.canvas.height === 0)) {\n                pageInfo.texture = this.stage.txManager.loadTexture('ImageTexture', {\n                    src: this.context.getImageData(0, 0, this.canvas.width, this.canvas.height),\n                }, {\n                    preload: true,\n                });\n            }\n            pageInfo.valid = true;\n        }\n        // console.log('pageDrawTime', performance.now() - pageDrawTime, 'ms');\n        // Report final status\n        this.setStatus(state, 'loaded');\n    }\n    renderQuads(state, transform, clippingRect, alpha) {\n        const { stage } = this;\n        const { canvasPages, textW = 0, textH = 0, renderWindow } = state;\n        if (!canvasPages || !renderWindow)\n            return;\n        const { x, y, scrollY, contain, width, height /*, debug*/ } = state.props;\n        const elementRect = {\n            x: x,\n            y: y,\n            width: contain !== 'none' ? width : textW,\n            height: contain === 'both' ? height : textH,\n        };\n        const visibleRect = intersectRect({\n            x: 0,\n            y: 0,\n            width: stage.options.appWidth,\n            height: stage.options.appHeight,\n        }, elementRect);\n        // if (!debug.disableScissor) {\n        //   renderer.enableScissor(\n        //     visibleRect.x,\n        //     visibleRect.y,\n        //     visibleRect.w,\n        //     visibleRect.h,\n        //   );\n        // }\n        assertTruthy(canvasPages, 'canvasPages is not defined');\n        assertTruthy(renderWindow, 'renderWindow is not defined');\n        const renderWindowHeight = renderWindow.y2 - renderWindow.y1;\n        const pageSize = renderWindowHeight / 3.0;\n        const { zIndex, color } = state.props;\n        // Color alpha of text is not properly rendered to the Canvas texture, so we\n        // need to apply it here.\n        const combinedAlpha = alpha * getNormalizedAlphaComponent(color);\n        const quadColor = mergeColorAlphaPremultiplied(0xffffffff, combinedAlpha);\n        if (canvasPages[0].valid) {\n            this.stage.renderer.addQuad({\n                alpha: combinedAlpha,\n                clippingRect,\n                colorBl: quadColor,\n                colorBr: quadColor,\n                colorTl: quadColor,\n                colorTr: quadColor,\n                width: canvasPages[0].texture?.dimensions?.width || 0,\n                height: canvasPages[0].texture?.dimensions?.height || 0,\n                texture: canvasPages[0].texture,\n                textureOptions: {},\n                shader: null,\n                shaderProps: null,\n                zIndex,\n                tx: transform.tx,\n                ty: transform.ty - scrollY + renderWindow.y1,\n                ta: transform.ta,\n                tb: transform.tb,\n                tc: transform.tc,\n                td: transform.td,\n            });\n        }\n        if (canvasPages[1].valid) {\n            this.stage.renderer.addQuad({\n                alpha: combinedAlpha,\n                clippingRect,\n                colorBl: quadColor,\n                colorBr: quadColor,\n                colorTl: quadColor,\n                colorTr: quadColor,\n                width: canvasPages[1].texture?.dimensions?.width || 0,\n                height: canvasPages[1].texture?.dimensions?.height || 0,\n                texture: canvasPages[1].texture,\n                textureOptions: {},\n                shader: null,\n                shaderProps: null,\n                zIndex,\n                tx: transform.tx,\n                ty: transform.ty - scrollY + renderWindow.y1 + pageSize,\n                ta: transform.ta,\n                tb: transform.tb,\n                tc: transform.tc,\n                td: transform.td,\n            });\n        }\n        if (canvasPages[2].valid) {\n            this.stage.renderer.addQuad({\n                alpha: combinedAlpha,\n                clippingRect,\n                colorBl: quadColor,\n                colorBr: quadColor,\n                colorTl: quadColor,\n                colorTr: quadColor,\n                width: canvasPages[2].texture?.dimensions?.width || 0,\n                height: canvasPages[2].texture?.dimensions?.height || 0,\n                texture: canvasPages[2].texture,\n                textureOptions: {},\n                shader: null,\n                shaderProps: null,\n                zIndex,\n                tx: transform.tx,\n                ty: transform.ty - scrollY + renderWindow.y1 + pageSize + pageSize,\n                ta: transform.ta,\n                tb: transform.tb,\n                tc: transform.tc,\n                td: transform.td,\n            });\n        }\n        // renderer.disableScissor();\n        // if (debug.showElementRect) {\n        //   this.renderer.drawBorder(\n        //     Colors.Blue,\n        //     elementRect.x,\n        //     elementRect.y,\n        //     elementRect.w,\n        //     elementRect.h,\n        //   );\n        // }\n        // if (debug.showVisibleRect) {\n        //   this.renderer.drawBorder(\n        //     Colors.Green,\n        //     visibleRect.x,\n        //     visibleRect.y,\n        //     visibleRect.w,\n        //     visibleRect.h,\n        //   );\n        // }\n        // if (debug.showRenderWindow && renderWindow) {\n        //   this.renderer.drawBorder(\n        //     Colors.Red,\n        //     x + renderWindow.x1,\n        //     y + renderWindow.y1 - scrollY,\n        //     x + renderWindow.x2 - (x + renderWindow.x1),\n        //     y + renderWindow.y2 - scrollY - (y + renderWindow.y1 - scrollY),\n        //   );\n        // }\n    }\n    //#endregion Overrides\n    /**\n     * Invalidate the visible window stored in the state. This will cause a new\n     * visible window to be calculated on the next update.\n     *\n     * @param state\n     */\n    invalidateVisibleWindowCache(state) {\n        state.visibleWindow.valid = false;\n        this.setStatus(state, 'loading');\n        this.scheduleUpdateState(state);\n    }\n    /**\n     * Invalidate the layout cache stored in the state. This will cause the text\n     * to be re-layed out on the next update.\n     *\n     * @remarks\n     * This also invalidates the visible window cache.\n     *\n     * @param state\n     */\n    invalidateLayoutCache(state) {\n        state.renderInfo = undefined;\n        this.setStatus(state, 'loading');\n        this.scheduleUpdateState(state);\n    }\n    onFontLoaded(state, cssString) {\n        if (cssString !== state.fontInfo?.cssString || !state.fontInfo) {\n            return;\n        }\n        state.fontInfo.loaded = true;\n        this.scheduleUpdateState(state);\n    }\n    onFontLoadError(state, cssString, error) {\n        if (cssString !== state.fontInfo?.cssString || !state.fontInfo) {\n            return;\n        }\n        // Font didn't actually load, but we'll log the error and mark it as loaded\n        // because the browser can still render with a fallback font.\n        state.fontInfo.loaded = true;\n        console.error(`CanvasTextRenderer: Error loading font '${state.fontInfo.cssString}'`, error);\n        this.scheduleUpdateState(state);\n    }\n}\n//# sourceMappingURL=CanvasTextRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { startLoop, getTimeStamp } from './platform.js';\nimport { WebGlCoreRenderer } from './renderers/webgl/WebGlCoreRenderer.js';\nimport { assertTruthy } from '../utils.js';\nimport { AnimationManager } from './animations/AnimationManager.js';\nimport { CoreNode } from './CoreNode.js';\nimport { CoreTextureManager } from './CoreTextureManager.js';\nimport { TrFontManager } from './text-rendering/TrFontManager.js';\nimport { CoreShaderManager } from './CoreShaderManager.js';\nimport { SdfTextRenderer } from './text-rendering/renderers/SdfTextRenderer/SdfTextRenderer.js';\nimport { CanvasTextRenderer } from './text-rendering/renderers/CanvasTextRenderer.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\nconst bufferMemory = 2e6;\nconst autoStart = true;\nexport class Stage extends EventEmitter {\n    options;\n    /// Module Instances\n    animationManager;\n    txManager;\n    fontManager;\n    textRenderers;\n    shManager;\n    renderer;\n    root;\n    /// State\n    deltaTime = 0;\n    lastFrameTime = 0;\n    currentFrameTime = 0;\n    fpsNumFrames = 0;\n    fpsElapsedTime = 0;\n    renderRequested = false;\n    /**\n     * Stage constructor\n     */\n    constructor(options) {\n        super();\n        this.options = options;\n        const { canvas, clearColor, rootId, debug, appWidth, appHeight } = options;\n        this.txManager = new CoreTextureManager();\n        this.shManager = new CoreShaderManager();\n        this.animationManager = new AnimationManager();\n        if (debug?.monitorTextureCache) {\n            setInterval(() => {\n                assertTruthy(this.txManager);\n                const debugInfo = this.txManager.getDebugInfo();\n                console.log('Texture ID Cache Size: ', debugInfo.idCacheSize);\n                console.log('Texture Key Cache Size: ', debugInfo.keyCacheSize);\n            }, 1000);\n        }\n        this.renderer = new WebGlCoreRenderer({\n            stage: this,\n            canvas,\n            pixelRatio: options.devicePhysicalPixelRatio * options.deviceLogicalPixelRatio,\n            clearColor: clearColor ?? 0xff000000,\n            bufferMemory,\n            txManager: this.txManager,\n            shManager: this.shManager,\n        });\n        // Must do this after renderer is created\n        this.txManager.renderer = this.renderer;\n        this.textRenderers = {\n            canvas: new CanvasTextRenderer(this),\n            sdf: new SdfTextRenderer(this),\n        };\n        this.fontManager = new TrFontManager(this.textRenderers);\n        // create root node\n        const rootNode = new CoreNode(this, {\n            id: rootId,\n            x: 0,\n            y: 0,\n            width: appWidth,\n            height: appHeight,\n            alpha: 1,\n            clipping: false,\n            color: 0x00000000,\n            colorTop: 0x00000000,\n            colorBottom: 0x00000000,\n            colorLeft: 0x00000000,\n            colorRight: 0x00000000,\n            colorTl: 0x00000000,\n            colorTr: 0x00000000,\n            colorBl: 0x00000000,\n            colorBr: 0x00000000,\n            zIndex: 0,\n            zIndexLocked: 0,\n            scaleX: 1,\n            scaleY: 1,\n            mountX: 0,\n            mountY: 0,\n            mount: 0,\n            pivot: 0.5,\n            pivotX: 0.5,\n            pivotY: 0.5,\n            rotation: 0,\n            parent: null,\n            texture: null,\n            textureOptions: null,\n            shader: null,\n            shaderProps: null,\n        });\n        this.root = rootNode;\n        // execute platform start loop\n        if (autoStart) {\n            startLoop(this);\n        }\n    }\n    /**\n     * Update animations\n     */\n    updateAnimations() {\n        const { animationManager } = this;\n        if (!this.root) {\n            return;\n        }\n        this.lastFrameTime = this.currentFrameTime;\n        this.currentFrameTime = getTimeStamp();\n        this.deltaTime = !this.lastFrameTime\n            ? 100 / 6\n            : this.currentFrameTime - this.lastFrameTime;\n        // step animation\n        animationManager.update(this.deltaTime);\n    }\n    /**\n     * Check if the scene has updates\n     */\n    hasSceneUpdates() {\n        return !!this.root.updateType || this.renderRequested;\n    }\n    /**\n     * Start a new frame draw\n     */\n    drawFrame() {\n        const { renderer, renderRequested } = this;\n        // Update tree if needed\n        if (this.root.updateType !== 0) {\n            this.root.update(this.deltaTime);\n        }\n        // test if we need to update the scene\n        renderer?.reset();\n        this.addQuads(this.root);\n        renderer?.render();\n        // Reset renderRequested flag if it was set\n        if (renderRequested) {\n            this.renderRequested = false;\n        }\n        // If there's an FPS update interval, emit the FPS update event\n        // when the specified interval has elapsed.\n        const { fpsUpdateInterval } = this.options;\n        if (fpsUpdateInterval) {\n            this.fpsNumFrames++;\n            this.fpsElapsedTime += this.deltaTime;\n            if (this.fpsElapsedTime >= fpsUpdateInterval) {\n                const fps = Math.round((this.fpsNumFrames * 1000) / this.fpsElapsedTime);\n                this.fpsNumFrames = 0;\n                this.fpsElapsedTime = 0;\n                this.emit('fpsUpdate', fps);\n            }\n        }\n    }\n    addQuads(node) {\n        assertTruthy(this.renderer && node.globalTransform);\n        if (node.isRenderable) {\n            node.renderQuads(this.renderer);\n        }\n        for (let i = 0; i < node.children.length; i++) {\n            const child = node.children[i];\n            if (!child) {\n                continue;\n            }\n            if (child?.worldAlpha === 0) {\n                continue;\n            }\n            this.addQuads(child);\n        }\n    }\n    /**\n     * Request a render pass without forcing an update\n     */\n    requestRender() {\n        this.renderRequested = true;\n    }\n    /**\n     * Given a font name, and possible renderer override, return the best compatible text renderer.\n     *\n     * @remarks\n     * Will always return at least a canvas renderer if no other suitable renderer can be resolved.\n     *\n     * @param fontFamily\n     * @param textRendererOverride\n     * @returns\n     */\n    resolveTextRenderer(trProps, textRendererOverride = null) {\n        let rendererId = textRendererOverride;\n        let overrideFallback = false;\n        // Check if the override is valid (if one is provided)\n        if (rendererId) {\n            const possibleRenderer = this.textRenderers[rendererId];\n            if (!possibleRenderer) {\n                console.warn(`Text renderer override '${rendererId}' not found.`);\n                rendererId = null;\n                overrideFallback = true;\n            }\n            else if (!possibleRenderer.canRenderFont(trProps)) {\n                console.warn(`Cannot use override text renderer '${rendererId}' for font`, trProps);\n                rendererId = null;\n                overrideFallback = true;\n            }\n        }\n        if (!rendererId) {\n            // Iterate through the text renderers and find the first one that can render the font\n            for (const [trId, tr] of Object.entries(this.textRenderers)) {\n                if (trId === 'canvas') {\n                    // Canvas is always a fallback\n                    continue;\n                }\n                if (tr.canRenderFont(trProps)) {\n                    rendererId = trId;\n                    break;\n                }\n            }\n            if (!rendererId) {\n                // If no renderer can be found, use the canvas renderer\n                rendererId = 'canvas';\n            }\n        }\n        if (overrideFallback) {\n            console.warn(`Falling back to text renderer ${String(rendererId)}`);\n        }\n        // By now we are guaranteed to have a valid rendererId (at least Canvas);\n        const resolvedTextRenderer = this.textRenderers[rendererId];\n        assertTruthy(resolvedTextRenderer, 'resolvedTextRenderer undefined');\n        // Need to explicitly cast to TextRenderer because TS doesn't like\n        // the covariant state argument in the setter method map\n        return resolvedTextRenderer;\n    }\n}\n//# sourceMappingURL=Stage.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CoreNode } from './CoreNode.js';\nimport { assertTruthy } from '../utils.js';\nexport class CoreTextNode extends CoreNode {\n    textRenderer;\n    trState;\n    _textRendererOverride = null;\n    constructor(stage, props) {\n        super(stage, props);\n        this._textRendererOverride = props.textRendererOverride;\n        const { resolvedTextRenderer, textRendererState } = this.resolveTextRendererAndState({\n            x: this.absX,\n            y: this.absY,\n            width: props.width,\n            height: props.height,\n            textAlign: props.textAlign,\n            color: props.color,\n            zIndex: props.zIndex,\n            contain: props.contain,\n            scrollable: props.scrollable,\n            scrollY: props.scrollY,\n            offsetY: props.offsetY,\n            letterSpacing: props.letterSpacing,\n            debug: props.debug,\n            fontFamily: props.fontFamily,\n            fontSize: props.fontSize,\n            fontStretch: props.fontStretch,\n            fontStyle: props.fontStyle,\n            fontWeight: props.fontWeight,\n            text: props.text,\n        }, undefined);\n        this.textRenderer = resolvedTextRenderer;\n        this.trState = textRendererState;\n    }\n    onTextLoaded = () => {\n        const { contain } = this;\n        const setWidth = this.trState.props.width;\n        const setHeight = this.trState.props.height;\n        const calcWidth = this.trState.textW || 0;\n        const calcHeight = this.trState.textH || 0;\n        if (contain === 'both') {\n            this.props.width = setWidth;\n            this.props.height = setHeight;\n        }\n        else if (contain === 'width') {\n            this.props.width = setWidth;\n            this.props.height = calcHeight;\n        }\n        else if (contain === 'none') {\n            this.props.width = calcWidth;\n            this.props.height = calcHeight;\n        }\n        this.updateLocalTransform();\n        // Incase the RAF loop has been stopped already before text was loaded,\n        // we request a render so it can be drawn.\n        this.stage.requestRender();\n        this.emit('loaded', {\n            type: 'text',\n            dimensions: {\n                width: this.trState.textW || 0,\n                height: this.trState.textH || 0,\n            },\n        });\n    };\n    onTextFailed = (target, error) => {\n        this.emit('failed', {\n            type: 'text',\n            error,\n        });\n    };\n    get width() {\n        return this.trState.props.width;\n    }\n    set width(value) {\n        this.textRenderer.set.width(this.trState, value);\n    }\n    get height() {\n        return this.trState.props.height;\n    }\n    set height(value) {\n        this.textRenderer.set.height(this.trState, value);\n    }\n    get color() {\n        return this.trState.props.color;\n    }\n    set color(value) {\n        this.textRenderer.set.color(this.trState, value);\n    }\n    get text() {\n        return this.trState.props.text;\n    }\n    set text(value) {\n        this.textRenderer.set.text(this.trState, value);\n        this.checkIsRenderable();\n    }\n    get textRendererOverride() {\n        return this._textRendererOverride;\n    }\n    set textRendererOverride(value) {\n        this._textRendererOverride = value;\n        const { resolvedTextRenderer, textRendererState } = this.resolveTextRendererAndState(this.trState.props, this.trState);\n        this.textRenderer = resolvedTextRenderer;\n        this.trState = textRendererState;\n    }\n    get fontSize() {\n        return this.trState.props.fontSize;\n    }\n    set fontSize(value) {\n        this.textRenderer.set.fontSize(this.trState, value);\n    }\n    get fontFamily() {\n        return this.trState.props.fontFamily;\n    }\n    set fontFamily(value) {\n        this.textRenderer.set.fontFamily(this.trState, value);\n    }\n    get fontStretch() {\n        return this.trState.props.fontStretch;\n    }\n    set fontStretch(value) {\n        this.textRenderer.set.fontStretch(this.trState, value);\n    }\n    get fontStyle() {\n        return this.trState.props.fontStyle;\n    }\n    set fontStyle(value) {\n        this.textRenderer.set.fontStyle(this.trState, value);\n    }\n    get fontWeight() {\n        return this.trState.props.fontWeight;\n    }\n    set fontWeight(value) {\n        this.textRenderer.set.fontWeight(this.trState, value);\n    }\n    get textAlign() {\n        return this.trState.props.textAlign;\n    }\n    set textAlign(value) {\n        this.textRenderer.set.textAlign(this.trState, value);\n    }\n    get contain() {\n        return this.trState.props.contain;\n    }\n    set contain(value) {\n        this.textRenderer.set.contain(this.trState, value);\n    }\n    get scrollable() {\n        return this.trState.props.scrollable;\n    }\n    set scrollable(value) {\n        this.textRenderer.set.scrollable(this.trState, value);\n    }\n    get scrollY() {\n        return this.trState.props.scrollY;\n    }\n    set scrollY(value) {\n        this.textRenderer.set.scrollY(this.trState, value);\n    }\n    get offsetY() {\n        return this.trState.props.offsetY;\n    }\n    set offsetY(value) {\n        this.textRenderer.set.offsetY(this.trState, value);\n    }\n    get letterSpacing() {\n        return this.trState.props.letterSpacing;\n    }\n    set letterSpacing(value) {\n        this.textRenderer.set.letterSpacing(this.trState, value);\n    }\n    get debug() {\n        return this.trState.props.debug;\n    }\n    set debug(value) {\n        this.textRenderer.set.debug(this.trState, value);\n    }\n    update(delta, parentClippingRect = null) {\n        super.update(delta, parentClippingRect);\n        assertTruthy(this.globalTransform);\n        // globalTransform is updated in super.update(delta)\n        this.textRenderer.set.x(this.trState, this.globalTransform.tx);\n        this.textRenderer.set.y(this.trState, this.globalTransform.ty);\n    }\n    checkIsRenderable() {\n        if (super.checkIsRenderable()) {\n            return true;\n        }\n        if (this.trState.props.text !== '') {\n            return (this.isRenderable = true);\n        }\n        return (this.isRenderable = false);\n    }\n    renderQuads(renderer) {\n        assertTruthy(this.globalTransform);\n        this.textRenderer.renderQuads(this.trState, this.globalTransform, this.clippingRect, this.worldAlpha);\n    }\n    /**\n     * Resolve a text renderer and a new state based on the current text renderer props provided\n     * @param props\n     * @returns\n     */\n    resolveTextRendererAndState(props, prevState) {\n        const resolvedTextRenderer = this.stage.resolveTextRenderer(props, this._textRendererOverride);\n        const textRendererState = resolvedTextRenderer.createState(props);\n        const stateEvents = ['loading', 'loaded', 'failed'];\n        if (prevState) {\n            // Remove the old event listeners from previous state obj there was one\n            stateEvents.forEach((eventName) => {\n                prevState.emitter.off(eventName);\n            });\n        }\n        textRendererState.emitter.on('loaded', this.onTextLoaded);\n        textRendererState.emitter.on('failed', this.onTextFailed);\n        resolvedTextRenderer.scheduleUpdateState(textRendererState);\n        return {\n            resolvedTextRenderer,\n            textRendererState,\n        };\n    }\n}\n//# sourceMappingURL=CoreTextNode.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { MainOnlyNode, getNewId } from './MainOnlyNode.js';\nimport { CoreTextNode } from '../../core/CoreTextNode.js';\nexport class MainOnlyTextNode extends MainOnlyNode {\n    constructor(props, rendererMain, stage) {\n        super(props, rendererMain, stage, new CoreTextNode(stage, {\n            id: getNewId(),\n            x: props.x,\n            y: props.y,\n            width: props.width,\n            height: props.height,\n            alpha: props.alpha,\n            clipping: props.clipping,\n            color: props.color,\n            colorTop: props.colorTop,\n            colorBottom: props.colorBottom,\n            colorLeft: props.colorLeft,\n            colorRight: props.colorRight,\n            colorTl: props.colorTl,\n            colorTr: props.colorTr,\n            colorBl: props.colorBl,\n            colorBr: props.colorBr,\n            zIndex: props.zIndex,\n            zIndexLocked: props.zIndexLocked,\n            scaleX: props.scaleX,\n            scaleY: props.scaleY,\n            mountX: props.mountX,\n            mountY: props.mountY,\n            mount: props.mount,\n            pivot: props.pivot,\n            pivotX: props.pivotX,\n            pivotY: props.pivotY,\n            rotation: props.rotation,\n            // Text properties\n            text: props.text,\n            fontSize: props.fontSize,\n            fontFamily: props.fontFamily,\n            fontWeight: props.fontWeight,\n            fontStretch: props.fontStretch,\n            fontStyle: props.fontStyle,\n            contain: props.contain,\n            scrollable: props.scrollable,\n            letterSpacing: props.letterSpacing,\n            textAlign: props.textAlign,\n            scrollY: props.scrollY,\n            offsetY: props.offsetY,\n            textRendererOverride: props.textRendererOverride,\n            debug: props.debug,\n            // These properties will get set appropriately in the base MainOnlyNode class\n            parent: null,\n            texture: null,\n            textureOptions: null,\n            shader: null,\n            shaderProps: null,\n        }));\n    }\n    get text() {\n        return this.coreNode.text;\n    }\n    set text(value) {\n        this.coreNode.text = value;\n    }\n    get textRendererOverride() {\n        return this.coreNode.textRendererOverride;\n    }\n    set textRendererOverride(value) {\n        this.coreNode.textRendererOverride = value;\n    }\n    get fontSize() {\n        return this.coreNode.fontSize;\n    }\n    set fontSize(value) {\n        this.coreNode.fontSize = value;\n    }\n    get fontFamily() {\n        return this.coreNode.fontFamily;\n    }\n    set fontFamily(value) {\n        this.coreNode.fontFamily = value;\n    }\n    get fontWeight() {\n        return this.coreNode.fontWeight;\n    }\n    set fontWeight(value) {\n        this.coreNode.fontWeight = value;\n    }\n    get fontStretch() {\n        return this.coreNode.fontStretch;\n    }\n    set fontStretch(value) {\n        this.coreNode.fontStretch = value;\n    }\n    get fontStyle() {\n        return this.coreNode.fontStyle;\n    }\n    set fontStyle(value) {\n        this.coreNode.fontStyle = value;\n    }\n    get textAlign() {\n        return this.coreNode.textAlign;\n    }\n    set textAlign(value) {\n        this.coreNode.textAlign = value;\n    }\n    get contain() {\n        return this.coreNode.contain;\n    }\n    set contain(value) {\n        this.coreNode.contain = value;\n    }\n    get scrollable() {\n        return this.coreNode.scrollable;\n    }\n    set scrollable(value) {\n        this.coreNode.scrollable = value;\n    }\n    get scrollY() {\n        return this.coreNode.scrollY;\n    }\n    set scrollY(value) {\n        this.coreNode.scrollY = value;\n    }\n    get offsetY() {\n        return this.coreNode.offsetY;\n    }\n    set offsetY(value) {\n        this.coreNode.offsetY = value;\n    }\n    get letterSpacing() {\n        return this.coreNode.letterSpacing;\n    }\n    set letterSpacing(value) {\n        this.coreNode.letterSpacing = value;\n    }\n    get debug() {\n        return this.coreNode.debug;\n    }\n    set debug(value) {\n        this.coreNode.debug = value;\n    }\n}\n//# sourceMappingURL=MainOnlyTextNode.js.map","import { CoreExtension } from '../../exports/core-api.js';\n/**\n * Type guard that checks if a Class extends CoreExtension.\n *\n * @param Class\n * @returns\n */\nexport function classExtendsCoreExtension(Class) {\n    return Class.prototype instanceof CoreExtension;\n}\nexport async function loadCoreExtension(coreExtensionModule, stage) {\n    let module;\n    try {\n        console.log('Loading core extension', coreExtensionModule);\n        module = (await import(coreExtensionModule /* @vite-ignore */));\n    }\n    catch (e) {\n        console.error(`The core extension module at '${coreExtensionModule}' could not be loaded.`);\n        console.error(e);\n        return;\n    }\n    if (!module.default) {\n        console.error(`The core extension module at '${coreExtensionModule}' does not have a default export.`);\n        return;\n    }\n    const ExtensionClass = module.default;\n    if (classExtendsCoreExtension(ExtensionClass)) {\n        const coreExtension = new ExtensionClass();\n        try {\n            await coreExtension.run(stage);\n        }\n        catch (e) {\n            console.error(`The core extension at '${coreExtensionModule}' threw an error.`);\n            console.error(e);\n        }\n    }\n    else {\n        console.error(`The core extension at '${coreExtensionModule}' does not extend CoreExtension.`);\n    }\n}\n//# sourceMappingURL=utils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../utils.js';\nimport { MainOnlyNode, getNewId } from './MainOnlyNode.js';\nimport { Stage } from '../../core/Stage.js';\nimport { MainOnlyTextNode } from './MainOnlyTextNode.js';\nimport { loadCoreExtension } from '../utils.js';\nexport class MainCoreDriver {\n    root = null;\n    stage = null;\n    rendererMain = null;\n    async init(rendererMain, rendererSettings, canvas) {\n        this.stage = new Stage({\n            rootId: getNewId(),\n            appWidth: rendererSettings.appWidth,\n            appHeight: rendererSettings.appHeight,\n            deviceLogicalPixelRatio: rendererSettings.deviceLogicalPixelRatio,\n            devicePhysicalPixelRatio: rendererSettings.devicePhysicalPixelRatio,\n            clearColor: rendererSettings.clearColor,\n            canvas,\n            fpsUpdateInterval: rendererSettings.fpsUpdateInterval,\n            debug: {\n                monitorTextureCache: false,\n            },\n        });\n        this.rendererMain = rendererMain;\n        assertTruthy(this.stage.root);\n        const node = new MainOnlyNode(rendererMain.resolveNodeDefaults({}), this.rendererMain, this.stage, this.stage.root);\n        this.root = node;\n        node.once('beforeDestroy', this.onBeforeDestroyNode.bind(this, node));\n        this.onCreateNode(node);\n        // Load the Core Extension Module if one was specified.\n        if (rendererSettings.coreExtensionModule) {\n            await loadCoreExtension(rendererSettings.coreExtensionModule, this.stage);\n        }\n        // Forward fpsUpdate events from the stage to RendererMain\n        this.stage.on('fpsUpdate', (stage, fps) => {\n            this.onFpsUpdate(fps);\n        });\n    }\n    createNode(props) {\n        assertTruthy(this.rendererMain);\n        assertTruthy(this.stage);\n        const node = new MainOnlyNode(props, this.rendererMain, this.stage);\n        node.once('beforeDestroy', this.onBeforeDestroyNode.bind(this, node));\n        this.onCreateNode(node);\n        return node;\n    }\n    createTextNode(props) {\n        assertTruthy(this.rendererMain);\n        assertTruthy(this.stage);\n        const node = new MainOnlyTextNode(props, this.rendererMain, this.stage);\n        node.once('beforeDestroy', this.onBeforeDestroyNode.bind(this, node));\n        this.onCreateNode(node);\n        return node;\n    }\n    // TODO: Remove?\n    destroyNode(node) {\n        node.destroy();\n    }\n    releaseTexture(id) {\n        const { stage } = this;\n        assertTruthy(stage);\n        stage.txManager.removeTextureIdFromCache(id);\n    }\n    getRootNode() {\n        assertTruthy(this.root);\n        return this.root;\n    }\n    //#region Event Methods\n    // The implementations for these event methods are provided by RendererMain\n    onCreateNode(node) {\n        throw new Error('Method not implemented.');\n    }\n    onBeforeDestroyNode(node) {\n        throw new Error('Method not implemented.');\n    }\n    onFpsUpdate(fps) {\n        throw new Error('Method not implemented.');\n    }\n}\n//# sourceMappingURL=MainCoreDriver.js.map","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n  MainCoreDriver,\n  RendererMain,\n  type RendererMainSettings,\n} from '@lightningjs/renderer';\n\nexport let renderer: RendererMain;\nexport let createShader: RendererMain['createShader'];\n\nexport interface SolidRendererOptions extends RendererMainSettings {\n  threadXCoreWorkerUrl?: string;\n  rootId: string | HTMLElement;\n}\n\nexport function startLightningRenderer(\n  options: Partial<SolidRendererOptions> = {},\n): RendererMain {\n  const driver = new MainCoreDriver();\n\n  renderer = new RendererMain(options, options.rootId || 'app', driver);\n\n  createShader = renderer.createShader.bind(renderer);\n  return renderer;\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type { ElementNode, SolidNode } from './index.js';\n\n/**\n * Children class\n */\nexport default class Children extends Array<SolidNode> {\n  _parent: ElementNode;\n\n  constructor(node: ElementNode) {\n    super();\n    this._parent = node;\n  }\n\n  get selected(): ElementNode | undefined {\n    // For selected Elements should always be an ElementNode\n    return this[this._parent.selected || 0] as ElementNode | undefined;\n  }\n\n  get firstChild() {\n    return this[0];\n  }\n\n  insert(node: SolidNode, beforeNode: SolidNode) {\n    if (beforeNode) {\n      const index = this.indexOf(beforeNode);\n      this.splice(index, 0, node);\n    } else {\n      this.push(node);\n    }\n\n    node.parent = this._parent;\n    this._parent._isDirty = true;\n  }\n\n  remove(node: SolidNode) {\n    const nodeIndexToRemove = this.indexOf(node);\n    if (nodeIndexToRemove >= 0) {\n      this.splice(nodeIndexToRemove, 1);\n    }\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { AnimationSettings } from '@lightningjs/renderer';\nimport type { IntrinsicTextNodeStyleProps } from './intrinsicTypes.js';\nimport { type ElementNode } from './core/node/index.js';\n\ninterface Config {\n  debug: boolean;\n  animationSettings: Partial<AnimationSettings>;\n  fontSettings: Partial<IntrinsicTextNodeStyleProps>;\n  stateMapperHook?: (node: ElementNode, states: Array<string>) => Array<string>;\n}\n\nimport.meta.env = import.meta.env || { MODE: 'development' };\nexport const isDev = import.meta.env.MODE === 'development';\n\nexport const config: Config = {\n  debug: false,\n  animationSettings: {\n    duration: 250,\n    easing: 'ease-in-out',\n  },\n  fontSettings: {\n    fontFamily: 'Ubuntu',\n    fontSize: 100,\n  },\n};\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { config, isDev } from '../config.js';\nimport type { AnimatableNumberProp } from '../index.js';\nimport type { SolidNode } from './node/index.js';\n\nexport function log(msg: string, node: SolidNode, ...args: any[]) {\n  if (isDev) {\n    if (config.debug || (isObject(node) && node.debug)) {\n      console.log(msg, node, ...args);\n    }\n  }\n}\n\nexport function isFunc(item: unknown): item is (...args: unknown[]) => unknown {\n  return typeof item === 'function';\n}\n\nexport function isObject(\n  item: unknown,\n): item is Record<string | number | symbol, unknown> {\n  return typeof item === 'object';\n}\n\nexport function isArray(item: unknown): item is any[] {\n  return Array.isArray(item);\n}\n\nexport function isString(item: unknown): item is string {\n  return typeof item === 'string';\n}\n\nexport function isNumber(item: unknown): item is number {\n  return typeof item === 'number';\n}\n\nexport function isInteger(item: unknown): item is number {\n  return Number.isInteger(item);\n}\n\nexport function keyExists(\n  obj: Record<string, unknown>,\n  keys: (string | number | symbol)[],\n) {\n  for (const key of keys) {\n    if (key in obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function getAnimatableValue(\n  value: number | AnimatableNumberProp | undefined,\n): number | undefined {\n  return isArray(value) ? (value as AnimatableNumberProp)[0] : value;\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isArray, isString } from '../utils.js';\n\nexport type NodeStates =\n  | string[]\n  | string\n  | Record<string, boolean | undefined>;\n\nexport default class States extends Array<string> {\n  private onChange: () => void;\n\n  constructor(callback: () => void, initialState: NodeStates = {}) {\n    if (isArray(initialState)) {\n      super(...initialState);\n    } else if (isString(initialState)) {\n      super(initialState);\n    } else {\n      super(\n        ...Object.entries(initialState)\n          .filter(([_key, value]) => value)\n          .map(([key]) => key),\n      );\n    }\n\n    this.onChange = callback;\n    return this;\n  }\n\n  has(state: string) {\n    return this.indexOf(state) >= 0;\n  }\n\n  is(state: string) {\n    return this.indexOf(state) >= 0;\n  }\n\n  add(state: string) {\n    this.push(state);\n    this.onChange();\n  }\n\n  toggle(state: string) {\n    if (this.has(state)) {\n      this.remove(state);\n    } else {\n      this.add(state);\n    }\n  }\n\n  remove(state: string) {\n    const stateIndexToRemove = this.indexOf(state);\n    if (stateIndexToRemove >= 0) {\n      this.splice(stateIndexToRemove, 1);\n      this.onChange();\n    }\n  }\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { assertTruthy } from '@lightningjs/renderer/utils';\nimport type { ElementNode, SolidNode } from './node/index.js';\n\nexport default function (node: ElementNode): boolean {\n  const children = [];\n  for (let i = 0; i < node.children.length; i++) {\n    const c = node.children[i]!;\n    // Filter empty text nodes which are place holders for <Show> and elements missing dimensions\n    if (c.name === 'TextNode') {\n      continue;\n    }\n    // text node hasnt loaded yet - skip layout\n    if (c.name === 'text' && !(c.width || c.height)) {\n      return false;\n    }\n\n    children.push(c);\n  }\n\n  const numChildren = children.length;\n  const direction = node.flexDirection || 'row';\n  const isRow = direction === 'row';\n  const dimension = isRow ? 'width' : 'height';\n  const crossDimension = isRow ? 'height' : 'width';\n  const marginOne = isRow ? 'marginLeft' : 'marginTop';\n  const marginTwo = isRow ? 'marginRight' : 'marginBottom';\n  const prop = isRow ? 'x' : 'y';\n  const crossProp = isRow ? 'y' : 'x';\n  const containerSize = node[dimension] || 0;\n  const containerCrossSize = node[crossDimension] || 0;\n  const gap = node.gap || 0;\n  const justify = node.justifyContent || 'flexStart';\n  const align = node.alignItems;\n  let itemSize = 0;\n  if (['center', 'spaceBetween', 'spaceEvenly'].includes(justify)) {\n    itemSize = children.reduce(\n      (prev, c) => prev + (c[dimension] || 0),\n      0,\n    ) ;\n  }\n\n  // Only align children if container has a cross size\n  const crossAlignChild =\n    containerCrossSize && align\n      ? (c: SolidNode) => {\n          if (align === 'flexStart') {\n            c[crossProp] = 0;\n          } else if (align === 'center') {\n            c[crossProp] = (containerCrossSize - (c[crossDimension] || 0)) / 2;\n          } else if (align === 'flexEnd') {\n            c[crossProp] = containerCrossSize - (c[crossDimension] || 0);\n          }\n        }\n      : (c: SolidNode) => c;\n\n  if (justify === 'flexStart') {\n    let start = 0;\n    children.forEach((c) => {\n      c[prop] = start + (c[marginOne] || 0);\n      start +=\n        (c[dimension] || 0) + gap + (c[marginOne] || 0) + (c[marginTwo] || 0);\n      crossAlignChild(c);\n    });\n    // Update container size\n    if (node._autosized) {\n      const containerSize = start - gap;\n      if (containerSize !== node[dimension]) {\n        node[dimension] = containerSize;\n        return true;\n      }\n    }\n  } else if (justify === 'flexEnd') {\n    let start = containerSize;\n    for (let i = numChildren - 1; i >= 0; i--) {\n      const c = children[i];\n      assertTruthy(c);\n      c[prop] = start - (c[dimension] || 0) - (c[marginTwo] || 0);\n      start -=\n        (c[dimension] || 0) + gap + (c[marginOne] || 0) + (c[marginTwo] || 0);\n      crossAlignChild(c);\n    }\n  } else if (justify === 'center') {\n    let start = (containerSize - (itemSize + gap * (numChildren - 1))) / 2;\n    children.forEach((c) => {\n      c[prop] = start;\n      start += (c[dimension] || 0) + gap;\n      crossAlignChild(c);\n    });\n  } else if (justify === 'spaceBetween') {\n    const toPad = (containerSize - itemSize) / (numChildren - 1);\n    let start = 0;\n    children.forEach((c) => {\n      c[prop] = start;\n      start += (c[dimension] || 0) + toPad;\n      crossAlignChild(c);\n    });\n  } else if (justify === 'spaceEvenly') {\n    const toPad = (containerSize - itemSize) / (numChildren + 1);\n    let start = toPad;\n    children.forEach((c) => {\n      c[prop] = start;\n      start += (c[dimension] || 0) + toPad;\n      crossAlignChild(c);\n    });\n  }\n\n  // Container was not updated\n  return false;\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { renderer, createShader } from '../renderer/index.js';\nimport {\n  type AnimatableNumberProp,\n  type BorderStyleObject,\n  type IntrinsicCommonProps,\n  type NodeStyles,\n  type TextStyles,\n} from '../../index.js';\nimport Children from './children.js';\nimport States, { type NodeStates } from './states.js';\nimport calculateFlex from '../flex.js';\nimport {\n  log,\n  isArray,\n  isNumber,\n  isFunc,\n  keyExists,\n  getAnimatableValue,\n} from '../utils.js';\nimport { config } from '../../config.js';\nimport { setActiveElement } from '../activeElement.js';\nimport type {\n  INode,\n  INodeAnimatableProps,\n  INodeWritableProps,\n  ShaderRef,\n  Dimensions,\n  AnimationSettings,\n  NodeLoadedPayload,\n} from '@lightningjs/renderer';\nimport { assertTruthy } from '@lightningjs/renderer/utils';\n\nconst { animationSettings: defaultAnimationSettings } = config;\n\nfunction convertEffectsToShader(styleEffects: any) {\n  const effects = [];\n\n  for (const [type, props] of Object.entries<Record<string, any>>(\n    styleEffects,\n  )) {\n    effects.push({ type, props });\n  }\n  return createShader('DynamicShader', { effects: effects as any });\n}\n\nfunction borderAccessor(\n  direction: '' | 'Top' | 'Right' | 'Bottom' | 'Left' = '',\n) {\n  return {\n    set(this: ElementNode, value: number | { width: number; color: number }) {\n      // Format: width || { width, color }\n      if (isNumber(value)) {\n        value = { width: value, color: 0x000000ff };\n      }\n      this.effects = {\n        ...(this.effects || {}),\n        ...{ [`border${direction}`]: value },\n      };\n      this[`_border${direction}`] = value;\n    },\n    get(this: ElementNode) {\n      return this[`_border${direction}`];\n    },\n  };\n}\n\nconst LightningRendererNumberProps = [\n  'alpha',\n  'color',\n  'colorTop',\n  'colorRight',\n  'colorLeft',\n  'colorBottom',\n  'colorTl',\n  'colorTr',\n  'colorBl',\n  'colorBr',\n  'height',\n  'fontSize',\n  'lineHeight',\n  'mount',\n  'mountX',\n  'mountY',\n  'pivot',\n  'pivotX',\n  'pivotY',\n  'rotation',\n  'scale',\n  'width',\n  'worldX',\n  'worldY',\n  'x',\n  'y',\n  'zIndex',\n  'zIndexLocked',\n];\n\nconst LightningRendererNonAnimatingProps = [\n  'clipping',\n  'contain',\n  'fontFamily',\n  'src',\n  'text',\n  'textAlign',\n  'texture',\n  'maxLines',\n  'maxLinesSuffix',\n  'textBaseline',\n  'textOverflow',\n  'verticalAlign',\n  'wordWrap',\n];\n\nexport interface TextNode {\n  name: string;\n  text: string;\n  parent: ElementNode | null;\n  zIndex?: number;\n  states?: States;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  marginLeft?: number;\n  marginRight?: number;\n  marginTop?: number;\n  marginBottom?: number;\n  /**\n   * Managed by dom-inspector\n   */\n  _dom?: Text; // Public but uses _ prefix\n}\n\nexport type SolidNode = ElementNode | TextNode;\nexport type SolidStyles = NodeStyles | TextStyles;\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-declaration-merging\nexport interface ElementNode\n  extends Partial<Omit<INodeWritableProps, 'parent' | 'shader'>>,\n    IntrinsicCommonProps {\n  [key: string]: unknown;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-declaration-merging\nexport class ElementNode extends Object {\n  name: string;\n  lng: INode | null = null;\n  selected?: number;\n  rendered: boolean;\n  autofocus: boolean;\n\n  private _undoStates?: Record<string, any>;\n  private _renderProps: any;\n  private _effects: any;\n  private _parent: ElementNode | null = null;\n  private _shader?: ShaderRef;\n  private _style?: SolidStyles;\n  private _states?: States;\n  private _animationSettings?: Partial<AnimationSettings>;\n  private _width?: number;\n  private _height?: number;\n  private _color?: number;\n  private _borderRadius?: number;\n  private _border?: BorderStyleObject;\n  private _borderLeft?: BorderStyleObject;\n  private _borderRight?: BorderStyleObject;\n  private _borderTop?: BorderStyleObject;\n  private _borderBottom?: BorderStyleObject;\n  public _animate?: boolean; // Public but uses _ prefix\n  public _autosized?: boolean; // Public but uses _ prefix\n  public _isDirty?: boolean; // Public but uses _ prefix\n  /**\n   * Managed by dom-inspector\n   */\n  public _dom?: HTMLDivElement; // Public but uses _ prefix\n  children: Children;\n\n  constructor(name: string) {\n    super();\n    this.name = name;\n    this.rendered = false;\n    this.autofocus = false;\n    this._renderProps = { x: 0, y: 0 };\n    this.children = new Children(this);\n\n    for (const key of LightningRendererNumberProps) {\n      Object.defineProperty(this, key, {\n        get(): number {\n          return this[`_${key}`] || (this.lng && this.lng[key]);\n        },\n        set(v: number | AnimatableNumberProp) {\n          this[`_${key}`] = getAnimatableValue(v);\n          this._sendToLightningAnimatable(key, v);\n        },\n      });\n    }\n\n    for (const key of LightningRendererNonAnimatingProps) {\n      Object.defineProperty(this, key, {\n        get() {\n          return this[`_${key}`] || (this.lng && this.lng[key]);\n        },\n        set(v) {\n          this[`_${key}`] = v;\n          this._sendToLightning(key, v);\n        },\n      });\n    }\n\n    // Add Border Helpers\n    Object.defineProperties(this, {\n      borderRadius: {\n        set(this: ElementNode, radius) {\n          this._borderRadius = radius;\n          this.effects = {\n            ...(this.effects || {}),\n            ...{ radius: { radius } },\n          };\n        },\n        get(this: ElementNode) {\n          return this._borderRadius;\n        },\n      },\n      border: borderAccessor(),\n      borderLeft: borderAccessor('Left'),\n      borderRight: borderAccessor('Right'),\n      borderTop: borderAccessor('Top'),\n      borderBottom: borderAccessor('Bottom'),\n    });\n\n    Object.defineProperties(this, {\n      linearGradient: {\n        set(props = {}) {\n          this._linearGradient = props;\n          this.effects = {\n            ...(this.effects || {}),\n            ...{ linearGradient: props },\n          };\n        },\n        get() {\n          return this._linearGradient;\n        },\n      },\n    });\n  }\n\n  get effects() {\n    return this._effects;\n  }\n\n  set effects(v) {\n    this._effects = v;\n    this.shader = convertEffectsToShader(v);\n  }\n\n  get parent() {\n    return this._parent;\n  }\n\n  set parent(p) {\n    this._parent = p;\n    if (this.rendered && this.lng) {\n      this.lng.parent = p?.lng ?? null;\n    }\n  }\n\n  get shader(): ShaderRef | undefined {\n    return this._shader;\n  }\n\n  set shader(v: Parameters<typeof createShader> | ShaderRef | undefined) {\n    if (isArray(v)) {\n      this._shader = createShader(...v) as ShaderRef;\n    } else {\n      this._shader = v;\n    }\n    this._sendToLightning('shader', this._shader);\n  }\n\n  _sendToLightningAnimatable(\n    name: string,\n    value: AnimatableNumberProp | number | string,\n  ) {\n    if (this.rendered && this.lng) {\n      if (isArray(value)) {\n        return this.createAnimation({ [name]: value[0] }, value[1]).start();\n      }\n\n      if (this._animate) {\n        return this.createAnimation({ [name]: value }).start();\n      }\n\n      (this.lng[name as keyof INode] as number | string) = value;\n    } else {\n      // Need to render before animating\n      if (isArray(value)) {\n        value = value[0];\n      }\n      this._renderProps[name] = value;\n    }\n  }\n\n  _sendToLightning(name: string, value: unknown) {\n    if (this.rendered && this.lng) {\n      (this.lng[name as keyof INodeWritableProps] as unknown) = value;\n    } else {\n      this._renderProps[name] = value;\n    }\n  }\n\n  createAnimation(\n    props: Partial<INodeAnimatableProps>,\n    animationSettings?: Partial<AnimationSettings>,\n  ) {\n    assertTruthy(this.lng, 'Node must be rendered before animating');\n    return this.lng.animate(props, animationSettings || this.animationSettings);\n  }\n\n  setFocus() {\n    if (this.rendered) {\n      setActiveElement<ElementNode>(this);\n    } else {\n      this.autofocus = true;\n    }\n  }\n\n  isTextNode() {\n    return this.name === 'text';\n  }\n\n  _resizeOnTextLoad() {\n    this.lng!.once(\n      'loaded',\n      (_node: INode, loadedPayload: NodeLoadedPayload) => {\n        if (loadedPayload.type === 'text') {\n          const { dimensions } = loadedPayload;\n\n          this.width = dimensions.width;\n          this.height = dimensions.height;\n          this.parent!.updateLayout(this, dimensions);\n        }\n      },\n    );\n  }\n\n  getText() {\n    return this.children.map((c) => c.text).join('');\n  }\n\n  destroy() {\n    this.lng && renderer.destroyNode(this.lng);\n  }\n\n  set style(value: SolidStyles) {\n    // Keys set in JSX are more important\n    for (let key in value) {\n      if (key === 'animate') {\n        key = '_animate';\n      }\n\n      if (!this[key as keyof SolidStyles]) {\n        this[key as keyof SolidStyles] = value[key as keyof SolidStyles];\n      }\n    }\n\n    this._style = value;\n  }\n\n  get style(): SolidStyles {\n    return this._style!;\n  }\n\n  get hasChildren() {\n    return this.children.length > 0;\n  }\n\n  set states(states: NodeStates) {\n    this._states = new States(this._stateChanged.bind(this), states);\n    if (this.rendered) {\n      this._stateChanged();\n    }\n  }\n\n  get states(): States {\n    this._states = this._states || new States(this._stateChanged.bind(this));\n    return this._states;\n  }\n\n  get animationSettings(): Partial<AnimationSettings> {\n    return this._animationSettings || defaultAnimationSettings;\n  }\n\n  set animationSettings(animationSettings: Partial<AnimationSettings>) {\n    this._animationSettings = animationSettings;\n  }\n\n  updateLayout(child?: ElementNode, dimensions?: Dimensions) {\n    if (this.hasChildren) {\n      log('Layout: ', this);\n      isFunc(this.onBeforeLayout) &&\n        this.onBeforeLayout.call(this, child, dimensions);\n\n      if (this.display === 'flex') {\n        if (calculateFlex(this)) {\n          this.parent?.updateLayout();\n        }\n      }\n\n      isFunc(this.onLayout) && this.onLayout.call(this, child, dimensions);\n    }\n  }\n\n  _stateChanged() {\n    log('State Changed: ', this, this.states);\n\n    if (this.forwardStates) {\n      // apply states to children first\n      const states = this.states.slice() as States;\n      this.children.forEach((c) => (c.states = states));\n    }\n\n    const states = config.stateMapperHook?.(this, this.states) || this.states;\n\n    if (this._undoStates || (this.style && keyExists(this.style, states))) {\n      this._undoStates = this._undoStates || {};\n      let stylesToUndo = {};\n\n      for (const [state, undoStyles] of Object.entries(this._undoStates)) {\n        // if state is no longer in the states undo it\n        if (!states.includes(state)) {\n          stylesToUndo = {\n            ...stylesToUndo,\n            ...undoStyles,\n          };\n        }\n      }\n\n      const newStyles = states.reduce((acc, state) => {\n        const styles = this.style[state];\n        if (styles) {\n          acc = {\n            ...acc,\n            ...styles,\n          };\n\n          // get current values to undo state\n          if (this._undoStates && !this._undoStates[state]) {\n            this._undoStates[state] = {};\n            Object.keys(styles).forEach((key) => {\n              this._undoStates![state][key] = this[key as keyof this];\n            });\n          }\n        }\n        return acc;\n      }, {});\n\n      // Apply the styles\n      Object.assign(this, { ...stylesToUndo, ...newStyles });\n    }\n  }\n\n  render() {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const node = this;\n    const parent = this.parent!;\n\n    // Parent is dirty whenever a node is inserted after initial render\n    if (parent._isDirty) {\n      parent.updateLayout();\n      parent._isDirty = false;\n    }\n\n    node.updateLayout();\n\n    if (this.states.length) {\n      this._stateChanged();\n    }\n\n    let props = node._renderProps;\n\n    if (parent.lng) {\n      props.parent = parent.lng;\n    }\n\n    if (node.isTextNode()) {\n      props = {\n        ...config.fontSettings,\n        ...props,\n        text: node.getText(),\n      };\n\n      if (props.contain) {\n        if (!props.width) {\n          props.width =\n            (parent.width || 0) - props.x - (props.marginRight || 0);\n          node._width = props.width;\n          node._autosized = true;\n        }\n\n        if (!props.height && props.contain === 'both') {\n          props.height =\n            (parent.height || 0) - props.y - (props.marginBottom || 0);\n          node._height = props.height;\n          node._autosized = true;\n        }\n      }\n\n      log('Rendering: ', this, props);\n      node.lng = renderer.createTextNode(props);\n\n      isFunc(this.onCreate) && this.onCreate.call(this, node);\n\n      if (isFunc(node.onLoad)) {\n        node.lng.on('loaded', node.onLoad);\n      }\n\n      if (!node.width || !node.height) {\n        node._autosized = true;\n        node._resizeOnTextLoad();\n      }\n    } else {\n      // If its not an image or texture apply some defaults\n      if (!(props.src || props.texture)) {\n        // Set width and height to parent less offset\n        if (isNaN(props.width)) {\n          props.width = (parent.width || 0) - props.x;\n          node._width = props.width;\n          node._autosized = true;\n        }\n\n        if (isNaN(props.height)) {\n          props.height = (parent.height || 0) - props.y;\n          node._height = props.height;\n          node._autosized = true;\n        }\n\n        if (!props.color) {\n          // Default color to transparent - If you later set a src, you'll need\n          // to set color '#ffffffff'\n          node._color = props.color = 0x00000000;\n        }\n      }\n\n      log('Rendering: ', this, props);\n      node.lng = renderer.createNode(props);\n\n      if (node.onFail) {\n        node.lng.on('failed', node.onFail);\n      }\n\n      if (node.onLoad) {\n        node.lng.on('loaded', node.onLoad);\n      }\n\n      isFunc(this.onCreate) && this.onCreate.call(this, node);\n    }\n\n    node.rendered = true;\n    node.autofocus && node.setFocus();\n    // clean up after first render;\n    delete this._renderProps;\n  }\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { type Component } from \"solid-js\";\nimport type { IntrinsicTextProps } from \"../intrinsicTypes.js\";\n\nexport const Text: Component<IntrinsicTextProps> = (props) => <text {...props}></text>\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { type Component } from \"solid-js\";\nimport { type IntrinsicNodeProps } from \"../intrinsicTypes.js\";\n\nexport const View: Component<IntrinsicNodeProps> = (props) =>\n   <node {...props}></node>;\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { createEffect, type JSX } from \"solid-js\";\nimport { startLightningRenderer, type SolidRendererOptions } from '../core/renderer/index.js';\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\nimport { ElementNode, type SolidNode } from \"../core/node/index.js\";\nimport { isFunc } from \"../core/utils.js\";\n\nfunction renderTopDown(node: SolidNode) {\n  if (node.name === 'TextNode') {\n    return;\n  }\n  assertTruthy(node instanceof ElementNode);\n  node.render();\n  node.children.forEach(c => renderTopDown(c))\n}\n\nexport interface CanvasOptions {\n  coreExtensionModule?: string,\n  threadXCoreWorkerUrl?: string,\n}\n\nexport interface CanvasProps {\n  options?: Partial<SolidRendererOptions>;\n  onFirstRender?: (callback: () => void) => void;\n  children?: JSX.Element;\n  ref?: (el: ElementNode) => void;\n}\n\nexport const Canvas = (props: CanvasProps) => {\n  const renderer = startLightningRenderer(props.options);\n  const init = renderer.init();\n  let root: ElementNode | undefined;\n\n  createEffect(() => {\n    init.then(() => {\n      assertTruthy(root);\n      root.lng = renderer.root;\n      root.children.forEach(renderTopDown);\n      isFunc(props.onFirstRender) && props.onFirstRender(root);\n    }).catch(console.error);\n  })\n  return (\n    <canvas ref={root}>\n      {props.children}\n    </canvas>\n  )\n};\n","import {\n  createRoot,\n  createRenderEffect,\n  mergeProps,\n  createMemo,\n  createComponent,\n  untrack\n} from \"solid-js\";\n\nfunction createRenderer$1({\n  createElement,\n  createTextNode,\n  isTextNode,\n  replaceText,\n  insertNode,\n  removeNode,\n  setProperty,\n  getParentNode,\n  getFirstChild,\n  getNextSibling\n}) {\n  function insert(parent, accessor, marker, initial) {\n    if (marker !== undefined && !initial) initial = [];\n    if (typeof accessor !== \"function\") return insertExpression(parent, accessor, initial, marker);\n    createRenderEffect(current => insertExpression(parent, accessor(), current, marker), initial);\n  }\n  function insertExpression(parent, value, current, marker, unwrapArray) {\n    while (typeof current === \"function\") current = current();\n    if (value === current) return current;\n    const t = typeof value,\n      multi = marker !== undefined;\n    if (t === \"string\" || t === \"number\") {\n      if (t === \"number\") value = value.toString();\n      if (multi) {\n        let node = current[0];\n        if (node && isTextNode(node)) {\n          replaceText(node, value);\n        } else node = createTextNode(value);\n        current = cleanChildren(parent, current, marker, node);\n      } else {\n        if (current !== \"\" && typeof current === \"string\") {\n          replaceText(getFirstChild(parent), (current = value));\n        } else {\n          cleanChildren(parent, current, marker, createTextNode(value));\n          current = value;\n        }\n      }\n    } else if (value == null || t === \"boolean\") {\n      current = cleanChildren(parent, current, marker);\n    } else if (t === \"function\") {\n      createRenderEffect(() => {\n        let v = value();\n        while (typeof v === \"function\") v = v();\n        current = insertExpression(parent, v, current, marker);\n      });\n      return () => current;\n    } else if (Array.isArray(value)) {\n      const array = [];\n      if (normalizeIncomingArray(array, value, unwrapArray)) {\n        createRenderEffect(\n          () => (current = insertExpression(parent, array, current, marker, true))\n        );\n        return () => current;\n      }\n      if (array.length === 0) {\n        const replacement = cleanChildren(parent, current, marker);\n        if (multi) return (current = replacement);\n      } else {\n        if (Array.isArray(current)) {\n          if (current.length === 0) {\n            appendNodes(parent, array, marker);\n          } else reconcileArrays(parent, current, array);\n        } else if (current == null || current === \"\") {\n          appendNodes(parent, array);\n        } else {\n          reconcileArrays(parent, (multi && current) || [getFirstChild(parent)], array);\n        }\n      }\n      current = array;\n    } else {\n      if (Array.isArray(current)) {\n        if (multi) return (current = cleanChildren(parent, current, marker, value));\n        cleanChildren(parent, current, null, value);\n      } else if (current == null || current === \"\" || !getFirstChild(parent)) {\n        insertNode(parent, value);\n      } else replaceNode(parent, value, getFirstChild(parent));\n      current = value;\n    }\n    return current;\n  }\n  function normalizeIncomingArray(normalized, array, unwrap) {\n    let dynamic = false;\n    for (let i = 0, len = array.length; i < len; i++) {\n      let item = array[i],\n        t;\n      if (item == null || item === true || item === false);\n      else if (Array.isArray(item)) {\n        dynamic = normalizeIncomingArray(normalized, item) || dynamic;\n      } else if ((t = typeof item) === \"string\" || t === \"number\") {\n        normalized.push(createTextNode(item));\n      } else if (t === \"function\") {\n        if (unwrap) {\n          while (typeof item === \"function\") item = item();\n          dynamic =\n            normalizeIncomingArray(normalized, Array.isArray(item) ? item : [item]) || dynamic;\n        } else {\n          normalized.push(item);\n          dynamic = true;\n        }\n      } else normalized.push(item);\n    }\n    return dynamic;\n  }\n  function reconcileArrays(parentNode, a, b) {\n    let bLength = b.length,\n      aEnd = a.length,\n      bEnd = bLength,\n      aStart = 0,\n      bStart = 0,\n      after = getNextSibling(a[aEnd - 1]),\n      map = null;\n    while (aStart < aEnd || bStart < bEnd) {\n      if (a[aStart] === b[bStart]) {\n        aStart++;\n        bStart++;\n        continue;\n      }\n      while (a[aEnd - 1] === b[bEnd - 1]) {\n        aEnd--;\n        bEnd--;\n      }\n      if (aEnd === aStart) {\n        const node =\n          bEnd < bLength ? (bStart ? getNextSibling(b[bStart - 1]) : b[bEnd - bStart]) : after;\n        while (bStart < bEnd) insertNode(parentNode, b[bStart++], node);\n      } else if (bEnd === bStart) {\n        while (aStart < aEnd) {\n          if (!map || !map.has(a[aStart])) removeNode(parentNode, a[aStart]);\n          aStart++;\n        }\n      } else if (a[aStart] === b[bEnd - 1] && b[bStart] === a[aEnd - 1]) {\n        const node = getNextSibling(a[--aEnd]);\n        insertNode(parentNode, b[bStart++], getNextSibling(a[aStart++]));\n        insertNode(parentNode, b[--bEnd], node);\n        a[aEnd] = b[bEnd];\n      } else {\n        if (!map) {\n          map = new Map();\n          let i = bStart;\n          while (i < bEnd) map.set(b[i], i++);\n        }\n        const index = map.get(a[aStart]);\n        if (index != null) {\n          if (bStart < index && index < bEnd) {\n            let i = aStart,\n              sequence = 1,\n              t;\n            while (++i < aEnd && i < bEnd) {\n              if ((t = map.get(a[i])) == null || t !== index + sequence) break;\n              sequence++;\n            }\n            if (sequence > index - bStart) {\n              const node = a[aStart];\n              while (bStart < index) insertNode(parentNode, b[bStart++], node);\n            } else replaceNode(parentNode, b[bStart++], a[aStart++]);\n          } else aStart++;\n        } else removeNode(parentNode, a[aStart++]);\n      }\n    }\n  }\n  function cleanChildren(parent, current, marker, replacement) {\n    if (marker === undefined) {\n      let removed;\n      while ((removed = getFirstChild(parent))) removeNode(parent, removed);\n      replacement && insertNode(parent, replacement);\n      return \"\";\n    }\n    const node = replacement || createTextNode(\"\");\n    if (current.length) {\n      let inserted = false;\n      for (let i = current.length - 1; i >= 0; i--) {\n        const el = current[i];\n        if (node !== el) {\n          const isParent = getParentNode(el) === parent;\n          if (!inserted && !i)\n            isParent ? replaceNode(parent, node, el) : insertNode(parent, node, marker);\n          else isParent && removeNode(parent, el);\n        } else inserted = true;\n      }\n    } else insertNode(parent, node, marker);\n    return [node];\n  }\n  function appendNodes(parent, array, marker) {\n    for (let i = 0, len = array.length; i < len; i++) insertNode(parent, array[i], marker);\n  }\n  function replaceNode(parent, newNode, oldNode) {\n    insertNode(parent, newNode, oldNode);\n    removeNode(parent, oldNode);\n  }\n  function spreadExpression(node, props, prevProps = {}, skipChildren) {\n    props || (props = {});\n    if (!skipChildren) {\n      createRenderEffect(\n        () => (prevProps.children = insertExpression(node, props.children, prevProps.children))\n      );\n    }\n    createRenderEffect(() => props.ref && props.ref(node));\n    createRenderEffect(() => {\n      for (const prop in props) {\n        if (prop === \"children\" || prop === \"ref\") continue;\n        const value = props[prop];\n        if (value === prevProps[prop]) continue;\n        setProperty(node, prop, value, prevProps[prop]);\n        prevProps[prop] = value;\n      }\n    });\n    return prevProps;\n  }\n  return {\n    render(code, element) {\n      let disposer;\n      createRoot(dispose => {\n        disposer = dispose;\n        insert(element, code());\n      });\n      return disposer;\n    },\n    insert,\n    spread(node, accessor, skipChildren) {\n      if (typeof accessor === \"function\") {\n        createRenderEffect(current => spreadExpression(node, accessor(), current, skipChildren));\n      } else spreadExpression(node, accessor, undefined, skipChildren);\n    },\n    createElement,\n    createTextNode,\n    insertNode,\n    setProp(node, name, value, prev) {\n      setProperty(node, name, value, prev);\n      return value;\n    },\n    mergeProps,\n    effect: createRenderEffect,\n    memo: createMemo,\n    createComponent,\n    use(fn, element, arg) {\n      return untrack(() => fn(element, arg));\n    }\n  };\n}\n\nfunction createRenderer(options) {\n  const renderer = createRenderer$1(options);\n  renderer.mergeProps = mergeProps;\n  return renderer;\n}\n\nexport { createRenderer };\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { assertTruthy } from '@lightningjs/renderer/utils';\nimport { renderer } from '../renderer/index.js';\nimport { createEffect } from 'solid-js';\nimport { log } from '../utils.js';\nimport { ElementNode, type SolidNode, type TextNode } from '../node/index.js';\nimport type { createRenderer } from 'solid-js/universal';\n\nexport type SolidRendererOptions = Parameters<\n  typeof createRenderer<SolidNode>\n>[0];\n\nexport default {\n  createElement(name: string): ElementNode {\n    const node = new ElementNode(name);\n    renderer.root && createEffect(() => node.render());\n    return node;\n  },\n  createTextNode(text: string): TextNode {\n    // A text node is just a string - not the <text> node\n    return { name: 'TextNode', text, parent: null };\n  },\n  replaceText(node: TextNode, value: string): void {\n    log('Replace Text: ', node, value);\n    node.text = value;\n    const parent = node.parent;\n    assertTruthy(parent);\n    parent._autosized && parent._resizeOnTextLoad();\n    parent.text = parent.getText();\n  },\n  setProperty(node: ElementNode, name: string, value: any = true): void {\n    if (name === 'animate') {\n      node._animate = value as boolean;\n      return;\n    }\n\n    node[name] = value;\n  },\n  insertNode(parent: ElementNode, node: SolidNode, anchor: SolidNode): void {\n    log('INSERT: ', parent, node, anchor);\n    if (parent) {\n      parent.children.insert(node, anchor);\n\n      if (node.name === 'TextNode') {\n        // TextNodes can be placed outside of <text> nodes when <Show> is used as placeholder\n        if (parent.isTextNode()) {\n          parent._autosized && parent._resizeOnTextLoad();\n          parent.text = parent.getText();\n        }\n      }\n    }\n  },\n  isTextNode(node: ElementNode): boolean {\n    return node.isTextNode();\n  },\n  removeNode(parent: ElementNode, node: SolidNode): void {\n    log('REMOVE: ', parent, node);\n    parent.children.remove(node);\n    if (node instanceof ElementNode) {\n      node.destroy();\n    }\n  },\n  getParentNode(node: SolidNode): ElementNode | undefined {\n    return node.parent ?? undefined;\n  },\n  getFirstChild(node: ElementNode): SolidNode | undefined {\n    return node.children[0];\n  },\n  getNextSibling(node: SolidNode): SolidNode | undefined {\n    if (node.parent) {\n      const children = node.parent.children || [];\n      const index = children.indexOf(node) + 1;\n      if (index < children.length) {\n        return children[index];\n      }\n    }\n    return undefined;\n  },\n} satisfies SolidRendererOptions;\n","/* eslint-disable @typescript-eslint/unbound-method */\n/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { createRenderer } from 'solid-js/universal';\nimport universalLightning from './universal/lightning.js';\nimport universalInspector, {\n  attachInspector,\n} from './universal/dom-inspector.js';\nimport type { SolidNode } from './node/index.js';\nimport type { JSX } from 'solid-js';\nimport { isDev } from '../config.js';\n\nconst loadInspector = isDev;\nif (loadInspector) {\n  attachInspector();\n}\nconst solidRenderer = createRenderer<SolidNode>(\n  loadInspector ? universalInspector : universalLightning,\n);\n\n// TODO: This is a hack to get the `render()` function to work as it is used now in the demo app\n// There's gotta be a better way to fix it\nexport const render = solidRenderer.render as unknown as (\n  code: () => JSX.Element,\n  node?: SolidNode,\n) => () => void;\n\nexport const {\n  effect,\n  memo,\n  createComponent,\n  createElement,\n  createTextNode,\n  insertNode,\n  insert,\n  spread,\n  setProp,\n  mergeProps,\n  use,\n} = solidRenderer;\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isInteger } from './core/utils.js';\n\n/**\n * Converts a color string to a color number value.\n */\nexport function hexColor(color: string | number = ''): number {\n  if (isInteger(color)) {\n    return color;\n  }\n\n  if (typeof color === 'string') {\n    // Renderer expects RGBA values\n    if (color.startsWith('#')) {\n      return Number(\n        color.replace('#', '0x') + (color.length === 7 ? 'ff' : ''),\n      );\n    }\n\n    if (color.startsWith('0x')) {\n      return Number(color);\n    }\n    return Number('0x' + (color.length === 6 ? color + 'ff' : color));\n  }\n\n  return 0x00000000;\n}\n\n/**\n * Converts degrees to radians\n */\nexport function deg2rad(deg: number) {\n  return (deg * Math.PI) / 180;\n}\n","import {\n  createRoot,\n  sharedConfig,\n  createRenderEffect,\n  untrack,\n  enableHydration,\n  getOwner,\n  createEffect,\n  runWithOwner,\n  createMemo,\n  createSignal,\n  onCleanup,\n  splitProps\n} from \"solid-js\";\nexport {\n  ErrorBoundary,\n  For,\n  Index,\n  Match,\n  Show,\n  Suspense,\n  SuspenseList,\n  Switch,\n  createComponent,\n  createRenderEffect as effect,\n  getOwner,\n  createMemo as memo,\n  mergeProps,\n  untrack\n} from \"solid-js\";\n\nconst booleans = [\n  \"allowfullscreen\",\n  \"async\",\n  \"autofocus\",\n  \"autoplay\",\n  \"checked\",\n  \"controls\",\n  \"default\",\n  \"disabled\",\n  \"formnovalidate\",\n  \"hidden\",\n  \"indeterminate\",\n  \"inert\",\n  \"ismap\",\n  \"loop\",\n  \"multiple\",\n  \"muted\",\n  \"nomodule\",\n  \"novalidate\",\n  \"open\",\n  \"playsinline\",\n  \"readonly\",\n  \"required\",\n  \"reversed\",\n  \"seamless\",\n  \"selected\"\n];\nconst Properties = /*#__PURE__*/ new Set([\n  \"className\",\n  \"value\",\n  \"readOnly\",\n  \"formNoValidate\",\n  \"isMap\",\n  \"noModule\",\n  \"playsInline\",\n  ...booleans\n]);\nconst ChildProperties = /*#__PURE__*/ new Set([\n  \"innerHTML\",\n  \"textContent\",\n  \"innerText\",\n  \"children\"\n]);\nconst Aliases = /*#__PURE__*/ Object.assign(Object.create(null), {\n  className: \"class\",\n  htmlFor: \"for\"\n});\nconst PropAliases = /*#__PURE__*/ Object.assign(Object.create(null), {\n  class: \"className\",\n  formnovalidate: {\n    $: \"formNoValidate\",\n    BUTTON: 1,\n    INPUT: 1\n  },\n  ismap: {\n    $: \"isMap\",\n    IMG: 1\n  },\n  nomodule: {\n    $: \"noModule\",\n    SCRIPT: 1\n  },\n  playsinline: {\n    $: \"playsInline\",\n    VIDEO: 1\n  },\n  readonly: {\n    $: \"readOnly\",\n    INPUT: 1,\n    TEXTAREA: 1\n  }\n});\nfunction getPropAlias(prop, tagName) {\n  const a = PropAliases[prop];\n  return typeof a === \"object\" ? (a[tagName] ? a[\"$\"] : undefined) : a;\n}\nconst DelegatedEvents = /*#__PURE__*/ new Set([\n  \"beforeinput\",\n  \"click\",\n  \"dblclick\",\n  \"contextmenu\",\n  \"focusin\",\n  \"focusout\",\n  \"input\",\n  \"keydown\",\n  \"keyup\",\n  \"mousedown\",\n  \"mousemove\",\n  \"mouseout\",\n  \"mouseover\",\n  \"mouseup\",\n  \"pointerdown\",\n  \"pointermove\",\n  \"pointerout\",\n  \"pointerover\",\n  \"pointerup\",\n  \"touchend\",\n  \"touchmove\",\n  \"touchstart\"\n]);\nconst SVGElements = /*#__PURE__*/ new Set([\n  \"altGlyph\",\n  \"altGlyphDef\",\n  \"altGlyphItem\",\n  \"animate\",\n  \"animateColor\",\n  \"animateMotion\",\n  \"animateTransform\",\n  \"circle\",\n  \"clipPath\",\n  \"color-profile\",\n  \"cursor\",\n  \"defs\",\n  \"desc\",\n  \"ellipse\",\n  \"feBlend\",\n  \"feColorMatrix\",\n  \"feComponentTransfer\",\n  \"feComposite\",\n  \"feConvolveMatrix\",\n  \"feDiffuseLighting\",\n  \"feDisplacementMap\",\n  \"feDistantLight\",\n  \"feFlood\",\n  \"feFuncA\",\n  \"feFuncB\",\n  \"feFuncG\",\n  \"feFuncR\",\n  \"feGaussianBlur\",\n  \"feImage\",\n  \"feMerge\",\n  \"feMergeNode\",\n  \"feMorphology\",\n  \"feOffset\",\n  \"fePointLight\",\n  \"feSpecularLighting\",\n  \"feSpotLight\",\n  \"feTile\",\n  \"feTurbulence\",\n  \"filter\",\n  \"font\",\n  \"font-face\",\n  \"font-face-format\",\n  \"font-face-name\",\n  \"font-face-src\",\n  \"font-face-uri\",\n  \"foreignObject\",\n  \"g\",\n  \"glyph\",\n  \"glyphRef\",\n  \"hkern\",\n  \"image\",\n  \"line\",\n  \"linearGradient\",\n  \"marker\",\n  \"mask\",\n  \"metadata\",\n  \"missing-glyph\",\n  \"mpath\",\n  \"path\",\n  \"pattern\",\n  \"polygon\",\n  \"polyline\",\n  \"radialGradient\",\n  \"rect\",\n  \"set\",\n  \"stop\",\n  \"svg\",\n  \"switch\",\n  \"symbol\",\n  \"text\",\n  \"textPath\",\n  \"tref\",\n  \"tspan\",\n  \"use\",\n  \"view\",\n  \"vkern\"\n]);\nconst SVGNamespace = {\n  xlink: \"http://www.w3.org/1999/xlink\",\n  xml: \"http://www.w3.org/XML/1998/namespace\"\n};\nconst DOMElements = /*#__PURE__*/ new Set([\n  \"html\",\n  \"base\",\n  \"head\",\n  \"link\",\n  \"meta\",\n  \"style\",\n  \"title\",\n  \"body\",\n  \"address\",\n  \"article\",\n  \"aside\",\n  \"footer\",\n  \"header\",\n  \"main\",\n  \"nav\",\n  \"section\",\n  \"body\",\n  \"blockquote\",\n  \"dd\",\n  \"div\",\n  \"dl\",\n  \"dt\",\n  \"figcaption\",\n  \"figure\",\n  \"hr\",\n  \"li\",\n  \"ol\",\n  \"p\",\n  \"pre\",\n  \"ul\",\n  \"a\",\n  \"abbr\",\n  \"b\",\n  \"bdi\",\n  \"bdo\",\n  \"br\",\n  \"cite\",\n  \"code\",\n  \"data\",\n  \"dfn\",\n  \"em\",\n  \"i\",\n  \"kbd\",\n  \"mark\",\n  \"q\",\n  \"rp\",\n  \"rt\",\n  \"ruby\",\n  \"s\",\n  \"samp\",\n  \"small\",\n  \"span\",\n  \"strong\",\n  \"sub\",\n  \"sup\",\n  \"time\",\n  \"u\",\n  \"var\",\n  \"wbr\",\n  \"area\",\n  \"audio\",\n  \"img\",\n  \"map\",\n  \"track\",\n  \"video\",\n  \"embed\",\n  \"iframe\",\n  \"object\",\n  \"param\",\n  \"picture\",\n  \"portal\",\n  \"source\",\n  \"svg\",\n  \"math\",\n  \"canvas\",\n  \"noscript\",\n  \"script\",\n  \"del\",\n  \"ins\",\n  \"caption\",\n  \"col\",\n  \"colgroup\",\n  \"table\",\n  \"tbody\",\n  \"td\",\n  \"tfoot\",\n  \"th\",\n  \"thead\",\n  \"tr\",\n  \"button\",\n  \"datalist\",\n  \"fieldset\",\n  \"form\",\n  \"input\",\n  \"label\",\n  \"legend\",\n  \"meter\",\n  \"optgroup\",\n  \"option\",\n  \"output\",\n  \"progress\",\n  \"select\",\n  \"textarea\",\n  \"details\",\n  \"dialog\",\n  \"menu\",\n  \"summary\",\n  \"details\",\n  \"slot\",\n  \"template\",\n  \"acronym\",\n  \"applet\",\n  \"basefont\",\n  \"bgsound\",\n  \"big\",\n  \"blink\",\n  \"center\",\n  \"content\",\n  \"dir\",\n  \"font\",\n  \"frame\",\n  \"frameset\",\n  \"hgroup\",\n  \"image\",\n  \"keygen\",\n  \"marquee\",\n  \"menuitem\",\n  \"nobr\",\n  \"noembed\",\n  \"noframes\",\n  \"plaintext\",\n  \"rb\",\n  \"rtc\",\n  \"shadow\",\n  \"spacer\",\n  \"strike\",\n  \"tt\",\n  \"xmp\",\n  \"a\",\n  \"abbr\",\n  \"acronym\",\n  \"address\",\n  \"applet\",\n  \"area\",\n  \"article\",\n  \"aside\",\n  \"audio\",\n  \"b\",\n  \"base\",\n  \"basefont\",\n  \"bdi\",\n  \"bdo\",\n  \"bgsound\",\n  \"big\",\n  \"blink\",\n  \"blockquote\",\n  \"body\",\n  \"br\",\n  \"button\",\n  \"canvas\",\n  \"caption\",\n  \"center\",\n  \"cite\",\n  \"code\",\n  \"col\",\n  \"colgroup\",\n  \"content\",\n  \"data\",\n  \"datalist\",\n  \"dd\",\n  \"del\",\n  \"details\",\n  \"dfn\",\n  \"dialog\",\n  \"dir\",\n  \"div\",\n  \"dl\",\n  \"dt\",\n  \"em\",\n  \"embed\",\n  \"fieldset\",\n  \"figcaption\",\n  \"figure\",\n  \"font\",\n  \"footer\",\n  \"form\",\n  \"frame\",\n  \"frameset\",\n  \"head\",\n  \"header\",\n  \"hgroup\",\n  \"hr\",\n  \"html\",\n  \"i\",\n  \"iframe\",\n  \"image\",\n  \"img\",\n  \"input\",\n  \"ins\",\n  \"kbd\",\n  \"keygen\",\n  \"label\",\n  \"legend\",\n  \"li\",\n  \"link\",\n  \"main\",\n  \"map\",\n  \"mark\",\n  \"marquee\",\n  \"menu\",\n  \"menuitem\",\n  \"meta\",\n  \"meter\",\n  \"nav\",\n  \"nobr\",\n  \"noembed\",\n  \"noframes\",\n  \"noscript\",\n  \"object\",\n  \"ol\",\n  \"optgroup\",\n  \"option\",\n  \"output\",\n  \"p\",\n  \"param\",\n  \"picture\",\n  \"plaintext\",\n  \"portal\",\n  \"pre\",\n  \"progress\",\n  \"q\",\n  \"rb\",\n  \"rp\",\n  \"rt\",\n  \"rtc\",\n  \"ruby\",\n  \"s\",\n  \"samp\",\n  \"script\",\n  \"section\",\n  \"select\",\n  \"shadow\",\n  \"slot\",\n  \"small\",\n  \"source\",\n  \"spacer\",\n  \"span\",\n  \"strike\",\n  \"strong\",\n  \"style\",\n  \"sub\",\n  \"summary\",\n  \"sup\",\n  \"table\",\n  \"tbody\",\n  \"td\",\n  \"template\",\n  \"textarea\",\n  \"tfoot\",\n  \"th\",\n  \"thead\",\n  \"time\",\n  \"title\",\n  \"tr\",\n  \"track\",\n  \"tt\",\n  \"u\",\n  \"ul\",\n  \"var\",\n  \"video\",\n  \"wbr\",\n  \"xmp\",\n  \"input\",\n  \"h1\",\n  \"h2\",\n  \"h3\",\n  \"h4\",\n  \"h5\",\n  \"h6\"\n]);\n\nfunction reconcileArrays(parentNode, a, b) {\n  let bLength = b.length,\n    aEnd = a.length,\n    bEnd = bLength,\n    aStart = 0,\n    bStart = 0,\n    after = a[aEnd - 1].nextSibling,\n    map = null;\n  while (aStart < aEnd || bStart < bEnd) {\n    if (a[aStart] === b[bStart]) {\n      aStart++;\n      bStart++;\n      continue;\n    }\n    while (a[aEnd - 1] === b[bEnd - 1]) {\n      aEnd--;\n      bEnd--;\n    }\n    if (aEnd === aStart) {\n      const node = bEnd < bLength ? (bStart ? b[bStart - 1].nextSibling : b[bEnd - bStart]) : after;\n      while (bStart < bEnd) parentNode.insertBefore(b[bStart++], node);\n    } else if (bEnd === bStart) {\n      while (aStart < aEnd) {\n        if (!map || !map.has(a[aStart])) a[aStart].remove();\n        aStart++;\n      }\n    } else if (a[aStart] === b[bEnd - 1] && b[bStart] === a[aEnd - 1]) {\n      const node = a[--aEnd].nextSibling;\n      parentNode.insertBefore(b[bStart++], a[aStart++].nextSibling);\n      parentNode.insertBefore(b[--bEnd], node);\n      a[aEnd] = b[bEnd];\n    } else {\n      if (!map) {\n        map = new Map();\n        let i = bStart;\n        while (i < bEnd) map.set(b[i], i++);\n      }\n      const index = map.get(a[aStart]);\n      if (index != null) {\n        if (bStart < index && index < bEnd) {\n          let i = aStart,\n            sequence = 1,\n            t;\n          while (++i < aEnd && i < bEnd) {\n            if ((t = map.get(a[i])) == null || t !== index + sequence) break;\n            sequence++;\n          }\n          if (sequence > index - bStart) {\n            const node = a[aStart];\n            while (bStart < index) parentNode.insertBefore(b[bStart++], node);\n          } else parentNode.replaceChild(b[bStart++], a[aStart++]);\n        } else aStart++;\n      } else a[aStart++].remove();\n    }\n  }\n}\n\nconst $$EVENTS = \"_$DX_DELEGATE\";\nfunction render(code, element, init, options = {}) {\n  let disposer;\n  createRoot(dispose => {\n    disposer = dispose;\n    element === document\n      ? code()\n      : insert(element, code(), element.firstChild ? null : undefined, init);\n  }, options.owner);\n  return () => {\n    disposer();\n    element.textContent = \"\";\n  };\n}\nfunction template(html, isCE, isSVG) {\n  let node;\n  const create = () => {\n    const t = document.createElement(\"template\");\n    t.innerHTML = html;\n    return isSVG ? t.content.firstChild.firstChild : t.content.firstChild;\n  };\n  const fn = isCE\n    ? () => untrack(() => document.importNode(node || (node = create()), true))\n    : () => (node || (node = create())).cloneNode(true);\n  fn.cloneNode = fn;\n  return fn;\n}\nfunction delegateEvents(eventNames, document = window.document) {\n  const e = document[$$EVENTS] || (document[$$EVENTS] = new Set());\n  for (let i = 0, l = eventNames.length; i < l; i++) {\n    const name = eventNames[i];\n    if (!e.has(name)) {\n      e.add(name);\n      document.addEventListener(name, eventHandler);\n    }\n  }\n}\nfunction clearDelegatedEvents(document = window.document) {\n  if (document[$$EVENTS]) {\n    for (let name of document[$$EVENTS].keys()) document.removeEventListener(name, eventHandler);\n    delete document[$$EVENTS];\n  }\n}\nfunction setProperty(node, name, value) {\n  !sharedConfig.context && (node[name] = value);\n}\nfunction setAttribute(node, name, value) {\n  if (sharedConfig.context) return;\n  if (value == null) node.removeAttribute(name);\n  else node.setAttribute(name, value);\n}\nfunction setAttributeNS(node, namespace, name, value) {\n  if (sharedConfig.context) return;\n  if (value == null) node.removeAttributeNS(namespace, name);\n  else node.setAttributeNS(namespace, name, value);\n}\nfunction className(node, value) {\n  if (sharedConfig.context) return;\n  if (value == null) node.removeAttribute(\"class\");\n  else node.className = value;\n}\nfunction addEventListener(node, name, handler, delegate) {\n  if (delegate) {\n    if (Array.isArray(handler)) {\n      node[`$$${name}`] = handler[0];\n      node[`$$${name}Data`] = handler[1];\n    } else node[`$$${name}`] = handler;\n  } else if (Array.isArray(handler)) {\n    const handlerFn = handler[0];\n    node.addEventListener(name, (handler[0] = e => handlerFn.call(node, handler[1], e)));\n  } else node.addEventListener(name, handler);\n}\nfunction classList(node, value, prev = {}) {\n  const classKeys = Object.keys(value || {}),\n    prevKeys = Object.keys(prev);\n  let i, len;\n  for (i = 0, len = prevKeys.length; i < len; i++) {\n    const key = prevKeys[i];\n    if (!key || key === \"undefined\" || value[key]) continue;\n    toggleClassKey(node, key, false);\n    delete prev[key];\n  }\n  for (i = 0, len = classKeys.length; i < len; i++) {\n    const key = classKeys[i],\n      classValue = !!value[key];\n    if (!key || key === \"undefined\" || prev[key] === classValue || !classValue) continue;\n    toggleClassKey(node, key, true);\n    prev[key] = classValue;\n  }\n  return prev;\n}\nfunction style(node, value, prev) {\n  if (!value) return prev ? setAttribute(node, \"style\") : value;\n  const nodeStyle = node.style;\n  if (typeof value === \"string\") return (nodeStyle.cssText = value);\n  typeof prev === \"string\" && (nodeStyle.cssText = prev = undefined);\n  prev || (prev = {});\n  value || (value = {});\n  let v, s;\n  for (s in prev) {\n    value[s] == null && nodeStyle.removeProperty(s);\n    delete prev[s];\n  }\n  for (s in value) {\n    v = value[s];\n    if (v !== prev[s]) {\n      nodeStyle.setProperty(s, v);\n      prev[s] = v;\n    }\n  }\n  return prev;\n}\nfunction spread(node, props = {}, isSVG, skipChildren) {\n  const prevProps = {};\n  if (!skipChildren) {\n    createRenderEffect(\n      () => (prevProps.children = insertExpression(node, props.children, prevProps.children))\n    );\n  }\n  createRenderEffect(() => props.ref && props.ref(node));\n  createRenderEffect(() => assign(node, props, isSVG, true, prevProps, true));\n  return prevProps;\n}\nfunction dynamicProperty(props, key) {\n  const src = props[key];\n  Object.defineProperty(props, key, {\n    get() {\n      return src();\n    },\n    enumerable: true\n  });\n  return props;\n}\nfunction use(fn, element, arg) {\n  return untrack(() => fn(element, arg));\n}\nfunction insert(parent, accessor, marker, initial) {\n  if (marker !== undefined && !initial) initial = [];\n  if (typeof accessor !== \"function\") return insertExpression(parent, accessor, initial, marker);\n  createRenderEffect(current => insertExpression(parent, accessor(), current, marker), initial);\n}\nfunction assign(node, props, isSVG, skipChildren, prevProps = {}, skipRef = false) {\n  props || (props = {});\n  for (const prop in prevProps) {\n    if (!(prop in props)) {\n      if (prop === \"children\") continue;\n      prevProps[prop] = assignProp(node, prop, null, prevProps[prop], isSVG, skipRef);\n    }\n  }\n  for (const prop in props) {\n    if (prop === \"children\") {\n      if (!skipChildren) insertExpression(node, props.children);\n      continue;\n    }\n    const value = props[prop];\n    prevProps[prop] = assignProp(node, prop, value, prevProps[prop], isSVG, skipRef);\n  }\n}\nfunction hydrate$1(code, element, options = {}) {\n  sharedConfig.completed = globalThis._$HY.completed;\n  sharedConfig.events = globalThis._$HY.events;\n  sharedConfig.load = id => globalThis._$HY.r[id];\n  sharedConfig.has = id => id in globalThis._$HY.r;\n  sharedConfig.gather = root => gatherHydratable(element, root);\n  sharedConfig.registry = new Map();\n  sharedConfig.context = {\n    id: options.renderId || \"\",\n    count: 0\n  };\n  gatherHydratable(element, options.renderId);\n  const dispose = render(code, element, [...element.childNodes], options);\n  sharedConfig.context = null;\n  return dispose;\n}\nfunction getNextElement(template) {\n  let node, key;\n  if (!sharedConfig.context || !(node = sharedConfig.registry.get((key = getHydrationKey())))) {\n    return template();\n  }\n  if (sharedConfig.completed) sharedConfig.completed.add(node);\n  sharedConfig.registry.delete(key);\n  return node;\n}\nfunction getNextMatch(el, nodeName) {\n  while (el && el.localName !== nodeName) el = el.nextSibling;\n  return el;\n}\nfunction getNextMarker(start) {\n  let end = start,\n    count = 0,\n    current = [];\n  if (sharedConfig.context) {\n    while (end) {\n      if (end.nodeType === 8) {\n        const v = end.nodeValue;\n        if (v === \"$\") count++;\n        else if (v === \"/\") {\n          if (count === 0) return [end, current];\n          count--;\n        }\n      }\n      current.push(end);\n      end = end.nextSibling;\n    }\n  }\n  return [end, current];\n}\nfunction runHydrationEvents() {\n  if (sharedConfig.events && !sharedConfig.events.queued) {\n    queueMicrotask(() => {\n      const { completed, events } = sharedConfig;\n      events.queued = false;\n      while (events.length) {\n        const [el, e] = events[0];\n        if (!completed.has(el)) return;\n        eventHandler(e);\n        events.shift();\n      }\n    });\n    sharedConfig.events.queued = true;\n  }\n}\nfunction toPropertyName(name) {\n  return name.toLowerCase().replace(/-([a-z])/g, (_, w) => w.toUpperCase());\n}\nfunction toggleClassKey(node, key, value) {\n  const classNames = key.trim().split(/\\s+/);\n  for (let i = 0, nameLen = classNames.length; i < nameLen; i++)\n    node.classList.toggle(classNames[i], value);\n}\nfunction assignProp(node, prop, value, prev, isSVG, skipRef) {\n  let isCE, isProp, isChildProp, propAlias, forceProp;\n  if (prop === \"style\") return style(node, value, prev);\n  if (prop === \"classList\") return classList(node, value, prev);\n  if (value === prev) return prev;\n  if (prop === \"ref\") {\n    if (!skipRef) value(node);\n  } else if (prop.slice(0, 3) === \"on:\") {\n    const e = prop.slice(3);\n    prev && node.removeEventListener(e, prev);\n    value && node.addEventListener(e, value);\n  } else if (prop.slice(0, 10) === \"oncapture:\") {\n    const e = prop.slice(10);\n    prev && node.removeEventListener(e, prev, true);\n    value && node.addEventListener(e, value, true);\n  } else if (prop.slice(0, 2) === \"on\") {\n    const name = prop.slice(2).toLowerCase();\n    const delegate = DelegatedEvents.has(name);\n    if (!delegate && prev) {\n      const h = Array.isArray(prev) ? prev[0] : prev;\n      node.removeEventListener(name, h);\n    }\n    if (delegate || value) {\n      addEventListener(node, name, value, delegate);\n      delegate && delegateEvents([name]);\n    }\n  } else if (prop.slice(0, 5) === \"attr:\") {\n    setAttribute(node, prop.slice(5), value);\n  } else if (\n    (forceProp = prop.slice(0, 5) === \"prop:\") ||\n    (isChildProp = ChildProperties.has(prop)) ||\n    (!isSVG &&\n      ((propAlias = getPropAlias(prop, node.tagName)) || (isProp = Properties.has(prop)))) ||\n    (isCE = node.nodeName.includes(\"-\"))\n  ) {\n    if (forceProp) {\n      prop = prop.slice(5);\n      isProp = true;\n    } else if (sharedConfig.context) return value;\n    if (prop === \"class\" || prop === \"className\") className(node, value);\n    else if (isCE && !isProp && !isChildProp) node[toPropertyName(prop)] = value;\n    else node[propAlias || prop] = value;\n  } else {\n    const ns = isSVG && prop.indexOf(\":\") > -1 && SVGNamespace[prop.split(\":\")[0]];\n    if (ns) setAttributeNS(node, ns, prop, value);\n    else setAttribute(node, Aliases[prop] || prop, value);\n  }\n  return value;\n}\nfunction eventHandler(e) {\n  const key = `$$${e.type}`;\n  let node = (e.composedPath && e.composedPath()[0]) || e.target;\n  if (e.target !== node) {\n    Object.defineProperty(e, \"target\", {\n      configurable: true,\n      value: node\n    });\n  }\n  Object.defineProperty(e, \"currentTarget\", {\n    configurable: true,\n    get() {\n      return node || document;\n    }\n  });\n  if (sharedConfig.registry && !sharedConfig.done) sharedConfig.done = _$HY.done = true;\n  while (node) {\n    const handler = node[key];\n    if (handler && !node.disabled) {\n      const data = node[`${key}Data`];\n      data !== undefined ? handler.call(node, data, e) : handler.call(node, e);\n      if (e.cancelBubble) return;\n    }\n    node = node._$host || node.parentNode || node.host;\n  }\n}\nfunction insertExpression(parent, value, current, marker, unwrapArray) {\n  if (sharedConfig.context) {\n    !current && (current = [...parent.childNodes]);\n    let cleaned = [];\n    for (let i = 0; i < current.length; i++) {\n      const node = current[i];\n      if (node.nodeType === 8 && node.data.slice(0, 2) === \"!$\") node.remove();\n      else cleaned.push(node);\n    }\n    current = cleaned;\n  }\n  while (typeof current === \"function\") current = current();\n  if (value === current) return current;\n  const t = typeof value,\n    multi = marker !== undefined;\n  parent = (multi && current[0] && current[0].parentNode) || parent;\n  if (t === \"string\" || t === \"number\") {\n    if (sharedConfig.context) return current;\n    if (t === \"number\") value = value.toString();\n    if (multi) {\n      let node = current[0];\n      if (node && node.nodeType === 3) {\n        node.data = value;\n      } else node = document.createTextNode(value);\n      current = cleanChildren(parent, current, marker, node);\n    } else {\n      if (current !== \"\" && typeof current === \"string\") {\n        current = parent.firstChild.data = value;\n      } else current = parent.textContent = value;\n    }\n  } else if (value == null || t === \"boolean\") {\n    if (sharedConfig.context) return current;\n    current = cleanChildren(parent, current, marker);\n  } else if (t === \"function\") {\n    createRenderEffect(() => {\n      let v = value();\n      while (typeof v === \"function\") v = v();\n      current = insertExpression(parent, v, current, marker);\n    });\n    return () => current;\n  } else if (Array.isArray(value)) {\n    const array = [];\n    const currentArray = current && Array.isArray(current);\n    if (normalizeIncomingArray(array, value, current, unwrapArray)) {\n      createRenderEffect(() => (current = insertExpression(parent, array, current, marker, true)));\n      return () => current;\n    }\n    if (sharedConfig.context) {\n      if (!array.length) return current;\n      if (marker === undefined) return [...parent.childNodes];\n      let node = array[0];\n      let nodes = [node];\n      while ((node = node.nextSibling) !== marker) nodes.push(node);\n      return (current = nodes);\n    }\n    if (array.length === 0) {\n      current = cleanChildren(parent, current, marker);\n      if (multi) return current;\n    } else if (currentArray) {\n      if (current.length === 0) {\n        appendNodes(parent, array, marker);\n      } else reconcileArrays(parent, current, array);\n    } else {\n      current && cleanChildren(parent);\n      appendNodes(parent, array);\n    }\n    current = array;\n  } else if (value.nodeType) {\n    if (sharedConfig.context && value.parentNode) return (current = multi ? [value] : value);\n    if (Array.isArray(current)) {\n      if (multi) return (current = cleanChildren(parent, current, marker, value));\n      cleanChildren(parent, current, null, value);\n    } else if (current == null || current === \"\" || !parent.firstChild) {\n      parent.appendChild(value);\n    } else parent.replaceChild(value, parent.firstChild);\n    current = value;\n  } else;\n  return current;\n}\nfunction normalizeIncomingArray(normalized, array, current, unwrap) {\n  let dynamic = false;\n  for (let i = 0, len = array.length; i < len; i++) {\n    let item = array[i],\n      prev = current && current[i],\n      t;\n    if (item == null || item === true || item === false);\n    else if ((t = typeof item) === \"object\" && item.nodeType) {\n      normalized.push(item);\n    } else if (Array.isArray(item)) {\n      dynamic = normalizeIncomingArray(normalized, item, prev) || dynamic;\n    } else if (t === \"function\") {\n      if (unwrap) {\n        while (typeof item === \"function\") item = item();\n        dynamic =\n          normalizeIncomingArray(\n            normalized,\n            Array.isArray(item) ? item : [item],\n            Array.isArray(prev) ? prev : [prev]\n          ) || dynamic;\n      } else {\n        normalized.push(item);\n        dynamic = true;\n      }\n    } else {\n      const value = String(item);\n      if (prev && prev.nodeType === 3 && prev.data === value) normalized.push(prev);\n      else normalized.push(document.createTextNode(value));\n    }\n  }\n  return dynamic;\n}\nfunction appendNodes(parent, array, marker = null) {\n  for (let i = 0, len = array.length; i < len; i++) parent.insertBefore(array[i], marker);\n}\nfunction cleanChildren(parent, current, marker, replacement) {\n  if (marker === undefined) return (parent.textContent = \"\");\n  const node = replacement || document.createTextNode(\"\");\n  if (current.length) {\n    let inserted = false;\n    for (let i = current.length - 1; i >= 0; i--) {\n      const el = current[i];\n      if (node !== el) {\n        const isParent = el.parentNode === parent;\n        if (!inserted && !i)\n          isParent ? parent.replaceChild(node, el) : parent.insertBefore(node, marker);\n        else isParent && el.remove();\n      } else inserted = true;\n    }\n  } else parent.insertBefore(node, marker);\n  return [node];\n}\nfunction gatherHydratable(element, root) {\n  const templates = element.querySelectorAll(`*[data-hk]`);\n  for (let i = 0; i < templates.length; i++) {\n    const node = templates[i];\n    const key = node.getAttribute(\"data-hk\");\n    if ((!root || key.startsWith(root)) && !sharedConfig.registry.has(key))\n      sharedConfig.registry.set(key, node);\n  }\n}\nfunction getHydrationKey() {\n  const hydrate = sharedConfig.context;\n  return `${hydrate.id}${hydrate.count++}`;\n}\nfunction NoHydration(props) {\n  return sharedConfig.context ? undefined : props.children;\n}\nfunction Hydration(props) {\n  return props.children;\n}\nfunction voidFn() {}\nconst RequestContext = Symbol();\nfunction innerHTML(parent, content) {\n  !sharedConfig.context && (parent.innerHTML = content);\n}\n\nfunction throwInBrowser(func) {\n  const err = new Error(`${func.name} is not supported in the browser, returning undefined`);\n  console.error(err);\n}\nfunction renderToString(fn, options) {\n  throwInBrowser(renderToString);\n}\nfunction renderToStringAsync(fn, options) {\n  throwInBrowser(renderToStringAsync);\n}\nfunction renderToStream(fn, options) {\n  throwInBrowser(renderToStream);\n}\nfunction ssr(template, ...nodes) {}\nfunction ssrElement(name, props, children, needsId) {}\nfunction ssrClassList(value) {}\nfunction ssrStyle(value) {}\nfunction ssrAttribute(key, value) {}\nfunction ssrHydrationKey() {}\nfunction resolveSSRNode(node) {}\nfunction escape(html) {}\nfunction ssrSpread(props, isSVG, skipChildren) {}\n\nconst isServer = false;\nconst isDev = false;\nconst SVG_NAMESPACE = \"http://www.w3.org/2000/svg\";\nfunction createElement(tagName, isSVG = false) {\n  return isSVG ? document.createElementNS(SVG_NAMESPACE, tagName) : document.createElement(tagName);\n}\nconst hydrate = (...args) => {\n  enableHydration();\n  return hydrate$1(...args);\n};\nfunction Portal(props) {\n  const { useShadow } = props,\n    marker = document.createTextNode(\"\"),\n    mount = () => props.mount || document.body,\n    owner = getOwner();\n  let content;\n  let hydrating = !!sharedConfig.context;\n  createEffect(\n    () => {\n      if (hydrating) getOwner().user = hydrating = false;\n      content || (content = runWithOwner(owner, () => createMemo(() => props.children)));\n      const el = mount();\n      if (el instanceof HTMLHeadElement) {\n        const [clean, setClean] = createSignal(false);\n        const cleanup = () => setClean(true);\n        createRoot(dispose => insert(el, () => (!clean() ? content() : dispose()), null));\n        onCleanup(cleanup);\n      } else {\n        const container = createElement(props.isSVG ? \"g\" : \"div\", props.isSVG),\n          renderRoot =\n            useShadow && container.attachShadow\n              ? container.attachShadow({\n                  mode: \"open\"\n                })\n              : container;\n        Object.defineProperty(container, \"_$host\", {\n          get() {\n            return marker.parentNode;\n          },\n          configurable: true\n        });\n        insert(renderRoot, content);\n        el.appendChild(container);\n        props.ref && props.ref(container);\n        onCleanup(() => el.removeChild(container));\n      }\n    },\n    undefined,\n    {\n      render: !hydrating\n    }\n  );\n  return marker;\n}\nfunction Dynamic(props) {\n  const [p, others] = splitProps(props, [\"component\"]);\n  const cached = createMemo(() => p.component);\n  return createMemo(() => {\n    const component = cached();\n    switch (typeof component) {\n      case \"function\":\n        return untrack(() => component(others));\n      case \"string\":\n        const isSvg = SVGElements.has(component);\n        const el = sharedConfig.context ? getNextElement() : createElement(component, isSvg);\n        spread(el, others, isSvg);\n        return el;\n    }\n  });\n}\n\nexport {\n  Aliases,\n  voidFn as Assets,\n  ChildProperties,\n  DOMElements,\n  DelegatedEvents,\n  Dynamic,\n  Hydration,\n  voidFn as HydrationScript,\n  NoHydration,\n  Portal,\n  Properties,\n  RequestContext,\n  SVGElements,\n  SVGNamespace,\n  addEventListener,\n  assign,\n  classList,\n  className,\n  clearDelegatedEvents,\n  delegateEvents,\n  dynamicProperty,\n  escape,\n  voidFn as generateHydrationScript,\n  voidFn as getAssets,\n  getHydrationKey,\n  getNextElement,\n  getNextMarker,\n  getNextMatch,\n  getPropAlias,\n  voidFn as getRequestEvent,\n  hydrate,\n  innerHTML,\n  insert,\n  isDev,\n  isServer,\n  render,\n  renderToStream,\n  renderToString,\n  renderToStringAsync,\n  resolveSSRNode,\n  runHydrationEvents,\n  setAttribute,\n  setAttributeNS,\n  setProperty,\n  spread,\n  ssr,\n  ssrAttribute,\n  ssrClassList,\n  ssrElement,\n  ssrHydrationKey,\n  ssrSpread,\n  ssrStyle,\n  style,\n  template,\n  use,\n  voidFn as useAssets\n};\n","export function createBeforeLeave() {\n    let listeners = new Set();\n    function subscribe(listener) {\n        listeners.add(listener);\n        return () => listeners.delete(listener);\n    }\n    let ignore = false;\n    function confirm(to, options) {\n        if (ignore)\n            return !(ignore = false);\n        const e = {\n            to,\n            options,\n            defaultPrevented: false,\n            preventDefault: () => (e.defaultPrevented = true)\n        };\n        for (const l of listeners)\n            l.listener({\n                ...e,\n                from: l.location,\n                retry: (force) => {\n                    force && (ignore = true);\n                    l.navigate(to, options);\n                }\n            });\n        return !e.defaultPrevented;\n    }\n    return {\n        subscribe,\n        confirm\n    };\n}\n","import { createMemo, getOwner, runWithOwner } from \"solid-js\";\nconst hasSchemeRegex = /^(?:[a-z0-9]+:)?\\/\\//i;\nconst trimPathRegex = /^\\/+|(\\/)\\/+$/g;\nexport const redirectStatusCodes = new Set([204, 301, 302, 303, 307, 308]);\nexport function normalizePath(path, omitSlash = false) {\n    const s = path.replace(trimPathRegex, \"$1\");\n    return s ? (omitSlash || /^[?#]/.test(s) ? s : \"/\" + s) : \"\";\n}\nexport function resolvePath(base, path, from) {\n    if (hasSchemeRegex.test(path)) {\n        return undefined;\n    }\n    const basePath = normalizePath(base);\n    const fromPath = from && normalizePath(from);\n    let result = \"\";\n    if (!fromPath || path.startsWith(\"/\")) {\n        result = basePath;\n    }\n    else if (fromPath.toLowerCase().indexOf(basePath.toLowerCase()) !== 0) {\n        result = basePath + fromPath;\n    }\n    else {\n        result = fromPath;\n    }\n    return (result || \"/\") + normalizePath(path, !result);\n}\nexport function invariant(value, message) {\n    if (value == null) {\n        throw new Error(message);\n    }\n    return value;\n}\nexport function joinPaths(from, to) {\n    return normalizePath(from).replace(/\\/*(\\*.*)?$/g, \"\") + normalizePath(to);\n}\nexport function extractSearchParams(url) {\n    const params = {};\n    url.searchParams.forEach((value, key) => {\n        params[key] = value;\n    });\n    return params;\n}\nexport function createMatcher(path, partial, matchFilters) {\n    const [pattern, splat] = path.split(\"/*\", 2);\n    const segments = pattern.split(\"/\").filter(Boolean);\n    const len = segments.length;\n    return (location) => {\n        const locSegments = location.split(\"/\").filter(Boolean);\n        const lenDiff = locSegments.length - len;\n        if (lenDiff < 0 || (lenDiff > 0 && splat === undefined && !partial)) {\n            return null;\n        }\n        const match = {\n            path: len ? \"\" : \"/\",\n            params: {}\n        };\n        const matchFilter = (s) => matchFilters === undefined ? undefined : matchFilters[s];\n        for (let i = 0; i < len; i++) {\n            const segment = segments[i];\n            const locSegment = locSegments[i];\n            const dynamic = segment[0] === \":\";\n            const key = dynamic ? segment.slice(1) : segment;\n            if (dynamic && matchSegment(locSegment, matchFilter(key))) {\n                match.params[key] = locSegment;\n            }\n            else if (dynamic || !matchSegment(locSegment, segment)) {\n                return null;\n            }\n            match.path += `/${locSegment}`;\n        }\n        if (splat) {\n            const remainder = lenDiff ? locSegments.slice(-lenDiff).join(\"/\") : \"\";\n            if (matchSegment(remainder, matchFilter(splat))) {\n                match.params[splat] = remainder;\n            }\n            else {\n                return null;\n            }\n        }\n        return match;\n    };\n}\nfunction matchSegment(input, filter) {\n    const isEqual = (s) => s.localeCompare(input, undefined, { sensitivity: \"base\" }) === 0;\n    if (filter === undefined) {\n        return true;\n    }\n    else if (typeof filter === \"string\") {\n        return isEqual(filter);\n    }\n    else if (typeof filter === \"function\") {\n        return filter(input);\n    }\n    else if (Array.isArray(filter)) {\n        return filter.some(isEqual);\n    }\n    else if (filter instanceof RegExp) {\n        return filter.test(input);\n    }\n    return false;\n}\nexport function scoreRoute(route) {\n    const [pattern, splat] = route.pattern.split(\"/*\", 2);\n    const segments = pattern.split(\"/\").filter(Boolean);\n    return segments.reduce((score, segment) => score + (segment.startsWith(\":\") ? 2 : 3), segments.length - (splat === undefined ? 0 : 1));\n}\nexport function createMemoObject(fn) {\n    const map = new Map();\n    const owner = getOwner();\n    return new Proxy({}, {\n        get(_, property) {\n            if (!map.has(property)) {\n                runWithOwner(owner, () => map.set(property, createMemo(() => fn()[property])));\n            }\n            return map.get(property)();\n        },\n        getOwnPropertyDescriptor() {\n            return {\n                enumerable: true,\n                configurable: true\n            };\n        },\n        ownKeys() {\n            return Reflect.ownKeys(fn());\n        }\n    });\n}\nexport function mergeSearchString(search, params) {\n    const merged = new URLSearchParams(search);\n    Object.entries(params).forEach(([key, value]) => {\n        if (value == null || value === \"\") {\n            merged.delete(key);\n        }\n        else {\n            merged.set(key, String(value));\n        }\n    });\n    const s = merged.toString();\n    return s ? `?${s}` : \"\";\n}\nexport function expandOptionals(pattern) {\n    let match = /(\\/?\\:[^\\/]+)\\?/.exec(pattern);\n    if (!match)\n        return [pattern];\n    let prefix = pattern.slice(0, match.index);\n    let suffix = pattern.slice(match.index + match[0].length);\n    const prefixes = [prefix, (prefix += match[1])];\n    // This section handles adjacent optional params. We don't actually want all permuations since\n    // that will lead to equivalent routes which have the same number of params. For example\n    // `/:a?/:b?/:c`? only has the unique expansion: `/`, `/:a`, `/:a/:b`, `/:a/:b/:c` and we can\n    // discard `/:b`, `/:c`, `/:b/:c` by building them up in order and not recursing. This also helps\n    // ensure predictability where earlier params have precidence.\n    while ((match = /^(\\/\\:[^\\/]+)\\?/.exec(suffix))) {\n        prefixes.push((prefix += match[1]));\n        suffix = suffix.slice(match[0].length);\n    }\n    return expandOptionals(suffix).reduce((results, expansion) => [...results, ...prefixes.map(p => p + expansion)], []);\n}\n","import { createComponent, createContext, createMemo, createRenderEffect, createSignal, on, onCleanup, untrack, useContext, startTransition, resetErrorBoundaries } from \"solid-js\";\nimport { isServer, getRequestEvent } from \"solid-js/web\";\nimport { createBeforeLeave } from \"./lifecycle\";\nimport { createMemoObject, extractSearchParams, invariant, resolvePath, createMatcher, joinPaths, scoreRoute, mergeSearchString, expandOptionals } from \"./utils\";\nconst MAX_REDIRECTS = 100;\nexport const RouterContextObj = createContext();\nexport const RouteContextObj = createContext();\nexport const useRouter = () => invariant(useContext(RouterContextObj), \"Make sure your app is wrapped in a <Router />\");\nlet TempRoute;\nexport const useRoute = () => TempRoute || useContext(RouteContextObj) || useRouter().base;\nexport const useResolvedPath = (path) => {\n    const route = useRoute();\n    return createMemo(() => route.resolvePath(path()));\n};\nexport const useHref = (to) => {\n    const router = useRouter();\n    return createMemo(() => {\n        const to_ = to();\n        return to_ !== undefined ? router.renderPath(to_) : to_;\n    });\n};\nexport const useNavigate = () => useRouter().navigatorFactory();\nexport const useLocation = () => useRouter().location;\nexport const useIsRouting = () => useRouter().isRouting;\nexport const useMatch = (path, matchFilters) => {\n    const location = useLocation();\n    const matchers = createMemo(() => expandOptionals(path()).map(path => createMatcher(path, undefined, matchFilters)));\n    return createMemo(() => {\n        for (const matcher of matchers()) {\n            const match = matcher(location.pathname);\n            if (match)\n                return match;\n        }\n    });\n};\nexport const useParams = () => useRoute().params;\nexport const useSearchParams = () => {\n    const location = useLocation();\n    const navigate = useNavigate();\n    const setSearchParams = (params, options) => {\n        const searchString = untrack(() => location.pathname + mergeSearchString(location.search, params) + location.hash);\n        navigate(searchString, {\n            scroll: false,\n            resolve: false,\n            ...options\n        });\n    };\n    return [location.query, setSearchParams];\n};\nexport const useBeforeLeave = (listener) => {\n    const s = useRouter().beforeLeave.subscribe({\n        listener,\n        location: useLocation(),\n        navigate: useNavigate()\n    });\n    onCleanup(s);\n};\nexport function createRoutes(routeDef, base = \"\") {\n    const { component, load, children, metadata } = routeDef;\n    const isLeaf = !children || (Array.isArray(children) && !children.length);\n    const shared = {\n        key: routeDef,\n        component,\n        load,\n        metadata\n    };\n    return asArray(routeDef.path).reduce((acc, path) => {\n        for (const originalPath of expandOptionals(path)) {\n            const path = joinPaths(base, originalPath);\n            const pattern = isLeaf ? path : path.split(\"/*\", 1)[0];\n            acc.push({\n                ...shared,\n                originalPath,\n                pattern,\n                matcher: createMatcher(pattern, !isLeaf, routeDef.matchFilters)\n            });\n        }\n        return acc;\n    }, []);\n}\nexport function createBranch(routes, index = 0) {\n    return {\n        routes,\n        score: scoreRoute(routes[routes.length - 1]) * 10000 - index,\n        matcher(location) {\n            const matches = [];\n            for (let i = routes.length - 1; i >= 0; i--) {\n                const route = routes[i];\n                const match = route.matcher(location);\n                if (!match) {\n                    return null;\n                }\n                matches.unshift({\n                    ...match,\n                    route\n                });\n            }\n            return matches;\n        }\n    };\n}\nfunction asArray(value) {\n    return Array.isArray(value) ? value : [value];\n}\nexport function createBranches(routeDef, base = \"\", stack = [], branches = []) {\n    const routeDefs = asArray(routeDef);\n    for (let i = 0, len = routeDefs.length; i < len; i++) {\n        const def = routeDefs[i];\n        if (def && typeof def === \"object\") {\n            if (!def.hasOwnProperty(\"path\"))\n                def.path = \"\";\n            const routes = createRoutes(def, base);\n            for (const route of routes) {\n                stack.push(route);\n                const isEmptyArray = Array.isArray(def.children) && def.children.length === 0;\n                if (def.children && !isEmptyArray) {\n                    createBranches(def.children, route.pattern, stack, branches);\n                }\n                else {\n                    const branch = createBranch([...stack], branches.length);\n                    branches.push(branch);\n                }\n                stack.pop();\n            }\n        }\n    }\n    // Stack will be empty on final return\n    return stack.length ? branches : branches.sort((a, b) => b.score - a.score);\n}\nexport function getRouteMatches(branches, location) {\n    for (let i = 0, len = branches.length; i < len; i++) {\n        const match = branches[i].matcher(location);\n        if (match) {\n            return match;\n        }\n    }\n    return [];\n}\nexport function createLocation(path, state) {\n    const origin = new URL(\"http://sar\");\n    const url = createMemo(prev => {\n        const path_ = path();\n        try {\n            return new URL(path_, origin);\n        }\n        catch (err) {\n            console.error(`Invalid path ${path_}`);\n            return prev;\n        }\n    }, origin, {\n        equals: (a, b) => a.href === b.href\n    });\n    const pathname = createMemo(() => url().pathname);\n    const search = createMemo(() => url().search, true);\n    const hash = createMemo(() => url().hash);\n    const key = () => \"\";\n    return {\n        get pathname() {\n            return pathname();\n        },\n        get search() {\n            return search();\n        },\n        get hash() {\n            return hash();\n        },\n        get state() {\n            return state();\n        },\n        get key() {\n            return key();\n        },\n        query: createMemoObject(on(search, () => extractSearchParams(url())))\n    };\n}\nlet intent;\nexport function getIntent() {\n    return intent;\n}\nexport function createRouterContext(integration, getBranches, options = {}) {\n    const { signal: [source, setSource], utils = {} } = integration;\n    const parsePath = utils.parsePath || (p => p);\n    const renderPath = utils.renderPath || (p => p);\n    const beforeLeave = utils.beforeLeave || createBeforeLeave();\n    const basePath = resolvePath(\"\", options.base || \"\");\n    if (basePath === undefined) {\n        throw new Error(`${basePath} is not a valid base path`);\n    }\n    else if (basePath && !source().value) {\n        setSource({ value: basePath, replace: true, scroll: false });\n    }\n    const [isRouting, setIsRouting] = createSignal(false);\n    const start = async (callback) => {\n        setIsRouting(true);\n        try {\n            await startTransition(callback);\n        }\n        finally {\n            setIsRouting(false);\n        }\n    };\n    const [reference, setReference] = createSignal(source().value);\n    const [state, setState] = createSignal(source().state);\n    const location = createLocation(reference, state);\n    const referrers = [];\n    const submissions = createSignal(isServer ? initFromFlash() : []);\n    const baseRoute = {\n        pattern: basePath,\n        params: {},\n        path: () => basePath,\n        outlet: () => null,\n        resolvePath(to) {\n            return resolvePath(basePath, to);\n        }\n    };\n    createRenderEffect(() => {\n        const { value, state } = source();\n        // Untrack this whole block so `start` doesn't cause Solid's Listener to be preserved\n        untrack(() => {\n            if (value !== reference()) {\n                start(() => {\n                    intent = \"native\";\n                    setReference(value);\n                    setState(state);\n                    resetErrorBoundaries();\n                    submissions[1]([]);\n                }).then(() => {\n                    intent = undefined;\n                });\n            }\n        });\n    });\n    return {\n        base: baseRoute,\n        location,\n        isRouting,\n        renderPath,\n        parsePath,\n        navigatorFactory,\n        beforeLeave,\n        preloadRoute,\n        submissions\n    };\n    function navigateFromRoute(route, to, options) {\n        // Untrack in case someone navigates in an effect - don't want to track `reference` or route paths\n        untrack(() => {\n            if (typeof to === \"number\") {\n                if (!to) {\n                    // A delta of 0 means stay at the current location, so it is ignored\n                }\n                else if (utils.go) {\n                    beforeLeave.confirm(to, options) && utils.go(to);\n                }\n                else {\n                    console.warn(\"Router integration does not support relative routing\");\n                }\n                return;\n            }\n            const { replace, resolve, scroll, state: nextState } = {\n                replace: false,\n                resolve: true,\n                scroll: true,\n                ...options\n            };\n            const resolvedTo = resolve ? route.resolvePath(to) : resolvePath(\"\", to);\n            if (resolvedTo === undefined) {\n                throw new Error(`Path '${to}' is not a routable path`);\n            }\n            else if (referrers.length >= MAX_REDIRECTS) {\n                throw new Error(\"Too many redirects\");\n            }\n            const current = reference();\n            if (resolvedTo !== current || nextState !== state()) {\n                if (isServer) {\n                    const e = getRequestEvent();\n                    e &&\n                        (e.response = new Response(null, { status: 302, headers: { Location: resolvedTo } }));\n                    setSource({ value: resolvedTo, replace, scroll, state: nextState });\n                }\n                else if (beforeLeave.confirm(resolvedTo, options)) {\n                    const len = referrers.push({ value: current, replace, scroll, state: state() });\n                    start(() => {\n                        intent = \"navigate\";\n                        setReference(resolvedTo);\n                        setState(nextState);\n                        resetErrorBoundaries();\n                        submissions[1]([]);\n                    }).then(() => {\n                        if (referrers.length === len) {\n                            intent = undefined;\n                            navigateEnd({\n                                value: resolvedTo,\n                                state: nextState\n                            });\n                        }\n                    });\n                }\n            }\n        });\n    }\n    function navigatorFactory(route) {\n        // Workaround for vite issue (https://github.com/vitejs/vite/issues/3803)\n        route = route || useContext(RouteContextObj) || baseRoute;\n        return (to, options) => navigateFromRoute(route, to, options);\n    }\n    function navigateEnd(next) {\n        const first = referrers[0];\n        if (first) {\n            if (next.value !== first.value || next.state !== first.state) {\n                setSource({\n                    ...next,\n                    replace: first.replace,\n                    scroll: first.scroll\n                });\n            }\n            referrers.length = 0;\n        }\n    }\n    function preloadRoute(url, preloadData) {\n        const matches = getRouteMatches(getBranches(), url.pathname);\n        const prevIntent = intent;\n        intent = \"preload\";\n        for (let match in matches) {\n            const { route, params } = matches[match];\n            route.component &&\n                route.component.preload &&\n                route.component.preload();\n            preloadData &&\n                route.load &&\n                route.load({\n                    params,\n                    location: {\n                        pathname: url.pathname,\n                        search: url.search,\n                        hash: url.hash,\n                        query: extractSearchParams(url),\n                        state: null,\n                        key: \"\"\n                    },\n                    intent: \"preload\"\n                });\n        }\n        intent = prevIntent;\n    }\n    function initFromFlash() {\n        const e = getRequestEvent();\n        return e && e.initialSubmission ? [e.initialSubmission] : [];\n    }\n}\nexport function createRouteContext(router, parent, outlet, match, params) {\n    const { base, location } = router;\n    const { pattern, component, load } = match().route;\n    const path = createMemo(() => match().path);\n    component &&\n        component.preload &&\n        component.preload();\n    const data = load ? load({ params, location, intent: intent || \"initial\" }) : undefined;\n    const route = {\n        parent,\n        pattern,\n        path,\n        params,\n        outlet: () => component\n            ? createComponent(component, {\n                params,\n                location,\n                data,\n                get children() {\n                    return outlet();\n                }\n            })\n            : outlet(),\n        resolvePath(to) {\n            return resolvePath(base.path(), to, path());\n        }\n    };\n    return route;\n}\n","/*@refresh skip*/\nimport { getRequestEvent, isServer } from \"solid-js/web\";\nimport { children, createMemo, createRoot, mergeProps, on, Show } from \"solid-js\";\nimport { createBranches, createRouteContext, createRouterContext, getRouteMatches, RouteContextObj, RouterContextObj } from \"../routing\";\nimport { createMemoObject } from \"../utils\";\nexport const createRouterComponent = (router) => (props) => {\n    const { base } = props;\n    const routeDefs = children(() => props.children);\n    const branches = createMemo(() => createBranches(props.root ? { component: props.root, children: routeDefs() } : routeDefs(), props.base || \"\"));\n    const routerState = createRouterContext(router, branches, { base });\n    router.create && router.create(routerState);\n    return (<RouterContextObj.Provider value={routerState}>\n      <Routes routerState={routerState} branches={branches()}/>\n    </RouterContextObj.Provider>);\n};\nfunction Routes(props) {\n    const matches = createMemo(() => getRouteMatches(props.branches, props.routerState.location.pathname));\n    if (isServer) {\n        const e = getRequestEvent();\n        e &&\n            (e.routerMatches || (e.routerMatches = [])).push(matches().map(({ route, path, params }) => ({\n                path: route.originalPath,\n                pattern: route.pattern,\n                match: path,\n                params,\n                metadata: route.metadata\n            })));\n    }\n    const params = createMemoObject(() => {\n        const m = matches();\n        const params = {};\n        for (let i = 0; i < m.length; i++) {\n            Object.assign(params, m[i].params);\n        }\n        return params;\n    });\n    const disposers = [];\n    let root;\n    const routeStates = createMemo(on(matches, (nextMatches, prevMatches, prev) => {\n        let equal = prevMatches && nextMatches.length === prevMatches.length;\n        const next = [];\n        for (let i = 0, len = nextMatches.length; i < len; i++) {\n            const prevMatch = prevMatches && prevMatches[i];\n            const nextMatch = nextMatches[i];\n            if (prev && prevMatch && nextMatch.route.key === prevMatch.route.key) {\n                next[i] = prev[i];\n            }\n            else {\n                equal = false;\n                if (disposers[i]) {\n                    disposers[i]();\n                }\n                createRoot(dispose => {\n                    disposers[i] = dispose;\n                    next[i] = createRouteContext(props.routerState, next[i - 1] || props.routerState.base, createOutlet(() => routeStates()[i + 1]), () => matches()[i], params);\n                });\n            }\n        }\n        disposers.splice(nextMatches.length).forEach(dispose => dispose());\n        if (prev && equal) {\n            return prev;\n        }\n        root = next[0];\n        return next;\n    }));\n    return (<Show when={routeStates() && root} keyed>\n      {route => <RouteContextObj.Provider value={route}>{route.outlet()}</RouteContextObj.Provider>}\n    </Show>);\n}\nconst createOutlet = (child) => {\n    return () => (<Show when={child()} keyed>\n      {child => <RouteContextObj.Provider value={child}>{child.outlet()}</RouteContextObj.Provider>}\n    </Show>);\n};\nexport const Route = (props) => {\n    const childRoutes = children(() => props.children);\n    return mergeProps(props, {\n        get children() {\n            return childRoutes();\n        }\n    });\n};\n","import { createSignal, onCleanup } from \"solid-js\";\nimport { createRouterComponent } from \"./components\";\nfunction intercept([value, setValue], get, set) {\n    return [get ? () => get(value()) : value, set ? (v) => setValue(set(v)) : setValue];\n}\nfunction querySelector(selector) {\n    if (selector === \"#\") {\n        return null;\n    }\n    // Guard against selector being an invalid CSS selector\n    try {\n        return document.querySelector(selector);\n    }\n    catch (e) {\n        return null;\n    }\n}\nexport function createRouter(config) {\n    let ignore = false;\n    const wrap = (value) => (typeof value === \"string\" ? { value } : value);\n    const signal = intercept(createSignal(wrap(config.get()), { equals: (a, b) => a.value === b.value }), undefined, next => {\n        !ignore && config.set(next);\n        return next;\n    });\n    config.init &&\n        onCleanup(config.init((value = config.get()) => {\n            ignore = true;\n            signal[1](wrap(value));\n            ignore = false;\n        }));\n    return createRouterComponent({\n        signal,\n        create: config.create,\n        utils: config.utils\n    });\n}\nexport function bindEvent(target, type, handler) {\n    target.addEventListener(type, handler);\n    return () => target.removeEventListener(type, handler);\n}\nexport function scrollToHash(hash, fallbackTop) {\n    const el = querySelector(`#${hash}`);\n    if (el) {\n        el.scrollIntoView();\n    }\n    else if (fallbackTop) {\n        window.scrollTo(0, 0);\n    }\n}\n","import { $TRACK, createMemo, createSignal, onCleanup, getOwner } from \"solid-js\";\nimport { isServer } from \"solid-js/web\";\nimport { useRouter } from \"../routing\";\nimport { redirectStatusCodes } from \"../utils\";\nimport { cacheKeyOp, hashKey, revalidate } from \"./cache\";\nexport const actions = /* #__PURE__ */ new Map();\nexport function useSubmissions(fn, filter) {\n    const router = useRouter();\n    const subs = createMemo(() => router.submissions[0]().filter(s => s.url === fn.toString() && (!filter || filter(s.input))));\n    return new Proxy([], {\n        get(_, property) {\n            if (property === $TRACK)\n                return subs();\n            if (property === \"pending\")\n                return subs().some(sub => !sub.result);\n            return subs()[property];\n        }\n    });\n}\nexport function useSubmission(fn, filter) {\n    const submissions = useSubmissions(fn, filter);\n    return new Proxy({}, {\n        get(_, property) {\n            return submissions[submissions.length - 1]?.[property];\n        }\n    });\n}\nexport function useAction(action) {\n    const router = useRouter();\n    return (...args) => action.apply(router, args);\n}\nexport function action(fn, name) {\n    function mutate(...variables) {\n        const p = fn(...variables);\n        const [result, setResult] = createSignal();\n        let submission;\n        const router = this;\n        async function handler(res) {\n            const data = await handleResponse(res, router.navigatorFactory());\n            data ? setResult({ data }) : submission.clear();\n            return data;\n        }\n        router.submissions[1](s => [\n            ...s,\n            (submission = {\n                input: variables,\n                url,\n                get result() {\n                    return result()?.data;\n                },\n                get pending() {\n                    return !result();\n                },\n                clear() {\n                    router.submissions[1](v => v.filter(i => i.input !== variables));\n                },\n                retry() {\n                    setResult(undefined);\n                    const p = fn(...variables);\n                    p.then(handler, handler);\n                    return p;\n                }\n            })\n        ]);\n        p.then(handler, handler);\n        return p;\n    }\n    const url = fn.url ||\n        (name && `action:${name}`) ||\n        (!isServer ? `action:${hashString(fn.toString())}` : \"\");\n    return toAction(mutate, url);\n}\nfunction toAction(fn, url) {\n    fn.toString = () => {\n        if (!url)\n            throw new Error(\"Client Actions need explicit names if server rendered\");\n        return url;\n    };\n    fn.with = function (...args) {\n        const newFn = function (...passedArgs) {\n            return fn.call(this, ...args, ...passedArgs);\n        };\n        const uri = new URL(url, \"http://sar\");\n        uri.searchParams.set(\"args\", hashKey(args));\n        return toAction(newFn, (uri.protocol === \"action:\" ? uri.protocol : \"\") + uri.pathname + uri.search);\n    };\n    fn.url = url;\n    if (!isServer) {\n        actions.set(url, fn);\n        getOwner() && onCleanup(() => actions.delete(url));\n    }\n    return fn;\n}\nconst hashString = (s) => s.split(\"\").reduce((a, b) => ((a << 5) - a + b.charCodeAt(0)) | 0, 0);\nasync function handleResponse(response, navigate) {\n    let data;\n    let keys;\n    if (response instanceof Response) {\n        if (response.headers.has(\"X-Revalidate\"))\n            keys = response.headers.get(\"X-Revalidate\").split(\",\");\n        if (response.customBody)\n            data = await response.customBody();\n        if (redirectStatusCodes.has(response.status)) {\n            const locationUrl = response.headers.get(\"Location\") || \"/\";\n            if (locationUrl.startsWith(\"http\")) {\n                window.location.href = locationUrl;\n            }\n            else {\n                navigate(locationUrl);\n            }\n        }\n    }\n    else\n        data = response;\n    // invalidate\n    cacheKeyOp(keys, entry => (entry[0] = 0));\n    // trigger revalidation\n    await revalidate(keys, false);\n    return data;\n}\n","import { delegateEvents } from \"solid-js/web\";\nimport { onCleanup } from \"solid-js\";\nimport { actions } from \"./action\";\nexport function setupNativeEvents(preload = true, explicitLinks = false, actionBase = \"/_server\") {\n    return (router) => {\n        const basePath = router.base.path();\n        const navigateFromRoute = router.navigatorFactory(router.base);\n        let preloadTimeout = {};\n        function isSvg(el) {\n            return el.namespaceURI === \"http://www.w3.org/2000/svg\";\n        }\n        function handleAnchor(evt) {\n            if (evt.defaultPrevented ||\n                evt.button !== 0 ||\n                evt.metaKey ||\n                evt.altKey ||\n                evt.ctrlKey ||\n                evt.shiftKey)\n                return;\n            const a = evt\n                .composedPath()\n                .find(el => el instanceof Node && el.nodeName.toUpperCase() === \"A\");\n            if (!a || (explicitLinks && !a.getAttribute(\"link\")))\n                return;\n            const svg = isSvg(a);\n            const href = svg ? a.href.baseVal : a.href;\n            const target = svg ? a.target.baseVal : a.target;\n            if (target || (!href && !a.hasAttribute(\"state\")))\n                return;\n            const rel = (a.getAttribute(\"rel\") || \"\").split(/\\s+/);\n            if (a.hasAttribute(\"download\") || (rel && rel.includes(\"external\")))\n                return;\n            const url = svg ? new URL(href, document.baseURI) : new URL(href);\n            if (url.origin !== window.location.origin ||\n                (basePath && url.pathname && !url.pathname.toLowerCase().startsWith(basePath.toLowerCase())))\n                return;\n            return [a, url];\n        }\n        function handleAnchorClick(evt) {\n            const res = handleAnchor(evt);\n            if (!res)\n                return;\n            const [a, url] = res;\n            const to = router.parsePath(url.pathname + url.search + url.hash);\n            const state = a.getAttribute(\"state\");\n            evt.preventDefault();\n            navigateFromRoute(to, {\n                resolve: false,\n                replace: a.hasAttribute(\"replace\"),\n                scroll: !a.hasAttribute(\"noscroll\"),\n                state: state && JSON.parse(state)\n            });\n        }\n        function handleAnchorPreload(evt) {\n            const res = handleAnchor(evt);\n            if (!res)\n                return;\n            const [a, url] = res;\n            if (!preloadTimeout[url.pathname])\n                router.preloadRoute(url, a.getAttribute(\"preload\") !== \"false\");\n        }\n        function handleAnchorIn(evt) {\n            const res = handleAnchor(evt);\n            if (!res)\n                return;\n            const [a, url] = res;\n            if (preloadTimeout[url.pathname])\n                return;\n            preloadTimeout[url.pathname] = setTimeout(() => {\n                router.preloadRoute(url, a.getAttribute(\"preload\") !== \"false\");\n                delete preloadTimeout[url.pathname];\n            }, 200);\n        }\n        function handleAnchorOut(evt) {\n            const res = handleAnchor(evt);\n            if (!res)\n                return;\n            const [, url] = res;\n            if (preloadTimeout[url.pathname]) {\n                clearTimeout(preloadTimeout[url.pathname]);\n                delete preloadTimeout[url.pathname];\n            }\n        }\n        function handleFormSubmit(evt) {\n            let actionRef = evt.submitter && evt.submitter.hasAttribute(\"formaction\")\n                ? evt.submitter.formAction\n                : evt.target.action;\n            if (!actionRef)\n                return;\n            if (!actionRef.startsWith(\"action:\")) {\n                const url = new URL(actionRef);\n                actionRef = router.parsePath(url.pathname + url.search);\n                if (!actionRef.startsWith(actionBase))\n                    return;\n            }\n            if (evt.target.method.toUpperCase() !== \"POST\")\n                throw new Error(\"Only POST forms are supported for Actions\");\n            const handler = actions.get(actionRef);\n            if (handler) {\n                evt.preventDefault();\n                const data = new FormData(evt.target);\n                handler.call(router, data);\n            }\n        }\n        // ensure delegated event run first\n        delegateEvents([\"click\", \"submit\"]);\n        document.addEventListener(\"click\", handleAnchorClick);\n        if (preload) {\n            document.addEventListener(\"mouseover\", handleAnchorIn);\n            document.addEventListener(\"mouseout\", handleAnchorOut);\n            document.addEventListener(\"focusin\", handleAnchorPreload);\n            document.addEventListener(\"touchstart\", handleAnchorPreload);\n        }\n        document.addEventListener(\"submit\", handleFormSubmit);\n        onCleanup(() => {\n            document.removeEventListener(\"click\", handleAnchorClick);\n            if (preload) {\n                document.removeEventListener(\"mouseover\", handleAnchorIn);\n                document.removeEventListener(\"mouseout\", handleAnchorOut);\n                document.removeEventListener(\"focusin\", handleAnchorPreload);\n                document.removeEventListener(\"touchstart\", handleAnchorPreload);\n            }\n            document.removeEventListener(\"submit\", handleFormSubmit);\n        });\n    };\n}\n","import { setupNativeEvents } from \"../data/events\";\nimport { createRouter, scrollToHash, bindEvent } from \"./createRouter\";\nexport function hashParser(str) {\n    const to = str.replace(/^.*?#/, \"\");\n    // Hash-only hrefs like `#foo` from plain anchors will come in as `/#foo` whereas a link to\n    // `/foo` will be `/#/foo`. Check if the to starts with a `/` and if not append it as a hash\n    // to the current path so we can handle these in-page anchors correctly.\n    if (!to.startsWith(\"/\")) {\n        const [, path = \"/\"] = window.location.hash.split(\"#\", 2);\n        return `${path}#${to}`;\n    }\n    return to;\n}\nexport function HashRouter(props) {\n    return createRouter({\n        get: () => window.location.hash.slice(1),\n        set({ value, replace, scroll, state }) {\n            if (replace) {\n                window.history.replaceState(state, \"\", \"#\" + value);\n            }\n            else {\n                window.location.hash = value;\n            }\n            const hashIndex = value.indexOf(\"#\");\n            const hash = hashIndex >= 0 ? value.slice(hashIndex + 1) : \"\";\n            scrollToHash(hash, scroll);\n        },\n        init: notify => bindEvent(window, \"hashchange\", () => notify()),\n        create: setupNativeEvents(props.preload, props.explicitLinks, props.actionBase),\n        utils: {\n            go: delta => window.history.go(delta),\n            renderPath: path => `#${path}`,\n            parsePath: hashParser\n        }\n    })(props);\n}\n","import { DEV, equalFn, untrack, getOwner, onCleanup, createSignal, sharedConfig, onMount } from 'solid-js';\nimport { isServer } from 'solid-js/web';\nexport { isServer } from 'solid-js/web';\n\n// src/index.ts\nvar isClient = !isServer;\nvar isDev = isClient && !!DEV;\nvar isProd = !isDev;\nvar noop = () => void 0;\nvar trueFn = () => true;\nvar falseFn = () => false;\nvar defaultEquals = equalFn;\nvar EQUALS_FALSE_OPTIONS = { equals: false };\nvar INTERNAL_OPTIONS = { internal: true };\nvar ofClass = (v, c) => v instanceof c || v && v.constructor === c;\nfunction isObject(value) {\n  return value !== null && (typeof value === \"object\" || typeof value === \"function\");\n}\nvar isNonNullable = (i) => i != null;\nvar filterNonNullable = (arr) => arr.filter(isNonNullable);\nvar compare = (a, b) => a < b ? -1 : a > b ? 1 : 0;\nvar arrayEquals = (a, b) => a === b || a.length === b.length && a.every((e, i) => e === b[i]);\nfunction chain(callbacks) {\n  return (...args) => {\n    for (const callback of callbacks)\n      callback && callback(...args);\n  };\n}\nfunction reverseChain(callbacks) {\n  return (...args) => {\n    for (let i = callbacks.length - 1; i >= 0; i--) {\n      const callback = callbacks[i];\n      callback && callback(...args);\n    }\n  };\n}\nvar clamp = (n, min, max) => Math.min(Math.max(n, min), max);\nvar access = (v) => typeof v === \"function\" && !v.length ? v() : v;\nvar asArray = (value) => Array.isArray(value) ? value : value ? [value] : [];\nvar accessArray = (list) => list.map((v) => access(v));\nvar withAccess = (value, fn) => {\n  const _value = access(value);\n  typeof _value != null && fn(_value);\n};\nvar asAccessor = (v) => typeof v === \"function\" ? v : () => v;\nfunction accessWith(valueOrFn, ...args) {\n  return typeof valueOrFn === \"function\" ? valueOrFn(...args) : valueOrFn;\n}\nfunction defer(deps, fn, initialValue) {\n  const isArray = Array.isArray(deps);\n  let prevInput;\n  let shouldDefer = true;\n  return (prevValue) => {\n    let input;\n    if (isArray) {\n      input = Array(deps.length);\n      for (let i = 0; i < deps.length; i++)\n        input[i] = deps[i]();\n    } else\n      input = deps();\n    if (shouldDefer) {\n      shouldDefer = false;\n      prevInput = input;\n      return initialValue;\n    }\n    const result = untrack(() => fn(input, prevInput, prevValue));\n    prevInput = input;\n    return result;\n  };\n}\nvar entries = Object.entries;\nvar keys = Object.keys;\nvar tryOnCleanup = isDev ? (fn) => getOwner() ? onCleanup(fn) : fn : onCleanup;\nvar createCallbackStack = () => {\n  let stack = [];\n  const clear = () => stack = [];\n  return {\n    push: (...callbacks) => stack.push(...callbacks),\n    execute(arg0, arg1, arg2, arg3) {\n      stack.forEach((cb) => cb(arg0, arg1, arg2, arg3));\n      clear();\n    },\n    clear\n  };\n};\nfunction createMicrotask(fn) {\n  let calls = 0;\n  let args;\n  onCleanup(() => calls = 0);\n  return (...a) => {\n    args = a, calls++;\n    queueMicrotask(() => --calls === 0 && fn(...args));\n  };\n}\nfunction createHydratableSignal(serverValue, update, options) {\n  if (isServer) {\n    return createSignal(serverValue, options);\n  }\n  if (sharedConfig.context) {\n    const [state, setState] = createSignal(serverValue, options);\n    onMount(() => setState(() => update()));\n    return [state, setState];\n  }\n  return createSignal(update(), options);\n}\nvar createHydrateSignal = createHydratableSignal;\nfunction handleDiffArray(current, prev, handleAdded, handleRemoved) {\n  const currLength = current.length;\n  const prevLength = prev.length;\n  let i = 0;\n  if (!prevLength) {\n    for (; i < currLength; i++)\n      handleAdded(current[i]);\n    return;\n  }\n  if (!currLength) {\n    for (; i < prevLength; i++)\n      handleRemoved(prev[i]);\n    return;\n  }\n  for (; i < prevLength; i++) {\n    if (prev[i] !== current[i])\n      break;\n  }\n  let prevEl;\n  let currEl;\n  prev = prev.slice(i);\n  current = current.slice(i);\n  for (prevEl of prev) {\n    if (!current.includes(prevEl))\n      handleRemoved(prevEl);\n  }\n  for (currEl of current) {\n    if (!prev.includes(currEl))\n      handleAdded(currEl);\n  }\n}\n\nexport { EQUALS_FALSE_OPTIONS, INTERNAL_OPTIONS, access, accessArray, accessWith, arrayEquals, asAccessor, asArray, chain, clamp, compare, createCallbackStack, createHydratableSignal, createHydrateSignal, createMicrotask, defaultEquals, defer, entries, falseFn, filterNonNullable, handleDiffArray, isClient, isDev, isNonNullable, isObject, isProd, keys, noop, ofClass, reverseChain, trueFn, tryOnCleanup, withAccess };\n","import { tryOnCleanup, entries, createCallbackStack, asArray, access, keys } from '@solid-primitives/utils';\nimport { createEffect, createRenderEffect, createSignal, onCleanup } from 'solid-js';\nimport { isServer } from 'solid-js/web';\n\n// src/eventListener.ts\nfunction makeEventListener(target, type, handler, options) {\n  target.addEventListener(type, handler, options);\n  return tryOnCleanup(target.removeEventListener.bind(target, type, handler, options));\n}\nfunction createEventListener(targets, type, handler, options) {\n  if (isServer)\n    return;\n  const attachListeners = () => {\n    asArray(access(targets)).forEach((el) => {\n      if (el)\n        asArray(access(type)).forEach((type2) => makeEventListener(el, type2, handler, options));\n    });\n  };\n  if (typeof targets === \"function\")\n    createEffect(attachListeners);\n  else\n    createRenderEffect(attachListeners);\n}\nfunction createEventSignal(target, type, options) {\n  if (isServer) {\n    return () => void 0;\n  }\n  const [lastEvent, setLastEvent] = createSignal();\n  createEventListener(target, type, setLastEvent, options);\n  return lastEvent;\n}\nvar eventListener = (target, props) => {\n  createEffect(() => {\n    const [type, handler, options] = props();\n    makeEventListener(target, type, handler, options);\n  });\n};\nfunction createEventListenerMap(targets, handlersMap, options) {\n  if (isServer) {\n    return;\n  }\n  for (const [eventName, handler] of entries(handlersMap)) {\n    if (handler)\n      createEventListener(targets, eventName, handler, options);\n  }\n}\nvar attachPropListeners = (target, props) => {\n  keys(props).forEach((attr) => {\n    if (attr.startsWith(\"on\") && typeof props[attr] === \"function\")\n      makeEventListener(target, attr.substring(2).toLowerCase(), props[attr]);\n  });\n};\nvar WindowEventListener = (props) => {\n  if (isServer)\n    return null;\n  attachPropListeners(window, props);\n};\nvar DocumentEventListener = (props) => {\n  if (isServer)\n    return null;\n  attachPropListeners(document, props);\n};\nfunction makeEventListenerStack(target, options) {\n  if (isServer) {\n    return [() => () => void 0, () => void 0];\n  }\n  const { push, execute } = createCallbackStack();\n  return [\n    (type, handler, overwriteOptions) => {\n      const clear = makeEventListener(target, type, handler, overwriteOptions ?? options);\n      push(clear);\n      return clear;\n    },\n    onCleanup(execute)\n  ];\n}\n\n// src/callbackWrappers.ts\nvar preventDefault = (callback) => (e) => {\n  e.preventDefault();\n  callback(e);\n};\nvar stopPropagation = (callback) => (e) => {\n  e.stopPropagation();\n  callback(e);\n};\nvar stopImmediatePropagation = (callback) => (e) => {\n  e.stopImmediatePropagation();\n  callback(e);\n};\n\nexport { DocumentEventListener, WindowEventListener, createEventListener, createEventListenerMap, createEventSignal, eventListener, makeEventListener, makeEventListenerStack, preventDefault, stopImmediatePropagation, stopPropagation };\n","import { getOwner, createRoot, runWithOwner, onCleanup, sharedConfig, createSignal, batch } from 'solid-js';\nimport { isServer } from 'solid-js/web';\nimport { asArray, access, trueFn, noop, createMicrotask } from '@solid-primitives/utils';\n\n// src/index.ts\nfunction createSubRoot(fn, ...owners) {\n  if (owners.length === 0)\n    owners = [getOwner()];\n  return createRoot((dispose) => {\n    asArray(access(owners)).forEach(\n      (owner) => owner && runWithOwner(owner, onCleanup.bind(void 0, dispose))\n    );\n    return fn(dispose);\n  }, owners[0]);\n}\nvar createBranch = createSubRoot;\nvar createCallback = (callback, owner = getOwner()) => owner ? (...args) => runWithOwner(owner, () => callback(...args)) : callback;\nfunction createDisposable(fn, ...owners) {\n  return createSubRoot((dispose) => {\n    fn(dispose);\n    return dispose;\n  }, ...owners);\n}\nfunction createSingletonRoot(factory, detachedOwner = getOwner()) {\n  let listeners = 0, value, disposeRoot;\n  return () => {\n    listeners++;\n    onCleanup(() => {\n      listeners--;\n      queueMicrotask(() => {\n        if (!listeners && disposeRoot) {\n          disposeRoot();\n          disposeRoot = value = void 0;\n        }\n      });\n    });\n    if (!disposeRoot) {\n      createRoot((dispose) => value = factory(disposeRoot = dispose), detachedOwner);\n    }\n    return value;\n  };\n}\nvar createSharedRoot = createSingletonRoot;\nfunction createHydratableSingletonRoot(factory) {\n  const owner = getOwner();\n  const singleton = createSingletonRoot(factory, owner);\n  return () => isServer || sharedConfig.context ? createRoot(factory, owner) : singleton();\n}\nfunction createRootPool(factory, options = {}) {\n  if (isServer) {\n    const owner2 = getOwner();\n    return (args) => createRoot((dispose) => factory(() => args, trueFn, dispose), owner2);\n  }\n  let length = 0;\n  const { limit = 100 } = options, pool = new Array(limit), owner = getOwner(), mapRoot = factory.length > 1 ? (dispose, [args, set]) => {\n    const [active, setA] = createSignal(true);\n    const root = {\n      dispose,\n      set,\n      setA,\n      active,\n      v: factory(args, active, () => disposeRoot(root))\n    };\n    return root;\n  } : (dispose, [args, set]) => ({\n    dispose,\n    set,\n    setA: trueFn,\n    active: trueFn,\n    v: factory(args, trueFn, noop)\n  }), limitPool = createMicrotask(() => {\n    if (length > limit) {\n      for (let i = limit; i < length; i++) {\n        pool[i].dispose();\n        pool[i] = void 0;\n      }\n      length = limit;\n    }\n  }), cleanupRoot = (root) => {\n    if (root.dispose !== noop) {\n      pool[length++] = root;\n      root.setA(false);\n      limitPool();\n    }\n  }, disposeRoot = (root) => {\n    root.dispose();\n    root.dispose = noop;\n    if (root.active())\n      root.setA(false);\n    else {\n      pool[pool.indexOf(root)] = pool[--length];\n      pool[length] = void 0;\n    }\n  };\n  onCleanup(() => {\n    for (let i = 0; i < length; i++)\n      pool[i].dispose();\n    length = 0;\n  });\n  return (arg) => {\n    let root;\n    if (length) {\n      root = pool[--length];\n      pool[length] = void 0;\n      batch(() => {\n        root.set(() => arg);\n        root.setA(true);\n      });\n    } else\n      root = createRoot((dispose) => mapRoot(dispose, createSignal(arg)), owner);\n    onCleanup(() => cleanupRoot(root));\n    return root.v;\n  };\n}\n\nexport { createBranch, createCallback, createDisposable, createHydratableSingletonRoot, createRootPool, createSharedRoot, createSingletonRoot, createSubRoot };\n","import { makeEventListener } from '@solid-primitives/event-listener';\nimport { createSingletonRoot } from '@solid-primitives/rootless';\nimport { arrayEquals } from '@solid-primitives/utils';\nimport { createSignal, untrack, createMemo, createEffect, on } from 'solid-js';\nimport { isServer } from 'solid-js/web';\n\n// src/index.ts\nfunction equalsKeyHoldSequence(sequence, model) {\n  for (let i = sequence.length - 1; i >= 0; i--) {\n    const _model = model.slice(0, i + 1);\n    if (!arrayEquals(sequence[i], _model))\n      return false;\n  }\n  return true;\n}\nvar useKeyDownEvent = /* @__PURE__ */ createSingletonRoot(\n  () => {\n    if (isServer) {\n      return () => null;\n    }\n    const [event, setEvent] = createSignal(null);\n    makeEventListener(window, \"keydown\", (e) => {\n      setEvent(e);\n      setTimeout(() => setEvent(null));\n    });\n    return event;\n  }\n);\nvar useKeyDownList = /* @__PURE__ */ createSingletonRoot(() => {\n  if (isServer) {\n    const keys = () => [];\n    keys[0] = keys;\n    keys[1] = { event: () => null };\n    keys[Symbol.iterator] = function* () {\n      yield keys[0];\n      yield keys[1];\n    };\n    return keys;\n  }\n  const [pressedKeys, setPressedKeys] = createSignal([]), reset = () => setPressedKeys([]), event = useKeyDownEvent();\n  makeEventListener(window, \"keydown\", (e) => {\n    if (e.repeat || typeof e.key !== \"string\")\n      return;\n    const key = e.key.toUpperCase(), currentKeys = pressedKeys();\n    if (currentKeys.includes(key))\n      return;\n    const keys = [...currentKeys, key];\n    if (currentKeys.length === 0 && key !== \"ALT\" && key !== \"CONTROL\" && key !== \"META\" && key !== \"SHIFT\") {\n      if (e.shiftKey)\n        keys.unshift(\"SHIFT\");\n      if (e.altKey)\n        keys.unshift(\"ALT\");\n      if (e.ctrlKey)\n        keys.unshift(\"CONTROL\");\n      if (e.metaKey)\n        keys.unshift(\"META\");\n    }\n    setPressedKeys(keys);\n  });\n  makeEventListener(window, \"keyup\", (e) => {\n    if (typeof e.key !== \"string\")\n      return;\n    const key = e.key.toUpperCase();\n    setPressedKeys((prev) => prev.filter((_key) => _key !== key));\n  });\n  makeEventListener(window, \"blur\", reset);\n  makeEventListener(window, \"contextmenu\", (e) => {\n    e.defaultPrevented || reset();\n  });\n  pressedKeys[0] = pressedKeys;\n  pressedKeys[1] = { event };\n  pressedKeys[Symbol.iterator] = function* () {\n    yield pressedKeys[0];\n    yield pressedKeys[1];\n  };\n  return pressedKeys;\n});\nvar useCurrentlyHeldKey = /* @__PURE__ */ createSingletonRoot(\n  () => {\n    if (isServer) {\n      return () => null;\n    }\n    const keys = useKeyDownList();\n    let prevKeys = untrack(keys);\n    return createMemo(() => {\n      const _keys = keys();\n      const prev = prevKeys;\n      prevKeys = _keys;\n      if (prev.length === 0 && _keys.length === 1)\n        return _keys[0];\n      return null;\n    });\n  }\n);\nvar useKeyDownSequence = /* @__PURE__ */ createSingletonRoot(() => {\n  if (isServer) {\n    return () => [];\n  }\n  const keys = useKeyDownList();\n  return createMemo((prev) => {\n    if (keys().length === 0)\n      return [];\n    return [...prev, keys()];\n  }, []);\n});\nfunction createKeyHold(key, options = {}) {\n  if (isServer) {\n    return () => false;\n  }\n  key = key.toUpperCase();\n  const { preventDefault = true } = options, event = useKeyDownEvent(), heldKey = useCurrentlyHeldKey();\n  return createMemo(() => heldKey() === key && (preventDefault && event()?.preventDefault(), true));\n}\nfunction createShortcut(keys, callback, options = {}) {\n  if (isServer || !keys.length) {\n    return;\n  }\n  keys = keys.map((key) => key.toUpperCase());\n  const { preventDefault = true } = options, event = useKeyDownEvent(), sequence = useKeyDownSequence();\n  let reset = false;\n  const handleSequenceWithReset = (sequence2) => {\n    if (!sequence2.length)\n      return reset = false;\n    if (reset)\n      return;\n    const e = event();\n    if (sequence2.length < keys.length) {\n      if (equalsKeyHoldSequence(sequence2, keys.slice(0, sequence2.length))) {\n        preventDefault && e && e.preventDefault();\n      } else {\n        reset = true;\n      }\n    } else {\n      reset = true;\n      if (equalsKeyHoldSequence(sequence2, keys)) {\n        preventDefault && e && e.preventDefault();\n        callback(e);\n      }\n    }\n  };\n  const handleSequenceWithoutReset = (sequence2) => {\n    const last = sequence2.at(-1);\n    if (!last)\n      return;\n    const e = event();\n    if (preventDefault && last.length < keys.length) {\n      if (arrayEquals(last, keys.slice(0, keys.length - 1))) {\n        e && e.preventDefault();\n      }\n      return;\n    }\n    if (arrayEquals(last, keys)) {\n      const prev = sequence2.at(-2);\n      if (!prev || arrayEquals(prev, keys.slice(0, keys.length - 1))) {\n        preventDefault && e && e.preventDefault();\n        callback(e);\n      }\n    }\n  };\n  createEffect(\n    on(sequence, options.requireReset ? handleSequenceWithReset : handleSequenceWithoutReset)\n  );\n}\n\nexport { createKeyHold, createShortcut, useCurrentlyHeldKey, useKeyDownEvent, useKeyDownList, useKeyDownSequence };\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nexport function isFunc(item) {\n    return typeof item === 'function';\n}\nexport function isObject(item) {\n    return typeof item === 'object';\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isArray(item) {\n    return Array.isArray(item);\n}\nexport function isString(item) {\n    return typeof item === 'string';\n}\nexport function isNumber(item) {\n    return typeof item === 'number';\n}\nexport function isInteger(item) {\n    return Number.isInteger(item);\n}\nexport function keyExists(obj, keys) {\n    for (const key of keys) {\n        if (key in obj) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Asserts a condition is truthy, otherwise throws an error\n *\n * @remarks\n * Useful at the top of functions to ensure certain conditions, arguments and\n * properties are set/met before continuing. When using this function,\n * TypeScript will narrow away falsy types from the condition.\n *\n * @param condition\n * @param message\n * @returns\n */\nexport function assertTruthy(condition, message) {\n    if (!condition) {\n        throw new Error(message || 'Assertion failed');\n    }\n}\n//# sourceMappingURL=utils.js.map","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { createEffect, on, createSignal, untrack } from 'solid-js';\nimport { useKeyDownEvent } from '@solid-primitives/keyboard';\nimport { activeElement, ElementNode } from '@lightningjs/solid';\nimport { isFunc } from './utils.js';\nlet keyMap = {\n    Left: 'ArrowLeft',\n    Right: 'ArrowRight',\n    Up: 'ArrowUp',\n    Down: 'ArrowDown',\n    Enter: 'Enter',\n    Last: 'l',\n};\nconst [focusPath, setFocusPath] = createSignal([]);\nexport { focusPath };\nexport const useFocusManager = (userKeyMap = {}) => {\n    const keypressEvent = useKeyDownEvent();\n    keyMap = {\n        ...keyMap,\n        ...userKeyMap,\n    };\n    const keyMapEntries = Object.entries(keyMap);\n    createEffect(on(activeElement, (currentFocusedElm, prevFocusedElm, prevFocusPath = []) => {\n        const newFocusedElms = [];\n        let current = currentFocusedElm;\n        const fp = [];\n        while (current) {\n            if (!current.states.has('focus')) {\n                current.states.add('focus');\n                isFunc(current.onFocus) &&\n                    current.onFocus.call(current, currentFocusedElm, prevFocusedElm ?? null);\n                newFocusedElms.push(current);\n            }\n            fp.push(current);\n            current = current.parent ?? null;\n        }\n        prevFocusPath.forEach((elm) => {\n            if (!fp.includes(elm)) {\n                elm.states.remove('focus');\n                isFunc(elm.onBlur) &&\n                    elm.onBlur.call(elm, currentFocusedElm, prevFocusedElm ?? null);\n            }\n        });\n        setFocusPath(fp);\n        return fp;\n    }, { defer: true }));\n    createEffect(() => {\n        const e = keypressEvent();\n        if (e) {\n            // Search keyMap for the value of the pressed key\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            const foundKeyEntry = keyMapEntries.find(([key, value]) => {\n                return value === e.key;\n            });\n            untrack(() => {\n                const fp = focusPath();\n                for (const elm of fp) {\n                    const mappedKeyEvent = foundKeyEntry ? foundKeyEntry[0] : undefined;\n                    if (mappedKeyEvent) {\n                        const onKeyHandler = elm[`on${mappedKeyEvent}`];\n                        if (isFunc(onKeyHandler)) {\n                            if (onKeyHandler.call(elm, e, elm) === true) {\n                                break;\n                            }\n                        }\n                    }\n                    else {\n                        console.log(`Unhandled key event: ${e.key}`);\n                    }\n                    if (isFunc(elm.onKeyPress)) {\n                        if (elm.onKeyPress.call(elm, e, mappedKeyEvent, elm) === true) {\n                            break;\n                        }\n                    }\n                }\n                return false;\n            });\n        }\n    });\n    return focusPath;\n};\n//# sourceMappingURL=useFocusManager.js.map","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { ElementNode } from '@lightningjs/solid';\n// To use with TS import withPadding and then put withPadding; on the next line to prevent tree shaking\nexport function withPadding(el, padding) {\n    const pad = padding();\n    let top, left, right, bottom;\n    if (Array.isArray(pad)) {\n        // top right bottom left\n        if (pad.length === 2) {\n            top = bottom = pad[0];\n            left = right = pad[1];\n        }\n        else if (pad.length === 3) {\n            top = pad[0];\n            left = right = pad[1];\n            bottom = pad[2];\n        }\n        else {\n            [top, right, bottom, left] = pad;\n        }\n    }\n    else {\n        top = right = bottom = left = pad;\n    }\n    el.onBeforeLayout = (node, size) => {\n        if (size) {\n            el.width =\n                el.children.reduce((acc, c) => {\n                    return acc + (c.width || 0);\n                }, 0) +\n                    left +\n                    right;\n            const firstChild = el.children[0];\n            if (firstChild) {\n                // set padding or marginLeft for flex\n                firstChild.x = left;\n                firstChild.marginLeft = left;\n            }\n            let maxHeight = 0;\n            el.children.forEach((c) => {\n                c.y = (c.y || 0) + top;\n                c.marginTop = top;\n                maxHeight = Math.max(maxHeight, c.height || 0);\n            });\n            el.height = maxHeight + top + bottom;\n        }\n    };\n}\n//# sourceMappingURL=withPadding.js.map","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n/* global SpeechSynthesisErrorEvent */\nfunction flattenStrings(series = []) {\n    const flattenedSeries = [];\n    let i;\n    for (i = 0; i < series.length; i++) {\n        const s = series[i];\n        if (typeof s === 'string' && !s.includes('PAUSE-')) {\n            flattenedSeries.push(series[i]);\n        }\n        else {\n            break;\n        }\n    }\n    // add a \"word boundary\" to ensure the Announcer doesn't automatically try to\n    // interpret strings that look like dates but are not actually dates\n    // for example, if \"Rising Sun\" and \"1993\" are meant to be two separate lines,\n    // when read together, \"Sun 1993\" is interpretted as \"Sunday 1993\"\n    return [flattenedSeries.join(',\\b ')].concat(series.slice(i));\n}\nfunction delay(pause) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, pause);\n    });\n}\n/**\n * Speak a string\n *\n * @param phrase Phrase to speak\n * @param utterances An array which the new SpeechSynthesisUtterance instance representing this utterance will be appended\n * @param lang Language to speak in\n * @return {Promise<void>} Promise resolved when the utterance has finished speaking, and rejected if there's an error\n */\nfunction speak(phrase, utterances, lang = 'en-US') {\n    const synth = window.speechSynthesis;\n    return new Promise((resolve, reject) => {\n        const utterance = new SpeechSynthesisUtterance(phrase);\n        utterance.lang = lang;\n        utterance.onend = () => {\n            resolve();\n        };\n        utterance.onerror = (e) => {\n            reject(e);\n        };\n        utterances.push(utterance);\n        synth.speak(utterance);\n    });\n}\nfunction speakSeries(series, lang, root = true) {\n    const synth = window.speechSynthesis;\n    const remainingPhrases = flattenStrings(Array.isArray(series) ? series : [series]);\n    const nestedSeriesResults = [];\n    /*\n      We hold this array of SpeechSynthesisUtterances in order to prevent them from being\n      garbage collected prematurely on STB hardware which can cause the 'onend' events of\n      utterances to not fire consistently.\n    */\n    const utterances = [];\n    let active = true;\n    const seriesChain = (async () => {\n        try {\n            while (active && remainingPhrases.length) {\n                const phrase = await Promise.resolve(remainingPhrases.shift());\n                if (!active) {\n                    // Exit\n                    // Need to check this after the await in case it was cancelled in between\n                    break;\n                }\n                else if (typeof phrase === 'string' && phrase.includes('PAUSE-')) {\n                    // Pause it\n                    let pause = Number(phrase.split('PAUSE-')[1]) * 1000;\n                    if (isNaN(pause)) {\n                        pause = 0;\n                    }\n                    await delay(pause);\n                }\n                else if (typeof phrase === 'string' && phrase.length) {\n                    // Speak it\n                    const totalRetries = 3;\n                    let retriesLeft = totalRetries;\n                    while (active && retriesLeft > 0) {\n                        try {\n                            await speak(phrase, utterances, lang);\n                            retriesLeft = 0;\n                        }\n                        catch (e) {\n                            // eslint-disable-next-line no-undef\n                            if (e instanceof SpeechSynthesisErrorEvent) {\n                                if (e.error === 'network') {\n                                    retriesLeft--;\n                                    console.warn(`Speech synthesis network error. Retries left: ${retriesLeft}`);\n                                    await delay(500 * (totalRetries - retriesLeft));\n                                }\n                                else if (e.error === 'canceled' ||\n                                    e.error === 'interrupted') {\n                                    // Cancel or interrupt error (ignore)\n                                    retriesLeft = 0;\n                                }\n                                else {\n                                    throw new Error(`SpeechSynthesisErrorEvent: ${e.error}`);\n                                }\n                            }\n                            else {\n                                throw e;\n                            }\n                        }\n                    }\n                }\n                else if (typeof phrase === 'function') {\n                    const seriesResult = speakSeries(phrase(), lang, false);\n                    nestedSeriesResults.push(seriesResult);\n                    await seriesResult.series;\n                }\n                else if (Array.isArray(phrase)) {\n                    // Speak it (recursively)\n                    const seriesResult = speakSeries(phrase, lang, false);\n                    nestedSeriesResults.push(seriesResult);\n                    await seriesResult.series;\n                }\n            }\n        }\n        finally {\n            active = false;\n        }\n    })();\n    return {\n        series: seriesChain,\n        get active() {\n            return active;\n        },\n        append: (toSpeak) => {\n            remainingPhrases.push(toSpeak);\n        },\n        cancel: () => {\n            if (!active) {\n                return;\n            }\n            if (root) {\n                synth.cancel();\n            }\n            nestedSeriesResults.forEach((nestedSeriesResults) => {\n                nestedSeriesResults.cancel();\n            });\n            active = false;\n        },\n    };\n}\nlet currentSeries;\nexport default function (toSpeak, lang = 'en-US') {\n    currentSeries && currentSeries.cancel();\n    currentSeries = speakSeries(toSpeak, lang);\n    return currentSeries;\n}\n//# sourceMappingURL=speech.js.map","import { getOwner, onCleanup, createSignal, getListener } from 'solid-js';\nimport { isServer } from 'solid-js/web';\n\n// src/index.ts\nvar debounce = (callback, wait) => {\n  if (isServer) {\n    return Object.assign(() => void 0, { clear: () => void 0 });\n  }\n  let timeoutId;\n  const clear = () => clearTimeout(timeoutId);\n  if (getOwner())\n    onCleanup(clear);\n  const debounced = (...args) => {\n    if (timeoutId !== void 0)\n      clear();\n    timeoutId = setTimeout(() => callback(...args), wait);\n  };\n  return Object.assign(debounced, { clear });\n};\nvar throttle = (callback, wait) => {\n  if (isServer) {\n    return Object.assign(() => void 0, { clear: () => void 0 });\n  }\n  let isThrottled = false, timeoutId, lastArgs;\n  const throttled = (...args) => {\n    lastArgs = args;\n    if (isThrottled)\n      return;\n    isThrottled = true;\n    timeoutId = setTimeout(() => {\n      callback(...lastArgs);\n      isThrottled = false;\n    }, wait);\n  };\n  const clear = () => {\n    clearTimeout(timeoutId);\n    isThrottled = false;\n  };\n  if (getOwner())\n    onCleanup(clear);\n  return Object.assign(throttled, { clear });\n};\nvar scheduleIdle = isServer ? () => Object.assign(() => void 0, { clear: () => void 0 }) : (\n  // requestIdleCallback is not supported in Safari\n  window.requestIdleCallback ? (callback, maxWait) => {\n    let isDeferred = false, id, lastArgs;\n    const deferred = (...args) => {\n      lastArgs = args;\n      if (isDeferred)\n        return;\n      isDeferred = true;\n      id = requestIdleCallback(\n        () => {\n          callback(...lastArgs);\n          isDeferred = false;\n        },\n        { timeout: maxWait }\n      );\n    };\n    const clear = () => {\n      cancelIdleCallback(id);\n      isDeferred = false;\n    };\n    if (getOwner())\n      onCleanup(clear);\n    return Object.assign(deferred, { clear });\n  } : (\n    // fallback to setTimeout (throttle)\n    (callback) => throttle(callback)\n  )\n);\nfunction leading(schedule, callback, wait) {\n  if (isServer) {\n    let called = false;\n    const scheduled2 = (...args) => {\n      if (called)\n        return;\n      called = true;\n      callback(...args);\n    };\n    return Object.assign(scheduled2, { clear: () => void 0 });\n  }\n  let isScheduled = false;\n  const scheduled = schedule(() => isScheduled = false, wait);\n  const func = (...args) => {\n    if (!isScheduled)\n      callback(...args);\n    isScheduled = true;\n    scheduled();\n  };\n  const clear = () => {\n    isScheduled = false;\n    scheduled.clear();\n  };\n  if (getOwner())\n    onCleanup(clear);\n  return Object.assign(func, { clear });\n}\nfunction leadingAndTrailing(schedule, callback, wait) {\n  if (isServer) {\n    let called = false;\n    const scheduled2 = (...args) => {\n      if (called)\n        return;\n      called = true;\n      callback(...args);\n    };\n    return Object.assign(scheduled2, { clear: () => void 0 });\n  }\n  let State;\n  ((State2) => {\n    State2[State2[\"Ready\"] = 0] = \"Ready\";\n    State2[State2[\"Leading\"] = 1] = \"Leading\";\n    State2[State2[\"Trailing\"] = 2] = \"Trailing\";\n  })(State || (State = {}));\n  let state = 0 /* Ready */;\n  const scheduled = schedule((args) => {\n    state === 2 /* Trailing */ && callback(...args);\n    state = 0 /* Ready */;\n  }, wait);\n  const fn = (...args) => {\n    if (state !== 2 /* Trailing */) {\n      if (state === 0 /* Ready */)\n        callback(...args);\n      state += 1;\n    }\n    scheduled(args);\n  };\n  const clear = () => {\n    state = 0 /* Ready */;\n    scheduled.clear();\n  };\n  if (getOwner())\n    onCleanup(clear);\n  return Object.assign(fn, { clear });\n}\nfunction createScheduled(schedule) {\n  let listeners = 0;\n  let isDirty = false;\n  const [track, dirty] = createSignal(void 0, { equals: false });\n  const call = schedule(() => {\n    isDirty = true;\n    dirty();\n  });\n  return () => {\n    if (!isDirty)\n      call(), track();\n    if (isDirty) {\n      isDirty = !!listeners;\n      return true;\n    }\n    if (getListener()) {\n      listeners++;\n      onCleanup(() => listeners--);\n    }\n    return false;\n  };\n}\n\nexport { createScheduled, debounce, leading, leadingAndTrailing, scheduleIdle, throttle };\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { untrack } from 'solid-js';\nimport SpeechEngine, {} from './speech.js';\nimport { debounce } from '@solid-primitives/scheduled';\nimport { focusPath } from '../useFocusManager.js';\nlet resetFocusPathTimer;\nlet prevFocusPath = [];\nlet currentlySpeaking;\nlet voiceOutDisabled = false;\nconst fiveMinutes = 300000;\nfunction debounceWithFlush(callback, time) {\n    const trigger = debounce(callback, time);\n    let scopedValue;\n    const debounced = (newValue) => {\n        scopedValue = newValue;\n        trigger(newValue);\n    };\n    debounced.flush = () => {\n        trigger.clear();\n        callback(scopedValue);\n    };\n    debounced.clear = trigger.clear;\n    return debounced;\n}\nfunction getElmName(elm) {\n    return elm.id || elm.name;\n}\nfunction onFocusChangeCore(focusPath = []) {\n    if (!Announcer.onFocusChange || !Announcer.enabled) {\n        return;\n    }\n    const loaded = focusPath.every((elm) => !elm.loading);\n    const focusDiff = focusPath.filter((elm) => !prevFocusPath.includes(elm));\n    resetFocusPathTimer();\n    if (!loaded && Announcer.onFocusChange) {\n        Announcer.onFocusChange([]);\n        return;\n    }\n    prevFocusPath = focusPath.slice(0);\n    const toAnnounceText = [];\n    const toAnnounce = focusDiff.reduce((acc, elm) => {\n        if (elm.announce) {\n            acc.push([getElmName(elm), 'Announce', elm.announce]);\n            toAnnounceText.push(elm.announce);\n        }\n        else if (elm.title) {\n            acc.push([getElmName(elm), 'Title', elm.title]);\n            toAnnounceText.push(elm.title);\n        }\n        else {\n            acc.push([getElmName(elm), 'No Announce', '']);\n        }\n        return acc;\n    }, []);\n    focusDiff.reverse().reduce((acc, elm) => {\n        if (elm.announceContext) {\n            acc.push([getElmName(elm), 'Context', elm.announceContext]);\n            toAnnounceText.push(elm.announceContext);\n        }\n        else {\n            acc.push([getElmName(elm), 'No Context', '']);\n        }\n        return acc;\n    }, toAnnounce);\n    if (Announcer.debug) {\n        console.table(toAnnounce);\n    }\n    if (toAnnounceText.length) {\n        return Announcer.speak(toAnnounceText.reduce((acc, val) => acc.concat(val), []));\n    }\n}\nfunction textToSpeech(toSpeak) {\n    if (voiceOutDisabled) {\n        return;\n    }\n    return (currentlySpeaking = SpeechEngine(toSpeak));\n}\nexport const Announcer = {\n    debug: false,\n    enabled: true,\n    cancel: function () {\n        currentlySpeaking && currentlySpeaking.cancel();\n    },\n    clearPrevFocus: function (depth = 0) {\n        prevFocusPath = prevFocusPath.slice(0, depth);\n        resetFocusPathTimer();\n    },\n    speak: function (text, { append = false, notification = false } = {}) {\n        if (Announcer.onFocusChange && Announcer.enabled) {\n            Announcer.onFocusChange.flush();\n            if (append && currentlySpeaking && currentlySpeaking.active) {\n                currentlySpeaking.append(text);\n            }\n            else {\n                Announcer.cancel();\n                textToSpeech(text);\n            }\n            if (notification) {\n                voiceOutDisabled = true;\n                currentlySpeaking?.series\n                    .finally(() => {\n                    voiceOutDisabled = false;\n                    Announcer.refresh();\n                })\n                    .catch(console.error);\n            }\n        }\n        return currentlySpeaking;\n    },\n    refresh: function (depth = 0) {\n        Announcer.clearPrevFocus(depth);\n        Announcer.onFocusChange &&\n            Announcer.onFocusChange(untrack(() => focusPath()));\n    },\n    setupTimers: function ({ focusDebounce = 400, focusChangeTimeout = fiveMinutes, } = {}) {\n        Announcer.onFocusChange = debounceWithFlush(onFocusChangeCore, focusDebounce);\n        resetFocusPathTimer = debounceWithFlush(() => {\n            // Reset focus path for full announce\n            prevFocusPath = [];\n        }, focusChangeTimeout);\n    },\n};\n//# sourceMappingURL=announcer.js.map","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { createEffect, on } from 'solid-js';\nimport { Announcer } from './announcer.js';\nimport { focusPath } from '../useFocusManager.js';\nexport const useAnnouncer = () => {\n    Announcer.setupTimers();\n    createEffect(on(focusPath, Announcer.onFocusChange, { defer: true }));\n    return Announcer;\n};\n//# sourceMappingURL=index.js.map","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { ElementNode, setActiveElement } from '@lightningjs/solid';\nimport { assertTruthy } from './utils.js';\nexport function handleNavigation(direction) {\n    return function () {\n        const numChildren = this.children.length;\n        const wrap = this.wrap;\n        const lastSelected = this.selected;\n        if (direction === 'right' || direction === 'down') {\n            do {\n                this.selected = ((this.selected || 0) % numChildren) + 1;\n                if (this.selected >= numChildren) {\n                    if (!wrap) {\n                        this.selected = null;\n                        break;\n                    }\n                    this.selected = 0;\n                }\n            } while (this.children[this.selected]?.skipFocus);\n        }\n        else if (direction === 'left' || direction === 'up') {\n            do {\n                this.selected = ((this.selected || 0) % numChildren) - 1;\n                if (this.selected < 0) {\n                    if (!wrap) {\n                        this.selected = null;\n                        break;\n                    }\n                    this.selected = numChildren - 1;\n                }\n            } while (this.children[this.selected]?.skipFocus);\n        }\n        if (this.selected === null) {\n            this.selected = lastSelected;\n            return false;\n        }\n        const active = this.children[this.selected];\n        assertTruthy(active instanceof ElementNode);\n        this.onSelectedChanged &&\n            this.onSelectedChanged.call(this, this, active, this.selected, lastSelected);\n        if (this.plinko && lastSelected !== null) {\n            // Set the next item to have the same selected index\n            // so we move up / down directly\n            const lastSelectedChild = this.children[lastSelected];\n            assertTruthy(lastSelectedChild instanceof ElementNode);\n            const num = lastSelectedChild.selected;\n            active.selected = num;\n        }\n        setActiveElement(active);\n        return true;\n    };\n}\n//# sourceMappingURL=navigation.js.map","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { handleNavigation } from \"./navigation.js\";\nimport { ElementNode } from '@lightningjs/solid';\nexport function Row(props) {\n    const left = handleNavigation('left');\n    const right = handleNavigation('right');\n    const defaultStyle = {\n        display: 'flex',\n        justifyContent: 'flexStart',\n    };\n    return <node onLeft={left} onRight={right} selected={props.selected || 0} onFocus={props.onFocus || (elm => {\n            if (!elm || elm.selected === null)\n                return;\n            let child = elm.children[elm.selected];\n            while (child?.skipFocus) {\n                elm.selected++;\n                child = elm.children[elm.selected];\n            }\n            if (!(child instanceof ElementNode))\n                return;\n            child.setFocus();\n        })} style={props.style || defaultStyle} {...props}>{props.children}</node>;\n}\n//# sourceMappingURL=Row.jsx.map","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { ElementNode } from \"@lightningjs/solid\";\nimport { handleNavigation } from \"./navigation.js\";\nexport function Column(props) {\n    const up = handleNavigation('up');\n    const down = handleNavigation('down');\n    const defaultStyle = {\n        display: 'flex',\n        flexDirection: 'column',\n        justifyContent: 'flexStart',\n    };\n    return <node onUp={up} onDown={down} onFocus={props.onFocus || (elm => {\n            if (!elm || elm.selected === null)\n                return;\n            let child = elm.children[elm.selected];\n            while (child?.skipFocus) {\n                elm.selected++;\n                child = elm.children[elm.selected];\n            }\n            if (!(child instanceof ElementNode))\n                return;\n            child.setFocus();\n        })} selected={props.selected || 0} style={props.style || defaultStyle} {...props}>{props.children}</node>;\n}\n//# sourceMappingURL=Column.jsx.map","import { createSignal } from \"solid-js\";\r\nexport const [globalBackground, setGlobalBackground] = createSignal<string>('');\r\nexport const [focusMenu, setFocusMenu] = createSignal<boolean>(false);\r\n","import { type AnimationSettings } from \"@lightningjs/renderer\";\r\nimport { globalBackground } from \"../state.js\";\r\nimport { type IntrinsicNodeStyleProps, View, hexColor } from \"@lightningjs/solid\";\r\nimport { createEffect, on } from \"solid-js\";\r\nimport theme from 'theme';\r\n\r\nexport default function Background() {\r\n  let bg1, bg2;\r\n  let active = 0;\r\n  const alpha = 1;\r\n  const bgStyles = { alpha, color: 0xffffffff } satisfies IntrinsicNodeStyleProps;\r\n  const animationSettings = { duration: 1000, easing: 'ease-in-out' } satisfies Partial<AnimationSettings>;\r\n\r\n  createEffect(on(globalBackground, (img: string) => {\r\n    if (img.startsWith('#')) {\r\n      bg1.color = img;\r\n      bg1.src = '';\r\n      bg1.alpha = 1;\r\n      active = 1;\r\n      bg2.alpha = 0;\r\n      return;\r\n    } else {\r\n      bg1.color = 0xffffffff;\r\n    }\r\n\r\n    if (active === 0) {\r\n      bg1.src = img;\r\n      active = 1;\r\n      return;\r\n    }\r\n\r\n    if (active === 1) {\r\n      bg2.src = img;\r\n      active = 2;\r\n      // array animation works\r\n      bg2.alpha = [alpha];\r\n      bg1.alpha = [0];\r\n      return;\r\n    }\r\n\r\n    if (active === 2) {\r\n      bg1.src = img;\r\n      active = 1;\r\n      // or use the animate property\r\n      bg1.alpha = alpha;\r\n      bg2.alpha = 0;\r\n    }\r\n  }, { defer: true}))\r\n\r\n  return (<>\r\n  <View width={1920} height={1080} zIndex={-5}>\r\n    <View ref={bg1} animate animationSettings={animationSettings} style={bgStyles} />\r\n    <View ref={bg2} animate animationSettings={animationSettings} style={bgStyles} alpha={0} />\r\n    <View\r\n      effects={{\r\n        radialGradient: {\r\n          colors: [hexColor(\"#3b3b3b\"), hexColor(\"#272727\"), hexColor(\"#181818\")],\r\n          stops: [0, 0.3, 0.8],\r\n          height: 800,\r\n          width: 1920,\r\n          pivot: [0.8, 0], \r\n        },\r\n      }}\r\n    />\r\n    </View>\r\n  </>);\r\n}\r\n","import { IntrinsicNodeStyleProps, hexColor } from \"@lightningjs/solid\";\r\nimport theme from 'theme';\r\n\r\nexport const menuContainerStyle = {\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  justifyContent: 'flexStart',\r\n  gap: 8,\r\n  width: 120,\r\n  x: -2,\r\n  zIndex: 999,\r\n  alpha: 1,\r\n  y: 0,\r\n  color: hexColor('#000000'),\r\n  height: theme.layout.screenH,\r\n  // borderRight: { width: 2, color: hexColor('#2f2f2f') },\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const menuMainStyle = {\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  gap: 80,\r\n  x: 35,\r\n  marginTop: 200\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const menuIconStyle = {\r\n  width: 50,\r\n  height: 50,\r\n  x: 0,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const menuLineStyle = {\r\n  width: 50,\r\n  height: 0,\r\n  x: 0,\r\n  y: 58,\r\n  focus: {\r\n    height: 6,\r\n    color: hexColor('#ffffff'),\r\n  },\r\n  active: {\r\n    height: 6,\r\n    color: hexColor('#ff0000'),\r\n  },\r\n} satisfies IntrinsicNodeStyleProps;","import { IntrinsicNodeStyleProps, deg2rad, hexColor } from \"@lightningjs/solid\";\r\nimport theme from \"theme\";\r\n\r\nexport default {\r\n  Column: {\r\n    ...(theme.flexColumn as IntrinsicNodeStyleProps),\r\n    width: 320,\r\n    height: 600,\r\n    y: 220,\r\n    gap: 60,\r\n    zIndex: 101,\r\n    colors: hexColor(theme.color.primary),\r\n    x: [\r\n      20,\r\n      {\r\n        duration: 250,\r\n        easing: \"ease-in-out\",\r\n      },\r\n    ] as any, // TODO: Fix this type\r\n    focus: {\r\n      x: [\r\n        theme.layout.marginX,\r\n        {\r\n          duration: 250,\r\n          easing: \"ease-in-out\",\r\n        },\r\n      ] as any, // TODO: Fix this type\r\n    },\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  menuLineStyle: {\r\n    width: 50,\r\n    height: 0,\r\n    x: 0,\r\n    y: 58,\r\n    color: hexColor('#ff0000'),\r\n    focus: {\r\n      height: 6,\r\n    },\r\n    active: {\r\n      \r\n    }\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  MenuWrapper: {\r\n    zIndex: 1000,\r\n    focus: {\r\n      width: 400,\r\n      alpha: [1] as any, // TODO: Fix this type\r\n      duration: 250,\r\n      easing: \"ease-in-out\",\r\n    },\r\n    angle: deg2rad(270),\r\n    stops: [0, 0.4, 0.8],\r\n    width: 100,\r\n    height: 1080,\r\n    color: hexColor(theme.color.primary),\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  MenuText: {\r\n    zIndex: 1,\r\n    fontSize: 32,\r\n    x: 86,\r\n    y: 10,\r\n    height: 50,\r\n    alpha: 0,\r\n    active: {\r\n      alpha: 1,\r\n    },\r\n  } satisfies IntrinsicNodeStyleProps,\r\n};\r\n","import { useNavigate } from \"@solidjs/router\";\r\nimport {\r\n  View,\r\n  Text,\r\n  ElementNode,\r\n  IntrinsicNodeProps,\r\n  For,\r\n} from \"@lightningjs/solid\";\r\nimport {\r\n  menuContainerStyle,\r\n  menuIconStyle,\r\n  menuLineStyle,\r\n  menuMainStyle,\r\n} from \"../../../assets/styles/menuStyle\";\r\nimport { Column } from \"@lightningjs/solid-primitives\";\r\nimport styles from \"./Menu.styles\";\r\nimport theme from \"theme\";\r\nimport Icon from \"../Icon\";\r\nimport { AiOutlineMenuUnfold } from \"solid-icons/ai\";\r\n\r\ninterface NavButtonProps extends IntrinsicNodeProps {\r\n  icon: string;\r\n  children: string;\r\n}\r\nconst basePath = import.meta.env.BASE_URL;\r\n\r\nfunction NavButton(props: NavButtonProps) {\r\n  return (\r\n    <View {...props} forwardStates>\r\n      <View\r\n        y={-16}\r\n        src={basePath + \"assets/icon-search.png\"}\r\n        style={menuIconStyle}\r\n        forwardStates\r\n      >\r\n        <View style={menuLineStyle}></View>\r\n      </View>\r\n      <Text\r\n        style={{\r\n          ...theme.typography.button1,\r\n          fontSize: 38,\r\n          x: 50,\r\n          y: 16,\r\n          height: 50,\r\n          alpha: 0,\r\n          active: {\r\n            alpha: 1,\r\n          },\r\n        }}\r\n      >\r\n        {props.children}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nexport default function Menu(props) {\r\n  let backdrop;\r\n  const navigate = useNavigate();\r\n\r\n  function onFocus(this: ElementNode) {\r\n    this.children.forEach((c) => c.states!.add(\"active\"));\r\n    this.children.selected!.setFocus();\r\n  }\r\n\r\n  function onBlur(this: ElementNode) {\r\n    this.selected = 0;\r\n    this.children.forEach((c) => c.states!.remove(\"active\"));\r\n  }\r\n  return (\r\n    <View style={styles.MenuWrapper}>\r\n      <Column\r\n        {...props}\r\n        onFocus={onFocus}\r\n        onBlur={onBlur}\r\n        style={styles.Column}\r\n        animate\r\n      >\r\n        {(props?.mennuItems || []).map((menuItem) => (\r\n          <View\r\n            src={basePath + `${menuItem.icon}`}\r\n            style={menuIconStyle}\r\n            forwardStates\r\n            onEnter={() => navigate(`${menuItem.path}`)}\r\n          >\r\n            <View style={styles.menuLineStyle}/>\r\n            <Text style={styles.MenuText}>{menuItem.name}</Text>\r\n          </View>\r\n        ))}\r\n      </Column>\r\n      <View ref={backdrop}></View>\r\n    </View>\r\n  );\r\n}\r\n","import { IntrinsicNodeStyleProps, IntrinsicTextNodeStyleProps, hexColor } from '@lightningjs/solid';\r\nimport theme from 'theme';\r\n\r\n// Augment existing intrinsic style prop interfaces to include our own\r\n// app-specific states\r\ndeclare module '@lightningjs/solid' {\r\n  interface IntrinsicNodeStyleProps {\r\n    // TODO: Refactor states to use a $ prefix\r\n    active?: IntrinsicNodeStyleProps;\r\n    disabled?: IntrinsicNodeStyleProps;\r\n  }\r\n\r\n  interface IntrinsicTextNodeStyleProps {\r\n    // TODO: Refactor states to use a $ prefix\r\n    active?: IntrinsicTextNodeStyleProps;\r\n    disabled?: IntrinsicTextNodeStyleProps;\r\n  }\r\n}\r\n\r\nexport default {\r\n  Page: {\r\n    width: 1920, height: 1080\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  pageWrapper: {\r\n    x: 100\r\n  },\r\n  headlineText: {\r\n    width: 1200, height: 240,\r\n    x: 360,\r\n    // lineHeight: 170, // TODO: Add back when lineHeight is supported\r\n    y: 455, contain: 'both',\r\n    fontSize: 66,\r\n    textAlign: 'center'\r\n  } satisfies IntrinsicTextNodeStyleProps,\r\n  headlineSubText: {\r\n    width: 1920,\r\n    height: 170,\r\n    // lineHeight: 170, // TODO: Add back when lineHeight is supported\r\n    x: 530,\r\n    y: 655, contain: 'both',\r\n    fontSize: 48,\r\n    textAlign: 'center'\r\n  } satisfies IntrinsicTextNodeStyleProps,\r\n  itemsContainer: {\r\n    width: theme.layout.screenW,\r\n    height: 600,\r\n    y: 350,\r\n    x: 0,\r\n    zIndex: 2,\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  FocusRing: {\r\n    borderRadius: 0,\r\n    width: 194, height: 286, y: -5, x: -5, zIndex: -1\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  showHeadline: { x: 70, y: 20 } satisfies IntrinsicNodeStyleProps,\r\n  headlineBlur: {\r\n    width: 1920,\r\n    height: 150,\r\n    x: 0,\r\n    y: 0,\r\n    zIndex: 14,\r\n    alpha: 0.9,\r\n    color: hexColor('#000000')\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  RowTitle: {\r\n    height: 60,\r\n    width: 400,\r\n    marginTop: 20,\r\n    fontSize: 36,\r\n    color: hexColor('#f0f0f0'),\r\n    zIndex: 2\r\n  } satisfies IntrinsicTextNodeStyleProps,\r\n  Row: {\r\n    display: 'flex',\r\n    justifyContent: 'spaceBetween',\r\n    height: 290,\r\n    gap: 10,\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  Column: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    justifyContent: 'flexStart',\r\n    gap: 10,\r\n    width: theme.layout.screenW - (2 * theme.layout.marginX),\r\n    x: theme.layout.marginX + theme.layout.gutterX,\r\n    y: 100,\r\n    zIndex: 2\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  Rect: {\r\n    width: 250,\r\n    height: 100,\r\n    y: 10,\r\n    x: 300,\r\n    color: hexColor('#0000ff')\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  peopleBio: {\r\n    ...theme.typography.body1,\r\n    contain: 'both',\r\n    width: 1500,\r\n    height: 400\r\n  } satisfies IntrinsicTextNodeStyleProps,\r\n};\r\n\r\nconst Button = {\r\n  width: 120,\r\n  height: 40,\r\n  color: hexColor('#000000'),\r\n  borderRadius: 8,\r\n  border: { width: 2, color: hexColor('#3333ff') },\r\n  scale: 1,\r\n  focus: {\r\n    scale: 1.1,\r\n    border: { width: 5, color: hexColor('#333333') },\r\n  },\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nconst TopBar = {\r\n  color: hexColor('#00A699'),\r\n  height: 8,\r\n  y: 2,\r\n  x: -4,\r\n  width: Button.width + 8\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nconst ButtonText = {\r\n  fontSize: 12,\r\n  y: 12,\r\n  // lineHeight: Button.height, // TODO: Add back when lineHeight is supported\r\n  contain: 'width',\r\n  textAlign: 'center',\r\n  color: hexColor('#F6F6F9'),\r\n  height: Button.height,\r\n  width: Button.width\r\n} satisfies IntrinsicTextNodeStyleProps;\r\n\r\nexport const buttonStyles = {\r\n  container: Button,\r\n  topBar: TopBar,\r\n  text: ButtonText\r\n} satisfies Record<string, IntrinsicTextNodeStyleProps>;\r\n\r\n\r\nexport const MaterialButton = {\r\n  width: 386,\r\n  height: 136,\r\n  color: hexColor('#715cab'),\r\n  focus: {\r\n    color: hexColor('#5a39a2'),\r\n  },\r\n  disabled: {\r\n    color: hexColor('#291d43'),\r\n  }\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const Backdrop = {\r\n  color: hexColor('#000000'),\r\n  alpha: 0.85,\r\n  zIndex: 998,\r\n}\r\n\r\nexport const MaterialButtonText = {\r\n  fontSize: 32,\r\n  contain: 'width',\r\n  textAlign: 'center',\r\n  mountY: -0.35,\r\n  color: hexColor('#FFFFFF'),\r\n  height: MaterialButton.height,\r\n  width: MaterialButton.width,\r\n  focus: {\r\n    fontSize: 40\r\n  },\r\n  disabled: {\r\n    color: hexColor('#909090'),\r\n  }\r\n} satisfies IntrinsicTextNodeStyleProps;\r\n\r\nexport const Wraper = {\r\n  marginX: 320\r\n} satisfies IntrinsicNodeStyleProps;\r\n","export const menuItems = [\r\n    {\r\n        name: 'Home', path: \"/\", icon: 'assets/icon-home.png'\r\n    },\r\n    {\r\n        name: 'Search', path: \"/search\", icon: 'assets/icon-search.png'\r\n    },\r\n    {\r\n        name: 'TV', path: \"/tv\", icon: 'assets/icon-tivi.png'\r\n    },\r\n    {\r\n        name: 'List column', path: \"/videos\", icon: 'assets/icon-video.png'\r\n    },\r\n    {\r\n        name: 'List Slider', path: \"/list\", icon: 'assets/icon-list.png'\r\n    },\r\n]","import { useLocation, useNavigate, useParams } from \"@solidjs/router\";\r\nimport { ElementNode, View, activeElement } from \"@lightningjs/solid\";\r\nimport { useFocusManager, useAnnouncer } from \"@lightningjs/solid-primitives\";\r\nimport Background from \"../components/Background\";\r\nimport Menu from \"../components/Menu/Menu\";\r\nimport { createEffect, createSignal, onMount } from \"solid-js\";\r\nimport styles from \"../styles\";\r\nimport { focusMenu, setFocusMenu } from \"../state\";\r\nimport { Button, FocusRing } from \"../components\";\r\nimport { menuItems } from \"../components/Menu/constant\";\r\n\r\nconst App = (props) => {\r\n  const announcer = useAnnouncer();\r\n  announcer.enabled = false;\r\n  const navigate = useNavigate();\r\n  const location :any = useLocation();\r\n  const params = useParams();\r\n  let navDrawer, lastFocused, buttonNoti;\r\n  const [localtionActive, setLocaltionActive] = createSignal(location);\r\n\r\n  useFocusManager({\r\n    Menu: 'm',\r\n    Escape: 'Escape',\r\n  });\r\n\r\n  onMount(() => {\r\n    setFocusMenu(true);\r\n  });\r\n\r\n  createEffect(() => {\r\n    setLocaltionActive(location.pathname);\r\n  });\r\n\r\n\r\n  return (\r\n    <View\r\n      ref={window.APP}\r\n      onLast={() => history.back()}\r\n      onMenu={() => navigate(\"/\")}\r\n      style={{ width: 1920, height: 1080 }}\r\n      onLeft={() => {\r\n        if (navDrawer.states.has(\"focus\") || (focusMenu() == false && localtionActive() == '/search')) {\r\n          return false;\r\n        }\r\n        lastFocused = activeElement();\r\n        navDrawer.setFocus();\r\n      }}\r\n      onRight={() => {\r\n        setFocusMenu(false);\r\n        return navDrawer.states.has(\"focus\") && lastFocused.setFocus()\r\n      }}\r\n      plinko\r\n    >\r\n      <Background />\r\n\r\n      {/* <FocusRing color={hexColor(theme.color.focus)} ref={focusRingRef} /> */}\r\n      <View style={styles.pageWrapper}>{props.children}</View>\r\n\r\n      <Menu ref={navDrawer} mennuItems={menuItems} />\r\n      \r\n      {/* <Button autofocus ref={buttonNoti} onRight={() => {\r\n        if (buttonNoti.states.has(\"focus\")) {\r\n          return false;\r\n        }\r\n        lastFocused = activeElement();\r\n        buttonNoti.setFocus();\r\n      }} x={100} onEnter={showNotification}>Enter to show notification</Button> */}\r\n      {/* <Notification isOpen={isOpenNotification()} message={'You have an notification! '}/> */}\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","export default import.meta.ROLLUP_FILE_URL_bf44a4f3;","import { Text, View } from '@lightningjs/solid';\r\n\r\nconst HomePage = () => {\r\n  const OverviewContainer = {\r\n    width: 900,\r\n    height: 500,\r\n    y: 350,\r\n    x: 20,\r\n    gap: 25,\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    justifyContent: 'flexStart',\r\n  }\r\n\r\n  const SublineContainer = {\r\n    width: 900,\r\n    height: 36,\r\n    gap: 6,\r\n    display: 'flex',\r\n    flexDirection: 'row',\r\n    justifyContent: 'flexStart',\r\n  }\r\n\r\n  const Title = {\r\n    fontSize: 42,\r\n  };\r\n\r\n  const Overview = {\r\n    width: OverviewContainer.width,\r\n    fontSize: 26,\r\n    contain: 'width'\r\n  };\r\n\r\n  const Subline = {\r\n    fontSize: 26,\r\n  };\r\n\r\n  return (\r\n    <View autofocus style={OverviewContainer}>\r\n      <Text style={Title}>Title of the Page</Text>\r\n      <Text style={Overview}>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer vel tempor tellus. Sed eu leo purus. Vestibulum sollicitudin eget tellus a varius. Phasellus est turpis, volutpat sed blandit sit amet, rutrum sit amet mauris. In dignissim elit orci, a sollicitudin ipsum faucibus et. Quisque vel quam rutrum, faucibus augue sed, scelerisque nunc.</Text>\r\n      <View style={SublineContainer}>\r\n        <Text style={Subline}>Subline Text</Text>\r\n        <View width={28} height={28} src={'/assets/rt-popcorn.png'}></View>\r\n        <Text style={Subline}>More Text</Text>\r\n      </View>\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default HomePage;\r\n","export const keyBoards = ['a', 'b', 'c', 'd', 'e', 'f', 'g',\r\n                   'h', 'i', 'j', 'k', 'l', 'm', 'n',\r\n                   'o', 'p', 'q', 'r', 's', 't', 'u',\r\n                   'v', 'w', 'x', 'y', 'z', '0', '1',\r\n                   '2', '3', '4', '5', '6', '7', '8',\r\n                   '9'\r\n                  ];","import { IntrinsicNodeStyleProps, hexColor } from \"@lightningjs/solid\";\r\nimport theme from 'theme';\r\n\r\nexport const keyboardContainerStyle = {\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  gap: 40,\r\n  y: 0,\r\n  color: hexColor('#000000'),\r\n  height: theme.layout.screenH,\r\n  alpha: 1,\r\n}\r\n\r\nexport const KeyboardMainStyle = {\r\n  display: 'flex',\r\n  flexDirection: 'row',\r\n  justifyContent: 'flexStart',\r\n  gap: 16,\r\n  x: 40,\r\n  zIndex: 999,\r\n  height: theme.layout.screenH,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const KeyboardChooseStyle = {\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  justifyContent: 'flexStart',\r\n  gap: 16,\r\n  width: 540,\r\n  x: 40,\r\n  zIndex: 999,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\n\r\n\r\nexport const KeyboardRowStyle = {\r\n  display: 'flex',\r\n  flexDirection: 'row',\r\n  justifyContent: 'spaceBetween',\r\n  gap: 8,\r\n  height: 70,\r\n  width: 500,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const backdropKeyboardStyle = {\r\n  color: hexColor('#000000'),\r\n  alpha: 0.8,\r\n  zIndex: 998,\r\n  x: 0,\r\n  y: 0,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const KeyboardItemStyle = {\r\n  display: 'flex',\r\n  borderRadius: 6,\r\n  border: { width: 0, color: hexColor('#ffffff') },\r\n  justifyContent: 'center',\r\n  alignItems: 'center',\r\n  gap: 6,\r\n  width: 70,\r\n  height: 70,\r\n  color: hexColor('#2e3743'),\r\n  focus: {\r\n    border: { width: 4, color: hexColor('#ffffff') },\r\n    color: hexColor('#000000'),\r\n  },\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const KeyboardTextStyle = {\r\n  fontSize: 40,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const inputSearchStyle = {\r\n  color: hexColor('#red'),\r\n  width: 500,\r\n  x: 40,\r\n  height: 70,\r\n  alpha: 1,\r\n  backgroundColor: hexColor('#ffffff'),\r\n  borderRadius: 8,\r\n  border: { width: 4, color: hexColor('#ffffff') },\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'flexStart',\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const resultSearchStyle = {\r\n  width: 500,\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  alignItems: 'flexStart',\r\n  justifyContent: 'flexStart',\r\n  gap: 20,\r\n  x: 0,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const KeyboardItemSpecalStyle = {\r\n  height: 70,\r\n  width: 240,\r\n  color: hexColor('#2e3743'),\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'center',\r\n  borderRadius: 6,\r\n  border: { width: 0, color: hexColor('#ffffff') },\r\n  focus: {\r\n    border: { width: 4, color: hexColor('#ffffff') },\r\n    color: hexColor('#000000'),\r\n  },\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const KeyboardItemSpecalIconStyle = {\r\n  width: 70,\r\n  height: 50,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const spaceSearchStyle = {\r\n  height: 10,\r\n  x: 0,\r\n  y: 0,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const resultVideosStyle = {\r\n  color: hexColor(\"#09121a\"),\r\n  y: -160,\r\n  fontSize: 30,\r\n  x: 40,\r\n  width: theme.layout.screenW - (580 + 116),\r\n  height: theme.layout.screenH,\r\n  zIndex: 999,\r\n  // display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'center',\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const resultVideoItemStyle = {\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  justifyContent: 'flexStart',\r\n  gap: 20,\r\n  width: theme.layout.screenW - (2 * theme.layout.marginX + 532 + ((theme.layout.marginX + theme.layout.gutterX) * 2)),\r\n  x: 48,\r\n  y: 48,\r\n  zIndex: 2\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const KeyboardItemNormalStyle = {\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  justifyContent: 'flexStart',\r\n  gap: 20,\r\n} satisfies IntrinsicNodeStyleProps;\r\n\r\nexport const noDataStyle = {\r\n  display: 'flex',\r\n  justifyContent: 'center',\r\n  alignItems: 'center',\r\n} satisfies IntrinsicNodeStyleProps;\r\n","import { IntrinsicNodeStyleProps, deg2rad, hexColor } from \"@lightningjs/solid\";\r\nimport theme from \"theme\";\r\n\r\nexport default {\r\n  Thumbnail: {\r\n    borderRadius: 0,\r\n    width: 187,\r\n    height: 294,\r\n    scale: 1,\r\n    zIndex: 2,\r\n    \r\n  } satisfies IntrinsicNodeStyleProps,\r\n\r\n  FocusRing: {\r\n    borderRadius: 0,\r\n     y: -2, x: -2, zIndex: -1,\r\n    color: hexColor(\"#ffffff\")\r\n  } satisfies IntrinsicNodeStyleProps,\r\n};\r\n","import {\r\n  IntrinsicNodeProps,\r\n  View,\r\n  Text,\r\n  ElementNode,\r\n  activeElement,\r\n  hexColor,\r\n} from \"@lightningjs/solid\";\r\nimport styles from \"./Thumnail.styles\";\r\nimport { createEffect, on } from \"solid-js\";\r\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\r\nimport { FocusRing } from \"..\";\r\nimport theme from \"theme\";\r\nexport default function Thumbnail(props: IntrinsicNodeProps) {\r\n  let focusRingRef;\r\n  createEffect(on(activeElement, (elm) => {\r\n    assertTruthy(elm);\r\n    setTimeout(() => {\r\n      if (elm.heroContent) {\r\n        focusRingRef.parent = elm.parent;\r\n        focusRingRef.alpha = 1;\r\n        focusRingRef.scale = 1;\r\n        focusRingRef.x = elm.x! - 1.5;\r\n        focusRingRef.y = elm.y! - 1.5;\r\n        focusRingRef.width = elm.width! + 1.5;\r\n        focusRingRef.height = elm.height! + 1.5;\r\n        focusRingRef.createAnimation({ scale: 1.03}).start();\r\n        // focusRingRef.zIndex = (elm.zIndex! - 0.00000001);\r\n      } else {\r\n        focusRingRef.alpha = 0;\r\n      }\r\n    }, 10)\r\n  }, { defer: true}))\r\n  function onRowFocus(this: ElementNode) {\r\n    this.children.selected?.setFocus();\r\n  }\r\n\r\n  // console.log('props',props)\r\n  return (\r\n    <View {...props} animate style={styles.Thumbnail}>\r\n      <View\r\n        onFocus={onRowFocus}\r\n        {...props}\r\n        animate\r\n        style={styles.Thumbnail}\r\n      ></View>\r\n      <View ref={focusRingRef} style={styles.FocusRing}></View>\r\n    </View>\r\n  );\r\n}\r\n","import { IntrinsicNodeProps, View, Text } from '@lightningjs/solid';\r\nimport { Row } from '@lightningjs/solid-primitives';\r\nimport { For, splitProps } from 'solid-js';\r\nimport styles, { buttonStyles } from '../styles';\r\nimport { type Tile } from '../api/formatters/ItemFormatter';\r\nimport Thumbnail from './Thumnail';\r\n\r\n\r\nexport function FocusRing(props: IntrinsicNodeProps) {\r\n  return <View {...props} style={styles.FocusRing} />\r\n}\r\n\r\nexport interface TileRowProps extends IntrinsicNodeProps {\r\n  items: Tile[];\r\n}\r\n\r\nexport function TileRow(props: TileRowProps) {\r\n  const [local, others] = splitProps(props, [\"items\"]);\r\n\r\n  return <Row {...others} style={styles.Row}>\r\n   <For each={local.items}>\r\n      {(item) => <Thumbnail {...item} /> }\r\n    </For>\r\n  </Row>\r\n\r\n}\r\n\r\nexport function Button(props) {\r\n  return (\r\n    <View {...props} forwardStates animate\r\n      style={buttonStyles.container}>\r\n      <Text style={buttonStyles.text}>{props.children}</Text>\r\n    </View>\r\n  );\r\n}","import { createSignal, createComputed, batch, createResource } from \"solid-js\";\r\n\r\nexport function createInfiniteScroll(fetcher: (page: number) => Promise<any>) {\r\n  const [pages, setPages] = createSignal<any[]>([]);\r\n  const [page, setPage] = createSignal(1);\r\n  const [end, setEnd] = createSignal(false);\r\n\r\n  const [contents] = createResource(page, fetcher);\r\n  createComputed(() => {\r\n    const content = contents();\r\n    if (!content)\r\n      return;\r\n    batch(() => {\r\n      if (content.length === 0)\r\n        setEnd(true);\r\n        setPages((p) => [...p, ...content]);\r\n    });\r\n  });\r\n\r\n  return {\r\n      pages,\r\n      page,\r\n      setPage,\r\n      setPages,\r\n      end,\r\n      setEnd\r\n    };\r\n}\r\n","const VITE_API_KEY_V4=\"e9e9d8da18ae29fc430845952232787c\";\r\nconst VITE_REQUEST_TOKEN=\"596e02522af6fe40f284e6de58fd0865f2cbaae3\";\r\nconst API_BASE = 'https://api.themoviedb.org/3';\r\nlet tmdbConfig;\r\nlet baseImageUrl;\r\nconst basePosterSize = 'w185';\r\n\r\nconst defaultFetchParams = {\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n    Authorization: 'Bearer ' + VITE_REQUEST_TOKEN,\r\n  },\r\n};\r\n\r\nexport function getImageUrl(path: string, posterSize: string = basePosterSize) {\r\n  return baseImageUrl + posterSize + path;\r\n}\r\n\r\nfunction get(path: string, params: RequestInit = {}) {\r\n  if (tmdbConfig) {\r\n    return _get(path, params);\r\n  } else {\r\n    return loadConfig().then(() => _get(path, params))\r\n  }\r\n}\r\n\r\nfunction _get(path: string, params: RequestInit = {}) {\r\n  return fetch(API_BASE + path + (path.includes('?') ? '&' : '?') + 'api_key=' + VITE_API_KEY_V4, {\r\n    ...defaultFetchParams,\r\n    ...params,\r\n  }).then((r) => r.json());\r\n}\r\n\r\nfunction loadConfig() {\r\n  return _get('/configuration').then((data) => {\r\n    tmdbConfig = data;\r\n    baseImageUrl = data.images?.secure_base_url;\r\n    return data;\r\n  });\r\n}\r\n\r\nexport default {\r\n  get,\r\n  loadConfig,\r\n};\r\n","import { getImageUrl } from '../index';\r\n\r\nfunction truncateString(str: string, maxLength: number): string {\r\n  if (str.length > maxLength) {\r\n    return str.substring(0, maxLength - 3) + '...';\r\n  }\r\n  return str;\r\n}\r\n\r\nexport function chunkArray(array: string[], size = 7) {\r\n  let result: string[][] = [];\r\n  for (let i = 0, j = array.length; i < j; i += size) {\r\n    result.push(array.slice(i, i + size));\r\n  }\r\n  return result;\r\n}\r\n\r\nexport interface Tile {\r\n  src: string;\r\n  tileSrc: string;\r\n  backdrop: string;\r\n  href: string;\r\n  shortTitle: string;\r\n  title: string;\r\n  data: unknown;\r\n  entityInfo: {\r\n      type: string;\r\n      id: string;\r\n  };\r\n  heroContent: {\r\n      title: string;\r\n      description: string;\r\n  };\r\n}\r\n\r\n// TODO: Remove `any` type\r\nexport function convertItemsToTiles(items: any[] = []): Tile[] {\r\n  return items.map((item) => ({\r\n      src: getImageUrl(item.poster_path || item.profile_path),\r\n      tileSrc: getImageUrl(item.backdrop_path || item.profile_path, 'w300'),\r\n      backdrop: getImageUrl(item.backdrop_path, 'w1280'),\r\n      href: `/entity/${item.media_type || 'people'}/${item.id}`,\r\n      shortTitle: truncateString(item.title || item.name, 30),\r\n      title: item.title || item.name,\r\n      data: item,\r\n      entityInfo: {\r\n        type: item.media_type || 'people',\r\n        id: item.id\r\n      },\r\n      heroContent: {\r\n        title: item.title || item.name,\r\n        description: item.overview\r\n      }\r\n  }));\r\n}\r\n","import api from '..';\r\nimport { convertItemsToTiles, chunkArray } from '../formatters/ItemFormatter';\r\n\r\nlet cache = new Map();\r\nconst leftoverTiles = new Map();\r\n\r\nexport default function (size: number, query?:any) {\r\n  const filter = '';\r\n  return async (pageIndex: number): Promise<any> => {\r\n    const url = `/search/movie?include_adult=false&page=${pageIndex}&query==${query}`;\r\n    if (cache.has(url)) {\r\n      return cache.get(url);\r\n    }\r\n\r\n    const sizePage = size;\r\n\r\n    let result = await api.get(url).then((trending) => {\r\n      let results = trending.results.filter((r) => !r.adult);\r\n      let tiles = (leftoverTiles.has(filter) ? leftoverTiles.get(filter) : []).concat(convertItemsToTiles(results));\r\n      let chunks = chunkArray(tiles, sizePage);\r\n      if (chunks[chunks.length - 1].length < sizePage) {\r\n        leftoverTiles.set(filter, chunks.pop());\r\n      } else {\r\n        leftoverTiles.delete(filter);\r\n      }\r\n      return chunks;\r\n    });\r\n    console.log(result);\r\n    return result;\r\n  }\r\n}\r\n","import { ElementNode, For, Text, View, hexColor } from \"@lightningjs/solid\";\r\nimport { Column, Row } from \"@lightningjs/solid-primitives\";\r\nimport { keyBoards } from \"../../keyBoards\";\r\nimport { \r\n  KeyboardChooseStyle,\r\n  KeyboardItemNormalStyle,\r\n  KeyboardItemSpecalIconStyle,\r\n  KeyboardItemSpecalStyle,\r\n  KeyboardItemStyle,\r\n  KeyboardMainStyle,\r\n  KeyboardRowStyle,\r\n  KeyboardTextStyle,\r\n  backdropKeyboardStyle,\r\n  inputSearchStyle,\r\n  keyboardContainerStyle,\r\n  noDataStyle,\r\n  resultSearchStyle,\r\n  resultVideoItemStyle,\r\n  resultVideosStyle,\r\n  spaceSearchStyle\r\n} from \"../../assets/styles/keyboardStyle\";\r\nimport { Show, createEffect, createMemo, createSelector, createSignal, on } from \"solid-js\";\r\nimport { TileRow } from \"../components\";\r\nimport { createInfiniteScroll } from \"../components/pagination\";\r\nimport { setFocusMenu } from \"../state\";\r\nconst basePath = import.meta.env.BASE_URL;\r\nimport searchProvider from '../api/providers/search';\r\n\r\nexport default function Search(props) {\r\n    let backdropKeyboardRef, inputSearchRef, resultSearchRef, keyboardContainerRef, keyboardMainRef, resultVideosRef, keyboardChooseRef, resultVideosMainRef, KeyboardItemSpecalRef;\r\n    const [searchValue, setSearchValue] = createSignal('');\r\n    const [columnY, setcolumnY] = createSignal(0);\r\n\r\n    let searchResultProvider = createMemo(() => {\r\n      return createInfiniteScroll(searchProvider(5, searchValue()));\r\n    });\r\n\r\n    createEffect(on(searchValue, (value) => {\r\n      setcolumnY(0);\r\n      searchResultProvider().setPage(1);\r\n    }));\r\n\r\n    const isFirst = createSelector(() => {\r\n      return 0;\r\n    });\r\n  \r\n    function onFocus(this: ElementNode) {\r\n      this.states.add('focus');\r\n    };\r\n  \r\n    function onBlur(this: ElementNode) {\r\n      this.states.remove('focus');\r\n    };\r\n\r\n    const selectKeySpace = () => {\r\n      return () => {\r\n        setSearchValue(prev => prev + ' ')\r\n      }\r\n    };\r\n\r\n    const selectKeyBackSpace = () => {\r\n      return () => {\r\n        setSearchValue(prev => prev.slice(0, -1))\r\n      }\r\n    };\r\n\r\n    function selectKeyBoard(key: string) {\r\n      return () => {\r\n        setSearchValue(prev => prev + key)\r\n      }\r\n    };\r\n\r\n    const renderKeyboard = () => {\r\n      let data :any = []\r\n      const elementsPerDiv = 6;\r\n      for (let i = 0; i < keyBoards.length; i += elementsPerDiv) {\r\n        const divElements = keyBoards.slice(i, i + elementsPerDiv);\r\n        data.push(divElements);\r\n      }\r\n  \r\n      return (\r\n        <For each={data}>\r\n          {(item, i) =>\r\n            <Row style={KeyboardRowStyle} autofocus={false} plinko>\r\n              <For each={item}>\r\n                {(key, j) => (\r\n                  <View\r\n                    style={KeyboardItemStyle}\r\n                    onEnter={selectKeyBoard(key)}\r\n                    animate\r\n                    onBlur={onBlur}\r\n                    onFocus={onFocus}\r\n                    forwardStates\r\n                    autofocus={false}\r\n                  >\r\n                    <Text style={KeyboardTextStyle}>\r\n                      {key}\r\n                    </Text>\r\n                  </View>\r\n                ) }\r\n              </For>\r\n            </Row>\r\n          }\r\n        </For> \r\n      )\r\n    }\r\n\r\n    function onRowFocus(this: ElementNode) {\r\n      this.children.selected?.setFocus();\r\n      setcolumnY((this.y || 0) * -1 + 24);\r\n      let numPages = searchResultProvider().pages().length;\r\n      if(this.parent){\r\n        if (numPages === 0 || this.parent.selected && this.parent.selected >= numPages - 2) {\r\n          searchResultProvider().setPage(p => p + 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    function onEnter(this: ElementNode) {\r\n    };\r\n  \r\n    return (\r\n      <View ref={backdropKeyboardRef} animate style={backdropKeyboardStyle} autofocus>\r\n        <View\r\n          ref={keyboardContainerRef}\r\n          animate\r\n          style={keyboardContainerStyle}\r\n          autofocus\r\n          plinko\r\n        >\r\n          <View ref={inputSearchRef} style={spaceSearchStyle} skipFocus></View>\r\n          <View ref={inputSearchRef} style={inputSearchStyle} animate skipFocus>\r\n            <Text style={{\r\n              color: hexColor('#ffffff'),\r\n              fontSize: 30,\r\n              marginLeft: 20,\r\n            }}>\r\n              { searchValue() }\r\n            </Text>\r\n          </View>\r\n          <Column\r\n            style={KeyboardMainStyle}\r\n            ref={keyboardMainRef}\r\n            autofocus\r\n            onDown={() => {\r\n              if(keyboardChooseRef.states.has('focus')){\r\n                return false;\r\n              }\r\n            }}\r\n            plinko\r\n          >\r\n            <Column\r\n              style={KeyboardChooseStyle}\r\n              ref={keyboardChooseRef}\r\n              onRight={() => {\r\n                resultVideosRef.setFocus();\r\n                resultVideosMainRef.setFocus();\r\n              }}\r\n              onLeft={() => {\r\n                setFocusMenu(true);\r\n              }}\r\n              >\r\n              <Row style={KeyboardRowStyle} autofocus={false}>\r\n                <View\r\n                  style={KeyboardItemSpecalStyle}\r\n                  ref={KeyboardItemSpecalRef}\r\n                  onEnter={selectKeySpace()}\r\n                  animate\r\n                  autofocus={false}\r\n                >\r\n                  <View\r\n                    style={KeyboardItemSpecalIconStyle}\r\n                    src={basePath + 'assets/icon-space.png'}\r\n                    forwardStates\r\n                    animate\r\n                  ></View>\r\n                </View>\r\n                <View\r\n                  style={KeyboardItemSpecalStyle}\r\n                  onEnter={selectKeyBackSpace()}\r\n                  animate\r\n                  autofocus={false}\r\n                >\r\n                  <View\r\n                    style={KeyboardItemSpecalIconStyle}\r\n                    src={basePath + 'assets/icon-back-space.png'}\r\n                    forwardStates\r\n                    animate\r\n                  ></View>\r\n                </View>\r\n              </Row>\r\n              <Column plinko style={KeyboardItemNormalStyle}>\r\n                {\r\n                  renderKeyboard()\r\n                }\r\n              </Column>\r\n              <Column\r\n                ref={resultSearchRef}\r\n                animate\r\n                style={resultSearchStyle}\r\n                forwardStates\r\n              >\r\n                <Text style={{\r\n                  color: hexColor('#504d4d'),\r\n                  fontSize: 30,\r\n                  focus: {\r\n                    color: hexColor('#ffffff'),\r\n                  }\r\n                }}>\r\n                  {/* Result Search */}\r\n                </Text>\r\n              </Column>\r\n            </Column>\r\n            <View\r\n              style={resultVideosStyle}\r\n              ref={resultVideosRef}\r\n              onLeft={() => {\r\n                keyboardChooseRef.setFocus();\r\n              }}\r\n            >\r\n              <Show when={searchResultProvider().pages().length == 0}>\r\n                <View style={noDataStyle}>\r\n                  <Text\r\n                    style={{\r\n                      fontSize: 40,\r\n                      display: 'flex',\r\n                      justifyContent: 'center',\r\n                      textAlign: 'center'\r\n                    }}\r\n                  >\r\n                    No Data\r\n                  </Text>\r\n                </View>\r\n              </Show>\r\n              <Show when={searchResultProvider().pages().length > 0}>\r\n                <Column ref={resultVideosMainRef} animate y={columnY()} style={resultVideoItemStyle} plinko>\r\n                  <For each={searchResultProvider().pages()}>\r\n                    {(items, i) =>\r\n                      <TileRow autofocus={isFirst(i()) && resultVideosRef.states.has('focus')} items={items} onFocus={onRowFocus} onEnter={onEnter} />\r\n                    }\r\n                  </For>\r\n                </Column>\r\n              </Show>\r\n            </View>\r\n          </Column>\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n  ","import { createSignal, createSelector, For, createEffect, on } from \"solid-js\";\r\n\r\nimport { ElementNode, View, Text, activeElement, hexColor, setActiveElement } from '@lightningjs/solid';\r\nimport { Row } from '@lightningjs/solid-primitives';\r\nimport { useNavigate } from \"@solidjs/router\";\r\nimport styles from '../styles';\r\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\r\nimport {\r\n  playVideo,\r\n  closeVideo,\r\n  backwardTime,\r\n  forwardTime,\r\n  upControls,\r\n  downControls\r\n} from '../../main-video';\r\n\r\nexport default function TiviPage(_props: any) {\r\n  const isFirst = createSelector(() => {\r\n    return 0;\r\n  });\r\n  const [backdropAlpha, setBackdropAlpha] = createSignal(0);\r\n  const [isPlayVideo, setIsPlayVideo] = createSignal(0);\r\n  let lastFocused;\r\n\r\n  function onEnter(this: ElementNode) {\r\n    let entity = this.children.selected;\r\n    if (isPlayVideo()) {\r\n      return;\r\n    }\r\n    assertTruthy(entity && entity.id);\r\n    playVideo(entity.url);\r\n    setBackdropAlpha(0.9);\r\n    setIsPlayVideo(1);\r\n    videoRef.setFocus()\r\n    lastFocused = activeElement();\r\n  };\r\n\r\n  function onEscape()  {\r\n    closeVideo();\r\n    setBackdropAlpha(0);\r\n    setIsPlayVideo(0);\r\n    setTimeout(() => {\r\n      lastFocused.setFocus();\r\n    }, 10);\r\n  };\r\n\r\n  const demos = [\r\n    {\r\n      title: 'Streaming Test',\r\n      id: 'vod',\r\n      url: 'https://live-par-2-cdn-alt.livepush.io/live/bigbuckbunnyclip/index.m3u8',\r\n      description: 'Streaming Implementation',\r\n    },\r\n    {\r\n      title: 'Bunny Video',\r\n      id: 'bunny',\r\n      url: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',\r\n      description: 'VoD Implementation',\r\n    }\r\n  ]\r\n\r\n  function DemoTile(props) {\r\n    const Container = {\r\n      width: 370,\r\n      height: 320,\r\n      borderRadius: 6,\r\n      scale: 1,\r\n      color: 0x182b44ff,\r\n      focus: {\r\n        scale: 1.1,\r\n        color: 0xffffffff,\r\n      },\r\n    };\r\n    const [color, setColor] = createSignal(0xffffffff);\r\n\r\n    return <View {...props} onFocus={() => setColor(0x000000ff)} onBlur={() => setColor(0xffffffff)} animate style={Container}>\r\n      <View x={30}>\r\n        <Text y={30} fontSize={84} color={color()}>{props.index + 1}</Text>\r\n        <Text y={140} fontSize={42} width={340} height={42} contain=\"both\" color={color()}>{props.title}</Text>\r\n        <Text y={200} fontSize={28} width={330} contain=\"width\" color={color()}>{props.description}</Text>\r\n      </View>    \r\n    </View>\r\n  }\r\n\r\n  const [rowX, setRowX] = createSignal(140);\r\n\r\n  function onSelectedChanged(row) {\r\n    if (isPlayVideo()) {\r\n      videoRef.setFocus()\r\n    }\r\n    // slip row\r\n    // setRowX(row.selected * -400 + 140);\r\n  }\r\n\r\n  let videoRef;\r\n\r\n  createEffect(on(activeElement, (elm) => {\r\n    if (isPlayVideo()) {\r\n      videoRef.setFocus()\r\n    }\r\n  }, { defer: true}))\r\n\r\n  const videoLeft = () => {\r\n    if (isPlayVideo()) {\r\n      backwardTime();\r\n    }\r\n  }\r\n\r\n  const videoRight = () => {\r\n    if (isPlayVideo()) {\r\n      forwardTime();\r\n    }\r\n  }\r\n\r\n  const videoRUp = () => {\r\n    if (isPlayVideo()) {\r\n      upControls();\r\n    }\r\n  }\r\n\r\n  const videoDown = () => {\r\n    if (isPlayVideo()) {\r\n      downControls();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <View colorTop={0x446b9eff} colorBottom={0x2c4f7cff} onEscape={onEscape}>\r\n      <View x={120}>\r\n        <Text fontSize={90} x={110} y={40}>Videos</Text>\r\n        <View y={140} height={1} width={1800} color={0xe8d7f9ff} />\r\n\r\n      </View>\r\n      <Row onSelectedChanged={onSelectedChanged} onEnter={onEnter}\r\n        animationSettings={{delay: 20, duration: 300}}\r\n        animate x={rowX()} y={300} width={4400} style={styles.Row} justifyContent={'flexStart'} gap={40}>\r\n        <For each={demos}>\r\n            {(demo, i) =>\r\n              <DemoTile skipFocus={isPlayVideo()} autofocus={isFirst(i())} index={i()} {...demo}/>\r\n            }\r\n        </For>\r\n        <View\r\n          y={240}\r\n          height={10}\r\n          width={10}\r\n          color={0xe8d7f9ff}\r\n          onLeft={videoLeft}\r\n          onRight={videoRight}\r\n          onUp={videoRUp}\r\n          onDown={videoDown}\r\n          ref={videoRef}\r\n          skipFocus\r\n        />\r\n      </Row>\r\n      <View alpha={backdropAlpha()} color={hexColor('#000000')}  zIndex={200} />\r\n    </View>\r\n  );\r\n}\r\n","import { Text, View } from \"@lightningjs/solid\";\r\n\r\nexport default () => {\r\n  return (\r\n    <View style={{ width: 1920, height: 1080, color: 0x33c40000 }} >\r\n       <Text >Not Found</Text>\r\n    </View>\r\n   \r\n  );\r\n};\r\n","import api from '..';\r\nimport { convertItemsToTiles, chunkArray } from '../formatters/ItemFormatter';\r\n\r\nlet cache = new Map();\r\nconst leftoverTiles = new Map();\r\n\r\nexport default function (filter: string, size?: number) {\r\n  return (pageIndex: number): Promise<any> => {\r\n    const url = `/trending/${filter}/week?page=${pageIndex}`;\r\n    if (cache.has(url)) {\r\n      return cache.get(url);\r\n    }\r\n\r\n    const sizePage = size ? size : 7;\r\n\r\n    let result = api.get(url).then((trending) => {\r\n      let results = trending.results.filter((r) => !r.adult);\r\n      let tiles = (leftoverTiles.has(filter) ? leftoverTiles.get(filter) : []).concat(convertItemsToTiles(results));\r\n      let chunks = chunkArray(tiles, sizePage);\r\n      if (chunks[chunks.length - 1].length < sizePage) {\r\n        leftoverTiles.set(filter, chunks.pop());\r\n      } else {\r\n        leftoverTiles.delete(filter);\r\n      }\r\n      return chunks;\r\n    });\r\n\r\n    cache.set(url, result);\r\n    return result;\r\n  }\r\n}\r\n","import { View, Text, Show, IntrinsicNodeStyleProps, For } from '@lightningjs/solid';\r\nimport { withPadding } from '@lightningjs/solid-primitives';\r\nimport theme from 'theme';\r\nwithPadding;\r\n\r\nconst blockWidth = 1100;\r\nconst HeadlineStyles = {\r\n  ...theme.typography.display2,\r\n  width: blockWidth,\r\n  height: 58,\r\n  contain: 'both',\r\n};\r\nconst Headline = (props) => (\r\n  <Text {...props} style={HeadlineStyles}>\r\n    {props.children}\r\n  </Text>\r\n);\r\n\r\nconst DescriptionStyles = {\r\n  ...theme.typography.body1,\r\n  width: blockWidth,\r\n  height: 72,\r\n  contain: 'both',\r\n};\r\n\r\nconst BadgeStyle = {\r\n  fontSize: 20,\r\n  lineHeight: 20,\r\n};\r\n\r\nconst Description = (props) => (\r\n  <Text {...props} style={DescriptionStyles}>\r\n    {props.children}\r\n  </Text>\r\n);\r\n\r\nfunction getReviews(reviews) {\r\n  return (\r\n    <>\r\n      <Show when={reviews?.rtCrit && reviews?.rtCrit !== '0'}>\r\n        <View\r\n          src=\"https://upload.wikimedia.org/wikipedia/commons/b/b6/Tomato-Torrent-Icon.png\"\r\n          title=\"Rotten Tomatoes Rating\"\r\n          style={{ width: 30, height: 30, marginRight: -6 }}\r\n        />\r\n        <Text style={MetaTextStyle}>{reviews.rtCrit + '%'}</Text>\r\n      </Show>\r\n      <Show when={reviews?.rtFan && reviews?.rtFan !== '0'}>\r\n        <View\r\n          src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Rotten_Tomatoes_positive_audience.svg/80px-Rotten_Tomatoes_positive_audience.svg.png\"\r\n          title=\"Rotten Tomatoes Rating\"\r\n          style={{ width: 24, height: 30, marginRight: -6 }}\r\n        />\r\n        <Text style={MetaTextStyle}>{reviews.rtFan + '%'}</Text>\r\n      </Show>\r\n    </>\r\n  );\r\n}\r\n\r\nconst Badge = (props) => {\r\n  return (\r\n    <node\r\n      use:withPadding={[8, 15, 13, 15]}\r\n      {...props}\r\n      style={{\r\n        color: '0x00000099',\r\n        borderRadius: 8,\r\n        border: { width: 3, color: '0xffffffff' },\r\n      }}\r\n    >\r\n      <Text style={BadgeStyle}>{props.children}</Text>\r\n    </node>\r\n  );\r\n};\r\n\r\nconst MetaTextStyle = theme.typography.body2;\r\n\r\nconst Metadata = (props) => (\r\n  <View\r\n    style={{\r\n      ...theme.flexRow as IntrinsicNodeStyleProps,\r\n      gap: 12,\r\n      width: blockWidth,\r\n      height: 48,\r\n    }}\r\n  >\r\n    <Text style={MetaTextStyle}>{props.metaText}</Text>\r\n    <For each={props.badges}>{(item) => <Badge y={-5}>{item}</Badge>}</For>\r\n    {getReviews(props.reviews)}\r\n  </View>\r\n);\r\n\r\nconst ContentBlock = (props) => {\r\n  console.log('badges', props.badges)\r\n  return <View\r\n      {...props}\r\n      style={{\r\n        ...theme.flexColumn,\r\n        width: blockWidth,\r\n        height: 160,\r\n        gap: 16,\r\n      }}\r\n    >\r\n      <Headline>{props.title}</Headline>\r\n      <Description>{props.description}</Description>\r\n      <Metadata\r\n        metaText={props.metaText}\r\n        badges={props.badges}\r\n        reviews={props.reviews}\r\n      />\r\n    </View>;\r\n};\r\n\r\nexport default ContentBlock;\r\n","import api, { getImageUrl } from '..';\r\nimport { convertItemsToTiles } from '../formatters/ItemFormatter';\r\n\r\nexport function minutesToHMM(minutes) {\r\n  const hours = Math.floor(minutes / 60);\r\n  const remainingMinutes = minutes % 60;\r\n  return hours + 'h ' + (remainingMinutes < 10 ? '0' : '') + remainingMinutes + 'm';\r\n}\r\n\r\nfunction justYear(dateString) {\r\n  const parts = dateString.split(\"-\");\r\n  return parts[0];\r\n}\r\n\r\nexport function getRecommendations({type, id}) {\r\n  return api.get(`/${type}/${id}/recommendations`).then(\r\n    ({ results }) => {\r\n      if (results.length) {\r\n        return convertItemsToTiles(results.slice(0, 7));\r\n      }\r\n      return api.get(`/trending/${type}/week?page=1`).then(\r\n        ({ results }) => convertItemsToTiles(results.slice(0, 7)));\r\n    }\r\n  );\r\n}\r\n\r\nexport function getCredits({type, id}) {\r\n  return api.get(`/${type}/${id}/credits`).then(\r\n    ({ cast }) => convertItemsToTiles(cast.slice(0, 7))\r\n  );\r\n}\r\n\r\nexport function getInfo({type, id}) {\r\n  let rt = type === 'movie' ? {\r\n    rtCrit: 86,\r\n    rtFan: 92\r\n  } : {};\r\n\r\n  return api.get(`/${type}/${id}`).then(\r\n    (data) => ({\r\n      backgroundImage: getImageUrl(data.backdrop_path, 'original'),\r\n      heroContent: {\r\n        title: data.title || data.name,\r\n        description: data.overview,\r\n        badges: ['HD'],\r\n        metaText: type === 'movie' ?\r\n          minutesToHMM(data.runtime) + ' - ' + data.release_date : `${justYear(data.first_air_date)} - ${justYear(data.last_air_date)}`,\r\n        reviews: rt,\r\n      },\r\n      ...data\r\n    }));\r\n}\r\n","import { IntrinsicNodeStyleProps, deg2rad, hexColor } from \"@lightningjs/solid\";\r\nimport theme from \"theme\";\r\n\r\nexport default {\r\n    Row: {\r\n        display: 'flex',\r\n        justifyContent: 'spaceBetween',\r\n        height: 300,\r\n      } satisfies IntrinsicNodeStyleProps,\r\n      Column: {\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        justifyContent: 'flexStart',\r\n        gap: 15,\r\n        width: theme.layout.screenW - (2 * theme.layout.marginX),\r\n        x: theme.layout.marginX + theme.layout.gutterX,\r\n        y: 100,\r\n        zIndex: 2\r\n      } satisfies IntrinsicNodeStyleProps,\r\n      itemsContainer: {\r\n        width: theme.layout.screenW,\r\n        height: 600,\r\n        y: 350,\r\n        x: 0,\r\n        zIndex: 2,\r\n      } satisfies IntrinsicNodeStyleProps,\r\n};\r\n","import {\r\n  IntrinsicNodeProps,\r\n  View,\r\n  Text,\r\n  ElementNode,\r\n  activeElement,\r\n  hexColor,\r\n} from \"@lightningjs/solid\";\r\nimport styles from \"./ListColumn.style\";\r\nimport { For, createEffect, createSelector, on } from \"solid-js\";\r\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\r\nimport { FocusRing, TileRow } from \"..\";\r\nimport theme from \"theme\";\r\nimport { Column } from \"@lightningjs/solid-primitives\";\r\nexport default function ListColumn(props: IntrinsicNodeProps) {\r\n  console.log(props.type);\r\n  let focusRingRef;\r\n  const isFirst = createSelector(() => {\r\n    return 0;\r\n  });\r\n\r\n  // console.log('props',props)\r\n  return (\r\n    <View clipping style={styles.itemsContainer}>\r\n      <Column\r\n        plinko\r\n        announce=\"All Trending - Week\"\r\n        animate\r\n        y={props.y}\r\n        style={styles.Column}\r\n      >\r\n        <For each={props?.data || []}>\r\n          {(items, i) => (\r\n            <TileRow\r\n              autofocus={isFirst(i())}\r\n              justifyContent={\"flexStart\"}\r\n              items={items}\r\n              onFocus={props.onFocus}\r\n              onEnter={props.onEnter}\r\n            />\r\n          )}\r\n        </For>\r\n      </Column>\r\n    </View>\r\n  );\r\n}\r\n","import { IntrinsicNodeStyleProps, deg2rad, hexColor } from \"@lightningjs/solid\";\r\nimport theme from \"theme\";\r\n\r\nexport default {\r\n  NotifiWrapper: {\r\n    borderRadius: 3,\r\n    width: 250,\r\n    height: 50,\r\n    scale: 1,\r\n    zIndex: 9999,\r\n    color: hexColor(\"#ffffff\"),\r\n    alpha: 0.5,\r\n    x: 0,\r\n    y: 1030,\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  NotifiText: {\r\n    zIndex: 1,\r\n    fontSize: 16,\r\n    color: hexColor(\"#ffffff\"),\r\n    height: 30,\r\n    y: 15,\r\n    x: 15,\r\n    break: true,\r\n    position: 'none'\r\n\r\n  } satisfies IntrinsicNodeStyleProps,\r\n\r\n  FocusRing: {\r\n    borderRadius: 0,\r\n     y: -2, x: -2, zIndex: -1,\r\n    color: hexColor(\"#ffffff\")\r\n  } satisfies IntrinsicNodeStyleProps,\r\n};\r\n","import {\r\n  IntrinsicNodeProps,\r\n  View,\r\n  Text,\r\n  ElementNode,\r\n  activeElement,\r\n  hexColor,\r\n} from \"@lightningjs/solid\";\r\nimport styles from \"./Thumnail.styles\";\r\nimport { Show, createEffect, on } from \"solid-js\";\r\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\r\nimport { FocusRing } from \"..\";\r\nimport theme from \"theme\";\r\nexport default function Notification(props: IntrinsicNodeProps) {\r\n  let focusRingRef;\r\n  createEffect(\r\n    on(\r\n      activeElement,\r\n      (elm) => {\r\n        assertTruthy(elm);\r\n        setTimeout(() => {\r\n          console.log(\"elm\", elm);\r\n          // if (elm.heroContent) {\r\n          //   focusRingRef.parent = elm.parent;\r\n          //   focusRingRef.alpha = 1;\r\n          //   focusRingRef.scale = 1;\r\n          //   focusRingRef.x = elm.x! - 1.5;\r\n          //   focusRingRef.y = elm.y! - 1.5;\r\n          //   focusRingRef.width = elm.width! + 1.5;\r\n          //   focusRingRef.height = elm.height! + 1.5;\r\n          //   focusRingRef.createAnimation({ scale: 1.03}).start();\r\n          //   // focusRingRef.zIndex = (elm.zIndex! - 0.00000001);\r\n          // } else {\r\n          //   focusRingRef.alpha = 0;\r\n          // }\r\n        }, 10);\r\n      },\r\n      { defer: true }\r\n    )\r\n  );\r\n  function onRowFocus(this: ElementNode) {\r\n    this.children.selected?.setFocus();\r\n  }\r\n\r\n  // console.log('props',props)\r\n  return (\r\n    <Show when={props.isOpen}>\r\n      <View {...props} animate style={styles.NotifiWrapper}>\r\n        <Text style={styles.NotifiText}>{props?.message || ''}</Text>\r\n      </View>\r\n    </Show>\r\n  );\r\n}\r\n","import {\r\n  createEffect,\r\n  createMemo,\r\n  on,\r\n  createSignal,\r\n  Show,\r\n  createResource,\r\n  createSelector,\r\n  For,\r\n  onMount,\r\n} from \"solid-js\";\r\nimport { ElementNode, View, activeElement } from \"@lightningjs/solid\";\r\nimport { Column } from \"@lightningjs/solid-primitives\";\r\nimport { useNavigate, useParams } from \"@solidjs/router\";\r\nimport { Button, TileRow } from \"../components\";\r\nimport styles from \"../styles\";\r\nimport { setGlobalBackground } from \"../state\";\r\nimport browseProvider from \"../api/providers/browse\";\r\nimport { createInfiniteScroll } from \"../components/pagination\";\r\nimport ContentBlock from \"../components/ContentBlock\";\r\nimport * as entityProvider from \"../api/providers/entity\";\r\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\r\nimport ListColumn from \"../components/ListColumn\";\r\nimport ListSlider from \"../components/ListSlider\";\r\nimport Notification from \"../components/Notification\";\r\nimport theme from 'theme';\r\n\r\nconst Browse = () => {\r\n  const params = useParams();\r\n  const [columnY, setcolumnY] = createSignal(0);\r\n  const [entityInfo, setEntityInfo] = createSignal();\r\n  const [entityData] = createResource(entityInfo, entityProvider.getInfo);\r\n  const [heroContent, setHeroContent] = createSignal({});\r\n  const navigate = useNavigate();\r\n  \r\n  const [isOpenNotification, setNotification] = createSignal(false);\r\n  const isFirst = createSelector(() => {\r\n    return 0;\r\n  });\r\n  let navDrawer, lastFocused, buttonNoti;\r\n\r\n  const provider = createMemo(() => {\r\n    return createInfiniteScroll(browseProvider(params.filter || \"all\", 8));\r\n  });\r\n  createEffect(\r\n    on(\r\n      activeElement,\r\n      (elm) => {\r\n        if (elm.backdrop) {\r\n          setGlobalBackground(elm.backdrop);\r\n        }\r\n        // if (elm.entityInfo) {\r\n        //   setEntityInfo(elm.entityInfo);\r\n        // }\r\n        if (elm.heroContent) {\r\n          setHeroContent(elm.heroContent);\r\n        }\r\n      },\r\n      { defer: true }\r\n    )\r\n  );\r\n  function showNotification() {\r\n    console.log('sgdsjgdisdishdoshdoish')\r\n    setNotification(true)\r\n  }\r\n\r\n  function onRowFocus(this: ElementNode) {\r\n    this.children.selected?.setFocus();\r\n    setcolumnY((this.y || 0) * -1 + 24);\r\n    let numPages = provider().pages().length;\r\n    if (this.parent) {\r\n      if (\r\n        numPages === 0 ||\r\n        (this.parent.selected && this.parent.selected >= numPages - 2)\r\n      ) {\r\n        provider().setPage((p) => p + 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  function onEnter(this: ElementNode) {\r\n    let entity = this.children.selected;\r\n    assertTruthy(entity && entity.href);\r\n    navigate(entity.href);\r\n  }\r\n\r\n  return (\r\n    <View>\r\n      <Show when={provider().pages().length}>\r\n        <ContentBlock y={150} x={90} {...heroContent()}></ContentBlock>\r\n        <ListColumn\r\n          type=\"sliderList\"\r\n          onEnter={onEnter}\r\n          onFocus={onRowFocus}\r\n          data={provider().pages()}\r\n          y={columnY()}\r\n        />\r\n        {/* <ListSlider x={90} y={450} onEnter={onEnter} data={[...provider().pages()[0]]}/> */}\r\n      </Show>\r\n      <Button\r\n        autofocus\r\n        ref={buttonNoti}\r\n        onRight={() => {\r\n          if (buttonNoti.states.has(\"focus\")) {\r\n            return false;\r\n          }\r\n          lastFocused = activeElement();\r\n          buttonNoti.setFocus();\r\n        }}\r\n        x={100}\r\n        onEnter={showNotification}\r\n      >\r\n        Enter to show notification\r\n      </Button>\r\n      <Notification\r\n        isOpen={isOpenNotification()}\r\n        message={\"You have an notification! \"}\r\n      />\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default Browse;\r\n","import { IntrinsicNodeStyleProps, deg2rad, hexColor } from \"@lightningjs/solid\";\r\nimport theme from \"theme\";\r\n\r\nexport default {\r\n  Row: {\r\n    display: \"flex\",\r\n    justifyContent: \"spaceBetween\",\r\n    height: 290,\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  Column: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    justifyContent: \"flexStart\",\r\n    gap: 10,\r\n    width: theme.layout.screenW - 2 * theme.layout.marginX,\r\n    x: theme.layout.marginX + theme.layout.gutterX,\r\n    y: 100,\r\n    zIndex: 2,\r\n  } satisfies IntrinsicNodeStyleProps,\r\n  itemsContainer: {\r\n    width: theme.layout.screenW,\r\n    height: 600,\r\n    y: 350,\r\n    x: 0,\r\n    zIndex: 2,\r\n  } satisfies IntrinsicNodeStyleProps,\r\n};\r\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class StageUtils {\n\n    static mergeNumbers(v1, v2, p) {\n        return v1 * p + v2 * (1 - p);\n    };\n\n    static rgb(r, g, b) {\n        return (r << 16) + (g << 8) + b + (255 * 16777216);\n    };\n\n    static rgba(r, g, b, a) {\n        return (r << 16) + (g << 8) + b + (((a * 255) | 0) * 16777216);\n    };\n\n    static getRgbString(color) {\n        let r = ((color / 65536) | 0) % 256;\n        let g = ((color / 256) | 0) % 256;\n        let b = color % 256;\n        return 'rgb(' + r + ',' + g + ',' + b + ')';\n    };\n\n    static getRgbaString(color) {\n        let r = ((color / 65536) | 0) % 256;\n        let g = ((color / 256) | 0) % 256;\n        let b = color % 256;\n        let a = ((color / 16777216) | 0) / 255;\n        return 'rgba(' + r + ',' + g + ',' + b + ',' + a.toFixed(4) + ')';\n    };\n\n    static getRgbaStringFromArray(color) {\n        let r = Math.floor(color[0] * 255);\n        let g = Math.floor(color[1] * 255);\n        let b = Math.floor(color[2] * 255);\n        let a = Math.floor(color[3] * 255) / 255;\n        return 'rgba(' + r + ',' + g + ',' + b + ',' + a.toFixed(4) + ')';\n    };\n\n    static getRgbaComponentsNormalized(argb) {\n        let r = ((argb / 65536) | 0) % 256;\n        let g = ((argb / 256) | 0) % 256;\n        let b = argb % 256;\n        let a = ((argb / 16777216) | 0);\n        return [r / 255, g / 255, b / 255, a / 255];\n    };\n\n    static getRgbComponentsNormalized(argb) {\n        let r = ((argb / 65536) | 0) % 256;\n        let g = ((argb / 256) | 0) % 256;\n        let b = argb % 256;\n        return [r / 255, g / 255, b / 255];\n    };\n\n    static getRgbaComponents(argb) {\n        let r = ((argb / 65536) | 0) % 256;\n        let g = ((argb / 256) | 0) % 256;\n        let b = argb % 256;\n        let a = ((argb / 16777216) | 0);\n        return [r, g, b, a];\n    };\n\n    static getArgbNumber(rgba) {\n        rgba[0] = Math.max(0, Math.min(255, rgba[0]));\n        rgba[1] = Math.max(0, Math.min(255, rgba[1]));\n        rgba[2] = Math.max(0, Math.min(255, rgba[2]));\n        rgba[3] = Math.max(0, Math.min(255, rgba[3]));\n        let v = ((rgba[3] | 0) << 24) + ((rgba[0] | 0) << 16) + ((rgba[1] | 0) << 8) + (rgba[2] | 0);\n        if (v < 0) {\n            v = 0xFFFFFFFF + v + 1;\n        }\n        return v;\n    };\n\n    static mergeColors(c1, c2, p) {\n        let r1 = ((c1 / 65536) | 0) % 256;\n        let g1 = ((c1 / 256) | 0) % 256;\n        let b1 = c1 % 256;\n        let a1 = ((c1 / 16777216) | 0);\n\n        let r2 = ((c2 / 65536) | 0) % 256;\n        let g2 = ((c2 / 256) | 0) % 256;\n        let b2 = c2 % 256;\n        let a2 = ((c2 / 16777216) | 0);\n\n        let r = r1 * p + r2 * (1 - p);\n        let g = g1 * p + g2 * (1 - p);\n        let b = b1 * p + b2 * (1 - p);\n        let a = a1 * p + a2 * (1 - p);\n\n        return Math.round(a) * 16777216 + Math.round(r) * 65536 + Math.round(g) * 256 + Math.round(b);\n    };\n\n    static mergeMultiColors(c, p) {\n        let r = 0, g = 0, b = 0, a = 0, t = 0;\n        let n = c.length;\n        for (let i = 0; i < n; i++) {\n            let r1 = ((c[i] / 65536) | 0) % 256;\n            let g1 = ((c[i] / 256) | 0) % 256;\n            let b1 = c[i] % 256;\n            let a1 = ((c[i] / 16777216) | 0);\n            r += r1 * p[i];\n            g += g1 * p[i];\n            b += b1 * p[i];\n            a += a1 * p[i];\n            t += p[i];\n        }\n\n        t = 1 / t;\n        return Math.round(a * t) * 16777216 + Math.round(r * t) * 65536 + Math.round(g * t) * 256 + Math.round(b * t);\n    };\n\n    static mergeMultiColorsEqual(c) {\n        let r = 0, g = 0, b = 0, a = 0, t = 0;\n        let n = c.length;\n        for (let i = 0; i < n; i++) {\n            let r1 = ((c[i] / 65536) | 0) % 256;\n            let g1 = ((c[i] / 256) | 0) % 256;\n            let b1 = c[i] % 256;\n            let a1 = ((c[i] / 16777216) | 0);\n            r += r1;\n            g += g1;\n            b += b1;\n            a += a1;\n            t += 1.0;\n        }\n\n        t = 1 / t;\n        return Math.round(a * t) * 16777216 + Math.round(r * t) * 65536 + Math.round(g * t) * 256 + Math.round(b * t);\n    };\n\n    static mergeColorAlpha(c, alpha) {\n        let a = ((c / 16777216 | 0) * alpha) | 0;\n        return (((((c >> 16) & 0xff) * a) / 255) & 0xff) +\n            ((((c & 0xff00) * a) / 255) & 0xff00) +\n            (((((c & 0xff) << 16) * a) / 255) & 0xff0000) +\n            (a << 24);\n    };\n\n    static rad(deg) {\n        return deg * (Math.PI / 180);\n    };\n\n    static getTimingBezier(a, b, c, d) {\n        let xc = 3.0 * a;\n        let xb = 3.0 * (c - a) - xc;\n        let xa = 1.0 - xc - xb;\n        let yc = 3.0 * b;\n        let yb = 3.0 * (d - b) - yc;\n        let ya = 1.0 - yc - yb;\n\n        return function (time) {\n            if (time >= 1.0) {\n                return 1;\n            }\n            if (time <= 0) {\n                return 0;\n            }\n\n            let t = 0.5, cbx, cbxd, dx;\n\n            for (let it = 0; it < 20; it++) {\n                cbx = t * (t * (t * xa + xb) + xc);\n                dx = time - cbx;\n                if (dx > -1e-8 && dx < 1e-8) {\n                    return t * (t * (t * ya + yb) + yc);\n                }\n\n                // Cubic bezier derivative.\n                cbxd = t * (t * (3 * xa) + 2 * xb) + xc;\n\n                if (cbxd > 1e-10 && cbxd < 1e-10) {\n                    // Problematic. Fall back to binary search method.\n                    break;\n                }\n\n                t += dx / cbxd;\n            }\n\n            // Fallback: binary search method. This is more reliable when there are near-0 slopes.\n            let minT = 0;\n            let maxT = 1;\n            for (let it = 0; it < 20; it++) {\n                t = 0.5 * (minT + maxT);\n\n                cbx = t * (t * (t * xa + xb) + xc);\n\n                dx = time - cbx;\n                if (dx > -1e-8 && dx < 1e-8) {\n                    // Solution found!\n                    return t * (t * (t * ya + yb) + yc);\n                }\n\n                if (dx < 0) {\n                    maxT = t;\n                } else {\n                    minT = t;\n                }\n            }\n\n        };\n    };\n\n    static getTimingFunction(str) {\n        switch (str) {\n            case \"linear\":\n                return function (time) {\n                    return time\n                };\n            case \"ease\":\n                return StageUtils.getTimingBezier(0.25, 0.1, 0.25, 1.0);\n            case \"ease-in\":\n                return StageUtils.getTimingBezier(0.42, 0, 1.0, 1.0);\n            case \"ease-out\":\n                return StageUtils.getTimingBezier(0, 0, 0.58, 1.0);\n            case \"ease-in-out\":\n                return StageUtils.getTimingBezier(0.42, 0, 0.58, 1.0);\n            case \"step-start\":\n                return function () {\n                    return 1\n                };\n            case \"step-end\":\n                return function (time) {\n                    return time === 1 ? 1 : 0;\n                };\n            default:\n                let s = \"cubic-bezier(\";\n                if (str && str.indexOf(s) === 0) {\n                    let parts = str.substr(s.length, str.length - s.length - 1).split(\",\");\n                    if (parts.length !== 4) {\n                        console.warn(\"[Lightning] Unknown timing function: \" + str);\n\n                        // Fallback: use linear.\n                        return function (time) {\n                            return time\n                        };\n                    }\n                    let a = parseFloat(parts[0]);\n                    let b = parseFloat(parts[1]);\n                    let c = parseFloat(parts[2]);\n                    let d = parseFloat(parts[3]);\n                    if (isNaN(a) || isNaN(b) || isNaN(c) || isNaN(d)) {\n                        console.warn(\"[Lightning] Unknown timing function: \" + str);\n                        // Fallback: use linear.\n                        return function (time) {\n                            return time\n                        };\n                    }\n\n                    return StageUtils.getTimingBezier(a, b, c, d);\n                } else {\n                    console.warn(\"[Lightning] Unknown timing function: \" + str);\n                    // Fallback: use linear.\n                    return function (time) {\n                        return time\n                    };\n                }\n        }\n    };\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class Utils {\n\n    static isFunction(value) {\n        return typeof value === 'function';\n    }\n\n    static isNumber(value) {\n        return typeof value === 'number';\n    }\n\n    static isInteger(value) {\n        return (typeof value === 'number' && (value % 1) === 0);\n    }\n\n    static isBoolean(value) {\n        return value === true || value === false;\n    }\n\n    static isString(value) {\n        return typeof value === 'string';\n    }\n\n    static clone(v) {\n        if (Utils.isObjectLiteral(v) || Array.isArray(v)) {\n            return Utils.getDeepClone(v);\n        } else {\n            // Copy by value.\n            return v;\n        }\n    }\n\n    static cloneObjShallow(obj) {\n        let keys = Object.keys(obj);\n        let clone = {}\n        for (let i = 0; i < keys.length; i++) {\n            clone[keys[i]] = obj[keys[i]];\n        }\n        return clone;\n    }\n\n    static merge(obj1, obj2) {\n        let keys = Object.keys(obj2);\n        for (let i = 0; i < keys.length; i++) {\n            obj1[keys[i]] = obj2[keys[i]];\n        }\n        return obj1;\n    }\n\n    static isObject(value) {\n        let type = typeof value;\n        return !!value && (type === 'object' || type === 'function');\n    }\n\n    static isPlainObject(value) {\n        let type = typeof value;\n        return !!value && (type === 'object');\n    }\n\n    static isObjectLiteral(value){\n        return typeof value === 'object' && value && value.constructor === Object;\n    }\n\n    static getArrayIndex(index, arr) {\n        return Utils.getModuloIndex(index, arr.length);\n    }\n\n    static getModuloIndex(index, len) {\n        if (len === 0) return index;\n        while (index < 0) {\n            index += Math.ceil(-index / len) * len;\n        }\n        index = index % len;\n        return index;\n    }\n\n    static getDeepClone(obj) {\n        let i, c;\n        if (Utils.isFunction(obj)) {\n            // Copy functions by reference.\n            return obj;\n        }\n        if (Array.isArray(obj)) {\n            c = [];\n            let keys = Object.keys(obj);\n            for (i = 0; i < keys.length; i++) {\n                c[keys[i]] = Utils.getDeepClone(obj[keys[i]]);\n            }\n            return c;\n        } else if (Utils.isObject(obj)) {\n            c = {}\n            let keys = Object.keys(obj);\n            for (i = 0; i < keys.length; i++) {\n                c[keys[i]] = Utils.getDeepClone(obj[keys[i]]);\n            }\n            return c;\n        } else {\n            return obj;\n        }\n    }\n\n    static equalValues(v1, v2) {\n        if ((typeof v1) !== (typeof v2)) return false;\n        if (Utils.isObjectLiteral(v1)) {\n            return Utils.isObjectLiteral(v2) && Utils.equalObjectLiterals(v1, v2);\n        } else if (Array.isArray(v1)) {\n            return Array.isArray(v2) && Utils.equalArrays(v1, v2);\n        } else {\n            return v1 === v2;\n        }\n    }\n\n    static equalObjectLiterals(obj1, obj2) {\n        let keys1 = Object.keys(obj1);\n        let keys2 = Object.keys(obj2);\n        if (keys1.length !== keys2.length) {\n            return false;\n        }\n\n        for (let i = 0, n = keys1.length; i < n; i++) {\n            const k1 = keys1[i];\n            const k2 = keys2[i];\n            if (k1 !== k2) {\n                return false;\n            }\n\n            const v1 = obj1[k1];\n            const v2 = obj2[k2];\n\n            if (!Utils.equalValues(v1, v2)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    static equalArrays(v1, v2) {\n        if (v1.length !== v2.length) {\n            return false;\n        }\n        for (let i = 0, n = v1.length; i < n; i++) {\n            if (!this.equalValues(v1[i], v2[i])) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    static setToArray(s) {\n        let result = [];\n        s.forEach(function (value) {\n            result.push(value);\n        });\n        return result;\n    }\n\n    static iteratorToArray(iterator) {\n        let result = [];\n        let iteratorResult = iterator.next();\n        while (!iteratorResult.done) {\n            result.push(iteratorResult.value);\n            iteratorResult = iterator.next();\n        }\n        return result;\n    }\n\n    static isUcChar(charcode) {\n        return charcode >= 65 && charcode <= 90;\n    }\n\n}\n\nUtils.isWeb = (typeof window !== \"undefined\") && (typeof sparkscene === \"undefined\");\nUtils.isWPE = Utils.isWeb && (navigator.userAgent.indexOf(\"WPE\") !== -1);\nUtils.isSpark = (typeof sparkscene !== \"undefined\");\nUtils.isNode = (typeof window === \"undefined\") || Utils.isSpark;\nUtils.isPS4 = Utils.isWeb && (navigator.userAgent.indexOf(\"PlayStation 4\") !== -1);\nUtils.isZiggo = Utils.isWeb && (navigator.userAgent.indexOf(\"EOSSTB\") !== -1 || navigator.userAgent.indexOf(\"HZNSTB\") !== -1);\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class Base {\n\n    static defaultSetter(obj, name, value) {\n        obj[name] = value;\n    }\n\n    static patchObject(obj, settings) {\n        if (!Utils.isObjectLiteral(settings)) {\n            console.error(\"[Lightning] Settings must be object literal\");\n        } else {\n            let names = Object.keys(settings);\n            for (let i = 0, n = names.length; i < n; i++) {\n                let name = names[i];\n\n                this.patchObjectProperty(obj, name, settings[name]);\n            }\n        }\n    }\n\n    static patchObjectProperty(obj, name, value) {\n        let setter = obj.setSetting || Base.defaultSetter;\n\n        if (name.charAt(0) === \"_\") {\n            // Disallow patching private variables.\n            if (name !== \"__create\") {\n                console.error(\"[Lightning] Patch of private property '\" + name + \"' is not allowed\");\n            }\n        } else if (name !== \"type\") {\n            // Type is a reserved keyword to specify the class type on creation.\n            if (Utils.isFunction(value) && value.__local) {\n                // Local function (Base.local(s => s.something))\n                value = value.__local(obj);\n            }\n\n            setter(obj, name, value);\n        }\n    }\n\n    static local(func) {\n        // This function can be used as an object setting, which is called with the target object.\n        func.__local = true;\n    }\n\n\n}\n\nimport Utils from \"./Utils.mjs\";\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class SpacingCalculator {\n\n    static getSpacing(mode, numberOfItems, remainingSpace) {\n        const itemGaps = (numberOfItems - 1);\n        let spacePerGap;\n\n        let spacingBefore, spacingBetween;\n\n        switch(mode) {\n            case \"flex-start\":\n                spacingBefore = 0;\n                spacingBetween = 0;\n                break;\n            case \"flex-end\":\n                spacingBefore = remainingSpace;\n                spacingBetween = 0;\n                break;\n            case \"center\":\n                spacingBefore = remainingSpace / 2;\n                spacingBetween = 0;\n                break;\n            case \"space-between\":\n                spacingBefore = 0;\n                spacingBetween = Math.max(0, remainingSpace) / itemGaps;\n                break;\n            case \"space-around\":\n                if (remainingSpace < 0) {\n                    return this.getSpacing(\"center\", numberOfItems, remainingSpace);\n                } else {\n                    spacePerGap = remainingSpace / (itemGaps + 1);\n                    spacingBefore = 0.5 * spacePerGap;\n                    spacingBetween = spacePerGap;\n                }\n                break;\n            case \"space-evenly\":\n                if (remainingSpace < 0) {\n                    return this.getSpacing(\"center\", numberOfItems, remainingSpace);\n                } else {\n                    spacePerGap = remainingSpace / (itemGaps + 2);\n                    spacingBefore = spacePerGap;\n                    spacingBetween = spacePerGap;\n                }\n                break;\n            case \"stretch\":\n                spacingBefore = 0;\n                spacingBetween = 0;\n                break;\n            default:\n                throw new Error(\"Unknown mode: \" + mode);\n        }\n\n        return {spacingBefore, spacingBetween}\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport SpacingCalculator from \"./SpacingCalculator.mjs\";\n\nexport default class ContentAligner {\n\n    constructor(layout) {\n        this._layout = layout;\n        this._totalCrossAxisSize = 0;\n    }\n\n    get _lines() {\n        return this._layout._lines;\n    }\n\n    init() {\n        this._totalCrossAxisSize = this._getTotalCrossAxisSize();\n    }\n\n    align() {\n        const crossAxisSize = this._layout.crossAxisSize;\n        const remainingSpace = crossAxisSize - this._totalCrossAxisSize;\n\n        const {spacingBefore, spacingBetween} = this._getSpacing(remainingSpace);\n\n        const lines = this._lines;\n\n        const mode = this._layout._flexContainer.alignContent;\n        let growSize = 0;\n        if (mode === \"stretch\" && lines.length && (remainingSpace > 0)) {\n            growSize = remainingSpace / lines.length;\n        }\n\n        let currentPos = spacingBefore;\n        for (let i = 0, n = lines.length; i < n; i++) {\n            const crossAxisLayoutOffset = currentPos;\n            const aligner = lines[i].createItemAligner();\n\n            let finalCrossAxisLayoutSize = lines[i].crossAxisLayoutSize + growSize;\n\n            aligner.setCrossAxisLayoutSize(finalCrossAxisLayoutSize);\n            aligner.setCrossAxisLayoutOffset(crossAxisLayoutOffset);\n\n            aligner.align();\n\n            if (aligner.recursiveResizeOccured) {\n                lines[i].setItemPositions();\n            }\n\n            currentPos += finalCrossAxisLayoutSize;\n            currentPos += spacingBetween;\n        }\n    }\n\n    get totalCrossAxisSize() {\n        return this._totalCrossAxisSize;\n    }\n\n    _getTotalCrossAxisSize() {\n        const lines = this._lines;\n        let total = 0;\n        for (let i = 0, n = lines.length; i < n; i++) {\n            const line = lines[i];\n            total += line.crossAxisLayoutSize;\n        }\n        return total;\n    }\n\n    _getSpacing(remainingSpace) {\n        const mode = this._layout._flexContainer.alignContent;\n        const numberOfItems = this._lines.length;\n        return SpacingCalculator.getSpacing(mode, numberOfItems, remainingSpace);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class FlexUtils {\n\n    static getParentAxisSizeWithPadding(item, horizontal) {\n        const target = item.target;\n        const parent = target.getParent();\n        if (!parent) {\n            return 0;\n        } else {\n            const flexParent = item.flexParent;\n            if (flexParent) {\n                // Use pending layout size.\n                return this.getAxisLayoutSize(flexParent, horizontal) + this.getTotalPadding(flexParent, horizontal);\n            } else {\n                // Use 'absolute' size.\n                return horizontal ? parent.w : parent.h;\n            }\n        }\n    }\n\n    static getRelAxisSize(item, horizontal) {\n        if (horizontal) {\n            if (item.funcW) {\n                if (this._allowRelAxisSizeFunction(item, true)) {\n                    return item.funcW(this.getParentAxisSizeWithPadding(item, true));\n                } else {\n                    return 0;\n                }\n            } else {\n                return item.originalWidth;\n            }\n        } else {\n            if (item.funcH) {\n                if (this._allowRelAxisSizeFunction(item, false)) {\n                    return item.funcH(this.getParentAxisSizeWithPadding(item, false));\n                } else {\n                    return 0;\n                }\n            } else {\n                return item.originalHeight;\n            }\n        }\n    }\n\n    static _allowRelAxisSizeFunction(item, horizontal) {\n        const flexParent = item.flexParent;\n        if (flexParent && flexParent._flex._layout.isAxisFitToContents(horizontal)) {\n            // We don't allow relative width on fit-to-contents because it leads to conflicts.\n            return false;\n        }\n        return true;\n    }\n\n    static isZeroAxisSize(item, horizontal) {\n        if (horizontal) {\n            return !item.originalWidth && !item.funcW;\n        } else {\n            return !item.originalHeight && !item.funcH;\n        }\n    }\n\n    static getAxisLayoutPos(item, horizontal) {\n        return horizontal ? item.x : item.y;\n    }\n\n    static getAxisLayoutSize(item, horizontal) {\n        return horizontal ? item.w : item.h;\n    }\n\n    static setAxisLayoutPos(item, horizontal, pos) {\n        if (horizontal) {\n            item.x = pos;\n        } else {\n            item.y = pos;\n        }\n    }\n\n    static setAxisLayoutSize(item, horizontal, size) {\n        if (horizontal) {\n            item.w = size;\n        } else {\n            item.h = size;\n        }\n    }\n\n    static getAxisMinSize(item, horizontal) {\n        let minSize = this.getPlainAxisMinSize(item, horizontal);\n\n        let flexItemMinSize = 0;\n        if (item.isFlexItemEnabled()) {\n            flexItemMinSize = item._flexItem._getMinSizeSetting(horizontal);\n        }\n\n        const hasLimitedMinSize = (flexItemMinSize > 0);\n        if (hasLimitedMinSize) {\n            minSize = Math.max(minSize, flexItemMinSize);\n        }\n        return minSize;\n    }\n\n    static getPlainAxisMinSize(item, horizontal) {\n        if (item.isFlexEnabled()) {\n            return item._flex._layout.getAxisMinSize(horizontal);\n        } else {\n            const isShrinkable = (item.flexItem.shrink !== 0);\n            if (isShrinkable) {\n                return 0;\n            } else {\n                return this.getRelAxisSize(item, horizontal);\n            }\n        }\n    }\n\n    static resizeAxis(item, horizontal, size) {\n        if (item.isFlexEnabled()) {\n            const isMainAxis = (item._flex._horizontal === horizontal);\n            if (isMainAxis) {\n                item._flex._layout.resizeMainAxis(size);\n            } else {\n                item._flex._layout.resizeCrossAxis(size);\n            }\n        } else {\n            this.setAxisLayoutSize(item, horizontal, size);\n        }\n    }\n\n\n    static getPaddingOffset(item, horizontal) {\n        if (item.isFlexEnabled()) {\n            const flex = item._flex;\n            if (horizontal) {\n                return flex.paddingLeft;\n            } else {\n                return flex.paddingTop;\n            }\n        } else {\n            return 0;\n        }\n    }\n\n    static getTotalPadding(item, horizontal) {\n        if (item.isFlexEnabled()) {\n            const flex = item._flex;\n            if (horizontal) {\n                return flex.paddingRight + flex.paddingLeft;\n            } else {\n                return flex.paddingTop + flex.paddingBottom;\n            }\n        } else {\n            return 0;\n        }\n    }\n\n    static getMarginOffset(item, horizontal) {\n        const flexItem = item.flexItem;\n        if (flexItem) {\n            if (horizontal) {\n                return flexItem.marginLeft;\n            } else {\n                return flexItem.marginTop;\n            }\n        } else {\n            return 0;\n        }\n    }\n\n    static getTotalMargin(item, horizontal) {\n        const flexItem = item.flexItem;\n        if (flexItem) {\n            if (horizontal) {\n                return flexItem.marginRight + flexItem.marginLeft;\n            } else {\n                return flexItem.marginTop + flexItem.marginBottom;\n            }\n        } else {\n            return 0;\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class SizeShrinker {\n\n    constructor(line) {\n        this._line = line;\n        this._amountRemaining = 0;\n        this._shrunkSize = 0;\n    }\n\n    shrink(amount) {\n        this._shrunkSize = 0;\n\n        this._amountRemaining = amount;\n        let totalShrinkAmount = this._getTotalShrinkAmount();\n        if (totalShrinkAmount) {\n            const items = this._line.items;\n            do {\n                let amountPerShrink = this._amountRemaining / totalShrinkAmount;\n                for (let i = this._line.startIndex; i <= this._line.endIndex; i++) {\n                    const item = items[i];\n                    const flexItem = item.flexItem;\n                    const shrinkAmount = flexItem.shrink;\n                    const isShrinkableItem = (shrinkAmount > 0);\n                    if (isShrinkableItem) {\n                        let shrink = shrinkAmount * amountPerShrink;\n                        const minSize = flexItem._getMainAxisMinSize();\n                        const size = flexItem._getMainAxisLayoutSize();\n                        if (size > minSize) {\n                            const maxShrink = size - minSize;\n                            const isFullyShrunk = (shrink >= maxShrink);\n                            if (isFullyShrunk) {\n                                shrink = maxShrink;\n\n                                // Destribute remaining amount over the other flex items.\n                                totalShrinkAmount -= shrinkAmount;\n                            }\n\n                            const finalSize = size - shrink;\n                            flexItem._resizeMainAxis(finalSize);\n\n                            this._shrunkSize += shrink;\n                            this._amountRemaining -= shrink;\n\n                            if (Math.abs(this._amountRemaining) < 10e-6) {\n                                return;\n                            }\n                        }\n                    }\n                }\n            } while(totalShrinkAmount && (Math.abs(this._amountRemaining) > 10e-6));\n        }\n    }\n\n    _getTotalShrinkAmount() {\n        let total = 0;\n        const items = this._line.items;\n        for (let i = this._line.startIndex; i <= this._line.endIndex; i++) {\n            const item = items[i];\n            const flexItem = item.flexItem;\n\n            if (flexItem.shrink) {\n                const minSize = flexItem._getMainAxisMinSize();\n                const size = flexItem._getMainAxisLayoutSize();\n\n                // Exclude those already fully shrunk.\n                if (size > minSize) {\n                    total += flexItem.shrink;\n                }\n            }\n        }\n        return total;\n    }\n\n    getShrunkSize() {\n        return this._shrunkSize;\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class SizeGrower {\n\n    constructor(line) {\n        this._line = line;\n        this._amountRemaining = 0;\n        this._grownSize = 0;\n    }\n\n    grow(amount) {\n        this._grownSize = 0;\n\n        this._amountRemaining = amount;\n        let totalGrowAmount = this._getTotalGrowAmount();\n        if (totalGrowAmount) {\n            const items = this._line.items;\n            do {\n                let amountPerGrow = this._amountRemaining / totalGrowAmount;\n                for (let i = this._line.startIndex; i <= this._line.endIndex; i++) {\n                    const item = items[i];\n                    const flexItem = item.flexItem;\n                    const growAmount = flexItem.grow;\n                    const isGrowableItem = (growAmount > 0);\n                    if (isGrowableItem) {\n                        let grow = growAmount * amountPerGrow;\n                        const maxSize = flexItem._getMainAxisMaxSizeSetting();\n                        const size = flexItem._getMainAxisLayoutSize();\n                        if (maxSize > 0) {\n                            if (size >= maxSize) {\n                                // Already fully grown.\n                                grow = 0;\n                            } else {\n                                const maxGrow = maxSize - size;\n                                const isFullyGrown = (grow >= maxGrow);\n                                if (isFullyGrown) {\n                                    grow = maxGrow;\n\n                                    // Destribute remaining amount over the other flex items.\n                                    totalGrowAmount -= growAmount;\n                                }\n                            }\n                        }\n\n                        if (grow > 0) {\n                            const finalSize = size + grow;\n                            flexItem._resizeMainAxis(finalSize);\n\n                            this._grownSize += grow;\n                            this._amountRemaining -= grow;\n\n                            if (Math.abs(this._amountRemaining) < 10e-6) {\n                                return;\n                            }\n                        }\n                    }\n                }\n            } while(totalGrowAmount && (Math.abs(this._amountRemaining) > 10e-6));\n        }\n    }\n\n    _getTotalGrowAmount() {\n        let total = 0;\n        const items = this._line.items;\n        for (let i = this._line.startIndex; i <= this._line.endIndex; i++) {\n            const item = items[i];\n            const flexItem = item.flexItem;\n\n            if (flexItem.grow) {\n                const maxSize = flexItem._getMainAxisMaxSizeSetting();\n                const size = flexItem._getMainAxisLayoutSize();\n\n                // Exclude those already fully grown.\n                if (maxSize === 0 || size < maxSize) {\n                    total += flexItem.grow;\n                }\n            }\n        }\n        return total;\n    }\n\n    getGrownSize() {\n        return this._grownSize;\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport SpacingCalculator from \"../SpacingCalculator.mjs\";\n\nexport default class ItemPositioner {\n\n    constructor(lineLayout) {\n        this._line = lineLayout;\n    }\n\n    get _layout() {\n        return this._line._layout;\n    }\n\n    position() {\n        const {spacingBefore, spacingBetween} = this._getSpacing();\n\n        let currentPos = spacingBefore;\n\n        const items = this._line.items;\n        for (let i = this._line.startIndex; i <= this._line.endIndex; i++) {\n            const item = items[i];\n\n            item.flexItem._setMainAxisLayoutPos(currentPos);\n            currentPos += item.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();\n            currentPos += spacingBetween;\n        }\n    }\n\n    _getSpacing() {\n        const remainingSpace = this._line._availableSpace;\n        let mode = this._layout._flexContainer.justifyContent;\n        const numberOfItems = this._line.numberOfItems;\n\n        return SpacingCalculator.getSpacing(mode, numberOfItems, remainingSpace);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class ItemAligner {\n\n    constructor(line) {\n        this._line = line;\n        this._crossAxisLayoutSize = 0;\n        this._crossAxisLayoutOffset = 0;\n        this._alignItemsSetting = null;\n        this._recursiveResizeOccured = false;\n        this._isCrossAxisFitToContents = false;\n    }\n\n    get _layout() {\n        return this._line._layout;\n    }\n\n    get _flexContainer() {\n        return this._layout._flexContainer;\n    }\n\n    setCrossAxisLayoutSize(size) {\n        this._crossAxisLayoutSize = size;\n    }\n\n    setCrossAxisLayoutOffset(offset) {\n        this._crossAxisLayoutOffset = offset;\n    }\n\n    align() {\n        this._alignItemsSetting = this._flexContainer.alignItems;\n\n        this._isCrossAxisFitToContents = this._layout.isAxisFitToContents(!this._flexContainer._horizontal);\n\n        this._recursiveResizeOccured = false;\n        const items = this._line.items;\n        for (let i = this._line.startIndex; i <= this._line.endIndex; i++) {\n            const item = items[i];\n            this._alignItem(item);\n        }\n    }\n\n    get recursiveResizeOccured() {\n        return this._recursiveResizeOccured;\n    }\n\n    _alignItem(item) {\n        const flexItem = item.flexItem;\n        let align = flexItem.alignSelf || this._alignItemsSetting;\n\n        if (align === \"stretch\" && this._preventStretch(flexItem)) {\n            align = \"flex-start\";\n        }\n\n        if (align !== \"stretch\" && !this._isCrossAxisFitToContents) {\n            if (flexItem._hasRelCrossAxisSize()) {\n                // As cross axis size might have changed, we need to recalc the relative flex item's size.\n                flexItem._resetCrossAxisLayoutSize();\n            }\n        }\n\n        switch(align) {\n            case \"flex-start\":\n                this._alignItemFlexStart(flexItem);\n                break;\n            case \"flex-end\":\n                this._alignItemFlexEnd(flexItem);\n                break;\n            case \"center\":\n                this._alignItemFlexCenter(flexItem);\n                break;\n            case \"stretch\":\n                this._alignItemStretch(flexItem);\n                break;\n        }\n    }\n\n    _alignItemFlexStart(flexItem) {\n        flexItem._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);\n    }\n\n    _alignItemFlexEnd(flexItem) {\n        const itemCrossAxisSize = flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin();\n        flexItem._setCrossAxisLayoutPos(this._crossAxisLayoutOffset + (this._crossAxisLayoutSize - itemCrossAxisSize));\n    }\n\n    _alignItemFlexCenter(flexItem) {\n        const itemCrossAxisSize = flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin();\n        const center = (this._crossAxisLayoutSize - itemCrossAxisSize) / 2;\n        flexItem._setCrossAxisLayoutPos(this._crossAxisLayoutOffset + center);\n    }\n\n    _alignItemStretch(flexItem) {\n        flexItem._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);\n\n        const mainAxisLayoutSizeBeforeResize = flexItem._getMainAxisLayoutSize();\n        let size = this._crossAxisLayoutSize - flexItem._getCrossAxisMargin() - flexItem._getCrossAxisPadding();\n\n        const crossAxisMinSizeSetting = flexItem._getCrossAxisMinSizeSetting();\n        if (crossAxisMinSizeSetting > 0) {\n            size = Math.max(size, crossAxisMinSizeSetting);\n        }\n\n        const crossAxisMaxSizeSetting = flexItem._getCrossAxisMaxSizeSetting();\n        const crossAxisMaxSizeSettingEnabled = (crossAxisMaxSizeSetting > 0);\n        if (crossAxisMaxSizeSettingEnabled) {\n            size = Math.min(size, crossAxisMaxSizeSetting);\n        }\n\n        flexItem._resizeCrossAxis(size);\n        const mainAxisLayoutSizeAfterResize = flexItem._getMainAxisLayoutSize();\n\n        const recursiveResize = (mainAxisLayoutSizeAfterResize !== mainAxisLayoutSizeBeforeResize);\n        if (recursiveResize) {\n            // Recursive resize can happen when this flex item has the opposite direction than the container\n            // and is wrapping and auto-sizing. Due to item/content stretching the main axis size of the flex\n            // item may decrease. If it does so, we must re-justify-content the complete line.\n            // Notice that we don't account for changes to the (if autosized) main axis size caused by recursive\n            // resize, which may cause the container's main axis to not shrink to the contents properly.\n            // This is by design, because if we had re-run the main axis layout, we could run into issues such\n            // as slow layout or endless loops.\n            this._recursiveResizeOccured = true;\n        }\n    }\n\n    _preventStretch(flexItem) {\n        const hasFixedCrossAxisSize = flexItem._hasFixedCrossAxisSize();\n        const forceStretch = (flexItem.alignSelf === \"stretch\");\n        return hasFixedCrossAxisSize && !forceStretch;\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport SizeShrinker from \"./SizeShrinker.mjs\";\nimport SizeGrower from \"./SizeGrower.mjs\";\nimport ItemPositioner from \"./ItemPositioner.mjs\";\nimport ItemAligner from \"./ItemAligner.mjs\";\n\nexport default class LineLayout {\n\n    constructor(layout, startIndex, endIndex, availableSpace) {\n        this._layout = layout;\n        this.items = layout.items;\n        this.startIndex = startIndex;\n        this.endIndex = endIndex;\n        this._availableSpace = availableSpace;\n    }\n\n    performLayout() {\n        this._setItemSizes();\n        this.setItemPositions();\n        this._calcLayoutInfo();\n    }\n\n    _setItemSizes() {\n        if (this._availableSpace > 0) {\n            this._growItemSizes(this._availableSpace);\n        } else if (this._availableSpace < 0) {\n            this._shrinkItemSizes(-this._availableSpace);\n        }\n    }\n\n    _growItemSizes(amount) {\n        const grower = new SizeGrower(this);\n        grower.grow(amount);\n        this._availableSpace -= grower.getGrownSize();\n    }\n\n    _shrinkItemSizes(amount) {\n        const shrinker = new SizeShrinker(this);\n        shrinker.shrink(amount);\n        this._availableSpace += shrinker.getShrunkSize();\n    }\n\n    setItemPositions() {\n        const positioner = new ItemPositioner(this);\n        positioner.position();\n    }\n\n    createItemAligner() {\n        return new ItemAligner(this);\n    }\n\n    _calcLayoutInfo() {\n        this._calcCrossAxisMaxLayoutSize();\n    }\n\n    getMainAxisMinSize() {\n        let mainAxisMinSize = 0;\n        for (let i = this.startIndex; i <= this.endIndex; i++) {\n            const item = this.items[i];\n            mainAxisMinSize += item.flexItem._getMainAxisMinSizeWithPaddingAndMargin();\n        }\n        return mainAxisMinSize;\n    }\n    \n    get numberOfItems() {\n        return this.endIndex - this.startIndex + 1;\n    }\n\n    get crossAxisLayoutSize() {\n        const noSpecifiedCrossAxisSize = (this._layout.isCrossAxisFitToContents() && !this._layout.resizingCrossAxis);\n        const shouldFitToContents = (this._layout.isWrapping() || noSpecifiedCrossAxisSize);\n        if (shouldFitToContents) {\n            return this._crossAxisMaxLayoutSize;\n        } else {\n            return this._layout.crossAxisSize;\n        }\n    }\n\n    _calcCrossAxisMaxLayoutSize() {\n        this._crossAxisMaxLayoutSize = this._getCrossAxisMaxLayoutSize();\n    }\n\n    _getCrossAxisMaxLayoutSize() {\n        let crossAxisMaxSize = 0;\n        for (let i = this.startIndex; i <= this.endIndex; i++) {\n            const item = this.items[i];\n            crossAxisMaxSize = Math.max(crossAxisMaxSize, item.flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin());\n        }\n        return crossAxisMaxSize;\n    }\n\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport LineLayout from \"./line/LineLayout.mjs\";\n\n/**\n * Distributes items over layout lines.\n */\nexport default class LineLayouter {\n\n    constructor(layout) {\n        this._layout = layout;\n        this._mainAxisMinSize = -1;\n        this._crossAxisMinSize = -1;\n        this._mainAxisContentSize = 0;\n    }\n\n    get lines() {\n        return this._lines;\n    }\n\n    get mainAxisMinSize() {\n        if (this._mainAxisMinSize === -1) {\n            this._mainAxisMinSize = this._getMainAxisMinSize();\n        }\n        return this._mainAxisMinSize;\n    }\n\n    get crossAxisMinSize() {\n        if (this._crossAxisMinSize === -1) {\n            this._crossAxisMinSize = this._getCrossAxisMinSize();\n        }\n        return this._crossAxisMinSize;\n    }\n\n    get mainAxisContentSize() {\n        return this._mainAxisContentSize;\n    }\n\n    layoutLines() {\n        this._setup();\n        const items = this._layout.items;\n        const wrap = this._layout.isWrapping();\n\n        let startIndex = 0;\n        let i;\n        const n = items.length;\n        for (i = 0; i < n; i++) {\n            const item = items[i];\n\n            this._layoutFlexItem(item);\n\n            // Get predicted main axis size.\n            const itemMainAxisSize = item.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();\n\n            if (wrap && (i > startIndex)) {\n                const isOverflowing = (this._curMainAxisPos + itemMainAxisSize > this._mainAxisSize);\n                if (isOverflowing) {\n                    this._layoutLine(startIndex, i - 1);\n                    this._curMainAxisPos = 0;\n                    startIndex = i;\n                }\n            }\n\n            this._addToMainAxisPos(itemMainAxisSize);\n        }\n\n        if (startIndex < i) {\n            this._layoutLine(startIndex, i - 1);\n        }\n    }\n\n    _layoutFlexItem(item) {\n        if (item.isFlexEnabled()) {\n            item.flexLayout.updateTreeLayout();\n        } else {\n            item.flexItem._resetLayoutSize();\n        }\n    }\n\n    _setup() {\n        this._mainAxisSize = this._layout.mainAxisSize;\n        this._curMainAxisPos = 0;\n        this._maxMainAxisPos = 0;\n        this._lines = [];\n\n        this._mainAxisMinSize = -1;\n        this._crossAxisMinSize = -1;\n        this._mainAxisContentSize = 0;\n    }\n\n    _addToMainAxisPos(itemMainAxisSize) {\n        this._curMainAxisPos += itemMainAxisSize;\n        if (this._curMainAxisPos > this._maxMainAxisPos) {\n            this._maxMainAxisPos = this._curMainAxisPos;\n        }\n    }\n\n    _layoutLine(startIndex, endIndex) {\n        const availableSpace = this._getAvailableMainAxisLayoutSpace();\n        const line = new LineLayout(this._layout, startIndex, endIndex, availableSpace);\n        line.performLayout();\n        this._lines.push(line);\n\n        if (this._mainAxisContentSize === 0 || (this._curMainAxisPos > this._mainAxisContentSize)) {\n            this._mainAxisContentSize = this._curMainAxisPos;\n        }\n    }\n\n    _getAvailableMainAxisLayoutSpace() {\n        if (!this._layout.resizingMainAxis && this._layout.isMainAxisFitToContents()) {\n            return 0;\n        } else {\n            return this._mainAxisSize - this._curMainAxisPos;\n        }\n    }\n\n    _getCrossAxisMinSize() {\n        let crossAxisMinSize = 0;\n        const items = this._layout.items;\n        for (let i = 0, n = items.length; i < n; i++) {\n            const item = items[i];\n            const itemCrossAxisMinSize = item.flexItem._getCrossAxisMinSizeWithPaddingAndMargin();\n            crossAxisMinSize = Math.max(crossAxisMinSize, itemCrossAxisMinSize);\n        }\n        return crossAxisMinSize;\n    }\n\n    _getMainAxisMinSize() {\n        if (this._lines.length === 1) {\n            return this._lines[0].getMainAxisMinSize();\n        } else {\n            // Wrapping lines: specified width is used as min width (in accordance to W3C flexbox).\n            return this._layout.mainAxisSize;\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport FlexUtils from \"../FlexUtils.mjs\";\n\nexport default class ItemCoordinatesUpdater {\n\n    constructor(layout) {\n        this._layout = layout;\n        this._isReverse = this._flexContainer._reverse;\n        this._horizontalPaddingOffset = this._layout._getHorizontalPaddingOffset();\n        this._verticalPaddingOffset = this._layout._getVerticalPaddingOffset();\n    }\n\n    get _flexContainer() {\n        return this._layout._flexContainer;\n    }\n\n    finalize() {\n        const parentFlex = this._layout.getParentFlexContainer();\n        if (parentFlex) {\n            // We must update it from the parent to set padding offsets and reverse position.\n            const updater = new ItemCoordinatesUpdater(parentFlex._layout);\n            updater._finalizeItemAndChildren(this._flexContainer.item);\n        } else {\n            this._finalizeRoot();\n            this._finalizeItems();\n        }\n    }\n\n    _finalizeRoot() {\n        const item = this._flexContainer.item;\n        let x = FlexUtils.getAxisLayoutPos(item, true);\n        let y = FlexUtils.getAxisLayoutPos(item, false);\n        let w = FlexUtils.getAxisLayoutSize(item, true);\n        let h = FlexUtils.getAxisLayoutSize(item, false);\n\n        w += this._layout._getHorizontalPadding();\n        h += this._layout._getVerticalPadding();\n\n        item.clearRecalcFlag();\n\n        item.setLayout(x, y, w, h);\n    }\n\n    _finalizeItems() {\n        const items = this._layout.items;\n        for (let i = 0, n = items.length; i < n; i++) {\n            const item = items[i];\n            const validCache = this._validateItemCache(item);\n\n            // Notice that we must also finalize a cached items, as it's coordinates may have changed.\n            this._finalizeItem(item);\n\n            if (!validCache) {\n                this._finalizeItemChildren(item);\n            }\n        }\n    }\n\n    _validateItemCache(item) {\n        if (item.recalc === 0) {\n            if (item.isFlexEnabled()) {\n                const layout = item._flex._layout;\n\n                const dimensionsMatchPreviousResult = (item.w === item.target.w && item.h === item.target.h);\n                if (dimensionsMatchPreviousResult) {\n                    // Cache is valid.\n                    return true;\n                } else {\n                    const crossAxisSize = layout.crossAxisSize;\n                    layout.performResizeMainAxis(layout.mainAxisSize);\n                    layout.performResizeCrossAxis(crossAxisSize);\n                }\n            }\n        }\n        return false;\n    }\n\n    _finalizeItemAndChildren(item) {\n        this._finalizeItem(item);\n        this._finalizeItemChildren(item);\n    }\n\n    _finalizeItem(item) {\n        if (this._isReverse) {\n            this._reverseMainAxisLayoutPos(item);\n        }\n\n        let x = FlexUtils.getAxisLayoutPos(item, true);\n        let y = FlexUtils.getAxisLayoutPos(item, false);\n        let w = FlexUtils.getAxisLayoutSize(item, true);\n        let h = FlexUtils.getAxisLayoutSize(item, false);\n\n        x += this._horizontalPaddingOffset;\n        y += this._verticalPaddingOffset;\n\n        const flex = item.flex;\n        if (flex) {\n            w += item._flex._layout._getHorizontalPadding();\n            h += item._flex._layout._getVerticalPadding();\n        }\n\n        const flexItem = item.flexItem;\n        if (flexItem) {\n            x += flexItem._getHorizontalMarginOffset();\n            y += flexItem._getVerticalMarginOffset();\n        }\n\n        item.clearRecalcFlag();\n        item.setLayout(x, y, w, h);\n    }\n\n    _finalizeItemChildren(item) {\n        const flex = item._flex;\n        if (flex) {\n            const updater = new ItemCoordinatesUpdater(flex._layout);\n            updater._finalizeItems();\n        }\n    }\n\n    _reverseMainAxisLayoutPos(item) {\n        const endPos = (item.flexItem._getMainAxisLayoutPos() + item.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin());\n        const reversedPos = this._layout.mainAxisSize - endPos;\n        item.flexItem._setMainAxisLayoutPos(reversedPos);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ContentAligner from \"./ContentAligner.mjs\";\nimport FlexUtils from \"../FlexUtils.mjs\";\nimport LineLayouter from \"./LineLayouter.mjs\";\nimport ItemCoordinatesUpdater from \"./ItemCoordinatesUpdater.mjs\";\n\n/**\n * Layouts a flex container (and descendants).\n */\nexport default class FlexLayout {\n\n    constructor(flexContainer) {\n        this._flexContainer = flexContainer;\n\n        this._lineLayouter = new LineLayouter(this);\n\n        this._resizingMainAxis = false;\n        this._resizingCrossAxis = false;\n\n        this._cachedMainAxisSizeAfterLayout = 0;\n        this._cachedCrossAxisSizeAfterLayout = 0;\n\n        this._shrunk = false;\n    }\n\n    get shrunk() {\n        return this._shrunk;\n    }\n\n    get recalc() {\n        return this.item.recalc;\n    }\n\n    layoutTree() {\n        const isSubTree = (this.item.flexParent !== null);\n        if (isSubTree) {\n            // Use the dimensions set by the parent flex tree.\n            this._updateSubTreeLayout();\n        } else {\n            this.updateTreeLayout();\n        }\n        this.updateItemCoords();\n    }\n\n    updateTreeLayout() {\n        if (this.recalc) {\n            this._performUpdateLayoutTree();\n        } else {\n            this._performUpdateLayoutTreeFromCache();\n        }\n    }\n\n    _performUpdateLayoutTree() {\n        this._setInitialAxisSizes();\n        this._layoutAxes();\n        this._refreshLayoutCache();\n    }\n\n    _refreshLayoutCache() {\n        this._cachedMainAxisSizeAfterLayout = this.mainAxisSize;\n        this._cachedCrossAxisSizeAfterLayout = this.crossAxisSize;\n    }\n\n    _performUpdateLayoutTreeFromCache() {\n        const sizeMightHaveChanged = (this.item.funcW || this.item.funcH);\n        if (sizeMightHaveChanged) {\n            // Update after all.\n            this.item.enableLocalRecalcFlag();\n            this._performUpdateLayoutTree();\n        } else {\n            this.mainAxisSize = this._cachedMainAxisSizeAfterLayout;\n            this.crossAxisSize = this._cachedCrossAxisSizeAfterLayout;\n        }\n    }\n\n    updateItemCoords() {\n        const updater = new ItemCoordinatesUpdater(this);\n        updater.finalize();\n    }\n\n    _updateSubTreeLayout() {\n        // The dimensions of this container are guaranteed not to have changed.\n        // That's why we can safely 'reuse' those and re-layout the contents.\n        const crossAxisSize = this.crossAxisSize;\n        this._layoutMainAxis();\n        this.performResizeCrossAxis(crossAxisSize);\n    }\n\n    _setInitialAxisSizes() {\n        if (this.item.isFlexItemEnabled()) {\n            this.item.flexItem._resetLayoutSize();\n        } else {\n            this.mainAxisSize = this._getMainAxisBasis();\n            this.crossAxisSize = this._getCrossAxisBasis();\n        }\n        this._resizingMainAxis = false;\n        this._resizingCrossAxis = false;\n        this._shrunk = false;\n    }\n\n    _layoutAxes() {\n        this._layoutMainAxis();\n        this._layoutCrossAxis();\n    }\n\n    /**\n     * @pre mainAxisSize should exclude padding.\n     */\n    _layoutMainAxis() {\n        this._layoutLines();\n        this._fitMainAxisSizeToContents();\n    }\n\n    _layoutLines() {\n        this._lineLayouter.layoutLines();\n    }\n\n    get _lines() {\n        return this._lineLayouter.lines;\n    }\n\n    _fitMainAxisSizeToContents() {\n        if (!this._resizingMainAxis) {\n            if (this.isMainAxisFitToContents()) {\n                this.mainAxisSize = this._lineLayouter.mainAxisContentSize;\n            }\n        }\n    }\n\n    /**\n     * @pre crossAxisSize should exclude padding.\n     */\n    _layoutCrossAxis() {\n        const aligner = new ContentAligner(this);\n        aligner.init();\n        this._totalCrossAxisSize = aligner.totalCrossAxisSize;\n        this._fitCrossAxisSizeToContents();\n        aligner.align();\n    }\n\n    _fitCrossAxisSizeToContents() {\n        if (!this._resizingCrossAxis) {\n            if (this.isCrossAxisFitToContents()) {\n                this.crossAxisSize = this._totalCrossAxisSize;\n            }\n        }\n    }\n\n    isWrapping() {\n        return this._flexContainer.wrap;\n    }\n\n    isAxisFitToContents(horizontal) {\n        if (this._horizontal === horizontal) {\n            return this.isMainAxisFitToContents();\n        } else {\n            return this.isCrossAxisFitToContents();\n        }\n    }\n\n    isMainAxisFitToContents() {\n        return !this.isWrapping() && !this._hasFixedMainAxisBasis();\n    }\n\n    isCrossAxisFitToContents() {\n        return !this._hasFixedCrossAxisBasis();\n    }\n\n    _hasFixedMainAxisBasis() {\n        return !FlexUtils.isZeroAxisSize(this.item, this._horizontal);\n    }\n\n    _hasFixedCrossAxisBasis() {\n        return !FlexUtils.isZeroAxisSize(this.item, !this._horizontal);\n    }\n\n    getAxisMinSize(horizontal) {\n        if (this._horizontal === horizontal) {\n            return this._getMainAxisMinSize();\n        } else {\n            return this._getCrossAxisMinSize();\n        }\n    }\n\n    _getMainAxisMinSize() {\n        return this._lineLayouter.mainAxisMinSize;\n    }\n\n    _getCrossAxisMinSize() {\n        return this._lineLayouter.crossAxisMinSize;\n    }\n\n    resizeMainAxis(size) {\n        if (this.mainAxisSize !== size) {\n            if (this.recalc > 0) {\n                this.performResizeMainAxis(size);\n            } else {\n                if (this._checkValidCacheMainAxisResize()) {\n                    this.mainAxisSize = size;\n                    this._fitCrossAxisSizeToContents();\n                } else {\n                    // Cache miss.\n                    this.item.enableLocalRecalcFlag();\n                    this.performResizeMainAxis(size);\n                }\n            }\n        }\n    }\n\n    _checkValidCacheMainAxisResize(size) {\n        const isFinalMainAxisSize = (size === this.targetMainAxisSize);\n        if (isFinalMainAxisSize) {\n            return true;\n        }\n        const canIgnoreCacheMiss = !this.isCrossAxisFitToContents();\n        if (canIgnoreCacheMiss) {\n            // Allow other main axis resizes and check if final resize matches the target main axis size\n            //  (ItemCoordinatesUpdater).\n            return true;\n        }\n        return false;\n    }\n\n    performResizeMainAxis(size) {\n        const isShrinking = (size < this.mainAxisSize);\n        this._shrunk = isShrinking;\n\n        this.mainAxisSize = size;\n\n        this._resizingMainAxis = true;\n        this._layoutAxes();\n        this._resizingMainAxis = false;\n    }\n\n    resizeCrossAxis(size) {\n        if (this.crossAxisSize !== size) {\n            if (this.recalc > 0) {\n                this.performResizeCrossAxis(size);\n            } else {\n                this.crossAxisSize = size;\n            }\n        }\n    }\n\n    performResizeCrossAxis(size) {\n        this.crossAxisSize = size;\n\n        this._resizingCrossAxis = true;\n        this._layoutCrossAxis();\n        this._resizingCrossAxis = false;\n    }\n\n    get targetMainAxisSize() {\n        return this._horizontal ? this.item.target.w : this.item.target.h;\n    }\n\n    get targetCrossAxisSize() {\n        return this._horizontal ? this.item.target.h : this.item.target.w;\n    }\n\n    getParentFlexContainer() {\n        return this.item.isFlexItemEnabled() ? this.item.flexItem.ctr : null;\n    }\n\n    _getHorizontalPadding() {\n        return FlexUtils.getTotalPadding(this.item, true);\n    }\n\n    _getVerticalPadding() {\n        return FlexUtils.getTotalPadding(this.item, false);\n    }\n\n    _getHorizontalPaddingOffset() {\n        return FlexUtils.getPaddingOffset(this.item, true);\n    }\n\n    _getVerticalPaddingOffset() {\n        return FlexUtils.getPaddingOffset(this.item, false);\n    }\n\n    _getMainAxisBasis() {\n        return FlexUtils.getRelAxisSize(this.item, this._horizontal);\n    }\n\n    _getCrossAxisBasis() {\n        return FlexUtils.getRelAxisSize(this.item, !this._horizontal);\n    }\n\n    get _horizontal() {\n        return this._flexContainer._horizontal;\n    }\n\n    get _reverse() {\n        return this._flexContainer._reverse;\n    }\n\n    get item() {\n        return this._flexContainer.item;\n    }\n\n    get items() {\n        return this.item.items;\n    }\n\n    get resizingMainAxis() {\n        return this._resizingMainAxis;\n    }\n\n    get resizingCrossAxis() {\n        return this._resizingCrossAxis;\n    }\n\n    get numberOfItems() {\n        return this.items.length;\n    }\n\n    get mainAxisSize() {\n        return FlexUtils.getAxisLayoutSize(this.item, this._horizontal);\n    }\n\n    get crossAxisSize() {\n        return FlexUtils.getAxisLayoutSize(this.item, !this._horizontal);\n    }\n\n    set mainAxisSize(v) {\n        FlexUtils.setAxisLayoutSize(this.item, this._horizontal, v);\n    }\n\n    set crossAxisSize(v) {\n        FlexUtils.setAxisLayoutSize(this.item, !this._horizontal, v);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Base from \"../tree/Base.mjs\";\nimport Layout from \"./layout/FlexLayout.mjs\";\n\nexport default class FlexContainer {\n\n\n    constructor(item) {\n        this._item = item;\n\n        this._layout = new Layout(this);\n        this._horizontal = true;\n        this._reverse = false;\n        this._wrap = false;\n        this._alignItems = 'stretch';\n        this._justifyContent = 'flex-start';\n        this._alignContent = 'flex-start';\n\n        this._paddingLeft = 0;\n        this._paddingTop = 0;\n        this._paddingRight = 0;\n        this._paddingBottom = 0;\n    }\n\n    get item() {\n        return this._item;\n    }\n\n    _changedDimensions() {\n        this._item.changedDimensions();\n    }\n\n    _changedContents() {\n        this._item.changedContents();\n    }\n\n    get direction() {\n        return (this._horizontal ? \"row\" : \"column\") + (this._reverse ? \"-reverse\" : \"\");\n    }\n\n    set direction(f) {\n        if (this.direction === f) return;\n\n        this._horizontal = (f === 'row' || f === 'row-reverse');\n        this._reverse = (f === 'row-reverse' || f === 'column-reverse');\n\n        this._changedContents();\n    }\n\n    set wrap(v) {\n        this._wrap = v;\n        this._changedContents();\n    }\n\n    get wrap() {\n        return this._wrap;\n    }\n\n    get alignItems() {\n        return this._alignItems;\n    }\n\n    set alignItems(v) {\n        if (this._alignItems === v) return;\n        if (FlexContainer.ALIGN_ITEMS.indexOf(v) === -1) {\n            throw new Error(\"Unknown alignItems, options: \" + FlexContainer.ALIGN_ITEMS.join(\",\"));\n        }\n        this._alignItems = v;\n\n        this._changedContents();\n    }\n\n    get alignContent() {\n        return this._alignContent;\n    }\n\n    set alignContent(v) {\n        if (this._alignContent === v) return;\n        if (FlexContainer.ALIGN_CONTENT.indexOf(v) === -1) {\n            throw new Error(\"Unknown alignContent, options: \" + FlexContainer.ALIGN_CONTENT.join(\",\"));\n        }\n        this._alignContent = v;\n\n        this._changedContents();\n    }\n\n    get justifyContent() {\n        return this._justifyContent;\n    }\n\n    set justifyContent(v) {\n        if (this._justifyContent === v) return;\n\n        if (FlexContainer.JUSTIFY_CONTENT.indexOf(v) === -1) {\n            throw new Error(\"Unknown justifyContent, options: \" + FlexContainer.JUSTIFY_CONTENT.join(\",\"));\n        }\n        this._justifyContent = v;\n\n        this._changedContents();\n    }\n\n    set padding(v) {\n        this.paddingLeft = v;\n        this.paddingTop = v;\n        this.paddingRight = v;\n        this.paddingBottom = v;\n    }\n\n    get padding() {\n        return this.paddingLeft;\n    }\n    \n    set paddingLeft(v) {\n        this._paddingLeft = v;\n        this._changedDimensions();\n    }\n    \n    get paddingLeft() {\n        return this._paddingLeft;\n    }\n\n    set paddingTop(v) {\n        this._paddingTop = v;\n        this._changedDimensions();\n    }\n\n    get paddingTop() {\n        return this._paddingTop;\n    }\n\n    set paddingRight(v) {\n        this._paddingRight = v;\n        this._changedDimensions();\n    }\n\n    get paddingRight() {\n        return this._paddingRight;\n    }\n\n    set paddingBottom(v) {\n        this._paddingBottom = v;\n        this._changedDimensions();\n    }\n\n    get paddingBottom() {\n        return this._paddingBottom;\n    }\n\n    patch(settings) {\n        Base.patchObject(this, settings);\n    }\n\n}\n\nFlexContainer.ALIGN_ITEMS = [\"flex-start\", \"flex-end\", \"center\", \"stretch\"];\nFlexContainer.ALIGN_CONTENT = [\"flex-start\", \"flex-end\", \"center\", \"space-between\", \"space-around\", \"space-evenly\", \"stretch\"];\nFlexContainer.JUSTIFY_CONTENT = [\"flex-start\", \"flex-end\", \"center\", \"space-between\", \"space-around\", \"space-evenly\"];\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Base from \"../tree/Base.mjs\";\nimport FlexUtils from \"./FlexUtils.mjs\";\nimport FlexContainer from \"./FlexContainer.mjs\";\n\nexport default class FlexItem {\n\n    constructor(item) {\n        this._ctr = null;\n        this._item = item;\n        this._grow = 0;\n        this._shrink = FlexItem.SHRINK_AUTO;\n        this._alignSelf = undefined;\n        this._minWidth = 0;\n        this._minHeight = 0;\n        this._maxWidth = 0;\n        this._maxHeight = 0;\n\n        this._marginLeft = 0;\n        this._marginTop = 0;\n        this._marginRight = 0;\n        this._marginBottom = 0;\n    }\n\n    get item() {\n        return this._item;\n    }\n\n    get grow() {\n        return this._grow;\n    }\n\n    set grow(v) {\n        if (this._grow === v) return;\n\n        this._grow = parseInt(v) || 0;\n\n        this._changed();\n    }\n\n    get shrink() {\n        if (this._shrink === FlexItem.SHRINK_AUTO) {\n            return this._getDefaultShrink();\n        }\n        return this._shrink;\n    }\n\n    _getDefaultShrink() {\n        if (this.item.isFlexEnabled()) {\n            return 1;\n        } else {\n            // All non-flex containers are absolutely positioned items with fixed dimensions, and by default not shrinkable.\n            return 0;\n        }\n    }\n\n    set shrink(v) {\n        if (this._shrink === v) return;\n\n        this._shrink = parseInt(v) || 0;\n\n        this._changed();\n    }\n\n    get alignSelf() {\n        return this._alignSelf;\n    }\n\n    set alignSelf(v) {\n        if (this._alignSelf === v) return;\n\n        if (v === undefined) {\n            this._alignSelf = undefined;\n        } else {\n            if (FlexContainer.ALIGN_ITEMS.indexOf(v) === -1) {\n                throw new Error(\"Unknown alignSelf, options: \" + FlexContainer.ALIGN_ITEMS.join(\",\"));\n            }\n            this._alignSelf = v;\n        }\n\n        this._changed();\n    }\n\n    get minWidth() {\n        return this._minWidth;\n    }\n\n    set minWidth(v) {\n        this._minWidth = Math.max(0, v);\n        this._item.changedDimensions(true, false);\n    }\n\n    get minHeight() {\n        return this._minHeight;\n    }\n\n    set minHeight(v) {\n        this._minHeight = Math.max(0, v);\n        this._item.changedDimensions(false, true);\n    }\n\n    get maxWidth() {\n        return this._maxWidth;\n    }\n\n    set maxWidth(v) {\n        this._maxWidth = Math.max(0, v);\n        this._item.changedDimensions(true, false);\n    }\n\n    get maxHeight() {\n        return this._maxHeight;\n    }\n\n    set maxHeight(v) {\n        this._maxHeight = Math.max(0, v);\n        this._item.changedDimensions(false, true);\n    }\n\n    /**\n     * @note margins behave slightly different than in HTML with regard to shrinking.\n     * In HTML, (outer) margins can be removed when shrinking. In this engine, they will not shrink at all.\n     */\n    set margin(v) {\n        this.marginLeft = v;\n        this.marginTop = v;\n        this.marginRight = v;\n        this.marginBottom = v;\n    }\n\n    get margin() {\n        return this.marginLeft;\n    }\n\n    set marginLeft(v) {\n        this._marginLeft = v;\n        this._changed();\n    }\n\n    get marginLeft() {\n        return this._marginLeft;\n    }\n\n    set marginTop(v) {\n        this._marginTop = v;\n        this._changed();\n    }\n\n    get marginTop() {\n        return this._marginTop;\n    }\n\n    set marginRight(v) {\n        this._marginRight = v;\n        this._changed();\n    }\n\n    get marginRight() {\n        return this._marginRight;\n    }\n\n    set marginBottom(v) {\n        this._marginBottom = v;\n        this._changed();\n    }\n\n    get marginBottom() {\n        return this._marginBottom;\n    }\n    \n    _changed() {\n        if (this.ctr) this.ctr._changedContents();\n    }\n\n    set ctr(v) {\n        this._ctr = v;\n    }\n\n    get ctr() {\n        return this._ctr;\n    }\n\n    patch(settings) {\n        Base.patchObject(this, settings);\n    }\n\n    _resetLayoutSize() {\n        this._resetHorizontalAxisLayoutSize();\n        this._resetVerticalAxisLayoutSize();\n    }\n\n    _resetCrossAxisLayoutSize() {\n        if (this.ctr._horizontal) {\n            this._resetVerticalAxisLayoutSize();\n        } else {\n            this._resetHorizontalAxisLayoutSize();\n        }\n    }\n\n    _resetHorizontalAxisLayoutSize() {\n        let w = FlexUtils.getRelAxisSize(this.item, true);\n        if (this._minWidth) {\n            w = Math.max(this._minWidth, w);\n        }\n        if (this._maxWidth) {\n            w = Math.min(this._maxWidth, w);\n        }\n        FlexUtils.setAxisLayoutSize(this.item, true, w);\n    }\n\n    _resetVerticalAxisLayoutSize() {\n        let h = FlexUtils.getRelAxisSize(this.item, false);\n        if (this._minHeight) {\n            h = Math.max(this._minHeight, h);\n        }\n        if (this._maxHeight) {\n            h = Math.min(this._maxHeight, h);\n        }\n        FlexUtils.setAxisLayoutSize(this.item, false, h);\n    }\n\n    _getCrossAxisMinSizeSetting() {\n        return this._getMinSizeSetting(!this.ctr._horizontal);\n    }\n\n    _getCrossAxisMaxSizeSetting() {\n        return this._getMaxSizeSetting(!this.ctr._horizontal);\n    }\n\n    _getMainAxisMaxSizeSetting() {\n        return this._getMaxSizeSetting(this.ctr._horizontal);\n    }\n\n    _getMinSizeSetting(horizontal) {\n        if (horizontal) {\n            return this._minWidth;\n        } else {\n            return this._minHeight;\n        }\n    }\n\n    _getMaxSizeSetting(horizontal) {\n        if (horizontal) {\n            return this._maxWidth;\n        } else {\n            return this._maxHeight;\n        }\n    }\n\n    _getMainAxisMinSize() {\n        return FlexUtils.getAxisMinSize(this.item, this.ctr._horizontal);\n    }\n\n    _getCrossAxisMinSize() {\n        return FlexUtils.getAxisMinSize(this.item, !this.ctr._horizontal);\n    }\n\n    _getMainAxisLayoutSize() {\n        return FlexUtils.getAxisLayoutSize(this.item, this.ctr._horizontal);\n    }\n\n    _getMainAxisLayoutPos() {\n        return FlexUtils.getAxisLayoutPos(this.item, this.ctr._horizontal);\n    }\n\n    _setMainAxisLayoutPos(pos) {\n        return FlexUtils.setAxisLayoutPos(this.item, this.ctr._horizontal, pos);\n    }\n\n    _setCrossAxisLayoutPos(pos) {\n        return FlexUtils.setAxisLayoutPos(this.item, !this.ctr._horizontal, pos);\n    }\n\n    _getCrossAxisLayoutSize() {\n        return FlexUtils.getAxisLayoutSize(this.item, !this.ctr._horizontal);\n    }\n\n    _resizeCrossAxis(size) {\n        return FlexUtils.resizeAxis(this.item, !this.ctr._horizontal, size);\n    }\n\n    _resizeMainAxis(size) {\n        return FlexUtils.resizeAxis(this.item, this.ctr._horizontal, size);\n    }\n\n    _getMainAxisPadding() {\n        return FlexUtils.getTotalPadding(this.item, this.ctr._horizontal);\n    }\n\n    _getCrossAxisPadding() {\n        return FlexUtils.getTotalPadding(this.item, !this.ctr._horizontal);\n    }\n\n    _getMainAxisMargin() {\n        return FlexUtils.getTotalMargin(this.item, this.ctr._horizontal);\n    }\n\n    _getCrossAxisMargin() {\n        return FlexUtils.getTotalMargin(this.item, !this.ctr._horizontal);\n    }\n\n    _getHorizontalMarginOffset() {\n        return FlexUtils.getMarginOffset(this.item, true);\n    }\n\n    _getVerticalMarginOffset() {\n        return FlexUtils.getMarginOffset(this.item, false);\n    }\n\n    _getMainAxisMinSizeWithPaddingAndMargin() {\n        return this._getMainAxisMinSize() + this._getMainAxisPadding() + this._getMainAxisMargin();\n    }\n\n    _getCrossAxisMinSizeWithPaddingAndMargin() {\n        return this._getCrossAxisMinSize() + this._getCrossAxisPadding() + this._getCrossAxisMargin();\n    }\n\n    _getMainAxisLayoutSizeWithPaddingAndMargin() {\n        return this._getMainAxisLayoutSize() + this._getMainAxisPadding() + this._getMainAxisMargin();\n    }\n\n    _getCrossAxisLayoutSizeWithPaddingAndMargin() {\n        return this._getCrossAxisLayoutSize() + this._getCrossAxisPadding() + this._getCrossAxisMargin();\n    }\n\n    _hasFixedCrossAxisSize() {\n        return !FlexUtils.isZeroAxisSize(this.item, !this.ctr._horizontal);\n    }\n\n    _hasRelCrossAxisSize() {\n        return !!(this.ctr._horizontal ? this.item.funcH : this.item.funcW);\n    }\n\n}\n\n\nFlexItem.SHRINK_AUTO = -1;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport FlexContainer from \"./FlexContainer.mjs\";\nimport FlexItem from \"./FlexItem.mjs\";\nimport FlexUtils from \"./FlexUtils.mjs\";\n\n/**\n * This is the connection between the render tree with the layout tree of this flex container/item.\n */\nexport default class FlexTarget {\n\n    constructor(target) {\n        this._target = target;\n\n        /**\n         * Possible values (only in case of container):\n         * bit 0: has changed or contains items with changes\n         * bit 1: width changed\n         * bit 2: height changed\n         */\n        this._recalc = 0;\n        \n        this._enabled = false;\n\n        this.x = 0;\n        this.y = 0;\n        this.w = 0;\n        this.h = 0;\n\n        this._originalX = 0;\n        this._originalY = 0;\n        this._originalWidth = 0;\n        this._originalHeight = 0;\n\n        this._flex = null;\n        this._flexItem = null;\n        this._flexItemDisabled = false;\n\n        this._items = null;\n    }\n\n    get flexLayout() {\n        return this.flex ? this.flex._layout : null;\n    }\n\n    layoutFlexTree() {\n        if (this.isFlexEnabled() && this.isChanged()) {\n            this.flexLayout.layoutTree();\n        }\n    }\n\n    get target() {\n        return this._target;\n    }\n\n    get flex() {\n        return this._flex;\n    }\n\n    set flex(v) {\n        if (!v) {\n            if (this.isFlexEnabled()) {\n                this._disableFlex();\n            }\n        } else {\n            if (!this.isFlexEnabled()) {\n                this._enableFlex();\n            }\n            this._flex.patch(v);\n        }\n    }\n\n    get flexItem() {\n        if (this._flexItemDisabled) {\n            return false;\n        }\n        this._ensureFlexItem();\n        return this._flexItem;\n    }\n\n    set flexItem(v) {\n        if (v === false) {\n            if (!this._flexItemDisabled) {\n                const parent = this.flexParent;\n                this._flexItemDisabled = true;\n                this._checkEnabled();\n                if (parent) {\n                    parent._clearFlexItemsCache();\n                    parent.changedContents();\n                }\n            }\n        } else {\n            this._ensureFlexItem();\n\n            this._flexItem.patch(v);\n\n            if (this._flexItemDisabled) {\n                this._flexItemDisabled = false;\n                this._checkEnabled();\n                const parent = this.flexParent;\n                if (parent) {\n                    parent._clearFlexItemsCache();\n                    parent.changedContents();\n                }\n            }\n        }\n    }\n\n    _enableFlex() {\n        this._flex = new FlexContainer(this);\n        this._checkEnabled();\n        this.changedDimensions();\n        this._enableChildrenAsFlexItems();\n    }\n\n    _disableFlex() {\n        this.changedDimensions();\n        this._flex = null;\n        this._checkEnabled();\n        this._disableChildrenAsFlexItems();\n    }\n\n    _enableChildrenAsFlexItems() {\n        const children = this._target._children;\n        if (children) {\n            for (let i = 0, n = children.length; i < n; i++) {\n                const child = children[i];\n                child.layout._enableFlexItem();\n            }\n        }\n    }\n\n    _disableChildrenAsFlexItems() {\n        const children = this._target._children;\n        if (children) {\n            for (let i = 0, n = children.length; i < n; i++) {\n                const child = children[i];\n                child.layout._disableFlexItem();\n            }\n        }\n    }\n\n    _enableFlexItem() {\n        this._ensureFlexItem();\n        const flexParent = this._target._parent._layout;\n        this._flexItem.ctr = flexParent._flex;\n        flexParent.changedContents();\n        this._checkEnabled();\n    }\n\n    _disableFlexItem() {\n        if (this._flexItem) {\n            this._flexItem.ctr = null;\n        }\n\n        // We keep the flexItem object because it may contain custom settings.\n        this._checkEnabled();\n\n        // Offsets have been changed. We can't recover them, so we'll just clear them instead.\n        this._resetOffsets();\n    }\n\n    _resetOffsets() {\n        this.x = 0;\n        this.y = 0;\n    }\n\n    _ensureFlexItem() {\n        if (!this._flexItem) {\n            this._flexItem = new FlexItem(this);\n        }\n    }\n\n    _checkEnabled() {\n        const enabled = this.isEnabled();\n        if (this._enabled !== enabled) {\n            if (enabled) {\n                this._enable();\n            } else {\n                this._disable();\n            }\n            this._enabled = enabled;\n        }\n    }\n    \n    _enable() {\n        this._setupTargetForFlex();\n        this._target.enableFlexLayout();\n    }\n\n    _disable() {\n        this._restoreTargetToNonFlex();\n        this._target.disableFlexLayout();\n    }\n\n    isEnabled() {\n        return this.isFlexEnabled() || this.isFlexItemEnabled();\n    }\n\n    isFlexEnabled() {\n        return this._flex !== null;\n    }\n\n    isFlexItemEnabled() {\n        return this.flexParent !== null;\n    }\n\n    _restoreTargetToNonFlex() {\n        const target = this._target;\n        target.x = this._originalX;\n        target.y = this._originalY;\n        target.setDimensions(this._originalWidth, this._originalHeight);\n    }\n\n    _setupTargetForFlex() {\n        const target = this._target;\n        this._originalX = target._x;\n        this._originalY = target._y;\n        this._originalWidth = target._w;\n        this._originalHeight = target._h;\n    }\n    \n    setParent(from, to) {\n        if (from && from.isFlexContainer()) {\n            from._layout._changedChildren();\n        }\n\n        if (to && to.isFlexContainer()) {\n            this._enableFlexItem();\n            to._layout._changedChildren();\n        }\n        this._checkEnabled();\n    }\n\n    get flexParent() {\n        if (this._flexItemDisabled) {\n            return null;\n        }\n\n        const parent = this._target._parent;\n        if (parent && parent.isFlexContainer()) {\n            return parent._layout;\n        }\n        return null;\n    }\n\n    setVisible(v) {\n        const parent = this.flexParent;\n        if (parent) {\n            parent._changedChildren();\n        }\n    }\n\n    get items() {\n        if (!this._items) {\n            this._items = this._getFlexItems();\n        }\n        return this._items;\n    }\n\n    _getFlexItems() {\n        const items = [];\n        const children = this._target._children;\n        if (children) {\n            for (let i = 0, n = children.length; i < n; i++) {\n                const item = children[i];\n                if (item.visible) {\n                    if (item.isFlexItem()) {\n                        items.push(item.layout);\n                    }\n                }\n            }\n        }\n        return items;\n    }\n\n    _changedChildren() {\n        this._clearFlexItemsCache();\n        this.changedContents();\n    }\n\n    _clearFlexItemsCache() {\n        this._items = null;\n    }\n\n    setLayout(x, y, w, h) {\n        let originalX = this._originalX;\n        let originalY = this._originalY;\n        if (this.funcX) {\n            originalX = this.funcX(FlexUtils.getParentAxisSizeWithPadding(this, true));\n        }\n        if (this.funcY) {\n            originalY = this.funcY(FlexUtils.getParentAxisSizeWithPadding(this, false));\n        }\n\n        if (this.isFlexItemEnabled()) {\n            this.target.setLayout(x + originalX, y + originalY, w, h);\n        } else {\n            // Reuse the x,y 'settings'.\n            this.target.setLayout(originalX, originalY, w, h);\n        }\n    }\n\n    changedDimensions(changeWidth = true, changeHeight = true) {\n        this._updateRecalc(changeWidth, changeHeight);\n    }\n\n    changedContents() {\n        this._updateRecalc();\n    }\n\n    forceLayout() {\n        this._updateRecalc();\n    }\n\n    isChanged() {\n        return this._recalc > 0;\n    }\n\n    _updateRecalc(changeExternalWidth = false, changeExternalHeight = false) {\n        if (this.isFlexEnabled()) {\n            const layout = this._flex._layout;\n\n            // When something internal changes, it can have effect on the external dimensions.\n            changeExternalWidth = changeExternalWidth || layout.isAxisFitToContents(true);\n            changeExternalHeight = changeExternalHeight || layout.isAxisFitToContents(false);\n        }\n\n        const recalc = 1 + (changeExternalWidth ? 2 : 0) + (changeExternalHeight ? 4 : 0);\n        const newRecalcFlags = this.getNewRecalcFlags(recalc);\n        this._recalc |= recalc;\n        if (newRecalcFlags > 1) {\n            if (this.flexParent) {\n                this.flexParent._updateRecalcBottomUp(recalc);\n            } else {\n                this._target.triggerLayout();\n            }\n        } else {\n            this._target.triggerLayout();\n        }\n    }\n\n    getNewRecalcFlags(flags) {\n        return (7 - this._recalc) & flags;\n    }\n\n    _updateRecalcBottomUp(childRecalc) {\n        const newRecalc = this._getRecalcFromChangedChildRecalc(childRecalc);\n        const newRecalcFlags = this.getNewRecalcFlags(newRecalc);\n        this._recalc |= newRecalc;\n        if (newRecalcFlags > 1) {\n            const flexParent = this.flexParent;\n            if (flexParent) {\n                flexParent._updateRecalcBottomUp(newRecalc);\n            } else {\n                this._target.triggerLayout();\n            }\n        } else {\n            this._target.triggerLayout();\n        }\n    }\n\n    _getRecalcFromChangedChildRecalc(childRecalc) {\n        const layout = this._flex._layout;\n\n        const mainAxisRecalcFlag = layout._horizontal ? 1 : 2;\n        const crossAxisRecalcFlag = layout._horizontal ? 2 : 1;\n\n        const crossAxisDimensionsChangedInChild = (childRecalc & crossAxisRecalcFlag);\n        if (!crossAxisDimensionsChangedInChild) {\n            const mainAxisDimensionsChangedInChild = (childRecalc & mainAxisRecalcFlag);\n            if (mainAxisDimensionsChangedInChild) {\n                const mainAxisIsWrapping = layout.isWrapping();\n                if (mainAxisIsWrapping) {\n                    const crossAxisIsFitToContents = layout.isCrossAxisFitToContents();\n                    if (crossAxisIsFitToContents) {\n                        // Special case: due to wrapping, the cross axis size may be changed.\n                        childRecalc += crossAxisRecalcFlag;\n                    }\n                }\n            }\n        }\n\n        let isWidthDynamic = layout.isAxisFitToContents(true);\n        let isHeightDynamic = layout.isAxisFitToContents(false);\n\n        if (layout.shrunk) {\n            // If during previous layout this container was 'shrunk', any changes may change the 'min axis size' of the\n            // contents, leading to a different axis size on this container even when it was not 'fit to contents'.\n            if (layout._horizontal) {\n                isWidthDynamic = true;\n            } else {\n                isHeightDynamic = true;\n            }\n        }\n\n        const localRecalc = 1 + (isWidthDynamic ? 2 : 0) + (isHeightDynamic ? 4 : 0);\n\n        const combinedRecalc = childRecalc & localRecalc;\n        return combinedRecalc;\n    }\n\n    get recalc() {\n        return this._recalc;\n    }\n\n    clearRecalcFlag() {\n        this._recalc = 0;\n    }\n\n    enableLocalRecalcFlag() {\n        this._recalc = 1;\n    }\n\n    get originalX() {\n        return this._originalX;\n    }\n\n    setOriginalXWithoutUpdatingLayout(v) {\n        this._originalX = v;\n    }\n\n    get originalY() {\n        return this._originalY;\n    }\n\n    setOriginalYWithoutUpdatingLayout(v) {\n        this._originalY = v;\n    }\n\n    get originalWidth() {\n        return this._originalWidth;\n    }\n\n    set originalWidth(v) {\n        if (this._originalWidth !== v) {\n            this._originalWidth = v;\n            this.changedDimensions(true, false);\n        }\n    }\n\n    get originalHeight() {\n        return this._originalHeight;\n    }\n\n    set originalHeight(v) {\n        if (this._originalHeight !== v) {\n            this._originalHeight = v;\n            this.changedDimensions(false, true);\n        }\n    }\n\n    get funcX() {\n        return this._target.funcX;\n    }\n\n    get funcY() {\n        return this._target.funcY;\n    }\n\n    get funcW() {\n        return this._target.funcW;\n    }\n\n    get funcH() {\n        return this._target.funcH;\n    }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class TextureSource {\n\n    constructor(manager, loader = null) {\n        this.id = TextureSource.id++;\n\n        this.manager = manager;\n\n        this.stage = manager.stage;\n\n        /**\n         * All enabled textures (textures that are used by visible elements).\n         * @type {Set<Texture>}\n         */\n        this.textures = new Set();\n\n        /**\n         * The number of active textures (textures that have at least one active element).\n         * @type {number}\n         * @private\n         */\n        this._activeTextureCount = 0;\n\n        /**\n         * The factory for the source of this texture.\n         * @type {Function}\n         */\n        this.loader = loader;\n\n        /**\n         * Identifier for reuse.\n         * @type {String}\n         */\n        this.lookupId = null;\n\n        /**\n         * If set, this.is called when the texture source is no longer displayed (this.components.size becomes 0).\n         * @type {Function}\n         */\n        this._cancelCb = null;\n\n        /**\n         * Loading since timestamp in millis.\n         * @type {number}\n         */\n        this.loadingSince = 0;\n\n        this.w = 0;\n        this.h = 0;\n\n        this._nativeTexture = null;\n\n        /**\n         * If true, then this.texture source is never freed from memory during garbage collection.\n         * @type {boolean}\n         */\n        this.permanent = false;\n\n        /**\n         * Sub-object with texture-specific rendering information.\n         * For images, contains the src property, for texts, contains handy rendering information.\n         * @type {Object}\n         */\n        this.renderInfo = null;\n\n        /**\n         * Generated for 'renderToTexture'.\n         * @type {boolean}\n         * @private\n         */\n        this._isResultTexture = !this.loader;\n\n        /**\n         * Contains the load error, if the texture source could previously not be loaded.\n         * @type {object}\n         * @private\n         */\n        this._loadError = null;\n\n        /**\n         *  Hold a reference to the javascript variable which contains the texture, this is not required for WebGL in WebBrowsers but is required for Spark runtime.\n         * @type {object}\n         * @private\n         */\n        this._imageRef = null;\n\n\n        /**\n         * Track whether or not there is an alpha channel in this source\n         * @type {boolean}\n         * @private\n         */\n         this._hasAlpha = false;\n    }\n\n    get hasAlpha() {\n        return this._hasAlpha;\n    }\n\n    get loadError() {\n        return this._loadError;\n    }\n\n    addTexture(v) {\n        if (!this.textures.has(v)) {\n            this.textures.add(v);\n        }\n    }\n\n    removeTexture(v) {\n        this.textures.delete(v);\n    }\n\n    incActiveTextureCount() {\n        this._activeTextureCount++;\n        if (this._activeTextureCount === 1) {\n            this.becomesUsed();\n        }\n    }\n\n    decActiveTextureCount() {\n        this._activeTextureCount--;\n        if (this._activeTextureCount === 0) {\n            this.becomesUnused();\n        }\n    }\n\n    get isResultTexture() {\n        return this._isResultTexture;\n    }\n\n    set isResultTexture(v) {\n        this._isResultTexture = v;\n    }\n\n    forEachEnabledElement(cb) {\n        this.textures.forEach(texture => {\n            texture.elements.forEach(cb);\n        });\n    }\n\n    hasEnabledElements() {\n        return this.textures.size > 0;\n    }\n\n    forEachActiveElement(cb) {\n        this.textures.forEach(texture => {\n            texture.elements.forEach(element => {\n                if (element.active) {\n                    cb(element);\n                }\n            });\n        });\n    }\n\n    getRenderWidth() {\n        return this.w;\n    }\n\n    getRenderHeight() {\n        return this.h;\n    }\n\n    allowCleanup() {\n        return !this.permanent && !this.isUsed();\n    }\n\n    becomesUsed() {\n        // Even while the texture is being loaded, make sure it is on the lookup map so that others can reuse it.\n        this.load();\n    }\n\n    becomesUnused() {\n        this.cancel();\n    }\n\n    cancel() {\n        if (this.isLoading()) {\n            if (this._cancelCb) {\n                this._cancelCb(this);\n\n                // Clear callback to avoid memory leaks.\n                this._cancelCb = null;\n            }\n            this.loadingSince = 0;\n        }\n    }\n\n    isLoaded() {\n        return !!this._nativeTexture;\n    }\n\n    isLoading() {\n        return (this.loadingSince > 0);\n    }\n\n    isError() {\n        return !!this._loadError;\n    }\n\n    reload() {\n        this.free();\n        if (this.isUsed()) {\n            this.load();\n        }\n    }\n\n    load(forceSync = false) {\n        // From the moment of loading (when a texture source becomes used by active elements)\n        if (this.isResultTexture) {\n            // Element result texture source, for which the loading is managed by the core.\n            return;\n        }\n\n        if (!this._nativeTexture && !this.isLoading()) {\n            this.loadingSince = (new Date()).getTime();\n            this._cancelCb = this.loader((err, options) => {\n                // Ignore loads that come in after a cancel.\n                if (this.isLoading()) {\n                    // Clear callback to avoid memory leaks.\n                    this._cancelCb = null;\n\n                    if (this.manager.stage.destroyed) {\n                        // Ignore async load when stage is destroyed.\n                        return;\n                    }\n                    if (err) {\n                        // Emit txError.\n                        this.onError(err);\n                    } else if (options && options.source) {\n                        if (!this.stage.isUpdatingFrame() && !forceSync && (options.throttle !== false)) {\n                            const textureThrottler = this.stage.textureThrottler;\n                            this._cancelCb = textureThrottler.genericCancelCb;\n                            textureThrottler.add(this, options);\n                        } else {\n                            this.processLoadedSource(options);\n                        }\n                    }\n                }\n            }, this);\n        }\n    }\n\n    processLoadedSource(options) {\n        this.loadingSince = 0;\n        this.setSource(options);\n    }\n\n    setSource(options) {\n        const source = options.source;\n\n        this._hasAlpha = (options ? (options.hasAlpha || false) : false);\n        this.w = source.width || (options && options.w) || 0;\n        this.h = source.height || (options && options.h) || 0;\n\n        if (options && options.renderInfo) {\n            // Assign to id in cache so that it can be reused.\n            this.renderInfo = options.renderInfo;\n        }\n\n        this.permanent = !!options.permanent;\n\n        if (options && options.imageRef)\n            this._imageRef = options.imageRef;\n        if (options && options.flipTextureY) {\n            this._flipTextureY = options.flipTextureY;\n        } else {\n            this._flipTextureY = false;\n        }\n\n        if (this._isNativeTexture(source)) {\n            // Texture managed by caller.\n            this._nativeTexture = source;\n\n            this.w = this.w || source.w;\n            this.h = this.h || source.h;\n\n            // WebGLTexture objects are by default;\n            this.permanent = options.hasOwnProperty('permanent') ? options.permanent : true;\n        } else {\n            this.manager.uploadTextureSource(this, options);\n        }\n\n        // Must be cleared when reload is succesful.\n        this._loadError = null;\n\n        this.onLoad();\n    }\n\n    isUsed() {\n        return this._activeTextureCount > 0;\n    }\n\n    onLoad() {\n        if (this.isUsed()) {\n            this.textures.forEach(texture => {\n                texture.onLoad();\n            });\n        }\n    }\n\n    forceRenderUpdate() {\n        // Userland should call this method after changing the nativeTexture manually outside of the framework\n        //  (using tex[Sub]Image2d for example).\n\n        if (this._nativeTexture) {\n            // Change 'update' flag. This is currently not used by the framework but is handy in userland.\n            this._nativeTexture.update = this.stage.frameCounter;\n        }\n\n        this.forEachActiveElement(function (element) {\n            element.forceRenderUpdate();\n        });\n\n    }\n\n    forceUpdateRenderCoords() {\n        this.forEachActiveElement(function (element) {\n            element._updateTextureCoords();\n        });\n    }\n\n    get nativeTexture() {\n        return this._nativeTexture;\n    }\n\n    clearNativeTexture() {\n        this._nativeTexture = null;\n        //also clear the reference to the texture variable.\n        this._imageRef = null;\n    }\n\n    /**\n     * Used for result textures.\n     */\n    replaceNativeTexture(newNativeTexture, w, h) {\n        let prevNativeTexture = this._nativeTexture;\n        // Loaded by core.\n        this._nativeTexture = newNativeTexture;\n        this.w = w;\n        this.h = h;\n\n        if (!prevNativeTexture && this._nativeTexture) {\n            this.forEachActiveElement(element => element.onTextureSourceLoaded());\n        }\n\n        if (!this._nativeTexture) {\n            this.forEachActiveElement(element => element._setDisplayedTexture(null));\n        }\n\n        // Dimensions must be updated also on enabled elements, as it may force it to go within bounds.\n        this.forEachEnabledElement(element => element._updateDimensions());\n\n        // Notice that the sprite map must never contain render textures.\n    }\n\n    onError(e) {\n        this._loadError = e;\n        this.loadingSince = 0;\n        console.error('[Lightning] texture load error', e, this.lookupId);\n        this.forEachActiveElement(element => element.onTextureSourceLoadError(e));\n    }\n\n    free() {\n        if (this.isLoaded()) {\n            this.manager.freeTextureSource(this);\n        }\n    }\n\n    _isNativeTexture(source) {\n        if (Utils.isNode) {\n            return source.constructor.name === \"WebGLTexture\";\n        }\n\n        if ('WebGLTexture' in window) {\n            return source instanceof WebGLTexture;\n        }\n\n        return false;\n    }\n\n}\n\nTextureSource.prototype.isTextureSource = true;\n\nTextureSource.id = 1;\n\nimport Utils from \"./Utils.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport TextureSource from '../TextureSource.mjs';\n\nexport default class ElementTexturizer {\n\n    constructor(elementCore) {\n\n        this._element = elementCore.element;\n        this._core = elementCore;\n\n        this.ctx = this._core.ctx;\n\n        this._enabled = false;\n        this.lazy = false;\n        this._colorize = false;\n\n        this._renderTexture = null;\n\n        this._renderTextureReused = false;\n\n        this._resultTextureSource = null;\n\n        this._renderOffscreen = false;\n\n        this.empty = false;\n    }\n\n    get enabled() {\n        return this._enabled;\n    }\n\n    set enabled(v) {\n        this._enabled = v;\n        this._core.updateRenderToTextureEnabled();\n    }\n\n    get renderOffscreen() {\n        return this._renderOffscreen;\n    }\n\n    set renderOffscreen(v) {\n        this._renderOffscreen = v;\n        this._core.setHasRenderUpdates(1);\n\n        // This enforces rechecking the 'within bounds'.\n        this._core._setRecalc(6);\n    }\n\n    get colorize() {\n        return this._colorize;\n    }\n\n    set colorize(v) {\n        if (this._colorize !== v) {\n            this._colorize = v;\n\n            // Only affects the finally drawn quad.\n            this._core.setHasRenderUpdates(1);\n        }\n    }\n\n    _getTextureSource() {\n        if (!this._resultTextureSource) {\n            this._resultTextureSource = new TextureSource(this._element.stage.textureManager);\n            this.updateResultTexture();\n        }\n        return this._resultTextureSource;\n    }\n\n    hasResultTexture() {\n        return !!this._resultTextureSource;\n    }\n\n    resultTextureInUse() {\n        return this._resultTextureSource && this._resultTextureSource.hasEnabledElements();\n    }\n\n    updateResultTexture() {\n        let resultTexture = this.getResultTexture();\n        if (this._resultTextureSource) {\n            if (this._resultTextureSource.nativeTexture !== resultTexture) {\n                let w = resultTexture ? resultTexture.w : 0;\n                let h = resultTexture ? resultTexture.h : 0;\n                this._resultTextureSource.replaceNativeTexture(resultTexture, w, h);\n            }\n\n            // Texture will be updated: all elements using the source need to be updated as well.\n            this._resultTextureSource.forEachEnabledElement(element => {\n                element._updateDimensions();\n                element.core.setHasRenderUpdates(3);\n            });\n        }\n    }\n\n    mustRenderToTexture() {\n        // Check if we must really render as texture.\n        if (this._enabled && !this.lazy) {\n            return true;\n        } else if (this._enabled && this.lazy && this._core._hasRenderUpdates < 3) {\n            // Static-only: if renderToTexture did not need to update during last drawn frame, generate it as a cache.\n            return true;\n        }\n        return false;\n    }\n\n    deactivate() {\n        this.release();\n    }\n\n    get renderTextureReused() {\n        return this._renderTextureReused;\n    }\n\n    release() {\n        this.releaseRenderTexture();\n    }\n\n    releaseRenderTexture() {\n        if (this._renderTexture) {\n            if (!this._renderTextureReused) {\n                this.ctx.releaseRenderTexture(this._renderTexture);\n            }\n            this._renderTexture = null;\n            this._renderTextureReused = false;\n            this.updateResultTexture();\n        }\n    }\n\n    // Reuses the specified texture as the render texture (in ancestor).\n    reuseTextureAsRenderTexture(nativeTexture) {\n        if (this._renderTexture !== nativeTexture) {\n            this.releaseRenderTexture();\n            this._renderTexture = nativeTexture;\n            this._renderTextureReused = true;\n        }\n    }\n\n    hasRenderTexture() {\n        return !!this._renderTexture;\n    }\n\n    getRenderTexture() {\n        if (!this._renderTexture) {\n            this._renderTexture = this.ctx.allocateRenderTexture(this._core._w, this._core._h);\n            this._renderTextureReused = false;\n        }\n        return this._renderTexture;\n    }\n\n    getResultTexture() {\n        return this._renderTexture;\n    }\n\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport FlexTarget from \"../../flex/FlexTarget.mjs\";\n\nexport default class ElementCore {\n\n    constructor(element) {\n        this._element = element;\n\n        this.ctx = element.stage.ctx;\n\n        // The memory layout of the internal variables is affected by their position in the constructor.\n        // It boosts performance to order them by usage of cpu-heavy functions (renderSimple and update).\n\n        this._recalc = 0;\n\n        this._parent = null;\n\n        this._onUpdate = null;\n\n        this._pRecalc = 0;\n\n        this._worldContext = new ElementCoreContext();\n\n        this._hasUpdates = false;\n\n        this._localAlpha = 1;\n\n        this._onAfterCalcs = null;\n\n        this._onAfterUpdate = null;\n\n        // All local translation/transform updates: directly propagated from x/y/w/h/scale/whatever.\n        this._localPx = 0;\n        this._localPy = 0;\n\n        this._localTa = 1;\n        this._localTb = 0;\n        this._localTc = 0;\n        this._localTd = 1;\n\n        this._isComplex = false;\n\n        this._dimsUnknown = false;\n\n        this._clipping = false;\n\n        // Used by both update and render.\n        this._zSort = false;\n\n        this._outOfBounds = 0;\n\n        /**\n         * The texture source to be displayed.\n         * @type {TextureSource}\n         */\n        this._displayedTextureSource = null;\n\n        this._zContextUsage = 0;\n\n        this._children = null;\n\n        this._hasRenderUpdates = 0;\n\n        this._zIndexedChildren = null;\n\n        this._renderContext = this._worldContext;\n\n        this.renderState = this.ctx.renderState;\n\n        this._scissor = null;\n\n        // The ancestor ElementCore that owns the inherited shader. Null if none is active (default shader).\n        this._shaderOwner = null;\n\n\n        this._updateTreeOrder = 0;\n\n        this._colorUl = this._colorUr = this._colorBl = this._colorBr = 0xFFFFFFFF;\n\n        this._x = 0;\n        this._y = 0;\n        this._w = 0;\n        this._h = 0;\n\n        this._optFlags = 0;\n        this._funcX = null;\n        this._funcY = null;\n        this._funcW = null;\n        this._funcH = null;\n\n        this._scaleX = 1;\n        this._scaleY = 1;\n        this._pivotX = 0.5;\n        this._pivotY = 0.5;\n        this._mountX = 0;\n        this._mountY = 0;\n        this._rotation = 0;\n\n        this._alpha = 1;\n        this._visible = true;\n\n        this._ulx = 0;\n        this._uly = 0;\n        this._brx = 1;\n        this._bry = 1;\n\n        this._zIndex = 0;\n        this._forceZIndexContext = false;\n        this._zParent = null;\n\n        this._isRoot = false;\n\n        /**\n         * Iff true, during zSort, this element should be 're-sorted' because either:\n         * - zIndex did chang\n         * - zParent did change\n         * - element was moved in the render tree\n         * @type {boolean}\n         */\n        this._zIndexResort = false;\n\n        this._shader = null;\n\n        // Element is rendered on another texture.\n        this._renderToTextureEnabled = false;\n\n        this._texturizer = null;\n\n        this._useRenderToTexture = false;\n\n        this._boundsMargin = null;\n\n        this._recBoundsMargin = null;\n\n        this._withinBoundsMargin = false;\n\n        this._viewport = null;\n\n        this._clipbox = true;\n\n        this.render = this._renderSimple;\n\n        this._layout = null;\n    }\n\n    get offsetX() {\n        if (this._funcX) {\n            return this._funcX;\n        } else {\n            if (this.hasFlexLayout()) {\n                return this._layout.originalX;\n            } else {\n                return this._x;\n            }\n        }\n    }\n\n    set offsetX(v) {\n        if (Utils.isFunction(v)) {\n            this.funcX = v;\n        } else {\n            this._disableFuncX();\n            if (this.hasFlexLayout()) {\n                this.x += (v - this._layout.originalX);\n                this._layout.setOriginalXWithoutUpdatingLayout(v);\n            } else {\n                this.x = v;\n            }\n        }\n    }\n\n    get x() {\n        return this._x;\n    }\n\n    set x(v) {\n        if (v !== this._x) {\n            this._updateLocalTranslateDelta(v - this._x, 0);\n            this._x = v;\n        }\n    }\n\n    get funcX() {\n        return (this._optFlags & 1 ? this._funcX : null);\n    }\n\n    set funcX(v) {\n        if (this._funcX !== v) {\n            this._optFlags |= 1;\n            this._funcX = v;\n            if (this.hasFlexLayout()) {\n                this._layout.setOriginalXWithoutUpdatingLayout(0);\n                this.layout.forceLayout();\n            } else {\n                this._x = 0;\n                this._triggerRecalcTranslate();\n            }\n        }\n    }\n\n    _disableFuncX() {\n        this._optFlags = this._optFlags & (0xFFFF - 1);\n        this._funcX = null;\n    }\n\n    get offsetY() {\n        if (this._funcY) {\n            return this._funcY;\n        } else {\n            if (this.hasFlexLayout()) {\n                return this._layout.originalY;\n            } else {\n                return this._y;\n            }\n        }\n    }\n\n    set offsetY(v) {\n        if (Utils.isFunction(v)) {\n            this.funcY = v;\n        } else {\n            this._disableFuncY();\n            if (this.hasFlexLayout()) {\n                this.y += (v - this._layout.originalY);\n                this._layout.setOriginalYWithoutUpdatingLayout(v);\n            } else {\n                this.y = v;\n            }\n        }\n    }\n\n    get y() {\n        return this._y;\n    }\n\n    set y(v) {\n        if (v !== this._y) {\n            this._updateLocalTranslateDelta(0, v - this._y);\n            this._y = v;\n        }\n    }\n\n    get funcY() {\n        return (this._optFlags & 2 ? this._funcY : null);\n    }\n\n    set funcY(v) {\n        if (this._funcY !== v) {\n            this._optFlags |= 2;\n            this._funcY = v;\n            if (this.hasFlexLayout()) {\n                this._layout.setOriginalYWithoutUpdatingLayout(0);\n                this.layout.forceLayout();\n            } else {\n                this._y = 0;\n                this._triggerRecalcTranslate();\n            }\n        }\n    }\n\n    _disableFuncY() {\n        this._optFlags = this._optFlags & (0xFFFF - 2);\n        this._funcY = null;\n    }\n\n    get funcW() {\n        return (this._optFlags & 4 ? this._funcW : null);\n    }\n\n    set funcW(v) {\n        if (this._funcW !== v) {\n            this._optFlags |= 4;\n            this._funcW = v;\n            if (this.hasFlexLayout()) {\n                this._layout._originalWidth = 0;\n                this.layout.changedDimensions(true, false);\n            } else {\n                this._w = 0;\n                this._triggerRecalcTranslate();\n            }\n        }\n    }\n\n    disableFuncW() {\n        this._optFlags = this._optFlags & (0xFFFF - 4);\n        this._funcW = null;\n    }\n\n    get funcH() {\n        return (this._optFlags & 8 ? this._funcH : null);\n    }\n\n    set funcH(v) {\n        if (this._funcH !== v) {\n            this._optFlags |= 8;\n            this._funcH = v;\n            if (this.hasFlexLayout()) {\n                this._layout._originalHeight = 0;\n                this.layout.changedDimensions(false, true);\n            } else {\n                this._h = 0;\n                this._triggerRecalcTranslate();\n            }\n        }\n    }\n\n    disableFuncH() {\n        this._optFlags = this._optFlags & (0xFFFF - 8);\n        this._funcH = null;\n    }\n\n    get w() {\n        return this._w;\n    }\n\n    getRenderWidth() {\n        if (this.hasFlexLayout()) {\n            return this._layout.originalWidth;\n        } else {\n            return this._w;\n        }\n    }\n\n    get h() {\n        return this._h;\n    }\n\n    getRenderHeight() {\n        if (this.hasFlexLayout()) {\n            return this._layout.originalHeight;\n        } else {\n            return this._h;\n        }\n    }\n\n    get scaleX() {\n        return this._scaleX;\n    }\n\n    set scaleX(v) {\n        if (this._scaleX !== v) {\n            this._scaleX = v;\n            this._updateLocalTransform();\n        }\n    }\n\n    get scaleY() {\n        return this._scaleY;\n    }\n\n    set scaleY(v) {\n        if (this._scaleY !== v) {\n            this._scaleY = v;\n            this._updateLocalTransform();\n        }\n    }\n\n    get scale() {\n        return this.scaleX;\n    }\n\n    set scale(v) {\n        if (this._scaleX !== v || this._scaleY !== v) {\n            this._scaleX = v;\n            this._scaleY = v;\n            this._updateLocalTransform();\n        }\n    }\n\n    get pivotX() {\n        return this._pivotX;\n    }\n\n    set pivotX(v) {\n        if (this._pivotX !== v) {\n            this._pivotX = v;\n            this._updateLocalTranslate();\n        }\n    }\n\n    get pivotY() {\n        return this._pivotY;\n    }\n\n    set pivotY(v) {\n        if (this._pivotY !== v) {\n            this._pivotY = v;\n            this._updateLocalTranslate();\n        }\n    }\n\n    get pivot() {\n        return this._pivotX;\n    }\n\n    set pivot(v) {\n        if (this._pivotX !== v || this._pivotY !== v) {\n            this._pivotX = v;\n            this._pivotY = v;\n            this._updateLocalTranslate();\n        }\n    }\n\n    get mountX() {\n        return this._mountX;\n    }\n\n    set mountX(v) {\n        if (this._mountX !== v) {\n            this._mountX = v;\n            this._updateLocalTranslate();\n        }\n    }\n\n    get mountY() {\n        return this._mountY;\n    }\n\n    set mountY(v) {\n        if (this._mountY !== v) {\n            this._mountY = v;\n            this._updateLocalTranslate();\n        }\n    }\n\n    get mount() {\n        return this._mountX;\n    }\n\n    set mount(v) {\n        if (this._mountX !== v || this._mountY !== v) {\n            this._mountX = v;\n            this._mountY = v;\n            this._updateLocalTranslate();\n        }\n    }\n\n    get rotation() {\n        return this._rotation;\n    }\n\n    set rotation(v) {\n        if (this._rotation !== v) {\n            this._rotation = v;\n            this._updateLocalTransform();\n        }\n    }\n\n    get alpha() {\n        return this._alpha;\n    }\n\n    set alpha(v) {\n        // Account for rounding errors.\n        v = (v > 1 ? 1 : (v < 1e-14 ? 0 : v));\n        if (this._alpha !== v) {\n            let prev = this._alpha;\n            this._alpha = v;\n            this._updateLocalAlpha();\n            if ((prev === 0) !== (v === 0)) {\n                this._element._updateEnabledFlag();\n            }\n        }\n    }\n\n    get visible() {\n        return this._visible;\n    }\n\n    set visible(v) {\n        if (this._visible !== v) {\n            this._visible = v;\n            this._updateLocalAlpha();\n            this._element._updateEnabledFlag();\n\n            if (this.hasFlexLayout()) {\n                this.layout.setVisible(v);\n            }\n        }\n    }\n\n    _updateLocalTransform() {\n        if (this._rotation !== 0 && this._rotation % (2 * Math.PI)) {\n            // check to see if the rotation is the same as the previous render. This means we only need to use sin and cos when rotation actually changes\n            let _sr = Math.sin(this._rotation);\n            let _cr = Math.cos(this._rotation);\n\n            this._setLocalTransform(\n                _cr * this._scaleX,\n                -_sr * this._scaleY,\n                _sr * this._scaleX,\n                _cr * this._scaleY\n            );\n        } else {\n            this._setLocalTransform(\n                this._scaleX,\n                0,\n                0,\n                this._scaleY\n            );\n        }\n        this._updateLocalTranslate();\n    };\n\n    _updateLocalTranslate() {\n        this._recalcLocalTranslate();\n        this._triggerRecalcTranslate();\n    };\n\n    _recalcLocalTranslate() {\n        let pivotXMul = this._pivotX * this._w;\n        let pivotYMul = this._pivotY * this._h;\n        let px = this._x - (pivotXMul * this._localTa + pivotYMul * this._localTb) + pivotXMul;\n        let py = this._y - (pivotXMul * this._localTc + pivotYMul * this._localTd) + pivotYMul;\n        px -= this._mountX * this._w;\n        py -= this._mountY * this._h;\n        this._localPx = px;\n        this._localPy = py;\n    }\n\n    _updateLocalTranslateDelta(dx, dy) {\n        this._addLocalTranslate(dx, dy);\n    };\n\n    _updateLocalAlpha() {\n        this._setLocalAlpha(this._visible ? this._alpha : 0);\n    };\n\n    /**\n     * @param {number} type\n     * 0: no updates\n     * 1: re-invoke shader\n     * 3: re-create render texture and re-invoke shader\n     */\n    setHasRenderUpdates(type) {\n        if (this._worldContext.alpha) {\n            // Ignore if 'world invisible'. Render updates will be reset to 3 for every element that becomes visible.\n            let p = this;\n            p._hasRenderUpdates = Math.max(type, p._hasRenderUpdates);\n            while ((p = p._parent) && (p._hasRenderUpdates !== 3)) {\n                p._hasRenderUpdates = 3;\n            }\n        }\n    }\n\n    /**\n     * @param {Number} type\n     *   1: alpha\n     *   2: translate\n     *   4: transform\n     * 128: becomes visible\n     * 256: flex layout updated\n     */\n    _setRecalc(type) {\n        this._recalc |= type;\n\n        this._setHasUpdates();\n\n        // Any changes in descendants should trigger texture updates.\n        if (this._parent) {\n            this._parent.setHasRenderUpdates(3);\n        }\n    }\n\n    _setHasUpdates() {\n        let p = this;\n        while (p && !p._hasUpdates) {\n            p._hasUpdates = true;\n            p = p._parent;\n        }\n    }\n\n    getParent() {\n        return this._parent;\n    }\n\n    setParent(parent) {\n        if (parent !== this._parent) {\n            let prevIsZContext = this.isZContext();\n            let prevParent = this._parent;\n            this._parent = parent;\n\n            // Notify flex layout engine.\n            if (this._layout || (parent && parent.isFlexContainer())) {\n                this.layout.setParent(prevParent, parent);\n            }\n\n            if (prevParent) {\n                // When elements are deleted, the render texture must be re-rendered.\n                prevParent.setHasRenderUpdates(3);\n            }\n\n            this._setRecalc(1 + 2 + 4);\n\n            if (this._parent) {\n                // Force parent to propagate hasUpdates flag.\n                this._parent._setHasUpdates();\n            }\n\n            if (this._zIndex === 0) {\n                this.setZParent(parent);\n            } else {\n                this.setZParent(parent ? parent.findZContext() : null);\n            }\n\n            if (prevIsZContext !== this.isZContext()) {\n                if (!this.isZContext()) {\n                    this.disableZContext();\n                } else {\n                    this.enableZContext(prevParent.findZContext());\n                }\n            }\n\n            // Tree order did change: even if zParent stays the same, we must resort.\n            this._zIndexResort = true;\n            if (this._zParent) {\n                this._zParent.enableZSort();\n            }\n\n            if (!this._shader) {\n                let newShaderOwner = parent && !parent._renderToTextureEnabled ? parent._shaderOwner : null;\n                if (newShaderOwner !== this._shaderOwner) {\n                    this.setHasRenderUpdates(1);\n                    this._setShaderOwnerRecursive(newShaderOwner);\n                }\n            }\n        }\n    };\n\n    enableZSort(force = false) {\n        if (!this._zSort && this._zContextUsage > 0) {\n            this._zSort = true;\n            if (force) {\n                // ZSort must be done, even if this element is invisible.\n                // This is done to prevent memory leaks when removing element from inactive render branches.\n                this.ctx.forceZSort(this);\n            }\n        }\n    }\n\n    addChildAt(index, child) {\n        if (!this._children) this._children = [];\n        this._children.splice(index, 0, child);\n        child.setParent(this);\n    };\n\n    setChildAt(index, child) {\n        if (!this._children) this._children = [];\n        this._children[index].setParent(null);\n        this._children[index] = child;\n        child.setParent(this);\n    }\n\n    removeChildAt(index) {\n        let child = this._children[index];\n        this._children.splice(index, 1);\n        child.setParent(null);\n    };\n\n    removeChildren() {\n        if (this._children) {\n            for (let i = 0, n = this._children.length; i < n; i++) {\n                this._children[i].setParent(null);\n            }\n\n            this._children.splice(0);\n\n            if (this._zIndexedChildren) {\n                this._zIndexedChildren.splice(0);\n            }\n        }\n    };\n\n    syncChildren(removed, added, order) {\n        this._children = order;\n        for (let i = 0, n = removed.length; i < n; i++) {\n            removed[i].setParent(null);\n        }\n        for (let i = 0, n = added.length; i < n; i++) {\n            added[i].setParent(this);\n        }\n    }\n\n    moveChild(fromIndex, toIndex) {\n        let c = this._children[fromIndex];\n        this._children.splice(fromIndex, 1);\n        this._children.splice(toIndex, 0, c);\n\n        // Tree order changed: must resort!;\n        this._zIndexResort = true;\n        if (this._zParent) {\n            this._zParent.enableZSort();\n        }\n    }\n\n    _setLocalTransform(a, b, c, d) {\n        this._setRecalc(4);\n        this._localTa = a;\n        this._localTb = b;\n        this._localTc = c;\n        this._localTd = d;\n\n        // We also regard negative scaling as a complex case, so that we can optimize the non-complex case better.\n        this._isComplex = (b !== 0) || (c !== 0) || (a < 0) || (d < 0);\n    };\n\n    _addLocalTranslate(dx, dy) {\n        this._localPx += dx;\n        this._localPy += dy;\n        this._triggerRecalcTranslate();\n    }\n\n    _setLocalAlpha(a) {\n        if (!this._worldContext.alpha && ((this._parent && this._parent._worldContext.alpha) && a)) {\n            // Element is becoming visible. We need to force update.\n            this._setRecalc(1 + 128);\n        } else {\n            this._setRecalc(1);\n        }\n\n        if (a < 1e-14) {\n            // Tiny rounding errors may cause failing visibility tests.\n            a = 0;\n        }\n\n        this._localAlpha = a;\n    };\n\n    setDimensions(w, h, isEstimate = this._dimsUnknown) {\n        // In case of an estimation, the update loop should perform different bound checks.\n        this._dimsUnknown = isEstimate;\n\n        if (this.hasFlexLayout()) {\n            this._layout.originalWidth = w;\n            this._layout.originalHeight = h;\n        } else {\n            if (this._w !== w || this._h !== h) {\n                this._updateDimensions(w, h);\n                return true;\n            }\n        }\n        return false;\n    };\n\n    _updateDimensions(w, h) {\n        if (this._w !== w || this._h !== h) {\n            this._w = w;\n            this._h = h;\n\n            this._triggerRecalcTranslate();\n\n            if (this._texturizer) {\n                this._texturizer.releaseRenderTexture();\n                this._texturizer.updateResultTexture();\n            }\n            // Due to width/height change: update the translation vector.\n            this._updateLocalTranslate();\n        }\n    }\n\n    setTextureCoords(ulx, uly, brx, bry) {\n        this.setHasRenderUpdates(3);\n\n        this._ulx = ulx;\n        this._uly = uly;\n        this._brx = brx;\n        this._bry = bry;\n    };\n\n    get displayedTextureSource() {\n        return this._displayedTextureSource;\n    }\n\n    setDisplayedTextureSource(textureSource) {\n        this.setHasRenderUpdates(3);\n        this._displayedTextureSource = textureSource;\n    };\n\n    get isRoot() {\n        return this._isRoot;\n    }\n\n    setAsRoot() {\n        // Use parent dummy.\n        this._parent = new ElementCore(this._element);\n\n        // After setting root, make sure it's updated.\n        this._parent._hasRenderUpdates = 3;\n        this._parent._hasUpdates = true;\n\n        // Root is, and will always be, the primary zContext.\n        this._isRoot = true;\n\n        this.ctx.root = this;\n\n        // Set scissor area of 'fake parent' to stage's viewport.\n        this._parent._viewport = [0, 0, this.ctx.stage.coordsWidth, this.ctx.stage.coordsHeight];\n        this._parent._scissor = this._parent._viewport;\n\n        // When recBoundsMargin is null, the defaults are used (100 for all sides).\n        this._parent._recBoundsMargin = null;\n\n        this._setRecalc(1 + 2 + 4);\n    };\n\n    isAncestorOf(c) {\n        let p = c;\n        while (p = p._parent) {\n            if (this === p) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    isZContext() {\n        return (this._forceZIndexContext || this._renderToTextureEnabled || this._zIndex !== 0 || this._isRoot || !this._parent);\n    };\n\n    findZContext() {\n        if (this.isZContext()) {\n            return this;\n        } else {\n            return this._parent.findZContext();\n        }\n    };\n\n    setZParent(newZParent) {\n        if (this._zParent !== newZParent) {\n            if (this._zParent !== null) {\n                if (this._zIndex !== 0) {\n                    this._zParent.decZContextUsage();\n                }\n\n                // We must filter out this item upon the next resort.\n                this._zParent.enableZSort();\n            }\n\n            if (newZParent !== null) {\n                let hadZContextUsage = (newZParent._zContextUsage > 0);\n\n                // @pre: new parent's children array has already been modified.\n                if (this._zIndex !== 0) {\n                    newZParent.incZContextUsage();\n                }\n\n                if (newZParent._zContextUsage > 0) {\n                    if (!hadZContextUsage && (this._parent === newZParent)) {\n                        // This child was already in the children list.\n                        // Do not add double.\n                    } else {\n                        // Add new child to array.\n                        newZParent._zIndexedChildren.push(this);\n                    }\n\n                    // Order should be checked.\n                    newZParent.enableZSort();\n                }\n            }\n\n            this._zParent = newZParent;\n\n            // Newly added element must be marked for resort.\n            this._zIndexResort = true;\n        }\n    };\n\n    incZContextUsage() {\n        this._zContextUsage++;\n        if (this._zContextUsage === 1) {\n            if (!this._zIndexedChildren) {\n                this._zIndexedChildren = [];\n            }\n            if (this._children) {\n                // Copy.\n                for (let i = 0, n = this._children.length; i < n; i++) {\n                    this._zIndexedChildren.push(this._children[i]);\n                }\n                // Initially, children are already sorted properly (tree order).\n                this._zSort = false;\n            }\n        }\n    };\n\n    decZContextUsage() {\n        this._zContextUsage--;\n        if (this._zContextUsage === 0) {\n            this._zSort = false;\n            this._zIndexedChildren.splice(0);\n        }\n    };\n\n    get zIndex() {\n        return this._zIndex;\n    }\n\n    set zIndex(zIndex) {\n        if (this._zIndex !== zIndex) {\n            this.setHasRenderUpdates(1);\n\n            let newZParent = this._zParent;\n\n            let prevIsZContext = this.isZContext();\n            if (zIndex === 0 && this._zIndex !== 0) {\n                if (this._parent === this._zParent) {\n                    if (this._zParent) {\n                        this._zParent.decZContextUsage();\n                    }\n                } else {\n                    newZParent = this._parent;\n                }\n            } else if (zIndex !== 0 && this._zIndex === 0) {\n                newZParent = this._parent ? this._parent.findZContext() : null;\n                if (newZParent === this._zParent) {\n                    if (this._zParent) {\n                        this._zParent.incZContextUsage();\n                        this._zParent.enableZSort();\n                    }\n                }\n            } else if (zIndex !== this._zIndex) {\n                if (this._zParent && this._zParent._zContextUsage) {\n                    this._zParent.enableZSort();\n                }\n            }\n\n            if (newZParent !== this._zParent) {\n                this.setZParent(null);\n            }\n\n            this._zIndex = zIndex;\n\n            if (newZParent !== this._zParent) {\n                this.setZParent(newZParent);\n            }\n\n            if (prevIsZContext !== this.isZContext()) {\n                if (!this.isZContext()) {\n                    this.disableZContext();\n                } else {\n                    this.enableZContext(this._parent.findZContext());\n                }\n            }\n\n            // Make sure that resort is done.\n            this._zIndexResort = true;\n            if (this._zParent) {\n                this._zParent.enableZSort();\n            }\n        }\n    };\n\n    get forceZIndexContext() {\n        return this._forceZIndexContext;\n    }\n\n    set forceZIndexContext(v) {\n        this.setHasRenderUpdates(1);\n\n        let prevIsZContext = this.isZContext();\n        this._forceZIndexContext = v;\n\n        if (prevIsZContext !== this.isZContext()) {\n            if (!this.isZContext()) {\n                this.disableZContext();\n            } else {\n                this.enableZContext(this._parent.findZContext());\n            }\n        }\n    };\n\n    enableZContext(prevZContext) {\n        if (prevZContext && prevZContext._zContextUsage > 0) {\n            // Transfer from upper z context to this z context.\n            const results = this._getZIndexedDescs();\n            results.forEach((c) => {\n                if (this.isAncestorOf(c) && c._zIndex !== 0) {\n                    c.setZParent(this);\n                }\n            });\n        }\n    }\n\n    _getZIndexedDescs() {\n        const results = [];\n        if (this._children) {\n            for (let i = 0, n = this._children.length; i < n; i++) {\n                this._children[i]._getZIndexedDescsRec(results);\n            }\n        }\n        return results;\n    }\n\n    _getZIndexedDescsRec(results) {\n        if (this._zIndex) {\n            results.push(this);\n        } else if (this._children && !this.isZContext()) {\n            for (let i = 0, n = this._children.length; i < n; i++) {\n                this._children[i]._getZIndexedDescsRec(results);\n            }\n        }\n    }\n\n    disableZContext() {\n        // Transfer from this z context to upper z context.\n        if (this._zContextUsage > 0) {\n            let newZParent = this._parent.findZContext();\n\n            // Make sure that z-indexed children are up to date (old ones removed).\n            if (this._zSort) {\n                this.sortZIndexedChildren();\n            }\n\n            this._zIndexedChildren.slice().forEach(function (c) {\n                if (c._zIndex !== 0) {\n                    c.setZParent(newZParent);\n                }\n            });\n        }\n    };\n\n    get colorUl() {\n        return this._colorUl;\n    }\n\n    set colorUl(color) {\n        if (this._colorUl !== color) {\n            this.setHasRenderUpdates(this._displayedTextureSource ? 3 : 1);\n            this._colorUl = color;\n        }\n    }\n\n    get colorUr() {\n        return this._colorUr;\n    }\n\n    set colorUr(color) {\n        if (this._colorUr !== color) {\n            this.setHasRenderUpdates(this._displayedTextureSource ? 3 : 1);\n            this._colorUr = color;\n        }\n    };\n\n    get colorBl() {\n        return this._colorBl;\n    }\n\n    set colorBl(color) {\n        if (this._colorBl !== color) {\n            this.setHasRenderUpdates(this._displayedTextureSource ? 3 : 1);\n            this._colorBl = color;\n        }\n    };\n\n    get colorBr() {\n        return this._colorBr;\n    }\n\n    set colorBr(color) {\n        if (this._colorBr !== color) {\n            this.setHasRenderUpdates(this._displayedTextureSource ? 3 : 1);\n            this._colorBr = color;\n        }\n    };\n\n\n    set onUpdate(f) {\n        this._onUpdate = f;\n        this._setRecalc(7);\n    }\n\n    set onAfterUpdate(f) {\n        this._onAfterUpdate = f;\n        this._setRecalc(7);\n    }\n\n    set onAfterCalcs(f) {\n        this._onAfterCalcs = f;\n        this._setRecalc(7);\n    }\n\n    get shader() {\n        return this._shader;\n    }\n\n    set shader(v) {\n        this.setHasRenderUpdates(1);\n\n        let prevShader = this._shader;\n        this._shader = v;\n        if (!v && prevShader) {\n            // Disabled shader.\n            let newShaderOwner = (this._parent && !this._parent._renderToTextureEnabled ? this._parent._shaderOwner : null);\n            this._setShaderOwnerRecursive(newShaderOwner);\n        } else if (v) {\n            // Enabled shader.\n            this._setShaderOwnerRecursive(this);\n        }\n    }\n\n    get activeShader() {\n        return this._shaderOwner ? this._shaderOwner.shader : this.renderState.defaultShader;\n    }\n\n    get activeShaderOwner() {\n        return this._shaderOwner;\n    }\n\n    get clipping() {\n        return this._clipping;\n    }\n\n    set clipping(v) {\n        if (this._clipping !== v) {\n            this._clipping = v;\n\n            // Force update of scissor by updating translate.\n            // Alpha must also be updated because the scissor area may have been empty.\n            this._setRecalc(1 + 2);\n        }\n    }\n\n    get clipbox() {\n        return this._clipbox;\n    }\n\n    set clipbox(v) {\n        // In case of out-of-bounds element, all children will also be ignored.\n        // It will save us from executing the update/render loops for those.\n        // The optimization will be used immediately during the next frame.\n        this._clipbox = v;\n    }\n\n    _setShaderOwnerRecursive(elementCore) {\n        this._shaderOwner = elementCore;\n\n        if (this._children && !this._renderToTextureEnabled) {\n            for (let i = 0, n = this._children.length; i < n; i++) {\n                let c = this._children[i];\n                if (!c._shader) {\n                    c._setShaderOwnerRecursive(elementCore);\n                    c._hasRenderUpdates = 3;\n                }\n            }\n        }\n    };\n\n    _setShaderOwnerChildrenRecursive(elementCore) {\n        if (this._children) {\n            for (let i = 0, n = this._children.length; i < n; i++) {\n                let c = this._children[i];\n                if (!c._shader) {\n                    c._setShaderOwnerRecursive(elementCore);\n                    c._hasRenderUpdates = 3;\n                }\n            }\n        }\n    };\n\n    _hasRenderContext() {\n        return this._renderContext !== this._worldContext;\n    }\n\n    get renderContext() {\n        return this._renderContext;\n    }\n\n    updateRenderToTextureEnabled() {\n        // Enforce texturizer initialisation.\n        let v = this.texturizer._enabled;\n\n        if (v) {\n            this._enableRenderToTexture();\n        } else {\n            this._disableRenderToTexture();\n            this._texturizer.releaseRenderTexture();\n        }\n    }\n\n    _enableRenderToTexture() {\n        if (!this._renderToTextureEnabled) {\n            let prevIsZContext = this.isZContext();\n\n            this._renderToTextureEnabled = true;\n\n            this._renderContext = new ElementCoreContext();\n\n            // If render to texture is active, a new shader context is started.\n            this._setShaderOwnerChildrenRecursive(null);\n\n            if (!prevIsZContext) {\n                // Render context forces z context.\n                this.enableZContext(this._parent ? this._parent.findZContext() : null);\n            }\n\n            this.setHasRenderUpdates(3);\n\n            // Make sure that the render coordinates get updated.\n            this._setRecalc(7);\n\n            this.render = this._renderAdvanced;\n        }\n    }\n\n    _disableRenderToTexture() {\n        if (this._renderToTextureEnabled) {\n            this._renderToTextureEnabled = false;\n\n            this._setShaderOwnerChildrenRecursive(this._shaderOwner);\n\n            this._renderContext = this._worldContext;\n\n            if (!this.isZContext()) {\n                this.disableZContext();\n            }\n\n            // Make sure that the render coordinates get updated.\n            this._setRecalc(7);\n\n            this.setHasRenderUpdates(3);\n\n            this.render = this._renderSimple;\n        }\n    }\n\n    isWhite() {\n        return (this._colorUl === 0xFFFFFFFF) && (this._colorUr === 0xFFFFFFFF) && (this._colorBl === 0xFFFFFFFF) && (this._colorBr === 0xFFFFFFFF);\n    }\n\n    hasSimpleTexCoords() {\n        return (this._ulx === 0) && (this._uly === 0) && (this._brx === 1) && (this._bry === 1);\n    }\n\n    _stashTexCoords() {\n        this._stashedTexCoords = [this._ulx, this._uly, this._brx, this._bry];\n        this._ulx = 0;\n        this._uly = 0;\n        this._brx = 1;\n        this._bry = 1;\n    }\n\n    _unstashTexCoords() {\n        this._ulx = this._stashedTexCoords[0];\n        this._uly = this._stashedTexCoords[1];\n        this._brx = this._stashedTexCoords[2];\n        this._bry = this._stashedTexCoords[3];\n        this._stashedTexCoords = null;\n    }\n\n    _stashColors() {\n        this._stashedColors = [this._colorUl, this._colorUr, this._colorBr, this._colorBl];\n        this._colorUl = 0xFFFFFFFF;\n        this._colorUr = 0xFFFFFFFF;\n        this._colorBr = 0xFFFFFFFF;\n        this._colorBl = 0xFFFFFFFF;\n    }\n\n    _unstashColors() {\n        this._colorUl = this._stashedColors[0];\n        this._colorUr = this._stashedColors[1];\n        this._colorBr = this._stashedColors[2];\n        this._colorBl = this._stashedColors[3];\n        this._stashedColors = null;\n    }\n\n    isVisible() {\n        return (this._localAlpha > 1e-14);\n    };\n\n    get outOfBounds() {\n        return this._outOfBounds;\n    }\n\n    set boundsMargin(v) {\n\n        /**\n         *  null: inherit from parent.\n         *  number[4]: specific margins: left, top, right, bottom.\n         */\n        this._boundsMargin = v ? v.slice() : null;\n\n        // We force recalc in order to set all boundsMargin recursively during the next update.\n        this._triggerRecalcTranslate();\n    }\n\n    get boundsMargin() {\n        return this._boundsMargin;\n    }\n\n    update() {\n        this._recalc |= this._parent._pRecalc;\n\n        if (this._layout && this._layout.isEnabled()) {\n            if (this._recalc & 256) {\n                this._layout.layoutFlexTree();\n            }\n        } else if ((this._recalc & 2) && this._optFlags) {\n            this._applyRelativeDimFuncs();\n        }\n\n        if (this._onUpdate) {\n            // Block all 'upwards' updates when changing things in this branch.\n            this._hasUpdates = true;\n            this._onUpdate(this.element, this);\n        }\n\n        const pw = this._parent._worldContext;\n        let w = this._worldContext;\n        const visible = (pw.alpha && this._localAlpha);\n\n        /**\n         * We must update if:\n         * - branch contains updates (even when invisible because it may contain z-indexed descendants)\n         * - there are (inherited) updates and this branch is visible\n         * - this branch becomes invisible (descs may be z-indexed so we must update all alpha values)\n         */\n        if (this._hasUpdates || (this._recalc && visible) || (w.alpha && !visible)) {\n            let recalc = this._recalc;\n\n            // Update world coords/alpha.\n            if (recalc & 1) {\n                if (!w.alpha && visible) {\n                    // Becomes visible.\n                    this._hasRenderUpdates = 3;\n                }\n                w.alpha = pw.alpha * this._localAlpha;\n\n                if (w.alpha < 1e-14) {\n                    // Tiny rounding errors may cause failing visibility tests.\n                    w.alpha = 0;\n                }\n            }\n\n            if (recalc & 6) {\n                w.px = pw.px + this._localPx * pw.ta;\n                w.py = pw.py + this._localPy * pw.td;\n                if (pw.tb !== 0) w.px += this._localPy * pw.tb;\n                if (pw.tc !== 0) w.py += this._localPx * pw.tc;\n            }\n\n            if (recalc & 4) {\n                w.ta = this._localTa * pw.ta;\n                w.tb = this._localTd * pw.tb;\n                w.tc = this._localTa * pw.tc;\n                w.td = this._localTd * pw.td;\n\n                if (this._isComplex) {\n                    w.ta += this._localTc * pw.tb;\n                    w.tb += this._localTb * pw.ta;\n                    w.tc += this._localTc * pw.td;\n                    w.td += this._localTb * pw.tc;\n                }\n            }\n\n            // Update render coords/alpha.\n            const pr = this._parent._renderContext;\n            if (this._parent._hasRenderContext()) {\n                const init = this._renderContext === this._worldContext;\n                if (init) {\n                    // First render context build: make sure that it is fully initialized correctly.\n                    // Otherwise, if we get into bounds later, the render context would not be initialized correctly.\n                    this._renderContext = new ElementCoreContext();\n                }\n\n                const r = this._renderContext;\n\n                // Update world coords/alpha.\n                if (init || (recalc & 1)) {\n                    r.alpha = pr.alpha * this._localAlpha;\n\n                    if (r.alpha < 1e-14) {\n                        r.alpha = 0;\n                    }\n                }\n\n                if (init || (recalc & 6)) {\n                    r.px = pr.px + this._localPx * pr.ta;\n                    r.py = pr.py + this._localPy * pr.td;\n                    if (pr.tb !== 0) r.px += this._localPy * pr.tb;\n                    if (pr.tc !== 0) r.py += this._localPx * pr.tc;\n                }\n\n                if (init) {\n                    // We set the recalc toggle, because we must make sure that the scissor is updated.\n                    recalc |= 2;\n                }\n\n                if (init || (recalc & 4)) {\n                    r.ta = this._localTa * pr.ta;\n                    r.tb = this._localTd * pr.tb;\n                    r.tc = this._localTa * pr.tc;\n                    r.td = this._localTd * pr.td;\n\n                    if (this._isComplex) {\n                        r.ta += this._localTc * pr.tb;\n                        r.tb += this._localTb * pr.ta;\n                        r.tc += this._localTc * pr.td;\n                        r.td += this._localTb * pr.tc;\n                    }\n                }\n            } else {\n                this._renderContext = this._worldContext;\n            }\n\n            if (this.ctx.updateTreeOrder === -1) {\n                this.ctx.updateTreeOrder = this._updateTreeOrder + 1;\n            } else {\n                this._updateTreeOrder = this.ctx.updateTreeOrder++;\n            }\n\n            // Determine whether we must use a 'renderTexture'.\n            const useRenderToTexture = this._renderToTextureEnabled && this._texturizer.mustRenderToTexture();\n            if (this._useRenderToTexture !== useRenderToTexture) {\n                // Coords must be changed.\n                this._recalc |= 2 + 4;\n\n                // Scissor may change: force update.\n                recalc |= 2;\n\n                if (!this._useRenderToTexture) {\n                    // We must release the texture.\n                    this._texturizer.release();\n                }\n            }\n            this._useRenderToTexture = useRenderToTexture;\n\n            const r = this._renderContext;\n\n            const bboxW = this._dimsUnknown ? 2048 : this._w;\n            const bboxH = this._dimsUnknown ? 2048 : this._h;\n\n            // Calculate a bbox for this element.\n            let sx, sy, ex, ey;\n            const rComplex = (r.tb !== 0) || (r.tc !== 0) || (r.ta < 0) || (r.td < 0);\n            if (rComplex) {\n                sx = Math.min(0, bboxW * r.ta, bboxW * r.ta + bboxH * r.tb, bboxH * r.tb) + r.px;\n                ex = Math.max(0, bboxW * r.ta, bboxW * r.ta + bboxH * r.tb, bboxH * r.tb) + r.px;\n                sy = Math.min(0, bboxW * r.tc, bboxW * r.tc + bboxH * r.td, bboxH * r.td) + r.py;\n                ey = Math.max(0, bboxW * r.tc, bboxW * r.tc + bboxH * r.td, bboxH * r.td) + r.py;\n            } else {\n                sx = r.px;\n                ex = r.px + r.ta * bboxW;\n                sy = r.py;\n                ey = r.py + r.td * bboxH;\n            }\n\n            if (this._dimsUnknown && (rComplex || this._localTa < 1 || this._localTb < 1)) {\n                // If we are dealing with a non-identity matrix, we must extend the bbox so that withinBounds and\n                //  scissors will include the complete range of (positive) dimensions up to ,lh.\n                const nx = this._x * pr.ta + this._y * pr.tb + pr.px;\n                const ny = this._x * pr.tc + this._y * pr.td + pr.py;\n                if (nx < sx) sx = nx;\n                if (ny < sy) sy = ny;\n                if (nx > ex) ex = nx;\n                if (ny > ey) ey = ny;\n            }\n\n            if (recalc & 6 || !this._scissor /* initial */) {\n                // Determine whether we must 'clip'.\n                if (this._clipping && r.isSquare()) {\n                    // If the parent renders to a texture, it's scissor should be ignored;\n                    const area = this._parent._useRenderToTexture ? this._parent._viewport : this._parent._scissor;\n                    if (area) {\n                        // Merge scissor areas.\n                        const lx = Math.max(area[0], sx);\n                        const ly = Math.max(area[1], sy);\n                        this._scissor = [\n                            lx,\n                            ly,\n                            Math.min(area[2] + area[0], ex) - lx,\n                            Math.min(area[3] + area[1], ey) - ly\n                        ];\n                    } else {\n                        this._scissor = [sx, sy, ex - sx, ey - sy];\n                    }\n                } else {\n                    // No clipping: reuse parent scissor.\n                    this._scissor = this._parent._useRenderToTexture ? this._parent._viewport : this._parent._scissor;\n                }\n            }\n\n            // Calculate the outOfBounds margin.\n            if (this._boundsMargin) {\n                this._recBoundsMargin = this._boundsMargin;\n            } else {\n                this._recBoundsMargin = this._parent._recBoundsMargin;\n            }\n\n            if (this._onAfterCalcs) {\n                // After calcs may change render coords, scissor and/or recBoundsMargin.\n                if (this._onAfterCalcs(this.element)) {\n                    // Recalculate bbox.\n                    if (rComplex) {\n                        sx = Math.min(0, bboxW * r.ta, bboxW * r.ta + bboxH * r.tb, bboxH * r.tb) + r.px;\n                        ex = Math.max(0, bboxW * r.ta, bboxW * r.ta + bboxH * r.tb, bboxH * r.tb) + r.px;\n                        sy = Math.min(0, bboxW * r.tc, bboxW * r.tc + bboxH * r.td, bboxH * r.td) + r.py;\n                        ey = Math.max(0, bboxW * r.tc, bboxW * r.tc + bboxH * r.td, bboxH * r.td) + r.py;\n                    } else {\n                        sx = r.px;\n                        ex = r.px + r.ta * bboxW;\n                        sy = r.py;\n                        ey = r.py + r.td * bboxH;\n                    }\n\n                    if (this._dimsUnknown && (rComplex || this._localTa < 1 || this._localTb < 1)) {\n                        const nx = this._x * pr.ta + this._y * pr.tb + pr.px;\n                        const ny = this._x * pr.tc + this._y * pr.td + pr.py;\n                        if (nx < sx) sx = nx;\n                        if (ny < sy) sy = ny;\n                        if (nx > ex) ex = nx;\n                        if (ny > ey) ey = ny;\n                    }\n                }\n            }\n\n            if (this._parent._outOfBounds === 2) {\n                // Inherit parent out of boundsness.\n                this._outOfBounds = 2;\n\n                if (this._withinBoundsMargin) {\n                    this._withinBoundsMargin = false;\n                    this.element._disableWithinBoundsMargin();\n                }\n            } else {\n                if (recalc & 6) {\n                    // Recheck if element is out-of-bounds (all settings that affect this should enable recalc bit 2 or 4).\n                    this._outOfBounds = 0;\n                    let withinMargin = true;\n\n                    // Offscreens are always rendered as long as the parent is within bounds.\n                    if (!this._renderToTextureEnabled || !this._texturizer || !this._texturizer.renderOffscreen) {\n                        if (this._scissor && (this._scissor[2] <= 0 || this._scissor[3] <= 0)) {\n                            // Empty scissor area.\n                            this._outOfBounds = 2;\n                        } else {\n                            // Use bbox to check out-of-boundness.\n                            if ((this._scissor[0] > ex) ||\n                                (this._scissor[1] > ey) ||\n                                (sx > (this._scissor[0] + this._scissor[2])) ||\n                                (sy > (this._scissor[1] + this._scissor[3]))\n                            ) {\n                                this._outOfBounds = 1;\n                            }\n\n                            if (this._outOfBounds) {\n                                if (this._clipping || this._useRenderToTexture || (this._clipbox && (bboxW && bboxH))) {\n                                    this._outOfBounds = 2;\n                                }\n                            }\n                        }\n\n                        withinMargin = (this._outOfBounds === 0);\n                        if (!withinMargin) {\n                            // Re-test, now with margins.\n                            if (this._recBoundsMargin) {\n                                withinMargin = !((ex < this._scissor[0] - this._recBoundsMargin[2]) ||\n                                    (ey < this._scissor[1] - this._recBoundsMargin[3]) ||\n                                    (sx > this._scissor[0] + this._scissor[2] + this._recBoundsMargin[0]) ||\n                                    (sy > this._scissor[1] + this._scissor[3] + this._recBoundsMargin[1]));\n                            } else {\n                                withinMargin = !((ex < this._scissor[0] - 100) ||\n                                    (ey < this._scissor[1] - 100) ||\n                                    (sx > this._scissor[0] + this._scissor[2] + 100) ||\n                                    (sy > this._scissor[1] + this._scissor[3] + 100));\n                            }\n                            if (withinMargin && this._outOfBounds === 2) {\n                                // Children must be visited because they may contain elements that are within margin, so must be visible.\n                                this._outOfBounds = 1;\n                            }\n                        }\n                    }\n\n                    if (this._withinBoundsMargin !== withinMargin) {\n                        this._withinBoundsMargin = withinMargin;\n\n                        if (this._withinBoundsMargin) {\n                            // This may update things (txLoaded events) in the element itself, but also in descendants and ancestors.\n\n                            // Changes in ancestors should be executed during the next call of the stage update. But we must\n                            // take care that the _recalc and _hasUpdates flags are properly registered. That's why we clear\n                            // both before entering the children, and use _pRecalc to transfer inherited updates instead of\n                            // _recalc directly.\n\n                            // Changes in descendants are automatically executed within the current update loop, though we must\n                            // take care to not update the hasUpdates flag unnecessarily in ancestors. We achieve this by making\n                            // sure that the hasUpdates flag of this element is turned on, which blocks it for ancestors.\n                            this._hasUpdates = true;\n\n                            const recalc = this._recalc;\n                            this._recalc = 0;\n                            this.element._enableWithinBoundsMargin();\n\n                            if (this._recalc) {\n                                // This element needs to be re-updated now, because we want the dimensions (and other changes) to be updated.\n                                return this.update();\n                            }\n\n                            this._recalc = recalc;\n                        } else {\n                            this.element._disableWithinBoundsMargin();\n                        }\n                    }\n                }\n            }\n\n            if (this._useRenderToTexture) {\n                // Set viewport necessary for children scissor calculation.\n                if (this._viewport) {\n                    this._viewport[2] = bboxW;\n                    this._viewport[3] = bboxH;\n                } else {\n                    this._viewport = [0, 0, bboxW, bboxH];\n                }\n            }\n\n            // Filter out bits that should not be copied to the children (currently all are).\n            this._pRecalc = (this._recalc & 135);\n\n            // Clear flags so that future updates are properly detected.\n            this._recalc = 0;\n            this._hasUpdates = false;\n\n            if (this._outOfBounds < 2) {\n                if (this._useRenderToTexture) {\n                    if (this._worldContext.isIdentity()) {\n                        // Optimization.\n                        // The world context is already identity: use the world context as render context to prevents the\n                        // ancestors from having to update the render context.\n                        this._renderContext = this._worldContext;\n                    } else {\n                        // Temporarily replace the render coord attribs by the identity matrix.\n                        // This allows the children to calculate the render context.\n                        this._renderContext = ElementCoreContext.IDENTITY;\n                    }\n                }\n\n                if (this._children) {\n                    for (let i = 0, n = this._children.length; i < n; i++) {\n                        this._children[i].update();\n                    }\n                }\n\n                if (this._useRenderToTexture) {\n                    this._renderContext = r;\n                }\n            } else {\n                if (this._children) {\n                    for (let i = 0, n = this._children.length; i < n; i++) {\n                        if (this._children[i]._hasUpdates) {\n                            this._children[i].update();\n                        } else {\n                            // Make sure we don't lose the 'inherited' updates.\n                            this._children[i]._recalc |= this._pRecalc;\n                            this._children[i].updateOutOfBounds();\n                        }\n                    }\n                }\n            }\n\n            if (this._onAfterUpdate) {\n                this._onAfterUpdate(this.element);\n            }\n        } else {\n            if (this.ctx.updateTreeOrder === -1 || this._updateTreeOrder >= this.ctx.updateTreeOrder) {\n                // If new tree order does not interfere with the current (gaps allowed) there's no need to traverse the branch.\n                this.ctx.updateTreeOrder = -1;\n            } else {\n                this.updateTreeOrder();\n            }\n        }\n    }\n\n    _applyRelativeDimFuncs() {\n        if (this._optFlags & 1) {\n            const x = this._funcX(this._parent.w);\n            if (x !== this._x) {\n                this._localPx += (x - this._x);\n                this._x = x;\n            }\n        }\n        if (this._optFlags & 2) {\n            const y = this._funcY(this._parent.h);\n            if (y !== this._y) {\n                this._localPy += (y - this._y);\n                this._y = y;\n            }\n        }\n\n        let changedDims = false;\n        if (this._optFlags & 4) {\n            const w = this._funcW(this._parent.w);\n            if (w !== this._w) {\n                this._w = w;\n                changedDims = true;\n            }\n        }\n        if (this._optFlags & 8) {\n            const h = this._funcH(this._parent.h);\n            if (h !== this._h) {\n                this._h = h;\n                changedDims = true;\n            }\n        }\n\n        if (changedDims) {\n            // Recalc mount, scale position.\n            this._recalcLocalTranslate();\n\n            this.element.onDimensionsChanged(this._w, this._h);\n        }\n    }\n\n    updateOutOfBounds() {\n        // Propagate outOfBounds flag to descendants (necessary because of z-indexing).\n        // Invisible elements are not drawn anyway. When alpha is updated, so will _outOfBounds.\n        if (this._outOfBounds !== 2 && this._renderContext.alpha > 0) {\n\n            // Inherit parent out of boundsness.\n            this._outOfBounds = 2;\n\n            if (this._withinBoundsMargin) {\n                this._withinBoundsMargin = false;\n                this.element._disableWithinBoundsMargin();\n            }\n\n            if (this._children) {\n                for (let i = 0, n = this._children.length; i < n; i++) {\n                    this._children[i].updateOutOfBounds();\n                }\n            }\n        }\n    }\n\n    updateTreeOrder() {\n        if (this._localAlpha && (this._outOfBounds !== 2)) {\n            this._updateTreeOrder = this.ctx.updateTreeOrder++;\n\n            if (this._children) {\n                for (let i = 0, n = this._children.length; i < n; i++) {\n                    this._children[i].updateTreeOrder();\n                }\n            }\n        }\n    }\n\n    _renderSimple() {\n        this._hasRenderUpdates = 0;\n\n        if (this._zSort) {\n            this.sortZIndexedChildren();\n        }\n\n        if (this._outOfBounds < 2 && this._renderContext.alpha) {\n            let renderState = this.renderState;\n\n            if ((this._outOfBounds === 0) && this._displayedTextureSource) {\n                renderState.setShader(this.activeShader, this._shaderOwner);\n                renderState.setScissor(this._scissor);\n                this.renderState.addQuad(this);\n            }\n\n            // Also add children to the VBO.\n            if (this._children) {\n                if (this._zContextUsage) {\n                    for (let i = 0, n = this._zIndexedChildren.length; i < n; i++) {\n                        this._zIndexedChildren[i].render();\n                    }\n                } else {\n                    for (let i = 0, n = this._children.length; i < n; i++) {\n                        if (this._children[i]._zIndex === 0) {\n                            // If zIndex is set, this item already belongs to a zIndexedChildren array in one of the ancestors.\n                            this._children[i].render();\n                        }\n\n                    }\n                }\n            }\n        }\n    }\n\n    _renderAdvanced() {\n        const hasRenderUpdates = this._hasRenderUpdates;\n\n        // We must clear the hasRenderUpdates flag before rendering, because updating result textures in combination\n        // with z-indexing may trigger render updates on a render branch that is 'half done'.\n        // We need to ensure that the full render branch is marked for render updates, not only half (leading to freeze).\n        this._hasRenderUpdates = 0;\n\n        if (this._zSort) {\n            this.sortZIndexedChildren();\n        }\n\n        if (this._outOfBounds < 2 && this._renderContext.alpha) {\n            let renderState = this.renderState;\n\n            let mustRenderChildren = true;\n            let renderTextureInfo;\n            let prevRenderTextureInfo;\n            if (this._useRenderToTexture) {\n                if (this._w === 0 || this._h === 0) {\n                    // Ignore this branch and don't draw anything.\n                    return;\n                } else if (!this._texturizer.hasRenderTexture() || (hasRenderUpdates >= 3)) {\n                    // Tell the renderer we're rendering a renderToTexture element in this frame\n                    this.ctx.renderToTextureCount++;\n                    // Switch to default shader for building up the render texture.\n                    renderState.setShader(renderState.defaultShader, this);\n\n                    prevRenderTextureInfo = renderState.renderTextureInfo;\n\n                    renderTextureInfo = {\n                        nativeTexture: null,\n                        offset: 0,  // Set by CoreRenderState.\n                        w: this._w,\n                        h: this._h,\n                        empty: true,\n                        cleared: false,\n                        ignore: false,\n                        cache: false\n                    };\n\n                    if (this._texturizer.hasResultTexture() || (!renderState.isCachingTexturizer && (hasRenderUpdates < 3))) {\n                        /**\n                         * We don't always cache render textures.\n                         *\n                         * The rule is, that caching for a specific render texture is only enabled if:\n                         * - There is a result texture to be updated.\n                         * - There were no render updates -within the contents- since last frame (ElementCore.hasRenderUpdates < 3)\n                         * - AND there are no ancestors that are being cached during this frame (CoreRenderState.isCachingTexturizer)\n                         *   If an ancestor is cached anyway, it's probably not necessary to keep deeper caches. If the top level is to\n                         *   change while a lower one is not, that lower level will be cached instead.\n                         *\n                         * In case of the fast blur element, this prevents having to cache all blur levels and stages, saving a huge amount\n                         * of GPU memory!\n                         *\n                         * Especially when using multiple stacked layers of the same dimensions that are RTT this will have a very\n                         * noticable effect on performance as less render textures need to be allocated.\n                         */\n                        renderTextureInfo.cache = true;\n                        renderState.isCachingTexturizer = true;\n                    }\n\n                    if (!this._texturizer.hasResultTexture()) {\n                        // We can already release the current texture to the pool, as it will be rebuild anyway.\n                        // In case of multiple layers of 'filtering', this may save us from having to create one\n                        //  render-to-texture layer.\n                        // Notice that we don't do this when there is a result texture, as any other element may rely on\n                        //  that result texture being filled.\n                        this._texturizer.releaseRenderTexture();\n                    }\n\n                    renderState.setRenderTextureInfo(renderTextureInfo);\n                    renderState.setScissor(null);\n\n                    if (this._displayedTextureSource) {\n                        let r = this._renderContext;\n\n                        // Use an identity context for drawing the displayed texture to the render texture.\n                        this._renderContext = ElementCoreContext.IDENTITY;\n\n                        // Add displayed texture source in local coordinates.\n                        this.renderState.addQuad(this);\n\n                        this._renderContext = r;\n                    }\n                } else {\n                    mustRenderChildren = false;\n                }\n            } else {\n                if ((this._outOfBounds === 0) && this._displayedTextureSource) {\n                    renderState.setShader(this.activeShader, this._shaderOwner);\n                    renderState.setScissor(this._scissor);\n                    this.renderState.addQuad(this);\n                }\n            }\n\n            // Also add children to the VBO.\n            if (mustRenderChildren && this._children) {\n                if (this._zContextUsage) {\n                    for (let i = 0, n = this._zIndexedChildren.length; i < n; i++) {\n                        this._zIndexedChildren[i].render();\n                    }\n                } else {\n                    for (let i = 0, n = this._children.length; i < n; i++) {\n                        if (this._children[i]._zIndex === 0) {\n                            // If zIndex is set, this item already belongs to a zIndexedChildren array in one of the ancestors.\n                            this._children[i].render();\n                        }\n                    }\n                }\n            }\n\n            if (this._useRenderToTexture) {\n                let updateResultTexture = false;\n                if (mustRenderChildren) {\n                    // Finished refreshing renderTexture.\n                    renderState.finishedRenderTexture();\n\n                    // If nothing was rendered, we store a flag in the texturizer and prevent unnecessary\n                    //  render-to-texture and filtering.\n                    this._texturizer.empty = renderTextureInfo.empty;\n\n                    if (renderTextureInfo.empty) {\n                        // We ignore empty render textures and do not draw the final quad.\n\n                        // The following cleans up memory and enforces that the result texture is also cleared.\n                        this._texturizer.releaseRenderTexture();\n                    } else if (renderTextureInfo.nativeTexture) {\n                        // If nativeTexture is set, we can reuse that directly instead of creating a new render texture.\n                        this._texturizer.reuseTextureAsRenderTexture(renderTextureInfo.nativeTexture);\n\n                        renderTextureInfo.ignore = true;\n                    } else {\n                        if (this._texturizer.renderTextureReused) {\n                            // Quad operations must be written to a render texture actually owned.\n                            this._texturizer.releaseRenderTexture();\n                        }\n                        // Just create the render texture.\n                        renderTextureInfo.nativeTexture = this._texturizer.getRenderTexture();\n                    }\n\n                    // Restore the parent's render texture.\n                    renderState.setRenderTextureInfo(prevRenderTextureInfo);\n\n                    updateResultTexture = true;\n                }\n\n                if (!this._texturizer.empty) {\n                    let resultTexture = this._texturizer.getResultTexture();\n                    if (updateResultTexture) {\n                        if (resultTexture) {\n                            // Logging the update frame can be handy for userland.\n                            resultTexture.update = renderState.stage.frameCounter;\n                        }\n                        this._texturizer.updateResultTexture();\n                    }\n\n                    if (!this._texturizer.renderOffscreen) {\n                        // Render result texture to the actual render target.\n                        renderState.setShader(this.activeShader, this._shaderOwner);\n                        renderState.setScissor(this._scissor);\n\n                        // If no render texture info is set, the cache can be reused.\n                        const cache = !renderTextureInfo || renderTextureInfo.cache;\n\n                        renderState.setTexturizer(this._texturizer, cache);\n                        this._stashTexCoords();\n                        if (!this._texturizer.colorize) this._stashColors();\n                        this.renderState.addQuad(this, true);\n                        if (!this._texturizer.colorize) this._unstashColors();\n                        this._unstashTexCoords();\n                        renderState.setTexturizer(null);\n                    }\n                }\n            }\n\n            if (renderTextureInfo && renderTextureInfo.cache) {\n                // Allow siblings to cache.\n                renderState.isCachingTexturizer = false;\n            }\n        }\n    }\n\n    get zSort() {\n        return this._zSort;\n    }\n\n    sortZIndexedChildren() {\n        /**\n         * We want to avoid resorting everything. Instead, we do a single pass of the full array:\n         * - filtering out elements with a different zParent than this (were removed)\n         * - filtering out, but also gathering (in a temporary array) the elements that have zIndexResort flag\n         * - then, finally, we merge-sort both the new array and the 'old' one\n         * - element may have been added 'double', so when merge-sorting also check for doubles.\n         * - if the old one is larger (in size) than it should be, splice off the end of the array.\n         */\n\n        const n = this._zIndexedChildren.length;\n        let ptr = 0;\n        const a = this._zIndexedChildren;\n\n        // Notice that items may occur multiple times due to z-index changing.\n        const b = [];\n        for (let i = 0; i < n; i++) {\n            if (a[i]._zParent === this) {\n                if (a[i]._zIndexResort) {\n                    b.push(a[i]);\n                } else {\n                    if (ptr !== i) {\n                        a[ptr] = a[i];\n                    }\n                    ptr++;\n                }\n            }\n        }\n\n        const m = b.length;\n        if (m) {\n            for (let j = 0; j < m; j++) {\n                b[j]._zIndexResort = false;\n            }\n\n            b.sort(ElementCore.sortZIndexedChildren);\n            const n = ptr;\n            if (!n) {\n                ptr = 0;\n                let j = 0;\n                do {\n                    a[ptr++] = b[j++];\n                } while (j < m);\n\n                if (a.length > ptr) {\n                    // Slice old (unnecessary) part off array.\n                    a.splice(ptr);\n                }\n            } else {\n                a.splice(n); // Remove items that were sorted in b array, so that we can sort a\n+               // Beware that the function passed here to Array.sort must be stable\n+               a.sort(ElementCore.sortZIndexedChildren); // Needed because items with same _zIndex may not be ordered by _updateTreeOrder\n                // Merge-sort arrays;\n                ptr = 0;\n                let i = 0;\n                let j = 0;\n                const mergeResult = [];\n                do {\n                    const v = (a[i]._zIndex === b[j]._zIndex ? a[i]._updateTreeOrder - b[j]._updateTreeOrder : a[i]._zIndex - b[j]._zIndex);\n\n                    const add = v > 0 ? b[j++] : a[i++];\n\n                    if (ptr === 0 || (mergeResult[ptr - 1] !== add)) {\n                        mergeResult[ptr++] = add;\n                    }\n\n                    if (i >= n) {\n                        do {\n                            const add = b[j++];\n                            if (ptr === 0 || (mergeResult[ptr - 1] !== add)) {\n                                mergeResult[ptr++] = add;\n                            }\n                        } while (j < m);\n                        break;\n                    } else if (j >= m) {\n                        do {\n                            const add = a[i++];\n                            if (ptr === 0 || (mergeResult[ptr - 1] !== add)) {\n                                mergeResult[ptr++] = add;\n                            }\n                        } while (i < n);\n                        break;\n                    }\n                } while (true);\n\n                this._zIndexedChildren = mergeResult;\n            }\n        } else {\n            if (a.length > ptr) {\n                // Slice old (unnecessary) part off array.\n                a.splice(ptr);\n            }\n        }\n\n        this._zSort = false;\n    };\n\n    get localTa() {\n        return this._localTa;\n    };\n\n    get localTb() {\n        return this._localTb;\n    };\n\n    get localTc() {\n        return this._localTc;\n    };\n\n    get localTd() {\n        return this._localTd;\n    };\n\n    get element() {\n        return this._element;\n    }\n\n    get renderUpdates() {\n        return this._hasRenderUpdates;\n    }\n\n    get texturizer() {\n        if (!this._texturizer) {\n            this._texturizer = new ElementTexturizer(this);\n        }\n        return this._texturizer;\n    }\n\n    getCornerPoints() {\n        let w = this._worldContext;\n\n        return [\n            w.px,\n            w.py,\n            w.px + this._w * w.ta,\n            w.py + this._w * w.tc,\n            w.px + this._w * w.ta + this._h * w.tb,\n            w.py + this._w * w.tc + this._h * w.td,\n            w.px + this._h * w.tb,\n            w.py + this._h * w.td\n        ];\n    };\n\n    getRenderTextureCoords(relX, relY) {\n        let r = this._renderContext;\n        return [\n            r.px + r.ta * relX + r.tb * relY,\n            r.py + r.tc * relX + r.td * relY\n        ];\n    }\n\n    getAbsoluteCoords(relX, relY) {\n        let w = this._renderContext;\n        return [\n            w.px + w.ta * relX + w.tb * relY,\n            w.py + w.tc * relX + w.td * relY\n        ];\n    }\n\n    collectAtCoord(x, y, children) {\n        // return when branch is hidden\n        if (this._renderContext.alpha === 0) {\n            return;\n        }\n\n        if (this.inBound(x, y)) {\n            if (this._scissor) {\n                if (this.inScissor()) {\n                    children.push(this);\n                }\n            } else {\n                children.push(this);\n            }\n        }\n\n        if (this._children) {\n            const j = this._children.length;\n            for (let i = 0; i < j; i++) {\n                this._children[i].collectAtCoord(x, y, children);\n            }\n        }\n\n        return children.sort(ElementCore.sortZIndexedChildren);\n    }\n\n    inBound(tx, ty) {\n        const c = this.getCornerPoints();\n        return tx > c[0] && tx < c[2] && ty > c[1] && ty < c[7];\n    }\n\n    inScissor() {\n        const sc = this._scissor;\n        const c = this.getCornerPoints();\n\n        return c[2] >= sc[0] && c[0] <= sc[0] + sc[2] && c[7] >= sc[1] && c[1] <= sc[1] + sc[3];\n    }\n\n    get layout() {\n        this._ensureLayout();\n        return this._layout;\n    }\n\n    get flex() {\n        return this._layout ? this._layout.flex : null;\n    }\n\n    set flex(v) {\n        this.layout.flex = v;\n    }\n\n    get flexItem() {\n        return this._layout ? this._layout.flexItem : null;\n    }\n\n    set flexItem(v) {\n        this.layout.flexItem = v;\n    }\n\n    isFlexItem() {\n        return !!this._layout && this._layout.isFlexItemEnabled();\n    }\n\n    isFlexContainer() {\n        return !!this._layout && this._layout.isFlexEnabled();\n    }\n\n    enableFlexLayout() {\n        this._ensureLayout();\n    }\n\n    _ensureLayout() {\n        if (!this._layout) {\n            this._layout = new FlexTarget(this);\n        }\n    }\n\n    disableFlexLayout() {\n        this._triggerRecalcTranslate();\n    }\n\n    hasFlexLayout() {\n        return (this._layout && this._layout.isEnabled());\n    }\n\n    setLayout(x, y, w, h) {\n        this.x = x;\n        this.y = y;\n        this._updateDimensions(w, h);\n    }\n\n    triggerLayout() {\n        this._setRecalc(256);\n    }\n\n    _triggerRecalcTranslate() {\n        this._setRecalc(2);\n    }\n\n}\n\nclass ElementCoreContext {\n\n    constructor() {\n        this.alpha = 1;\n\n        this.px = 0;\n        this.py = 0;\n\n        this.ta = 1;\n        this.tb = 0;\n        this.tc = 0;\n        this.td = 1;\n    }\n\n    isIdentity() {\n        return this.alpha === 1 &&\n            this.px === 0 &&\n            this.py === 0 &&\n            this.ta === 1 &&\n            this.tb === 0 &&\n            this.tc === 0 &&\n            this.td === 1;\n    }\n\n    isSquare() {\n        return this.tb === 0 && this.tc === 0;\n    }\n\n}\n\nElementCoreContext.IDENTITY = new ElementCoreContext();\nElementCore.sortZIndexedChildren = function (a, b) {\n    return (a._zIndex === b._zIndex ? a._updateTreeOrder - b._updateTreeOrder : a._zIndex - b._zIndex);\n};\n\nimport ElementTexturizer from \"./ElementTexturizer.mjs\";\nimport Utils from \"../Utils.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * This is a partial (and more efficient) implementation of the event emitter.\n * It attempts to maintain a one-to-one mapping between events and listeners, skipping an array lookup.\n * Only if there are multiple listeners, they are combined in an array.\n */\nexport default class EventEmitter {\n\n    constructor() {\n        // This is set (and kept) to true when events are used at all.\n        this._hasEventListeners = false;\n    }\n\n    on(name, listener) {\n        if (!this._hasEventListeners) {\n            this._eventFunction = {}\n            this._eventListeners = {}\n            this._hasEventListeners = true;\n        }\n\n        const current = this._eventFunction[name];\n        if (!current) {\n            this._eventFunction[name] = listener;\n        } else {\n            if (this._eventFunction[name] !== EventEmitter.combiner) {\n                this._eventListeners[name] = [this._eventFunction[name], listener];\n                this._eventFunction[name] = EventEmitter.combiner;\n            } else {\n                this._eventListeners[name].push(listener);\n            }\n        }\n    }\n\n    once(name, listener) {\n        const wrapper = (arg1, arg2, arg3) => {\n            listener(arg1, arg2, arg3);\n            this.off(name, wrapper);\n        }\n        wrapper.__originalFunc = listener;\n        this.on(name, wrapper);\n    }\n\n    has(name, listener) {\n        if (this._hasEventListeners) {\n            const current = this._eventFunction[name];\n            if (current) {\n                if (current === EventEmitter.combiner) {\n                    const listeners = this._eventListeners[name];\n                    for (const l of listeners) {\n                        if (l === listener || l.__originalFunc == listener) {\n                            return true;\n                        }\n                    }\n                } else if (this._eventFunction[name] === listener || this._eventFunction[name].__originalFunc === listener) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    off(name, listener) {\n        if (this._hasEventListeners) {\n            const current = this._eventFunction[name];\n            if (current) {\n                if (current === EventEmitter.combiner) {\n                    const listeners = this._eventListeners[name];\n                    let index = listeners.indexOf(listener);\n                    if (index >= 0) {\n                        listeners.splice(index, 1);\n                    }\n                    index = listeners.map((l) => l.__originalFunc).indexOf(listener);\n                    if (index >= 0) {\n                        listeners.splice(index, 1);\n                    }\n                    if (listeners.length === 1) {\n                        this._eventFunction[name] = listeners[0];\n                        this._eventListeners[name] = undefined;\n                    }\n                } else if (this._eventFunction[name] === listener || this._eventFunction[name].__originalFunc === listener) {\n                    this._eventFunction[name] = undefined;\n                }\n            }\n        }\n    }\n\n    removeListener(name, listener) {\n        this.off(name, listener);\n    }\n\n    emit(name, arg1, arg2, arg3) {\n        if (this._hasEventListeners) {\n            const func = this._eventFunction[name];\n            if (func) {\n                if (func === EventEmitter.combiner) {\n                    func(this, name, arg1, arg2, arg3);\n                } else {\n                    func(arg1, arg2, arg3);\n                }\n            }\n        }\n    }\n\n    listenerCount(name) {\n        if (this._hasEventListeners) {\n            const func = this._eventFunction[name];\n            if (func) {\n                if (func === EventEmitter.combiner) {\n                    return this._eventListeners[name].length;\n                } else {\n                    return 1;\n                }\n            }\n        }\n        return 0;\n    }\n\n    removeAllListeners(name) {\n        if (this._hasEventListeners) {\n            delete this._eventFunction[name];\n            delete this._eventListeners[name];\n        }\n    }\n\n}\n\nEventEmitter.combiner = function(object, name, arg1, arg2, arg3) {\n    const listeners = object._eventListeners[name];\n    if (listeners) {\n        /* Because listener may detach itself while being invoked and therefore invalidate the iterator,\n           we need to create a copy to loop over it */\n        for (const listener of [...listeners]) {\n            listener(arg1, arg2, arg3);\n        }\n    }\n}\n\nEventEmitter.addAsMixin = function(cls) {\n    cls.prototype.on = EventEmitter.prototype.on;\n    cls.prototype.once = EventEmitter.prototype.once;\n    cls.prototype.has = EventEmitter.prototype.has;\n    cls.prototype.off = EventEmitter.prototype.off;\n    cls.prototype.removeListener = EventEmitter.prototype.removeListener;\n    cls.prototype.emit = EventEmitter.prototype.emit;\n    cls.prototype.listenerCount = EventEmitter.prototype.listenerCount;\n    cls.prototype.removeAllListeners = EventEmitter.prototype.removeAllListeners;\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Utils from \"./Utils.mjs\";\nimport Base from \"./Base.mjs\";\n\nexport default class Shader {\n\n    constructor(coreContext) {\n        this._initialized = false;\n\n        this.ctx = coreContext;\n\n        /**\n         * The (enabled) elements that use this shader.\n         * @type {Set<ElementCore>}\n         */\n        this._elements = new Set();\n    }\n\n    static create(stage, v) {\n        let shader;\n        if (Utils.isObjectLiteral(v)) {\n            if (v.type) {\n                shader = stage.renderer.createShader(stage.ctx, v);\n            } else {\n                shader = this.shader;\n            }\n\n            if (shader) {\n                Base.patchObject(shader, v);\n            }\n        } else if (v === null) {\n            shader = stage.ctx.renderState.defaultShader;\n        } else if (v === undefined) {\n            shader = null;\n        } else {\n            if (v.isShader) {\n                if (!stage.renderer.isValidShaderType(v.constructor)) {\n                    console.error(\"[Lightning] Invalid shader type\");\n                    v = null;\n                }\n                shader = v;\n            } else {\n                console.error(\"[Lightning] Please specify a shader type.\");\n                return;\n            }\n        }\n\n        return shader;\n    }\n\n    static getWebGL() {\n        return undefined;\n    }\n\n    static getC2d() {\n        return undefined;\n    }\n\n    addElement(elementCore) {\n        this._elements.add(elementCore);\n    }\n\n    removeElement(elementCore) {\n        this._elements.delete(elementCore);\n        if (!this._elements) {\n            this.cleanup();\n        }\n    }\n\n    redraw() {\n        this._elements.forEach(elementCore => {\n            elementCore.setHasRenderUpdates(2);\n        });\n    }\n\n    patch(settings) {\n        Base.patchObject(this, settings);\n    }\n\n    useDefault() {\n        // Should return true if this shader is configured (using it's properties) to not have any effect.\n        // This may allow the render engine to avoid unnecessary shader program switches or even texture copies.\n        return false;\n    }\n\n    addEmpty() {\n        // Draws this shader even if there are no quads to be added.\n        // This is handy for custom shaders.\n        return false;\n    }\n\n    cleanup() {\n        // Called when no more enabled elements have this shader.\n    }\n\n    get isShader() {\n        return true;\n    }\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class Texture {\n\n    /**\n     * @param {Stage} stage\n     */\n    constructor(stage) {\n        this.stage = stage;\n\n        this.manager = this.stage.textureManager;\n\n        this.id = Texture.id++;\n\n        /**\n         * All enabled elements that use this texture object (either as texture or displayedTexture).\n         * @type {Set<Element>}\n         */\n        this.elements = new Set();\n\n        /**\n         * The number of enabled elements that are active.\n         * @type {number}\n         */\n        this._activeCount = 0;\n\n        /**\n         * The associated texture source.\n         * Should not be changed.\n         * @type {TextureSource}\n         */\n        this._source = null;\n\n        /**\n         * A resize mode can be set to cover or contain a certain area.\n         * It will reset the texture clipping settings.\n         * When manual texture clipping is performed, the resizeMode is reset.\n         * @type {{type: string, width: number, height: number}}\n         * @private\n         */\n        this._resizeMode = null;\n\n        /**\n         * The texture clipping x-offset.\n         * @type {number}\n         */\n        this._x = 0;\n\n        /**\n         * The texture clipping y-offset.\n         * @type {number}\n         */\n        this._y = 0;\n\n        /**\n         * The texture clipping width. If 0 then full width.\n         * @type {number}\n         */\n        this._w = 0;\n\n        /**\n         * The texture clipping height. If 0 then full height.\n         * @type {number}\n         */\n        this._h = 0;\n\n        /**\n         * Render precision (0.5 = fuzzy, 1 = normal, 2 = sharp even when scaled twice, etc.).\n         * @type {number}\n         * @private\n         */\n        this._precision = 1;\n\n        /**\n         * The (maximum) expected texture source width. Used for within bounds determination while texture is not yet loaded.\n         * If not set, 2048 is used by ElementCore.update.\n         * @type {number}\n         */\n        this.mw = 0;\n\n        /**\n         * The (maximum) expected texture source height. Used for within bounds determination while texture is not yet loaded.\n         * If not set, 2048 is used by ElementCore.update.\n         * @type {number}\n         */\n        this.mh = 0;\n\n        /**\n         * Indicates if Texture.prototype.texture uses clipping.\n         * @type {boolean}\n         */\n        this.clipping = false;\n\n        /**\n         * Indicates whether this texture must update (when it becomes used again).\n         * @type {boolean}\n         * @private\n         */\n        this._mustUpdate = true;\n\n    }\n\n    get source() {\n        if (this._mustUpdate || this.stage.hasUpdateSourceTexture(this)) {\n            this._performUpdateSource(true);\n            this.stage.removeUpdateSourceTexture(this);\n        }\n        return this._source;\n    }\n\n    addElement(v) {\n        if (!this.elements.has(v)) {\n            this.elements.add(v);\n\n            if (this.elements.size === 1) {\n                if (this._source) {\n                    this._source.addTexture(this);\n                }\n            }\n\n            if (v.active) {\n                this.incActiveCount();\n            }\n        }\n    }\n\n    removeElement(v) {\n        if (this.elements.delete(v)) {\n            if (this.elements.size === 0) {\n                if (this._source) {\n                    this._source.removeTexture(this);\n                }\n            }\n\n            if (v.active) {\n                this.decActiveCount();\n            }\n        }\n    }\n\n    incActiveCount() {\n        // Ensure that texture source's activeCount has transferred ownership.\n        const source = this.source;\n\n        if (source) {\n            this._checkForNewerReusableTextureSource();\n        }\n\n        this._activeCount++;\n        if (this._activeCount === 1) {\n            this.becomesUsed();\n        }\n    }\n\n    decActiveCount() {\n        const source = this.source; // Force updating the source.\n        this._activeCount--;\n        if (!this._activeCount) {\n            this.becomesUnused();\n        }\n    }\n\n    becomesUsed() {\n        if (this.source) {\n            this.source.incActiveTextureCount();\n        }\n    }\n\n    onLoad() {\n        if (this._resizeMode) {\n            this._applyResizeMode();\n        }\n\n        this.elements.forEach(element => {\n            if (element.active) {\n                element.onTextureSourceLoaded();\n            }\n        });\n    }\n\n    _checkForNewerReusableTextureSource() {\n        // When this source became unused and cleaned up, it may have disappeared from the reusable texture map.\n        // In the meantime another texture may have been generated loaded with the same lookup id.\n        // If this is the case, use that one instead to make sure only one active texture source per lookup id exists.\n        const source = this.source;\n        if (!source.isLoaded()) {\n            const reusable = this._getReusableTextureSource();\n            if (reusable && reusable.isLoaded() && (reusable !== source)) {\n                this._replaceTextureSource(reusable);\n            }\n        } else {\n            if (this._resizeMode) {\n                this._applyResizeMode();\n            }\n        }\n    }\n\n    becomesUnused() {\n        if (this.source) {\n            this.source.decActiveTextureCount();\n        }\n    }\n\n    isUsed() {\n        return this._activeCount > 0;\n    }\n\n    /**\n     * Returns the lookup id for the current texture settings, to be able to reuse it.\n     * @returns {string|null}\n     */\n    _getLookupId() {\n        // Default: do not reuse texture.\n        return null;\n    }\n\n    /**\n     * Generates a loader function that is able to generate the texture for the current settings of this texture.\n     * It should return a function that receives a single callback argument.\n     * That callback should be called with the following arguments:\n     *   - err\n     *   - options: object\n     *     - source: ArrayBuffer|WebGlTexture|ImageData|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement|ImageBitmap\n     *     - w: Number\n     *     - h: Number\n     *     - permanent: Boolean\n     *     - hasAlpha: boolean\n     *     - permultiplyAlpha: boolean\n     *     - flipBlueRed: boolean\n     *     - renderInfo: object\n     * The loader itself may return a Function that is called when loading of the texture is cancelled. This can be used\n     * to stop fetching an image when it is no longer in element, for example.\n     */\n    _getSourceLoader() {\n        throw new Error(\"Texture.generate must be implemented.\");\n    }\n\n    get isValid() {\n        return this._getIsValid();\n    }\n\n    /**\n     * If texture is not 'valid', no source can be created for it.\n     * @returns {boolean}\n     */\n    _getIsValid() {\n        return true;\n    }\n\n    /**\n     * This must be called when the texture source must be re-generated.\n     */\n    _changed() {\n        // If no element is actively using this texture, ignore it altogether.\n        if (this.isUsed()) {\n            this._updateSource();\n        } else {\n            this._mustUpdate = true;\n        }\n    }\n\n    _updateSource() {\n        // We delay all updateSource calls to the next drawFrame, so that we can bundle them.\n        // Otherwise we may reload a texture more often than necessary, when, for example, patching multiple text\n        // properties.\n        this.stage.addUpdateSourceTexture(this);\n    }\n\n    _performUpdateSource(force = false) {\n        // If, in the meantime, the texture was no longer used, just remember that it must update until it becomes used\n        // again.\n        if (force || this.isUsed()) {\n            this._mustUpdate = false;\n            let source = this._getTextureSource();\n            this._replaceTextureSource(source);\n        }\n    }\n\n    _getTextureSource() {\n        let source = null;\n        if (this._getIsValid()) {\n            const lookupId = this._getLookupId();\n            source = this._getReusableTextureSource(lookupId);\n            if (!source) {\n                source = this.manager.getTextureSource(this._getSourceLoader(), lookupId);\n            }\n        }\n        return source;\n    }\n\n    _getReusableTextureSource(lookupId = this._getLookupId()) {\n        if (this._getIsValid()) {\n            if (lookupId) {\n                return this.manager.getReusableTextureSource(lookupId);\n            }\n        }\n        return null;\n    }\n\n    _replaceTextureSource(newSource = null) {\n        let oldSource = this._source;\n\n        this._source = newSource;\n\n        if (this.elements.size) {\n            if (oldSource) {\n                if (this._activeCount) {\n                    oldSource.decActiveTextureCount();\n                }\n\n                oldSource.removeTexture(this);\n\n                // free up unused TextTextures immediately as they are not reused anyway\n                if(this['text'] && !oldSource.isUsed()) {\n                    this.manager.freeTextureSource(oldSource);\n                }\n            }\n\n            if (newSource) {\n                // Must happen before setDisplayedTexture to ensure sprite map texcoords are used.\n                newSource.addTexture(this);\n                if (this._activeCount) {\n                    newSource.incActiveTextureCount();\n                }\n            }\n        }\n\n        if (this.isUsed()) {\n            if (newSource) {\n                if (newSource.isLoaded()) {\n\n                    // Apply resizeMode\n                    if (this._resizeMode) {\n                        this._applyResizeMode();\n                    }\n\n                    this.elements.forEach(element => {\n                        if (element.active) {\n                            element._setDisplayedTexture(this);\n                        }\n                    });\n                } else {\n                    const loadError = newSource.loadError;\n                    if (loadError) {\n                        this.elements.forEach(element => {\n                            if (element.active) {\n                                element.onTextureSourceLoadError(loadError);\n                            }\n                        });\n                    }\n                }\n            } else {\n                this.elements.forEach(element => {\n                    if (element.active) {\n                        element._setDisplayedTexture(null);\n                    }\n                });\n            }\n        }\n    }\n\n    load() {\n        // Make sure that source is up to date.\n        if (this.source) {\n            if (!this.isLoaded()) {\n                this.source.load(true);\n            }\n        }\n    }\n\n    isLoaded() {\n        return this._source && this._source.isLoaded();\n    }\n\n    get loadError() {\n        return this._source && this._source.loadError;\n    }\n\n    free() {\n        if (this._source) {\n            this._source.free();\n        }\n    }\n\n    set resizeMode({type = \"cover\", w = 0, h = 0, clipX = 0.5, clipY = 0.5}) {\n        this._resizeMode = {type, w, h, clipX, clipY};\n        if (this.isLoaded()) {\n            this._applyResizeMode();\n        }\n    }\n\n    get resizeMode() {\n        return this._resizeMode;\n    }\n\n    _clearResizeMode() {\n        this._resizeMode = null;\n    }\n\n    _applyResizeMode() {\n        if (this._resizeMode.type === \"cover\") {\n            this._applyResizeCover();\n        } else if (this._resizeMode.type === \"contain\") {\n            this._applyResizeContain();\n        }\n        this._updatePrecision();\n        this._updateClipping();\n    }\n\n    _applyResizeCover() {\n        const scaleX = this._resizeMode.w / this._source.w;\n        const scaleY = this._resizeMode.h / this._source.h;\n        let scale = Math.max(scaleX, scaleY);\n        if (!scale) return;\n        this._precision = 1/scale;\n        if (scaleX && scaleX < scale) {\n            const desiredSize = this._precision * this._resizeMode.w;\n            const choppedOffPixels = this._source.w - desiredSize;\n            this._x = choppedOffPixels * this._resizeMode.clipX;\n            this._w = this._source.w - choppedOffPixels;\n        }\n        if (scaleY && scaleY < scale) {\n            const desiredSize = this._precision * this._resizeMode.h;\n            const choppedOffPixels = this._source.h - desiredSize;\n            this._y = choppedOffPixels * this._resizeMode.clipY;\n            this._h = this._source.h - choppedOffPixels;\n        }\n    }\n\n    _applyResizeContain() {\n        const scaleX = this._resizeMode.w / this._source.w;\n        const scaleY = this._resizeMode.h / this._source.h;\n        let scale = scaleX;\n        if (!scale || scaleY < scale) {\n            scale = scaleY;\n        }\n        if (!scale) return;\n        this._precision = 1/scale;\n    }\n\n    enableClipping(x, y, w, h) {\n        this._clearResizeMode();\n\n        x *= this._precision;\n        y *= this._precision;\n        w *= this._precision;\n        h *= this._precision;\n        if (this._x !== x || this._y !== y || this._w !== w || this._h !== h) {\n            this._x = x;\n            this._y = y;\n            this._w = w;\n            this._h = h;\n\n            this._updateClipping(true);\n        }\n    }\n\n    disableClipping() {\n        this._clearResizeMode();\n\n        if (this._x || this._y || this._w || this._h) {\n            this._x = 0;\n            this._y = 0;\n            this._w = 0;\n            this._h = 0;\n\n            this._updateClipping();\n        }\n    }\n\n    _updateClipping() {\n        this.clipping = !!(this._x || this._y || this._w || this._h);\n\n        let self = this;\n        this.elements.forEach(function(element) {\n            // Ignore if not the currently displayed texture.\n            if (element.displayedTexture === self) {\n                element.onDisplayedTextureClippingChanged();\n            }\n        });\n    }\n\n    _updatePrecision() {\n        let self = this;\n        this.elements.forEach(function(element) {\n            // Ignore if not the currently displayed texture.\n            if (element.displayedTexture === self) {\n                element.onPrecisionChanged();\n            }\n        });\n    }\n\n    getNonDefaults() {\n        let nonDefaults = {};\n        nonDefaults['type'] = this.constructor.name;\n        if (this.x !== 0) nonDefaults['x'] = this.x;\n        if (this.y !== 0) nonDefaults['y'] = this.y;\n        if (this.w !== 0) nonDefaults['w'] = this.w;\n        if (this.h !== 0) nonDefaults['h'] = this.h;\n        if (this.precision !== 1) nonDefaults['precision'] = this.precision;\n        return nonDefaults;\n    }\n\n    get px() {\n        return this._x;\n    }\n\n    get py() {\n        return this._y;\n    }\n\n    get pw() {\n        return this._w;\n    }\n\n    get ph() {\n        return this._h;\n    }\n\n    get x() {\n        return this._x / this._precision;\n    }\n    set x(v) {\n        this._clearResizeMode();\n        v = v * this._precision;\n        if (this._x !== v) {\n            this._x = v;\n            this._updateClipping();\n        }\n    }\n\n    get y() {\n        return this._y / this._precision;\n    }\n    set y(v) {\n        this._clearResizeMode();\n        v = v * this._precision;\n        if (this._y !== v) {\n            this._y = v;\n            this._updateClipping();\n        }\n    }\n\n    get w() {\n        return this._w / this._precision;\n    }\n\n    set w(v) {\n        this._clearResizeMode();\n        v = v * this._precision;\n        if (this._w !== v) {\n            this._w = v;\n            this._updateClipping();\n        }\n    }\n\n    get h() {\n        return this._h / this._precision;\n    }\n\n    set h(v) {\n        this._clearResizeMode();\n        v = v * this._precision;\n        if (this._h !== v) {\n            this._h = v;\n            this._updateClipping();\n        }\n    }\n\n    get precision() {\n        return this._precision;\n    }\n\n    set precision(v) {\n        this._clearResizeMode();\n        if (this._precision !== v) {\n            this._precision = v;\n            this._updatePrecision();\n        }\n    }\n\n    isAutosizeTexture() {\n        return true;\n    }\n\n    getRenderWidth() {\n        if (!this.isAutosizeTexture()) {\n            // In case of the rectangle texture, we'd prefer to not cause a 1x1 w,h as it would interfere with flex layout fit-to-contents.\n            return 0;\n        }\n\n        // If dimensions are unknown (texture not yet loaded), use maximum width as a fallback as render width to allow proper bounds checking.\n        return (this._w || (this._source ? this._source.getRenderWidth() - this._x : 0)) / this._precision;\n    }\n\n    getRenderHeight() {\n        if (!this.isAutosizeTexture()) {\n            // In case of the rectangle texture, we'd prefer to not cause a 1x1 w,h as it would interfere with flex layout fit-to-contents.\n            return 0;\n        }\n\n        return (this._h || (this._source ? this._source.getRenderHeight() - this._y : 0)) / this._precision;\n    }\n\n    patch(settings) {\n        Base.patchObject(this, settings);\n    }\n\n}\n\nTexture.prototype.isTexture = true;\n\nTexture.id = 0;\n\nimport Base from \"./Base.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Texture from \"../tree/Texture.mjs\";\n\nexport default class ImageTexture extends Texture {\n\n    constructor(stage) {\n        super(stage);\n\n        this._src = undefined;\n        this._hasAlpha = false;\n    }\n\n    get src() {\n        return this._src;\n    }\n\n    set src(v) {\n        if (this._src !== v) {\n            this._src = v;\n            this._changed();\n        }\n    }\n\n    get hasAlpha() {\n        return this._hasAlpha;\n    }\n\n    set hasAlpha(v) {\n        if (this._hasAlpha !== v) {\n            this._hasAlpha = v;\n            this._changed();\n        }\n    }\n\n    _getIsValid() {\n        return !!this._src;\n    }\n\n    _getLookupId() {\n        return this._src;\n    }\n\n    _getSourceLoader() {\n        let src = this._src;\n        let hasAlpha = this._hasAlpha;\n        if (this.stage.getOption('srcBasePath')) {\n            var fc = src.charCodeAt(0);\n            if ((src.indexOf(\"//\") === -1) && ((fc >= 65 && fc <= 90) || (fc >= 97 && fc <= 122) || fc == 46)) {\n                // Alphabetical or dot: prepend base path.\n                src = this.stage.getOption('srcBasePath') + src;\n            }\n        }\n\n        return (cb) => {\n            return this.stage.platform.loadSrcTexture({src: src, hasAlpha: hasAlpha}, cb);\n        }\n    }\n\n    getNonDefaults() {\n        const obj = super.getNonDefaults();\n        if (this._src) {\n            obj.src = this._src;\n        }\n        return obj;\n    }\n\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Returns CSS font setting string for use in canvas context.\n *\n * @param fontFace\n * @param fontStyle\n * @param fontSize\n * @param precision\n * @param defaultFontFace\n * @returns\n */\nexport function getFontSetting(fontFace, fontStyle, fontSize, precision, defaultFontFace) {\n    let ff = fontFace;\n    if (!Array.isArray(ff)) {\n        ff = [ff];\n    }\n    let ffs = [];\n    for (let i = 0, n = ff.length; i < n; i++) {\n        let curFf = ff[i];\n        // Replace the default font face `null` with the actual default font face set\n        // on the stage.\n        if (curFf === null) {\n            curFf = defaultFontFace;\n        }\n        if (curFf === \"serif\" || curFf === \"sans-serif\") {\n            ffs.push(curFf);\n        }\n        else {\n            ffs.push(`\"${curFf}\"`);\n        }\n    }\n    return `${fontStyle} ${fontSize * precision}px ${ffs.join(\",\")}`;\n}\n/**\n * Returns true if the given character is a zero-width space.\n *\n * @param space\n */\nexport function isZeroWidthSpace(space) {\n    return space === '' || space === '\\u200B';\n}\n/**\n * Returns true if the given character is a zero-width space or a regular space.\n *\n * @param space\n */\nexport function isSpace(space) {\n    return isZeroWidthSpace(space) || space === ' ';\n}\n/**\n * Converts a string into an array of tokens and the words between them.\n *\n * @param tokenRegex\n * @param text\n */\nexport function tokenizeString(tokenRegex, text) {\n    const delimeters = text.match(tokenRegex) || [];\n    const words = text.split(tokenRegex) || [];\n    let final = [];\n    for (let i = 0; i < words.length; i++) {\n        final.push(words[i], delimeters[i]);\n    }\n    final.pop();\n    return final.filter((word) => word != '');\n}\n/**\n * Measure the width of a string accounting for letter spacing.\n *\n * @param context\n * @param word\n * @param space\n */\nexport function measureText(context, word, space = 0) {\n    if (!space) {\n        return context.measureText(word).width;\n    }\n    return word.split('').reduce((acc, char) => {\n        // Zero-width spaces should not include letter spacing.\n        // And since we know the width of a zero-width space is 0, we can skip\n        // measuring it.\n        if (isZeroWidthSpace(char)) {\n            return acc;\n        }\n        return acc + context.measureText(char).width + space;\n    }, 0);\n}\n/**\n * Applies newlines to a string to have it optimally fit into the horizontal\n * bounds set by the Text object's wordWrapWidth property.\n *\n * @param context\n * @param text\n * @param wordWrapWidth\n * @param letterSpacing\n * @param indent\n */\nexport function wrapText(context, text, wordWrapWidth, letterSpacing, indent) {\n    // Greedy wrapping algorithm that will wrap words as the line grows longer.\n    // than its horizontal bounds.\n    const spaceRegex = / |\\u200B/g;\n    let lines = text.split(/\\r?\\n/g);\n    let allLines = [];\n    let realNewlines = [];\n    for (let i = 0; i < lines.length; i++) {\n        let resultLines = [];\n        let result = '';\n        let spaceLeft = wordWrapWidth - indent;\n        let words = lines[i].split(spaceRegex);\n        let spaces = lines[i].match(spaceRegex) || [];\n        for (let j = 0; j < words.length; j++) {\n            const space = spaces[j - 1] || '';\n            const word = words[j];\n            const wordWidth = measureText(context, word, letterSpacing);\n            const wordWidthWithSpace = wordWidth + measureText(context, space, letterSpacing);\n            if (j === 0 || wordWidthWithSpace > spaceLeft) {\n                // Skip printing the newline if it's the first word of the line that is.\n                // greater than the word wrap width.\n                if (j > 0) {\n                    resultLines.push(result);\n                    result = '';\n                }\n                result += word;\n                spaceLeft = wordWrapWidth - wordWidth - (j === 0 ? indent : 0);\n            }\n            else {\n                spaceLeft -= wordWidthWithSpace;\n                result += space + word;\n            }\n        }\n        resultLines.push(result);\n        result = '';\n        allLines = allLines.concat(resultLines);\n        if (i < lines.length - 1) {\n            realNewlines.push(allLines.length);\n        }\n    }\n    return { l: allLines, n: realNewlines };\n}\n//# sourceMappingURL=TextTextureRendererUtils.mjs.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport StageUtils from \"../tree/StageUtils.mjs\";\nimport Utils from \"../tree/Utils.mjs\";\nimport { getFontSetting, measureText, wrapText } from \"./TextTextureRendererUtils.mjs\";\n\nexport default class TextTextureRenderer {\n\n    constructor(stage, canvas, settings) {\n        this._stage = stage;\n        this._canvas = canvas;\n        this._context = this._canvas.getContext('2d');\n        this._settings = settings;\n    }\n\n    getPrecision() {\n        return this._settings.precision;\n    };\n\n    setFontProperties() {\n        this._context.font = getFontSetting(\n            this._settings.fontFace,\n            this._settings.fontStyle,\n            this._settings.fontSize,\n            this.getPrecision(),\n            this._stage.getOption('defaultFontFace'),\n        );\n        this._context.textBaseline = this._settings.textBaseline;\n    };\n\n    _load() {\n        if (Utils.isWeb && document.fonts) {\n            const fontSetting = getFontSetting(\n                this._settings.fontFace,\n                this._settings.fontStyle,\n                this._settings.fontSize,\n                this.getPrecision(),\n                this._stage.getOption('defaultFontFace')\n            );\n            try {\n                if (!document.fonts.check(fontSetting, this._settings.text)) {\n                    // Use a promise that waits for loading.\n                    return document.fonts.load(fontSetting, this._settings.text).catch(err => {\n                        // Just load the fallback font.\n                        console.warn('[Lightning] Font load error', err, fontSetting);\n                    }).then(() => {\n                        if (!document.fonts.check(fontSetting, this._settings.text)) {\n                            console.warn('[Lightning] Font not found', fontSetting);\n                        }\n                    });\n                }\n            } catch(e) {\n                console.warn(\"[Lightning] Can't check font loading for \" + fontSetting);\n            }\n        }\n    }\n\n    draw() {\n        // We do not use a promise so that loading is performed syncronous when possible.\n        const loadPromise = this._load();\n        if (!loadPromise) {\n            return Utils.isSpark ? this._stage.platform.drawText(this) : this._draw();\n        } else {\n            return loadPromise.then(() => {\n                return Utils.isSpark ? this._stage.platform.drawText(this) : this._draw();\n            });\n        }\n    }\n\n    _calculateRenderInfo() {\n        let renderInfo = {};\n\n        const precision = this.getPrecision();\n\n        const paddingLeft = this._settings.paddingLeft * precision;\n        const paddingRight = this._settings.paddingRight * precision;\n        const fontSize = this._settings.fontSize * precision;\n        let offsetY = this._settings.offsetY === null ? null : (this._settings.offsetY * precision);\n        let lineHeight = this._settings.lineHeight * precision;\n        const w = this._settings.w * precision;\n        const h = this._settings.h * precision;\n        let wordWrapWidth = this._settings.wordWrapWidth * precision;\n        const cutSx = this._settings.cutSx * precision;\n        const cutEx = this._settings.cutEx * precision;\n        const cutSy = this._settings.cutSy * precision;\n        const cutEy = this._settings.cutEy * precision;\n        const letterSpacing = (this._settings.letterSpacing || 0) * precision;\n        const textIndent = this._settings.textIndent * precision;\n\n        // Set font properties.\n        this.setFontProperties();\n\n        // Total width.\n        let width = w || this._stage.getOption('w');\n\n        // Inner width.\n        let innerWidth = width - (paddingLeft);\n        if (innerWidth < 10) {\n            width += (10 - innerWidth);\n            innerWidth = 10;\n        }\n\n        if (!wordWrapWidth) {\n            wordWrapWidth = innerWidth\n        }\n\n        // Text overflow\n        if (this._settings.textOverflow && !this._settings.wordWrap) {\n            let suffix;\n            switch (this._settings.textOverflow) {\n                case 'clip':\n                    suffix = '';\n                    break;\n                case 'ellipsis':\n                    suffix = this._settings.maxLinesSuffix;\n                    break;\n                default:\n                    suffix = this._settings.textOverflow;\n            }\n            this._settings.text = this.wrapWord(this._settings.text, wordWrapWidth - textIndent, suffix)\n        }\n\n        // word wrap\n        // preserve original text\n        let linesInfo;\n        if (this._settings.wordWrap) {\n            linesInfo = this.wrapText(this._settings.text, wordWrapWidth, letterSpacing, textIndent);\n        } else {\n            linesInfo = {l: this._settings.text.split(/(?:\\r\\n|\\r|\\n)/), n: []};\n            let i, n = linesInfo.l.length;\n            for (let i = 0; i < n - 1; i++) {\n                linesInfo.n.push(i);\n            }\n        }\n        let lines = linesInfo.l;\n\n        if (this._settings.maxLines && lines.length > this._settings.maxLines) {\n            let usedLines = lines.slice(0, this._settings.maxLines);\n\n            let otherLines = null;\n            if (this._settings.maxLinesSuffix) {\n                // Wrap again with max lines suffix enabled.\n                let w = this._settings.maxLinesSuffix ? this.measureText(this._settings.maxLinesSuffix) : 0;\n                let al = this.wrapText(usedLines[usedLines.length - 1], wordWrapWidth - w, letterSpacing, textIndent);\n                usedLines[usedLines.length - 1] = al.l[0] + this._settings.maxLinesSuffix;\n                otherLines = [al.l.length > 1 ? al.l[1] : ''];\n            } else {\n                otherLines = [''];\n            }\n\n            // Re-assemble the remaining text.\n            let i, n = lines.length;\n            let j = 0;\n            let m = linesInfo.n.length;\n            for (i = this._settings.maxLines; i < n; i++) {\n                otherLines[j] += (otherLines[j] ? \" \" : \"\") + lines[i];\n                if (i + 1 < m && linesInfo.n[i + 1]) {\n                    j++;\n                }\n            }\n\n            renderInfo.remainingText = otherLines.join(\"\\n\");\n\n            renderInfo.moreTextLines = true;\n\n            lines = usedLines;\n        } else {\n            renderInfo.moreTextLines = false;\n            renderInfo.remainingText = \"\";\n        }\n\n        // calculate text width\n        let maxLineWidth = 0;\n        let lineWidths = [];\n        for (let i = 0; i < lines.length; i++) {\n            let lineWidth = this.measureText(lines[i], letterSpacing) + (i === 0 ? textIndent : 0);\n            lineWidths.push(lineWidth);\n            maxLineWidth = Math.max(maxLineWidth, lineWidth);\n        }\n\n        renderInfo.lineWidths = lineWidths;\n\n        if (!w) {\n            // Auto-set width to max text length.\n            width = maxLineWidth + paddingLeft + paddingRight;\n            innerWidth = maxLineWidth;\n        }\n\n        // calculate text height\n        lineHeight = lineHeight || fontSize;\n\n        let height;\n        if (h) {\n            height = h;\n        } else {\n            const baselineOffset = (this._settings.textBaseline != 'bottom') ? 0.5 * fontSize : 0;\n            height = lineHeight * (lines.length - 1) + baselineOffset + Math.max(lineHeight, fontSize) + offsetY;\n        }\n\n        if (offsetY === null) {\n            offsetY = fontSize;\n        }\n\n        renderInfo.w = width;\n        renderInfo.h = height;\n        renderInfo.lines = lines;\n        renderInfo.precision = precision;\n\n        if (!width) {\n            // To prevent canvas errors.\n            width = 1;\n        }\n\n        if (!height) {\n            // To prevent canvas errors.\n            height = 1;\n        }\n\n        if (cutSx || cutEx) {\n            width = Math.min(width, cutEx - cutSx);\n        }\n\n        if (cutSy || cutEy) {\n            height = Math.min(height, cutEy - cutSy);\n        }\n\n        renderInfo.width = width;\n        renderInfo.innerWidth = innerWidth;\n        renderInfo.height = height;\n        renderInfo.fontSize = fontSize;\n        renderInfo.cutSx = cutSx;\n        renderInfo.cutSy = cutSy;\n        renderInfo.cutEx = cutEx;\n        renderInfo.cutEy = cutEy;\n        renderInfo.lineHeight = lineHeight;\n        renderInfo.lineWidths = lineWidths;\n        renderInfo.offsetY = offsetY;\n        renderInfo.paddingLeft = paddingLeft;\n        renderInfo.paddingRight = paddingRight;\n        renderInfo.letterSpacing = letterSpacing;\n        renderInfo.textIndent = textIndent;\n\n        return renderInfo;\n    }\n\n    _draw() {\n        const renderInfo = this._calculateRenderInfo();\n        const precision = this.getPrecision();\n\n        // Add extra margin to prevent issue with clipped text when scaling.\n        this._canvas.width = Math.ceil(renderInfo.width + this._stage.getOption('textRenderIssueMargin'));\n        this._canvas.height = Math.ceil(renderInfo.height);\n\n        // Canvas context has been reset.\n        this.setFontProperties();\n\n        if (renderInfo.fontSize >= 128) {\n            // WpeWebKit bug: must force compositing because cairo-traps-compositor will not work with text first.\n            this._context.globalAlpha = 0.01;\n            this._context.fillRect(0, 0, 0.01, 0.01);\n            this._context.globalAlpha = 1.0;\n        }\n\n        if (renderInfo.cutSx || renderInfo.cutSy) {\n            this._context.translate(-renderInfo.cutSx, -renderInfo.cutSy);\n        }\n\n        let linePositionX;\n        let linePositionY;\n\n        let drawLines = [];\n\n        // Draw lines line by line.\n        for (let i = 0, n = renderInfo.lines.length; i < n; i++) {\n            linePositionX = i === 0 ? renderInfo.textIndent : 0;\n\n            // By default, text is aligned to top\n            linePositionY = (i * renderInfo.lineHeight) + renderInfo.offsetY;\n\n            if (this._settings.verticalAlign == 'middle') {\n                linePositionY += (renderInfo.lineHeight - renderInfo.fontSize) / 2;\n            } else if (this._settings.verticalAlign == 'bottom') {\n                linePositionY += renderInfo.lineHeight - renderInfo.fontSize;\n            }\n\n            if (this._settings.textAlign === 'right') {\n                linePositionX += (renderInfo.innerWidth - renderInfo.lineWidths[i]);\n            } else if (this._settings.textAlign === 'center') {\n                linePositionX += ((renderInfo.innerWidth - renderInfo.lineWidths[i]) / 2);\n            }\n            linePositionX += renderInfo.paddingLeft;\n\n            drawLines.push({text: renderInfo.lines[i], x: linePositionX, y: linePositionY, w: renderInfo.lineWidths[i]});\n        }\n\n        // Highlight.\n        if (this._settings.highlight) {\n            let color = this._settings.highlightColor || 0x00000000;\n\n            let hlHeight = (this._settings.highlightHeight * precision || renderInfo.fontSize * 1.5);\n            const offset = this._settings.highlightOffset * precision;\n            const hlPaddingLeft = (this._settings.highlightPaddingLeft !== null ? this._settings.highlightPaddingLeft * precision : renderInfo.paddingLeft);\n            const hlPaddingRight = (this._settings.highlightPaddingRight !== null ? this._settings.highlightPaddingRight * precision : renderInfo.paddingRight);\n\n            this._context.fillStyle = StageUtils.getRgbaString(color);\n            for (let i = 0; i < drawLines.length; i++) {\n                let drawLine = drawLines[i];\n                this._context.fillRect((drawLine.x - hlPaddingLeft), (drawLine.y - renderInfo.offsetY + offset), (drawLine.w + hlPaddingRight + hlPaddingLeft), hlHeight);\n            }\n        }\n\n        // Text shadow.\n        let prevShadowSettings = null;\n        if (this._settings.shadow) {\n            prevShadowSettings = [this._context.shadowColor, this._context.shadowOffsetX, this._context.shadowOffsetY, this._context.shadowBlur];\n\n            this._context.shadowColor = StageUtils.getRgbaString(this._settings.shadowColor);\n            this._context.shadowOffsetX = this._settings.shadowOffsetX * precision;\n            this._context.shadowOffsetY = this._settings.shadowOffsetY * precision;\n            this._context.shadowBlur = this._settings.shadowBlur * precision;\n        }\n\n        this._context.fillStyle = StageUtils.getRgbaString(this._settings.textColor);\n        for (let i = 0, n = drawLines.length; i < n; i++) {\n            let drawLine = drawLines[i];\n\n            if (renderInfo.letterSpacing === 0) {\n                this._context.fillText(drawLine.text, drawLine.x, drawLine.y);\n            } else {\n                const textSplit = drawLine.text.split('');\n                let x = drawLine.x;\n                for (let i = 0, j = textSplit.length; i < j; i++) {\n                    this._context.fillText(textSplit[i], x, drawLine.y);\n                    x += this.measureText(textSplit[i], renderInfo.letterSpacing);\n                }\n            }\n        }\n\n        if (prevShadowSettings) {\n            this._context.shadowColor = prevShadowSettings[0];\n            this._context.shadowOffsetX = prevShadowSettings[1];\n            this._context.shadowOffsetY = prevShadowSettings[2];\n            this._context.shadowBlur = prevShadowSettings[3];\n        }\n\n        if (renderInfo.cutSx || renderInfo.cutSy) {\n            this._context.translate(renderInfo.cutSx, renderInfo.cutSy);\n        }\n\n        this.renderInfo = renderInfo;\n    };\n\n    wrapWord(word, wordWrapWidth, suffix) {\n        const suffixWidth = this.measureText(suffix);\n        const wordLen = word.length\n        const wordWidth = this.measureText(word);\n\n        /* If word fits wrapWidth, do nothing */\n        if (wordWidth <= wordWrapWidth) {\n            return word;\n        }\n\n        /* Make initial guess for text cuttoff */\n        let cutoffIndex = Math.floor((wordWrapWidth * wordLen) / wordWidth);\n        let truncWordWidth = this.measureText(word.substring(0, cutoffIndex)) + suffixWidth;\n\n        /* In case guess was overestimated, shrink it letter by letter. */\n        if (truncWordWidth > wordWrapWidth) {\n            while (cutoffIndex > 0) {\n                truncWordWidth = this.measureText(word.substring(0, cutoffIndex)) + suffixWidth;\n                if (truncWordWidth > wordWrapWidth) {\n                    cutoffIndex -= 1;\n                } else {\n                    break;\n                }\n            }\n\n        /* In case guess was underestimated, extend it letter by letter. */\n        } else {\n            while (cutoffIndex < wordLen) {\n                truncWordWidth = this.measureText(word.substring(0, cutoffIndex)) + suffixWidth;\n                if (truncWordWidth < wordWrapWidth) {\n                    cutoffIndex += 1;\n                } else {\n                    // Finally, when bound is crossed, retract last letter.\n                    cutoffIndex -=1;\n                    break;\n                }\n            }\n        }\n\n        /* If wrapWidth is too short to even contain suffix alone, return empty string */\n        return word.substring(0, cutoffIndex) + (wordWrapWidth >= suffixWidth ? suffix : '');\n    }\n\n    /**\n     * See {@link wrapText}\n     *\n     * @param {string} text\n     * @param {number} wordWrapWidth\n     * @param {number} letterSpacing\n     * @param {number} indent\n     * @returns\n     */\n    wrapText(text, wordWrapWidth, letterSpacing, indent = 0) {\n        return wrapText(this._context, text, wordWrapWidth, letterSpacing, indent);\n    };\n\n    /**\n     * See {@link measureText}\n     *\n     * @param {string} word\n     * @param {number} space\n     * @returns {number}\n     */\n    measureText(word, space = 0) {\n        return measureText(this._context, word, space);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport StageUtils from \"../tree/StageUtils.mjs\";\nimport Utils from \"../tree/Utils.mjs\";\nimport { getFontSetting, isSpace, measureText, tokenizeString } from \"./TextTextureRendererUtils.mjs\";\n\nexport default class TextTextureRendererAdvanced {\n\n    constructor(stage, canvas, settings) {\n        this._stage = stage;\n        this._canvas = canvas;\n        this._context = this._canvas.getContext('2d');\n        this._settings = settings;\n    }\n\n    getPrecision() {\n        return this._settings.precision;\n    };\n\n    setFontProperties() {\n        const font = getFontSetting(\n            this._settings.fontFace,\n            this._settings.fontStyle,\n            this._settings.fontSize,\n            this.getPrecision(),\n            this._stage.getOption('defaultFontFace')\n        );\n        this._context.font = font;\n        this._context.textBaseline = this._settings.textBaseline;\n        return font;\n    };\n\n    _load() {\n        if (Utils.isWeb && document.fonts) {\n            const fontSetting = getFontSetting(\n                this._settings.fontFace,\n                this._settings.fontStyle,\n                this._settings.fontSize,\n                this.getPrecision(),\n                this._stage.getOption('defaultFontFace')\n            );\n            try {\n                if (!document.fonts.check(fontSetting, this._settings.text)) {\n                    // Use a promise that waits for loading.\n                    return document.fonts.load(fontSetting, this._settings.text).catch(err => {\n                        // Just load the fallback font.\n                        console.warn('Font load error', err, fontSetting);\n                    }).then(() => {\n                        if (!document.fonts.check(fontSetting, this._settings.text)) {\n                            console.warn('Font not found', fontSetting);\n                        }\n                    });\n                }\n            } catch(e) {\n                console.warn(\"Can't check font loading for \" + fontSetting);\n            }\n        }\n    }\n\n    draw() {\n        // We do not use a promise so that loading is performed syncronous when possible.\n        const loadPromise = this._load();\n        if (!loadPromise) {\n            return Utils.isSpark ? this._stage.platform.drawText(this) : this._draw();\n        } else {\n            return loadPromise.then(() => {\n                return Utils.isSpark ? this._stage.platform.drawText(this) : this._draw();\n            });\n        }\n    }\n\n    _calculateRenderInfo() {\n        let renderInfo = {};\n\n        const precision = this.getPrecision();\n\n        const paddingLeft = this._settings.paddingLeft * precision;\n        const paddingRight = this._settings.paddingRight * precision;\n        const fontSize = this._settings.fontSize * precision;\n        // const offsetY = this._settings.offsetY === null ? null : (this._settings.offsetY * precision);\n        const lineHeight = this._settings.lineHeight * precision || fontSize;\n        const w = this._settings.w != 0 ? this._settings.w * precision : this._stage.getOption('w');\n        // const h = this._settings.h * precision;\n        const wordWrapWidth = this._settings.wordWrapWidth * precision;\n        const cutSx = this._settings.cutSx * precision;\n        const cutEx = this._settings.cutEx * precision;\n        const cutSy = this._settings.cutSy * precision;\n        const cutEy = this._settings.cutEy * precision;\n        const letterSpacing = this._settings.letterSpacing || 0;\n\n        // Set font properties.\n        renderInfo.baseFont = this.setFontProperties();\n\n        renderInfo.w = w;\n        renderInfo.width = w;\n        renderInfo.text = this._settings.text;\n        renderInfo.precision = precision;\n        renderInfo.fontSize = fontSize;\n        renderInfo.fontBaselineRatio = this._settings.fontBaselineRatio;\n        renderInfo.lineHeight = lineHeight;\n        renderInfo.letterSpacing = letterSpacing;\n        renderInfo.textAlign = this._settings.textAlign;\n        renderInfo.textColor = this._settings.textColor;\n        renderInfo.verticalAlign = this._settings.verticalAlign;\n        renderInfo.highlight = this._settings.highlight;\n        renderInfo.highlightColor = this._settings.highlightColor;\n        renderInfo.highlightHeight = this._settings.highlightHeight;\n        renderInfo.highlightPaddingLeft = this._settings.highlightPaddingLeft;\n        renderInfo.highlightPaddingRight = this._settings.highlightPaddingRight;\n        renderInfo.highlightOffset = this._settings.highlightOffset;\n        renderInfo.paddingLeft = this._settings.paddingLeft;\n        renderInfo.paddingRight = this._settings.paddingRight;\n        renderInfo.maxLines = this._settings.maxLines;\n        renderInfo.maxLinesSuffix = this._settings.maxLinesSuffix;\n        renderInfo.textOverflow = this._settings.textOverflow;\n        renderInfo.wordWrap = this._settings.wordWrap;\n        renderInfo.wordWrapWidth = wordWrapWidth;\n        renderInfo.shadow = this._settings.shadow;\n        renderInfo.shadowColor = this._settings.shadowColor;\n        renderInfo.shadowOffsetX = this._settings.shadowOffsetX;\n        renderInfo.shadowOffsetY = this._settings.shadowOffsetY;\n        renderInfo.shadowBlur = this._settings.shadowBlur;\n        renderInfo.cutSx = cutSx;\n        renderInfo.cutEx = cutEx;\n        renderInfo.cutSy = cutSy;\n        renderInfo.cutEy = cutEy;\n        renderInfo.textIndent = this._settings.textIndent * precision;\n        renderInfo.wordBreak = this._settings.wordBreak;\n\n        let text = renderInfo.text;\n        let wrapWidth = renderInfo.wordWrap ? (renderInfo.wordWrapWidth || renderInfo.width) : renderInfo.width;\n\n        // Text overflow\n        if (renderInfo.textOverflow && !renderInfo.wordWrap) {\n            let suffix;\n            switch (this._settings.textOverflow) {\n                case 'clip':\n                    suffix = '';\n                    break;\n                case 'ellipsis':\n                    suffix = this._settings.maxLinesSuffix;\n                    break;\n                default:\n                    suffix = this._settings.textOverflow;\n            }\n            text = this.wrapWord(text, wordWrapWidth || renderInfo.w, suffix);\n        }\n\n        text = this.tokenize(text);\n        text = this.parse(text);\n        text = this.measure(text, letterSpacing, renderInfo.baseFont);\n\n        if (renderInfo.textIndent) {\n            text = this.indent(text, renderInfo.textIndent);\n        }\n\n        if (renderInfo.wordBreak) {\n            text = text.reduce((acc, t) => acc.concat(this.wordBreak(t, wrapWidth, renderInfo.baseFont)), [])\n            this.resetFontStyle()\n        }\n\n        // Calculate detailed drawing information\n        let x = paddingLeft;\n        let lineNo = 0;\n\n        for (const t of text) {\n            // Wrap text\n            if (renderInfo.wordWrap && x + t.width > wrapWidth || t.text == '\\n') {\n                x = paddingLeft;\n                lineNo += 1;\n            }\n            t.lineNo = lineNo;\n\n            if (t.text == '\\n') {\n                continue;\n            }\n\n            t.x = x;\n            x += t.width;\n        }\n        renderInfo.lineNum = lineNo + 1;\n\n        if (this._settings.h) {\n            renderInfo.h = this._settings.h;\n        } else if (renderInfo.maxLines && renderInfo.maxLines < renderInfo.lineNum) {\n            renderInfo.h = renderInfo.maxLines * renderInfo.lineHeight + fontSize / 2;\n        } else {\n            renderInfo.h = renderInfo.lineNum * renderInfo.lineHeight + fontSize / 2;\n        }\n\n        // This calculates the baseline offset in pixels from the font size.\n        // To retrieve this ratio, you would do this calculation:\n        //     (FontUnitsPerEm − hhea.Ascender − hhea.Descender) / (2 × FontUnitsPerEm)\n        //\n        // This give you the ratio for the baseline, which is then used to figure out\n        // where the baseline is relative to the bottom of the text bounding box.\n        const baselineOffsetInPx = renderInfo.fontBaselineRatio * renderInfo.fontSize;\n\n        // Vertical align\n        let vaOffset = 0;\n        if (renderInfo.verticalAlign == 'top' && this._context.textBaseline == 'alphabetic') {\n            vaOffset = -baselineOffsetInPx;\n        } else if (renderInfo.verticalAlign == 'middle') {\n            vaOffset = (renderInfo.lineHeight - renderInfo.fontSize - baselineOffsetInPx) / 2;\n        } else if (this._settings.verticalAlign == 'bottom') {\n            vaOffset = renderInfo.lineHeight - renderInfo.fontSize;\n        }\n\n        // Calculate lines information\n        renderInfo.lines = []\n        for (let i = 0; i < renderInfo.lineNum; i++) {\n            renderInfo.lines[i] = {\n                width: 0,\n                x: 0,\n                y: renderInfo.lineHeight * i + vaOffset,\n                text: [],\n            }\n        }\n\n        for (let t of text) {\n            renderInfo.lines[t.lineNo].text.push(t);\n        }\n\n        // Filter out white spaces at beginning and end of each line\n        for (const l of renderInfo.lines) {\n            if (l.text.length == 0) {\n                continue;\n            }\n\n            const firstWord = l.text[0].text;\n            const lastWord = l.text[l.text.length - 1].text;\n\n            if (firstWord == '\\n') {\n                l.text.shift();\n            }\n            if (isSpace(lastWord) || lastWord == '\\n') {\n                l.text.pop();\n            }\n        }\n\n\n        // Calculate line width\n        for (let l of renderInfo.lines) {\n            l.width = l.text.reduce((acc, t) => acc + t.width, 0);\n        }\n\n        renderInfo.width = this._settings.w != 0 ? this._settings.w * precision : Math.max(...renderInfo.lines.map((l) => l.width)) + paddingRight;\n        renderInfo.w = renderInfo.width;\n\n        // Apply maxLinesSuffix\n        if (renderInfo.maxLines && renderInfo.lineNum > renderInfo.maxLines && renderInfo.maxLinesSuffix) {\n            const index = renderInfo.maxLines - 1;\n            let lastLineText = text.filter((t) => t.lineNo == index)\n            let suffix = renderInfo.maxLinesSuffix;\n            suffix = this.tokenize(suffix);\n            suffix = this.parse(suffix);\n            suffix = this.measure(suffix, renderInfo.letterSpacing, renderInfo.baseFont);\n            for (const s of suffix) {\n                s.lineNo = index;\n                s.x = 0;\n                lastLineText.push(s)\n            }\n\n            const spl = suffix.length + 1\n            let _w = lastLineText.reduce((acc, t) => acc + t.width, 0);\n            while (_w > renderInfo.width || isSpace(lastLineText[lastLineText.length - spl].text)) {\n                lastLineText.splice(lastLineText.length - spl, 1);\n                _w = lastLineText.reduce((acc, t) => acc + t.width, 0);\n                if (lastLineText.length < spl) {\n                    break;\n                }\n            }\n            this.alignLine(lastLineText, lastLineText[0].x)\n\n            renderInfo.lines[index].text = lastLineText;\n            renderInfo.lines[index].width = _w;\n        }\n\n        // Horizontal alignment offset\n        if (renderInfo.textAlign == 'center') {\n            for (let l of renderInfo.lines) {\n                l.x = (renderInfo.width - l.width - paddingLeft) / 2;\n            }\n        } else if (renderInfo.textAlign == 'right') {\n            for (let l of renderInfo.lines) {\n                l.x = renderInfo.width - l.width - paddingLeft;\n            }\n        }\n\n        return renderInfo;\n    }\n\n    _draw() {\n        const renderInfo = this._calculateRenderInfo();\n        const precision = this.getPrecision();\n        const paddingLeft = renderInfo.paddingLeft * precision;\n\n        // Set canvas dimensions\n        let canvasWidth = renderInfo.w || renderInfo.width;\n        if (renderInfo.cutSx || renderInfo.cutEx) {\n            canvasWidth = Math.min(renderInfo.w, renderInfo.cutEx - renderInfo.cutSx);\n        }\n\n        let canvasHeight = renderInfo.h;\n        if (renderInfo.cutSy || renderInfo.cutEy) {\n            canvasHeight = Math.min(renderInfo.h, renderInfo.cutEy - renderInfo.cutSy);\n        }\n\n        this._canvas.width = Math.ceil(canvasWidth + this._stage.getOption('textRenderIssueMargin'));\n        this._canvas.height = Math.ceil(canvasHeight);\n\n        // Canvas context has been reset.\n        this.setFontProperties();\n\n        if (renderInfo.fontSize >= 128) {\n            // WpeWebKit bug: must force compositing because cairo-traps-compositor will not work with text first.\n            this._context.globalAlpha = 0.01;\n            this._context.fillRect(0, 0, 0.01, 0.01);\n            this._context.globalAlpha = 1.0;\n        }\n\n        // Cut\n        if (renderInfo.cutSx || renderInfo.cutSy) {\n            this._context.translate(-renderInfo.cutSx, -renderInfo.cutSy);\n        }\n\n        // Highlight\n        if (renderInfo.highlight) {\n            const hlColor = renderInfo.highlightColor || 0x00000000;\n            const hlHeight = renderInfo.highlightHeight ? renderInfo.highlightHeight * precision :  renderInfo.fontSize * 1.5;\n            const hlOffset = renderInfo.highlightOffset ? renderInfo.highlightOffset * precision : 0;\n            const hlPaddingLeft = (renderInfo.highlightPaddingLeft !== null ? renderInfo.highlightPaddingLeft * precision : renderInfo.paddingLeft);\n            const hlPaddingRight = (renderInfo.highlightPaddingRight !== null ? renderInfo.highlightPaddingRight * precision : renderInfo.paddingRight);\n\n            this._context.fillStyle = StageUtils.getRgbaString(hlColor);\n            const lineNum = renderInfo.maxLines ? Math.min(renderInfo.maxLines, renderInfo.lineNum) : renderInfo.lineNum;\n            for (let i = 0; i < lineNum; i++) {\n                const l = renderInfo.lines[i];\n                this._context.fillRect(l.x - hlPaddingLeft + paddingLeft, l.y + hlOffset, l.width + hlPaddingLeft + hlPaddingRight, hlHeight);\n            }\n        }\n\n        // Text shadow.\n        let prevShadowSettings = null;\n        if (this._settings.shadow) {\n            prevShadowSettings = [this._context.shadowColor, this._context.shadowOffsetX, this._context.shadowOffsetY, this._context.shadowBlur];\n\n            this._context.shadowColor = StageUtils.getRgbaString(this._settings.shadowColor);\n            this._context.shadowOffsetX = this._settings.shadowOffsetX * precision;\n            this._context.shadowOffsetY = this._settings.shadowOffsetY * precision;\n            this._context.shadowBlur = this._settings.shadowBlur * precision;\n        }\n\n        // Draw text\n        const defaultColor = StageUtils.getRgbaString(this._settings.textColor);\n        let currentColor = defaultColor;\n        this._context.fillStyle = defaultColor;\n        for (const line of renderInfo.lines) {\n            for (const t of line.text) {\n                let lx = 0;\n\n                if (t.text == '\\n') {\n                    continue;\n                }\n\n                if (renderInfo.maxLines && t.lineNo >= renderInfo.maxLines) {\n                    continue;\n                }\n\n                if (t.color != currentColor) {\n                    currentColor = t.color;\n                    this._context.fillStyle = currentColor;\n                }\n\n                this._context.font = t.fontStyle;\n\n                // Draw with letter spacing\n                if (t.letters) {\n                    for (let l of t.letters) {\n                        const _x = renderInfo.lines[t.lineNo].x + t.x + lx;\n                        this._context.fillText(l.text, _x, renderInfo.lines[t.lineNo].y + renderInfo.fontSize);\n                        lx += l.width;\n                    }\n                // Standard drawing\n                } else {\n                    const _x = renderInfo.lines[t.lineNo].x + t.x;\n                    this._context.fillText(t.text, _x, renderInfo.lines[t.lineNo].y + renderInfo.fontSize);\n                }\n            }\n        }\n\n        // Reset text shadow\n        if (prevShadowSettings) {\n            this._context.shadowColor = prevShadowSettings[0];\n            this._context.shadowOffsetX = prevShadowSettings[1];\n            this._context.shadowOffsetY = prevShadowSettings[2];\n            this._context.shadowBlur = prevShadowSettings[3];\n        }\n\n        // Reset cut translation\n        if (renderInfo.cutSx || renderInfo.cutSy) {\n            this._context.translate(renderInfo.cutSx, renderInfo.cutSy);\n        }\n\n        // Postprocess renderInfo.lines to be compatible with standard version\n        renderInfo.lines = renderInfo.lines.map((l) => l.text.reduce((acc, v) => acc + v.text, ''));\n        if (renderInfo.maxLines) {\n            renderInfo.lines = renderInfo.lines.slice(0, renderInfo.maxLines);\n        }\n\n\n        this.renderInfo = renderInfo;\n\n    };\n\n    /**\n     * See {@link measureText}\n     *\n     * @param {string} word\n     * @param {number} space\n     * @returns {number}\n     */\n    measureText(word, space = 0) {\n        return measureText(this._context, word, space);\n    }\n\n    tokenize(text) {\n        return tokenizeString(/ |\\u200B|\\n|<i>|<\\/i>|<b>|<\\/b>|<color=0[xX][0-9a-fA-F]{8}>|<\\/color>/g, text);\n    }\n\n    parse(tokens) {\n        let italic = 0;\n        let bold = 0;\n        let colorStack = [StageUtils.getRgbaString(this._settings.textColor)];\n        let color = 0;\n\n        const colorRegexp = /<color=(0[xX][0-9a-fA-F]{8})>/;\n\n        return tokens.map((t) => {\n            if (t == '<i>') {\n                italic += 1;\n                t = '';\n            } else if (t == '</i>' && italic > 0) {\n                italic -= 1;\n                t = '';\n            } else if (t == '<b>') {\n                bold += 1;\n                t = '';\n            } else if (t == '</b>' && bold > 0) {\n                bold -= 1;\n                t = '';\n            } else if (t == '</color>') {\n                if (colorStack.length > 1) {\n                    color -= 1;\n                    colorStack.pop();\n                }\n                t = '';\n            } else if (colorRegexp.test(t)) {\n                const matched = colorRegexp.exec(t);\n                colorStack.push(\n                    StageUtils.getRgbaString(parseInt(matched[1]))\n                );\n                color += 1;\n                t = '';\n\n            }\n\n            return {\n                text: t,\n                italic: italic,\n                bold: bold,\n                color: colorStack[color],\n            }\n        })\n        .filter((o) => o.text != '');\n    }\n\n    applyFontStyle(word, baseFont) {\n        let font = baseFont;\n        if (word.bold) {\n            font = 'bold ' + font;\n        }\n        if (word.italic) {\n            font = 'italic ' + font;\n        }\n        this._context.font = font\n        word.fontStyle = font;\n    }\n\n    resetFontStyle(baseFont) {\n        this._context.font = baseFont;\n    }\n\n    measure(parsed, letterSpacing = 0, baseFont) {\n        for (const p of parsed) {\n            this.applyFontStyle(p, baseFont);\n            p.width = this.measureText(p.text, letterSpacing);\n\n            // Letter by letter detail for letter spacing\n            if (letterSpacing > 0) {\n                p.letters = p.text.split('').map((l) => {return {text: l}});\n                for (let l of p.letters) {\n                    l.width = this.measureText(l.text, letterSpacing);\n                }\n            }\n\n        }\n        this.resetFontStyle(baseFont);\n        return parsed;\n    }\n\n    indent(parsed, textIndent) {\n        parsed.splice(0, 0, {text: \"\", width: textIndent});\n        return parsed;\n    }\n\n    wrapWord(word, wordWrapWidth, suffix) {\n        const suffixWidth = this.measureText(suffix);\n        const wordLen = word.length\n        const wordWidth = this.measureText(word);\n\n        /* If word fits wrapWidth, do nothing */\n        if (wordWidth <= wordWrapWidth) {\n            return word;\n        }\n\n        /* Make initial guess for text cuttoff */\n        let cutoffIndex = Math.floor((wordWrapWidth * wordLen) / wordWidth);\n        let truncWordWidth = this.measureText(word.substring(0, cutoffIndex)) + suffixWidth;\n\n        /* In case guess was overestimated, shrink it letter by letter. */\n        if (truncWordWidth > wordWrapWidth) {\n            while (cutoffIndex > 0) {\n                truncWordWidth = this.measureText(word.substring(0, cutoffIndex)) + suffixWidth;\n                if (truncWordWidth > wordWrapWidth) {\n                    cutoffIndex -= 1;\n                } else {\n                    break;\n                }\n            }\n\n        /* In case guess was underestimated, extend it letter by letter. */\n        } else {\n            while (cutoffIndex < wordLen) {\n                truncWordWidth = this.measureText(word.substring(0, cutoffIndex)) + suffixWidth;\n                if (truncWordWidth < wordWrapWidth) {\n                    cutoffIndex += 1;\n                } else {\n                    // Finally, when bound is crossed, retract last letter.\n                    cutoffIndex -=1;\n                    break;\n                }\n            }\n        }\n\n        /* If wrapWidth is too short to even contain suffix alone, return empty string */\n        return word.substring(0, cutoffIndex) + (wordWrapWidth >= suffixWidth ? suffix : '')\n    }\n\n    _getBreakIndex(word, width) {\n        const wordLen = word.length;\n        const wordWidth = this.measureText(word);\n\n        if (wordWidth <= width) {\n            return {breakIndex: word.length, truncWordWidth: wordWidth};\n        }\n\n        let breakIndex = Math.floor((width * wordLen) / wordWidth);\n        let truncWordWidth = this.measureText(word.substring(0, breakIndex))\n\n        /* In case guess was overestimated, shrink it letter by letter. */\n        if (truncWordWidth > width) {\n            while (breakIndex > 0) {\n                truncWordWidth = this.measureText(word.substring(0, breakIndex));\n                if (truncWordWidth > width) {\n                    breakIndex -= 1;\n                } else {\n                    break;\n                }\n            }\n\n        /* In case guess was underestimated, extend it letter by letter. */\n        } else {\n            while (breakIndex < wordLen) {\n                truncWordWidth = this.measureText(word.substring(0, breakIndex));\n                if (truncWordWidth < width) {\n                    breakIndex += 1;\n                } else {\n                    // Finally, when bound is crossed, retract last letter.\n                    breakIndex -=1;\n                    truncWordWidth = this.measureText(word.substring(0, breakIndex));\n                    break;\n                }\n            }\n        }\n        return {breakIndex, truncWordWidth};\n\n    }\n\n    wordBreak(word, width, baseFont) {\n        if (!word.text) {\n            return word\n        }\n        this.applyFontStyle(word, baseFont)\n        const parts = [];\n        let text = word.text;\n        if (!word.letters) {\n            while (true) {\n                const {breakIndex, truncWordWidth} = this._getBreakIndex(text, width);\n                parts.push({...word});\n                parts[parts.length - 1].text = text.slice(0, breakIndex);\n                parts[parts.length - 1].width = truncWordWidth;\n\n                if (breakIndex === text.length) {\n                    break;\n                }\n\n                text = text.slice(breakIndex);\n            }\n        } else {\n            let totalWidth = 0;\n            let letters = [];\n            let breakIndex = 0;\n            for (const l of word.letters) {\n                if (totalWidth + l.width >= width) {\n                    parts.push({...word});\n                    parts[parts.length - 1].text = text.slice(0, breakIndex);\n                    parts[parts.length - 1].width = totalWidth;\n                    parts[parts.length - 1].letters = letters;\n                    text = text.slice(breakIndex);\n                    totalWidth = 0;\n                    letters = [];\n                    breakIndex = 0;\n\n                } else {\n                    breakIndex += 1;\n                    letters.push(l);\n                    totalWidth += l.width;\n                }\n            }\n\n            if (totalWidth > 0) {\n                parts.push({...word});\n                parts[parts.length - 1].text = text.slice(0, breakIndex);\n                parts[parts.length - 1].width = totalWidth;\n                parts[parts.length - 1].letters = letters;\n            }\n        }\n\n        return parts;\n    }\n\n    alignLine(parsed, initialX = 0) {\n        let prevWidth = 0;\n        let prevX = initialX;\n        for (const word of parsed) {\n            if (word.text == '\\n') {\n                continue;\n            }\n            word.x = prevX + prevWidth;\n            prevX = word.x;\n            prevWidth = word.width;\n        }\n\n    }\n}","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Texture from \"../tree/Texture.mjs\";\nimport Utils from \"../tree/Utils.mjs\";\n\nexport default class TextTexture extends Texture {\n\n    constructor(stage) {\n        super(stage);\n\n        // We use the stage precision as the default precision in case of a text texture.\n        this._precision = this.stage.getOption('precision');\n    }\n\n    static renderer(stage, canvas, settings) {\n        if (this.advancedRenderer) {\n            return new TextTextureRendererAdvanced(stage, canvas, settings);\n        } else {\n            return new TextTextureRenderer(stage, canvas, settings);\n        }\n    }\n\n    get text() {\n        return this._text;\n    }\n\n    set text(v) {\n        if (this._text !== v) {\n            this._text = \"\" + v;\n            this._changed();\n        }\n    }\n\n    get w() {\n        return this._w;\n    }\n\n    set w(v) {\n        if (this._w !== v) {\n            this._w = v;\n            this._changed();\n        }\n    }\n\n    get h() {\n        return this._h;\n    }\n\n    set h(v) {\n        if (this._h !== v) {\n            this._h = v;\n            this._changed();\n        }\n    }\n\n    get fontStyle() {\n        return this._fontStyle;\n    }\n\n    set fontStyle(v) {\n        if (this._fontStyle !== v) {\n            this._fontStyle = v;\n            this._changed();\n        }\n    }\n\n    get fontBaselineRatio() {\n        return this._fontBaselineRatio;\n    }\n    \n    set fontBaselineRatio(v) {\n        if (this._fontBaselineRatio !== v) {\n            this._fontBaselineRatio = v;\n            this._changed();\n        }\n    }\n\n    get fontSize() {\n        return this._fontSize;\n    }\n\n    set fontSize(v) {\n        if (this._fontSize !== v) {\n            this._fontSize = v;\n            this._changed();\n        }\n    }\n\n    get fontFace() {\n        return this._fontFace;\n    }\n\n    set fontFace(v) {\n        if (this._fontFace !== v) {\n            this._fontFace = v;\n            this._changed();\n        }\n    }\n\n    get wordWrap() {\n        return this._wordWrap;\n    }\n\n    set wordWrap(v) {\n        if (this._wordWrap !== v) {\n            this._wordWrap = v;\n            this._changed();\n        }\n    }\n\n    get wordWrapWidth() {\n        return this._wordWrapWidth;\n    }\n\n    set wordWrapWidth(v) {\n        if (this._wordWrapWidth !== v) {\n            this._wordWrapWidth = v;\n            this._changed();\n        }\n    }\n\n    get wordBreak() {\n        return this._wordBreak;\n    }\n\n    set wordBreak(v) {\n        if (this._wordBreak !== v) {\n            this._wordBreak = v;\n            this._changed();\n        }\n    }\n\n    get textOverflow() {\n        return this._textOverflow;\n    }\n\n    set textOverflow(v) {\n        if (v != this._textOverflow) {\n            this._textOverflow = v;\n            this._changed();\n        }\n    }\n\n    get lineHeight() {\n        return this._lineHeight;\n    }\n\n    set lineHeight(v) {\n        if (this._lineHeight !== v) {\n            this._lineHeight = v;\n            this._changed();\n        }\n    }\n\n    get textBaseline() {\n        return this._textBaseline;\n    }\n\n    set textBaseline(v) {\n        if (this._textBaseline !== v) {\n            this._textBaseline = v;\n            this._changed();\n        }\n    }\n\n    get textAlign() {\n        return this._textAlign;\n    }\n\n    set textAlign(v) {\n        if (this._textAlign !== v) {\n            this._textAlign = v;\n            this._changed();\n        }\n    }\n\n    get verticalAlign() {\n        return this._verticalAlign;\n    }\n\n    set verticalAlign(v) {\n        if (this._verticalAlign !== v) {\n            this._verticalAlign = v;\n            this._changed();\n        }\n    }\n\n    get offsetY() {\n        return this._offsetY;\n    }\n\n    set offsetY(v) {\n        if (this._offsetY !== v) {\n            this._offsetY = v;\n            this._changed();\n        }\n    }\n\n    get maxLines() {\n        return this._maxLines;\n    }\n\n    set maxLines(v) {\n        if (this._maxLines !== v) {\n            this._maxLines = v;\n            this._changed();\n        }\n    }\n\n    get maxLinesSuffix() {\n        return this._maxLinesSuffix;\n    }\n\n    set maxLinesSuffix(v) {\n        if (this._maxLinesSuffix !== v) {\n            this._maxLinesSuffix = v;\n            this._changed();\n        }\n    }\n\n    get textColor() {\n        return this._textColor;\n    }\n\n    set textColor(v) {\n        if (this._textColor !== v) {\n            this._textColor = v;\n            this._changed();\n        }\n    }\n\n    get paddingLeft() {\n        return this._paddingLeft;\n    }\n\n    set paddingLeft(v) {\n        if (this._paddingLeft !== v) {\n            this._paddingLeft = v;\n            this._changed();\n        }\n    }\n\n    get paddingRight() {\n        return this._paddingRight;\n    }\n\n    set paddingRight(v) {\n        if (this._paddingRight !== v) {\n            this._paddingRight = v;\n            this._changed();\n        }\n    }\n\n    get shadow() {\n        return this._shadow;\n    }\n\n    set shadow(v) {\n        if (this._shadow !== v) {\n            this._shadow = v;\n            this._changed();\n        }\n    }\n\n    get shadowColor() {\n        return this._shadowColor;\n    }\n\n    set shadowColor(v) {\n        if (this._shadowColor !== v) {\n            this._shadowColor = v;\n            this._changed();\n        }\n    }\n\n    get shadowOffsetX() {\n        return this._shadowOffsetX;\n    }\n\n    set shadowOffsetX(v) {\n        if (this._shadowOffsetX !== v) {\n            this._shadowOffsetX = v;\n            this._changed();\n        }\n    }\n\n    get shadowOffsetY() {\n        return this._shadowOffsetY;\n    }\n\n    set shadowOffsetY(v) {\n        if (this._shadowOffsetY !== v) {\n            this._shadowOffsetY = v;\n            this._changed();\n        }\n    }\n\n    get shadowBlur() {\n        return this._shadowBlur;\n    }\n\n    set shadowBlur(v) {\n        if (this._shadowBlur !== v) {\n            this._shadowBlur = v;\n            this._changed();\n        }\n    }\n\n    get highlight() {\n        return this._highlight;\n    }\n\n    set highlight(v) {\n        if (this._highlight !== v) {\n            this._highlight = v;\n            this._changed();\n        }\n    }\n\n    get highlightHeight() {\n        return this._highlightHeight;\n    }\n\n    set highlightHeight(v) {\n        if (this._highlightHeight !== v) {\n            this._highlightHeight = v;\n            this._changed();\n        }\n    }\n\n    get highlightColor() {\n        return this._highlightColor;\n    }\n\n    set highlightColor(v) {\n        if (this._highlightColor !== v) {\n            this._highlightColor = v;\n            this._changed();\n        }\n    }\n\n    get highlightOffset() {\n        return this._highlightOffset;\n    }\n\n    set highlightOffset(v) {\n        if (this._highlightOffset !== v) {\n            this._highlightOffset = v;\n            this._changed();\n        }\n    }\n\n    get highlightPaddingLeft() {\n        return this._highlightPaddingLeft;\n    }\n\n    set highlightPaddingLeft(v) {\n        if (this._highlightPaddingLeft !== v) {\n            this._highlightPaddingLeft = v;\n            this._changed();\n        }\n    }\n\n    get highlightPaddingRight() {\n        return this._highlightPaddingRight;\n    }\n\n    set highlightPaddingRight(v) {\n        if (this._highlightPaddingRight !== v) {\n            this._highlightPaddingRight = v;\n            this._changed();\n        }\n    }\n\n    get cutSx() {\n        return this._cutSx;\n    }\n\n    set cutSx(v) {\n        if (this._cutSx !== v) {\n            this._cutSx = v;\n            this._changed();\n        }\n    }\n\n    get cutEx() {\n        return this._cutEx;\n    }\n\n    set cutEx(v) {\n        if (this._cutEx !== v) {\n            this._cutEx = v;\n            this._changed();\n        }\n    }\n\n    get cutSy() {\n        return this._cutSy;\n    }\n\n    set cutSy(v) {\n        if (this._cutSy !== v) {\n            this._cutSy = v;\n            this._changed();\n        }\n    }\n\n    get cutEy() {\n        return this._cutEy;\n    }\n\n    set cutEy(v) {\n        if (this._cutEy !== v) {\n            this._cutEy = v;\n            this._changed();\n        }\n    }\n\n    get advancedRenderer() {\n        return this._advancedRenderer;\n    }\n\n    set advancedRenderer(v) {\n        if (this._advancedRenderer !== v) {\n            this._advancedRenderer = v;\n            this._changed();\n        }\n    }\n\n    set letterSpacing(v) {\n        if (this._letterSpacing !== v) {\n            this._letterSpacing = v;\n            this._changed();\n        }\n    }\n\n    get letterSpacing() {\n        return this._letterSpacing;\n    }\n\n    set textIndent(v) {\n        if (this._textIndent !== v) {\n            this._textIndent = v;\n            this._changed();\n        }\n    }\n\n    get textIndent() {\n        return this._textIndent;\n    }\n\n    get precision() {\n        return super.precision;\n    }\n\n    set precision(v) {\n        // We actually draw differently when the precision changes.\n        if (this.precision !== v) {\n            super.precision = v;\n            this._changed();\n        }\n    }\n\n    _getIsValid() {\n        return !!this.text;\n    }\n\n    _getLookupId() {\n        let parts = [];\n\n        if (this.w !== 0) parts.push(\"w \" + this.w);\n        if (this.h !== 0) parts.push(\"h \" + this.h);\n        if (this.fontStyle !== \"normal\") parts.push(\"fS\" + this.fontStyle);\n        if (this.fontSize !== 40) parts.push(\"fs\" + this.fontSize);\n        if (this.fontBaselineRatio !== 0) parts.push('fb' + this.fontBaselineRatio);\n        if (this.fontFace !== null) parts.push(\"ff\" + (Array.isArray(this.fontFace) ? this.fontFace.join(\",\") : this.fontFace));\n        if (this.wordWrap !== true) parts.push(\"wr\" + (this.wordWrap ? 1 : 0));\n        if (this.wordWrapWidth !== 0) parts.push(\"ww\" + this.wordWrapWidth);\n        if (this.wordBreak !== false) parts.push(\"wb\" + this.wordBreak ? 1 : 0);\n        if (this.textOverflow != \"\") parts.push(\"to\" + this.textOverflow);\n        if (this.lineHeight !== null) parts.push(\"lh\" + this.lineHeight);\n        if (this.textBaseline !== \"alphabetic\") parts.push(\"tb\" + this.textBaseline);\n        if (this.textAlign !== \"left\") parts.push(\"ta\" + this.textAlign);\n        if (this.verticalAlign !== \"top\") parts.push(\"va\" + this.verticalAlign);\n        if (this.offsetY !== null) parts.push(\"oy\" + this.offsetY);\n        if (this.maxLines !== 0) parts.push(\"ml\" + this.maxLines);\n        if (this.maxLinesSuffix !== \"..\") parts.push(\"ms\" + this.maxLinesSuffix);\n        parts.push(\"pc\" + this.precision);\n        if (this.textColor !== 0xffffffff) parts.push(\"co\" + this.textColor.toString(16));\n        if (this.paddingLeft !== 0) parts.push(\"pl\" + this.paddingLeft);\n        if (this.paddingRight !== 0) parts.push(\"pr\" + this.paddingRight);\n        if (this.shadow !== false) parts.push(\"sh\" + (this.shadow ? 1 : 0));\n        if (this.shadowColor !== 0xff000000) parts.push(\"sc\" + this.shadowColor.toString(16));\n        if (this.shadowOffsetX !== 0) parts.push(\"sx\" + this.shadowOffsetX);\n        if (this.shadowOffsetY !== 0) parts.push(\"sy\" + this.shadowOffsetY);\n        if (this.shadowBlur !== 5) parts.push(\"sb\" + this.shadowBlur);\n        if (this.highlight !== false) parts.push(\"hL\" + (this.highlight ? 1 : 0));\n        if (this.highlightHeight !== 0) parts.push(\"hh\" + this.highlightHeight);\n        if (this.highlightColor !== 0xff000000) parts.push(\"hc\" + this.highlightColor.toString(16));\n        if (this.highlightOffset !== null) parts.push(\"ho\" + this.highlightOffset);\n        if (this.highlightPaddingLeft !== null) parts.push(\"hl\" + this.highlightPaddingLeft);\n        if (this.highlightPaddingRight !== null) parts.push(\"hr\" + this.highlightPaddingRight);\n        if (this.letterSpacing !== null) parts.push(\"ls\" + this.letterSpacing);\n        if (this.textIndent !== null) parts.push(\"ti\" + this.textIndent);\n\n        if (this.cutSx) parts.push(\"csx\" + this.cutSx);\n        if (this.cutEx) parts.push(\"cex\" + this.cutEx);\n        if (this.cutSy) parts.push(\"csy\" + this.cutSy);\n        if (this.cutEy) parts.push(\"cey\" + this.cutEy);\n\n        if (this.advancedRenderer) parts.push(\"aR\" + this.advancedRenderer ? 1 : 0);\n\n        let id = \"TX$\" + parts.join(\"|\") + \":\" + this.text;\n        return id;\n    }\n\n    _getSourceLoader() {\n        const args = this.cloneArgs();\n\n        const gl = this.stage.gl;\n\n        return function (cb) {\n            const canvas = this.stage.platform.getDrawingCanvas();\n            const renderer = (args.advancedRenderer)\n              ? new TextTextureRendererAdvanced(this.stage, canvas, args)\n              : new TextTextureRenderer(this.stage, canvas, args);\n            \n            const p = renderer.draw();\n\n            const texParams = {};\n\n            const sharpCfg = this.stage.getOption('fontSharp');\n            let sharpen = false;\n\n            // Prevent text blur when text texture is downscaled\n            if (Utils.isBoolean(sharpCfg)) {\n                sharpen = sharpCfg;\n            } else if (Utils.isObject(sharpCfg)) {\n                const precision = this.stage.getRenderPrecision();\n                sharpen = precision <= sharpCfg.precision && args.fontSize <= sharpCfg.fontSize;\n            }\n\n            if (gl && sharpen) {\n                texParams[gl.TEXTURE_MAG_FILTER] = gl.NEAREST;\n            }\n\n            if (p) {\n                p.then(() => {\n                    /* FIXME: on some platforms (e.g. RPI), throttling text textures cause artifacts */\n                    cb(null, Object.assign({\n                        renderInfo: renderer.renderInfo,\n                        throttle: false,\n                        texParams: texParams,\n                    }, this.stage.platform.getTextureOptionsForDrawingCanvas(canvas)));\n                }).catch((err) => {\n                    cb(err);\n                });\n            } else {\n                cb(null, Object.assign({\n                    renderInfo: renderer.renderInfo,\n                    throttle: false,\n                    texParams: texParams,\n                }, this.stage.platform.getTextureOptionsForDrawingCanvas(canvas)));\n            }\n        };\n    }\n\n\n    getNonDefaults() {\n        const nonDefaults = super.getNonDefaults();\n        if (this.text !== \"\") nonDefaults['text'] = this.text;\n        if (this.w !== 0) nonDefaults['w'] = this.w;\n        if (this.h !== 0) nonDefaults['h'] = this.h;\n        if (this.fontStyle !== \"normal\") nonDefaults['fontStyle'] = this.fontStyle;\n        if (this.fontSize !== 40) nonDefaults[\"fontSize\"] = this.fontSize;\n        if (this.fontBaselineRatio !== 0) nonDefaults['fontBaselineRatio'] = this.fontBaselineRatio;\n        if (this.fontFace !== null) nonDefaults[\"fontFace\"] = this.fontFace;\n        if (this.wordWrap !== true) nonDefaults[\"wordWrap\"] = this.wordWrap;\n        if (this.wordWrapWidth !== 0) nonDefaults[\"wordWrapWidth\"] = this.wordWrapWidth;\n        if (this.wordBreak !== false) nonDefaults[\"wordBreak\"] = this.wordBreak;\n        if (this.textOverflow != \"\") nonDefaults[\"textOverflow\"] = this.textOverflow;\n        if (this.lineHeight !== null) nonDefaults[\"lineHeight\"] = this.lineHeight;\n        if (this.textBaseline !== \"alphabetic\") nonDefaults[\"textBaseline\"] = this.textBaseline;\n        if (this.textAlign !== \"left\") nonDefaults[\"textAlign\"] = this.textAlign;\n        if (this.verticalAlign !== \"top\") nonDefaults[\"verticalAlign\"] = this.verticalAlign;\n        if (this.offsetY !== null) nonDefaults[\"offsetY\"] = this.offsetY;\n        if (this.maxLines !== 0) nonDefaults[\"maxLines\"] = this.maxLines;\n        if (this.maxLinesSuffix !== \"..\") nonDefaults[\"maxLinesSuffix\"] = this.maxLinesSuffix;\n        if (this.precision !== this.stage.getOption('precision')) nonDefaults[\"precision\"] = this.precision;\n        if (this.textColor !== 0xffffffff) nonDefaults[\"textColor\"] = this.textColor;\n        if (this.paddingLeft !== 0) nonDefaults[\"paddingLeft\"] = this.paddingLeft;\n        if (this.paddingRight !== 0) nonDefaults[\"paddingRight\"] = this.paddingRight;\n        if (this.shadow !== false) nonDefaults[\"shadow\"] = this.shadow;\n        if (this.shadowColor !== 0xff000000) nonDefaults[\"shadowColor\"] = this.shadowColor;\n        if (this.shadowOffsetX !== 0) nonDefaults[\"shadowOffsetX\"] = this.shadowOffsetX;\n        if (this.shadowOffsetY !== 0) nonDefaults[\"shadowOffsetY\"] = this.shadowOffsetY;\n        if (this.shadowBlur !== 5) nonDefaults[\"shadowBlur\"] = this.shadowBlur;\n        if (this.highlight !== false) nonDefaults[\"highlight\"] = this.highlight;\n        if (this.highlightHeight !== 0) nonDefaults[\"highlightHeight\"] = this.highlightHeight;\n        if (this.highlightColor !== 0xff000000) nonDefaults[\"highlightColor\"] = this.highlightColor;\n        if (this.highlightOffset !== 0) nonDefaults[\"highlightOffset\"] = this.highlightOffset;\n        if (this.highlightPaddingLeft !== 0) nonDefaults[\"highlightPaddingLeft\"] = this.highlightPaddingLeft;\n        if (this.highlightPaddingRight !== 0) nonDefaults[\"highlightPaddingRight\"] = this.highlightPaddingRight;\n        if (this.letterSpacing !== 0) nonDefaults[\"letterSpacing\"] = this.letterSpacing;\n        if (this.textIndent !== 0) nonDefaults[\"textIndent\"] = this.textIndent;\n\n        if (this.cutSx) nonDefaults[\"cutSx\"] = this.cutSx;\n        if (this.cutEx) nonDefaults[\"cutEx\"] = this.cutEx;\n        if (this.cutSy) nonDefaults[\"cutSy\"] = this.cutSy;\n        if (this.cutEy) nonDefaults[\"cutEy\"] = this.cutEy;\n\n        if (this.advancedRenderer) nonDefaults[\"renderer\"] = this.advancedRenderer;\n        return nonDefaults;\n    }\n\n    cloneArgs() {\n        let obj = {};\n        obj.text = this._text;\n        obj.w = this._w;\n        obj.h = this._h;\n        obj.fontStyle = this._fontStyle;\n        obj.fontSize = this._fontSize;\n        obj.fontBaselineRatio = this._fontBaselineRatio;\n        obj.fontFace = this._fontFace;\n        obj.wordWrap = this._wordWrap;\n        obj.wordWrapWidth = this._wordWrapWidth;\n        obj.wordBreak = this._wordBreak;\n        obj.textOverflow = this._textOverflow;\n        obj.lineHeight = this._lineHeight;\n        obj.textBaseline = this._textBaseline;\n        obj.textAlign = this._textAlign;\n        obj.verticalAlign = this._verticalAlign;\n        obj.offsetY = this._offsetY;\n        obj.maxLines = this._maxLines;\n        obj.maxLinesSuffix = this._maxLinesSuffix;\n        obj.precision = this._precision;\n        obj.textColor = this._textColor;\n        obj.paddingLeft = this._paddingLeft;\n        obj.paddingRight = this._paddingRight;\n        obj.shadow = this._shadow;\n        obj.shadowColor = this._shadowColor;\n        obj.shadowOffsetX = this._shadowOffsetX;\n        obj.shadowOffsetY = this._shadowOffsetY;\n        obj.shadowBlur = this._shadowBlur;\n        obj.highlight = this._highlight;\n        obj.highlightHeight = this._highlightHeight;\n        obj.highlightColor = this._highlightColor;\n        obj.highlightOffset = this._highlightOffset;\n        obj.highlightPaddingLeft = this._highlightPaddingLeft;\n        obj.highlightPaddingRight = this._highlightPaddingRight;\n        obj.letterSpacing = this._letterSpacing;\n        obj.textIndent = this._textIndent;\n        obj.cutSx = this._cutSx;\n        obj.cutEx = this._cutEx;\n        obj.cutSy = this._cutSy;\n        obj.cutEy = this._cutEy;\n        obj.advancedRenderer = this._advancedRenderer;\n        return obj;\n    }\n\n\n}\n\n// Because there are so many properties, we prefer to use the prototype for default values.\n// This causes a decrease in performance, but also a decrease in memory usage.\nlet proto = TextTexture.prototype;\nproto._text = \"\";\nproto._w = 0;\nproto._h = 0;\nproto._fontStyle = \"normal\";\nproto._fontSize = 40;\nproto._fontFace = null;\nproto._wordWrap = true;\nproto._wordWrapWidth = 0;\nproto._wordBreak = false;\nproto._textOverflow = \"\";\nproto._lineHeight = null;\nproto._textBaseline = \"alphabetic\";\nproto._textAlign = \"left\";\nproto._verticalAlign = \"top\";\nproto._offsetY = null;\nproto._maxLines = 0;\nproto._maxLinesSuffix = \"..\";\nproto._textColor = 0xFFFFFFFF;\nproto._paddingLeft = 0;\nproto._paddingRight = 0;\nproto._shadow = false;\nproto._shadowColor = 0xFF000000;\nproto._shadowOffsetX = 0;\nproto._shadowOffsetY = 0;\nproto._shadowBlur = 5;\nproto._highlight = false;\nproto._highlightHeight = 0;\nproto._highlightColor = 0xFF000000;\nproto._highlightOffset = 0;\nproto._highlightPaddingLeft = 0;\nproto._highlightPaddingRight = 0;\nproto._letterSpacing = 0;\nproto._textIndent = 0;\nproto._cutSx = 0;\nproto._cutEx = 0;\nproto._cutSy = 0;\nproto._cutEy = 0;\nproto._advancedRenderer = false;\nproto._fontBaselineRatio = 0;\n\n\nimport TextTextureRenderer from \"./TextTextureRenderer.mjs\";\nimport TextTextureRendererAdvanced from \"./TextTextureRendererAdvanced.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Texture from \"../tree/Texture.mjs\";\n\nexport default class SourceTexture extends Texture {\n\n    constructor(stage) {\n        super(stage);\n\n        this._textureSource = undefined;\n    }\n\n    get textureSource() {\n        return this._textureSource;\n    }\n\n    set textureSource(v) {\n        if (v !== this._textureSource) {\n            if (v.isResultTexture) {\n                // In case of a result texture, automatically inherit the precision.\n                this._precision = this.stage.getRenderPrecision();\n            }\n            this._textureSource = v;\n            this._changed();\n        }\n    }\n\n    _getTextureSource() {\n        return this._textureSource;\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport EventEmitter from \"../EventEmitter.mjs\";\n\nexport default class Transition extends EventEmitter {\n\n    constructor(manager, settings, element, property) {\n        super();\n\n        this.manager = manager;\n\n        this._settings = settings;\n\n        this._element = element;\n\n        this._getter = element.constructor.getGetter(property);\n        this._setter = element.constructor.getSetter(property);\n\n        this._merger = settings.merger;\n\n        if (!this._merger) {\n            this._merger = element.constructor.getMerger(property);\n        }\n\n        this._startValue = this._getter(this._element);\n        this._targetValue = this._startValue;\n\n        this._p = 1;\n        this._delayLeft = 0;\n    }\n\n    start(targetValue) {\n        this._startValue = this._getter(this._element);\n\n        if (!this.isAttached()) {\n            // We don't support transitions on non-attached elements. Just set value without invoking listeners.\n            this._targetValue = targetValue;\n            this._p = 1;\n            this._updateDrawValue();\n        } else {\n            if (targetValue === this._startValue) {\n                this.reset(targetValue, 1);\n            } else {\n                this._targetValue = targetValue;\n                this._p = 0;\n                this._delayLeft = this._settings.delay;\n                this.emit('start');\n                this.add();\n            }\n        }\n    }\n\n    finish() {\n        if (this._p < 1) {\n            // Value setting and will must be invoked (async) upon next transition cycle.\n            this._p = 1;\n        }\n    }\n\n    stop() {\n        // Just stop where the transition is at.\n        this.emit('stop');\n        this.manager.removeActive(this);\n    }\n\n    pause() {\n        this.stop();\n    }\n\n    play() {\n        this.manager.addActive(this);\n    }\n\n    reset(targetValue, p) {\n        if (!this.isAttached()) {\n            // We don't support transitions on non-attached elements. Just set value without invoking listeners.\n            this._startValue = this._getter(this._element);\n            this._targetValue = targetValue;\n            this._p = 1;\n            this._updateDrawValue();\n        } else {\n            this._startValue = this._getter(this._element);\n            this._targetValue = targetValue;\n            this._p = p;\n            this.add();\n        }\n    }\n\n    _updateDrawValue() {\n        this._setter(this._element, this.getDrawValue());\n    }\n\n    add() {\n        this.manager.addActive(this);\n    }\n\n    isAttached() {\n        return this._element.attached;\n    }\n\n    isRunning() {\n        return (this._p < 1.0);\n    }\n\n    progress(dt) {\n        if (!this.isAttached()) {\n            // Skip to end of transition so that it is removed.\n            this._p = 1;\n        }\n\n        if (this.p < 1) {\n            if (this.delayLeft > 0) {\n                this._delayLeft -= dt;\n\n                if (this.delayLeft < 0) {\n                    dt = -this.delayLeft;\n                    this._delayLeft = 0;\n\n                    this.emit('delayEnd');\n                } else {\n                    return;\n                }\n            }\n\n            if (this._settings.duration == 0) {\n                this._p = 1;\n            } else {\n                this._p += dt / this._settings.duration;\n            }\n            if (this._p >= 1) {\n                // Finished!;\n                this._p = 1;\n            }\n        }\n\n        this._updateDrawValue();\n\n        this.invokeListeners();\n    }\n\n    invokeListeners() {\n        this.emit('progress', this.p);\n        if (this.p === 1) {\n            this.emit('finish');\n        }\n    }\n\n    updateTargetValue(targetValue) {\n        let t = this._settings.timingFunctionImpl(this.p);\n        if (t === 1) {\n            this._targetValue = targetValue;\n        } else if (t === 0) {\n            this._startValue = this._targetValue;\n            this._targetValue = targetValue;\n        } else {\n            this._startValue = targetValue - ((targetValue - this._targetValue) / (1 - t));\n            this._targetValue = targetValue;\n        }\n    }\n\n    getDrawValue() {\n        if (this.p >= 1) {\n            return this.targetValue;\n        } else {\n            let v = this._settings._timingFunctionImpl(this.p);\n            return this._merger(this.targetValue, this.startValue, v);\n        }\n    }\n\n    skipDelay() {\n        this._delayLeft = 0;\n    }\n\n    get startValue() {\n        return this._startValue;\n    }\n\n    get targetValue() {\n        return this._targetValue;\n    }\n\n    get p() {\n        return this._p;\n    }\n\n    get delayLeft() {\n        return this._delayLeft;\n    }\n\n    get element() {\n        return this._element;\n    }\n\n    get settings() {\n        return this._settings;\n    }\n\n    set settings(v) {\n        this._settings = v;\n    }\n\n}\n\nTransition.prototype.isTransition = true;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Manages a list of objects.\n * Objects may be patched. Then, they can be referenced using the 'ref' (string) property.\n */\nexport default class ObjectList {\n\n    constructor() {\n        this._items = [];\n        this._refs = {}\n    }\n\n    get() {\n        return this._items;\n    }\n\n    get first() {\n        return this._items[0];\n    }\n\n    get last() {\n        return this._items.length ? this._items[this._items.length - 1] : undefined;\n    }\n\n    add(item) {\n        this.addAt(item, this._items.length);\n    }\n\n    addAt(item, index) {\n        if (index >= 0 && index <= this._items.length) {\n            let currentIndex = this._items.indexOf(item);\n            if (currentIndex === index) {\n                return item;\n            }\n\n            if (Utils.isObjectLiteral(item)) {\n                const o = item;\n                item = this.createItem(o);\n                item.patch(o);\n            }\n\n            if (currentIndex != -1) {\n                this.setAt(item, index);\n            } else {\n                if (item.ref) {\n                    this._refs[item.ref] = item;\n                }\n                this._items.splice(index, 0, item);\n                this.onAdd(item, index);\n            }\n        } else {\n            throw new Error('addAt: The index ' + index + ' is out of bounds ' + this._items.length);\n        }\n    }\n\n    replaceByRef(item) {\n        if (item.ref) {\n            const existingItem = this.getByRef(item.ref);\n            if (!existingItem) {\n                throw new Error('replaceByRef: no item found with reference: ' + item.ref);\n            }\n            this.replace(item, existingItem);\n        } else {\n            throw new Error('replaceByRef: no ref specified in item');\n        }\n        this.addAt(item, this._items.length);\n\n    }\n\n    replace(item, prevItem) {\n        const index = this.getIndex(prevItem);\n        if (index === -1) {\n            throw new Error('replace: The previous item does not exist');\n        }\n        this.setAt(item, index);\n    }\n\n    setAt(item, index) {\n        if (index >= 0 && index <= this._items.length) {\n\n            if (Utils.isObjectLiteral(item)) {\n                const o = item;\n                item = this.createItem(o);\n                item.patch(o);\n            }\n\n            let currentIndex = this._items.indexOf(item);\n            if (currentIndex != -1) {\n                if (currentIndex !== index) {\n                    const fromIndex = currentIndex;\n                    if (fromIndex !== index) {\n                        this._items.splice(fromIndex, 1);\n                        this._items.splice(index, 0, item);\n                        this.onMove(item, fromIndex, index);\n                    }\n                }\n            } else {\n                if( index < this._items.length){\n\n                    if (this._items[index].ref) {\n                        this._refs[this._items[index].ref] = undefined;\n                    }\n\n                    const prevItem = this._items[index];\n\n                    // Doesn't exist yet: overwrite current.\n                    this._items[index] = item;\n\n                    if (item.ref) {\n                        this._refs[item.ref] = item;\n                    }\n\n                    this.onSet(item, index, prevItem);\n                } else {\n                    throw new Error('setAt: The index ' + index + ' is out of bounds ' + this._items.length);\n                }\n            }\n        } else {\n            throw new Error('setAt: The index ' + index + ' is out of bounds ' + this._items.length);\n        }\n    }\n\n    getAt(index) {\n        return this._items[index];\n    }\n\n    getIndex(item) {\n        return this._items.indexOf(item);\n    }\n\n    remove(item) {\n        let index = this._items.indexOf(item);\n\n        if (index !== -1) {\n            this.removeAt(index);\n        }\n    };\n\n    removeAt(index) {\n        if (index >= 0 && index < this._items.length) {\n            const item = this._items[index];\n\n            if (item.ref) {\n                this._refs[item.ref] = undefined;\n            }\n\n            this._items.splice(index, 1);\n\n            this.onRemove(item, index);\n\n            return item;\n        } else {\n            throw new Error(`removeAt: The index ${index} is out of bounds ${this._items.length - 1}`);\n        }\n    };\n\n    clear() {\n        let n = this._items.length;\n        if (n) {\n            let prev = this._items;\n            this._items = [];\n            this._refs = {}\n            this.onSync(prev, [], []);\n        }\n    };\n\n    a(o) {\n        if (Utils.isObjectLiteral(o)) {\n            let c = this.createItem(o);\n            c.patch(o);\n            this.add(c);\n            return c;\n        } else if (Array.isArray(o)) {\n            for (let i = 0, n = o.length; i < n; i++) {\n                this.a(o[i]);\n            }\n            return null;\n        } else if (this.isItem(o)) {\n            this.add(o);\n            return o;\n        }\n    };\n\n    get length() {\n        return this._items.length;\n    }\n\n    _getRefs() {\n        return this._refs;\n    }\n\n    getByRef(ref) {\n        return this._refs[ref];\n    }\n\n    clearRef(ref) {\n        delete this._refs[ref];\n    }\n\n    setRef(ref, child) {\n        this._refs[ref] = child;\n    }\n\n    patch(settings) {\n        if (Utils.isObjectLiteral(settings)) {\n            this._setByObject(settings);\n        } else if (Array.isArray(settings)) {\n            this._setByArray(settings);\n        }\n    }\n\n    _setByObject(settings) {\n        // Overrule settings of known referenced items.\n        let refs = this._getRefs();\n        let crefs = Object.keys(settings);\n        for (let i = 0, n = crefs.length; i < n; i++) {\n            let cref = crefs[i];\n            let s = settings[cref];\n\n            let c = refs[cref];\n            if (!c) {\n                if (this.isItem(s)) {\n                    // Replace previous item;\n                    s.ref = cref;\n                    this.add(s);\n                } else {\n                    // Create new item.\n                    c = this.createItem(s);\n                    c.ref = cref;\n                    c.patch(s);\n                    this.add(c);\n                }\n            } else {\n                if (this.isItem(s)) {\n                    if (c !== s) {\n                        // Replace previous item;\n                        let idx = this.getIndex(c);\n                        s.ref = cref;\n                        this.setAt(s, idx);\n                    }\n                } else {\n                    c.patch(s);\n                }\n            }\n        }\n    }\n\n    _equalsArray(array) {\n        let same = true;\n        if (array.length === this._items.length) {\n            for (let i = 0, n = this._items.length; (i < n) && same; i++) {\n                same = same && (this._items[i] === array[i]);\n            }\n        } else {\n            same = false;\n        }\n        return same;\n    }\n\n    _setByArray(array) {\n        // For performance reasons, first check if the arrays match exactly and bail out if they do.\n        if (this._equalsArray(array)) {\n            return;\n        }\n\n        for (let i = 0, n = this._items.length; i < n; i++) {\n            this._items[i].marker = true;\n        }\n\n        let refs;\n        let newItems = [];\n        for (let i = 0, n = array.length; i < n; i++) {\n            let s = array[i];\n            if (this.isItem(s)) {\n                s.marker = false;\n                newItems.push(s);\n            } else {\n                let cref = s.ref;\n                let c;\n                if (cref) {\n                    if (!refs) refs = this._getRefs();\n                    c = refs[cref];\n                }\n\n                if (!c) {\n                    // Create new item.\n                    c = this.createItem(s);\n                } else {\n                    c.marker = false;\n                }\n\n                if (Utils.isObjectLiteral(s)) {\n                    c.patch(s);\n                }\n\n                newItems.push(c);\n            }\n        }\n\n        this._setItems(newItems);\n    }\n\n    _setItems(newItems) {\n        let prevItems = this._items;\n        this._items = newItems;\n\n        // Remove the items.\n        let removed = prevItems.filter(item => {let m = item.marker; delete item.marker; return m});\n        let added = newItems.filter(item => (prevItems.indexOf(item) === -1));\n\n        if (removed.length || added.length) {\n            // Recalculate refs.\n            this._refs = {}\n            for (let i = 0, n = this._items.length; i < n; i++) {\n                let ref = this._items[i].ref;\n                if (ref) {\n                    this._refs[ref] = this._items[i];\n                }\n            }\n        }\n\n        this.onSync(removed, added, newItems);\n    }\n\n    sort(f) {\n        const items = this._items.slice();\n        items.sort(f);\n        this._setByArray(items);\n    }\n\n    onAdd(item, index) {\n    }\n\n    onRemove(item, index) {\n    }\n\n    onSync(removed, added, order) {\n    }\n\n    onSet(item, index, prevItem) {\n    }\n\n    onMove(item, fromIndex, toIndex) {\n    }\n\n    createItem(object) {\n        throw new Error(\"ObjectList.createItem must create and return a new object\");\n    }\n\n    isItem(object) {\n        return false;\n    }\n\n    forEach(f) {\n        this.get().forEach(f);\n    }\n\n}\n\nimport Utils from \"./Utils.mjs\";\n\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Manages the list of children for an element.\n */\n\nimport ObjectList from \"./ObjectList.mjs\";\n\nexport default class ElementChildList extends ObjectList {\n\n    constructor(element) {\n        super();\n        this._element = element;\n    }\n\n    _connectParent(item) {\n        const prevParent = item.parent;\n        if (prevParent && prevParent !== this._element) {\n            // Cleanup in previous child list, without\n            const prevChildList = item.parent.childList;\n            const index = prevChildList.getIndex(item);\n\n            if (item.ref) {\n                prevChildList._refs[item.ref] = undefined;\n            }\n            prevChildList._items.splice(index, 1);\n\n            // Also clean up element core.\n            prevParent.core.removeChildAt(index);\n\n        }\n\n        item._setParent(this._element);\n\n        // We are expecting the caller to sync it to the core.\n    }\n\n    onAdd(item, index) {\n        this._connectParent(item);\n        this._element.core.addChildAt(index, item.core);\n    }\n\n    onRemove(item, index) {\n        item._setParent(null);\n        this._element.core.removeChildAt(index);\n    }\n\n    onSync(removed, added, order) {\n        for (let i = 0, n = removed.length; i < n; i++) {\n            removed[i]._setParent(null);\n        }\n        for (let i = 0, n = added.length; i < n; i++) {\n            this._connectParent(added[i]);\n        }\n        let gc = i => i.core;\n        this._element.core.syncChildren(removed.map(gc), added.map(gc), order.map(gc));\n    }\n\n    onSet(item, index, prevItem) {\n        prevItem._setParent(null);\n\n        this._connectParent(item);\n        this._element.core.setChildAt(index, item.core);\n    }\n\n    onMove(item, fromIndex, toIndex) {\n        this._element.core.moveChild(fromIndex, toIndex);\n    }\n\n    createItem(object) {\n        if (object.type) {\n            return new object.type(this._element.stage);\n        } else {\n            return this._element.stage.createElement();\n        }\n    }\n\n    isItem(object) {\n        return object.isElement;\n    }\n\n}\n\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Render tree node.\n */\n\nimport StageUtils from \"./StageUtils.mjs\";\nimport ElementCore from \"./core/ElementCore.mjs\";\nimport Base from \"./Base.mjs\";\n\nimport Utils from \"./Utils.mjs\";\nimport EventEmitter from \"../EventEmitter.mjs\";\nimport Shader from \"./Shader.mjs\";\n\nexport default class Element {\n\n    constructor(stage) {\n        this.stage = stage;\n\n        this.__id = Element.id++;\n\n        this.__start();\n\n        // EventEmitter constructor.\n        this._hasEventListeners = false;\n\n        this.__core = new ElementCore(this);\n\n        /**\n         * A reference that can be used while merging trees.\n         * @type {string}\n         */\n        this.__ref = null;\n\n        /**\n         * An element is attached if it is a descendant of the stage root.\n         * @type {boolean}\n         */\n        this.__attached = false;\n\n        /**\n         * An element is enabled when it is attached and it is visible (worldAlpha > 0).\n         * @type {boolean}\n         */\n        this.__enabled = false;\n\n        /**\n         * An element is active when it is enabled and it is within bounds.\n         * @type {boolean}\n         */\n        this.__active = false;\n\n        /**\n         * @type {Element}\n         */\n        this.__parent = null;\n\n        /**\n         * The texture that is currently set.\n         * @type {Texture}\n         */\n        this.__texture = null;\n\n        /**\n         * The currently displayed texture. While this.texture is loading, this one may be different.\n         * @type {Texture}\n         */\n        this.__displayedTexture = null;\n\n        /**\n         * Tags that can be used to identify/search for a specific element.\n         * @type {String[]}\n         */\n        this.__tags = null;\n\n        /**\n         * The tree's tags mapping.\n         * This contains all elements for all known tags, at all times.\n         * @type {Map}\n         */\n        this.__treeTags = null;\n\n        /**\n         * Creates a tag context: tagged elements in this branch will not be reachable from ancestors of this elements.\n         * @type {boolean}\n         */\n        this.__tagRoot = false;\n\n        /**\n         * (Lazy-initialised) list of children owned by this elements.\n         * @type {ElementChildList}\n         */\n        this.__childList = null;\n\n        this._w = 0;\n\n        this._h = 0;\n    }\n\n    __start() {\n    }\n\n    get id() {\n        return this.__id;\n    }\n\n    set ref(ref) {\n        if (this.__ref !== ref) {\n            const charcode = ref.charCodeAt(0);\n            if (!Utils.isUcChar(charcode)) {\n                this._throwError(\"Ref must start with an upper case character: \" + ref);\n            }\n            if (this.__ref !== null) {\n                this.removeTag(this.__ref);\n                if (this.__parent) {\n                    this.__parent.__childList.clearRef(this.__ref);\n                }\n            }\n\n            this.__ref = ref;\n\n            if (this.__ref) {\n                this._addTag(this.__ref);\n                if (this.__parent) {\n                    this.__parent.__childList.setRef(this.__ref, this);\n                }\n            }\n        }\n    }\n\n    get ref() {\n        return this.__ref;\n    }\n\n    get core() {\n        return this.__core;\n    }\n\n    setAsRoot() {\n        this.__core.setAsRoot();\n        this._updateAttachedFlag();\n        this._updateEnabledFlag();\n    }\n\n    get isRoot() {\n        return this.__core.isRoot;\n    }\n\n    _setParent(parent) {\n        if (this.__parent === parent) return;\n\n        if (this.__parent) {\n            this._unsetTagsParent();\n        }\n\n        this.__parent = parent;\n\n        if (parent) {\n            this._setTagsParent();\n        }\n\n        this._updateAttachedFlag();\n        this._updateEnabledFlag();\n        this._updateCollision();\n\n        if (this.isRoot && parent) {\n            this._throwError(\"Root should not be added as a child! Results are unspecified!\");\n        }\n    };\n\n    getDepth() {\n        let depth = 0;\n\n        let p = this.__parent;\n        while(p) {\n            depth++;\n            p = p.__parent;\n        }\n\n        return depth;\n    };\n\n    getAncestor(l) {\n        let p = this;\n        while (l > 0 && p.__parent) {\n            p = p.__parent;\n            l--;\n        }\n        return p;\n    };\n\n    getAncestors() {\n        const a = [];\n        let p = this;\n        while (p) {\n            a.push(p);\n            p = p.__parent;\n        }\n        return a;\n    }\n\n    getAncestorAtDepth(depth) {\n        let levels = this.getDepth() - depth;\n        if (levels < 0) {\n            return null;\n        }\n        return this.getAncestor(levels);\n    };\n\n    isAncestorOf(c) {\n        let p = c;\n        while(p = p.parent) {\n            if (this === p) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    getSharedAncestor(c) {\n        let o1 = this;\n        let o2 = c;\n        let l1 = o1.getDepth();\n        let l2 = o2.getDepth();\n        if (l1 > l2) {\n            o1 = o1.getAncestor(l1 - l2);\n        } else if (l2 > l1) {\n            o2 = o2.getAncestor(l2 - l1);\n        }\n\n        do {\n            if (o1 === o2) {\n                return o1;\n            }\n\n            o1 = o1.__parent;\n            o2 = o2.__parent;\n        } while (o1 && o2);\n\n        return null;\n    };\n\n    get attached() {\n        return this.__attached;\n    }\n\n    get enabled() {\n        return this.__enabled;\n    }\n\n    get active() {\n        return this.__active;\n    }\n\n    _isAttached() {\n        return (this.__parent ? this.__parent.__attached : (this.stage.root === this));\n    };\n\n    _isEnabled() {\n        return this.__core.visible && (this.__core.alpha > 0) && (this.__parent ? this.__parent.__enabled : (this.stage.root === this));\n    };\n\n    _isActive() {\n        return this._isEnabled() && this.withinBoundsMargin;\n    };\n\n    /**\n     * Updates the 'attached' flag for this branch.\n     */\n    _updateAttachedFlag() {\n        let newAttached = this._isAttached();\n        if (this.__attached !== newAttached) {\n            this.__attached = newAttached;\n\n            if (newAttached) {\n                this._onSetup();\n            }\n\n            let children = this._children.get();\n            if (children) {\n                let m = children.length;\n                if (m > 0) {\n                    for (let i = 0; i < m; i++) {\n                        children[i]._updateAttachedFlag();\n                    }\n                }\n            }\n\n            if (newAttached) {\n                this._onAttach();\n            } else {\n                this._onDetach();\n            }\n        }\n    };\n\n    /**\n     * Updates the 'enabled' flag for this branch.\n     */\n    _updateEnabledFlag() {\n        let newEnabled = this._isEnabled();\n        if (this.__enabled !== newEnabled) {\n            if (newEnabled) {\n                this._onEnabled();\n                this._setEnabledFlag();\n            } else {\n                this._onDisabled();\n                this._unsetEnabledFlag();\n            }\n\n            let children = this._children.get();\n            if (children) {\n                let m = children.length;\n                if (m > 0) {\n                    for (let i = 0; i < m; i++) {\n                        children[i]._updateEnabledFlag();\n                    }\n                }\n            }\n        }\n    };\n\n    _setEnabledFlag() {\n        this.__enabled = true;\n\n        // Force re-check of texture because dimensions might have changed (cutting).\n        this._updateDimensions();\n        this._updateTextureCoords();\n\n        if (this.__texture) {\n            this.__texture.addElement(this);\n        }\n\n        if (this.withinBoundsMargin) {\n            this._setActiveFlag();\n        }\n\n        if (this.__core.shader) {\n            this.__core.shader.addElement(this.__core);\n        }\n\n    }\n\n    _unsetEnabledFlag() {\n        if (this.__active) {\n            this._unsetActiveFlag();\n        }\n\n        if (this.__texture) {\n            this.__texture.removeElement(this);\n        }\n\n        if (this.__core.shader) {\n            this.__core.shader.removeElement(this.__core);\n        }\n\n        if (this._texturizer) {\n            this.texturizer.filters.forEach(filter => filter.removeElement(this.__core));\n        }\n\n        this.__enabled = false;\n    }\n\n    _setActiveFlag() {\n        this.__active = true;\n\n        // This must happen before enabling the texture, because it may already be loaded or load directly.\n        if (this.__texture) {\n            this.__texture.incActiveCount();\n        }\n\n        if (this.__texture) {\n            this._enableTexture();\n        }\n        this._onActive();\n    }\n\n    _unsetActiveFlag() {\n        if (this.__texture) {\n            this.__texture.decActiveCount();\n        }\n\n        this.__active = false;\n        if (this.__texture) {\n            this._disableTexture();\n        }\n\n        if (this._hasTexturizer()) {\n            this.texturizer.deactivate();\n        }\n\n        this._onInactive();\n    }\n\n    _onSetup() {\n    }\n\n    _onAttach() {\n    }\n\n    _onDetach() {\n    }\n\n    _onEnabled() {\n    }\n\n    _onDisabled() {\n    }\n\n    _onActive() {\n    }\n\n    _onInactive() {\n    }\n\n    _onResize() {\n    }\n\n    _getRenderWidth() {\n        if (this._w) {\n            return this._w;\n        } else if (this.__displayedTexture) {\n            return this.__displayedTexture.getRenderWidth();\n        } else if (this.__texture) {\n            // Texture already loaded, but not yet updated (probably because this element is not active).\n            return this.__texture.getRenderWidth();\n        } else {\n            return 0;\n        }\n    };\n\n    _getRenderHeight() {\n        if (this._h) {\n            return this._h;\n        } else if (this.__displayedTexture) {\n            return this.__displayedTexture.getRenderHeight();\n        } else if (this.__texture) {\n            // Texture already loaded, but not yet updated (probably because this element is not active).\n            return this.__texture.getRenderHeight();\n        } else {\n            return 0;\n        }\n    };\n\n    get renderWidth() {\n        if (this.__enabled) {\n            // Render width is only maintained if this element is enabled.\n            return this.__core.getRenderWidth();\n        } else {\n            return this._getRenderWidth();\n        }\n    }\n\n    get renderHeight() {\n        if (this.__enabled) {\n            return this.__core.getRenderHeight();\n        } else {\n            return this._getRenderHeight();\n        }\n    }\n\n    get finalX() {\n        return this.__core.x;\n    }\n\n    get finalY() {\n        return this.__core.y;\n    }\n\n    get finalW() {\n        return this.__core.w;\n    }\n\n    get finalH() {\n        return this.__core.h;\n    }\n\n    textureIsLoaded() {\n        return this.__texture && this.__texture.isLoaded();\n    }\n\n    loadTexture() {\n        if (this.__texture) {\n            this.__texture.load();\n\n            if (!this.__texture.isUsed() || !this._isEnabled()) {\n                // Loading the texture will have no effect on the dimensions of this element.\n                // Manually update them, so that calcs can be performed immediately in userland.\n                this._updateDimensions();\n            }\n        }\n    }\n\n    _enableTextureError() {\n        // txError event should automatically be re-triggered when a element becomes active.\n        const loadError = this.__texture.loadError;\n        if (loadError) {\n            this.emit('txError', loadError, this.__texture._source);\n        }\n    }\n\n    _enableTexture() {\n        if (this.__texture.isLoaded()) {\n            this._setDisplayedTexture(this.__texture);\n        } else {\n            // We don't want to retain the old 'ghost' image as it wasn't visible anyway.\n            this._setDisplayedTexture(null);\n\n            this._enableTextureError();\n        }\n    }\n\n    _disableTexture() {\n        // We disable the displayed texture because, when the texture changes while invisible, we should use that w, h,\n        // mw, mh for checking within bounds.\n        this._setDisplayedTexture(null);\n    }\n\n    get texture() {\n        return this.__texture;\n    }\n\n    set texture(v) {\n        let texture;\n        if (Utils.isObjectLiteral(v)) {\n            if (v.type) {\n                texture = new v.type(this.stage);\n            } else {\n                texture = this.texture;\n            }\n\n            if (texture) {\n                Base.patchObject(texture, v);\n            }\n        } else if (!v) {\n            texture = null;\n        } else {\n            if (v.isTexture) {\n                texture = v;\n            } else if (v.isTextureSource) {\n                texture = new SourceTexture(this.stage);\n                texture.textureSource = v;\n            } else {\n                console.error(\"[Lightning] Please specify a texture type.\");\n                return;\n            }\n        }\n\n        const prevTexture = this.__texture;\n        if (texture !== prevTexture) {\n            this.__texture = texture;\n\n            if (this.__texture) {\n                if (this.__enabled) {\n                    this.__texture.addElement(this);\n\n                    if (this.withinBoundsMargin) {\n                        if (this.__texture.isLoaded()) {\n                            this._setDisplayedTexture(this.__texture);\n                        } else {\n                            this._enableTextureError();\n                        }\n                    }\n                }\n            } else {\n                // Make sure that current texture is cleared when the texture is explicitly set to null.\n                this._setDisplayedTexture(null);\n            }\n\n            if (prevTexture && prevTexture !== this.__displayedTexture) {\n                prevTexture.removeElement(this);\n            }\n\n            this._updateDimensions();\n        }\n    }\n\n    get displayedTexture() {\n        return this.__displayedTexture;\n    }\n\n    _setDisplayedTexture(v) {\n        let prevTexture = this.__displayedTexture;\n\n        if (prevTexture && (v !== prevTexture)) {\n            if (this.__texture !== prevTexture) {\n                // The old displayed texture is deprecated.\n                prevTexture.removeElement(this);\n            }\n        }\n\n        const prevSource = this.__core.displayedTextureSource;\n        const sourceChanged = (v ? v._source : null) !== prevSource;\n\n        this.__displayedTexture = v;\n        this._updateDimensions();\n\n        if (this.__displayedTexture) {\n            if (sourceChanged) {\n                // We don't need to reference the displayed texture because it was already referenced (this.texture === this.displayedTexture).\n                this._updateTextureCoords();\n                this.__core.setDisplayedTextureSource(this.__displayedTexture._source);\n            }\n        } else {\n            this.__core.setDisplayedTextureSource(null);\n        }\n\n        if (sourceChanged) {\n            if (this.__displayedTexture) {\n                this.stage.removeUpdateSourceTexture(this.__displayedTexture)\n                this.emit('txLoaded', this.__displayedTexture);\n            } else {\n                this.emit('txUnloaded', this.__displayedTexture);\n            }\n        }\n    }\n\n    onTextureSourceLoaded() {\n        // This function is called when element is enabled, but we only want to set displayed texture for active elements.\n        if (this.active) {\n            // We may be dealing with a texture reloading, so we must force update.\n            this._setDisplayedTexture(this.__texture);\n        }\n    };\n\n    onTextureSourceLoadError(e) {\n        this.emit('txError', e, this.__texture._source);\n    };\n\n    forceRenderUpdate() {\n        this.__core.setHasRenderUpdates(3);\n    }\n\n    onDisplayedTextureClippingChanged() {\n        this._updateDimensions();\n        this._updateTextureCoords();\n    };\n\n    onPrecisionChanged() {\n        this._updateDimensions();\n    };\n\n    onDimensionsChanged(w, h) {\n        if (this.texture instanceof TextTexture) {\n            this.texture.w = w;\n            this.texture.h = h;\n            this.w = w;\n            this.h = h;\n        }\n    }\n\n    _updateDimensions() {\n        let w = this._getRenderWidth();\n        let h = this._getRenderHeight();\n\n        let unknownSize = false;\n        if (!w || !h) {\n            if (!this.__displayedTexture && this.__texture) {\n                // We use a 'max width' replacement instead in the ElementCore calcs.\n                // This makes sure that it is able to determine withinBounds.\n                w = w || this.__texture.mw;\n                h = h || this.__texture.mh;\n\n                if ((!w || !h) && this.__texture.isAutosizeTexture()) {\n                    unknownSize = true;\n                }\n            }\n        }\n\n        if (this.__core.setDimensions(w, h, unknownSize)) {\n            this._onResize();\n        }\n    }\n\n    _updateTextureCoords() {\n        if (this.displayedTexture && this.displayedTexture._source) {\n            let displayedTexture = this.displayedTexture;\n            let displayedTextureSource = this.displayedTexture._source;\n\n            let tx1 = 0, ty1 = 0, tx2 = 1.0, ty2 = 1.0;\n            if (displayedTexture.clipping) {\n                // Apply texture clipping.\n                let w = displayedTextureSource.getRenderWidth();\n                let h = displayedTextureSource.getRenderHeight();\n                let iw, ih, rw, rh;\n                iw = 1 / w;\n                ih = 1 / h;\n\n                if (displayedTexture.pw) {\n                    rw = (displayedTexture.pw) * iw;\n                } else {\n                    rw = (w - displayedTexture.px) * iw;\n                }\n\n                if (displayedTexture.ph) {\n                    rh = displayedTexture.ph * ih;\n                } else {\n                    rh = (h - displayedTexture.py) * ih;\n                }\n\n                iw *= (displayedTexture.px);\n                ih *= (displayedTexture.py);\n\n                tx1 = iw;\n                ty1 = ih;\n                tx2 = tx2 * rw + iw;\n                ty2 = ty2 * rh + ih;\n\n                tx1 = Math.max(0, tx1);\n                ty1 = Math.max(0, ty1);\n                tx2 = Math.min(1, tx2);\n                ty2 = Math.min(1, ty2);\n            }\n\n            if (displayedTextureSource._flipTextureY) {\n                let tempty = ty2;\n                ty2 = ty1;\n                ty1 = tempty;\n            }\n            this.__core.setTextureCoords(tx1, ty1, tx2, ty2);\n        }\n    }\n\n    getCornerPoints() {\n        return this.__core.getCornerPoints();\n    }\n\n    _unsetTagsParent() {\n        if (this.__tags) {\n            this.__tags.forEach((tag) => {\n                // Remove from treeTags.\n                let p = this;\n                while (p = p.__parent) {\n                    let parentTreeTags = p.__treeTags.get(tag);\n                    parentTreeTags.delete(this);\n\n                    if (p.__tagRoot) {\n                        break;\n                    }\n                }\n            });\n        }\n\n        let tags = null;\n        let n = 0;\n        if (this.__treeTags) {\n            if (!this.__tagRoot) {\n                tags = Utils.iteratorToArray(this.__treeTags.keys());\n                n = tags.length;\n\n                if (n > 0) {\n                    for (let i = 0; i < n; i++) {\n                        let tagSet = this.__treeTags.get(tags[i]);\n\n                        // Remove from treeTags.\n                        let p = this;\n                        while ((p = p.__parent)) {\n                            let parentTreeTags = p.__treeTags.get(tags[i]);\n\n                            tagSet.forEach(function (comp) {\n                                parentTreeTags.delete(comp);\n                            });\n\n                            if (p.__tagRoot) {\n                                break;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n\n    _setTagsParent() {\n        // Just copy over the 'local' tags.\n        if (this.__tags) {\n            this.__tags.forEach((tag) => {\n                let p = this;\n                while (p = p.__parent) {\n                    if (!p.__treeTags) {\n                        p.__treeTags = new Map();\n                    }\n\n                    let s = p.__treeTags.get(tag);\n                    if (!s) {\n                        s = new Set();\n                        p.__treeTags.set(tag, s);\n                    }\n\n                    s.add(this);\n\n                    if (p.__tagRoot) {\n                        break;\n                    }\n                }\n            });\n        }\n\n        if (this.__treeTags && this.__treeTags.size) {\n            if (!this.__tagRoot) {\n                this.__treeTags.forEach((tagSet, tag) => {\n                    let p = this;\n                    while (!p.__tagRoot && (p = p.__parent)) {\n                        if (p.__tagRoot) {\n                            // Do not copy all subs.\n                        }\n                        if (!p.__treeTags) {\n                            p.__treeTags = new Map();\n                        }\n\n                        let s = p.__treeTags.get(tag);\n                        if (!s) {\n                            s = new Set();\n                            p.__treeTags.set(tag, s);\n                        }\n\n                        tagSet.forEach(function (comp) {\n                            s.add(comp);\n                        });\n                    }\n                });\n            }\n        }\n    };\n\n\n    _getByTag(tag) {\n        if (!this.__treeTags) {\n            return [];\n        }\n        let t = this.__treeTags.get(tag);\n        return t ? Utils.setToArray(t) : [];\n    };\n\n    getTags() {\n        return this.__tags ? this.__tags : [];\n    };\n\n    setTags(tags) {\n        tags = tags.reduce((acc, tag) => {\n            return acc.concat(tag.split(' '));\n        }, []);\n\n        if (this.__ref) {\n            tags.push(this.__ref);\n        }\n\n        let i, n = tags.length;\n        let removes = [];\n        let adds = [];\n        for (i = 0; i < n; i++) {\n            if (!this.hasTag(tags[i])) {\n                adds.push(tags[i]);\n            }\n        }\n\n        let currentTags = this.tags || [];\n        n = currentTags.length;\n        for (i = 0; i < n; i++) {\n            if (tags.indexOf(currentTags[i]) == -1) {\n                removes.push(currentTags[i]);\n            }\n        }\n\n        for (i = 0; i < removes.length; i++) {\n            this.removeTag(removes[i]);\n        }\n\n        for (i = 0; i < adds.length; i++) {\n            this.addTag(adds[i]);\n        }\n    }\n\n    addTag(tag) {\n        if (tag.indexOf(' ') === -1) {\n            if (Utils.isUcChar(tag.charCodeAt(0))) {\n                this._throwError(\"Tag may not start with an upper case character.\");\n            }\n\n            this._addTag(tag);\n        } else {\n            const tags = tag.split(' ');\n            for (let i = 0, m = tags.length; i < m; i++) {\n                const tag = tags[i];\n\n                if (Utils.isUcChar(tag.charCodeAt(0))) {\n                    this._throwError(\"Tag may not start with an upper case character.\");\n                }\n\n                this._addTag(tag);\n            }\n        }\n    }\n\n    _addTag(tag) {\n        if (!this.__tags) {\n            this.__tags = [];\n        }\n        if (this.__tags.indexOf(tag) === -1) {\n            this.__tags.push(tag);\n\n            // Add to treeTags hierarchy.\n            let p = this.__parent;\n            if (p) {\n                do {\n                    if (!p.__treeTags) {\n                        p.__treeTags = new Map();\n                    }\n\n                    let s = p.__treeTags.get(tag);\n                    if (!s) {\n                        s = new Set();\n                        p.__treeTags.set(tag, s);\n                    }\n\n                    s.add(this);\n\n                } while (!p.__tagRoot && (p = p.__parent));\n            }\n        }\n    }\n\n    removeTag(tag) {\n        let i = this.__tags.indexOf(tag);\n        if (i !== -1) {\n            this.__tags.splice(i, 1);\n\n            // Remove from treeTags hierarchy.\n            let p = this.__parent;\n            if (p) {\n                do {\n                    let list = p.__treeTags.get(tag);\n                    if (list) {\n                        list.delete(this);\n                    }\n                } while (!p.__tagRoot && (p = p.__parent));\n            }\n        }\n    }\n\n    hasTag(tag) {\n        return (this.__tags && (this.__tags.indexOf(tag) !== -1));\n    }\n\n    /**\n     * Returns one of the elements from the subtree that have this tag.\n     * @param {string} tag\n     * @returns {Element}\n     */\n    _tag(tag) {\n        if (tag.indexOf(\".\") !== -1) {\n            return this.mtag(tag)[0];\n        } else {\n            if (this.__treeTags) {\n                let t = this.__treeTags.get(tag);\n                if (t) {\n                    const item = t.values().next();\n                    return item ? item.value : undefined;\n                }\n            }\n        }\n    };\n\n    get tag() {\n        return this._tag;\n    }\n\n    set tag(t) {\n        this.tags = t;\n    }\n\n    /**\n     * Returns all elements from the subtree that have this tag.\n     * @param {string} tag\n     * @returns {Element[]}\n     */\n    mtag(tag) {\n        let idx = tag.indexOf(\".\");\n        if (idx >= 0) {\n            let parts = tag.split('.');\n            let res = this._getByTag(parts[0]);\n            let level = 1;\n            let c = parts.length;\n            while (res.length && level < c) {\n                let resn = [];\n                for (let j = 0, n = res.length; j < n; j++) {\n                    resn = resn.concat(res[j]._getByTag(parts[level]));\n                }\n\n                res = resn;\n                level++;\n            }\n            return res;\n        } else {\n            return this._getByTag(tag);\n        }\n    };\n\n    stag(tag, settings) {\n        let t = this.mtag(tag);\n        let n = t.length;\n        for (let i = 0; i < n; i++) {\n            Base.patchObject(t[i], settings);\n        }\n    }\n\n    get tagRoot() {\n        return this.__tagRoot;\n    }\n\n    set tagRoot(v) {\n        if (this.__tagRoot !== v) {\n            if (!v) {\n                this._setTagsParent();\n            } else {\n                this._unsetTagsParent();\n            }\n\n            this.__tagRoot = v;\n        }\n    }\n\n    sel(path) {\n        const results = this.select(path);\n        if (results.length) {\n            return results[0];\n        } else {\n            return undefined;\n        }\n    }\n\n    select(path) {\n        if (path.indexOf(\",\") !== -1) {\n            let selectors = path.split(',');\n            let res = [];\n            for (let i = 0; i < selectors.length; i++) {\n                res = res.concat(this._select(selectors[i]));\n            }\n            return res;\n        } else {\n            return this._select(path);\n        }\n    }\n\n    _select(path) {\n        if (path === \"\") return [this];\n\n\n        let pointIdx = path.indexOf(\".\");\n        let arrowIdx = path.indexOf(\">\");\n        if (pointIdx === -1 && arrowIdx === -1) {\n            // Quick case.\n            return this.mtag(path);\n        }\n\n        // Detect by first char.\n        let isRef;\n        if (arrowIdx === 0) {\n            isRef = true;\n            path = path.substr(1);\n        } else if (pointIdx === 0) {\n            isRef = false;\n            path = path.substr(1);\n        } else {\n            isRef = false;\n        }\n\n        return this._selectChilds(path, isRef);\n    }\n\n    _selectChilds(path, isRef) {\n        const pointIdx = path.indexOf(\".\");\n        const arrowIdx = path.indexOf(\">\");\n\n        if (pointIdx === -1 && arrowIdx === -1) {\n            if (isRef) {\n                const ref = this.getByRef(path);\n                return ref ? [ref] : [];\n            } else {\n                return this.mtag(path);\n            }\n        }\n\n        if ((arrowIdx === -1) || (pointIdx !== -1 && pointIdx < arrowIdx)) {\n            let next;\n            const str = path.substr(0, pointIdx);\n            if (isRef) {\n                const ref = this.getByRef(str);\n                next = ref ? [ref] : [];\n            } else {\n                next = this.mtag(str);\n            }\n            let total = [];\n            const subPath = path.substr(pointIdx + 1);\n            for (let i = 0, n = next.length; i < n; i++) {\n                total = total.concat(next[i]._selectChilds(subPath, false));\n            }\n            return total;\n        } else {\n            let next;\n            const str = path.substr(0, arrowIdx);\n            if (isRef) {\n                const ref = this.getByRef(str);\n                next = ref ? [ref] : [];\n            } else {\n                next = this.mtag(str);\n            }\n            let total = [];\n            const subPath = path.substr(arrowIdx + 1);\n            for (let i = 0, n = next.length; i < n; i++) {\n                total = total.concat(next[i]._selectChilds(subPath, true));\n            }\n            return total;\n        }\n    }\n\n    getByRef(ref) {\n        return this.childList.getByRef(ref);\n    }\n\n    getLocationString() {\n        let i;\n        i = this.__parent ? this.__parent._children.getIndex(this) : \"R\";\n        let localTags = this.getTags();\n        let str = this.__parent ? this.__parent.getLocationString(): \"\";\n        if (this.ref) {\n            str += \":[\" + i + \"]\" + this.ref;\n        } else if (localTags.length) {\n            str += \":[\" + i + \"]\" + localTags.join(\",\");\n        } else {\n            str += \":[\" + i + \"]#\" + this.id;\n        }\n        return str;\n    }\n\n    toString() {\n        let obj = this.getSettings();\n        return Element.getPrettyString(obj, \"\");\n    };\n\n    static getPrettyString(obj, indent) {\n        let children = obj.children;\n        delete obj.children;\n\n\n        // Convert singular json settings object.\n        let colorKeys = [\"color\", \"colorUl\", \"colorUr\", \"colorBl\", \"colorBr\"];\n        let str = JSON.stringify(obj, function (k, v) {\n            if (colorKeys.indexOf(k) !== -1) {\n                return \"COLOR[\" + v.toString(16) + \"]\";\n            }\n            return v;\n        });\n        str = str.replace(/\"COLOR\\[([a-f0-9]{1,8})\\]\"/g, \"0x$1\");\n\n        if (children) {\n            let childStr = \"\";\n            if (Utils.isObjectLiteral(children)) {\n                let refs = Object.keys(children);\n                childStr = \"\";\n                for (let i = 0, n = refs.length; i < n; i++) {\n                    childStr += `\\n${indent}  \"${refs[i]}\":`\n                    delete children[refs[i]].ref;\n                    childStr += Element.getPrettyString(children[refs[i]], indent + \"  \") + (i < n - 1 ? \",\" : \"\");\n                }\n                let isEmpty = (str === \"{}\");\n                str = str.substr(0, str.length - 1) + (isEmpty ? \"\" : \",\") + childStr + \"\\n\" + indent + \"}\";\n            } else {\n                let n = children.length;\n                childStr = \"[\";\n                for (let i = 0; i < n; i++) {\n                    childStr += Element.getPrettyString(children[i], indent + \"  \") + (i < n - 1 ? \",\" : \"\") + \"\\n\";\n                }\n                childStr += indent + \"]}\";\n                let isEmpty = (str === \"{}\");\n                str = str.substr(0, str.length - 1) + (isEmpty ? \"\" : \",\") + \"\\\"children\\\":\\n\" + indent + childStr + \"}\";\n            }\n\n        }\n\n        return str;\n    }\n\n    getSettings() {\n        let settings = this.getNonDefaults();\n\n        let children = this._children.get();\n        if (children) {\n            let n = children.length;\n            if (n) {\n                const childArray = [];\n                let missing = false;\n                for (let i = 0; i < n; i++) {\n                    childArray.push(children[i].getSettings());\n                    missing = missing || !children[i].ref;\n                }\n\n                if (!missing) {\n                    settings.children = {}\n                    childArray.forEach(child => {\n                        settings.children[child.ref] = child;\n                    });\n                } else {\n                    settings.children = childArray;\n                }\n            }\n        }\n\n        settings.id = this.id;\n\n        return settings;\n    }\n\n    getNonDefaults() {\n        let settings = {};\n\n        if (this.constructor !== Element) {\n            settings.type = this.constructor.name;\n        }\n\n        if (this.__ref) {\n            settings.ref = this.__ref;\n        }\n\n        if (this.__tags && this.__tags.length) {\n            settings.tags = this.__tags;\n        }\n\n        if (this.x !== 0) settings.x = this.x;\n        if (this.y !== 0) settings.y = this.y;\n        if (this.w !== 0) settings.w = this.w;\n        if (this.h !== 0) settings.h = this.h;\n\n        if (this.scaleX === this.scaleY) {\n            if (this.scaleX !== 1) settings.scale = this.scaleX;\n        } else {\n            if (this.scaleX !== 1) settings.scaleX = this.scaleX;\n            if (this.scaleY !== 1) settings.scaleY = this.scaleY;\n        }\n\n        if (this.pivotX === this.pivotY) {\n            if (this.pivotX !== 0.5) settings.pivot = this.pivotX;\n        } else {\n            if (this.pivotX !== 0.5) settings.pivotX = this.pivotX;\n            if (this.pivotY !== 0.5) settings.pivotY = this.pivotY;\n        }\n\n        if (this.mountX === this.mountY) {\n            if (this.mountX !== 0) settings.mount = this.mountX;\n        } else {\n            if (this.mountX !== 0) settings.mountX = this.mountX;\n            if (this.mountY !== 0) settings.mountY = this.mountY;\n        }\n\n        if (this.alpha !== 1) settings.alpha = this.alpha;\n\n        if (!this.visible) settings.visible = false;\n\n        if (this.rotation !== 0) settings.rotation = this.rotation;\n\n        if (this.colorUl === this.colorUr && this.colorBl === this.colorBr && this.colorUl === this.colorBl) {\n            if (this.colorUl !== 0xFFFFFFFF) settings.color = this.colorUl.toString(16);\n        } else {\n            if (this.colorUl !== 0xFFFFFFFF) settings.colorUl = this.colorUl.toString(16);\n            if (this.colorUr !== 0xFFFFFFFF) settings.colorUr = this.colorUr.toString(16);\n            if (this.colorBl !== 0xFFFFFFFF) settings.colorBl = this.colorBl.toString(16);\n            if (this.colorBr !== 0xFFFFFFFF) settings.colorBr = this.colorBr.toString(16);\n        }\n\n        if (this.zIndex) settings.zIndex = this.zIndex;\n\n        if (this.forceZIndexContext) settings.forceZIndexContext = true;\n\n        if (this.clipping) settings.clipping = this.clipping;\n\n        if (!this.clipbox) settings.clipbox = this.clipbox;\n\n        if (this.__texture) {\n            let tnd = this.__texture.getNonDefaults();\n            if (Object.keys(tnd).length) {\n                settings.texture = tnd;\n            }\n        }\n\n        if (this.shader && Utils.isFunction(this.shader.getNonDefaults)) {\n            let tnd = this.shader.getNonDefaults();\n            if (Object.keys(tnd).length) {\n                settings.shader = tnd;\n            }\n        }\n\n        if (this._hasTexturizer()) {\n            if (this.texturizer.enabled) {\n                settings.renderToTexture = this.texturizer.enabled;\n            }\n            if (this.texturizer.lazy) {\n                settings.renderToTextureLazy = this.texturizer.lazy;\n            }\n            if (this.texturizer.colorize) {\n                settings.colorizeResultTexture = this.texturizer.colorize;\n            }\n            if (this.texturizer.renderOffscreen) {\n                settings.renderOffscreen = this.texturizer.renderOffscreen;\n            }\n        }\n\n        return settings;\n    };\n\n    static getGetter(propertyPath) {\n        let getter = Element.PROP_GETTERS.get(propertyPath);\n        if (!getter) {\n            getter = new Function('obj', 'return obj.' + propertyPath);\n            Element.PROP_GETTERS.set(propertyPath, getter);\n        }\n        return getter;\n    }\n\n    static getSetter(propertyPath) {\n        let setter = Element.PROP_SETTERS.get(propertyPath);\n        if (!setter) {\n            setter = new Function('obj', 'v', 'obj.' + propertyPath + ' = v');\n            Element.PROP_SETTERS.set(propertyPath, setter);\n        }\n        return setter;\n    }\n\n    get withinBoundsMargin() {\n        return this.__core._withinBoundsMargin;\n    }\n\n    _enableWithinBoundsMargin() {\n        // Iff enabled, this toggles the active flag.\n        if (this.__enabled) {\n            this._setActiveFlag();\n        }\n    }\n\n    _disableWithinBoundsMargin() {\n        // Iff active, this toggles the active flag.\n        if (this.__active) {\n            this._unsetActiveFlag();\n        }\n    }\n\n    set boundsMargin(v) {\n        if (!Array.isArray(v) && v !== null) {\n            throw new Error(\"boundsMargin should be an array of left-top-right-bottom values or null (inherit margin)\");\n        }\n        this.__core.boundsMargin = v;\n    }\n\n    get boundsMargin() {\n        return this.__core.boundsMargin;\n    }\n\n    get x() {\n        return this.__core.offsetX;\n    }\n\n    set x(v) {\n        this.__core.offsetX = v;\n    }\n\n    get y() {\n        return this.__core.offsetY;\n    }\n\n    set y(v) {\n        this.__core.offsetY = v;\n    }\n\n    get w() {\n        return this._w;\n    }\n\n    set w(v) {\n        if (Utils.isFunction(v)) {\n            this._w = 0;\n            this.__core.funcW = v;\n        } else {\n            v = Math.max(v, 0);\n            if (this._w !== v) {\n                this.__core.disableFuncW();\n                this._w = v;\n                this._updateDimensions();\n            }\n        }\n    }\n\n    get h() {\n        return this._h;\n    }\n\n    set h(v) {\n        if (Utils.isFunction(v)) {\n            this._h = 0;\n            this.__core.funcH = v;\n        } else {\n            v = Math.max(v, 0);\n            if (this._h !== v) {\n                this.__core.disableFuncH();\n                this._h = v;\n                this._updateDimensions();\n            }\n        }\n    }\n\n    get collision() {\n        return this._collision;\n    }\n\n    set collision(v) {\n        this._collision = v;\n    }\n\n    _updateCollision() {\n        if (this.collision && this.__parent && this.__parent.collision === undefined) {\n            /**\n             * Mark collision as 2 to indicate atleast one descendant has collision enabled.\n             * This narrows down the search for elements with active collision.\n            */\n            this.__parent.collision = 2;\n        }\n    }\n\n    get scaleX() {\n        return this.__core.scaleX;\n    }\n\n    set scaleX(v) {\n        this.__core.scaleX = v;\n    }\n\n    get scaleY() {\n        return this.__core.scaleY;\n    }\n\n    set scaleY(v) {\n        this.__core.scaleY = v;\n    }\n\n    get scale() {\n        return this.__core.scale;\n    }\n\n    set scale(v) {\n        this.__core.scale = v;\n    }\n\n    get pivotX() {\n        return this.__core.pivotX;\n    }\n\n    set pivotX(v) {\n        this.__core.pivotX = v;\n    }\n\n    get pivotY() {\n        return this.__core.pivotY;\n    }\n\n    set pivotY(v) {\n        this.__core.pivotY = v;\n    }\n\n    get pivot() {\n        return this.__core.pivot;\n    }\n\n    set pivot(v) {\n        this.__core.pivot = v;\n    }\n\n    get mountX() {\n        return this.__core.mountX;\n    }\n\n    set mountX(v) {\n        this.__core.mountX = v;\n    }\n\n    get mountY() {\n        return this.__core.mountY;\n    }\n\n    set mountY(v) {\n        this.__core.mountY = v;\n    }\n\n    get mount() {\n        return this.__core.mount;\n    }\n\n    set mount(v) {\n        this.__core.mount = v;\n    }\n\n    get rotation() {\n        return this.__core.rotation;\n    }\n\n    set rotation(v) {\n        this.__core.rotation = v;\n    }\n\n    get alpha() {\n        return this.__core.alpha;\n    }\n\n    set alpha(v) {\n        this.__core.alpha = v;\n    }\n\n    get visible() {\n        return this.__core.visible;\n    }\n\n    set visible(v) {\n        this.__core.visible = v;\n    }\n    \n    get colorUl() {\n        return this.__core.colorUl;\n    }\n\n    set colorUl(v) {\n        this.__core.colorUl = v;\n    }\n\n    get colorUr() {\n        return this.__core.colorUr;\n    }\n\n    set colorUr(v) {\n        this.__core.colorUr = v;\n    }\n\n    get colorBl() {\n        return this.__core.colorBl;\n    }\n\n    set colorBl(v) {\n        this.__core.colorBl = v;\n    }\n\n    get colorBr() {\n        return this.__core.colorBr;\n    }\n\n    set colorBr(v) {\n        this.__core.colorBr = v;\n    }\n\n    get color() {\n        return this.__core.colorUl;\n    }\n\n    set color(v) {\n        if (this.colorUl !== v || this.colorUr !== v || this.colorBl !== v || this.colorBr !== v) {\n            this.colorUl = v;\n            this.colorUr = v;\n            this.colorBl = v;\n            this.colorBr = v;\n        }\n    }\n\n    get colorTop() {\n        return this.colorUl;\n    }\n\n    set colorTop(v) {\n        if (this.colorUl !== v || this.colorUr !== v) {\n            this.colorUl = v;\n            this.colorUr = v;\n        }\n    }\n\n    get colorBottom() {\n        return this.colorBl;\n    }\n\n    set colorBottom(v) {\n        if (this.colorBl !== v || this.colorBr !== v) {\n            this.colorBl = v;\n            this.colorBr = v;\n        }\n    }\n\n    get colorLeft() {\n        return this.colorUl;\n    }\n\n    set colorLeft(v) {\n        if (this.colorUl !== v || this.colorBl !== v) {\n            this.colorUl = v;\n            this.colorBl = v;\n        }\n    }\n\n    get colorRight() {\n        return this.colorUr;\n    }\n\n    set colorRight(v) {\n        if (this.colorUr !== v || this.colorBr !== v) {\n            this.colorUr = v;\n            this.colorBr = v;\n        }\n    }\n\n    get zIndex() {return this.__core.zIndex}\n    set zIndex(v) {\n        this.__core.zIndex = v;\n    }\n\n    get forceZIndexContext() {return this.__core.forceZIndexContext}\n    set forceZIndexContext(v) {\n        this.__core.forceZIndexContext = v;\n    }\n\n    get clipping() {return this.__core.clipping}\n    set clipping(v) {\n        this.__core.clipping = v;\n    }\n\n    get clipbox() {return this.__core.clipbox}\n    set clipbox(v) {\n        this.__core.clipbox = v;\n    }\n\n    get tags() {\n        return this.getTags();\n    }\n\n    set tags(v) {\n        if (!Array.isArray(v)) v = [v];\n        this.setTags(v);\n    }\n\n    set t(v) {\n        this.tags = v;\n    }\n\n    get _children() {\n        if (!this.__childList) {\n            this.__childList = new ElementChildList(this, false);\n        }\n        return this.__childList;\n    }\n\n    get childList() {\n        if (!this._allowChildrenAccess()) {\n            this._throwError(\"Direct access to children is not allowed in \" + this.getLocationString());\n        }\n        return this._children;\n    }\n\n    hasChildren() {\n        return this._allowChildrenAccess() && this.__childList && (this.__childList.length > 0);\n    }\n\n    _allowChildrenAccess() {\n        return true;\n    }\n\n    get children() {\n        return this.childList.get();\n    }\n\n    set children(children) {\n        this.childList.patch(children);\n    }\n\n    add(o) {\n        return this.childList.a(o);\n    }\n\n    get p() {\n        return this.__parent;\n    }\n\n    get parent() {\n        return this.__parent;\n    }\n\n    get src() {\n        if (this.texture && this.texture instanceof ImageTexture) {\n            return this.texture._src;\n        } else {\n            return undefined;\n        }\n    }\n\n    set src(v) {\n        const texture = new ImageTexture(this.stage);\n        texture.src = v;\n        this.texture = texture;\n    }\n\n    set mw(v) {\n        if (this.texture) {\n            this.texture.mw = v;\n            this._updateDimensions();\n        } else {\n            this._throwError('Please set mw after setting a texture.');\n        }\n    }\n\n    set mh(v) {\n        if (this.texture) {\n            this.texture.mh = v;\n            this._updateDimensions();\n        } else {\n            this._throwError('Please set mh after setting a texture.');\n        }\n    }\n\n    get rect() {\n        return (this.texture === this.stage.rectangleTexture);\n    }\n\n    set rect(v) {\n        if (v) {\n            this.texture = this.stage.rectangleTexture;\n        } else {\n            this.texture = null;\n        }\n    }\n\n    enableTextTexture() {\n        if (!this.texture || !(this.texture instanceof TextTexture)) {\n            this.texture = new TextTexture(this.stage);\n\n            if (!this.texture.w && !this.texture.h) {\n                // Inherit dimensions from element.\n                // This allows userland to set dimensions of the Element and then later specify the text.\n                this.texture.w = this.w;\n                this.texture.h = this.h;\n            }\n        }\n        return this.texture;\n    }\n\n    get text() {\n        if (this.texture && (this.texture instanceof TextTexture)) {\n            return this.texture;\n        } else {\n            return null;\n        }\n    }\n\n    set text(v) {\n        if (!this.texture || !(this.texture instanceof TextTexture)) {\n            this.enableTextTexture();\n        }\n        if (Utils.isString(v)) {\n            this.texture.text = v;\n        } else {\n            this.texture.patch(v);\n        }\n    }\n\n    set onUpdate(f) {\n        this.__core.onUpdate = f;\n    }\n\n    set onAfterCalcs(f) {\n        this.__core.onAfterCalcs = f;\n    }\n\n    set onAfterUpdate(f) {\n        this.__core.onAfterUpdate = f;\n    }\n\n    forceUpdate() {\n        // Make sure that the update loop is run.\n        this.__core._setHasUpdates();\n    }\n\n    get shader() {\n        return this.__core.shader;\n    }\n\n    set shader(v) {\n        if (Utils.isObjectLiteral(v) && !v.type) {\n            // Setting properties on an existing shader.\n            if (this.shader) {\n                this.shader.patch(v);\n            }\n        } else {\n            const shader = Shader.create(this.stage, v);\n\n            if (this.__enabled && this.__core.shader) {\n                this.__core.shader.removeElement(this.__core);\n            }\n\n            this.__core.shader = shader;\n\n            if (this.__enabled && this.__core.shader) {\n                this.__core.shader.addElement(this.__core);\n            }\n        }\n    }\n\n    _hasTexturizer() {\n        return !!this.__core._texturizer;\n    }\n\n    get renderToTexture() {\n        return this.rtt\n    }\n\n    set renderToTexture(v) {\n        this.rtt = v\n    }\n\n    get rtt() {\n        return this._hasTexturizer() && this.texturizer.enabled;\n    }\n\n    set rtt(v) {\n        this.texturizer.enabled = v;\n    }\n\n    get rttLazy() {\n        return this._hasTexturizer() && this.texturizer.lazy;\n    }\n\n    set rttLazy(v) {\n        this.texturizer.lazy = v;\n    }\n\n    get renderOffscreen() {\n        return this._hasTexturizer() && this.texturizer.renderOffscreen;\n    }\n\n    set renderOffscreen(v) {\n        this.texturizer.renderOffscreen = v;\n    }\n\n    get colorizeResultTexture() {\n        return this._hasTexturizer() && this.texturizer.colorize;\n    }\n\n    set colorizeResultTexture(v) {\n        this.texturizer.colorize = v;\n    }\n\n    getTexture() {\n        return this.texturizer._getTextureSource();\n    }\n\n    get texturizer() {\n        return this.__core.texturizer;\n    }\n\n    patch(settings) {\n        let paths = Object.keys(settings);\n\n        for (let i = 0, n = paths.length; i < n; i++) {\n            let path = paths[i];\n            const v = settings[path];\n\n            const firstCharCode = path.charCodeAt(0);\n            if (Utils.isUcChar(firstCharCode)) {\n                // Ref.\n                const child = this.getByRef(path);\n                if (!child) {\n                    if (v !== undefined) {\n                        // Add to list immediately.\n                        let c;\n                        if (Utils.isObjectLiteral(v)) {\n                            // Catch this case to capture createMode flag.\n                            c = this.childList.createItem(v);\n                            c.patch(v);\n                        } else if (Utils.isObject(v)) {\n                            c = v;\n                        }\n                        if (c.isElement) {\n                            c.ref = path;\n                        }\n\n                        this.childList.a(c);\n                    }\n                } else {\n                    if (v === undefined) {\n                        if (child.parent) {\n                            child.parent.childList.remove(child);\n                        }\n                    } else if (Utils.isObjectLiteral(v)) {\n                        child.patch(v);\n                    } else if (v.isElement) {\n                        // Replace element by new element.\n                        v.ref = path;\n                        this.childList.replace(v, child);\n                    } else {\n                        this._throwError(\"Unexpected value for path: \" + path);\n                    }\n                }\n            } else {\n                // Property.\n                Base.patchObjectProperty(this, path, v);\n            }\n        }\n    }\n\n    _throwError(message) {\n        throw new Error(this.constructor.name + \" (\" + this.getLocationString() + \"): \" + message);\n    }\n\n    animation(settings) {\n        return this.stage.animations.createAnimation(this, settings);\n    }\n\n    transition(property, settings = null) {\n        if (settings === null) {\n            return this._getTransition(property);\n        } else {\n            this._setTransition(property, settings);\n            // We do not create/return the transition, because it would undo the 'lazy transition creation' optimization.\n            return null;\n        }\n    }\n\n    set transitions(object) {\n        let keys = Object.keys(object);\n        keys.forEach(property => {\n            this.transition(property, object[property]);\n        });\n    }\n\n    set smooth(object) {\n        let keys = Object.keys(object);\n        keys.forEach(property => {\n            let value = object[property];\n            if (Array.isArray(value)) {\n                this.setSmooth(property, value[0], value[1]);\n            } else {\n                this.setSmooth(property, value);\n            }\n        });\n    }\n\n    fastForward(property) {\n        if (this._transitions) {\n            let t = this._transitions[property];\n            if (t && t.isTransition) {\n                t.finish();\n            }\n        }\n    }\n\n    _getTransition(property) {\n        if (!this._transitions) {\n            this._transitions = {};\n        }\n        let t = this._transitions[property];\n        if (!t) {\n            // Create default transition.\n            t = new Transition(this.stage.transitions, this.stage.transitions.defaultTransitionSettings, this, property);\n        } else if (t.isTransitionSettings) {\n            // Upgrade to 'real' transition.\n            t = new Transition(\n                this.stage.transitions,\n                t,\n                this,\n                property\n            );\n        }\n        this._transitions[property] = t;\n        return t;\n    }\n\n    _setTransition(property, settings) {\n        if (!settings) {\n            this._removeTransition(property);\n        } else {\n            if (Utils.isObjectLiteral(settings)) {\n                // Convert plain object to proper settings object.\n                settings = this.stage.transitions.createSettings(settings);\n            }\n\n            if (!this._transitions) {\n                this._transitions = {};\n            }\n\n            let current = this._transitions[property];\n            if (current && current.isTransition) {\n                // Runtime settings change.\n                current.settings = settings;\n                return current;\n            } else {\n                // Initially, only set the settings and upgrade to a 'real' transition when it is used.\n                this._transitions[property] = settings;\n            }\n        }\n    }\n\n    _removeTransition(property) {\n        if (this._transitions) {\n            delete this._transitions[property];\n        }\n    }\n\n    getSmooth(property, v) {\n        let t = this._getTransition(property);\n        if (t && t.isAttached()) {\n            return t.targetValue;\n        } else {\n            return v;\n        }\n    }\n\n    setSmooth(property, v, settings) {\n        if (settings) {\n            this._setTransition(property, settings);\n        }\n        let t = this._getTransition(property);\n        t.start(v);\n        return t;\n    }\n\n    get flex() {\n        return this.__core.flex;\n    }\n\n    set flex(v) {\n        this.__core.flex = v;\n    }\n\n    get flexItem() {\n        return this.__core.flexItem;\n    }\n\n    set flexItem(v) {\n        this.__core.flexItem = v;\n    }\n\n    static isColorProperty(property) {\n        return property.toLowerCase().indexOf(\"color\") >= 0;\n    }\n\n    static getMerger(property) {\n        if (Element.isColorProperty(property)) {\n            return StageUtils.mergeColors;\n        } else {\n            return StageUtils.mergeNumbers;\n        }\n    }\n\n    toJSON() {\n        const ref = [`${this.constructor.name}`];\n        const tree = {};\n        tree[ref] = {};\n\n        if (this.hasChildren()) {\n            Element.collectChildren(tree[ref], this.__childList);\n        } else {\n            tree[ref] = {...Element.getProperties(this)};\n        }\n        return tree;\n    }\n\n    static collectChildren(tree, children) {\n        const childList = children;\n        for (let i = 0, j = childList.length; i < j; i++) {\n            const element = childList.getAt(i);\n            const ref = `${element.__ref || `Element-${element.id}`}`;\n            const properties = this.getProperties(element);\n\n            tree[ref] = {...properties};\n\n            if (element.hasChildren()) {\n                tree[ref].children = {};\n                this.collectChildren(\n                    tree[ref].children, element.__childList\n                );\n            }\n        }\n    }\n\n    static getProperties(element) {\n        const props = {};\n        const list = [\n            \"alpha\", \"active\", \"attached\", \"boundsMargin\", \"color\", \"clipping\", \"enabled\", \"h\", \"id\", \"isComponent\",\n            \"mount\", \"mountY\", \"mountX\", \"pivot\", \"pivotX\", \"pivotY\", \"ref\", \"renderOffscreen\", \"renderToTexture\", \"scale\",\n            \"scaleX\", \"scaleY\", \"state\", \"tag\", \"visible\", \"w\", \"x\", \"y\", \"zIndex\",\n            \"!!flex\", \"!!flexItem\", \"hasFocus()\", \"hasFinalFocus()\"\n        ];\n        let n = list.length;\n\n        while (n--) {\n            let key = list[n];\n            const getBoolean = /^!{2}/;\n            const isFunction = /\\(\\)$/;\n\n            if (getBoolean.test(key)) {\n                key = key.substring(2, key.length);\n                props[key] = !!element[key];\n            } else if (isFunction.test(key)) {\n                key = key.substring(0, key.length - 2);\n                if (typeof element[key] === \"function\") {\n                    props[key] = element[key]();\n                }\n            } else {\n                props[key] = element[key];\n            }\n        }\n        return {...props, ...element.getNonDefaults()};\n    }\n}\n\n// This gives a slight performance benefit compared to extending EventEmitter.\nEventEmitter.addAsMixin(Element);\n\nElement.prototype.isElement = 1;\n\nElement.id = 1;\n\n// Getters reused when referencing element (subobject) properties by a property path, as used in a transition or animation ('x', 'texture.x', etc).\nElement.PROP_GETTERS = new Map();\n\n// Setters reused when referencing element (subobject) properties by a property path, as used in a transition or animation ('x', 'texture.x', etc).\nElement.PROP_SETTERS = new Map();\n\nimport Texture from \"./Texture.mjs\";\nimport ImageTexture from \"../textures/ImageTexture.mjs\";\nimport TextTexture from \"../textures/TextTexture.mjs\";\nimport SourceTexture from \"../textures/SourceTexture.mjs\";\nimport Transition from \"../animation/Transition.mjs\";\nimport ElementChildList from \"./ElementChildList.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class StateMachine {\n\n    constructor() {\n        StateMachine.setupStateMachine(this);\n    }\n\n    static setupStateMachine(target) {\n        const targetConstructor = target.constructor;\n        const router = StateMachine.create(targetConstructor);\n        Object.setPrototypeOf(target, router.prototype);\n        target.constructor = targetConstructor;\n        target._initStateMachine();\n    }\n\n    /**\n     * Creates a state machine implementation.\n     * It extends the original type and should be used when creating new instances.\n     * The original type is available as static property 'original', and it must be used when subclassing as follows:\n     * const type = StateMachine.create(class YourNewStateMachineClass extends YourBaseStateMachineClass.original {  })\n     * @param {Class} type\n     * @returns {StateMachine}\n     */\n    static create(type) {\n        if (!type.hasOwnProperty('_sm')) {\n            // Only need to run once.\n            const stateMachineType = new StateMachineType(type);\n            type._sm = stateMachineType;\n        }\n\n        return type._sm.router;\n    }\n\n    /**\n     * Calls the specified method if it exists.\n     * @param {string} event\n     * @param {*...} args\n     */\n    fire(event, ...args) {\n        if (this._hasMethod(event)) {\n            return this[event](...args);\n        }\n    }\n\n    /**\n     * Returns the current state path (for example \"Initialized.Loading\").\n     * @returns {string}\n     * @protected\n     */\n    _getState() {\n        return this._state.__path;\n    }\n\n    /**\n     * Returns true iff statePath is (an ancestor of) currentStatePath.\n     * @param {string} statePath\n     * @param {string} currentStatePath\n     * @returns {Boolean}\n     * @protected\n     */\n    _inState(statePath, currentStatePath = this._state.__path) {\n        const state = this._sm.getStateByPath(statePath);\n        const currentState = this._sm.getStateByPath(currentStatePath);\n        const level = state.__level;\n        const stateAtLevel = StateMachine._getStateAtLevel(currentState, level);\n        return (stateAtLevel === state);\n    }\n\n    /**\n     * Returns true if the specified class member is defined for the currently set state.\n     * @param {string} name\n     * @returns {boolean}\n     * @protected\n     */\n    _hasMember(name) {\n        return !!this.constructor.prototype[name];\n    }\n\n    /**\n     * Returns true if the specified class member is a method for the currently set state.\n     * @param {string} name\n     * @returns {boolean}\n     * @protected\n     */\n    _hasMethod(name) {\n        const member = this.constructor.prototype[name];\n        return !!member && (typeof member === \"function\")\n    }\n\n    /**\n     * Switches to the specified state.\n     * @param {string} statePath\n     *   Substates are seperated by a underscores (for example \"Initialized.Loading\").\n     * @param {*[]} [args]\n     *   Args that are supplied in $enter and $exit events.\n     * @protected\n     */\n    _setState(statePath, args) {\n        const setStateId = ++this._setStateCounter;\n        this._setStateId = setStateId;\n\n        if (this._state.__path !== statePath) {\n            // Performance optimization.\n            let newState = this._sm._stateMap[statePath];\n            if (!newState) {\n                // Check for super state.\n                newState = this._sm.getStateByPath(statePath);\n            }\n\n            const prevState = this._state;\n\n            const hasDifferentEnterMethod = (newState.prototype.$enter !== this._state.prototype.$enter);\n            const hasDifferentExitMethod = (newState.prototype.$exit !== this._state.prototype.$exit);\n            if (hasDifferentEnterMethod || hasDifferentExitMethod) {\n                const sharedState = StateMachine._getSharedState(this._state, newState);\n                const context = {\n                    newState: newState.__path,\n                    prevState: prevState.__path,\n                    sharedState: sharedState.__path\n                };\n                const sharedLevel = sharedState.__level;\n\n                if (hasDifferentExitMethod) {\n                    const exitStates = StateMachine._getStatesUntilLevel(this._state, sharedLevel);\n                    for (let i = 0, n = exitStates.length; i < n; i++) {\n                        this.__setState(exitStates[i]);\n                        this._callExit(this._state, args, context);\n                        const stateChangeOverridden = (this._setStateId !== setStateId);\n                        if (stateChangeOverridden) {\n                            return;\n                        }\n                    }\n                }\n\n                if (hasDifferentEnterMethod) {\n                    const enterStates = StateMachine._getStatesUntilLevel(newState, sharedLevel).reverse();\n                    for (let i = 0, n = enterStates.length; i < n; i++) {\n                        this.__setState(enterStates[i]);\n                        this._callEnter(this._state, args, context);\n                        const stateChangeOverridden = (this._setStateId !== setStateId);\n                        if (stateChangeOverridden) {\n                            return;\n                        }\n                    }\n                }\n\n            }\n\n            this.__setState(newState);\n\n            if (this._changedState) {\n                const context = {\n                    newState: newState.__path,\n                    prevState: prevState.__path\n                };\n\n                if (args) {\n                    this._changedState(context, ...args);\n                } else {\n                    this._changedState(context);\n                }\n            }\n\n            if (this._onStateChange) {\n                const context = {\n                    newState: newState.__path,\n                    prevState: prevState.__path\n                };\n                this._onStateChange(context);\n            }\n\n        }\n    }\n\n    _callEnter(state, args = [], context) {\n        const hasParent = !!state.__parent;\n        if (state.prototype.$enter) {\n            if (!hasParent || (state.__parent.prototype.$enter !== state.prototype.$enter)) {\n                state.prototype.$enter.apply(this, [context, ...args]);\n            }\n        }\n    }\n\n    _callExit(state, args = [], context) {\n        const hasParent = !!state.__parent;\n        if (state.prototype.$exit) {\n            if (!hasParent || (state.__parent.prototype.$exit !== state.prototype.$exit)) {\n                state.prototype.$exit.apply(this, [context, ...args]);\n            }\n        }\n    }\n\n    __setState(state) {\n        this._state = state;\n        this._stateIndex = state.__index;\n        this.constructor = state;\n    }\n\n    _initStateMachine() {\n        this._state = null;\n        this._stateIndex = 0;\n        this._setStateCounter = 0;\n        this._sm = this._routedType._sm;\n        this.__setState(this._sm.getStateByPath(\"\"));\n        const context = {newState: \"\", prevState: undefined, sharedState: undefined};\n        this._callEnter(this._state, [], context);\n        this._onStateChange = undefined;\n    }\n\n    /**\n     * Between multiple member names, select the one specified in the deepest state.\n     * If multiple member names are specified in the same deepest state, the first one in the array is returned.\n     * @param {string[]} memberNames\n     * @returns {string|undefined}\n     * @protected\n     */\n    _getMostSpecificHandledMember(memberNames) {\n        let cur = this._state;\n        do {\n            for (let i = 0, n = memberNames.length; i < n; i++) {\n                const memberName = memberNames[i];\n                if (!cur.__parent) {\n                    if (cur.prototype[memberName]) {\n                        return memberName;\n                    }\n                } else {\n                    const alias = StateMachineType.getStateMemberAlias(cur.__path, memberName);\n                    if (this[alias]) {\n                        return memberName;\n                    }\n                }\n            }\n            cur = cur.__parent;\n        } while (cur);\n    }\n\n    static _getStatesUntilLevel(state, level) {\n        const states = [];\n        while (state.__level > level) {\n            states.push(state);\n            state = state.__parent;\n        }\n        return states;\n    }\n\n    static _getSharedState(state1, state2) {\n        const state1Array = StateMachine._getAncestorStates(state1);\n        const state2Array = StateMachine._getAncestorStates(state2);\n        const n = Math.min(state1Array.length, state2Array.length);\n        for (let i = 0; i < n; i++) {\n            if (state1Array[i] !== state2Array[i]) {\n                return state1Array[i - 1];\n            }\n        }\n        return state1Array[n - 1];\n    }\n\n    static _getAncestorStates(state) {\n        const result = [];\n        do {\n            result.push(state);\n        } while(state = state.__parent);\n        return result.reverse();\n    }\n\n    static _getStateAtLevel(state, level) {\n        if (level > state.__level) {\n            return undefined;\n        }\n\n        while(level < state.__level) {\n            state = state.__parent;\n        }\n        return state;\n    }\n}\n\nclass StateMachineType {\n\n    constructor(type) {\n        this._type = type;\n        this._router = null;\n\n        this.init();\n    }\n\n    get router() {\n        return this._router;\n    }\n\n    init() {\n        this._router = this._createRouter();\n\n        this._stateMap = this._getStateMap();\n\n        this._addStateMemberDelegatorsToRouter();\n\n    }\n\n    _createRouter() {\n        const type = this._type;\n\n        const router = class StateMachineRouter extends type {\n            constructor() {\n                super(...arguments);\n                if (!this.constructor.hasOwnProperty('_isRouter')) {\n                    throw new Error(`You need to extend ${type.name}.original instead of ${type.name}.`);\n                }\n            }\n        };\n        router._isRouter = true;\n        router.prototype._routedType = type;\n        router.original = type;\n\n        this._mixinStateMachineMethods(router);\n\n        return router;\n    }\n\n    _mixinStateMachineMethods(router) {\n        // Mixin the state machine methods, so that we reuse the methods instead of re-creating them.\n        const names = Object.getOwnPropertyNames(StateMachine.prototype);\n        for (let i = 0, n = names.length; i < n; i++) {\n            const name = names[i];\n            if (name !== \"constructor\") {\n                const descriptor = Object.getOwnPropertyDescriptor(StateMachine.prototype, name);\n                Object.defineProperty(router.prototype, name, descriptor);\n            }\n        }\n    }\n\n    _addStateMemberDelegatorsToRouter() {\n        const members = this._getAllMemberNames();\n\n        members.forEach(member => {\n            this._addMemberRouter(member);\n        });\n    }\n\n    /**\n     * @note We are generating code because it yields much better performance.\n     */\n    _addMemberRouter(member) {\n        const statePaths = Object.keys(this._stateMap);\n        const descriptors = [];\n        const aliases = [];\n        statePaths.forEach((statePath, index) => {\n            const state = this._stateMap[statePath];\n            const descriptor = this._getDescriptor(state, member);\n            if (descriptor) {\n                descriptors[index] = descriptor;\n\n                // Add to prototype.\n                const alias = StateMachineType.getStateMemberAlias(descriptor._source.__path, member);\n                aliases[index] = alias;\n\n                if (!this._router.prototype.hasOwnProperty(alias)) {\n                    Object.defineProperty(this._router.prototype, alias, descriptor);\n                }\n            } else {\n                descriptors[index] = null;\n                aliases[index] = null;\n            }\n        });\n\n        let type = undefined;\n        descriptors.forEach(descriptor => {\n            if (descriptor) {\n                const descType = this._getDescriptorType(descriptor);\n                if (type && (type !== descType)) {\n                    console.warn(`[Lightning] Member ${member} in ${this._type.name} has inconsistent types.`);\n                    return;\n                }\n                type = descType;\n            }\n        });\n\n        switch(type) {\n            case \"method\":\n                this._addMethodRouter(member, descriptors, aliases);\n                break;\n            case \"getter\":\n                this._addGetterSetterRouters(member);\n                break;\n            case \"property\":\n                console.warn(\"[Lightning] Fixed properties are not supported; please use a getter instead!\")\n                break;\n        }\n    }\n\n    _getDescriptor(state, member, isValid = () => true) {\n        let type = state;\n        let curState = state;\n\n        do {\n            const descriptor = Object.getOwnPropertyDescriptor(type.prototype, member);\n            if (descriptor) {\n                if (isValid(descriptor)) {\n                    descriptor._source = curState;\n                    return descriptor;\n                }\n            }\n            type = Object.getPrototypeOf(type);\n            if (type && type.hasOwnProperty('__state')) {\n                curState = type;\n            }\n        } while(type && type.prototype);\n        return undefined;\n    }\n\n    _getDescriptorType(descriptor) {\n        if (descriptor.get || descriptor.set) {\n            return 'getter';\n        } else {\n            if (typeof descriptor.value === \"function\") {\n                return 'method';\n            } else {\n                return 'property';\n            }\n        }\n    }\n\n    static _supportsSpread() {\n        if (this.__supportsSpread === undefined) {\n            this.__supportsSpread = false;\n            try {\n                const func = new Function(\"return [].concat(...arguments);\");\n                func();\n                this.__supportsSpread = true;\n            } catch(e) {}\n        }\n        return this.__supportsSpread;\n    }\n\n    _addMethodRouter(member, descriptors, aliases) {\n        const code = [\n            // The line ensures that, while debugging, your IDE won't open many tabs.\n            \"//@ sourceURL=StateMachineRouter.js\",\n            \"var i = this._stateIndex;\"\n        ];\n        let cur = aliases[0];\n        const supportsSpread = StateMachineType._supportsSpread();\n        for (let i = 1, n = aliases.length; i < n; i++) {\n            const alias = aliases[i];\n            if (alias !== cur) {\n                if (cur) {\n                    if (supportsSpread) {\n                        code.push(`if (i < ${i}) return this[\"${cur}\"](...arguments); else`);\n                    } else {\n                        code.push(`if (i < ${i}) return this[\"${cur}\"].apply(this, arguments); else`);\n                    }\n                } else {\n                    code.push(`if (i < ${i}) return ; else`);\n                }\n            }\n            cur = alias;\n        }\n        if (cur) {\n            if (supportsSpread) {\n                code.push(`return this[\"${cur}\"](...arguments);`);\n            } else {\n                code.push(`return this[\"${cur}\"].apply(this, arguments);`);\n            }\n        } else {\n            code.push(`;`);\n        }\n        const functionBody = code.join(\"\\n\");\n        const router = new Function([], functionBody);\n\n        const descriptor = {value: router};\n        Object.defineProperty(this._router.prototype, member, descriptor);\n    }\n\n    _addGetterSetterRouters(member) {\n        const getter = this._getGetterRouter(member);\n        const setter = this._getSetterRouter(member);\n        const descriptor = {\n            get: getter,\n            set: setter\n        };\n        Object.defineProperty(this._router.prototype, member, descriptor);\n    }\n\n    _getGetterRouter(member) {\n        const statePaths = Object.keys(this._stateMap);\n        const descriptors = [];\n        const aliases = [];\n        statePaths.forEach((statePath, index) => {\n            const state = this._stateMap[statePath];\n            const descriptor = this._getDescriptor(state, member, (descriptor => descriptor.get));\n            if (descriptor) {\n                descriptors[index] = descriptor;\n\n                // Add to prototype.\n                const alias = StateMachineType.getStateMemberAlias(descriptor._source.__path, member);\n                aliases[index] = alias;\n\n                if (!this._router.prototype.hasOwnProperty(alias)) {\n                    Object.defineProperty(this._router.prototype, alias, descriptor);\n                }\n            } else {\n                descriptors[index] = null;\n                aliases[index] = null;\n            }\n        });\n\n        const code = [\n            // The line ensures that, while debugging, your IDE won't open many tabs.\n            \"//@ sourceURL=StateMachineRouter.js\",\n            \"var i = this._stateIndex;\"\n        ];\n        let cur = aliases[0];\n        for (let i = 1, n = aliases.length; i < n; i++) {\n            const alias = aliases[i];\n            if (alias !== cur) {\n                if (cur) {\n                    code.push(`if (i < ${i}) return this[\"${cur}\"]; else`);\n                } else {\n                    code.push(`if (i < ${i}) return ; else`);\n                }\n            }\n            cur = alias;\n        }\n        if (cur) {\n            code.push(`return this[\"${cur}\"];`);\n        } else {\n            code.push(`;`);\n        }\n        const functionBody = code.join(\"\\n\");\n        const router = new Function([], functionBody);\n        return router;\n    }\n\n    _getSetterRouter(member) {\n        const statePaths = Object.keys(this._stateMap);\n        const descriptors = [];\n        const aliases = [];\n        statePaths.forEach((statePath, index) => {\n            const state = this._stateMap[statePath];\n            const descriptor = this._getDescriptor(state, member, (descriptor => descriptor.set));\n            if (descriptor) {\n                descriptors[index] = descriptor;\n\n                // Add to prototype.\n                const alias = StateMachineType.getStateMemberAlias(descriptor._source.__path, member);\n                aliases[index] = alias;\n\n                if (!this._router.prototype.hasOwnProperty(alias)) {\n                    Object.defineProperty(this._router.prototype, alias, descriptor);\n                }\n            } else {\n                descriptors[index] = null;\n                aliases[index] = null;\n            }\n        });\n\n        const code = [\n            // The line ensures that, while debugging, your IDE won't open many tabs.\n            \"//@ sourceURL=StateMachineRouter.js\",\n            \"var i = this._stateIndex;\"\n        ];\n        let cur = aliases[0];\n        for (let i = 1, n = aliases.length; i < n; i++) {\n            const alias = aliases[i];\n            if (alias !== cur) {\n                if (cur) {\n                    code.push(`if (i < ${i}) this[\"${cur}\"] = arg; else`);\n                } else {\n                    code.push(`if (i < ${i}) ; else`);\n                }\n            }\n            cur = alias;\n        }\n        if (cur) {\n            code.push(`this[\"${cur}\"] = arg;`);\n        } else {\n            code.push(`;`);\n        }\n        const functionBody = code.join(\"\\n\");\n        const router = new Function([\"arg\"], functionBody);\n        return router;\n    }\n\n    static getStateMemberAlias(path, member) {\n        return \"$\" + (path ? path + \".\" : \"\") + member;\n    }\n\n    _getAllMemberNames() {\n        const stateMap = this._stateMap;\n        const map = Object.keys(stateMap);\n        let members = new Set();\n        map.forEach(statePath => {\n            if (statePath === \"\") {\n                // Root state can be skipped: if the method only occurs in the root state, we don't need to re-delegate it based on state.\n                return;\n            }\n            const state = stateMap[statePath];\n            const names = this._getStateMemberNames(state);\n            names.forEach(name => {\n                members.add(name);\n            })\n        });\n        return [...members];\n    }\n\n    _getStateMemberNames(state) {\n        let type = state;\n        let members = new Set();\n        const isRoot = this._type === state;\n        do {\n            const names = this._getStateMemberNamesForType(type);\n            names.forEach(name => {\n                members.add(name)\n            });\n\n            type = Object.getPrototypeOf(type);\n        } while(type && type.prototype && (!type.hasOwnProperty(\"__state\") || isRoot));\n\n        return members;\n    }\n\n    _getStateMemberNamesForType(type) {\n        const memberNames = Object.getOwnPropertyNames(type.prototype);\n        return memberNames.filter(memberName => {\n            return (memberName !== \"constructor\") && !StateMachineType._isStateLocalMember(memberName);\n        });\n    }\n\n    static _isStateLocalMember(memberName) {\n        return (memberName === \"$enter\") || (memberName === \"$exit\");\n    }\n\n    getStateByPath(statePath) {\n        if (this._stateMap[statePath]) {\n            return this._stateMap[statePath];\n        }\n\n        // Search for closest match.\n        const parts = statePath.split(\".\");\n        while(parts.pop()) {\n            const statePath = parts.join(\".\");\n            if (this._stateMap[statePath]) {\n                return this._stateMap[statePath];\n            }\n        }\n    }\n\n    _getStateMap() {\n        if (!this._stateMap) {\n            this._stateMap = this._createStateMap();\n        }\n        return this._stateMap;\n    }\n\n    _createStateMap() {\n        const stateMap = {};\n        this._addState(this._type, null, \"\", stateMap);\n        return stateMap;\n    }\n\n    _addState(state, parentState, name, stateMap) {\n        state.__state = true;\n        state.__name = name;\n\n        this._addStaticStateProperty(state, parentState);\n\n        const parentPath = (parentState ? parentState.__path : \"\");\n        let path = (parentPath ? parentPath + \".\" : \"\") + name;\n        state.__path = path;\n        state.__level = parentState ? parentState.__level + 1 : 0;\n        state.__parent = parentState;\n        state.__index = Object.keys(stateMap).length;\n        stateMap[path] = state;\n\n        const states = state._states;\n        if (states) {\n            const isInheritedFromParent = (parentState && parentState._states === states);\n            if (!isInheritedFromParent) {\n                const subStates = state._states();\n                subStates.forEach(subState => {\n                    const stateName = StateMachineType._getStateName(subState);\n                    this._addState(subState, state, stateName, stateMap);\n                });\n            }\n        }\n    }\n\n    static _getStateName(state) {\n        const name = state.name;\n\n        const index = name.indexOf('$');\n        if (index > 0) {\n            // Strip off rollup name suffix.\n            return name.substr(0, index);\n        }\n\n        return name;\n    }\n\n    _addStaticStateProperty(state, parentState) {\n        if (parentState) {\n            const isClassStateLevel = parentState && !parentState.__parent;\n            if (isClassStateLevel) {\n                this._router[state.__name] = state;\n            } else {\n                parentState[state.__name] = state;\n            }\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Element from \"../tree/Element.mjs\";\nimport Utils from \"../tree/Utils.mjs\";\nimport StateMachine from \"./StateMachine.mjs\";\n\n/**\n * @extends StateMachine\n */\nexport default class Component extends Element {\n\n    constructor(stage, properties) {\n        super(stage);\n\n        // Encapsulate tags to prevent leaking.\n        this.tagRoot = true;\n\n        if (Utils.isObjectLiteral(properties)) {\n            Object.assign(this, properties);\n        }\n\n        this.__initialized = false;\n        this.__firstActive = false;\n        this.__firstEnable = false;\n\n        this.__signals = undefined;\n\n        this.__passSignals = undefined;\n\n        this.__construct();\n\n        // Quick-apply template.\n        const func = this.constructor.getTemplateFunc(this);\n        func.f(this, func.a);\n\n        this._build();\n    }\n\n    __start() {\n        StateMachine.setupStateMachine(this);\n        this._onStateChange = Component.prototype.__onStateChange;\n    }\n\n    get state() {\n        return this._getState();\n    }\n\n    __onStateChange() {\n        /* FIXME: Workaround for case, where application was shut but component still lives */\n        if (this.application) {\n            this.application.updateFocusPath();\n        }\n    }\n\n    _refocus() {\n        /* FIXME: Workaround for case, where application was shut but component still lives */\n        if (this.application) {\n            this.application.updateFocusPath();\n        }\n    }\n\n    static bindProp(name, func = null) {\n        return {__propertyBinding: true, __name: name, __func: func};\n    }\n\n    __bindProperty(propObj, targetObj, targetProp) {\n        // 1. find binding position: find object and property name to be bound\n        const obj = targetObj;\n        const prop = targetProp;\n        const propDependencies = Array.isArray(propObj.__name) ? propObj.__name : [propObj.__name];\n\n        // 2. create setters for every given dependency\n        for (let i = 0; i < propDependencies.length; i++) {\n            const propName = propDependencies[i];\n            const func = propObj.__func ? propObj.__func : (context) => context[propName];\n\n            if (!this.hasOwnProperty(propName)) {\n                this[`__prop_bindings_${propName}`] = [{__obj: obj, __prop: prop, __func: func}];\n                Object.defineProperty(this, propName, {\n                    set: (value) => {\n                        this[`__prop_${propName}`] = value;\n                        for (const {__obj, __prop, __func} of this[`__prop_bindings_${propName}`]) {\n                            __obj[__prop] = __func(this);\n                        }\n                    },\n                    get: () => this[`__prop_${propName}`]\n                });\n            } else {\n                this[`__prop_bindings_${propName}`].push({__obj: obj, __prop: prop, __func: func});\n            }\n        }\n    }\n\n    /**\n     * Returns a high-performance template patcher.\n     */\n    static getTemplateFunc(ctx) {\n        // We need a different template function per patch id.\n        const name = \"_templateFunc\";\n\n        // Be careful with class-based static inheritance.\n        const hasName = '__has' + name;\n        if (this[hasName] !== this) {\n            this[hasName] = this;\n            this[name] = this.parseTemplate(this._template(ctx));\n        }\n        return this[name];\n    }\n\n    static parseTemplate(obj) {\n        const context = {\n            loc: [],\n            store: [],\n            rid: 0\n        };\n\n        this.parseTemplateRec(obj, context, \"element\");\n\n        const code = context.loc.join(\";\\n\");\n        const f = new Function(\"element\", \"store\", code);\n        return {f: f, a: context.store};\n    }\n\n    static parseTemplateRec(obj, context, cursor) {\n        const store = context.store;\n        const loc = context.loc;\n        const keys = Object.keys(obj);\n        keys.forEach(key => {\n            let value = obj[key];\n            if (Utils.isUcChar(key.charCodeAt(0))) {\n                // Value must be expanded as well.\n                if (Utils.isObjectLiteral(value)) {\n                    // Ref.\n                    const childCursor = `r${key.replace(/[^a-z0-9]/gi, \"\") + context.rid}`;\n                    let type = value.type ? value.type : Element;\n                    if (type === Element) {\n                        loc.push(`var ${childCursor} = element.stage.createElement()`);\n                    } else {\n                        store.push(type);\n                        loc.push(`var ${childCursor} = new store[${store.length - 1}](${cursor}.stage)`);\n                    }\n                    loc.push(`${childCursor}.ref = \"${key}\"`);\n                    context.rid++;\n\n                    // Enter sub.\n                    this.parseTemplateRec(value, context, childCursor);\n\n                    loc.push(`${cursor}.childList.add(${childCursor})`);\n                } else if (Utils.isObject(value)) {\n                    // Dynamic assignment.\n                    store.push(value);\n                    loc.push(`${cursor}.childList.add(store[${store.length - 1}])`);\n                }\n            } else {\n                if (key === \"text\") {\n                    const propKey = cursor + \"__text\";\n                    loc.push(`var ${propKey} = ${cursor}.enableTextTexture()`);\n                    if (value.__propertyBinding === true) {\n                        // Allow binding entire objects to text property\n                        store.push(value);\n                        loc.push(`element.__bindProperty(store[${store.length - 1}], ${cursor}, \"${key}\")`);\n                    } else {\n                        this.parseTemplatePropRec(value, context, propKey);\n                    }\n                } else if (key === \"shader\" && Utils.isObjectLiteral(value)) {\n                    const shaderCursor = `${cursor}[\"shader\"]`\n                    store.push(value);\n                    loc.push(`${cursor}[\"${key}\"] = store[${store.length - 1}]`);\n                    this.parsePropertyBindings(value, context, shaderCursor);\n                } else if (key === \"texture\" && Utils.isObjectLiteral(value)) {\n                    const propKey = cursor + \"__texture\";\n                    const type = value.type;\n                    if (type) {\n                        store.push(type);\n                        loc.push(`var ${propKey} = new store[${store.length - 1}](${cursor}.stage)`);\n                        this.parseTemplatePropRec(value, context, propKey);\n                        loc.push(`${cursor}[\"${key}\"] = ${propKey}`);\n                    } else {\n                        loc.push(`${propKey} = ${cursor}.texture`);\n                        this.parseTemplatePropRec(value, context, propKey);\n                    }\n                } else if (Utils.isObjectLiteral(value) && value.__propertyBinding === true) {\n                    store.push(value);\n                    loc.push(`element.__bindProperty(store[${store.length - 1}], ${cursor}, \"${key}\")`);\n                } else {\n                    // Property;\n                    if (Utils.isNumber(value)) {\n                        loc.push(`${cursor}[\"${key}\"] = ${value}`);\n                    } else if (Utils.isBoolean(value)) {\n                        loc.push(`${cursor}[\"${key}\"] = ${value ? \"true\" : \"false\"}`);\n                    } else if (Utils.isObject(value) || Array.isArray(value)) {\n                        // Dynamic assignment.\n                        // Because literal objects may contain dynamics, we store the full object.\n                        store.push(value);\n                        loc.push(`${cursor}[\"${key}\"] = store[${store.length - 1}]`);\n                    } else {\n                        // String etc.\n                        loc.push(`${cursor}[\"${key}\"] = ${JSON.stringify(value)}`);\n                    }\n                }\n            }\n        });\n    }\n\n    static parseTemplatePropRec(obj, context, cursor) {\n        const store = context.store;\n        const loc = context.loc;\n        const keys = Object.keys(obj);\n        keys.forEach(key => {\n            if (key !== \"type\") {\n                const value = obj[key];\n                if (Utils.isNumber(value)) {\n                    loc.push(`${cursor}[\"${key}\"] = ${value}`);\n                } else if (Utils.isBoolean(value)) {\n                    loc.push(`${cursor}[\"${key}\"] = ${value ? \"true\" : \"false\"}`);\n                } else if (Utils.isObject(value) && value.__propertyBinding === true) {\n                    store.push(value);\n                    loc.push(`element.__bindProperty(store[${store.length - 1}], ${cursor}, \"${key}\")`);\n                } else if (Utils.isObject(value) || Array.isArray(value)) {\n                    // Dynamic assignment.\n                    // Because literal objects may contain dynamics, we store the full object.\n                    store.push(value);\n                    loc.push(`${cursor}[\"${key}\"] = store[${store.length - 1}]`);\n                } else {\n                    // String etc.\n                    loc.push(`${cursor}[\"${key}\"] = ${JSON.stringify(value)}`);\n                }\n            }\n        });\n    }\n\n    static parsePropertyBindings(obj, context, cursor) {\n        const store = context.store;\n        const loc = context.loc;\n        const keys = Object.keys(obj);\n        keys.forEach(key => {\n            if (key !== \"type\") {\n                const value = obj[key];\n                if (Utils.isObjectLiteral(value) && value.__propertyBinding === true) {\n                    store.push(value);\n                    loc.push(`element.__bindProperty(store[${store.length - 1}], ${cursor}, \"${key}\")`);\n                }\n            }\n        });\n    }\n\n    _onSetup() {\n        if (!this.__initialized) {\n            this._setup();\n        }\n    }\n\n    _setup() {\n    }\n\n    _onAttach() {\n        if (!this.__initialized) {\n            this.__init();\n            this.__initialized = true;\n        }\n\n        this._attach();\n    }\n\n    _attach() {\n    }\n\n    _onDetach() {\n        this._detach();\n    }\n\n    _detach() {\n    }\n\n    _onEnabled() {\n        if (!this.__firstEnable) {\n            this._firstEnable();\n            this.__firstEnable = true;\n        }\n\n        this._enable();\n    }\n\n    _firstEnable() {\n    }\n\n    _enable() {\n    }\n\n    _onDisabled() {\n        this._disable();\n    }\n\n    _disable() {\n    }\n\n    _onActive() {\n        if (!this.__firstActive) {\n            this._firstActive();\n            this.__firstActive = true;\n        }\n\n        this._active();\n    }\n\n    _firstActive() {\n    }\n\n    _active() {\n    }\n\n    _onInactive() {\n        this._inactive();\n    }\n\n    _inactive() {\n    }\n\n    get application() {\n        return this.stage.application;\n    }\n\n    __construct() {\n        this._construct();\n    }\n\n    _construct() {\n    }\n\n    _build() {\n    }\n\n    __init() {\n        this._init();\n    }\n\n    _init() {\n    }\n\n    _focus(newTarget, prevTarget) {\n    }\n\n    _unfocus(newTarget) {\n    }\n\n    _focusChange(target, newTarget) {\n    }\n\n    _getFocused() {\n        // Override to delegate focus to child components.\n        return this;\n    }\n\n    _setFocusSettings(settings) {\n        // Override to add custom settings. See Application._handleFocusSettings().\n    }\n\n    _handleFocusSettings(settings) {\n        // Override to react on custom settings. See Application._handleFocusSettings().\n    }\n\n    static _template() {\n        return {};\n    }\n\n    hasFinalFocus() {\n        let path = this.application._focusPath;\n        return path && path.length && path[path.length - 1] === this;\n    }\n\n    hasFocus() {\n        let path = this.application._focusPath;\n        return path && (path.indexOf(this) >= 0);\n    }\n\n    get cparent() {\n        return Component.getParent(this);\n    }\n\n    seekAncestorByType(type) {\n        let c = this.cparent;\n        while (c) {\n            if (c.constructor === type) {\n                return c;\n            }\n            c = c.cparent;\n        }\n    }\n\n    getSharedAncestorComponent(element) {\n        let ancestor = this.getSharedAncestor(element);\n        while (ancestor && !ancestor.isComponent) {\n            ancestor = ancestor.parent;\n        }\n        return ancestor;\n    }\n\n    get signals() {\n        return this.__signals;\n    }\n\n    set signals(v) {\n        if (!Utils.isObjectLiteral(v)) {\n            this._throwError(\"Signals: specify an object with signal-to-fire mappings\");\n        }\n        this.__signals = v;\n    }\n\n    set alterSignals(v) {\n        if (!Utils.isObjectLiteral(v)) {\n            this._throwError(\"Signals: specify an object with signal-to-fire mappings\");\n        }\n        if (!this.__signals) {\n            this.__signals = {};\n        }\n        for (let key in v) {\n            const d = v[key];\n            if (d === undefined) {\n                delete this.__signals[key];\n            } else {\n                this.__signals[key] = v;\n            }\n        }\n    }\n\n    get passSignals() {\n        return this.__passSignals || {};\n    }\n\n    set passSignals(v) {\n        this.__passSignals = Object.assign(this.__passSignals || {}, v);\n    }\n\n    set alterPassSignals(v) {\n        if (!Utils.isObjectLiteral(v)) {\n            this._throwError(\"Signals: specify an object with signal-to-fire mappings\");\n        }\n        if (!this.__passSignals) {\n            this.__passSignals = {};\n        }\n        for (let key in v) {\n            const d = v[key];\n            if (d === undefined) {\n                delete this.__passSignals[key];\n            } else {\n                this.__passSignals[key] = v;\n            }\n        }\n    }\n\n    /**\n     * Signals the parent of the specified event.\n     * A parent/ancestor that wishes to handle the signal should set the 'signals' property on this component.\n     * @param {string} event\n     * @param {...*} args\n     */\n    signal(event, ...args) {\n        return this._signal(event, args);\n    }\n\n    _signal(event, args) {\n        const signalParent = this._getParentSignalHandler();\n        if (signalParent) {\n            if (this.__signals) {\n                let fireEvent = this.__signals[event];\n                if (fireEvent === false) {\n                    // Ignore event.\n                    return;\n                }\n                if (fireEvent) {\n                    if (fireEvent === true) {\n                        fireEvent = event;\n                    }\n \n                    if (Utils.isFunction(fireEvent)) {\n                        return fireEvent(...args);\n                    }\n\n                    if (signalParent._hasMethod(fireEvent)) {\n                        return signalParent[fireEvent](...args);\n                    }\n                }\n            }\n\n            let passSignal = (this.__passSignals && this.__passSignals[event]);\n            if (passSignal) {\n                // Bubble up.\n                if (passSignal && passSignal !== true) {\n                    // Replace signal name.\n                    event = passSignal;\n                }\n\n                return signalParent._signal(event, args);\n            }\n        }\n    }\n\n    _getParentSignalHandler() {\n        return this.cparent ? this.cparent._getSignalHandler() : null;\n    }\n\n    _getSignalHandler() {\n        if (this._signalProxy) {\n            return this.cparent ? this.cparent._getSignalHandler() : null;\n        }\n        return this;\n    }\n\n    get _signalProxy() {\n        return false;\n    }\n\n    fireAncestors(name, ...args) {\n        if (!name.startsWith('$')) {\n            throw new Error(\"Ancestor event name must be prefixed by dollar sign.\");\n        }\n\n        const parent = this._getParentSignalHandler();\n        if (parent) {\n            return parent._doFireAncestors(name, args);\n        }\n    }\n\n    _doFireAncestors(name, args) {\n        if (this._hasMethod(name)) {\n            return this.fire(name, ...args);\n        } else {\n            const signalParent = this._getParentSignalHandler();\n            if (signalParent) {\n                return signalParent._doFireAncestors(name, args);\n            }\n        }\n    }\n\n    static collectSubComponents(subs, element) {\n        if (element.hasChildren()) {\n            const childList = element.__childList;\n            for (let i = 0, n = childList.length; i < n; i++) {\n                const child = childList.getAt(i);\n                if (child.isComponent) {\n                    subs.push(child);\n                } else {\n                    Component.collectSubComponents(subs, child);\n                }\n            }\n        }\n    }\n\n    static getComponent(element) {\n        let parent = element;\n        while (parent && !parent.isComponent) {\n            parent = parent.parent;\n        }\n        return parent;\n    }\n\n    static getParent(element) {\n        return Component.getComponent(element.parent);\n    }\n}\n\nComponent.prototype.isComponent = true;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class CoreQuadList {\n\n    constructor(ctx) {\n\n        this.ctx = ctx;\n\n        this.quadTextures = [];\n\n        this.quadElements = [];\n    }\n\n    get length() {\n        return this.quadTextures.length;\n    }\n\n    reset() {\n        this.quadTextures = [];\n        this.quadElements = [];\n        this.dataLength = 0;\n    }\n\n    getElement(index) {\n        return this.quadElements[index]._element;\n    }\n\n    getElementCore(index) {\n        return this.quadElements[index];\n    }\n\n    getTexture(index) {\n        return this.quadTextures[index];\n    }\n\n    getTextureWidth(index) {\n        let nativeTexture = this.quadTextures[index];\n        if (nativeTexture.w) {\n            // Render texture;\n            return nativeTexture.w;\n        } else {\n            return this.quadElements[index]._displayedTextureSource.w;\n        }\n    }\n\n    getTextureHeight(index) {\n        let nativeTexture = this.quadTextures[index];\n        if (nativeTexture.h) {\n            // Render texture;\n            return nativeTexture.h;\n        } else {\n            return this.quadElements[index]._displayedTextureSource.h;\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CoreQuadList from \"../../tree/core/CoreQuadList.mjs\";\n\nexport default class WebGLCoreQuadList extends CoreQuadList {\n\n    constructor(ctx) {\n        super(ctx);\n\n        // Allocate a fairly big chunk of memory that should be enough to support ~100000 (default) quads.\n        // We do not (want to) handle memory overflow.\n        const byteSize = ctx.stage.getOption('bufferMemory');\n\n        this.dataLength = 0;\n\n        this.data = new ArrayBuffer(byteSize);\n        this.floats = new Float32Array(this.data);\n        this.uints = new Uint32Array(this.data);\n    }\n\n    getAttribsDataByteOffset(index) {\n        // Where this quad can be found in the attribs buffer.\n        return index * 80;\n    }\n\n    getQuadContents() {\n        // Debug: log contents of quad buffer.\n        let floats = this.floats;\n        let uints = this.uints;\n        let lines = [];\n        for (let i = 1; i <= this.length; i++) {\n            let str = 'entry ' + i + ': ';\n            for (let j = 0; j < 4; j++) {\n                let b = i * 20 + j * 4;\n                str += floats[b] + ',' + floats[b+1] + ':' + floats[b+2] + ',' + floats[b+3] + '[' + uints[b+4].toString(16) + '] ';\n            }\n            lines.push(str);\n        }\n\n        return lines;\n    }\n\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nexport default class CoreQuadOperation {\n\n    constructor(ctx, shader, shaderOwner, renderTextureInfo, scissor, index) {\n\n        this.ctx = ctx;\n        this.shader = shader;\n        this.shaderOwner = shaderOwner;\n        this.renderTextureInfo = renderTextureInfo;\n        this.scissor = scissor;\n        this.index = index;\n        this.length = 0;\n\n    }\n\n    get quads() {\n        return this.ctx.renderState.quads;\n    }\n\n    getTexture(index) {\n        return this.quads.getTexture(this.index + index);\n    }\n\n    getElementCore(index) {\n        return this.quads.getElementCore(this.index + index);\n    }\n\n    getElement(index) {\n        return this.quads.getElement(this.index + index);\n    }\n\n    getElementWidth(index) {\n        return this.getElement(index).renderWidth;\n    }\n\n    getElementHeight(index) {\n        return this.getElement(index).renderHeight;\n    }\n\n    getTextureWidth(index) {\n        return this.quads.getTextureWidth(this.index + index);\n    }\n\n    getTextureHeight(index) {\n        return this.quads.getTextureHeight(this.index + index);\n    }\n\n    getRenderWidth() {\n        if (this.renderTextureInfo) {\n            return this.renderTextureInfo.w;\n        } else {\n            return this.ctx.stage.w;\n        }\n    }\n\n    getRenderHeight() {\n        if (this.renderTextureInfo) {\n            return this.renderTextureInfo.h;\n        } else {\n            return this.ctx.stage.h;\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CoreQuadOperation from \"../../tree/core/CoreQuadOperation.mjs\";\n\nexport default class WebGLCoreQuadOperation extends CoreQuadOperation {\n\n    constructor(ctx, shader, shaderOwner, renderTextureInfo, scissor, index) {\n        super(ctx, shader, shaderOwner, renderTextureInfo, scissor, index);\n\n        this.extraAttribsDataByteOffset = 0;\n    }\n\n    getAttribsDataByteOffset(index) {\n        // Where this quad can be found in the attribs buffer.\n        return this.quads.getAttribsDataByteOffset(this.index + index);\n    }\n\n    /**\n     * Returns the relative pixel coordinates in the shader owner to gl position coordinates in the render texture.\n     * @param x\n     * @param y\n     * @return {number[]}\n     */\n    getNormalRenderTextureCoords(x, y) {\n        let coords = this.shaderOwner.getRenderTextureCoords(x, y);\n        coords[0] /= this.getRenderWidth();\n        coords[1] /= this.getRenderHeight();\n        coords[0] = coords[0] * 2 - 1;\n        coords[1] = 1 - coords[1] * 2;\n        return coords;\n    }\n\n    getProjection() {\n        if (this.renderTextureInfo === null) {\n            return this.ctx.renderExec._projection;\n        } else {\n            return this.renderTextureInfo.nativeTexture.projection;\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nexport default class CoreRenderExecutor {\n\n    constructor(ctx) {\n        this.ctx = ctx;\n\n        this.renderState = ctx.renderState;\n\n        this.gl = this.ctx.stage.gl;\n    }\n\n    destroy() {\n        this.ctx = null;\n        this.renderState = null;\n        this.gl = null;\n\n        delete this.ctx;\n        delete this.renderState;\n        delete this.gl;\n    }\n\n    _reset() {\n        this._bindRenderTexture(null);\n        this._setScissor(null);\n        this._clearRenderTexture();\n    }\n\n    execute() {\n        this._reset();\n\n        let qops = this.renderState.quadOperations;\n\n        let i = 0, j = 0, n = qops.length;\n        while (i < n) {\n            this._processQuadOperation(qops[i]);\n            i++;\n        }\n    }\n\n    _processQuadOperation(quadOperation) {\n        if (quadOperation.renderTextureInfo && quadOperation.renderTextureInfo.ignore) {\n            // Ignore quad operations when we are 're-using' another texture as the render texture result.\n            return;\n        }\n\n        this._setupQuadOperation(quadOperation);\n        this._execQuadOperation(quadOperation);\n\n    }\n\n    _setupQuadOperation(quadOperation) {\n    }\n\n    _execQuadOperation(op) {\n        // Set render texture.\n        let nativeTexture = op.renderTextureInfo ? op.renderTextureInfo.nativeTexture : null;\n\n        if (this._renderTexture !== nativeTexture) {\n            this._bindRenderTexture(nativeTexture);\n        }\n\n        if (op.renderTextureInfo && !op.renderTextureInfo.cleared) {\n            this._setScissor(null);\n            this._clearRenderTexture();\n            op.renderTextureInfo.cleared = true;\n            this._setScissor(op.scissor);\n        } else {\n            this._setScissor(op.scissor);\n        }\n\n        this._renderQuadOperation(op);\n    }\n\n    _renderQuadOperation(op) {\n    }\n\n    _bindRenderTexture(renderTexture) {\n        this._renderTexture = renderTexture;\n    }\n\n    _clearRenderTexture(renderTexture) {\n    }\n\n    _setScissor(area) {\n    }\n\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CoreRenderExecutor from \"../../tree/core/CoreRenderExecutor.mjs\";\n\nexport default class WebGLCoreRenderExecutor extends CoreRenderExecutor {\n\n    constructor(ctx) {\n        super(ctx)\n\n        this.gl = this.ctx.stage.gl;\n\n        this.init();\n    }\n\n    init() {\n        let gl = this.gl;\n\n        // Create new sharable buffer for params.\n        this._attribsBuffer = gl.createBuffer();\n\n        let maxQuads = Math.floor(this.renderState.quads.data.byteLength / 80);\n\n        // Init webgl arrays.\n        let allIndices = new Uint16Array(maxQuads * 6);\n\n        // fill the indices with the quads to draw.\n        for (let i = 0, j = 0; i < maxQuads; i += 6, j += 4) {\n            allIndices[i] = j;\n            allIndices[i + 1] = j + 1;\n            allIndices[i + 2] = j + 2;\n            allIndices[i + 3] = j;\n            allIndices[i + 4] = j + 2;\n            allIndices[i + 5] = j + 3;\n        }\n\n        // The quads buffer can be (re)used to draw a range of quads.\n        this._quadsBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._quadsBuffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, allIndices, gl.STATIC_DRAW);\n\n        // The matrix that causes the [0,0 - W,H] box to map to [-1,-1 - 1,1] in the end results.\n        this._projection = new Float32Array([2/this.ctx.stage.coordsWidth, -2/this.ctx.stage.coordsHeight]);\n\n    }\n\n    destroy() {\n        super.destroy();\n        this.gl.deleteBuffer(this._attribsBuffer);\n        this.gl.deleteBuffer(this._quadsBuffer);\n\n        this.gl = null;\n        delete this.gl;\n    }\n\n    _reset() {\n        super._reset();\n\n        let gl = this.gl;\n        gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n        gl.enable(gl.BLEND);\n        gl.disable(gl.DEPTH_TEST);\n\n        this._stopShaderProgram();\n        this._setupBuffers();\n    }\n\n    _setupBuffers() {\n        let gl = this.gl;\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._quadsBuffer);\n        let element = new Float32Array(this.renderState.quads.data, 0, this.renderState.quads.dataLength);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._attribsBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, element, gl.DYNAMIC_DRAW);\n    }\n\n    _setupQuadOperation(quadOperation) {\n        super._setupQuadOperation(quadOperation);\n        this._useShaderProgram(quadOperation.shader, quadOperation);\n    }\n\n    _renderQuadOperation(op) {\n        let shader = op.shader;\n\n        if (op.length || op.shader.addEmpty()) {\n            shader.beforeDraw(op);\n            shader.draw(op);\n            shader.afterDraw(op);\n        }\n    }\n\n    /**\n     * @param {WebGLShader} shader;\n     * @param {CoreQuadOperation} operation;\n     */\n    _useShaderProgram(shader, operation) {\n        if (!shader.hasSameProgram(this._currentShaderProgram)) {\n            if (this._currentShaderProgram) {\n                this._currentShaderProgram.stopProgram();\n            }\n            shader.useProgram();\n            this._currentShaderProgram = shader;\n        }\n        shader.setupUniforms(operation);\n    }\n\n    _stopShaderProgram() {\n        if (this._currentShaderProgram) {\n            // The currently used shader program should be stopped gracefully.\n            this._currentShaderProgram.stopProgram();\n            this._currentShaderProgram = null;\n        }\n    }\n\n    _bindRenderTexture(renderTexture) {\n        super._bindRenderTexture(renderTexture);\n\n        let gl = this.gl;\n        if (!this._renderTexture) {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n            gl.viewport(0,0,this.ctx.stage.w,this.ctx.stage.h);\n        } else {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this._renderTexture.framebuffer);\n            gl.viewport(0,0,this._renderTexture.w, this._renderTexture.h);\n        }\n    }\n\n    _clearRenderTexture() {\n        super._clearRenderTexture();\n        let gl = this.gl;\n        if (!this._renderTexture) {\n            let glClearColor = this.ctx.stage.getClearColor();\n            if (glClearColor) {\n                gl.clearColor(glClearColor[0] * glClearColor[3], glClearColor[1] * glClearColor[3], glClearColor[2] * glClearColor[3], glClearColor[3]);\n                gl.clear(gl.COLOR_BUFFER_BIT);\n            }\n        } else {\n            // Clear texture.\n            gl.clearColor(0, 0, 0, 0);\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n    }\n\n    _setScissor(area) {\n        super._setScissor(area);\n\n        if (this._scissor === area) {\n            return;\n        }\n        this._scissor = area;\n\n        let gl = this.gl;\n        if (!area) {\n            gl.disable(gl.SCISSOR_TEST);\n        } else {\n            gl.enable(gl.SCISSOR_TEST);\n            let precision = this.ctx.stage.getRenderPrecision();\n            let y = area[1];\n            if (this._renderTexture === null) {\n                // Flip.\n                y = (this.ctx.stage.h / precision - (area[1] + area[3]));\n            }\n            gl.scissor(Math.round(area[0] * precision), Math.round(y * precision), Math.round(area[2] * precision), Math.round(area[3] * precision));\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class CoreRenderState {\n\n    constructor(ctx) {\n        this.ctx = ctx;\n\n        this.stage = ctx.stage;\n\n        this.defaultShader = this.stage.renderer.getDefaultShader(ctx);\n\n        this.renderer = ctx.stage.renderer;\n\n        this.quads = this.renderer.createCoreQuadList(ctx);\n\n    }\n\n    reset() {\n        this._renderTextureInfo = null;\n\n        this._scissor = null;\n\n        this._shader = null;\n\n        this._shaderOwner = null;\n\n        this._realShader = null;\n\n        this._check = false;\n\n        this.quadOperations = [];\n\n        this._texturizer = null;\n\n        this._texturizerTemporary = false;\n\n        this._quadOperation = null;\n\n        this.quads.reset();\n\n        this._temporaryTexturizers = [];\n        \n        this._isCachingTexturizer = false;\n\n    }\n\n    get length() {\n        return this.quads.quadTextures.length;\n    }\n\n    setShader(shader, owner) {\n        if (this._shaderOwner !== owner || this._realShader !== shader) {\n            // Same shader owner: active shader is also the same.\n            // Prevent any shader usage to save performance.\n\n            this._realShader = shader;\n\n            if (shader.useDefault()) {\n                // Use the default shader when possible to prevent unnecessary program changes.\n                shader = this.defaultShader;\n            }\n            if (this._shader !== shader || this._shaderOwner !== owner) {\n                this._shader = shader;\n                this._shaderOwner = owner;\n                this._check = true;\n            }\n        }\n    }\n\n    get renderTextureInfo() {\n        return this._renderTextureInfo;\n    }\n\n    setScissor(area) {\n        if (this._scissor !== area) {\n            if (area) {\n                this._scissor = area;\n            } else {\n                this._scissor = null;\n            }\n            this._check = true;\n        }\n    }\n\n    getScissor() {\n        return this._scissor;\n    }\n\n    setRenderTextureInfo(renderTextureInfo) {\n        if (this._renderTextureInfo !== renderTextureInfo) {\n            this._renderTextureInfo = renderTextureInfo;\n            this._scissor = null;\n            this._check = true;\n        }\n    }\n\n    /**\n     * Sets the texturizer to be drawn during subsequent addQuads.\n     * @param {ElementTexturizer} texturizer\n     */\n    setTexturizer(texturizer, cache = false) {\n        this._texturizer = texturizer;\n        this._cacheTexturizer = cache;\n    }\n\n    set isCachingTexturizer(v) {\n        this._isCachingTexturizer = v;\n    }\n\n    get isCachingTexturizer() {\n        return this._isCachingTexturizer;\n    }\n\n    addQuad(elementCore) {\n        if (!this._quadOperation) {\n            this._createQuadOperation();\n        } else if (this._check && this._hasChanges()) {\n            this._finishQuadOperation();\n            this._check = false;\n        }\n\n        let nativeTexture = null;\n        if (this._texturizer) {\n            nativeTexture = this._texturizer.getResultTexture();\n\n            if (!this._cacheTexturizer) {\n                // We can release the temporary texture immediately after finalizing this quad operation.\n                this._temporaryTexturizers.push(this._texturizer);\n            }\n        }\n\n        if (!nativeTexture) {\n            nativeTexture = elementCore._displayedTextureSource.nativeTexture;\n        }\n\n        if (this._renderTextureInfo) {\n            if (this._shader === this.defaultShader && this._renderTextureInfo.empty) {\n                // The texture might be reusable under some conditions. We will check them in ElementCore.renderer.\n                this._renderTextureInfo.nativeTexture = nativeTexture;\n                this._renderTextureInfo.offset = this.length;\n            } else {\n                // It is not possible to reuse another texture when there is more than one quad.\n                this._renderTextureInfo.nativeTexture = null;\n            }\n            this._renderTextureInfo.empty = false;\n        }\n\n        this.quads.quadTextures.push(nativeTexture);\n        this.quads.quadElements.push(elementCore);\n\n        this._quadOperation.length++;\n\n        this.renderer.addQuad(this, this.quads, this.length - 1)\n    }\n\n    finishedRenderTexture() {\n        if (this._renderTextureInfo.nativeTexture) {\n            // There was only one texture drawn in this render texture.\n            // Check if we can reuse it so that we can optimize out an unnecessary render texture operation.\n            // (it should exactly span this render texture).\n            if (!this._isRenderTextureReusable()) {\n                this._renderTextureInfo.nativeTexture = null;\n            }\n        }\n    }\n\n    _isRenderTextureReusable() {\n        const offset = this._renderTextureInfo.offset;\n        return (this.quads.quadTextures[offset].w === this._renderTextureInfo.w) &&\n            (this.quads.quadTextures[offset].h === this._renderTextureInfo.h) &&\n            this.renderer.isRenderTextureReusable(this, this._renderTextureInfo)\n    }\n\n    _hasChanges() {\n        let q = this._quadOperation;\n        if (this._shader !== q.shader) return true;\n        if (this._shaderOwner !== q.shaderOwner) return true;\n        if (this._renderTextureInfo !== q.renderTextureInfo) return true;\n        if (this._scissor !== q.scissor) {\n            if ((this._scissor[0] !== q.scissor[0]) || (this._scissor[1] !== q.scissor[1]) || (this._scissor[2] !== q.scissor[2]) || (this._scissor[3] !== q.scissor[3])) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    _finishQuadOperation(create = true) {\n        if (this._quadOperation) {\n            if (this._quadOperation.length || this._shader.addEmpty()) {\n                if (!this._quadOperation.scissor || ((this._quadOperation.scissor[2] > 0) && (this._quadOperation.scissor[3] > 0))) {\n                    // Ignore empty clipping regions.\n                    this.quadOperations.push(this._quadOperation);\n                }\n            }\n\n            if (this._temporaryTexturizers.length) {\n                for (let i = 0, n = this._temporaryTexturizers.length; i < n; i++) {\n                    // We can now reuse these render-to-textures in subsequent stages.\n                    // Huge performance benefit when filtering (fast blur).\n                    this._temporaryTexturizers[i].releaseRenderTexture();\n                }\n                this._temporaryTexturizers = [];\n            }\n\n            this._quadOperation = null;\n        }\n\n        if (create) {\n            this._createQuadOperation();\n        }\n    }\n\n    _createQuadOperation() {\n        this._quadOperation = this.renderer.createCoreQuadOperation(\n            this.ctx,\n            this._shader,\n            this._shaderOwner,\n            this._renderTextureInfo,\n            this._scissor,\n            this.length\n        );\n        this._check = false;\n    }\n\n    finish() {\n        if (this._quadOperation) {\n            // Add remaining.\n            this._finishQuadOperation(false);\n        }\n\n        this.renderer.finishRenderState(this);\n    }\n\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Base functionality for shader setup/destroy.\n */\nexport default class WebGLShaderProgram {\n\n    constructor(vertexShaderSource, fragmentShaderSource) {\n\n        this.vertexShaderSource = vertexShaderSource;\n        this.fragmentShaderSource = fragmentShaderSource;\n\n        this._program = null;\n        this.gl = null;\n\n        this._uniformLocations = new Map();\n        this._attributeLocations = new Map();\n\n        this._currentUniformValues = {};\n    }\n\n    compile(gl) {\n        if (this._program) return;\n\n        this.gl = gl;\n\n        this._program = gl.createProgram();\n\n        let glVertShader = this._glCompile(gl.VERTEX_SHADER, this.vertexShaderSource);\n        let glFragShader = this._glCompile(gl.FRAGMENT_SHADER, this.fragmentShaderSource);\n\n        gl.attachShader(this._program, glVertShader);\n        gl.attachShader(this._program, glFragShader);\n        gl.linkProgram(this._program);\n\n        // if linking fails, then log and cleanup\n        if (!gl.getProgramParameter(this._program, gl.LINK_STATUS)) {\n            console.error('[Lightning] Error: Could not initialize shader.');\n            console.error('[Lightning] gl.VALIDATE_STATUS', gl.getProgramParameter(this._program, gl.VALIDATE_STATUS));\n            console.error('[Lightning] gl.getError()', gl.getError());\n\n            // if there is a program info log, log it\n            if (gl.getProgramInfoLog(this._program) !== '') {\n                console.warn('[Lightning] Warning: gl.getProgramInfoLog()', gl.getProgramInfoLog(this._program));\n            }\n\n            gl.deleteProgram(this._program);\n            this._program = null;\n        }\n\n        // clean up some shaders\n        gl.deleteShader(glVertShader);\n        gl.deleteShader(glFragShader);\n    }\n\n    _glCompile(type, src) {\n        let shader = this.gl.createShader(type);\n\n        this.gl.shaderSource(shader, src);\n        this.gl.compileShader(shader);\n\n        if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n            console.error('[Lightning]', this.constructor.name, 'Type: ' + (type === this.gl.VERTEX_SHADER ? 'vertex shader' : 'fragment shader') );\n            console.error('[Lightning]', this.gl.getShaderInfoLog(shader));\n            let idx = 0;\n            console.error('[Lightning]', \"========== source ==========\\n\" + src.split(\"\\n\").map(line => \"\" + (++idx) + \": \" + line).join(\"\\n\"));\n            return null;\n        }\n\n        return shader;\n    }\n\n    getUniformLocation(name) {\n        let location = this._uniformLocations.get(name);\n        if (location === undefined) {\n            location = this.gl.getUniformLocation(this._program, name);\n            this._uniformLocations.set(name, location);\n        }\n\n        return location;\n    }\n\n    getAttribLocation(name) {\n        let location = this._attributeLocations.get(name);\n        if (location === undefined) {\n            location = this.gl.getAttribLocation(this._program, name);\n            this._attributeLocations.set(name, location);\n        }\n\n        return location;\n    }\n\n    destroy() {\n        if (this._program) {\n            this.gl.deleteProgram(this._program);\n        }\n\n        this._attributeLocations = null;\n        this._currentUniformValues = null;\n        this.fragmentShaderSource = null;\n        this._program = null;\n        this.gl = null;\n        this._uniformLocations = null;\n        this.vertexShaderSource = null;  \n\n        delete this.vertexShaderSource;\n        delete this._program;        \n        delete this._currentUniformValues;\n        delete this.fragmentShaderSource;\n        delete this.gl;\n        delete this._uniformLocations;\n        delete this._attributeLocations;\n\n    }\n\n    get glProgram() {\n        return this._program;\n    }\n\n    get compiled() {\n        return !!this._program;\n    }\n\n    _valueEquals(v1, v2) {\n        // Uniform value is either a typed array or a numeric value.\n        if (v1.length && v2.length) {\n            for (let i = 0, n = v1.length; i < n; i++) {\n                if (v1[i] !== v2[i]) return false;\n            }\n            return true;\n        } else {\n            return (v1 === v2);\n        }\n    }\n\n    _valueClone(v) {\n        if (v.length) {\n            return v.slice(0);\n        } else {\n            return v;\n        }\n    }\n\n    setUniformValue(name, value, glFunction) {\n        let v = this._currentUniformValues[name];\n        if (v === undefined || !this._valueEquals(v, value)) {\n            let clonedValue = this._valueClone(value);\n            this._currentUniformValues[name] = clonedValue;\n\n            let loc = this.getUniformLocation(name);\n            if (loc) {\n                let isMatrix = (glFunction === this.gl.uniformMatrix2fv || glFunction === this.gl.uniformMatrix3fv || glFunction === this.gl.uniformMatrix4fv);\n                if (isMatrix) {\n                    glFunction.call(this.gl, loc, false, clonedValue);\n                } else {\n                    glFunction.call(this.gl, loc, clonedValue);\n                }\n            }\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport WebGLShaderProgram from \"./WebGLShaderProgram.mjs\";\nimport Shader from \"../../tree/Shader.mjs\";\n\nexport default class WebGLShader extends Shader {\n\n    constructor(ctx) {\n        super(ctx);\n\n        const stage = ctx.stage;\n\n        this._program = stage.renderer.shaderPrograms.get(this.constructor);\n        if (!this._program) {\n            this._program = new WebGLShaderProgram(this.constructor.vertexShaderSource, this.constructor.fragmentShaderSource);\n\n            // Let the vbo context perform garbage collection.\n            stage.renderer.shaderPrograms.set(this.constructor, this._program);\n        }\n\n        this.gl = stage.gl;\n    }\n\n    get glProgram() {\n        return this._program.glProgram;\n    }\n\n    _init() {\n        if (!this._initialized) {\n            this.initialize();\n            this._initialized = true;\n        }\n    }\n\n    initialize() {\n        this._program.compile(this.gl);\n    }\n\n    get initialized() {\n        return this._initialized;\n    }\n\n    _uniform(name) {\n        return this._program.getUniformLocation(name);\n    }\n\n    _attrib(name) {\n        return this._program.getAttribLocation(name);\n    }\n\n    _setUniform(name, value, glFunction) {\n        this._program.setUniformValue(name, value, glFunction);\n    }\n\n    useProgram() {\n        this._init();\n        this.gl.useProgram(this.glProgram);\n        this.beforeUsage();\n        this.enableAttribs();\n    }\n\n    stopProgram() {\n        this.afterUsage();\n        this.disableAttribs();\n    }\n\n    hasSameProgram(other) {\n        // For performance reasons, we first check for identical references.\n        return (other && ((other === this) || (other._program === this._program)));\n    }\n\n    beforeUsage() {\n        // Override to set settings other than the default settings (blend mode etc).\n    }\n\n    afterUsage() {\n        // All settings changed in beforeUsage should be reset here.\n    }\n\n    enableAttribs() {\n\n    }\n\n    disableAttribs() {\n\n    }\n\n    getExtraAttribBytesPerVertex() {\n        return 0;\n    }\n\n    getVertexAttribPointerOffset(operation) {\n        return operation.extraAttribsDataByteOffset - operation.index * 4 * this.getExtraAttribBytesPerVertex();\n    }\n\n    setExtraAttribsInBuffer(operation) {\n        // Set extra attrib data in in operation.quads.data/floats/uints, starting from\n        // operation.extraAttribsBufferByteOffset.\n    }\n\n    setupUniforms(operation) {\n        // Set all shader-specific uniforms.\n        // Notice that all uniforms should be set, even if they have not been changed within this shader instance.\n        // The uniforms are shared by all shaders that have the same type (and shader program).\n    }\n\n    _getProjection(operation) {\n        return operation.getProjection();\n    }\n\n    getFlipY(operation) {\n        return this._getProjection(operation)[1] < 0;\n    }\n\n    beforeDraw(operation) {\n    }\n\n    draw(operation) {\n    }\n\n    afterDraw(operation) {\n    }\n\n    cleanup() {\n        this._initialized = false;\n        // Program takes little resources, so it is only destroyed when the full stage is destroyed.\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport WebGLShader from \"../WebGLShader.mjs\";\n\nexport default class DefaultShader extends WebGLShader {\n\n    enableAttribs() {\n        // Enables the attribs in the shader program.\n        let gl = this.gl;\n        gl.vertexAttribPointer(this._attrib(\"aVertexPosition\"), 2, gl.FLOAT, false, 20, 0);\n        gl.enableVertexAttribArray(this._attrib(\"aVertexPosition\"));\n\n        if (this._attrib(\"aTextureCoord\") !== -1) {\n            gl.vertexAttribPointer(this._attrib(\"aTextureCoord\"), 2, gl.FLOAT, false, 20, 2 * 4);\n            gl.enableVertexAttribArray(this._attrib(\"aTextureCoord\"));\n        }\n\n        if (this._attrib(\"aColor\") !== -1) {\n            // Some shaders may ignore the color.\n            gl.vertexAttribPointer(this._attrib(\"aColor\"), 4, gl.UNSIGNED_BYTE, true, 20, 4 * 4);\n            gl.enableVertexAttribArray(this._attrib(\"aColor\"));\n        }\n    }\n\n    disableAttribs() {\n        // Disables the attribs in the shader program.\n        let gl = this.gl;\n        gl.disableVertexAttribArray(this._attrib(\"aVertexPosition\"));\n\n        if (this._attrib(\"aTextureCoord\") !== -1) {\n            gl.disableVertexAttribArray(this._attrib(\"aTextureCoord\"));\n        }\n\n        if (this._attrib(\"aColor\") !== -1) {\n            gl.disableVertexAttribArray(this._attrib(\"aColor\"));\n        }\n    }\n\n    setupUniforms(operation) {\n        this._setUniform(\"projection\", this._getProjection(operation), this.gl.uniform2fv, false);\n    }\n\n    draw(operation) {\n        let gl = this.gl;\n\n        let length = operation.length;\n\n        if (length) {\n            let glTexture = operation.getTexture(0);\n            let pos = 0;\n            for (let i = 0; i < length; i++) {\n                let tx = operation.getTexture(i);\n                if (glTexture !== tx) {\n                    gl.bindTexture(gl.TEXTURE_2D, glTexture);\n                    gl.drawElements(gl.TRIANGLES, 6 * (i - pos), gl.UNSIGNED_SHORT, (pos + operation.index) * 6 * 2);\n                    glTexture = tx;\n                    pos = i;\n                }\n            }\n            \n            gl.bindTexture(gl.TEXTURE_2D, glTexture);\n            gl.drawElements(gl.TRIANGLES, 6 * (length - pos), gl.UNSIGNED_SHORT, (pos + operation.index) * 6 * 2);\n        }\n    }\n\n}\n\nDefaultShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nDefaultShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n`;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class Renderer {\n\n    constructor(stage) {\n        this.stage = stage;\n        this._defaultShader = undefined;\n    }\n\n    gc(aggressive) {\n    }\n\n    destroy() {\n    }\n\n    getDefaultShader(ctx = this.stage.ctx) {\n        if (!this._defaultShader) {\n            this._defaultShader = this._createDefaultShader(ctx);\n        }\n        return this._defaultShader;\n    }\n\n    _createDefaultShader(ctx) {\n    }\n\n    isValidShaderType(shaderType) {\n        return (shaderType.prototype instanceof this._getShaderBaseType());\n    }\n\n    createShader(ctx, settings) {\n        const shaderType = settings.type;\n        // If shader type is not correct, use a different platform.\n        if (!this.isValidShaderType(shaderType)) {\n            const convertedShaderType = this._getShaderAlternative(shaderType);\n            if (!convertedShaderType) {\n                console.warn(\"[Lightning] Shader has no implementation for render target: \" + shaderType.name);\n                return this._createDefaultShader(ctx);\n            }\n            return new convertedShaderType(ctx);\n        } else {\n            const shader = new shaderType(ctx);\n            Base.patchObject(this, settings);\n            return shader;\n        }\n    }\n\n    _getShaderBaseType() {\n    }\n\n    _getShaderAlternative(shaderType) {\n        return this.getDefaultShader();\n    }\n\n    copyRenderTexture(renderTexture, nativeTexture, options) {\n        console.warn('[Lightning] copyRenderTexture not supported by renderer');\n    }\n}\n\nimport Base from \"../tree/Base.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Utils from \"../../tree/Utils.mjs\";\nimport StageUtils from \"../../tree/StageUtils.mjs\";\nimport WebGLCoreQuadList from \"./WebGLCoreQuadList.mjs\";\nimport WebGLCoreQuadOperation from \"./WebGLCoreQuadOperation.mjs\";\nimport WebGLCoreRenderExecutor from \"./WebGLCoreRenderExecutor.mjs\";\nimport CoreRenderState from \"../../tree/core/CoreRenderState.mjs\";\nimport DefaultShader from \"./shaders/DefaultShader.mjs\";\nimport WebGLShader from \"./WebGLShader.mjs\";\nimport Renderer from \"../Renderer.mjs\";\n\nexport default class WebGLRenderer extends Renderer {\n\n    constructor(stage) {\n        super(stage);\n        this.shaderPrograms = new Map();\n        this._compressedTextureExtensions = {\n            astc: stage.gl.getExtension('WEBGL_compressed_texture_astc'),\n            etc1: stage.gl.getExtension('WEBGL_compressed_texture_etc1'),\n            s3tc: stage.gl.getExtension('WEBGL_compressed_texture_s3tc'),\n            pvrtc: stage.gl.getExtension('WEBGL_compressed_texture_pvrtc'),\n        }\n    }\n\n    getCompressedTextureExtensions() {\n        return this._compressedTextureExtensions\n    }\n\n    destroy() {\n        this.shaderPrograms.forEach(shaderProgram => shaderProgram.destroy());\n\n        this.shaderPrograms = null;\n        this._compressedTextureExtensions = null;\n\n        delete this.shaderPrograms;\n        delete this._compressedTextureExtensions;\n    }\n\n    _createDefaultShader(ctx) {\n        return new DefaultShader(ctx);\n    }\n\n    _getShaderBaseType() {\n        return WebGLShader\n    }\n\n    _getShaderAlternative(shaderType) {\n        return shaderType.getWebGL && shaderType.getWebGL();\n    }\n\n    createCoreQuadList(ctx) {\n        return new WebGLCoreQuadList(ctx);\n    }\n\n    createCoreQuadOperation(ctx, shader, shaderOwner, renderTextureInfo, scissor, index) {\n        return new WebGLCoreQuadOperation(ctx, shader, shaderOwner, renderTextureInfo, scissor, index);\n    }\n\n    createCoreRenderExecutor(ctx) {\n        return new WebGLCoreRenderExecutor(ctx);\n    }\n\n    createCoreRenderState(ctx) {\n        return new CoreRenderState(ctx);\n    }\n\n    createRenderTexture(w, h, pw, ph) {\n        const gl = this.stage.gl;\n        const glTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, glTexture);\n\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, pw, ph, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        glTexture.params = {};\n        glTexture.params[gl.TEXTURE_MAG_FILTER] = gl.LINEAR;\n        glTexture.params[gl.TEXTURE_MIN_FILTER] = gl.LINEAR;\n        glTexture.params[gl.TEXTURE_WRAP_S] = gl.CLAMP_TO_EDGE;\n        glTexture.params[gl.TEXTURE_WRAP_T] = gl.CLAMP_TO_EDGE;\n        glTexture.options = { format: gl.RGBA, internalFormat: gl.RGBA, type: gl.UNSIGNED_BYTE };\n\n        // We need a specific framebuffer for every render texture.\n        glTexture.framebuffer = gl.createFramebuffer();\n        glTexture.projection = new Float32Array([2 / w, 2 / h]);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, glTexture.framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, glTexture, 0);\n\n        return glTexture;\n    }\n\n    freeRenderTexture(glTexture) {\n        let gl = this.stage.gl;\n        gl.deleteFramebuffer(glTexture.framebuffer);\n        gl.deleteTexture(glTexture);\n    }\n\n    _getBytesPerPixel(fmt, type) {\n        const gl = this.stage.gl;\n\n        if (fmt === gl.RGBA) {\n            switch (type) {\n                case gl.UNSIGNED_BYTE:\n                    return 4;\n\n                case gl.UNSIGNED_SHORT_4_4_4_4:\n                    return 2;\n\n                case gl.UNSIGNED_SHORT_5_5_5_1:\n                    return 2;\n\n                default:\n                    throw new Error('Invalid type specified for GL_RGBA format');\n            }\n        }\n        else if (fmt === gl.RGB) {\n            switch (type) {\n                case gl.UNSIGNED_BYTE:\n                    return 3;\n\n                case gl.UNSIGNED_BYTE_5_6_5:\n                    return 2;\n\n                default:\n                    throw new Error('Invalid type specified for GL_RGB format');\n            }\n        }\n        else {\n            throw new Error('Invalid format specified in call to _getBytesPerPixel()');\n        }\n    }\n\n    uploadTextureSource(textureSource, options) {\n        const gl = this.stage.gl;\n\n        const source = options.source;\n        let compressed = false;\n        if (options.renderInfo) {\n            compressed = options.renderInfo.compressed || false\n        }\n\n        const format = {\n            premultiplyAlpha: true,\n            hasAlpha: true\n        };\n\n        if (options && options.hasOwnProperty('premultiplyAlpha')) {\n            format.premultiplyAlpha = options.premultiplyAlpha;\n        }\n\n        if (options && options.hasOwnProperty('flipBlueRed')) {\n            format.flipBlueRed = options.flipBlueRed;\n        }\n\n        if (options && options.hasOwnProperty('hasAlpha')) {\n            format.hasAlpha = options.hasAlpha;\n        }\n\n        if (!format.hasAlpha) {\n            format.premultiplyAlpha = false;\n        }\n\n        format.texParams = options.texParams || {}\n        format.texOptions = options.texOptions || {}\n\n        let glTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, glTexture);\n\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, format.premultiplyAlpha);\n\n        if (Utils.isNode) {\n            gl.pixelStorei(gl.UNPACK_FLIP_BLUE_RED, !!format.flipBlueRed);\n        }\n\n        const texParams = format.texParams;\n        if (!texParams[gl.TEXTURE_MAG_FILTER]) texParams[gl.TEXTURE_MAG_FILTER] = gl.LINEAR;\n        if (!texParams[gl.TEXTURE_MIN_FILTER]) texParams[gl.TEXTURE_MIN_FILTER] = gl.LINEAR;\n        if (!texParams[gl.TEXTURE_WRAP_S]) texParams[gl.TEXTURE_WRAP_S] = gl.CLAMP_TO_EDGE;\n        if (!texParams[gl.TEXTURE_WRAP_T]) texParams[gl.TEXTURE_WRAP_T] = gl.CLAMP_TO_EDGE;\n\n        Object.keys(texParams).forEach(key => {\n            const value = texParams[key];\n            gl.texParameteri(gl.TEXTURE_2D, parseInt(key), value);\n        });\n\n        if (compressed) {\n            this.stage.platform.uploadCompressedGlTexture(gl, textureSource, source);\n            return glTexture;\n        }\n         \n        const texOptions = format.texOptions;\n        texOptions.format = texOptions.format || (format.hasAlpha ? gl.RGBA : gl.RGB);\n        texOptions.type = texOptions.type || gl.UNSIGNED_BYTE;\n        texOptions.internalFormat = texOptions.internalFormat || texOptions.format;\n        if (options && options.imageRef) {\n            texOptions.imageRef = options.imageRef;\n        }\n        \n        this.stage.platform.uploadGlTexture(gl, textureSource, source, texOptions);\n        \n        glTexture.params = Utils.cloneObjShallow(texParams);\n        glTexture.options = Utils.cloneObjShallow(texOptions);\n\n        // calculate bytes per pixel for vram usage tracking\n        glTexture.bytesPerPixel = this._getBytesPerPixel(texOptions.format, texOptions.type);\n\n        return glTexture;\n    }\n\n    freeTextureSource(textureSource) {\n        this.stage.gl.deleteTexture(textureSource.nativeTexture);\n    }\n\n    addQuad(renderState, quads, index) {\n        let offset = (index * 20);\n        const elementCore = quads.quadElements[index];\n\n        let r = elementCore._renderContext;\n\n        let floats = renderState.quads.floats;\n        let uints = renderState.quads.uints;\n        const mca = StageUtils.mergeColorAlpha;\n\n        if (r.tb !== 0 || r.tc !== 0) {\n            floats[offset++] = r.px;\n            floats[offset++] = r.py;\n            floats[offset++] = elementCore._ulx;\n            floats[offset++] = elementCore._uly;\n            uints[offset++] = mca(elementCore._colorUl, r.alpha);\n            floats[offset++] = r.px + elementCore._w * r.ta;\n            floats[offset++] = r.py + elementCore._w * r.tc;\n            floats[offset++] = elementCore._brx;\n            floats[offset++] = elementCore._uly;\n            uints[offset++] = mca(elementCore._colorUr, r.alpha);\n            floats[offset++] = r.px + elementCore._w * r.ta + elementCore._h * r.tb;\n            floats[offset++] = r.py + elementCore._w * r.tc + elementCore._h * r.td;\n            floats[offset++] = elementCore._brx;\n            floats[offset++] = elementCore._bry;\n            uints[offset++] = mca(elementCore._colorBr, r.alpha);\n            floats[offset++] = r.px + elementCore._h * r.tb;\n            floats[offset++] = r.py + elementCore._h * r.td;\n            floats[offset++] = elementCore._ulx;\n            floats[offset++] = elementCore._bry;\n            uints[offset] = mca(elementCore._colorBl, r.alpha);\n        } else {\n            // Simple.\n            let cx = r.px + elementCore._w * r.ta;\n            let cy = r.py + elementCore._h * r.td;\n\n            floats[offset++] = r.px;\n            floats[offset++] = r.py;\n            floats[offset++] = elementCore._ulx;\n            floats[offset++] = elementCore._uly;\n            uints[offset++] = mca(elementCore._colorUl, r.alpha);\n            floats[offset++] = cx;\n            floats[offset++] = r.py;\n            floats[offset++] = elementCore._brx;\n            floats[offset++] = elementCore._uly;\n            uints[offset++] = mca(elementCore._colorUr, r.alpha);\n            floats[offset++] = cx;\n            floats[offset++] = cy;\n            floats[offset++] = elementCore._brx;\n            floats[offset++] = elementCore._bry;\n            uints[offset++] = mca(elementCore._colorBr, r.alpha);\n            floats[offset++] = r.px;\n            floats[offset++] = cy;\n            floats[offset++] = elementCore._ulx;\n            floats[offset++] = elementCore._bry;\n            uints[offset] = mca(elementCore._colorBl, r.alpha);\n        }\n    }\n\n    isRenderTextureReusable(renderState, renderTextureInfo) {\n        let offset = (renderState._renderTextureInfo.offset * 80) / 4;\n        let floats = renderState.quads.floats;\n        let uints = renderState.quads.uints;\n        return ((floats[offset] === 0) &&\n            (floats[offset + 1] === 0) &&\n            (floats[offset + 2] === 0) &&\n            (floats[offset + 3] === 0) &&\n            (uints[offset + 4] === 0xFFFFFFFF) &&\n            (floats[offset + 5] === renderTextureInfo.w) &&\n            (floats[offset + 6] === 0) &&\n            (floats[offset + 7] === 1) &&\n            (floats[offset + 8] === 0) &&\n            (uints[offset + 9] === 0xFFFFFFFF) &&\n            (floats[offset + 10] === renderTextureInfo.w) &&\n            (floats[offset + 11] === renderTextureInfo.h) &&\n            (floats[offset + 12] === 1) &&\n            (floats[offset + 13] === 1) &&\n            (uints[offset + 14] === 0xFFFFFFFF) &&\n            (floats[offset + 15] === 0) &&\n            (floats[offset + 16] === renderTextureInfo.h) &&\n            (floats[offset + 17] === 0) &&\n            (floats[offset + 18] === 1) &&\n            (uints[offset + 19] === 0xFFFFFFFF));\n    }\n\n    finishRenderState(renderState) {\n        // Set extra shader attribute data.\n        let offset = renderState.length * 80;\n        for (let i = 0, n = renderState.quadOperations.length; i < n; i++) {\n            renderState.quadOperations[i].extraAttribsDataByteOffset = offset;\n            let extra = renderState.quadOperations[i].shader.getExtraAttribBytesPerVertex() * 4 * renderState.quadOperations[i].length;\n            offset += extra;\n            if (extra) {\n                renderState.quadOperations[i].shader.setExtraAttribsInBuffer(renderState.quadOperations[i], renderState.quads);\n            }\n        }\n        renderState.quads.dataLength = offset;\n    }\n\n    copyRenderTexture(renderTexture, nativeTexture, options) {\n        const gl = this.stage.gl;\n        gl.bindTexture(gl.TEXTURE_2D, nativeTexture);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, renderTexture.framebuffer);\n        const precision = renderTexture.precision;\n        gl.copyTexSubImage2D(\n            gl.TEXTURE_2D,\n            0,\n            precision * (options.sx || 0),\n            precision * (options.sy || 0),\n            precision * (options.x || 0),\n            precision * (options.y || 0),\n            precision * (options.w || renderTexture.ow),\n            precision * (options.h || renderTexture.oh));\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CoreQuadList from \"../../tree/core/CoreQuadList.mjs\";\n\nexport default class C2dCoreQuadList extends CoreQuadList {\n\n    constructor(ctx) {\n        super(ctx);\n\n        this.renderContexts = [];\n        this.modes = [];\n    }\n\n    setRenderContext(index, v) {\n        this.renderContexts[index] = v;\n    }\n\n    setSimpleTc(index, v) {\n        if (v) {\n            this.modes[index] |= 1;\n        } else {\n            this.modes[index] -= (this.modes[index] & 1);\n        }\n    }\n\n    setWhite(index, v) {\n        if (v) {\n            this.modes[index] |= 2;\n        } else {\n            this.modes[index] -= (this.modes[index] & 2);\n        }\n    }\n\n    getRenderContext(index) {\n        return this.renderContexts[index];\n    }\n\n    getSimpleTc(index) {\n        return (this.modes[index] & 1);\n    }\n\n    getWhite(index) {\n        return (this.modes[index] & 2);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CoreQuadOperation from \"../../tree/core/CoreQuadOperation.mjs\";\n\nexport default class C2dCoreQuadOperation extends CoreQuadOperation {\n\n    getRenderContext(index) {\n        return this.quads.getRenderContext(this.index + index);\n    }\n\n    getSimpleTc(index) {\n        return this.quads.getSimpleTc(this.index + index);\n    }\n\n    getWhite(index) {\n        return this.quads.getWhite(this.index + index);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport CoreRenderExecutor from \"../../tree/core/CoreRenderExecutor.mjs\";\nimport StageUtils from \"../../tree/StageUtils.mjs\";\nimport Utils from \"../../tree/Utils.mjs\";\n\nexport default class C2dCoreRenderExecutor extends CoreRenderExecutor {\n\n    init() {\n        this._mainRenderTexture = this.ctx.stage.getCanvas();\n    }\n\n    _renderQuadOperation(op) {\n        let shader = op.shader;\n\n        if (op.length || op.shader.addEmpty()) {\n            const target = this._renderTexture || this._mainRenderTexture;\n            shader.beforeDraw(op, target);\n            shader.draw(op, target);\n            shader.afterDraw(op, target);\n        }\n    }\n\n    _clearRenderTexture() {\n        const ctx = this._getContext();\n\n        let clearColor = [0, 0, 0, 0];\n        if (this._mainRenderTexture.ctx === ctx) {\n            clearColor = this.ctx.stage.getClearColor();\n        }\n\n        const renderTexture = ctx.canvas;\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\n        if (!clearColor[0] && !clearColor[1] && !clearColor[2] && !clearColor[3]) {\n            ctx.clearRect(0, 0, renderTexture.width, renderTexture.height);\n        } else {\n            ctx.fillStyle = StageUtils.getRgbaStringFromArray(clearColor);\n            // Do not use fillRect because it produces artifacts.\n            ctx.globalCompositeOperation = 'copy';\n            ctx.beginPath();\n            ctx.rect(0, 0, renderTexture.width, renderTexture.height);\n            ctx.closePath();\n            ctx.fill();\n            ctx.globalCompositeOperation = 'source-over';\n        }\n    }\n    \n    _getContext() {\n        if (this._renderTexture) {\n            return this._renderTexture.ctx;\n        } else {\n            return this._mainRenderTexture.ctx;\n        } \n    }\n\n    _restoreContext() {\n        const ctx = this._getContext();\n        ctx.restore();\n        ctx.save();\n        ctx._scissor = null;\n    }\n\n    _setScissor(area) {\n        const ctx = this._getContext();\n\n        if (!C2dCoreRenderExecutor._equalScissorAreas(ctx.canvas, ctx._scissor, area)) {\n            // Clipping is stored in the canvas context state.\n            // We can't reset clipping alone so we need to restore the full context.\n            this._restoreContext();\n\n            let precision = this.ctx.stage.getRenderPrecision();\n            if (area) {\n                ctx.beginPath();\n                ctx.rect(Math.round(area[0] * precision), Math.round(area[1] * precision), Math.round(area[2] * precision), Math.round(area[3] * precision));\n                ctx.closePath();\n                ctx.clip();\n            }\n            ctx._scissor = area;\n        }\n    }\n\n    static _equalScissorAreas(canvas, area, current) {\n        if (!area) {\n            area = [0, 0, canvas.width, canvas.height]\n        }\n        if (!current) {\n            current = [0, 0, canvas.width, canvas.height]\n        }\n        return Utils.equalValues(area, current)\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Shader from \"../../tree/Shader.mjs\";\n\nexport default class C2dShader extends Shader {\n\n    beforeDraw(operation) {\n    }\n\n    draw(operation) {\n    }\n\n    afterDraw(operation) {\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport C2dShader from \"../C2dShader.mjs\";\nimport StageUtils from \"../../../tree/StageUtils.mjs\";\n\nexport default class DefaultShader extends C2dShader {\n\n    constructor(ctx) {\n        super(ctx);\n        this._rectangleTexture = ctx.stage.rectangleTexture.source.nativeTexture;\n        this._tintManager = this.ctx.stage.renderer.tintManager;\n    }\n\n    draw(operation, target) {\n        const ctx = target.ctx;\n        let length = operation.length;\n        for (let i = 0; i < length; i++) {\n            const tx = operation.getTexture(i);\n            const vc = operation.getElementCore(i);\n            const rc = operation.getRenderContext(i);\n            const white = operation.getWhite(i);\n            const stc = operation.getSimpleTc(i);\n\n            //@todo: try to optimize out per-draw transform setting. split translate, transform.\n            const precision = this.ctx.stage.getRenderPrecision();\n            ctx.setTransform(rc.ta * precision, rc.tc * precision, rc.tb * precision, rc.td * precision, rc.px * precision, rc.py * precision);\n\n            const rect = (tx === this._rectangleTexture);\n            const info = {operation, target, index: i, rect};\n\n            if (rect) {\n                // Check for gradient.\n                if (white) {\n                    ctx.fillStyle = 'white';\n                } else {\n                    this._setColorGradient(ctx, vc);\n                }\n\n                ctx.globalAlpha = rc.alpha;\n                this._beforeDrawEl(info);\n                ctx.fillRect(0, 0, vc.w, vc.h);\n                this._afterDrawEl(info);\n                ctx.globalAlpha = 1.0;\n            } else {\n                // @todo: set image smoothing based on the texture.\n\n                // @todo: optimize by registering whether identity texcoords are used.\n                ctx.globalAlpha = rc.alpha;\n                this._beforeDrawEl(info);\n\n                // @todo: test if rounding yields better performance.\n\n                // Notice that simple texture coords can be turned on even though vc._ulx etc are not simple, because\n                //  we are rendering a render-to-texture (texcoords were stashed). Same is true for 'white' color btw.\n                const sourceX = stc ? 0 : (vc._ulx * tx.w);\n                const sourceY = stc ? 0 : (vc._uly * tx.h);\n                const sourceW = (stc ? 1 : (vc._brx - vc._ulx)) * tx.w;\n                const sourceH = (stc ? 1 : (vc._bry - vc._uly)) * tx.h;\n\n                let colorize = !white;\n                if (colorize) {\n                    // @todo: cache the tint texture for better performance.\n\n                    // Draw to intermediate texture with background color/gradient.\n                    // This prevents us from having to create a lot of render texture canvases.\n\n                    // Notice that we don't support (non-rect) gradients, only color tinting for c2d. We'll just take the average color.\n                    let color = vc._colorUl;\n                    if (vc._colorUl !== vc._colorUr || vc._colorUr !== vc._colorBl || vc._colorBr !== vc._colorBl) {\n                        color = StageUtils.mergeMultiColorsEqual([vc._colorUl, vc._colorUr, vc._colorBl, vc._colorBr]);\n                    }\n\n                    const alpha = ((color / 16777216) | 0) / 255.0;\n                    ctx.globalAlpha *= alpha;\n\n                    const rgb = color & 0x00FFFFFF;\n                    const tintTexture = this._tintManager.getTintTexture(tx, rgb);\n\n                    // Actually draw result.\n                    ctx.fillStyle = 'white';\n                    ctx.drawImage(tintTexture, sourceX, sourceY, sourceW, sourceH, 0, 0, vc.w, vc.h);\n                } else {\n                    ctx.fillStyle = 'white';\n                    ctx.drawImage(tx, sourceX, sourceY, sourceW, sourceH, 0, 0, vc.w, vc.h);\n                }\n                this._afterDrawEl(info);\n                ctx.globalAlpha = 1.0;\n            }\n        }\n    }\n\n    _setColorGradient(ctx, vc, w = vc.w, h = vc.h, transparency = true) {\n        let color = vc._colorUl;\n        let gradient;\n        //@todo: quick single color check.\n        //@todo: cache gradient/fill style (if possible, probably context-specific).\n\n        if (vc._colorUl === vc._colorUr) {\n            if (vc._colorBl === vc._colorBr) {\n                if (vc._colorUl === vc.colorBl) {\n                    // Single color.\n                } else {\n                    // Vertical gradient.\n                    gradient = ctx.createLinearGradient(0, 0, 0, h);\n                    if (transparency) {\n                        gradient.addColorStop(0, StageUtils.getRgbaString(vc._colorUl));\n                        gradient.addColorStop(1, StageUtils.getRgbaString(vc._colorBl));\n                    } else {\n                        gradient.addColorStop(0, StageUtils.getRgbString(vc._colorUl));\n                        gradient.addColorStop(1, StageUtils.getRgbString(vc._colorBl));\n\n                    }\n                }\n            } else {\n                // Not supported gradient.\n            }\n        } else {\n            if (vc._colorUl === vc._colorBl && vc._colorUr === vc._colorBr) {\n                // Horizontal gradient.\n                gradient = ctx.createLinearGradient(0, 0, w, 0);\n                if (transparency) {\n                    gradient.addColorStop(0, StageUtils.getRgbaString(vc._colorUl));\n                    gradient.addColorStop(1, StageUtils.getRgbaString(vc._colorBr));\n                } else {\n                    gradient.addColorStop(0, StageUtils.getRgbString(vc._colorUl));\n                    gradient.addColorStop(1, StageUtils.getRgbString(vc._colorBr));\n                }\n            }\n        }\n\n        if (gradient) {\n            ctx.fillStyle = gradient;\n        } else {\n            ctx.fillStyle = transparency ? StageUtils.getRgbaString(color) : StageUtils.getRgbString(color);\n        }\n    }\n\n    _beforeDrawEl(info) {\n    }\n\n    _afterDrawEl(info) {\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class C2dTextureTintManager {\n\n    constructor(stage) {\n        this.stage = stage;\n        this._usedMemory = 0;\n        this._cachedNativeTextures = new Set();\n    }\n\n    destroy() {\n        this.gc(true);\n\n        this.stage = null;\n        delete this.stage;\n    }\n\n    _addMemoryUsage(delta) {\n        this._usedMemory += delta;\n\n        this.stage.addMemoryUsage(delta);\n    }\n\n    delete(nativeTexture) {\n        // Should be called when native texture is cleaned up.\n        if (this._hasCache(nativeTexture)) {\n            const cache = this._getCache(nativeTexture);\n            const prevMemUsage = cache.memoryUsage;\n            cache.clear();\n            this._cachedNativeTextures.delete(nativeTexture);\n            this._addMemoryUsage(cache.memoryUsage - prevMemUsage);\n        }\n    }\n\n    getTintTexture(nativeTexture, color) {\n        const frame = this.stage.frameCounter;\n\n        this._cachedNativeTextures.add(nativeTexture);\n\n        const cache = this._getCache(nativeTexture);\n\n        const item = cache.get(color);\n        item.lf = frame;\n\n        if (item.tx) {\n            if (nativeTexture.update > item.u) {\n                // Native texture was updated in the mean time: renew.\n                this._tintTexture(item.tx, nativeTexture, color)\n            }\n\n            return item.tx;\n        } else {\n            const before = cache.memoryUsage;\n\n            // Find blanco tint texture.\n            let target = cache.reuseTexture(frame);\n            if (target) {\n                target.ctx.clearRect(0, 0, target.width, target.height);\n            } else {\n                // Allocate new.\n                target = document.createElement('canvas');\n                target.width = nativeTexture.w;\n                target.height = nativeTexture.h;\n                target.ctx = target.getContext('2d');\n            }\n\n            this._tintTexture(target, nativeTexture, color);\n            cache.set(color, target, frame);\n\n            const after = cache.memoryUsage;\n\n            if (after !== before) {\n                this._addMemoryUsage(after - before);\n            }\n\n            return target;\n        }\n    }\n\n    _tintTexture(target, source, color) {\n        let col = color.toString(16);\n        while (col.length < 6) {\n            col = \"0\" + col;\n        }\n        target.ctx.fillStyle = '#' + col;\n        target.ctx.globalCompositeOperation = 'copy';\n        target.ctx.fillRect(0, 0, source.w, source.h);\n        target.ctx.globalCompositeOperation = 'multiply';\n        target.ctx.drawImage(source, 0, 0, source.w, source.h, 0, 0, target.width, target.height);\n\n        // Alpha-mix the texture.\n        target.ctx.globalCompositeOperation = 'destination-in';\n        target.ctx.drawImage(source, 0, 0, source.w, source.h, 0, 0, target.width, target.height);\n    }\n\n    _hasCache(nativeTexture) {\n        return !!nativeTexture._tintCache;\n    }\n\n    _getCache(nativeTexture) {\n        if (!nativeTexture._tintCache) {\n            nativeTexture._tintCache = new C2dTintCache(nativeTexture);\n        }\n        return nativeTexture._tintCache;\n    }\n\n    gc(aggressive = false) {\n        const frame = this.stage.frameCounter;\n        let delta = 0;\n        this._cachedNativeTextures.forEach(texture => {\n            const cache = this._getCache(texture);\n            if (aggressive) {\n                delta += cache.memoryUsage;\n                cache.clear();\n            } else {\n                const before = cache.memoryUsage;\n                cache.cleanup(frame);\n                cache.releaseBlancoTextures();\n                delta += (cache.memoryUsage - before);\n            }\n        });\n\n        if (aggressive) {\n            this._cachedNativeTextures.clear();\n        }\n\n        if (delta) {\n            this._addMemoryUsage(delta);\n        }\n    }\n\n}\n\nclass C2dTintCache {\n\n    constructor(nativeTexture) {\n        this._tx = nativeTexture;\n        this._colors = new Map();\n        this._blancoTextures = null;\n        this._lastCleanupFrame = 0;\n        this._memTextures = 0;\n    }\n\n    get memoryUsage() {\n        return this._memTextures * this._tx.w * this._tx.h;\n    }\n\n    releaseBlancoTextures() {\n        this._memTextures -= this._blancoTextures.length;\n        this._blancoTextures = [];\n    }\n\n    clear() {\n        // Dereference the textures.\n        this._blancoTextures = null;\n        this._colors.clear();\n        this._memTextures = 0;\n    }\n\n    get(color) {\n        let item = this._colors.get(color);\n        if (!item) {\n            item = {lf: -1, tx: undefined, u: -1};\n            this._colors.set(color, item);\n        }\n        return item;\n    }\n\n    set(color, texture, frame) {\n        const item = this.get(color);\n        item.lf = frame;\n        item.tx = texture;\n        item.u = frame;\n        this._memTextures++;\n    }\n\n    cleanup(frame) {\n        // We only need to clean up once per frame.\n        if (this._lastCleanupFrame !== frame) {\n\n            // We limit blanco textures reuse to one frame only to prevent memory usage growth.\n            this._blancoTextures = [];\n\n            this._colors.forEach((item, color) => {\n                // Clean up entries that were not used last frame.\n                if (item.lf < frame - 1) {\n                    if (item.tx) {\n                        // Keep as reusable blanco texture.\n                        this._blancoTextures.push(item.tx);\n                    }\n                    this._colors.delete(color);\n                }\n            });\n\n            this._lastCleanupFrame = frame;\n        }\n    }\n\n    reuseTexture(frame) {\n        // Try to reuse textures, because creating them every frame is expensive.\n        this.cleanup(frame);\n        if (this._blancoTextures && this._blancoTextures.length) {\n            this._memTextures--;\n            return this._blancoTextures.pop();\n        }\n    }\n\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport C2dCoreQuadList from \"./C2dCoreQuadList.mjs\";\nimport C2dCoreQuadOperation from \"./C2dCoreQuadOperation.mjs\";\nimport C2dCoreRenderExecutor from \"./C2dCoreRenderExecutor.mjs\";\nimport CoreRenderState from \"../../tree/core/CoreRenderState.mjs\";\nimport DefaultShader from \"./shaders/DefaultShader.mjs\";\nimport C2dShader from \"./C2dShader.mjs\";\nimport Renderer from \"../Renderer.mjs\";\nimport TextureTintManager from \"./C2dTextureTintManager.mjs\";\n\nexport default class C2dRenderer extends Renderer {\n\n    constructor(stage) {\n        super(stage);\n\n        this.tintManager = new TextureTintManager(stage);\n\n        this.setupC2d(this.stage.c2d.canvas);\n    }\n\n    destroy() {\n        this.tintManager.destroy();\n\n        this.tintManager = null;\n        delete this.tintManager;\n    }\n\n    _createDefaultShader(ctx) {\n        return new DefaultShader(ctx);\n    }\n\n    _getShaderBaseType() {\n        return C2dShader\n    }\n\n    _getShaderAlternative(shaderType) {\n        return shaderType.getC2d && shaderType.getC2d();\n    }\n\n    createCoreQuadList(ctx) {\n        return new C2dCoreQuadList(ctx);\n    }\n\n    createCoreQuadOperation(ctx, shader, shaderOwner, renderTextureInfo, scissor, index) {\n        return new C2dCoreQuadOperation(ctx, shader, shaderOwner, renderTextureInfo, scissor, index);\n    }\n\n    createCoreRenderExecutor(ctx) {\n        return new C2dCoreRenderExecutor(ctx);\n    }\n    \n    createCoreRenderState(ctx) {\n        return new CoreRenderState(ctx);\n    }\n\n    createRenderTexture(w, h, pw, ph) {\n        const canvas = document.createElement('canvas');\n        canvas.width = pw;\n        canvas.height = ph;\n        this.setupC2d(canvas);\n        return canvas;\n    }\n    \n    freeRenderTexture(nativeTexture) {\n        this.tintManager.delete(nativeTexture);\n    }\n\n    gc(aggressive) {\n        this.tintManager.gc(aggressive);\n    }\n\n    uploadTextureSource(textureSource, options) {\n        // For canvas, we do not need to upload.\n        if (options.source.buffer) {\n            // Convert RGBA buffer to canvas.\n            const canvas = document.createElement('canvas');\n            canvas.width = options.w;\n            canvas.height = options.h;\n\n            const imageData = new ImageData(new Uint8ClampedArray(options.source.buffer), options.w, options.h);\n            canvas.getContext('2d').putImageData(imageData, 0, 0);\n            return canvas;\n        }\n\n        return options.source;\n    }\n\n    freeTextureSource(textureSource) {\n        this.tintManager.delete(textureSource.nativeTexture);\n    }\n\n    addQuad(renderState, quads, index) {\n        // Render context changes while traversing so we save it by ref.\n        const elementCore = quads.quadElements[index];\n        quads.setRenderContext(index, elementCore._renderContext);\n        quads.setWhite(index, elementCore.isWhite());\n        quads.setSimpleTc(index, elementCore.hasSimpleTexCoords());\n    }\n\n    isRenderTextureReusable(renderState, renderTextureInfo) {\n        // @todo: check render coords/matrix, maybe move this to core?\n        return false;\n    }\n\n    finishRenderState(renderState) {\n    }\n\n    setupC2d(canvas) {\n        const ctx = canvas.getContext('2d');\n        canvas.ctx = ctx;\n\n        ctx._scissor = null;\n\n        // Save base state so we can restore the defaults later.\n        canvas.ctx.save();\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport WebGLShader from \"../../webgl/WebGLShader.mjs\";\n\nexport default class SparkShader extends WebGLShader {\n\n    enableAttribs() {\n        // Enables the attribs in the shader program.\n        let gl = this.gl;\n        gl.vertexAttribPointer(this._attrib(\"aVertexPosition\"), 2, gl.FLOAT, false, 20, 0);\n        gl.enableVertexAttribArray(this._attrib(\"aVertexPosition\"));\n\n        if (this._attrib(\"aTextureCoord\") !== -1) {\n            gl.vertexAttribPointer(this._attrib(\"aTextureCoord\"), 2, gl.FLOAT, false, 20, 2 * 4);\n            gl.enableVertexAttribArray(this._attrib(\"aTextureCoord\"));\n        }\n\n        if (this._attrib(\"aColor\") !== -1) {\n            // Some shaders may ignore the color.\n            gl.vertexAttribPointer(this._attrib(\"aColor\"), 4, gl.UNSIGNED_BYTE, true, 20, 4 * 4);\n            gl.enableVertexAttribArray(this._attrib(\"aColor\"));\n        }\n    }\n\n    disableAttribs() {\n        // Disables the attribs in the shader program.\n        let gl = this.gl;\n        gl.disableVertexAttribArray(this._attrib(\"aVertexPosition\"));\n\n        if (this._attrib(\"aTextureCoord\") !== -1) {\n            gl.disableVertexAttribArray(this._attrib(\"aTextureCoord\"));\n        }\n\n        if (this._attrib(\"aColor\") !== -1) {\n            gl.disableVertexAttribArray(this._attrib(\"aColor\"));\n        }\n    }\n\n    setupUniforms(operation) {\n        this._setUniform(\"projection\", this._getProjection(operation), this.gl.uniform2fv, false);\n    }\n\n    draw(operation) {\n        let gl = this.gl;\n\n        let length = operation.length;\n\n        if (length) {\n            let glTexture = operation.getTexture(0);\n            let pos = 0;\n            for (let i = 0; i < length; i++) {\n                let tx = operation.getTexture(i);\n                if (glTexture !== tx) {\n                    if (glTexture.options && glTexture.options.imageRef) {\n                        let elementPostion = (i > 0) ? (i - 1) : i;\n                        const precision = this.ctx.stage.getOption('precision');\n                        let vc = operation.getElementCore(elementPostion);\n                        this.ctx.stage.platform.paint(gl, glTexture.options.imageRef, vc._worldContext.px*precision, vc._worldContext.py*precision, vc._colorUl, vc);\n                    } else {\n                        gl.bindTexture(gl.TEXTURE_2D, glTexture);\n                        gl.drawElements(gl.TRIANGLES, 6 * (i - pos), gl.UNSIGNED_SHORT, (pos + operation.index) * 6 * 2);\n                    }\n                    glTexture = tx;\n                    pos = i;\n                }\n            }\n            if (pos < length) {\n                if (glTexture.options && glTexture.options.imageRef) {\n                    const precision = this.ctx.stage.getOption('precision');\n                    let vc = operation.getElementCore(pos);\n                    this.ctx.stage.platform.paint(gl, glTexture.options.imageRef, vc._worldContext.px*precision, vc._worldContext.py*precision, vc._colorUl, vc);\n                } else {\n                    gl.bindTexture(gl.TEXTURE_2D, glTexture);\n                    gl.drawElements(gl.TRIANGLES, 6 * (length - pos), gl.UNSIGNED_SHORT, (pos + operation.index) * 6 * 2);\n                }\n            }\n        }\n    }\n\n}\n\nSparkShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nSparkShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n`;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport WebGLRenderer from \"../webgl/WebGLRenderer.mjs\";\nimport SparkShader from \"./shaders/SparkShader.mjs\";\n\nexport default class SparkRenderer extends WebGLRenderer {\n\n    constructor(stage) {\n        super(stage);\n    }\n\n    _createDefaultShader(ctx) {\n        return new SparkShader(ctx);\n    }\n\n    createCoreRenderExecutor(ctx) {\n        global.beginDrawing();\n        let ret = super.createCoreRenderExecutor(ctx);\n        global.endDrawing();\n        return ret;\n    }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class ImageWorker {\n\n    constructor(options = {}) {\n        this._items = new Map();\n        this._id = 0;\n\n        this._initWorker();\n    }\n\n    destroy() {\n        if (this._worker) {\n            this._worker.terminate();\n        }\n\n        this._items = null;\n        this._worker = null;\n\n        delete this._items;\n        delete this._worker;        \n    }\n\n    _initWorker() {\n        const code = `(${createWorker.toString()})()`;\n        const blob = new Blob([code.replace('\"use strict\";', '')]); // firefox adds \"use strict\"; to any function which might block worker execution so knock it off\n        const blobURL = (window.URL ? URL : webkitURL).createObjectURL(blob, {\n            type: 'application/javascript; charset=utf-8'\n        });\n        this._worker = new Worker(blobURL);\n\n        this._worker.postMessage({type: 'config', config: {path: window.location.href, protocol: window.location.protocol}});\n\n        this._worker.onmessage = (e) => {\n            if (e.data && e.data.id) {\n                const id = e.data.id;\n                const item = this._items.get(id);\n                if (item) {\n                    if (e.data.type == 'data') {\n                        this.finish(item, e.data.info);\n                    } else {\n                        this.error(item, e.data.info);\n                    }\n                }\n            }\n        }\n    }\n\n    create(src) {\n        const id = ++this._id;\n        const item = new ImageWorkerImage(this, id, src);\n        this._items.set(id, item);\n        this._worker.postMessage({type: \"add\", id: id, src: src});\n        return item;\n    }\n\n    cancel(image) {\n        this._worker.postMessage({type: \"cancel\", id: image.id});\n        this._items.delete(image.id);\n    }\n\n    error(image, info) {\n        image.error(info);\n        this._items.delete(image.id);\n    }\n\n    finish(image, info) {\n        image.load(info);\n        this._items.delete(image.id);\n    }\n\n}\n\nclass ImageWorkerImage {\n\n    constructor(manager, id, src) {\n        this._manager = manager;\n        this._id = id;\n        this._src = src;\n        this._onError = null;\n        this._onLoad = null;\n    }\n\n    get id() {\n        return this._id;\n    }\n\n    get src() {\n        return this._src;\n    }\n\n    set onError(f) {\n        this._onError = f;\n    }\n\n    set onLoad(f) {\n        this._onLoad = f;\n    }\n\n    cancel() {\n        this._manager.cancel(this);\n    }\n\n    load(info) {\n        if (this._onLoad) {\n            this._onLoad(info);\n        }\n    }\n\n    error(info) {\n        if (this._onError) {\n            this._onError(info);\n        }\n    }\n\n}\n\n/**\n * Notice that, within the createWorker function, we must only use ES5 code to keep it ES5-valid after babelifying, as\n *  the converted code of this section is converted to a blob and used as the js of the web worker thread.\n */\nconst createWorker = function() {\n\n    function ImageWorkerServer() {\n\n        this.items = new Map();\n\n        var t = this;\n        onmessage = function(e) {\n            t._receiveMessage(e);\n        }\n\n    }\n\n    ImageWorkerServer.isPathAbsolute = function(path) {\n        return /^(?:\\/|[a-z]+:\\/\\/)/.test(path) || path.substr(0, 5) == 'data:';\n    };\n\n    ImageWorkerServer.prototype._receiveMessage = function(e) {\n        if (e.data.type === 'config') {\n            this.config = e.data.config;\n\n            var base = this.config.path;\n            // the constructing of the basepath fails\n            // if location.hash contains a slash\n            var hasHashPath = /#.*?\\//;\n            if(hasHashPath.test(base)){\n                base = base.replace(/#.*$/,'');\n            }\n\n            var parts = base.split(\"/\");\n            parts.pop();\n            this._relativeBase = parts.join(\"/\") + \"/\";\n\n        } else if (e.data.type === 'add') {\n            this.add(e.data.id, e.data.src);\n        } else if (e.data.type === 'cancel') {\n            this.cancel(e.data.id);\n        }\n    };\n\n    ImageWorkerServer.prototype.add = function(id, src) {\n        // Convert relative URLs.\n        if (!ImageWorkerServer.isPathAbsolute(src)) {\n            src = this._relativeBase + src;\n        }\n\n        if (src.substr(0,2) === \"//\") {\n            // This doesn't work for image workers.\n            src = this.config.protocol + src;\n        }\n\n        var item = new ImageWorkerServerItem(id, src);\n        var t = this;\n        item.onFinish = function(result) {\n            t.finish(item, result);\n        };\n        item.onError = function(info) {\n            t.error(item, info);\n        };\n        this.items.set(id, item);\n        item.start();\n    };\n\n    ImageWorkerServer.prototype.cancel = function(id) {\n        var item = this.items.get(id);\n        if (item) {\n            item.cancel();\n            this.items.delete(id);\n        }\n    }\n\n    ImageWorkerServer.prototype.finish = function(item, {imageBitmap, hasAlphaChannel}) {\n        postMessage({\n            type: \"data\",\n            id: item.id,\n            info: {\n                imageBitmap,\n                hasAlphaChannel\n            }\n        }, [imageBitmap]);\n        this.items.delete(item.id);\n    };\n\n    ImageWorkerServer.prototype.error = function(item, {type, message}) {\n        postMessage({\n            type: \"error\",\n            id: item.id,\n            info: {\n                type,\n                message\n            }\n        });\n        this.items.delete(item.id);\n    };\n\n    ImageWorkerServer.isWPEBrowser = function() {\n        return (navigator.userAgent.indexOf(\"WPE\") !== -1);\n    };\n\n    function ImageWorkerServerItem(id, src) {\n\n        this._onError = undefined;\n        this._onFinish = undefined;\n        this._id = id;\n        this._src = src;\n        this._xhr = undefined;\n        this._mimeType = undefined;\n        this._canceled = false;\n\n    }\n\n    Object.defineProperty(ImageWorkerServerItem.prototype, 'id', {\n        get: function() {\n            return this._id;\n        }\n    });\n\n    Object.defineProperty(ImageWorkerServerItem.prototype, 'onFinish', {\n        get: function() {\n            return this._onFinish;\n        },\n        set: function(f) {\n            this._onFinish = f;\n        }\n    });\n\n    Object.defineProperty(ImageWorkerServerItem.prototype, 'onError', {\n        get: function() {\n            return this._onError;\n        },\n        set: function(f) {\n            this._onError = f;\n        }\n    });\n\n    ImageWorkerServerItem.prototype.start = function() {\n        this._xhr = new XMLHttpRequest();\n        this._xhr.open(\"GET\", this._src, true);\n        this._xhr.responseType = \"blob\";\n\n        var t = this;\n        this._xhr.onerror = function(oEvent) {\n            t.error({type: \"connection\", message: \"Connection error\"});\n        };\n\n        this._xhr.onload = function(oEvent) {\n            var blob = t._xhr.response;\n            t._mimeType = blob.type;\n\n            t._createImageBitmap(blob);\n        };\n\n        this._xhr.send();\n    };\n\n    ImageWorkerServerItem.prototype._createImageBitmap = function(blob) {\n        var t = this;\n        createImageBitmap(blob, {premultiplyAlpha: 'premultiply', colorSpaceConversion: 'none', imageOrientation: 'none'}).then(function(imageBitmap) {\n            t.finish({\n                imageBitmap,\n                hasAlphaChannel: t._hasAlphaChannel()\n            });\n        }).catch(function(e) {\n            t.error({type: \"parse\", message: \"Error parsing image data\"});\n        });\n    };\n\n    ImageWorkerServerItem.prototype._hasAlphaChannel = function() {\n        if (ImageWorkerServer.isWPEBrowser()) {\n            // When using unaccelerated rendering image (https://github.com/WebPlatformForEmbedded/WPEWebKit/blob/wpe-20170728/Source/WebCore/html/ImageBitmap.cpp#L52),\n            // everything including JPG images are in RGBA format. Upload is way faster when using an alpha channel.\n            // @todo: after hardware acceleration is fixed and re-enabled, JPG should be uploaded in RGB to get the best possible performance and memory usage.\n            return true;\n        } else {\n            return (this._mimeType.indexOf(\"image/png\") !== -1);\n        }\n    };\n\n    ImageWorkerServerItem.prototype.cancel = function() {\n        if (this._canceled) return;\n        if (this._xhr) {\n            this._xhr.abort();\n        }\n        this._canceled = true;\n    };\n\n    ImageWorkerServerItem.prototype.error = function(type, message) {\n        if (!this._canceled && this._onError) {\n            this._onError({type, message});\n        }\n    };\n\n    ImageWorkerServerItem.prototype.finish = function(info) {\n        if (!this._canceled && this._onFinish) {\n            this._onFinish(info);\n        }\n    };\n\n    var worker = new ImageWorkerServer();\n};\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Utils from \"../../tree/Utils.mjs\";\nimport ImageWorker from \"./ImageWorker.mjs\";\n\n/**\n * Platform-specific functionality.\n */\nexport default class WebPlatform {\n\n    init(stage) {\n        this.stage = stage;\n        this._looping = false;\n        this._awaitingLoop = false;\n\n        // Alternative handler to avoid RAF when idle\n        this._loopHandler = null;\n        this._idleLoopCounter = 0;\n        this._idleLoopDelay = 60;\n\n        if (this.stage.getOption(\"useImageWorker\")) {\n            if (!window.createImageBitmap || !window.Worker) {\n                console.warn(\"[Lightning] Can't use image worker because browser does not have createImageBitmap and Web Worker support\");\n            } else {\n                this._imageWorker = new ImageWorker();\n            }\n        }\n\n        this._registerVisibilityChangeHandler();\n    }\n\n    destroy() {\n        if (this._imageWorker) {\n            this._imageWorker.destroy();\n        }\n\n        clearInterval(this._loopHandler);\n\n        this._removeKeyHandler();\n        this._removeClickHandler();\n        this._removeHoverHandler();\n        this._removeScrollWheelHandler();\n        this._removeVisibilityChangeHandler();\n\n        this.stage = null;\n        delete this.stage;\n    }\n\n    startLoop() {\n        this._looping = true;\n        if (!this._awaitingLoop) {\n            this.loop();\n        }\n    }\n\n    stopLoop() {\n        this._looping = false;\n    }\n\n    switchLoop() {\n        if (this._idleLoopCounter < this._idleLoopDelay) {\n            this._idleLoopCounter++;\n            return;\n        }\n        if (!this.stage.ctx.hasRenderUpdates()) {\n            this.stopLoop();\n            this._loopHandler = setInterval(() => {\n                this.stage.updateFrame();\n                this.stage.idleFrame();\n                if (this.stage.ctx.hasRenderUpdates()) {\n                    clearInterval(this._loopHandler);\n                    this.startLoop();\n                };\n            }, 1000 / 60);\n        } else {\n            this._idleLoopCounter = 0;\n        }\n    }\n\n    loop() {\n        let self = this;\n        let lp = function () {\n            self._awaitingLoop = false;\n            if (self._looping) {\n                self.stage.updateFrame();\n                if (self.stage.getOption(\"pauseRafLoopOnIdle\")) {\n                    self.switchLoop();\n                }\n                self.stage.renderFrame();\n                requestAnimationFrame(lp);\n                self._awaitingLoop = true;\n            }\n        }\n        requestAnimationFrame(lp);\n    }\n\n    uploadCompressedGlTexture(gl, textureSource, source, options) {\n        const view = !source.pvr ? new DataView(source.mipmaps[0]) : source.mipmaps[0];\n        gl.compressedTexImage2D(\n            gl.TEXTURE_2D,\n            0,\n            source.glInternalFormat,\n            source.pixelWidth,\n            source.pixelHeight,\n            0,\n            view,\n        )\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    }\n\n    uploadGlTexture(gl, textureSource, source, options) {\n        if (source instanceof ImageData || source instanceof HTMLImageElement || source instanceof HTMLVideoElement || (window.ImageBitmap && source instanceof ImageBitmap)) {\n            // Web-specific data types.\n            gl.texImage2D(gl.TEXTURE_2D, 0, options.internalFormat, options.format, options.type, source);\n        } else if (source instanceof HTMLCanvasElement) {\n            if (Utils.isZiggo || this.stage.getOption(\"forceTxCanvasSource\")) {\n                // Ziggo EOS and Selene have issues with getImageData implementation causing artifacts.\n                gl.texImage2D(gl.TEXTURE_2D, 0, options.internalFormat, options.format, options.type, source);\n            } else if (source.width > 0 && source.height > 0) {\n                // Workaround for some browsers (e.g. Tizen) as they do not convert canvas data to texture correctly, sometimes causing artifacts.\n                // Width/Height check added because of https://github.com/rdkcentral/Lightning/issues/412\n                const ctx = source.getContext('2d');\n                gl.texImage2D(gl.TEXTURE_2D, 0, options.internalFormat, options.format, options.type, ctx.getImageData(0, 0, source.width, source.height));\n            }\n        } else {\n            gl.texImage2D(gl.TEXTURE_2D, 0, options.internalFormat, textureSource.w, textureSource.h, 0, options.format, options.type, source);\n        }\n    }\n\n    /**\n     * KTX File format specification\n     * https://www.khronos.org/registry/KTX/specs/1.0/ktxspec_v1.html\n     **/\n    handleKtxLoad(cb, src) {\n        var self = this;\n        return function () {\n            var arraybuffer = this.response;\n            var view = new DataView(arraybuffer);\n\n            // identifier, big endian\n            var targetIdentifier = 3632701469\n            if (targetIdentifier !== (view.getUint32(0) + view.getUint32(4) + view.getUint32(8))) {\n                cb('Parsing failed: identifier ktx mismatch:', src)\n            }\n\n            var littleEndian = (view.getUint32(12) === 16909060) ? true : false;\n            var data = {\n                glType: view.getUint32(16, littleEndian),\n                glTypeSize: view.getUint32(20, littleEndian),\n                glFormat: view.getUint32(24, littleEndian),\n                glInternalFormat: view.getUint32(28, littleEndian),\n                glBaseInternalFormat: view.getUint32(32, littleEndian),\n                pixelWidth: view.getUint32(36, littleEndian),\n                pixelHeight: view.getUint32(40, littleEndian),\n                pixelDepth: view.getUint32(44, littleEndian),\n                numberOfArrayElements: view.getUint32(48, littleEndian),\n                numberOfFaces: view.getUint32(52, littleEndian),\n                numberOfMipmapLevels: view.getUint32(56, littleEndian),\n                bytesOfKeyValueData: view.getUint32(60, littleEndian),\n                kvps: [],\n                mipmaps: [],\n                get width() { return this.pixelWidth },\n                get height() { return this.pixelHeight },\n            };\n\n            const props = (obj) => {\n                const p = [];\n                for (let v in obj) {\n                    p.push(obj[v]);\n                }\n                return p;\n            }\n\n            const formats = Object.values(self.stage.renderer.getCompressedTextureExtensions())\n                .filter((obj) => obj != null)\n                .map((obj) => props(obj))\n                .reduce((prev, current) => prev.concat(current));\n\n            if (!formats.includes(data.glInternalFormat)) {\n                console.warn(\"[Lightning] Unrecognized texture extension format:\", src, data.glInternalFormat, self.stage.renderer.getCompressedTextureExtensions());\n            }\n\n            var offset = 64\n            // Key Value Pairs of data start at byte offset 64\n            // But the only known kvp is the API version, so skipping parsing.\n            offset += data.bytesOfKeyValueData;\n\n            for (var i = 0; i < data.numberOfMipmapLevels; i++) {\n                var imageSize = view.getUint32(offset);\n                offset += 4;\n                data.mipmaps.push(view.buffer.slice(offset, imageSize));\n                offset += imageSize\n            }\n\n            cb(null, {\n                source: data,\n                renderInfo: { src: src, compressed: true },\n            })\n        }\n    }\n\n    handlePvrLoad(cb, src) {\n        return function () {\n            // pvr header length in 32 bits\n            const pvrHeaderLength = 13;\n            // for now only we only support: COMPRESSED_RGB_ETC1_WEBGL\n            const pvrFormatEtc1 = 0x8D64;\n            const pvrWidth = 7;\n            const pvrHeight = 6;\n            const pvrMipmapCount = 11;\n            const pvrMetadata = 12;\n            const arrayBuffer = this.response;\n            const header = new Int32Array(arrayBuffer, 0, pvrHeaderLength);\n            const dataOffset = header[pvrMetadata] + 52;\n            const pvrtcData = new Uint8Array(arrayBuffer, dataOffset);\n\n            var data = {\n                glInternalFormat: pvrFormatEtc1,\n                pixelWidth: header[pvrWidth],\n                pixelHeight: header[pvrHeight],\n                numberOfMipmapLevels: header[pvrMipmapCount],\n                mipmaps: [],\n                pvr: true,\n                get width() { return this.pixelWidth },\n                get height() { return this.pixelHeight },\n            };\n\n            let offset = 0\n            let width = data.pixelWidth;\n            let height = data.pixelHeight;\n\n            for (var i = 0; i < data.numberOfMipmapLevels; i++) {\n                const level = ((width + 3) >> 2) * ((height + 3) >> 2) * 8;\n                const view = new Uint8Array(arrayBuffer, pvrtcData.byteOffset + offset, level);\n                data.mipmaps.push(view);\n                offset += level;\n                width = width >> 1;\n                height = height >> 1;\n            }\n\n            cb(null, {\n                source: data,\n                renderInfo: { src: src, compressed: true },\n            })\n        }\n    }\n\n    loadSrcTexture({ src, hasAlpha }, cb) {\n        let cancelCb = undefined;\n        let isPng = (src.toLowerCase().indexOf(\".png\") >= 0) || src.substr(0, 21) == 'data:image/png;base64';\n        let isKtx = src.indexOf('.ktx') >= 0;\n        let isPvr = src.indexOf('.pvr') >= 0;\n        if (isKtx || isPvr) {\n            let request = new XMLHttpRequest();\n            request.addEventListener(\n                \"load\", isKtx ? this.handleKtxLoad(cb, src) : this.handlePvrLoad(cb, src)\n            );\n            request.open(\"GET\", src);\n            request.responseType = \"arraybuffer\";\n            request.send();\n            cancelCb = function () {\n                request.abort();\n            }\n        } else if (this._imageWorker) {\n            // WPE-specific image parser.\n            const image = this._imageWorker.create(src);\n            image.onError = function (err) {\n                return cb(\"Image load error\");\n            };\n            image.onLoad = function ({ imageBitmap, hasAlphaChannel }) {\n                cb(null, {\n                    source: imageBitmap,\n                    renderInfo: { src: src, compressed: false },\n                    hasAlpha: hasAlphaChannel,\n                    premultiplyAlpha: true\n                });\n            };\n            cancelCb = function () {\n                image.cancel();\n            }\n        } else {\n            let image = new Image();\n\n            // On the PS4 platform setting the `crossOrigin` attribute on\n            // images can cause CORS failures.\n            if (!(src.substr(0, 5) == \"data:\") && !Utils.isPS4) {\n                // Base64.\n                image.crossOrigin = \"Anonymous\";\n            }\n            image.onerror = function (err) {\n                // Ignore error message when cancelled.\n                if (image.src) {\n                    return cb(\"Image load error\");\n                }\n            };\n            image.onload = function () {\n                cb(null, {\n                    source: image,\n                    renderInfo: { src: src, compressed: false },\n                    hasAlpha: isPng || hasAlpha\n                });\n            };\n            image.src = src;\n\n            cancelCb = function () {\n                image.onerror = null;\n                image.onload = null;\n                image.removeAttribute('src');\n            }\n        }\n\n        return cancelCb;\n    }\n\n    createWebGLContext(w, h) {\n        let canvas = this.stage.getOption('canvas') || document.createElement('canvas');\n\n        if (w && h) {\n            canvas.width = w;\n            canvas.height = h;\n        }\n\n        let opts = {\n            alpha: true,\n            antialias: false,\n            premultipliedAlpha: true,\n            stencil: true,\n            preserveDrawingBuffer: false\n        };\n\n        let gl = canvas.getContext('webgl', opts) || canvas.getContext('experimental-webgl', opts) || canvas.getContext('webgl2', opts);\n\n        if (!gl) {\n            throw new Error('This browser does not support webGL.');\n        }\n\n        return gl;\n    }\n\n    createCanvasContext(w, h) {\n        let canvas = this.stage.getOption('canvas') || document.createElement('canvas');\n\n        if (w && h) {\n            canvas.width = w;\n            canvas.height = h;\n        }\n\n        let c2d = canvas.getContext('2d');\n        if (!c2d) {\n            throw new Error('This browser does not support 2d canvas.');\n        }\n\n        return c2d;\n    }\n\n    getHrTime() {\n        return window.performance ? window.performance.now() : (new Date()).getTime();\n    }\n\n    getDrawingCanvas() {\n        // We can't reuse this canvas because textures may load async.\n        return document.createElement('canvas');\n    }\n\n    getTextureOptionsForDrawingCanvas(canvas) {\n        let options = {};\n        options.source = canvas;\n        return options;\n    }\n\n    nextFrame(changes) {\n        /* WebGL blits automatically */\n    }\n\n    registerKeydownHandler(keyhandler) {\n        this._keydownListener = (e) => {\n            keyhandler(e);\n        };\n        window.addEventListener('keydown', this._keydownListener);\n    }\n\n    registerKeyupHandler(keyhandler) {\n        this._keyupListener = (e) => {\n            keyhandler(e);\n        };\n        window.addEventListener('keyup', this._keyupListener);\n    }\n\n    _removeKeyHandler() {\n        if (this._keydownListener) {\n            window.removeEventListener('keydown', this._keydownListener);\n        }\n\n        if (this._keyupListener) {\n            window.removeEventListener('keyup', this._keyupListener);\n        }\n    }\n\n    registerClickHandler(clickHandler) {\n        this._clickListener = e => {\n            clickHandler(e);\n        };\n        window.addEventListener('mousedown', this._clickListener);\n    }\n\n    _removeClickHandler() {\n        if (this._clickListener) {\n            window.removeEventListener('mousedown', this._clickListener);\n        }\n    }\n\n    registerHoverHandler(hoverHandler) {\n        this._hoverListener = e => {\n            hoverHandler(e);\n        };\n        window.addEventListener('mousemove', this._hoverListener);\n    }\n\n    _removeHoverHandler() {\n        if (this._hoverListener) {\n            window.removeEventListener('mousemove', this._hoverListener);\n        }\n    }\n\n    registerScrollWheelHandler(registerScrollWheelHandler) {\n        this._scrollWheelListener = e => {\n            registerScrollWheelHandler(e);\n        }\n        window.addEventListener('wheel', this._scrollWheelListener);\n    }\n\n    _removeScrollWheelHandler() {\n        if (this._scrollWheelListener) {\n            window.removeEventListener('wheel', this._scrollWheelListener);\n        }\n    }\n\n    /**\n     * Fix for issue reported at: https://github.com/WebPlatformForEmbedded/WPEWebKit/issues/882\n     */\n    _registerVisibilityChangeHandler() {\n        this._visibilityChangeHandler = () => {\n            if (document.visibilityState === 'visible') {\n                this.stage.root.core.setHasRenderUpdates(2);\n                this.stage.renderFrame();\n            }\n        }\n        document.addEventListener('visibilitychange', this._visibilityChangeHandler);\n    }\n\n    _removeVisibilityChangeHandler() {\n        if (this._visibilityChangeHandler) {\n            document.removeEventListener('visibilitychange', this._visibilityChangeHandler);\n        }\n    }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport WebPlatform from \"./browser/WebPlatform.mjs\";\n\nexport default class PlatformLoader {\n    static load(options) {\n        if (options.platform) {\n            return options.platform;\n        } else {\n            return WebPlatform;\n        }\n    }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass Utils {\n\n    static isFunction(value) {\n        return typeof value === 'function';\n    }\n\n    static isNumber(value) {\n        return typeof value === 'number';\n    }\n\n    static isInteger(value) {\n        return (typeof value === 'number' && (value % 1) === 0);\n    }\n\n    static isBoolean(value) {\n        return value === true || value === false;\n    }\n\n    static isString(value) {\n        return typeof value == 'string';\n    }\n\n    static isObject(value) {\n        let type = typeof value;\n        return !!value && (type == 'object' || type == 'function');\n    }\n\n    static isPlainObject(value) {\n        let type = typeof value;\n        return !!value && (type == 'object');\n    }\n\n    static isObjectLiteral(value){\n        return typeof value === 'object' && value && value.constructor === Object\n    }\n\n    static getArrayIndex(index, arr) {\n        return Utils.getModuloIndex(index, arr.length);\n    }\n\n    static equalValues(v1, v2) {\n        if ((typeof v1) !== (typeof v2)) return false\n        if (Utils.isObjectLiteral(v1)) {\n            return Utils.isObjectLiteral(v2) && Utils.equalObjectLiterals(v1, v2)\n        } else if (Array.isArray(v1)) {\n            return Array.isArray(v2) && Utils.equalArrays(v1, v2)\n        } else {\n            return v1 === v2\n        }\n    }\n\n    static equalObjectLiterals(obj1, obj2) {\n        let keys1 = Object.keys(obj1);\n        let keys2 = Object.keys(obj2);\n        if (keys1.length !== keys2.length) {\n            return false\n        }\n\n        for (let i = 0, n = keys1.length; i < n; i++) {\n            const k1 = keys1[i];\n            const k2 = keys2[i];\n            if (k1 !== k2) {\n                return false\n            }\n\n            const v1 = obj1[k1];\n            const v2 = obj2[k2];\n\n            if (!Utils.equalValues(v1, v2)) {\n                return false\n            }\n        }\n\n        return true;\n    }\n\n    static equalArrays(v1, v2) {\n        if (v1.length !== v2.length) {\n            return false\n        }\n        for (let i = 0, n = v1.length; i < n; i++) {\n            if (!this.equalValues(v1[i], v2[i])) {\n                return false\n            }\n        }\n\n        return true\n    }\n\n}\n\n/**\n * Maintains the state of a WebGLRenderingContext.\n */\nclass WebGLState {\n\n    constructor(id, gl) {\n        this._id = id;\n        this._gl = gl;\n        this._program = undefined;\n        this._buffers = new Map();\n        this._framebuffers = new Map();\n        this._renderbuffers = new Map();\n\n        // Contains vertex attribute definition arrays (enabled, size, type, normalized, stride, offset).\n        this._vertexAttribs = new Array(16);\n        this._nonDefaultFlags = new Set();\n        this._settings = new Map();\n        this._textures = new Array(8);\n        this._maxTexture = 0;\n        this._activeTexture = gl.TEXTURE0;\n        this._pixelStorei = new Array(5);\n    }\n\n    _getDefaultFlag(cap) {\n        return (cap === this._gl.DITHER);\n    }\n\n    setFlag(cap, v) {\n        const def = this._getDefaultFlag(cap);\n        if (v === def) {\n            return this._nonDefaultFlags.delete(cap);\n        } else {\n            if (!this._nonDefaultFlags.has(cap)) {\n                this._nonDefaultFlags.add(cap);\n                return true;\n            } else {\n                return false;\n            }\n        }\n    }\n\n    setBuffer(target, buffer) {\n        const change = this._buffers.get(target) !== buffer;\n        this._buffers.set(target, buffer);\n\n        if (change && (target === this._gl.ARRAY_BUFFER)) {\n            // When the array buffer is changed all attributes are cleared.\n            this._vertexAttribs = [];\n        }\n\n        return change;\n    }\n\n    setFramebuffer(target, buffer) {\n        const change = this._framebuffers.get(target) !== buffer;\n        this._framebuffers.set(target, buffer);\n        return change;\n    }\n\n    setRenderbuffer(target, buffer) {\n        const change = this._renderbuffers.get(target) !== buffer;\n        this._renderbuffers.set(target, buffer);\n        return change;\n    }\n\n    setProgram(program) {\n        const change = this._program !== program;\n        this._program = program;\n        return change\n    }\n\n    setSetting(func, v) {\n        const s = this._settings.get(func);\n        const change = !s || !Utils.equalValues(s, v);\n        this._settings.set(func, v);\n        return change\n    }\n\n    disableVertexAttribArray(index) {\n        const va = this._vertexAttribs[index];\n        if (va && va[5]) {\n            va[5] = false;\n            return true;\n        }\n        return false;\n    }\n\n    enableVertexAttribArray(index) {\n        const va = this._vertexAttribs[index];\n        if (va) {\n            if (!va[0]) {\n                va[0] = true;\n                return true;\n            }\n        } else {\n            this._vertexAttribs[index] = [0, 0, 0, 0, 0, true];\n            return true;\n        }\n        return false;\n    }\n\n    vertexAttribPointer(index, props) {\n        let va = this._vertexAttribs[index];\n        let equal = false;\n        if (va) {\n            equal = va[0] === props[0] &&\n                va[1] === props[1] &&\n                va[2] === props[2] &&\n                va[3] === props[3] &&\n                va[4] === props[4];\n        }\n\n        if (equal) {\n            return false;\n        } else {\n            props[5] = va ? va[5] : false;\n            return true;\n        }\n    }\n\n    setActiveTexture(texture) {\n        const changed = this._activeTexture !== texture;\n        this._activeTexture = texture;\n        return changed;\n    }\n\n    bindTexture(target, texture) {\n        const activeIndex = WebGLState._getTextureIndex(this._activeTexture);\n        this._maxTexture = Math.max(this._maxTexture, activeIndex + 1);\n        const current = this._textures[activeIndex];\n        const targetIndex = WebGLState._getTextureTargetIndex(target);\n        if (current) {\n            if (current[targetIndex] === texture) {\n                return false;\n            }\n            current[targetIndex] = texture;\n            return true;\n        } else {\n            if (texture) {\n                this._textures[activeIndex] = [];\n                this._textures[activeIndex][targetIndex] = texture;\n                return true\n            } else {\n                return false\n            }\n        }\n    }\n\n    setPixelStorei(pname, param) {\n        const i = WebGLState._getPixelStoreiIndex(pname);\n        const change = !Utils.equalValues(this._pixelStorei[i], param);\n        this._pixelStorei[i] = param;\n        return change;\n    }\n\n    migrate(s) {\n        const t = this;\n\n        // Warning: migrate should call the original prototype methods directly.\n\n        this._migrateFlags(t, s);\n\n        // useProgram\n        if (s._program !== t._program) {\n            this._gl._useProgram(s._program);\n        }\n\n        this._migrateFramebuffers(t, s);\n        this._migrateRenderbuffers(t, s);\n\n        const buffersChanged = this._migrateBuffers(t, s);\n        this._migrateAttributes(t, s, buffersChanged);\n\n        this._migrateFlags(t, s);\n\n        this._migrateSettings(t, s);\n\n        this._migratePixelStorei(t, s);\n        \n        this._migrateTextures(t, s);\n        \n    }\n\n    _migratePixelStorei(t, s) {\n        for (let i = 0, n = t._pixelStorei.length; i < n; i++) {\n            if (t._pixelStorei[i] !== s._pixelStorei[i]) {\n                const value = s._pixelStorei[i] !== undefined ? s._pixelStorei[i] : WebGLState._getDefaultPixelStoreiByIndex(i);\n                this._gl._pixelStorei(WebGLState._getPixelStoreiByIndex(i), value);\n            }\n        }\n    }\n\n    _migrateTextures(t, s) {\n        const max = Math.max(t._maxTexture, s._maxTexture);\n\n        let activeTexture = t._activeTexture;\n\n        for (let i = 0; i < max; i++) {\n            const sTargets = s._textures[i];\n            const tTargets = t._textures[i];\n            const textureNumb = WebGLState._getTextureByIndex(i);\n\n            const targetMax = Math.max(tTargets ? tTargets.length : 0, sTargets ? sTargets.length : 0);\n            for (let j = 0, n = targetMax; j < n; j++) {\n                const target = WebGLState._getTextureTargetByIndex(j);\n                if (activeTexture !== textureNumb) {\n                    this._gl._activeTexture(textureNumb);\n                    activeTexture = textureNumb;\n                }\n\n                const texture = (sTargets && sTargets[j]) || null;\n                this._gl._bindTexture(target, texture);\n            }\n        }\n\n        if (s._activeTexture !== activeTexture) {\n            this._gl._activeTexture(s._activeTexture);\n        }\n    }\n\n    _migrateBuffers(t, s) {\n        s._buffers.forEach((framebuffer, target) => {\n            if (t._buffers.get(target) !== framebuffer) {\n                this._gl._bindBuffer(target, framebuffer);\n            }\n        });\n\n        t._buffers.forEach((buffer, target) => {\n            const b = s._buffers.get(target);\n            if (b === undefined) {\n                this._gl._bindBuffer(target, null);\n            }\n        });\n        return (s._buffers.get(this._gl.ARRAY_BUFFER) !== t._buffers.get(this._gl.ARRAY_BUFFER))\n    }\n\n    _migrateFramebuffers(t, s) {\n        s._framebuffers.forEach((framebuffer, target) => {\n            if (t._framebuffers.get(target) !== framebuffer) {\n                this._gl._bindFramebuffer(target, framebuffer);\n            }\n        });\n\n        t._framebuffers.forEach((framebuffer, target) => {\n            const fb = s._framebuffers.get(target);\n            if (fb === undefined) {\n                this._gl._bindFramebuffer(target, null);\n            }\n        });\n    }\n\n    _migrateRenderbuffers(t, s) {\n        s._renderbuffers.forEach((renderbuffer, target) => {\n            if (t._renderbuffers.get(target) !== renderbuffer) {\n                this._gl._bindRenderbuffer(target, renderbuffer);\n            }\n        });\n\n        t._renderbuffers.forEach((renderbuffer, target) => {\n            const fb = s._renderbuffers.get(target);\n            if (fb === undefined) {\n                this._gl._bindRenderbuffer(target, null);\n            }\n        });\n    }\n\n    _migrateAttributes(t, s, buffersChanged) {\n\n        if (!buffersChanged) {\n            t._vertexAttribs.forEach((attrib, index) => {\n                if (!s._vertexAttribs[index]) {\n                    // We can't 'delete' a vertex attrib so we'll disable it.\n                    this._gl._disableVertexAttribArray(index);\n                }\n            });\n\n            s._vertexAttribs.forEach((attrib, index) => {\n                this._gl._vertexAttribPointer(index, attrib[0], attrib[1], attrib[2], attrib[4]);\n                if (attrib[5]) {\n                    this._gl._enableVertexAttribArray(index);\n                } else {\n                    this._gl._disableVertexAttribArray(index);\n                }\n            });\n        } else {\n            // When buffers are changed, previous attributes were reset automatically.\n            s._vertexAttribs.forEach((attrib, index) => {\n                if (attrib[0]) {\n                    // Do not set vertex attrib pointer when it was just the default value.\n                    this._gl._vertexAttribPointer(index, attrib[0], attrib[1], attrib[2], attrib[3], attrib[4]);\n                }\n                if (attrib[5]) {\n                    this._gl._enableVertexAttribArray(index);\n                }\n            });\n        }\n    }\n\n    _migrateSettings(t, s) {\n        const defaults = this.constructor.getDefaultSettings();\n        t._settings.forEach((value, func) => {\n            const name = func.name || func.xname;\n            if (!s._settings.has(func)) {\n                let args = defaults.get(name);\n                if (Utils.isFunction(args)) {\n                    args = args(this._gl);\n                }\n                // We are actually setting the setting for optimization purposes.\n                s._settings.set(func, args);\n                func.apply(this._gl, args);\n            }\n        });\n        s._settings.forEach((value, func) => {\n            const tValue = t._settings.get(func);\n            if (!tValue || !Utils.equalValues(tValue, value)) {\n                func.apply(this._gl, value);\n            }\n        });\n    }\n\n    _migrateFlags(t, s) {\n        t._nonDefaultFlags.forEach(setting => {\n            if (!s._nonDefaultFlags.has(setting)) {\n                if (this._getDefaultFlag(setting)) {\n                    this._gl._enable(setting);\n                } else {\n                    this._gl._disable(setting);\n                }\n            }\n        });\n        s._nonDefaultFlags.forEach(setting => {\n            if (!t._nonDefaultFlags.has(setting)) {\n                if (this._getDefaultFlag(setting)) {\n                    this._gl._disable(setting);\n                } else {\n                    this._gl._enable(setting);\n                }\n            }\n        });\n    }\n\n    static getDefaultSettings() {\n        if (!this._defaultSettings) {\n            this._defaultSettings = new Map();\n            const d = this._defaultSettings;\n            const g = WebGLRenderingContext.prototype;\n            d.set(\"viewport\", function(gl) {return [0,0,gl.canvas.width, gl.canvas.height]});\n            d.set(\"scissor\", function(gl) {return [0,0,gl.canvas.width, gl.canvas.height]});\n            d.set(\"blendColor\", [0, 0, 0, 0]);\n            d.set(\"blendEquation\", [g.FUNC_ADD]);\n            d.set(\"blendEquationSeparate\", [g.FUNC_ADD, g.FUNC_ADD]);\n            d.set(\"blendFunc\", [g.ONE, g.ZERO]);\n            d.set(\"blendFuncSeparate\", [g.ONE, g.ZERO, g.ONE, g.ZERO]);\n            d.set(\"clearColor\", [0, 0, 0, 0]);\n            d.set(\"clearDepth\", [1]);\n            d.set(\"clearStencil\", [0]);\n            d.set(\"colorMask\", [true, true, true, true]);\n            d.set(\"cullFace\", [g.BACK]);\n            d.set(\"depthFunc\", [g.LESS]);\n            d.set(\"depthMask\", [true]);\n            d.set(\"depthRange\", [0, 1]);\n            d.set(\"frontFace\", [g.CCW]);\n            d.set(\"lineWidth\", [1]);\n            d.set(\"polygonOffset\", [0, 0]);\n            d.set(\"sampleCoverage\", [1, false]);\n            d.set(\"stencilFunc\", [g.ALWAYS, 0, 1]);\n            d.set(\"_stencilFuncSeparateFront\", [g.ALWAYS, 0, 1]);\n            d.set(\"_stencilFuncSeparateBack\", [g.ALWAYS, 0, 1]);\n            d.set(\"_stencilFuncSeparateFrontAndBack\", [g.ALWAYS, 0, 1]);\n            d.set(\"stencilMask\", [1]);\n            d.set(\"_stencilMaskSeparateFront\", [1]);\n            d.set(\"_stencilMaskSeparateBack\", [1]);\n            d.set(\"_stencilMaskSeparateFrontAndBack\", [1]);\n            d.set(\"stencilOp\", [g.KEEP, g.KEEP, g.KEEP]);\n            d.set(\"_stencilOpSeparateFront\", [g.KEEP, g.KEEP, g.KEEP]);\n            d.set(\"_stencilOpSeparateBack\", [g.KEEP, g.KEEP, g.KEEP]);\n            d.set(\"_stencilOpSeparateFrontAndBack\", [g.KEEP, g.KEEP, g.KEEP]);\n            d.set(\"vertexAttrib1f\", []);\n            d.set(\"vertexAttrib1fv\", []);\n            d.set(\"vertexAttrib2f\", []);\n            d.set(\"vertexAttrib2fv\", []);\n            d.set(\"vertexAttrib3f\", []);\n            d.set(\"vertexAttrib3fv\", []);\n            d.set(\"vertexAttrib4f\", []);\n            d.set(\"vertexAttrib4fv\", []);\n        }\n        return this._defaultSettings\n    }\n\n    static _getTextureTargetIndex(target) {\n        switch(target) {\n            case 0x0DE1:\n                /* TEXTURE_2D */\n                return 0;\n            case 0x8513:\n                /* TEXTURE_CUBE_MAP */\n                return 1;\n            default:\n                // Shouldn't happen.\n                throw new Error('Unknown texture target: ' + target);\n        }\n    }\n\n    static _getTextureTargetByIndex(index) {\n        if (!this._textureTargetIndices) {\n            this._textureTargetIndices = [0x0DE1, 0x8513];\n        }\n        return this._textureTargetIndices[index]\n    }\n\n    static _getTextureIndex(index) {\n        return index - 0x84C0 /* GL_TEXTURE0 */;\n    }\n\n    static _getTextureByIndex(index) {\n        return index + 0x84C0;\n    }\n\n    static _getPixelStoreiIndex(pname) {\n        switch(pname) {\n            case 0x0D05:\n                /* PACK_ALIGNMENT */\n                return 0;\n            case 0x0CF5:\n                /* UNPACK_ALIGNMENT */\n                return 1;\n            case 0x9240:\n                /* UNPACK_FLIP_Y_WEBGL */\n                return 2;\n            case 0x9241:\n                /* UNPACK_PREMULTIPLY_ALPHA_WEBGL */\n                return 3;\n            case 0x9243:\n                /* UNPACK_COLORSPACE_CONVERSION_WEBGL */\n                return 4;\n                //@todo: support WebGL2 properties, see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/pixelStorei\n            case 0x9245:\n                /* UNPACK_FLIP_BLUE_RED */\n                return 5;\n            default:\n                // Shouldn't happen.\n                throw new Error('Unknown pixelstorei: ' + pname);\n        }\n    }\n\n    static _getPixelStoreiByIndex(index) {\n        if (!this._pixelStoreiIndices) {\n            this._pixelStoreiIndices = [0x0D05, 0x0CF5, 0x9240, 0x9241, 0x9243];\n        }\n        return this._pixelStoreiIndices[index]\n    }\n\n    static _getDefaultPixelStoreiByIndex(index) {\n        if (!this._pixelStoreiDefaults) {\n            this._pixelStoreiDefaults = [4, 4, false, false, WebGLRenderingContext.prototype.BROWSER_DEFAULT_WEBGL];\n        }\n        return this._pixelStoreiDefaults[index]\n    }\n}\n\nclass WebGLStateManager {\n\n    _initStateManager(id = \"default\") {\n        this._states = {};\n        this._state = this._getState(id);\n    }\n\n    _getState(id) {\n        if (!this._states[id]) {\n            this._states[id] = new WebGLState(id, this);\n        }\n        return this._states[id];\n    }\n\n    switchState(id = \"default\") {\n        if (this._state._id !== id) {\n            const newState = this._getState(id);\n            this._state.migrate(newState);\n            this._state = newState;\n        }\n    }\n\n    $useProgram(program) {\n        if (this._state.setProgram(program))\n            this._useProgram(program);\n    }\n\n    $bindBuffer(target, fb) {\n        if (this._state.setBuffer(target, fb))\n            this._bindBuffer(target, fb);\n    }\n\n    $bindFramebuffer(target, fb) {\n        if (this._state.setFramebuffer(target, fb))\n            this._bindFramebuffer(target, fb);\n    }\n\n    $bindRenderbuffer(target, fb) {\n        if (this._state.setRenderbuffer(target, fb))\n            this._bindRenderbuffer(target, fb);\n    }\n\n    $enable(cap) {\n        if (this._state.setFlag(cap, true))\n            this._enable(cap);\n    }\n\n    $disable(cap) {\n        if (this._state.setFlag(cap, false))\n            this._disable(cap);\n    }\n\n    $viewport(x, y, w, h) {\n        if (this._state.setSetting(this._viewport, [x, y, w, h]))\n            this._viewport(x, y, w, h);\n    }\n\n    $scissor(x, y, w, h) {\n        if (this._state.setSetting(this._scissor, [x, y, w, h]))\n            this._scissor(x, y, w, h);\n    }\n\n    $disableVertexAttribArray(index) {\n        if (this._state.disableVertexAttribArray(index))\n            this._disableVertexAttribArray(index);\n    }\n\n    $enableVertexAttribArray(index) {\n        if (this._state.enableVertexAttribArray(index))\n            this._enableVertexAttribArray(index);\n    }\n\n    $vertexAttribPointer(index, size, type, normalized, stride, offset) {\n        if (this._state.vertexAttribPointer(index, [size, type, normalized, stride, offset]))\n            this._vertexAttribPointer(index, size, type, normalized, stride, offset);\n    }\n\n    $activeTexture(texture) {\n        if (this._state.setActiveTexture(texture))\n            this._activeTexture(texture);\n    }\n\n    $bindTexture(target, texture) {\n        if (this._state.bindTexture(target, texture))\n            this._bindTexture(target, texture);\n    }\n\n    $pixelStorei(pname, param) {\n        if (this._state.setPixelStorei(pname, param)) {\n            this._pixelStorei(pname, param);\n        }\n    }\n\n    $stencilFuncSeparate(face, func, ref, mask) {\n        let f;\n        switch(face) {\n            case this.FRONT:\n                f = this._stencilFuncSeparateFront;\n                break;\n            case this.BACK:\n                f = this._stencilFuncSeparateBack;\n                break;\n            case this.FRONT_AND_BACK:\n                f = this._stencilFuncSeparateFrontAndBack;\n                break;\n        }\n\n        if (this._state.setSetting(f, [func, ref, mask]))\n            f.apply(this, [func, ref, mask]);\n    }\n\n    _stencilFuncSeparateFront(func, ref, mask) {\n        this._stencilFuncSeparate(this.FRONT, func, ref, mask);\n    }\n\n    _stencilFuncSeparateBack(func, ref, mask) {\n        this._stencilFuncSeparate(this.BACK, func, ref, mask);\n    }\n\n    _stencilFuncSeparateFrontAndBack(func, ref, mask) {\n        this._stencilFuncSeparate(this.FRONT_AND_BACK, func, ref, mask);\n    }\n\n    $stencilMaskSeparate(face, mask) {\n        let f;\n        switch(face) {\n            case this.FRONT:\n                f = this._stencilMaskSeparateFront;\n                break;\n            case this.BACK:\n                f = this._stencilMaskSeparateBack;\n                break;\n            case this.FRONT_AND_BACK:\n                f = this._stencilMaskSeparateFrontAndBack;\n                break;\n        }\n\n        if (this._state.setSetting(f, [mask]))\n            f.apply(this, [mask]);\n    }\n\n    _stencilMaskSeparateFront(mask) {\n        this._stencilMaskSeparate(this.FRONT, mask);\n    }\n\n    _stencilMaskSeparateBack(mask) {\n        this._stencilMaskSeparate(this.BACK, mask);\n    }\n\n    _stencilMaskSeparateFrontAndBack(mask) {\n        this._stencilMaskSeparate(this.FRONT_AND_BACK, mask);\n    }\n\n    $stencilOpSeparate(face, fail, zfail, zpass) {\n        let f;\n        switch(face) {\n            case this.FRONT:\n                f = this._stencilOpSeparateFront;\n                break;\n            case this.BACK:\n                f = this._stencilOpSeparateBack;\n                break;\n            case this.FRONT_AND_BACK:\n                f = this._stencilOpSeparateFrontAndBack;\n                break;\n        }\n\n        if (this._state.setSetting(f, [fail, zfail, zpass]))\n            f.apply(this, [fail, zfail, zpass]);\n    }\n\n    _stencilOpSeparateFront(fail, zfail, zpass) {\n        this._stencilOpSeparate(this.FRONT, fail, zfail, zpass);\n    }\n\n    _stencilOpSeparateBack(fail, zfail, zpass) {\n        this._stencilOpSeparate(this.BACK, fail, zfail, zpass);\n    }\n\n    _stencilOpSeparateFrontAndBack(fail, zfail, zpass) {\n        this._stencilOpSeparate(this.FRONT_AND_BACK, fail, zfail, zpass);\n    }\n\n    $blendColor(red, green, blue, alpha) {\n        if (this._state.setSetting(this._blendColor, [red, green, blue, alpha]))\n            this._blendColor(red, green, blue, alpha);\n    }\n\n    $blendEquation(mode) {\n        if (this._state.setSetting(this._blendEquation, [mode]))\n            this._blendEquation(mode);\n    }\n\n    $blendEquationSeparate(modeRGB, modeAlpha) {\n        if (this._state.setSetting(this._blendEquationSeparate, [modeRGB, modeAlpha]))\n            this._blendEquationSeparate(modeRGB, modeAlpha);\n    }\n\n    $blendFunc(sfactor, dfactor) {\n        if (this._state.setSetting(this._blendFunc, [sfactor, dfactor]))\n            this._blendFunc(sfactor, dfactor);\n    }\n\n    $blendFuncSeparate(srcRGB, dstRGB, srcAlpha, dstAlpha) {\n        if (this._state.setSetting(this._blendFuncSeparate, [srcRGB, dstRGB, srcAlpha, dstAlpha]))\n            this._blendFuncSeparate(srcRGB, dstRGB, srcAlpha, dstAlpha);\n    }\n\n    $clearColor(red, green, blue, alpha) {\n        if (this._state.setSetting(this._clearColor, [red, green, blue, alpha]))\n            this._clearColor(red, green, blue, alpha);\n    }\n\n    $clearDepth(depth) {\n        if (this._state.setSetting(this._clearDepth, [depth]))\n            this._clearDepth(depth);\n    }\n\n    $clearStencil(s) {\n        if (this._state.setSetting(this._clearStencil, [s]))\n            this._clearStencil(s);\n    }\n\n    $colorMask(red, green, blue, alpha) {\n        if (this._state.setSetting(this._colorMask, [red, green, blue, alpha]))\n            this._colorMask(red, green, blue, alpha);\n    }\n\n    $cullFace(mode) {\n        if (this._state.setSetting(this._cullFace, [mode]))\n            this._cullFace(mode);\n    }\n\n    $depthFunc(func) {\n        if (this._state.setSetting(this._depthFunc, [func]))\n            this._depthFunc(func);\n    }\n\n    $depthMask(flag) {\n        if (this._state.setSetting(this._depthMask, [flag]))\n            this._depthMask(flag);\n    }\n\n    $depthRange(zNear, zFar) {\n        if (this._state.setSetting(this._depthRange, [zNear, zFar]))\n            this._depthRange(zNear, zFar);\n    }\n\n    $frontFace(mode) {\n        if (this._state.setSetting(this._frontFace, [mode]))\n            this._frontFace(mode);\n    }\n\n    $lineWidth(width) {\n        if (this._state.setSetting(this._lineWidth, [width]))\n            this._lineWidth(width);\n    }\n\n    $polygonOffset(factor, units) {\n        if (this._state.setSetting(this._polygonOffset, [factor, units]))\n            this._polygonOffset(factor, units);\n    }\n\n    $sampleCoverage(value, invert) {\n        if (this._state.setSetting(this._sampleCoverage, [value, invert]))\n            this._sampleCoverage(value, invert);\n    }\n\n    $stencilFunc(func, ref, mask) {\n        if (this._state.setSetting(this._stencilFunc, [func, ref, mask]))\n            this._stencilFunc(func, ref, mask);\n    }\n\n    $stencilMask(mask) {\n        if (this._state.setSetting(this._stencilMask, [mask]))\n            this._stencilMask(mask);\n    }\n\n    $stencilOp(fail, zfail, zpass) {\n        if (this._state.setSetting(this._stencilOp, [fail, zfail, zpass]))\n            this._stencilOp(fail, zfail, zpass);\n    }\n\n    $vertexAttrib1f(indx, x) {\n        if (this._state.setSetting(this._vertexAttrib1f, [indx, x]))\n            this._vertexAttrib1f(indx, x);\n    }\n\n    $vertexAttrib1fv(indx, values) {\n        if (this._state.setSetting(this._vertexAttrib1fv, [indx, values]))\n            this._vertexAttrib1fv(indx, values);\n    }\n\n    $vertexAttrib2f(indx, x, y) {\n        if (this._state.setSetting(this._vertexAttrib2f, [indx, x, y]))\n            this._vertexAttrib2f(indx, x, y);\n    }\n\n    $vertexAttrib2fv(indx, values) {\n        if (this._state.setSetting(this._vertexAttrib2fv, [indx, values]))\n            this._vertexAttrib2fv(indx, values);\n    }\n\n    $vertexAttrib3f(indx, x, y, z) {\n        if (this._state.setSetting(this._vertexAttrib3f, [indx, x, y, z]))\n            this._vertexAttrib3f(indx, x, y, z);\n    }\n\n    $vertexAttrib3fv(indx, values) {\n        if (this._state.setSetting(this._vertexAttrib3fv, [indx, values]))\n            this._vertexAttrib3fv(indx, values);\n    }\n\n    $vertexAttrib4f(indx, x, y, z, w) {\n        if (this._state.setSetting(this._vertexAttrib4f, [indx, x, y, z, w]))\n            this._vertexAttrib4f(indx, x, y, z, w);\n    }\n\n    $vertexAttrib4fv(indx, values) {\n        if (this._state.setSetting(this._vertexAttrib4fv, [indx, values]))\n            this._vertexAttrib4fv(indx, values);\n    }\n\n    /**\n     * Sets up the rendering context for context sharing.\n     * @param {WebGLRenderingContext} gl\n     * @param {string} id\n     */\n    static enable(gl, id = \"default\") {\n        const names = Object.getOwnPropertyNames(WebGLStateManager.prototype);\n        const WebGLRenderingContextProto = gl.__proto__;\n        names.forEach(name => {\n            if (name !== \"constructor\") {\n                const method = WebGLStateManager.prototype[name];\n                if (name.charAt(0) === \"$\") {\n                    name = name.substr(1);\n                }\n                if (gl[name] !== method) {\n                    if (gl[name]) {\n                        if (!gl[name].name) {\n                            // We do this for compatibility with the Chrome WebGL Inspector plugin.\n                            gl[name].xname = name;\n                        }\n                        gl['_' + name] = gl[name];\n                    }\n                    gl[name] = method;\n                }\n            }\n        });\n\n        WebGLStateManager.prototype._initStateManager.call(gl, id);\n\n        return gl;\n    }\n\n}\n\nexport default WebGLStateManager;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport TextureSource from \"./TextureSource.mjs\";\nimport Stage from './Stage.mjs';\n\nexport default class TextureManager {\n\n    constructor(stage) {\n        this.stage = stage;\n\n        /**\n         * The currently used amount of texture memory.\n         * @type {number}\n         */\n        this._usedMemory = 0;\n\n        /**\n         * All uploaded texture sources.\n         * @type {TextureSource[]}\n         */\n        this._uploadedTextureSources = [];\n\n        /**\n         * The texture source lookup id to texture source hashmap.\n         * @type {Map<String, TextureSource>}\n         */\n        this.textureSourceHashmap = new Map();\n\n    }\n\n    get usedMemory() {\n        return this._usedMemory;\n    }\n\n    destroy() {\n        for (let i = 0, n = this._uploadedTextureSources.length; i < n; i++) {\n            this._nativeFreeTextureSource(this._uploadedTextureSources[i]);\n        }\n        \n        this.textureSourceHashmap.clear();\n        this._usedMemory = 0;\n    }\n\n    getReusableTextureSource(id) {\n        return this.textureSourceHashmap.get(id);\n    }\n\n    getTextureSource(func, id) {\n        // Check if texture source is already known.\n        let textureSource = id ? this.textureSourceHashmap.get(id) : null;\n        if (!textureSource) {\n            // Create new texture source.\n            textureSource = new TextureSource(this, func);\n\n            if (id) {\n                textureSource.lookupId = id;\n                this.textureSourceHashmap.set(id, textureSource);\n            }\n        }\n\n        return textureSource;\n    }\n\n    uploadTextureSource(textureSource, options) {\n        if (textureSource.isLoaded()) return;\n\n        this._addMemoryUsage(textureSource.w * textureSource.h);\n\n        // Load texture.\n        const nativeTexture = this._nativeUploadTextureSource(textureSource, options);\n\n        textureSource._nativeTexture = nativeTexture;\n\n        // We attach w and h to native texture (we need it in CoreRenderState._isRenderTextureReusable).\n        nativeTexture.w = textureSource.w;\n        nativeTexture.h = textureSource.h;\n\n        nativeTexture.update = this.stage.frameCounter;\n\n        this._uploadedTextureSources.push(textureSource);\n        \n        this.addToLookupMap(textureSource);\n\n        // add VRAM tracking if using the webgl renderer\n        this._updateVramUsage(textureSource, 1);\n    }\n\n    _addMemoryUsage(delta) {\n        this._usedMemory += delta;\n        this.stage.addMemoryUsage(delta);\n    }\n\n    _updateVramUsage(textureSource, sign) {\n        const nativeTexture = textureSource.nativeTexture;\n        var usage;\n\n        // do nothing if webgl isn't even supported\n        if (!Stage.isWebglSupported())\n            return;\n\n        // or if there is no native texture\n        if (!textureSource.isLoaded())\n            return;\n\n        // or, finally, if there is no bytes per pixel specified\n        if (!nativeTexture.hasOwnProperty('bytesPerPixel') || isNaN(nativeTexture.bytesPerPixel))\n            return;\n\n        usage = sign * (textureSource.w * textureSource.h * nativeTexture.bytesPerPixel);\n\n        this.stage.addVramUsage(usage, textureSource.hasAlpha);\n    }\n\n    addToLookupMap(textureSource) {\n        const lookupId = textureSource.lookupId;\n        if (lookupId) {\n            if (!this.textureSourceHashmap.has(lookupId)) {\n                this.textureSourceHashmap.set(lookupId, textureSource);\n            }\n        }\n    }\n\n    gc() {\n        this.freeUnusedTextureSources();\n        this._cleanupLookupMap();\n    }\n    \n    freeUnusedTextureSources() {\n        let remainingTextureSources = [];\n        for (let i = 0, n = this._uploadedTextureSources.length; i < n; i++) {\n            let ts = this._uploadedTextureSources[i];\n            if (ts.allowCleanup()) {\n                this._freeManagedTextureSource(ts);\n            } else {\n                remainingTextureSources.push(ts);\n            }\n        }\n\n        this._uploadedTextureSources = remainingTextureSources;\n\n        this._cleanupLookupMap();\n    }\n\n    _freeManagedTextureSource(textureSource) {\n        if (textureSource.isLoaded()) {\n            this._nativeFreeTextureSource(textureSource);\n            this._addMemoryUsage(-textureSource.w * textureSource.h);\n\n            // add VRAM tracking if using the webgl renderer\n            this._updateVramUsage(textureSource, -1);\n        }\n\n        // Should be reloaded.\n        textureSource.loadingSince = null;\n    }\n\n    _cleanupLookupMap() {\n        // We keep those that still have value (are being loaded or already loaded, or are likely to be reused).\n        this.textureSourceHashmap.forEach((textureSource, lookupId) => {\n            if (!(textureSource.isLoaded() || textureSource.isLoading()) && !textureSource.isUsed()) {\n                this.textureSourceHashmap.delete(lookupId);\n            }\n        });\n    }\n\n    /**\n     * Externally free texture source.\n     * @param textureSource\n     */\n    freeTextureSource(textureSource) {\n        const index = this._uploadedTextureSources.indexOf(textureSource);\n        const managed = (index !== -1);\n\n        if (textureSource.isLoaded()) {\n            if (managed) {\n                this._addMemoryUsage(-textureSource.w * textureSource.h);\n                this._uploadedTextureSources.splice(index, 1);\n            }\n            this._nativeFreeTextureSource(textureSource);\n        }\n\n        // Should be reloaded.\n        textureSource.loadingSince = null;\n    }\n\n    _nativeUploadTextureSource(textureSource, options) {\n        return this.stage.renderer.uploadTextureSource(textureSource, options);\n    }\n\n    _nativeFreeTextureSource(textureSource) {\n        this.stage.renderer.freeTextureSource(textureSource);\n        textureSource.clearNativeTexture();\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Allows throttling of loading texture sources, keeping the app responsive.\n */\nexport default class TextureThrottler {\n\n    constructor(stage) {\n        this.stage = stage;\n\n        this.genericCancelCb = (textureSource) => {\n            this._remove(textureSource);\n        };\n\n        this._sources = [];\n        this._data = [];\n    }\n\n    destroy() {\n        this._sources = [];\n        this._data = [];\n        this.stage = null;\n\n        delete this._sources;\n        delete this._data;\n        delete this.stage;\n    }\n\n    processSome() {\n        if (this._sources.length) {\n            const start = Date.now();\n            do {\n                this._processItem();\n            } while(this._sources.length && (Date.now() - start < TextureThrottler.MAX_UPLOAD_TIME_PER_FRAME));\n        }\n    }\n\n    _processItem() {\n        const source = this._sources.pop();\n        const data = this._data.pop();\n        if (source.isLoading()) {\n            source.processLoadedSource(data);\n        }\n    }\n\n    add(textureSource, data) {\n        this._sources.push(textureSource);\n        this._data.push(data);\n    }\n\n    _remove(textureSource) {\n        const index = this._sources.indexOf(textureSource);\n        if (index >= 0) {\n            this._sources.splice(index, 1);\n            this._data.splice(index, 1);\n        }\n    }\n\n}\n\nTextureThrottler.MAX_UPLOAD_TIME_PER_FRAME = 10;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nexport default class CoreContext {\n\n    constructor(stage) {\n        this.stage = stage;\n\n        this.root = null;\n\n        this.updateTreeOrder = 0;\n\n        this.renderState = this.stage.renderer.createCoreRenderState(this);\n\n        this.renderExec = this.stage.renderer.createCoreRenderExecutor(this);\n        this.renderExec.init();\n\n        this._usedMemory = 0;\n        this._renderTexturePool = [];\n\n        this._renderTextureId = 1;\n\n        this._zSorts = [];\n\n        this.renderToTextureCount = 0;\n    }\n\n    get usedMemory() {\n        return this._usedMemory;\n    }\n\n    destroy() {\n        this._renderTexturePool.forEach(texture => this._freeRenderTexture(texture));\n        this._usedMemory = 0;\n\n        this.stage = null;\n        this.root = null;\n\n        this.renderState = null;\n        this.renderExec = null;\n        this._renderTexturePool = null;\n        this._zSorts = null;\n\n        delete this.stage;\n        delete this.root;\n        delete this.renderState;\n        delete this.renderExec;\n        delete this._renderTexturePool;\n        delete this._zSorts;\n    }\n\n    hasRenderUpdates() {\n        return !!this.root._parent._hasRenderUpdates;\n    }\n\n    render() {\n        // Clear flag to identify if anything changes before the next frame.\n        this.root._parent._hasRenderUpdates = 0;\n\n        this._render();\n    }\n\n    update() {\n        this._update();\n\n        // Due to the boundsVisibility flag feature (and onAfterUpdate hook), it is possible that other elements were\n        // changed during the update loop (for example due to the txLoaded event). We process these changes immediately\n        // (but not recursively to prevent infinite loops).\n        if (this.root._hasUpdates) {\n            this._update();\n        }\n\n        this._performForcedZSorts();\n    }\n\n    /**\n     * Certain ElementCore items may be forced to zSort to strip out references to prevent memleaks..\n     */\n    _performForcedZSorts() {\n        const n = this._zSorts.length;\n        if (n) {\n            // Forced z-sorts (ElementCore may force a z-sort in order to free memory/prevent memory leaks).\n            for (let i = 0, n = this._zSorts.length; i < n; i++) {\n                if (this._zSorts[i].zSort) {\n                    this._zSorts[i].sortZIndexedChildren();\n                }\n            }\n            this._zSorts = [];\n        }\n    }\n\n    _update() {\n        this.updateTreeOrder = 0;\n\n        this.root.update();\n    }\n\n    _render() {\n        const debugFrame = this.stage.getOption('debugFrame');\n        // Obtain a sequence of the quad operations.\n        this._fillRenderState();\n\n        if (this.stage.getOption('readPixelsBeforeDraw')) {\n            this._readPixels();\n        }\n\n        // Now run them with the render executor.\n        this._performRender();\n\n        if (debugFrame) {\n            console.log(`[Lightning] RTT Renders in frame: ${this.renderToTextureCount}`)\n        }\n\n        // Block OpenGL pipeline to prevent framebuffer flickering\n        // on certain devices\n        if (this.stage.getOption('readPixelsAfterDraw') &&\n            this.renderToTextureCount >= this.stage.getOption('readPixelsAfterDrawThreshold')\n        ) {\n            if (debugFrame) {\n                console.log(`[Lightning] readPixelsAfterDraw behavior triggered`)\n            }\n            this._readPixels();\n        }\n\n        this.renderToTextureCount = 0;\n    }\n\n    _readPixels() {\n        const pixels = new Uint8Array(4);\n        const gl = this.stage.gl;\n        gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n    }\n\n    _fillRenderState() {\n        this.renderState.reset();\n        this.root.render();\n        this.renderState.finish();\n    }\n\n    _performRender() {\n        this.renderExec.execute();\n    }\n\n    _addMemoryUsage(delta) {\n        this._usedMemory += delta;\n        this.stage.addMemoryUsage(delta);\n    }\n\n    allocateRenderTexture(w, h) {\n        let prec = this.stage.getRenderPrecision();\n        let pw = Math.max(1, Math.round(w * prec));\n        let ph = Math.max(1, Math.round(h * prec));\n\n        // Search last item first, so that last released render texture is preferred (may cause memory cache benefits).\n        const n = this._renderTexturePool.length;\n        for (let i = n - 1; i >= 0; i--) {\n            const texture = this._renderTexturePool[i];\n            // We don't want to reuse the same render textures within the same frame because that will create gpu stalls.\n            if (texture.w === pw && texture.h === ph && (texture.update !== this.stage.frameCounter)) {\n                texture.f = this.stage.frameCounter;\n                this._renderTexturePool.splice(i, 1);\n                return texture;\n            }\n        }\n\n        const texture = this._createRenderTexture(w, h, pw, ph);\n        texture.precision = prec;\n        return texture;\n    }\n\n    releaseRenderTexture(texture) {\n        this._renderTexturePool.push(texture);\n    }\n\n    freeUnusedRenderTextures(maxAge = 60) {\n        // Clean up all textures that are no longer used.\n        // This cache is short-lived because it is really just meant to supply running shaders that are\n        // updated during a number of frames.\n        let limit = this.stage.frameCounter - maxAge;\n\n        this._renderTexturePool = this._renderTexturePool.filter(texture => {\n            if (texture.f <= limit) {\n                this._freeRenderTexture(texture);\n                return false;\n            }\n            return true;\n        });\n    }\n\n    _createRenderTexture(w, h, pw, ph) {\n        this._addMemoryUsage(pw * ph);\n\n        const texture = this.stage.renderer.createRenderTexture(w, h, pw, ph);\n        texture.id = this._renderTextureId++;\n        texture.f = this.stage.frameCounter;\n        texture.ow = w;\n        texture.oh = h;\n        texture.w = pw;\n        texture.h = ph;\n\n        return texture;\n    }\n\n    _freeRenderTexture(nativeTexture) {\n        this.stage.renderer.freeRenderTexture(nativeTexture);\n        this._addMemoryUsage(-nativeTexture.w * nativeTexture.h);\n    }\n\n    copyRenderTexture(renderTexture, nativeTexture, options) {\n        this.stage.renderer.copyRenderTexture(renderTexture, nativeTexture, options);\n    }\n\n    forceZSort(elementCore) {\n        this._zSorts.push(elementCore);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport StageUtils from \"../tree/StageUtils.mjs\";\nimport Base from \"../tree/Base.mjs\";\n\nexport default class TransitionSettings {\n    constructor(stage) {\n        this.stage = stage;\n        this._timingFunction = 'ease';\n        this._timingFunctionImpl = StageUtils.getTimingFunction(this._timingFunction);\n        this.delay = 0;\n        this.duration = 0.2;\n        this.merger = null;\n    }\n\n    get timingFunction() {\n        return this._timingFunction;\n    }\n\n    set timingFunction(v) {\n        this._timingFunction = v;\n        this._timingFunctionImpl = StageUtils.getTimingFunction(v);\n    }\n\n    get timingFunctionImpl() {\n        return this._timingFunctionImpl;\n    }\n\n    patch(settings) {\n        Base.patchObject(this, settings);\n    }\n}\n\nTransitionSettings.prototype.isTransitionSettings = true;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class TransitionManager {\n\n    constructor(stage) {\n        this.stage = stage;\n\n        this.stage.on('frameStart', () => this.progress());\n\n        /**\n         * All transitions that are running and attached.\n         * (we don't support transitions on un-attached elements to prevent memory leaks)\n         * @type {Set<Transition>}\n         */\n        this.active = new Set();\n\n        this.defaultTransitionSettings = new TransitionSettings(this.stage);\n    }\n\n    progress() {\n        if (this.active.size) {\n            let dt = this.stage.dt;\n\n            let filter = false;\n            this.active.forEach(function(a) {\n                a.progress(dt);\n                if (!a.isRunning()) {\n                    filter = true;\n                }\n            });\n\n            if (filter) {\n                this.active = new Set([...this.active].filter(t => (t.isRunning())));\n            }\n        }\n    }\n\n    createSettings(settings) {\n        const transitionSettings = new TransitionSettings();\n        Base.patchObject(transitionSettings, settings);\n        return transitionSettings;\n    }\n\n    addActive(transition) {\n        this.active.add(transition);\n    }\n\n    removeActive(transition) {\n        this.active.delete(transition);\n    }\n}\n\nimport Base from \"../tree/Base.mjs\";\nimport TransitionSettings from \"./TransitionSettings.mjs\";\nimport Transition from \"./Transition.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Utils from \"../tree/Utils.mjs\";\n\nexport default class MultiSpline {\n\n    constructor() {\n        this._clear();\n    }\n\n    _clear() {\n        this._p = [];\n        this._pe = [];\n        this._idp = [];\n        this._f = [];\n        this._v = [];\n        this._lv = [];\n        this._sm = [];\n        this._s = [];\n        this._ve = [];\n        this._sme = [];\n        this._se = [];\n\n        this._length = 0;\n    }\n\n    parse(rgba, def) {\n        let i, n;\n        if (!Utils.isObjectLiteral(def)) {\n            def = {0: def}\n        }\n\n        let defaultSmoothness = 0.5;\n\n        let items = [];\n        for (let key in def) {\n            if (def.hasOwnProperty(key)) {\n                let obj = def[key];\n                if (!Utils.isObjectLiteral(obj)) {\n                    obj = {v: obj}\n                }\n\n                let p = parseFloat(key);\n\n                if (key === \"sm\") {\n                    defaultSmoothness = obj.v;\n                } else if (!isNaN(p) && p >= 0 && p <= 2) {\n                    obj.p = p;\n\n                    obj.f = Utils.isFunction(obj.v);\n                    obj.lv = obj.f ? obj.v(0, 0) : obj.v;\n\n                    items.push(obj);\n                }\n            }\n        }\n\n        // Sort by progress value.\n        items = items.sort(function(a, b) {return a.p - b.p});\n\n        n = items.length;\n\n        for (i = 0; i < n; i++) {\n            let last = (i === n - 1);\n            if (!items[i].hasOwnProperty('pe')) {\n                // Progress.\n                items[i].pe = last ? (items[i].p <= 1 ? 1 : 2 /* support onetotwo stop */) : items[i + 1].p;\n            } else {\n                // Prevent multiple items at the same time.\n                const max = i < n - 1 ? items[i + 1].p : 1;\n                if (items[i].pe > max) {\n                    items[i].pe = max;\n                }\n            }\n            if (items[i].pe === items[i].p) {\n                items[i].idp = 0;\n            } else {\n                items[i].idp = 1 / (items[i].pe - items[i].p);\n            }\n        }\n\n        // Color merger: we need to split/combine RGBA components.\n\n        // Calculate bezier helper values.;\n        for (i = 0; i < n; i++) {\n            if (!items[i].hasOwnProperty('sm')) {\n                // Smoothness.;\n                items[i].sm = defaultSmoothness;\n            }\n            if (!items[i].hasOwnProperty('s')) {\n                // Slope.;\n                if (i === 0 || i === n - 1 || (items[i].p === 1 /* for onetotwo */)) {\n                    // Horizontal slope at start and end.;\n                    items[i].s = rgba ? [0, 0, 0, 0] : 0;\n                } else {\n                    const pi = items[i - 1];\n                    const ni = items[i + 1];\n                    if (pi.p === ni.p) {\n                        items[i].s = rgba ? [0, 0, 0, 0] : 0;\n                    } else {\n                        if (rgba) {\n                            const nc = MultiSpline.getRgbaComponents(ni.lv);\n                            const pc = MultiSpline.getRgbaComponents(pi.lv);\n                            const d = 1 / (ni.p - pi.p);\n                            items[i].s = [\n                                d * (nc[0] - pc[0]),\n                                d * (nc[1] - pc[1]),\n                                d * (nc[2] - pc[2]),\n                                d * (nc[3] - pc[3])\n                            ];\n                        } else {\n                            items[i].s = (ni.lv - pi.lv) / (ni.p - pi.p);\n                        }\n                    }\n                }\n            }\n        }\n\n        for (i = 0; i < n - 1; i++) {\n            // Calculate value function.;\n            if (!items[i].f) {\n\n                let last = (i === n - 1);\n                if (!items[i].hasOwnProperty('ve')) {\n                    items[i].ve = last ? items[i].lv : items[i + 1].lv;\n                }\n\n                // We can only interpolate on numeric values. Non-numeric values are set literally when reached time.\n                if (Utils.isNumber(items[i].v) && Utils.isNumber(items[i].lv)) {\n                    if (!items[i].hasOwnProperty('sme')) {\n                        items[i].sme = last ? defaultSmoothness : items[i + 1].sm;\n                    }\n                    if (!items[i].hasOwnProperty('se')) {\n                        items[i].se = last ? (rgba ? [0, 0, 0, 0] : 0) : items[i + 1].s;\n                    }\n\n                    // Generate spline.;\n                    if (rgba) {\n                        items[i].v = MultiSpline.getSplineRgbaValueFunction(items[i].v, items[i].ve, items[i].p, items[i].pe, items[i].sm, items[i].sme, items[i].s, items[i].se);\n                    } else {\n                        items[i].v = MultiSpline.getSplineValueFunction(items[i].v, items[i].ve, items[i].p, items[i].pe, items[i].sm, items[i].sme, items[i].s, items[i].se);\n                    }\n\n                    items[i].f = true;\n                }\n            }\n        }\n\n        if (this.length) {\n            this._clear();\n        }\n\n        for (i = 0, n = items.length; i < n; i++) {\n            this._add(items[i]);\n        }\n    }\n\n    _add(item) {\n        this._p.push(item.p || 0);\n        this._pe.push(item.pe || 0);\n        this._idp.push(item.idp || 0);\n        this._f.push(item.f || false);\n        this._v.push(item.hasOwnProperty('v') ? item.v : 0 /* v might be false or null */ );\n        this._lv.push(item.lv || 0);\n        this._sm.push(item.sm || 0);\n        this._s.push(item.s || 0);\n        this._ve.push(item.ve || 0);\n        this._sme.push(item.sme || 0);\n        this._se.push(item.se || 0);\n        this._length++;\n    }\n\n    _getItem(p) {\n        const n = this._length;\n        if (!n) {\n            return -1;\n        }\n\n        if (p < this._p[0]) {\n            return 0;\n        }\n\n        for (let i = 0; i < n; i++) {\n            if (this._p[i] <= p && p < this._pe[i]) {\n                return i;\n            }\n        }\n\n        return n - 1;\n    }\n\n    getValue(p) {\n        const i = this._getItem(p);\n        if (i === -1) {\n            return undefined;\n        } else {\n            if (this._f[i]) {\n                const o = Math.min(1, Math.max(0, (p - this._p[i]) * this._idp[i]));\n                return this._v[i](o);\n            } else {\n                return this._v[i];\n            }\n        }\n    }\n\n    get length() {\n        return this._length;\n    }\n\n    static getRgbaComponents(argb) {\n        let r = ((argb / 65536) | 0) % 256;\n        let g = ((argb / 256) | 0) % 256;\n        let b = argb % 256;\n        let a = ((argb / 16777216) | 0);\n        return [r, g, b, a];\n    };\n\n    static getSplineValueFunction(v1, v2, p1, p2, o1, i2, s1, s2) {\n        // Normalize slopes because we use a spline that goes from 0 to 1.\n        let dp = p2 - p1;\n        s1 *= dp;\n        s2 *= dp;\n\n        let helpers = MultiSpline.getSplineHelpers(v1, v2, o1, i2, s1, s2);\n        if (!helpers) {\n            return function (p) {\n                if (p === 0) return v1;\n                if (p === 1) return v2;\n\n                return v2 * p + v1 * (1 - p);\n            };\n        } else {\n            return function (p) {\n                if (p === 0) return v1;\n                if (p === 1) return v2;\n                return MultiSpline.calculateSpline(helpers, p);\n            };\n        }\n    };\n\n    static getSplineRgbaValueFunction(v1, v2, p1, p2, o1, i2, s1, s2) {\n        // Normalize slopes because we use a spline that goes from 0 to 1.\n        let dp = p2 - p1;\n        s1[0] *= dp;\n        s1[1] *= dp;\n        s1[2] *= dp;\n        s1[3] *= dp;\n        s2[0] *= dp;\n        s2[1] *= dp;\n        s2[2] *= dp;\n        s2[3] *= dp;\n\n        let cv1 = MultiSpline.getRgbaComponents(v1);\n        let cv2 = MultiSpline.getRgbaComponents(v2);\n\n        let helpers = [\n            MultiSpline.getSplineHelpers(cv1[0], cv2[0], o1, i2, s1[0], s2[0]),\n            MultiSpline.getSplineHelpers(cv1[1], cv2[1], o1, i2, s1[1], s2[1]),\n            MultiSpline.getSplineHelpers(cv1[2], cv2[2], o1, i2, s1[2], s2[2]),\n            MultiSpline.getSplineHelpers(cv1[3], cv2[3], o1, i2, s1[3], s2[3])\n        ];\n\n        if (!helpers[0]) {\n            return function (p) {\n                // Linear.\n                if (p === 0) return v1;\n                if (p === 1) return v2;\n\n                return MultiSpline.mergeColors(v2, v1, p);\n            };\n        } else {\n            return function (p) {\n                if (p === 0) return v1;\n                if (p === 1) return v2;\n\n                return MultiSpline.getArgbNumber([\n                    Math.min(255, MultiSpline.calculateSpline(helpers[0], p)),\n                    Math.min(255, MultiSpline.calculateSpline(helpers[1], p)),\n                    Math.min(255, MultiSpline.calculateSpline(helpers[2], p)),\n                    Math.min(255, MultiSpline.calculateSpline(helpers[3], p))\n                ]);\n            };\n        }\n\n    };\n\n    /**\n     * Creates helpers to be used in the spline function.\n     * @param {number} v1\n     *   From value.\n     * @param {number} v2\n     *   To value.\n     * @param {number} o1\n     *   From smoothness (0 = linear, 1 = smooth).\n     * @param {number} s1\n     *   From slope (0 = horizontal, infinite = vertical).\n     * @param {number} i2\n     *   To smoothness.\n     * @param {number} s2\n     *   To slope.\n     * @returns {Number[]}\n     *   The helper values to be supplied to the spline function.\n     *   If the configuration is actually linear, null is returned.\n     */\n    static getSplineHelpers(v1, v2, o1, i2, s1, s2) {\n        if (!o1 && !i2) {\n            // Linear.\n            return null;\n        }\n\n        // Cubic bezier points.\n        // http://cubic-bezier.com/\n        let csx = o1;\n        let csy = v1 + s1 * o1;\n        let cex = 1 - i2;\n        let cey = v2 - s2 * i2;\n\n        let xa = 3 * csx - 3 * cex + 1;\n        let xb = -6 * csx + 3 * cex;\n        let xc = 3 * csx;\n\n        let ya = 3 * csy - 3 * cey + v2 - v1;\n        let yb = 3 * (cey + v1) - 6 * csy;\n        let yc = 3 * (csy - v1);\n        let yd = v1;\n\n        return [xa, xb, xc, ya, yb, yc, yd];\n    };\n\n    /**\n     * Calculates the intermediate spline value based on the specified helpers.\n     * @param {number[]} helpers\n     *   Obtained from getSplineHelpers.\n     * @param {number} p\n     * @return {number}\n     */\n    static calculateSpline(helpers, p) {\n        let xa = helpers[0];\n        let xb = helpers[1];\n        let xc = helpers[2];\n        let ya = helpers[3];\n        let yb = helpers[4];\n        let yc = helpers[5];\n        let yd = helpers[6];\n\n        if (xa === -2 && ya === -2 && xc === 0 && yc === 0) {\n            // Linear.\n            return p;\n        }\n\n        // Find t for p.\n        let t = 0.5, cbx, dx;\n\n        for (let it = 0; it < 20; it++) {\n            // Cubic bezier function: f(t)=t*(t*(t*a+b)+c).\n            cbx = t * (t * (t * xa + xb) + xc);\n\n            dx = p - cbx;\n            if (dx > -1e-8 && dx < 1e-8) {\n                // Solution found!\n                return t * (t * (t * ya + yb) + yc) + yd;\n            }\n\n            // Cubic bezier derivative function: f'(t)=t*(t*(3*a)+2*b)+c\n            let cbxd = t * (t * (3 * xa) + 2 * xb) + xc;\n\n            if (cbxd > 1e-10 && cbxd < 1e-10) {\n                // Problematic. Fall back to binary search method.\n                break;\n            }\n\n            t += dx / cbxd;\n        }\n\n        // Fallback: binary search method. This is more reliable when there are near-0 slopes.\n        let minT = 0;\n        let maxT = 1;\n        for (let it = 0; it < 20; it++) {\n            t = 0.5 * (minT + maxT);\n\n            // Cubic bezier function: f(t)=t*(t*(t*a+b)+c)+d.\n            cbx = t * (t * (t * xa + xb) + xc);\n\n            dx = p - cbx;\n            if (dx > -1e-8 && dx < 1e-8) {\n                // Solution found!\n                return t * (t * (t * ya + yb) + yc) + yd;\n            }\n\n            if (dx < 0) {\n                maxT = t;\n            } else {\n                minT = t;\n            }\n        }\n\n        return t;\n    };\n\n    static mergeColors(c1, c2, p) {\n        let r1 = ((c1 / 65536) | 0) % 256;\n        let g1 = ((c1 / 256) | 0) % 256;\n        let b1 = c1 % 256;\n        let a1 = ((c1 / 16777216) | 0);\n\n        let r2 = ((c2 / 65536) | 0) % 256;\n        let g2 = ((c2 / 256) | 0) % 256;\n        let b2 = c2 % 256;\n        let a2 = ((c2 / 16777216) | 0);\n\n        let r = r1 * p + r2 * (1 - p);\n        let g = g1 * p + g2 * (1 - p);\n        let b = b1 * p + b2 * (1 - p);\n        let a = a1 * p + a2 * (1 - p);\n\n        return Math.round(a) * 16777216 + Math.round(r) * 65536 + Math.round(g) * 256 + Math.round(b);\n    };\n\n    static getArgbNumber(rgba) {\n        rgba[0] = Math.max(0, Math.min(255, rgba[0]));\n        rgba[1] = Math.max(0, Math.min(255, rgba[1]));\n        rgba[2] = Math.max(0, Math.min(255, rgba[2]));\n        rgba[3] = Math.max(0, Math.min(255, rgba[3]));\n        let v = ((rgba[3] | 0) << 24) + ((rgba[0] | 0) << 16) + ((rgba[1] | 0) << 8) + (rgba[2] | 0);\n        if (v < 0) {\n            v = 0xFFFFFFFF + v + 1;\n        }\n        return v;\n    };\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class AnimationActionSettings {\n\n    constructor(animationSettings) {\n\n        this.animationSettings = animationSettings;\n\n        /**\n         * The selector that selects the elements.\n         * @type {string}\n         */\n        this._selector = \"\";\n\n        /**\n         * The value items, ordered by progress offset.\n         * @type {MultiSpline}\n         * @private;\n         */\n        this._items = new MultiSpline();\n\n        /**\n         * The affected properties (paths).\n         * @private;\n         */\n        this._props = [];\n\n        /**\n         * Property setters, indexed according to props.\n         * @private;\n         */\n        this._propSetters = [];\n\n        this._resetValue = undefined;\n        this._hasResetValue = false;\n\n        this._hasColorProperty = undefined;\n    }\n\n    getResetValue() {\n        if (this._hasResetValue) {\n            return this._resetValue;\n        } else {\n            return this._items.getValue(0);\n        }\n    }\n\n    apply(element, p, factor) {\n        const elements = this.getAnimatedElements(element);\n\n        let v = this._items.getValue(p);\n\n        if (v === undefined || !elements.length) {\n            return;\n        }\n\n        if (factor !== 1) {\n            // Stop factor.;\n            let sv = this.getResetValue();\n\n            if (Utils.isNumber(v) && Utils.isNumber(sv)) {\n                if (this.hasColorProperty()) {\n                    v = StageUtils.mergeColors(v, sv, factor);\n                } else {\n                    v = StageUtils.mergeNumbers(v, sv, factor);\n                }\n            }\n        }\n\n        // Apply transformation to all components.;\n        const n = this._propSetters.length;\n\n        const m = elements.length;\n        for (let j = 0; j < m; j++) {\n            for (let i = 0; i < n; i++) {\n                this._propSetters[i](elements[j], v);\n            }\n        }\n    }\n    \n    getAnimatedElements(element) {\n        return element.select(this._selector);\n    }\n\n    reset(element) {\n        const elements = this.getAnimatedElements(element);\n\n        let v = this.getResetValue();\n\n        if (v === undefined || !elements.length) {\n            return;\n        }\n\n        // Apply transformation to all components.\n        const n = this._propSetters.length;\n\n        const m = elements.length;\n        for (let j = 0; j < m; j++) {\n            for (let i = 0; i < n; i++) {\n                this._propSetters[i](elements[j], v);\n            }\n        }\n    }\n    \n    set selector(v) {\n        this._selector = v;\n    }\n\n    set t(v) {\n        this.selector = v;\n    }\n\n    get resetValue() {\n        return this._resetValue;\n    }\n    \n    set resetValue(v) {\n        this._resetValue = v;\n        this._hasResetValue = (v !== undefined);\n    }\n\n    set rv(v) {\n        this.resetValue = v;\n    }\n\n    set value(v) {\n        this._items.parse(this.hasColorProperty(), v);\n    }\n\n    set v(v) {\n        this.value = v;\n    }\n\n    set properties(v) {\n        if (!Array.isArray(v)) {\n            v = [v];\n        }\n\n        this._props = [];\n\n        v.forEach((prop) => {\n            this._props.push(prop);\n            this._propSetters.push(Element.getSetter(prop));\n        });\n    }\n\n    set property(v) {\n        this._hasColorProperty = undefined;\n        this.properties = v;\n    }\n\n    set p(v) {\n        this.properties = v;\n    }\n\n    patch(settings) {\n        Base.patchObject(this, settings);\n    }\n\n    hasColorProperty() {\n        if (this._hasColorProperty === undefined) {\n            this._hasColorProperty = this._props.length ? Element.isColorProperty(this._props[0]) : false;\n        }\n        return this._hasColorProperty;\n    }\n}\n\nAnimationActionSettings.prototype.isAnimationActionSettings = true;\n\nimport MultiSpline from \"../tools/MultiSpline.mjs\";\nimport Element from \"../tree/Element.mjs\";\nimport StageUtils from \"../tree/StageUtils.mjs\";\nimport Utils from \"../tree/Utils.mjs\";\nimport Base from \"../tree/Base.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport StageUtils from \"../tree/StageUtils.mjs\";\nimport AnimationActionSettings from \"./AnimationActionSettings.mjs\";\nimport Base from \"../tree/Base.mjs\";\n\nexport default class AnimationSettings {\n    constructor() {\n        /**\n         * @type {AnimationActionSettings[]}\n         */\n        this._actions = [];\n\n        this.delay = 0;\n        this.duration = 1;\n\n        this.repeat = 0;\n        this.repeatOffset = 0;\n        this.repeatDelay = 0;\n\n        this.autostop = false;\n\n        this.stopMethod = AnimationSettings.STOP_METHODS.FADE;\n        this._stopTimingFunction = 'ease';\n        this._stopTimingFunctionImpl = StageUtils.getTimingFunction(this._stopTimingFunction);\n        this.stopDuration = 0;\n        this.stopDelay = 0;\n    }\n\n    get actions() {\n        return this._actions;\n    }\n\n    set actions(v) {\n        this._actions = [];\n        for (let i = 0, n = v.length; i < n; i++) {\n            const e = v[i];\n            if (!e.isAnimationActionSettings) {\n                const aas = new AnimationActionSettings(this);\n                aas.patch(e);\n                this._actions.push(aas);\n            } else {\n                this._actions.push(e);\n            }\n        }\n    }\n\n    /**\n     * Applies the animation to the specified element, for the specified progress between 0 and 1.\n     * @param {Element} element;\n     * @param {number} p;\n     * @param {number} factor;\n     */\n    apply(element, p, factor = 1) {\n        this._actions.forEach(function(action) {\n            action.apply(element, p, factor);\n        });\n    }\n\n    /**\n     * Resets the animation to the reset values.\n     * @param {Element} element;\n     */\n    reset(element) {\n        this._actions.forEach(function(action) {\n            action.reset(element);\n        });\n    }\n\n    get stopTimingFunction() {\n        return this._stopTimingFunction;\n    }\n\n    set stopTimingFunction(v) {\n        this._stopTimingFunction = v;\n        this._stopTimingFunctionImpl = StageUtils.getTimingFunction(v);\n    }\n\n    get stopTimingFunctionImpl() {\n        return this._stopTimingFunctionImpl;\n    }\n\n    patch(settings) {\n        Base.patchObject(this, settings);\n    }\n\n}\n\nAnimationSettings.STOP_METHODS = {\n    FADE: 'fade',\n    REVERSE: 'reverse',\n    FORWARD: 'forward',\n    IMMEDIATE: 'immediate',\n    ONETOTWO: 'onetotwo'\n};\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport EventEmitter from \"../EventEmitter.mjs\";\nimport AnimationSettings from \"./AnimationSettings.mjs\";\n\nexport default class Animation extends EventEmitter {\n\n    constructor(manager, settings, element) {\n        super();\n\n        this.manager = manager;\n\n        this._settings = settings;\n\n        this._element = element;\n\n        this._state = Animation.STATES.IDLE;\n\n        this._p = 0;\n        this._delayLeft = 0;\n        this._repeatsLeft = 0;\n\n        this._stopDelayLeft = 0;\n        this._stopP = 0;\n    }\n\n    start() {\n        if (this._element && this._element.attached) {\n            this._p = 0;\n            this._delayLeft = this.settings.delay;\n            this._repeatsLeft = this.settings.repeat;\n            this._state = Animation.STATES.PLAYING;\n            this.emit('start');\n            this.checkActive();\n        } else {\n            console.warn(\"[Lightning] Element must be attached before starting animation\");\n        }\n    }\n\n    play() {\n        if (this._state === Animation.STATES.PAUSED) {\n            // Continue.;\n            this._state = Animation.STATES.PLAYING;\n            this.checkActive();\n            this.emit('resume');\n        } else if (this._state == Animation.STATES.STOPPING && this.settings.stopMethod == AnimationSettings.STOP_METHODS.REVERSE) {\n            // Continue.;\n            this._state = Animation.STATES.PLAYING;\n            this.emit('stopContinue');\n        } else if (this._state != Animation.STATES.PLAYING && this._state != Animation.STATES.FINISHED) {\n            // Restart.;\n            this.start();\n        }\n    }\n\n    pause() {\n        if (this._state === Animation.STATES.PLAYING) {\n            this._state = Animation.STATES.PAUSED;\n            this.emit('pause');\n        }\n    }\n\n    replay() {\n        if (this._state == Animation.STATES.FINISHED) {\n            this.start();\n        } else {\n            this.play();\n        }\n    }\n\n    skipDelay() {\n        this._delayLeft = 0;\n        this._stopDelayLeft = 0;\n    }\n\n    finish() {\n        if (this._state === Animation.STATES.PLAYING) {\n            this._delayLeft = 0;\n            this._p = 1;\n        } else if (this._state === Animation.STATES.STOPPING) {\n            this._stopDelayLeft = 0;\n            this._p = 0;\n        }\n    }\n\n    stop() {\n        if (this._state === Animation.STATES.STOPPED || this._state === Animation.STATES.IDLE) return;\n\n        this._stopDelayLeft = this.settings.stopDelay || 0;\n\n        if (((this.settings.stopMethod === AnimationSettings.STOP_METHODS.IMMEDIATE) && !this._stopDelayLeft) || this._delayLeft > 0) {\n            // Stop upon next progress.;\n            this._state = Animation.STATES.STOPPING;\n            this.emit('stop');\n        } else {\n            if (this.settings.stopMethod === AnimationSettings.STOP_METHODS.FADE) {\n                this._stopP = 0;\n            }\n\n            this._state = Animation.STATES.STOPPING;\n            this.emit('stop');\n        }\n\n        this.checkActive();\n    }\n\n    stopNow() {\n        if (this._state !== Animation.STATES.STOPPED || this._state !== Animation.STATES.IDLE) {\n            this._state = Animation.STATES.STOPPING;\n            this._p = 0;\n            this.emit('stop');\n            this.reset();\n            this._state = Animation.STATES.STOPPED;\n            this.emit('stopFinish');\n        }\n    }\n\n    isPaused() {\n        return this._state === Animation.STATES.PAUSED;\n    }\n\n    isPlaying() {\n        return this._state === Animation.STATES.PLAYING;\n    }\n\n    isStopping() {\n        return this._state === Animation.STATES.STOPPING;\n    }\n\n    isFinished() {\n        return this._state === Animation.STATES.FINISHED;\n    }\n\n    checkActive() {\n        if (this.isActive()) {\n            this.manager.addActive(this);\n        }\n    }\n\n    isActive() {\n        return (this._state == Animation.STATES.PLAYING || this._state == Animation.STATES.STOPPING) && this._element && this._element.attached;\n    }\n\n    progress(dt) {\n        if (!this._element) return;\n        this._progress(dt);\n        this.apply();\n    }\n\n    _progress(dt) {\n        if (this._state == Animation.STATES.STOPPING) {\n            this._stopProgress(dt);\n            return;\n        }\n\n        if (this._state != Animation.STATES.PLAYING) {\n            return;\n        }\n\n        if (this._delayLeft > 0) {\n            this._delayLeft -= dt;\n\n            if (this._delayLeft < 0) {\n                dt = -this._delayLeft;\n                this._delayLeft = 0;\n\n                this.emit('delayEnd');\n            } else {\n                return;\n            }\n        }\n\n        if (this.settings.duration === 0) {\n            this._p = 1;\n        } else if (this.settings.duration > 0) {\n            this._p += dt / this.settings.duration;\n        }\n        if (this._p >= 1) {\n            // Finished!;\n            if (this.settings.repeat == -1 || this._repeatsLeft > 0) {\n                if (this._repeatsLeft > 0) {\n                    this._repeatsLeft--;\n                }\n                this._p = this.settings.repeatOffset;\n                this.emit('progress', this._p);\n                \n                if (this.settings.repeatDelay) {\n                    this._delayLeft = this.settings.repeatDelay;\n                }\n\n                this.emit('repeat', this._repeatsLeft);\n            } else {\n                this._p = 1;\n                this.emit('progress', this._p);\n                \n                this._state = Animation.STATES.FINISHED;\n                this.emit('finish');\n                if (this.settings.autostop) {\n                    this.stop();\n                }\n            }\n        } else {\n            this.emit('progress', this._p);\n        }\n    }\n    \n    _stopProgress(dt) {\n        let duration = this._getStopDuration();\n\n        if (this._stopDelayLeft > 0) {\n            this._stopDelayLeft -= dt;\n\n            if (this._stopDelayLeft < 0) {\n                dt = -this._stopDelayLeft;\n                this._stopDelayLeft = 0;\n\n                this.emit('stopDelayEnd');\n            } else {\n                return;\n            }\n        }\n        if (this.settings.stopMethod == AnimationSettings.STOP_METHODS.IMMEDIATE) {\n            this._state = Animation.STATES.STOPPED;\n            this.emit('stopFinish');\n        } else if (this.settings.stopMethod == AnimationSettings.STOP_METHODS.REVERSE) {\n            if (duration === 0) {\n                this._p = 0;\n            } else if (duration > 0) {\n                this._p -= dt / duration;\n            }\n\n            if (this._p <= 0) {\n                this._p = 0;\n                this._state = Animation.STATES.STOPPED;\n                this.emit('stopFinish');\n            }\n        } else if (this.settings.stopMethod == AnimationSettings.STOP_METHODS.FADE) {\n            this._progressStopTransition(dt);\n            if (this._stopP >= 1) {\n                this._p = 0;\n                this._state = Animation.STATES.STOPPED;\n                this.emit('stopFinish');\n            }\n        } else if (this.settings.stopMethod == AnimationSettings.STOP_METHODS.ONETOTWO) {\n            if (this._p < 2) {\n                if (duration === 0) {\n                    this._p = 2;\n                } else if (duration > 0) {\n                    if (this._p < 1) {\n                        this._p += dt / this.settings.duration;\n                    } else {\n                        this._p += dt / duration;\n                    }\n                }\n                if (this._p >= 2) {\n                    this._p = 2;\n                    this._state = Animation.STATES.STOPPED;\n                    this.emit('stopFinish');\n                } else {\n                    this.emit('progress', this._p);\n                }\n            }\n        } else if (this.settings.stopMethod == AnimationSettings.STOP_METHODS.FORWARD) {\n            if (this._p < 1) {\n                if (this.settings.duration == 0) {\n                    this._p = 1;\n                } else {\n                    this._p += dt / this.settings.duration;\n                }\n                if (this._p >= 1) {\n                    if (this.settings.stopMethod == AnimationSettings.STOP_METHODS.FORWARD) {\n                        this._p = 1;\n                        this._state = Animation.STATES.STOPPED;\n                        this.emit('stopFinish');\n                    } else {\n                        if (this._repeatsLeft > 0) {\n                            this._repeatsLeft--;\n                            this._p = 0;\n                            this.emit('repeat', this._repeatsLeft);\n                        } else {\n                            this._p = 1;\n                            this._state = Animation.STATES.STOPPED;\n                            this.emit('stopFinish');\n                        }\n                    }\n                } else {\n                    this.emit('progress', this._p);\n                }\n            }\n        }\n        \n    }\n    \n    _progressStopTransition(dt) {\n        if (this._stopP < 1) {\n            if (this._stopDelayLeft > 0) {\n                this._stopDelayLeft -= dt;\n\n                if (this._stopDelayLeft < 0) {\n                    dt = -this._stopDelayLeft;\n                    this._stopDelayLeft = 0;\n\n                    this.emit('delayEnd');\n                } else {\n                    return;\n                }\n            }\n            \n            const duration = this._getStopDuration();\n\n            if (duration == 0) {\n                this._stopP = 1;\n            } else {\n                this._stopP += dt / duration;\n            }\n            if (this._stopP >= 1) {\n                // Finished!;\n                this._stopP = 1;\n            }\n        }\n    }\n\n    _getStopDuration() {\n        return this.settings.stopDuration || this.settings.duration;\n    }\n\n    apply() {\n        if (this._state === Animation.STATES.STOPPED) {\n            this.reset();\n        } else {\n            let factor = 1;\n            if (this._state === Animation.STATES.STOPPING && this.settings.stopMethod === AnimationSettings.STOP_METHODS.FADE) {\n                factor = (1 - this.settings.stopTimingFunctionImpl(this._stopP));\n            }\n            this._settings.apply(this._element, this._p, factor);\n        }\n    }\n\n    reset() {\n        this._settings.reset(this._element);\n    }\n\n    get state() {\n        return this._state;\n    }\n\n    get p() {\n        return this._p;\n    }\n\n    get delayLeft() {\n        return this._delayLeft;\n    }\n\n    get element() {\n        return this._element;\n    }\n\n    get frame() {\n        return Math.round(this._p * this._settings.duration * 60);\n    }\n\n    get settings() {\n        return this._settings;\n    }\n\n}\n\nAnimation.STATES = {\n    IDLE: 0,\n    PLAYING: 1,\n    STOPPING: 2,\n    STOPPED: 3,\n    FINISHED: 4,\n    PAUSED: 5\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default class AnimationManager {\n\n    constructor(stage) {\n        this.stage = stage;\n\n        this.stage.on('frameStart', () => this.progress());\n\n        /**\n         * All running animations on attached subjects.\n         * @type {Set<Animation>}\n         */\n        this.active = new Set();\n    }\n\n    progress() {\n        if (this.active.size) {\n            let dt = this.stage.dt;\n\n            let filter = false;\n            this.active.forEach(function(a) {\n                if (a.isActive()) {\n                    a.progress(dt);\n                } else {\n                    filter = true;\n                }\n            });\n\n            if (filter) {\n                this.active = new Set([...this.active].filter(t => t.isActive()));\n            }\n        }\n    }\n\n    createAnimation(element, settings) {\n        if (Utils.isObjectLiteral(settings)) {\n            // Convert plain object to proper settings object.\n            settings = this.createSettings(settings);\n        }\n\n        return new Animation(\n            this,\n            settings,\n            element\n        );\n    }\n\n    createSettings(settings) {\n        const animationSettings = new AnimationSettings();\n        Base.patchObject(animationSettings, settings);\n        return animationSettings;\n    }\n\n    addActive(transition) {\n        this.active.add(transition);\n    }\n}\n\nimport Base from \"../tree/Base.mjs\";\nimport Utils from \"../tree/Utils.mjs\";\nimport AnimationSettings from \"./AnimationSettings.mjs\";\nimport Animation from \"./Animation.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Texture from \"../tree/Texture.mjs\";\n\nexport default class RectangleTexture extends Texture {\n\n    _getLookupId() {\n        return '__whitepix';\n    }\n\n    _getSourceLoader() {\n        return function(cb) {\n            var whitePixel = new Uint8Array([255, 255, 255, 255]);\n            cb(null, {source: whitePixel, w: 1, h: 1, permanent: true});\n        }\n    }\n\n    isAutosizeTexture() {\n        return false;\n    }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Application render tree.\n */\n\nimport EventEmitter from \"../EventEmitter.mjs\";\nimport Utils from \"./Utils.mjs\";\nimport WebGLRenderer from \"../renderer/webgl/WebGLRenderer.mjs\";\nimport C2dRenderer from \"../renderer/c2d/C2dRenderer.mjs\";\nimport SparkRenderer from \"../renderer/spark/SparkRenderer.mjs\";\nimport PlatformLoader from \"../platforms/PlatformLoader.mjs\";\nimport WebGLStateManager from \"../tools/WebGLStateManager.mjs\";\nimport Shader from \"./Shader.mjs\";\n\nexport default class Stage extends EventEmitter {\n\n    constructor(options = {}) {\n        super();\n        this._setOptions(options);\n\n        this._usedMemory = 0;\n        this._lastGcFrame = 0;\n\n        // attempt to track VRAM usage more accurately by accounting for different color channels\n        this._usedVramAlpha = 0;\n        this._usedVramNonAlpha = 0;\n\n        const platformType = Stage.platform ? Stage.platform : PlatformLoader.load(options);\n        this.platform = new platformType();\n\n        if (this.platform.init) {\n            this.platform.init(this);\n        }\n\n        this.gl = null;\n        this.c2d = null;\n\n        const context = this.getOption('context');\n        if (context) {\n            if (context.useProgram) {\n                this.gl = context;\n            } else {\n                this.c2d = context;\n            }\n        } else {\n            if (Utils.isWeb && (!Stage.isWebglSupported() || this.getOption('canvas2d'))) {\n                this.c2d = this.platform.createCanvasContext(this.getOption('w'), this.getOption('h'));\n            } else {\n                this.gl = this.platform.createWebGLContext(this.getOption('w'), this.getOption('h'));\n            }\n        }\n\n        if (this.gl) {\n            // Wrap in WebGLStateManager.\n            // This prevents unnecessary double WebGL commands from being executed, and allows context switching.\n            // Context switching is necessary when reusing the same context for Three.js.\n            // Note that the user must make sure that the WebGL context is untouched before creating the application,\n            //  when manually passing over a canvas or context in the options.\n            WebGLStateManager.enable(this.gl, \"lightning\")\n        }\n\n        this._mode = this.gl ? 0 : 1;\n\n        // Override width and height.\n        if (this.getCanvas()) {\n            if (this.getOption('devicePixelRatio') !== 1) {\n                const ratio = this.getOption('devicePixelRatio');\n                // set correct display sie\n                this.getCanvas().style.width = this._options['w'] / ratio  + 'px';\n                this.getCanvas().style.height = this._options['h'] / ratio + 'px';\n            }\n\n            // set display buffer size\n            this._options.w = this.getCanvas().width;\n            this._options.h = this.getCanvas().height;\n        }\n\n        if (this._mode === 0) {\n            if (Utils.isSpark) {\n                this._renderer = new SparkRenderer(this);\n            } else {\n                this._renderer = new WebGLRenderer(this);\n            }\n        } else {\n            this._renderer = new C2dRenderer(this);\n        }\n\n        this.setClearColor(this.getOption('clearColor'));\n\n        this.frameCounter = 0;\n\n        this.transitions = new TransitionManager(this);\n        this.animations = new AnimationManager(this);\n\n        this.textureManager = new TextureManager(this);\n        this.textureThrottler = new TextureThrottler(this);\n\n        this.startTime = 0;\n        this.currentTime = 0;\n        this.dt = 0;\n\n        // Preload rectangle texture, so that we can skip some border checks for loading textures.\n        this.rectangleTexture = new RectangleTexture(this);\n        this.rectangleTexture.load();\n\n        // Never clean up because we use it all the time.\n        this.rectangleTexture.source.permanent = true;\n\n        this.ctx = new CoreContext(this);\n\n        this._updateSourceTextures = new Set();\n    }\n\n    get renderer() {\n        return this._renderer;\n    }\n\n    static isWebglSupported() {\n        if (Utils.isNode) {\n            return true;\n        }\n\n        try {\n            return !!window.WebGLRenderingContext;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    /**\n     * Returns the rendering mode.\n     * @returns {number}\n     *  0: WebGL\n     *  1: Canvas2d\n     */\n    get mode() {\n        return this._mode;\n    }\n\n    isWebgl() {\n        return this.mode === 0;\n    }\n\n    isC2d() {\n        return this.mode === 1;\n    }\n\n    getOption(name) {\n        return this._options[name];\n    }\n\n    _setOptions(o) {\n        this._options = {};\n\n        let opt = (name, def) => {\n            let value = o[name];\n\n            if (value === undefined) {\n                this._options[name] = def;\n            } else {\n                this._options[name] = value;\n            }\n        }\n\n        opt('canvas', null);\n        opt('context', null);\n        opt('w', 1920);\n        opt('h', 1080);\n        opt('srcBasePath', null);\n        opt('memoryPressure', 24e6);\n        opt('bufferMemory', 2e6);\n        opt('textRenderIssueMargin', 0);\n        opt('fontSharp', { precision: 0.6666666667, fontSize: 24 })\n        opt('clearColor', [0, 0, 0, 0]);\n        opt('defaultFontFace', 'sans-serif');\n        opt('fixedDt', 0);\n        opt('useImageWorker', true);\n        opt('autostart', true);\n        opt('precision', 1);\n        opt('canvas2d', false);\n        opt('platform', null);\n        opt('readPixelsBeforeDraw', false);\n        opt('devicePixelRatio', 1)       \n        opt('readPixelsAfterDraw', false);\n        opt('readPixelsAfterDrawThreshold', 0);\n        opt('debugFrame', false);\n        opt('forceTxCanvasSource', false);\n        opt('pauseRafLoopOnIdle', false);\n\n        if (o['devicePixelRatio'] != null && o['devicePixelRatio'] !== 1) {\n            this._options['precision'] *= o['devicePixelRatio']\n            this._options['w'] *= o['devicePixelRatio']\n            this._options['h'] *= o['devicePixelRatio']\n        }\n    }\n\n    setApplication(app) {\n        this.application = app;\n    }\n\n    init() {\n\n        if (this.application.getOption('debug') && this.platform._imageWorker) {\n            console.log('[Lightning] Using image worker!');\n        }\n\n        if (this.application.getOption('debug') && this.c2d) {\n            console.log('[Lightning] Using canvas2d renderer');\n        }\n\n        this.application.setAsRoot();\n        if (this.getOption('autostart')) {\n            this.platform.startLoop();\n        }\n    }\n\n    destroy() {\n        this.platform.stopLoop();\n        this.platform.destroy();\n        this.ctx.destroy();\n        this.textureManager.destroy();\n        this._renderer.destroy();\n\n        // clear last rendered frame\n        if (this.gl) {\n            this.gl.clearColor(0.0, 0.0, 0.0, 0.0);\n            this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n        } else if (this.c2d) {\n            this.c2d.clearRect(\n                0, 0, this.c2d.canvas.width, this.c2d.canvas.height\n            );\n        }\n\n        this.gl = null;\n        this.c2d = null;\n        this.ctx = null;\n        this._options = null;\n        this.platform = null;\n        this.textureManager = null;\n        this._renderer = null;\n\n        delete this.gl;\n        delete this.c2d;\n        delete this.ctx;\n        delete this._options;\n        delete this.platform;\n        delete this.textureManager;\n        delete this._renderer;\n    }\n\n    stop() {\n        this.platform.stopLoop();\n    }\n\n    resume() {\n        this.platform.startLoop();\n    }\n\n    get root() {\n        return this.application;\n    }\n\n    getCanvas() {\n        return this._mode ? this.c2d.canvas : this.gl.canvas;\n    }\n\n    getRenderPrecision() {\n        return this._options.precision;\n    }\n\n    /**\n     * Marks a texture for updating it's source upon the next drawFrame.\n     * @param texture\n     */\n    addUpdateSourceTexture(texture) {\n        if (this._updatingFrame) {\n            // When called from the upload loop, we must immediately load the texture in order to avoid a 'flash'.\n            texture._performUpdateSource();\n        } else {\n            this._updateSourceTextures.add(texture);\n        }\n    }\n\n    removeUpdateSourceTexture(texture) {\n        if (this._updateSourceTextures) {\n            this._updateSourceTextures.delete(texture);\n        }\n    }\n\n    hasUpdateSourceTexture(texture) {\n        return (this._updateSourceTextures && this._updateSourceTextures.has(texture));\n    }\n\n\n    _performUpdateSource() {\n        if (this._updateSourceTextures.size) {\n            this._updateSourceTextures.forEach(texture => {\n                texture._performUpdateSource();\n            });\n            this._updateSourceTextures = new Set();\n        }\n    }\n\n    _calculateDt() {\n        this.startTime = this.currentTime;\n        this.currentTime = this.platform.getHrTime();\n\n        if (this._options.fixedDt) {\n            this.dt = this._options.fixedDt;\n        } else {\n            this.dt = (!this.startTime) ? .02 : .001 * (this.currentTime - this.startTime);\n        }\n    }\n\n    updateFrame() {\n        this._calculateDt();\n        this.emit('frameStart');\n        this._performUpdateSource();\n        this.emit('update');\n    }\n\n    idleFrame() {\n        this.textureThrottler.processSome();\n        this.emit('frameEnd');\n        this.frameCounter++;\n    }\n\n    renderFrame() {\n        const changes = this.ctx.hasRenderUpdates();\n\n        // Update may cause textures to be loaded in sync, so by processing them here we may be able to show them\n        // during the current frame already.\n        this.textureThrottler.processSome();\n\n        if (changes) {\n            this._updatingFrame = true;\n            this.ctx.update();\n            this.ctx.render();\n            this._updatingFrame = false;\n        }\n\n        this.platform.nextFrame(changes);\n\n        this.emit('frameEnd');\n\n        this.frameCounter++;\n    }\n\n    isUpdatingFrame() {\n        return this._updatingFrame;\n    }\n\n    drawFrame() {\n        // Maintain original functionality of `drawFrame()` while retaining the\n        // RAF mitigration feature from: https://github.com/rdkcentral/Lightning/pull/402\n        // The full functionality of this method is relied directly by our own unit tests and\n        // the unit tests of third party users\n        this.updateFrame();\n        this.renderFrame();\n    }\n\n    forceRenderUpdate() {\n        // Enforce re-rendering.\n        if (this.root) {\n            this.root.core._parent.setHasRenderUpdates(1);\n        }\n    }\n\n    setClearColor(clearColor) {\n        this.forceRenderUpdate();\n        if (clearColor === null) {\n            // Do not clear.\n            this._clearColor = null;\n        } else if (Array.isArray(clearColor)) {\n            this._clearColor = clearColor;\n        } else {\n            this._clearColor = StageUtils.getRgbaComponentsNormalized(clearColor);\n        }\n    }\n\n    getClearColor() {\n        return this._clearColor;\n    }\n\n    createElement(settings) {\n        if (settings) {\n            return this.element(settings);\n        } else {\n            return new Element(this);\n        }\n    }\n\n    createShader(settings) {\n        return Shader.create(this, settings);\n    }\n\n    element(settings) {\n        if (settings.isElement) return settings;\n\n        let element;\n        if (settings.type) {\n            element = new settings.type(this);\n        } else {\n            element = new Element(this);\n        }\n\n        element.patch(settings);\n\n        return element;\n    }\n\n    c(settings) {\n        return this.element(settings);\n    }\n\n    get w() {\n        return this._options.w;\n    }\n\n    get h() {\n        return this._options.h;\n    }\n\n    get coordsWidth() {\n        return this.w / this._options.precision;\n    }\n\n    get coordsHeight() {\n        return this.h / this._options.precision;\n    }\n\n    addMemoryUsage(delta) {\n        this._usedMemory += delta;\n        if (this._lastGcFrame !== this.frameCounter) {\n            if (this._usedMemory > this.getOption('memoryPressure')) {\n                this.gc(false);\n                if (this._usedMemory > this.getOption('memoryPressure') - 2e6) {\n                    // Too few released. Aggressive cleanup.\n                    this.gc(true);\n                }\n            }\n        }\n    }\n\n    get usedMemory() {\n        return this._usedMemory;\n    }\n\n    addVramUsage(delta, alpha) {\n        if (alpha) {\n            this._usedVramAlpha += delta;\n        }\n        else {\n            this._usedVramNonAlpha += delta;\n        }\n    }\n\n    get usedVramAlpha() {\n        return this._usedVramAlpha;\n    }\n\n    get usedVramNonAlpha() {\n        return this._usedVramNonAlpha;\n    }\n\n    get usedVram() {\n        return this._usedVramAlpha + this._usedVramNonAlpha;\n    }\n\n    gc(aggressive) {\n        if (this._lastGcFrame !== this.frameCounter) {\n            this._lastGcFrame = this.frameCounter;\n            const memoryUsageBefore = this._usedMemory;\n            this.gcTextureMemory(aggressive);\n            this.gcRenderTextureMemory(aggressive);\n            this.renderer.gc(aggressive);\n\n            if (this.application.getOption('debug')) {\n                console.log(`[Lightning] GC${aggressive ? \"[aggressive]\" : \"\"}! Frame ${this._lastGcFrame} Freed ${((memoryUsageBefore - this._usedMemory) / 1e6).toFixed(2)}MP from GPU memory. Remaining: ${(this._usedMemory / 1e6).toFixed(2)}MP`);\n                const other = this._usedMemory - this.textureManager.usedMemory - this.ctx.usedMemory;\n                console.log(`[Lightning] Textures: ${(this.textureManager.usedMemory / 1e6).toFixed(2)}MP, Render Textures: ${(this.ctx.usedMemory / 1e6).toFixed(2)}MP, Renderer caches: ${(other / 1e6).toFixed(2)}MP`);\n            }\n        }\n    }\n\n    gcTextureMemory(aggressive = false) {\n        if (aggressive && this.ctx.root.visible) {\n            // Make sure that ALL textures are cleaned;\n            this.ctx.root.visible = false;\n            this.textureManager.gc();\n            this.ctx.root.visible = true;\n        } else {\n            this.textureManager.gc();\n        }\n    }\n\n    gcRenderTextureMemory(aggressive = false) {\n        if (aggressive && this.root.visible) {\n            // Make sure that ALL render textures are cleaned;\n            this.root.visible = false;\n            this.ctx.freeUnusedRenderTextures(0);\n            this.root.visible = true;\n        } else {\n            this.ctx.freeUnusedRenderTextures(0);\n        }\n    }\n\n    getDrawingCanvas() {\n        return this.platform.getDrawingCanvas();\n    }\n\n    update() {\n        this.ctx.update()\n    }\n\n    addServiceProvider(serviceprovider) {\n        if (Utils.isSpark) {\n            this.platform.addServiceProvider(serviceprovider);\n        }\n    }\n\n    getChildrenByPosition(x, y) {\n        const children = [];\n        this.root.core.update();\n        this.root.core.collectAtCoord(x, y, children);\n\n        return children;\n    }\n}\n\nimport Element from \"./Element.mjs\";\nimport StageUtils from \"./StageUtils.mjs\";\nimport TextureManager from \"./TextureManager.mjs\";\nimport TextureThrottler from \"./TextureThrottler.mjs\";\nimport CoreContext from \"./core/CoreContext.mjs\";\nimport TransitionManager from \"../animation/TransitionManager.mjs\";\nimport AnimationManager from \"../animation/AnimationManager.mjs\";\nimport RectangleTexture from \"../textures/RectangleTexture.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Component from \"./Component.mjs\";\nimport Utils from \"../tree/Utils.mjs\";\n\nexport default class Application extends Component {\n\n    constructor(options = {}, properties) {\n        // Save options temporarily to avoid having to pass it through the constructor.\n        Application._temp_options = options;\n\n        // Booting flag is used to postpone updateFocusSettings;\n        Application.booting = true;\n        const stage = new Stage(options.stage);\n        super(stage, properties);\n        Application.booting = false;\n\n        this.__updateFocusCounter = 0;\n        this.__keypressTimers = new Map();\n        this.__hoveredChild = null;\n\n        // We must construct while the application is not yet attached.\n        // That's why we 'init' the stage later (which actually emits the attach event).\n        this.stage.init();\n\n        // Initially, the focus settings are updated after both the stage and application are constructed.\n        this.updateFocusSettings();\n\n        this.__keymap = this.getOption('keys');\n\n        if (this.__keymap) {\n            this.stage.platform.registerKeydownHandler((e) => {\n                this._receiveKeydown(e);\n            });\n\n            this.stage.platform.registerKeyupHandler((e) => {\n                this._receiveKeyup(e);\n            });\n        }\n\n        if (this.getOption(\"enablePointer\")) {\n            this.stage.platform.registerClickHandler((e) => {\n                this._receiveClick(e);\n            });\n\n            this.stage.platform.registerHoverHandler((e) => {\n                this._receiveHover(e);\n            });\n\n            this.stage.platform.registerScrollWheelHandler((e) => {\n                this._recieveScrollWheel(e);\n            });\n\n            this.cursor = 'default';\n        }\n    }\n\n    getOption(name) {\n        return this.__options[name];\n    }\n\n    _setOptions(o) {\n        this.__options = {};\n\n        let opt = (name, def) => {\n            let value = o[name];\n\n            if (value === undefined) {\n                this.__options[name] = def;\n            } else {\n                this.__options[name] = value;\n            }\n        }\n\n        opt('debug', false);\n        opt('keys', {\n            38: \"Up\",\n            40: \"Down\",\n            37: \"Left\",\n            39: \"Right\",\n            13: \"Enter\",\n            8: \"Back\",\n            27: \"Exit\"\n        });\n        opt('enablePointer', false);\n    }\n\n    __construct() {\n        this.stage.setApplication(this);\n\n        this._setOptions(Application._temp_options);\n        delete Application._temp_options;\n\n        super.__construct();\n    }\n\n    __init() {\n        super.__init();\n        this.__updateFocus();\n    }\n\n    updateFocusPath() {\n        this.__updateFocus();\n    }\n\n    __updateFocus() {\n        const notOverridden = this.__updateFocusRec();\n\n        if (!Application.booting && notOverridden) {\n            this.updateFocusSettings();\n        }\n    }\n\n    __updateFocusRec() {\n        const updateFocusId = ++this.__updateFocusCounter;\n        this.__updateFocusId = updateFocusId;\n\n        const newFocusPath = this.__getFocusPath();\n        const newFocusedComponent = newFocusPath[newFocusPath.length - 1];\n        const prevFocusedComponent = this._focusPath ? this._focusPath[this._focusPath.length - 1] : undefined;\n\n        if (!prevFocusedComponent) {\n            // Focus events.\n            this._focusPath = [];\n            for (let i = 0, n = newFocusPath.length; i < n; i++) {\n                this._focusPath.push(newFocusPath[i]);\n                this._focusPath[i]._focus(newFocusedComponent, undefined);\n                const focusOverridden = (this.__updateFocusId !== updateFocusId);\n                if (focusOverridden) {\n                    return false;\n                }\n            }\n            return true;\n        } else {\n            let m = Math.min(this._focusPath.length, newFocusPath.length);\n            let index;\n            for (index = 0; index < m; index++) {\n                if (this._focusPath[index] !== newFocusPath[index]) {\n                    break;\n                }\n            }\n\n            if (this._focusPath.length !== newFocusPath.length || index !== newFocusPath.length) {\n\n                if (this.getOption('debug')) {\n                    console.log('[Lightning] Focus changed: ' + newFocusedComponent.getLocationString());\n                }\n\n                // Unfocus events.\n                for (let i = this._focusPath.length - 1; i >= index; i--) {\n                    const unfocusedElement = this._focusPath.pop();\n                    unfocusedElement._unfocus(newFocusedComponent, prevFocusedComponent);\n                    const focusOverridden = (this.__updateFocusId !== updateFocusId);\n                    if (focusOverridden) {\n                        return false;\n                    }\n                }\n\n                // Focus events.\n                for (let i = index, n = newFocusPath.length; i < n; i++) {\n                    this._focusPath.push(newFocusPath[i]);\n                    this._focusPath[i]._focus(newFocusedComponent, prevFocusedComponent);\n                    const focusOverridden = (this.__updateFocusId !== updateFocusId);\n                    if (focusOverridden) {\n                        return false;\n                    }\n                }\n\n                // Focus changed events.\n                for (let i = 0; i < index; i++) {\n                    this._focusPath[i]._focusChange(newFocusedComponent, prevFocusedComponent);\n                }\n            }\n        }\n\n        return true;\n    }\n\n    updateFocusSettings() {\n        const focusedComponent = this._focusPath[this._focusPath.length - 1];\n\n        // Get focus settings. These can be used for dynamic application-wide settings that depend on the\n        // focus directly (such as the application background).\n        const focusSettings = {};\n        const defaultSetFocusSettings = Component.prototype._setFocusSettings;\n        for (let i = 0, n = this._focusPath.length; i < n; i++) {\n            if (this._focusPath[i]._setFocusSettings !== defaultSetFocusSettings) {\n                this._focusPath[i]._setFocusSettings(focusSettings);\n            }\n        }\n\n        const defaultHandleFocusSettings = Component.prototype._handleFocusSettings;\n        for (let i = 0, n = this._focusPath.length; i < n; i++) {\n            if (this._focusPath[i]._handleFocusSettings !== defaultHandleFocusSettings) {\n                this._focusPath[i]._handleFocusSettings(focusSettings, this.__prevFocusSettings, focusedComponent);\n            }\n        }\n\n        this.__prevFocusSettings = focusSettings;\n    }\n\n    _handleFocusSettings(settings, prevSettings, focused, prevFocused) {\n        // Override to handle focus-based settings.\n    }\n\n    __getFocusPath() {\n        const path = [this];\n        let current = this;\n        do {\n            const nextFocus = current._getFocused();\n            if (!nextFocus || (nextFocus === current)) {\n                // Found!;\n                break;\n            }\n\n\n            let ptr = nextFocus.cparent;\n            if (ptr === current) {\n                path.push(nextFocus);\n            } else {\n                // Not an immediate child: include full path to descendant.\n                const newParts = [nextFocus];\n                do {\n                    if (!ptr) {\n                        current._throwError(\"Return value for _getFocused must be an attached descendant component but its '\" + nextFocus.getLocationString() + \"'\");\n                    }\n                    newParts.push(ptr);\n                    ptr = ptr.cparent;\n                } while (ptr !== current);\n\n                // Add them reversed.\n                for (let i = 0, n = newParts.length; i < n; i++) {\n                    path.push(newParts[n - i - 1]);\n                }\n            }\n\n            current = nextFocus;\n        } while (true);\n\n        return path;\n    }\n\n    get focusPath() {\n        return this._focusPath;\n    }\n\n    /**\n     * Injects an event in the state machines, top-down from application to focused component.\n     */\n    focusTopDownEvent(events, ...args) {\n        const path = this.focusPath;\n        const n = path.length;\n\n        // Multiple events.\n        for (let i = 0; i < n; i++) {\n            const event = path[i]._getMostSpecificHandledMember(events);\n            if (event !== undefined) {\n                const returnValue = path[i][event](...args);\n                if (returnValue !== false) {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Injects an event in the state machines, bottom-up from focused component to application.\n     */\n    focusBottomUpEvent(events, ...args) {\n        const path = this.focusPath;\n        const n = path.length;\n\n        // Multiple events.\n        for (let i = n - 1; i >= 0; i--) {\n            const event = path[i]._getMostSpecificHandledMember(events);\n            if (event !== undefined) {\n                const returnValue = path[i][event](...args);\n                if (returnValue !== false) {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    _receiveKeydown(e) {\n        const obj = e;\n        const key = this.__keymap[e.keyCode];\n        const path = this.focusPath;\n\n        let keys;\n        if (key) {\n            keys = Array.isArray(key) ? key : [key];\n        }\n\n        if (keys) {\n            for (let i = 0, n = keys.length; i < n; i++) {\n                const hasTimer = this.__keypressTimers.has(keys[i]);\n                // prevent event from getting fired when the timeout is still active\n                if (path[path.length - 1].longpress && hasTimer) {\n                    return;\n                }\n\n                if (!this.stage.application.focusTopDownEvent([`_capture${keys[i]}`, \"_captureKey\"], obj)) {\n                    this.stage.application.focusBottomUpEvent([`_handle${keys[i]}`, \"_handleKey\"], obj);\n                }\n            }\n        } else {\n            if (!this.stage.application.focusTopDownEvent([\"_captureKey\"], obj)) {\n                this.stage.application.focusBottomUpEvent([\"_handleKey\"], obj);\n            }\n        }\n\n        this.updateFocusPath();\n\n        const consumer = path[path.length - 1];\n\n        if (keys && consumer.longpress) {\n            for (let i = 0, n = keys.length; i < n; i++) {\n                this._startLongpressTimer(keys[i], consumer);\n            }\n        }\n    }\n\n    /**\n     * Keyup listener\n     * To take away some confusion we add `Release` to the event to prevent ending up with method names like:\n     *  _handleLeftUp / _handleUpUp / _handleEnterUp etc\n     *\n     * @param e\n     * @private\n     */\n    _receiveKeyup(e) {\n        const obj = e;\n        const key = this.__keymap[e.keyCode];\n\n        let keys;\n        if (key) {\n            keys = Array.isArray(key) ? key : [key];\n        }\n\n        if (keys) {\n            for (let i = 0, n = keys.length; i < n; i++) {\n                if (!this.stage.application.focusTopDownEvent([`_capture${keys[i]}Release`, \"_captureKeyRelease\"], obj)) {\n                    this.stage.application.focusBottomUpEvent([`_handle${keys[i]}Release`, \"_handleKeyRelease\"], obj);\n                }\n            }\n        } else {\n            if (!this.stage.application.focusTopDownEvent([\"_captureKeyRelease\"], obj)) {\n                this.stage.application.focusBottomUpEvent([\"_handleKeyRelease\"], obj);\n            }\n        }\n\n        this.updateFocusPath();\n\n        if (keys) {\n            for (let i = 0, n = keys.length; i < n; i++) {\n                if (this.__keypressTimers.has(keys[i])) {\n                    // keyup has fired before end of timeout so we clear it\n                    clearTimeout(this.__keypressTimers.get(keys[i]));\n                    // delete so we can register it again\n                    this.__keypressTimers.delete(keys[i]);\n                }\n            }\n        }\n    }\n\n    /**\n     * Registers and starts a timer for the pressed key. Timer will be cleared when the key is released\n     * before the timer goes off.\n     *\n     * If key is not release (keyup) the longpress handler will be fired.\n     * Configuration can be via the Components template:\n     *\n     * static _template() {\n     *     return {\n     *         w:100, h:100,\n     *         longpress:{up:700, down:500}\n     *     }\n     * }     *\n     * // this will get called when up has been pressed for 700ms\n     * _handleUpLong() {\n     *\n     * }\n     *\n     * @param key\n     * @param element\n     * @private\n     */\n    _startLongpressTimer(key, element) {\n        const config = element.longpress;\n        const lookup = key.toLowerCase();\n\n        if (config[lookup]) {\n            const timeout = config[lookup];\n            if (!Utils.isNumber(timeout)) {\n                element._throwError(\"config value for longpress must be a number\");\n            } else {\n                this.__keypressTimers.set(key, setTimeout(() => {\n                    if (!this.stage.application.focusTopDownEvent([`_capture${key}Long`, \"_captureKey\"], {})) {\n                        this.stage.application.focusBottomUpEvent([`_handle${key}Long`, \"_handleKey\"], {});\n                    }\n\n                    this.__keypressTimers.delete(key);\n                }, timeout || 500 /* prevent 0ms */));\n            }\n        }\n        return;\n    }\n\n    _recieveScrollWheel(e) {\n        const obj = e;\n        const { clientX, clientY } = obj;\n\n        if (clientX <= this.stage.w && clientY <= this.stage.h) {\n            if (!this.fireTopDownScrollWheelHandler(\"_captureScroll\", obj)) {\n                this.fireBottomUpScrollWheelHandler(\"_handleScroll\", obj);\n            }\n        }\n    }\n\n    fireTopDownScrollWheelHandler(event, obj) {\n        let children = this.stage.application.children;\n        let affected = this._findChildren([], children).reverse();\n        let n = affected.length;\n\n        while (n--) {\n            const child = affected[n];\n            if (child && child[event]) {\n                child._captureScroll(obj);\n                return true;\n            }\n        }\n        return false;\n    }\n\n    fireBottomUpScrollWheelHandler(event, obj) {\n        const { clientX, clientY } = obj;\n        const target = this._getTargetChild(clientX, clientY);\n        let child = target;\n\n        // Search tree bottom up for a handler\n        while (child !== null) {\n            if (child && child[event]) {\n                child._handleScroll(obj);\n                return true;\n            }\n            child = child.parent;\n        }\n        return false;\n    }\n\n    _receiveClick(e) {\n        const obj = e;\n        const { clientX, clientY } = obj;\n\n        if (clientX <= this.stage.w && clientY <= this.stage.h) {\n            this.stage.application.fireBottomUpClickHandler(obj);\n        }\n    }\n\n    fireBottomUpClickHandler(obj) {\n        const { clientX, clientY } = obj;\n        const target = this._getTargetChild(clientX, clientY);\n        const precision = this.stage.getRenderPrecision() / this.stage.getOption('devicePixelRatio');\n        let child = target;\n\n        // Search tree bottom up for a handler\n        while (child !== null) {\n            if (child && child[\"_handleClick\"]) {\n                const { px, py } = child.core._worldContext;\n                const cx = px * precision;\n                const cy = py * precision;\n\n                const localCoords = {\n                    x: clientX - cx,\n                    y: clientY - cy\n                }\n\n                const returnValue = child._handleClick(target, localCoords);\n                if (returnValue !== false) {\n                    break;\n                }\n            }\n            child = child.parent;\n        }\n    }\n\n    _receiveHover(e) {\n        const obj = e;\n        const { clientX, clientY } = obj;\n\n        if (clientX <= this.stage.w && clientY <= this.stage.h) {\n            this.stage.application.fireBottomUpHoverHandler(obj);\n        }\n    }\n\n    fireBottomUpHoverHandler(obj) {\n        const { clientX, clientY } = obj;\n        const target = this._getTargetChild(clientX, clientY);\n\n        // Only fire handlers when pointer target changes\n        if (target !== this.__hoveredChild) {\n\n            let hoveredBranch = new Set();\n            let newHoveredBranch = new Set();\n\n            if (target) {\n                newHoveredBranch = new Set(target.getAncestors());\n            }\n\n            if (this.__hoveredChild) {\n                hoveredBranch = new Set(this.__hoveredChild.getAncestors());\n                for (const elem of [...hoveredBranch].filter((e) => !newHoveredBranch.has(e))) {\n                    const c = Component.getComponent(elem);\n                    if (c[\"_handleUnhover\"]) {\n                        c._handleUnhover(elem);\n                    }\n                    if (elem.parent && elem.parent.cursor) {\n                        this.stage.getCanvas().style.cursor = elem.parent.cursor;\n                    }\n                }\n            }\n\n            this.__hoveredChild = target;\n\n            const diffBranch = [...newHoveredBranch].filter((e) => !hoveredBranch.has(e))\n            for (const elem of diffBranch) {\n                const c = Component.getComponent(elem);\n                if (c[\"_handleHover\"]) {\n                    c._handleHover(elem);\n                }\n            }\n\n            // New element hover cursor\n            const lastElement = diffBranch[0];\n            if (lastElement && lastElement.cursor) {\n                this.stage.getCanvas().style.cursor = lastElement.cursor;\n            }\n\n            // Rerun _handleHover for target element in case it's been hovered\n            // back from its child\n            if (diffBranch.length === 0 && target) {\n                const c = Component.getComponent(target);\n                if (c[\"_handleHover\"]) {\n                    c._handleHover(target);\n                }\n            }\n        }\n    }\n\n    _getTargetChild(clientX, clientY) {\n        let children = this.stage.application.children;\n        let affected = this._findChildren([], children);\n        let hoverableChildren = this._withinClickableRange(affected, clientX, clientY);\n\n        hoverableChildren.sort((a, b) => {\n            // Sort by zIndex and then id\n            if (a.zIndex > b.zIndex) {\n                return 1;\n            } else if (a.zIndex < b.zIndex) {\n                return -1;\n            } else {\n                return a.id > b.id ? 1 : -1;\n            }\n        });\n\n        if (hoverableChildren.length) {\n            // Assume target has highest zIndex (id when zIndex equal)\n            return hoverableChildren.slice(-1)[0];\n        } else {\n            return null;\n        }\n    }\n\n    _findChildren(bucket, children) {\n        let n = children.length;\n        while (n--) {\n            const child = children[n];\n            // only add active children\n            if (child.__active && child.collision) {\n                if (child.collision === true) {\n                    bucket.push(child);\n                }\n                if (child.hasChildren()) {\n                    this._findChildren(bucket, child.children);\n                }\n            }\n        }\n        return bucket;\n    }\n\n    _withinClickableRange(affectedChildren, cursorX, cursorY) {\n        let n = affectedChildren.length;\n        const candidates = [];\n\n        // loop through affected children\n        // and perform collision detection\n        while (n--) {\n            const child = affectedChildren[n];\n            const precision = this.stage.getRenderPrecision() / this.stage.getOption('devicePixelRatio');\n            const ctx = child.core._worldContext;\n\n            const cx = ctx.px * precision;\n            const cy = ctx.py * precision;\n            const cw = child.finalW * ctx.ta * precision;\n            const ch = child.finalH * ctx.td * precision;\n\n            if (cx > this.stage.w || cy > this.stage.h) {\n                continue;\n            }\n\n            if (child.parent.core._scissor) {\n                const scissor = child.parent.core._scissor.map((v) => v * precision);\n                if (!this._testCollision(cursorX, cursorY, ...scissor))\n                    continue\n            }\n\n            if (this._testCollision(cursorX, cursorY, cx, cy, cw, ch)) {\n                candidates.push(child);\n            }\n        }\n        return candidates;\n    }\n\n    _testCollision(px, py, cx, cy, cw, ch) {\n        if (px >= cx &&\n            px <= cx + cw &&\n            py >= cy &&\n            py <= cy + ch) {\n            return true;\n        }\n        return false;\n    }\n\n    destroy() {\n        if (!this._destroyed) {\n            this._destroy();\n            this.stage.destroy();\n            this._destroyed = true;\n        }\n    }\n\n    _destroy() {\n        // This forces the _detach, _disabled and _active events to be called.\n        this.stage.setApplication(undefined);\n        this._updateAttachedFlag();\n        this._updateEnabledFlag();\n\n        if (this.__keypressTimers.size) {\n            for (const timer of this.__keypressTimers.values()) {\n                clearTimeout(timer);\n            }\n\n            this.__keypressTimers.clear();\n        }\n    }\n\n    getCanvas() {\n        return this.stage.getCanvas();\n    }\n\n}\n\nimport Stage from \"../tree/Stage.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Texture from \"../tree/Texture.mjs\";\n\nexport default class StaticCanvasTexture extends Texture {\n\n    constructor(stage) {\n        super(stage);\n        this._factory = undefined;\n        this._lookupId = undefined;\n    }\n\n    set content({factory, lookupId = undefined}) {\n        this._factory = factory;\n        this._lookupId = lookupId;\n        this._changed();\n    }\n\n    _getIsValid() {\n        return !!this._factory;\n    }\n\n    _getLookupId() {\n        return this._lookupId;\n    }\n\n    _getSourceLoader() {\n        const f = this._factory;\n        return (cb) => {\n            return f((err, canvas) => {\n                if (err) {\n                    return cb(err);\n                }\n                cb(null, this.stage.platform.getTextureOptionsForDrawingCanvas(canvas));\n            }, this.stage);\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Utils from \"../tree/Utils.mjs\";\nimport StageUtils from \"../tree/StageUtils.mjs\";\nimport StaticCanvasTexture from \"../textures/StaticCanvasTexture.mjs\"\n\nexport default class Tools {\n\n    static getCanvasTexture(canvasFactory, lookupId) {\n        return {type: StaticCanvasTexture, content: {factory: canvasFactory, lookupId: lookupId}}\n    }\n\n    static getRoundRect(w, h, radius, strokeWidth, strokeColor, fill, fillColor) {\n        if (!Array.isArray(radius)){\n            // upper-left, upper-right, bottom-right, bottom-left.\n            radius = [radius, radius, radius, radius];\n        }\n\n        let factory = (cb, stage) => {\n            if (Utils.isSpark) {\n                stage.platform.createRoundRect(cb, stage, w, h, radius, strokeWidth, strokeColor, fill, fillColor);\n            } else {\n                cb(null, this.createRoundRect(stage, w, h, radius, strokeWidth, strokeColor, fill, fillColor));\n            }\n        };\n        let id = 'rect' + [w, h, strokeWidth, strokeColor, fill ? 1 : 0, fillColor].concat(radius).join(\",\");\n        return Tools.getCanvasTexture(factory, id);\n    }\n\n    static createRoundRect(stage, w, h, radius, strokeWidth, strokeColor, fill, fillColor) {\n        if (fill === undefined) fill = true;\n        if (strokeWidth === undefined) strokeWidth = 0;\n\n        let canvas = stage.platform.getDrawingCanvas();\n        let ctx = canvas.getContext('2d');\n        ctx.imageSmoothingEnabled = true;\n\n        canvas.width = w + strokeWidth + 2;\n        canvas.height = h + strokeWidth + 2;\n\n        ctx.beginPath();\n        let x = 0.5 * strokeWidth + 1, y = 0.5 * strokeWidth + 1;\n\n        ctx.moveTo(x + radius[0], y);\n        ctx.lineTo(x + w - radius[1], y);\n        ctx.arcTo(x + w, y, x + w, y + radius[1], radius[1]);\n        ctx.lineTo(x + w, y + h - radius[2]);\n        ctx.arcTo(x + w, y + h, x + w - radius[2], y + h, radius[2]);\n        ctx.lineTo(x + radius[3], y + h);\n        ctx.arcTo(x, y + h, x, y + h - radius[3], radius[3]);\n        ctx.lineTo(x, y + radius[0]);\n        ctx.arcTo(x, y, x + radius[0], y, radius[0]);\n        ctx.closePath();\n\n        if (fill) {\n            if (Utils.isNumber(fillColor)) {\n                ctx.fillStyle = StageUtils.getRgbaString(fillColor);\n            } else {\n                ctx.fillStyle = \"white\";\n            }\n            ctx.fill();\n        }\n\n        if (strokeWidth) {\n            if (Utils.isNumber(strokeColor)) {\n                ctx.strokeStyle = StageUtils.getRgbaString(strokeColor);\n            } else {\n                ctx.strokeStyle = \"white\";\n            }\n            ctx.lineWidth = strokeWidth;\n            ctx.stroke();\n        }\n\n        return canvas;\n    }\n\n    static getShadowRect(w, h, radius = 0, blur = 5, margin = blur * 2) {\n        if (!Array.isArray(radius)){\n            // upper-left, upper-right, bottom-right, bottom-left.\n            radius = [radius, radius, radius, radius];\n        }\n\n        let factory = (cb, stage) => {\n            if (Utils.isSpark) {\n                stage.platform.createShadowRect(cb, stage, w, h, radius, blur, margin);\n            } else {\n                cb(null, this.createShadowRect(stage, w, h, radius, blur, margin));\n            }\n        };\n        let id = 'shadow' + [w, h, blur, margin].concat(radius).join(\",\");\n        return Tools.getCanvasTexture(factory, id);\n    }\n\n    static createShadowRect(stage, w, h, radius, blur, margin) {\n        let canvas = stage.platform.getDrawingCanvas();\n        let ctx = canvas.getContext('2d');\n        ctx.imageSmoothingEnabled = true;\n\n        canvas.width = w + margin * 2;\n        canvas.height = h + margin * 2;\n\n        // WpeWebKit bug: we experienced problems without this with shadows in noncompositedwebgl mode.\n        ctx.globalAlpha = 0.01;\n        ctx.fillRect(0, 0, 0.01, 0.01);\n        ctx.globalAlpha = 1.0;\n\n        ctx.shadowColor = StageUtils.getRgbaString(0xFFFFFFFF);\n        ctx.fillStyle = StageUtils.getRgbaString(0xFFFFFFFF);\n        ctx.shadowBlur = blur;\n        ctx.shadowOffsetX = (w + 10) + margin;\n        ctx.shadowOffsetY = margin;\n\n        ctx.beginPath();\n        const x = -(w + 10);\n        const y = 0;\n\n        ctx.moveTo(x + radius[0], y);\n        ctx.lineTo(x + w - radius[1], y);\n        ctx.arcTo(x + w, y, x + w, y + radius[1], radius[1]);\n        ctx.lineTo(x + w, y + h - radius[2]);\n        ctx.arcTo(x + w, y + h, x + w - radius[2], y + h, radius[2]);\n        ctx.lineTo(x + radius[3], y + h);\n        ctx.arcTo(x, y + h, x, y + h - radius[3], radius[3]);\n        ctx.lineTo(x, y + radius[0]);\n        ctx.arcTo(x, y, x + radius[0], y, radius[0]);\n        ctx.closePath();\n        ctx.fill();\n\n        return canvas;\n    }\n\n    static getSvgTexture(url, w, h) {\n        let factory = (cb, stage) => {\n            if (Utils.isSpark) {\n                stage.platform.createSvg(cb, stage, url, w, h);\n            } else {\n                this.createSvg(cb, stage, url, w, h);\n            }\n        };\n        let id = 'svg' + [w, h, url].join(\",\");\n        return Tools.getCanvasTexture(factory, id);\n    }\n\n    static createSvg(cb, stage, url, w, h) {\n        let canvas = stage.platform.getDrawingCanvas();\n        let ctx = canvas.getContext('2d');\n        ctx.imageSmoothingEnabled = true;\n\n        let img = new Image();\n        img.onload = () => {\n            canvas.width = w;\n            canvas.height = h;\n            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n            cb(null, canvas);\n        }\n        img.onerror = (err) => {\n            cb(err);\n        }\n\n        // On the PS4 platform setting the `crossOrigin` attribute on images\n        // can cause CORS failures.\n        if (!Utils.isPS4) {\n            img.crossOrigin = \"Anonymous\";\n        }\n\n        img.src = url;\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Utils from \"../tree/Utils.mjs\";\n\nexport default class ObjMerger {\n\n    static isMf(f) {\n        return Utils.isFunction(f) && f.__mf;\n    }\n\n    static mf(f) {\n        // Set as merge function.\n        f.__mf = true;\n        return f;\n    }\n\n    static merge(a, b) {\n        const aks = Object.keys(a);\n        const bks = Object.keys(b);\n\n        if (!bks.length) {\n            return a;\n        }\n\n        // Create index array for all elements.\n        const ai = {};\n        const bi = {};\n        for (let i = 0, n = bks.length; i < n; i++) {\n            const key = bks[i];\n            ai[key] = -1;\n            bi[key] = i;\n        }\n        for (let i = 0, n = aks.length; i < n; i++) {\n            const key = aks[i];\n            ai[key] = i;\n            if (bi[key] === undefined) {\n                bi[key] = -1;\n            }\n        }\n\n        const aksl = aks.length;\n\n        const result = {};\n        for (let i = 0, n = bks.length; i < n; i++) {\n            const key = bks[i];\n\n            // Prepend all items in a that are not in b - before the now added b attribute.\n            const aIndex = ai[key];\n            let curIndex = aIndex;\n            while(--curIndex >= 0) {\n                const akey = aks[curIndex];\n                if (bi[akey] !== -1) {\n                    // Already found? Stop processing.\n                    // Not yet found but exists in b? Also stop processing: wait until we find it in b.\n                    break;\n                }\n            }\n            while(++curIndex < aIndex) {\n                const akey = aks[curIndex];\n                result[akey] = a[akey];\n            }\n\n            const bv = b[key];\n            const av = a[key];\n            let r;\n            if (this.isMf(bv)) {\n                r = bv(av);\n            } else {\n                if (!Utils.isObjectLiteral(av) || !Utils.isObjectLiteral(bv)) {\n                    r = bv;\n                } else {\n                    r = ObjMerger.merge(av, bv);\n                }\n            }\n\n            // When marked as undefined, property is deleted.\n            if (r !== undefined) {\n                result[key] = r;\n            }\n        }\n\n        // Append remaining final items in a.\n        let curIndex = aksl;\n        while(--curIndex >= 0) {\n            const akey = aks[curIndex];\n            if (bi[akey] !== -1) {\n                break;\n            }\n        }\n        while(++curIndex < aksl) {\n            const akey = aks[curIndex];\n            result[akey] = a[akey];\n        }\n\n        return result;\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Manages the list of children for an element.\n */\n\nimport ObjectList from \"../tree/ObjectList.mjs\";\n\nexport default class ObjectListProxy extends ObjectList {\n\n    constructor(target) {\n        super();\n        this._target = target;\n    }\n\n    onAdd(item, index) {\n        this._target.addAt(item, index);\n    }\n\n    onRemove(item, index) {\n        this._target.removeAt(index);\n    }\n\n    onSync(removed, added, order) {\n        this._target._setByArray(order);\n    }\n\n    onSet(item, index) {\n        this._target.setAt(item, index);\n    }\n\n    onMove(item, fromIndex, toIndex) {\n        this._target.setAt(item, toIndex);\n    }\n\n    createItem(object) {\n        return this._target.createItem(object);\n    }\n\n    isItem(object) {\n        return this._target.isItem(object);\n    }\n\n}\n\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Manages the list of children for an element.\n */\n\nimport ObjectListProxy from \"./ObjectListProxy.mjs\";\n\nexport default class ObjectListWrapper extends ObjectListProxy {\n\n    constructor(target, wrap) {\n        super(target);\n        this._wrap = wrap;\n    }\n\n    wrap(item) {\n        let wrapper = this._wrap(item);\n        item._wrapper = wrapper;\n        return wrapper;\n    }\n\n    onAdd(item, index) {\n        item = this.wrap(item);\n        super.onAdd(item, index);\n    }\n\n    onRemove(item, index) {\n        super.onRemove(item, index);\n    }\n\n    onSync(removed, added, order) {\n        added.forEach(a => this.wrap(a));\n        order = order.map(a => a._wrapper);\n        super.onSync(removed, added, order);\n    }\n\n    onSet(item, index) {\n        item = this.wrap(item);\n        super.onSet(item, index);\n    }\n\n    onMove(item, fromIndex, toIndex) {\n        super.onMove(item, fromIndex, toIndex);\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Texture from \"../tree/Texture.mjs\";\n\nexport default class NoiseTexture extends Texture {\n\n    _getLookupId() {\n        return '__noise';\n    }\n\n    _getSourceLoader() {\n        const gl = this.stage.gl;\n        return function(cb) {\n            const noise = new Uint8Array(128 * 128 * 4);\n            for (let i = 0; i < 128 * 128 * 4; i+=4) {\n                const v = Math.floor(Math.random() * 256);\n                noise[i] = v;\n                noise[i+1] = v;\n                noise[i+2] = v;\n                noise[i+3] = 255;\n            }\n            const texParams = {}\n\n            if (gl) {\n                texParams[gl.TEXTURE_WRAP_S] = gl.REPEAT;\n                texParams[gl.TEXTURE_WRAP_T] = gl.REPEAT;\n                texParams[gl.TEXTURE_MIN_FILTER] = gl.NEAREST;\n                texParams[gl.TEXTURE_MAG_FILTER] = gl.NEAREST;\n            }\n\n            cb(null, {source: noise, w: 128, h: 128, texParams: texParams});\n        }\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Texture from \"../tree/Texture.mjs\";\n\nexport default class HtmlTexture extends Texture {\n\n    constructor(stage) {\n        super(stage);\n        this._htmlElement = undefined;\n        this._scale = 1;\n    }\n\n    set htmlElement(v) {\n        this._htmlElement = v;\n        this._changed();\n    }\n\n    get htmlElement() {\n        return this._htmlElement;\n    }\n\n    set scale(v) {\n        this._scale = v;\n        this._changed();\n    }\n\n    get scale() {\n        return this._scale;\n    }\n\n    set html(v) {\n        if (!v) {\n            this.htmlElement = undefined;\n        } else {\n            const d = document.createElement('div');\n            d.innerHTML = \"<div>\" + v + \"</div>\";\n            this.htmlElement = d.firstElementChild;\n        }\n    }\n\n    get html() {\n        return this._htmlElement.innerHTML;\n    }\n\n    _getIsValid() {\n        return this.htmlElement;\n    }\n\n    _getLookupId() {\n        return this._scale + \":\" + this._htmlElement.innerHTML;\n    }\n\n    _getSourceLoader() {\n        const htmlElement = this._htmlElement;\n        const scale = this._scale;\n        return function(cb) {\n            if (!window.html2canvas) {\n                return cb(new Error(\"Please include html2canvas (https://html2canvas.hertzen.com/)\"));\n            }\n\n            const area = HtmlTexture.getPreloadArea();\n            area.appendChild(htmlElement);\n\n            html2canvas(htmlElement, {backgroundColor: null, scale: scale}).then(function(canvas) {\n                area.removeChild(htmlElement);\n                if (canvas.height === 0) {\n                    return cb(new Error(\"Canvas height is 0\"));\n                }\n                cb(null, {source: canvas, width: canvas.width, height: canvas.height});\n            }).catch(e => {\n                console.error('[Lightning]', e);\n            });\n        }\n    }\n\n    static getPreloadArea() {\n        if (!this._preloadArea) {\n            // Preload area must be included in document body and must be visible to trigger html element rendering.\n            this._preloadArea = document.createElement('div');\n            if (this._preloadArea.attachShadow) {\n                // Use a shadow DOM if possible to prevent styling from interfering.\n                this._preloadArea.attachShadow({mode: 'closed'});\n            }\n            this._preloadArea.style.opacity = 0;\n            this._preloadArea.style.pointerEvents = 'none';\n            this._preloadArea.style.position = 'fixed';\n            this._preloadArea.style.display = 'block';\n            this._preloadArea.style.top = '100vh';\n            this._preloadArea.style.overflow = 'hidden';\n            document.body.appendChild(this._preloadArea);\n        }\n        return this._preloadArea;\n    }\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Texture from \"../tree/Texture.mjs\";\n\nexport default class StaticTexture extends Texture {\n\n    constructor(stage, options) {\n        super(stage);\n\n        this._options = options;\n    }\n\n    set options(v) {\n        if (this._options !== v) {\n            this._options = v;\n            this._changed();\n        }\n    }\n\n    get options() {\n        return this._options;\n    }\n\n    _getIsValid() {\n        return !!this._options;\n    }\n\n    _getSourceLoader() {\n        return (cb) => {\n            cb(null, this._options);\n        }\n    }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Component from \"../application/Component.mjs\";\n\nexport default class ListComponent extends Component {\n\n    constructor(stage) {\n        super(stage);\n\n        this._wrapper = super._children.a({});\n\n        this._reloadVisibleElements = false;\n\n        this._visibleItems = new Set();\n\n        this._index = 0;\n\n        this._started = false;\n\n        /**\n         * The transition definition that is being used when scrolling the items.\n         * @type TransitionSettings\n         */\n        this._scrollTransitionSettings = this.stage.transitions.createSettings({});\n\n        /**\n         * The scroll area size in pixels per item.\n         */\n        this._itemSize = 100;\n\n        this._viewportScrollOffset = 0;\n\n        this._itemScrollOffset = 0;\n\n        /**\n         * Should the list jump when scrolling between end to start, or should it be continuous, like a carrousel?\n         */\n        this._roll = false;\n\n        /**\n         * Allows restricting the start scroll position.\n         */\n        this._rollMin = 0;\n\n        /**\n         * Allows restricting the end scroll position.\n         */\n        this._rollMax = 0;\n\n        /**\n         * Definition for a custom animation that is applied when an item is (partially) selected.\n         * @type AnimationSettings\n         */\n        this._progressAnimation = null;\n\n        /**\n         * Inverts the scrolling direction.\n         * @type {boolean}\n         * @private\n         */\n        this._invertDirection = false;\n\n        /**\n         * Layout the items horizontally or vertically?\n         * @type {boolean}\n         * @private\n         */\n        this._horizontal = true;\n\n        this.itemList = new ListItems(this);\n    }\n\n    _allowChildrenAccess() {\n        return false;\n    }\n\n    get items() {\n        return this.itemList.get();\n    }\n\n    set items(children) {\n        this.itemList.patch(children);\n    }\n\n    start() {\n        this._wrapper.transition(this.property, this._scrollTransitionSettings);\n        this._scrollTransition = this._wrapper.transition(this.property);\n        this._scrollTransition.on('progress', p => this.update());\n\n        this.setIndex(0, true, true);\n\n        this._started = true;\n\n        this.update();\n    }\n\n    setIndex(index, immediate = false, closest = false) {\n        let nElements = this.length;\n        if (!nElements) return;\n\n        this.emit('unfocus', this.getElement(this.realIndex), this._index, this.realIndex);\n\n        if (closest) {\n            // Scroll to same offset closest to the index.\n            let offset = Utils.getModuloIndex(index, nElements);\n            let o = Utils.getModuloIndex(this.index, nElements);\n            let diff = offset - o;\n            if (diff > 0.5 * nElements) {\n                diff -= nElements;\n            } else if (diff < -0.5 * nElements) {\n                diff += nElements;\n            }\n            this._index += diff;\n        } else {\n            this._index = index;\n        }\n\n        if (this._roll || (this.viewportSize > this._itemSize * nElements)) {\n            this._index = Utils.getModuloIndex(this._index, nElements);\n        }\n\n        let direction = (this._horizontal ^ this._invertDirection ? -1 : 1);\n        let value = direction * this._index * this._itemSize;\n\n        if (this._roll) {\n            let min, max, scrollDelta;\n            if (direction == 1) {\n                max = (nElements - 1) * this._itemSize;\n                scrollDelta = this._viewportScrollOffset * this.viewportSize - this._itemScrollOffset * this._itemSize;\n\n                max -= scrollDelta;\n\n                min = this.viewportSize - (this._itemSize + scrollDelta);\n\n                if (this._rollMin) min -= this._rollMin;\n                if (this._rollMax) max += this._rollMax;\n\n                value = Math.max(Math.min(value, max), min);\n            } else {\n                max = (nElements * this._itemSize - this.viewportSize);\n                scrollDelta = this._viewportScrollOffset * this.viewportSize - this._itemScrollOffset * this._itemSize;\n\n                max += scrollDelta;\n\n                let min = scrollDelta;\n\n                if (this._rollMin) min -= this._rollMin;\n                if (this._rollMax) max += this._rollMax;\n\n                value = Math.min(Math.max(-max, value), -min);\n            }\n        }\n\n        this._scrollTransition.start(value);\n\n        if (immediate) {\n            this._scrollTransition.finish();\n        }\n\n        this.emit('focus', this.getElement(this.realIndex), this._index, this.realIndex);\n    }\n\n    getAxisPosition() {\n        let target = -this._scrollTransition._targetValue;\n\n        let direction = (this._horizontal ^ this._invertDirection ? -1 : 1);\n        let value = -direction * this._index * this._itemSize;\n\n        return this._viewportScrollOffset * this.viewportSize + (value - target);\n    }\n\n    update() {\n        if (!this._started) return;\n\n        let nElements = this.length;\n        if (!nElements) return;\n\n        let direction = (this._horizontal ^ this._invertDirection ? -1 : 1);\n\n        // Map position to index value.\n        let v = (this._horizontal ? this._wrapper.x : this._wrapper.y);\n\n        let viewportSize = this.viewportSize;\n        let scrollDelta = this._viewportScrollOffset * viewportSize - this._itemScrollOffset * this._itemSize;\n        v += scrollDelta;\n\n        let s, e, ps, pe;\n        if (direction == -1) {\n            s = Math.floor(-v / this._itemSize);\n            ps = 1 - ((-v / this._itemSize) - s);\n            e = Math.floor((viewportSize - v) / this._itemSize);\n            pe = (((viewportSize - v) / this._itemSize) - e);\n        } else {\n            s = Math.ceil(v / this._itemSize);\n            ps = 1 + (v / this._itemSize) - s;\n            e = Math.ceil((v - viewportSize) / this._itemSize);\n            pe = e - ((v - viewportSize) / this._itemSize);\n        }\n        if (this._roll || (viewportSize > this._itemSize * nElements)) {\n            // Don't show additional items.\n            if (e >= nElements) {\n                e = nElements - 1;\n                pe = 1;\n            }\n            if (s >= nElements) {\n                s = nElements - 1;\n                ps = 1;\n            }\n            if (e <= -1) {\n                e = 0;\n                pe = 1;\n            }\n            if (s <= -1) {\n                s = 0;\n                ps = 1;\n            }\n        }\n\n        let offset = -direction * s * this._itemSize;\n\n        let item;\n        for (let index = s; (direction == -1 ? index <= e : index >= e); (direction == -1 ? index++ : index--)) {\n            let realIndex = Utils.getModuloIndex(index, nElements);\n\n            let element = this.getElement(realIndex);\n            item = element.parent;\n            this._visibleItems.delete(item);\n            if (this._horizontal) {\n                item.x = offset + scrollDelta;\n            } else {\n                item.y = offset + scrollDelta;\n            }\n\n            let wasVisible = item.visible;\n            item.visible = true;\n\n            if (!wasVisible || this._reloadVisibleElements) {\n                // Turned visible.\n                this.emit('visible', index, realIndex);\n            }\n\n\n\n            if (this._progressAnimation) {\n                let p = 1;\n                if (index == s) {\n                    p = ps;\n                } else if (index == e) {\n                    p = pe;\n                }\n\n                // Use animation to progress.\n                this._progressAnimation.apply(element, p);\n            }\n\n            offset += this._itemSize;\n        }\n\n        // Handle item visibility.\n        let self = this;\n        this._visibleItems.forEach(function(invisibleItem) {\n            invisibleItem.visible = false;\n            self._visibleItems.delete(invisibleItem);\n        });\n\n        for (let index = s; (direction == -1 ? index <= e : index >= e); (direction == -1 ? index++ : index--)) {\n            let realIndex = Utils.getModuloIndex(index, nElements);\n            this._visibleItems.add(this.getWrapper(realIndex));\n        }\n\n        this._reloadVisibleElements = false;\n    }\n\n    setPrevious() {\n        this.setIndex(this._index - 1);\n    }\n\n    setNext() {\n        this.setIndex(this._index + 1);\n    }\n\n    getWrapper(index) {\n        return this._wrapper.children[index];\n    }\n\n    getElement(index) {\n        let e = this._wrapper.children[index];\n        return e ? e.children[0] : null;\n    }\n\n    reload() {\n        this._reloadVisibleElements = true;\n        this.update();\n    }\n\n    get element() {\n        let e = this._wrapper.children[this.realIndex];\n        return e ? e.children[0] : null;\n    }\n\n    get length() {\n        return this._wrapper.children.length;\n    }\n\n    get property() {\n        return this._horizontal ? 'x' : 'y';\n    }\n\n    get viewportSize() {\n        return this._horizontal ? this.w : this.h;\n    }\n\n    get index() {\n        return this._index;\n    }\n\n    get realIndex() {\n        return Utils.getModuloIndex(this._index, this.length);\n    }\n\n    get itemSize() {\n        return this._itemSize;\n    }\n\n    set itemSize(v) {\n        this._itemSize = v;\n        this.update();\n    }\n\n    get viewportScrollOffset() {\n        return this._viewportScrollOffset;\n    }\n\n    set viewportScrollOffset(v) {\n        this._viewportScrollOffset = v;\n        this.update();\n    }\n\n    get itemScrollOffset() {\n        return this._itemScrollOffset;\n    }\n\n    set itemScrollOffset(v) {\n        this._itemScrollOffset = v;\n        this.update();\n    }\n\n    get scrollTransitionSettings() {\n        return this._scrollTransitionSettings;\n    }\n\n    set scrollTransitionSettings(v) {\n        this._scrollTransitionSettings.patch(v);\n    }\n\n    set scrollTransition(v) {\n        this._scrollTransitionSettings.patch(v);\n    }\n\n    get scrollTransition() {\n        return this._scrollTransition;\n    }\n\n    get progressAnimation() {\n        return this._progressAnimation;\n    }\n\n    set progressAnimation(v) {\n        if (Utils.isObjectLiteral(v)) {\n            this._progressAnimation = this.stage.animations.createSettings(v);\n        } else {\n            this._progressAnimation = v;\n        }\n        this.update();\n    }\n\n    get roll() {\n        return this._roll;\n    }\n\n    set roll(v) {\n        this._roll = v;\n        this.update();\n    }\n\n    get rollMin() {\n        return this._rollMin;\n    }\n\n    set rollMin(v) {\n        this._rollMin = v;\n        this.update();\n    }\n\n    get rollMax() {\n        return this._rollMax;\n    }\n\n    set rollMax(v) {\n        this._rollMax = v;\n        this.update();\n    }\n\n    get invertDirection() {\n        return this._invertDirection;\n    }\n\n    set invertDirection(v) {\n        if (!this._started) {\n            this._invertDirection = v;\n        }\n    }\n\n    get horizontal() {\n        return this._horizontal;\n    }\n\n    set horizontal(v) {\n        if (v !== this._horizontal) {\n            if (!this._started) {\n                this._horizontal = v;\n            }\n        }\n    }\n\n}\n\nimport ObjectListWrapper from \"../tools/ObjectListWrapper.mjs\";\nclass ListItems extends ObjectListWrapper {\n    constructor(list) {\n        let wrap = (item => {\n            let parent = item.stage.createElement();\n            parent.add(item);\n            parent.visible = false;\n            return parent;\n        })\n\n        super(list._wrapper._children, wrap);\n        this.list = list;\n    }\n\n    onAdd(item, index) {\n        super.onAdd(item, index);\n        this.checkStarted(index);\n    }\n\n    checkStarted(index) {\n        this.list._reloadVisibleElements = true;\n        if (!this.list._started) {\n            this.list.start();\n        } else {\n            if (this.list.length === 1) {\n                this.list.setIndex(0, true, true);\n            } else {\n                if (this.list._index >= this.list.length) {\n                    this.list.setIndex(0);\n                }\n            }\n            this.list.update();\n        }\n    }\n\n    onRemove(item, index) {\n        super.onRemove(item, index);\n        let ri = this.list.realIndex;\n        if (ri === index) {\n            if (ri === this.list.length) {\n                ri--;\n            }\n            if (ri >= 0) {\n                this.list.setIndex(ri);\n            }\n        } else if (ri > index) {\n            this.list.setIndex(ri - 1);\n        }\n\n        this.list._reloadVisibleElements = true;\n    }\n\n    onSet(item, index) {\n        super.onSet(item, index);\n        this.checkStarted(index);\n    }\n\n    onSync(removed, added, order) {\n        super.onSync(removed, added, order);\n        this.checkStarted(0);\n    }\n\n    get _signalProxy() {\n        return true;\n    }\n\n}\n\nimport Utils from \"../tree/Utils.mjs\";\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class LinearBlurShader extends DefaultShader {\n\n    constructor(context) {\n        super(context);\n\n        this._direction = new Float32Array([1, 0]);\n        this._kernelRadius = 1;\n    }\n\n    get x() {\n        return this._direction[0];\n    }\n\n    set x(v) {\n        this._direction[0] = v;\n        this.redraw();\n    }\n\n    get y() {\n        return this._direction[1];\n    }\n\n    set y(v) {\n        this._direction[1] = v;\n        this.redraw();\n    }\n\n    get kernelRadius() {\n        return this._kernelRadius;\n    }\n\n    set kernelRadius(v) {\n        this._kernelRadius = v;\n        this.redraw();\n    }\n\n\n    useDefault() {\n        return (this._kernelRadius === 0);\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        this._setUniform(\"direction\", this._direction, this.gl.uniform2fv);\n        this._setUniform(\"kernelRadius\", this._kernelRadius, this.gl.uniform1i);\n\n        const w = operation.getRenderWidth();\n        const h = operation.getRenderHeight();\n        this._setUniform(\"resolution\", new Float32Array([w, h]), this.gl.uniform2fv);\n    }\n}\n\nLinearBlurShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 resolution;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 direction;\n    uniform int kernelRadius;\n    \n    vec4 blur1(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3333333333333333) * direction;\n        color += texture2D(image, uv) * 0.29411764705882354;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n        return color; \n    }\n    \n    vec4 blur2(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3846153846) * direction;\n        vec2 off2 = vec2(3.2307692308) * direction;\n        color += texture2D(image, uv) * 0.2270270270;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n        return color;\n    }\n    \n    vec4 blur3(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.411764705882353) * direction;\n        vec2 off2 = vec2(3.2941176470588234) * direction;\n        vec2 off3 = vec2(5.176470588235294) * direction;\n        color += texture2D(image, uv) * 0.1964825501511404;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n        color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n        return color;\n    }    \n\n    void main(void){\n        if (kernelRadius == 1) {\n            gl_FragColor = blur1(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else if (kernelRadius == 2) {\n            gl_FragColor = blur2(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else {\n            gl_FragColor = blur3(uSampler, vTextureCoord, resolution, direction) * vColor;\n        }\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\n/**\n * 4x4 box blur shader which works in conjunction with a 50% rescale.\n */\nexport default class BoxBlurShader extends DefaultShader {\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        const dx = 1.0 / operation.getTextureWidth(0);\n        const dy = 1.0 / operation.getTextureHeight(0);\n        this._setUniform(\"stepTextureCoord\", new Float32Array([dx, dy]), this.gl.uniform2fv);\n    }\n\n}\n\nBoxBlurShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 stepTextureCoord;\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec4 vColor;\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoordUl = aTextureCoord - stepTextureCoord;\n        vTextureCoordBr = aTextureCoord + stepTextureCoord;\n        vTextureCoordUr = vec2(vTextureCoordBr.x, vTextureCoordUl.y);\n        vTextureCoordBl = vec2(vTextureCoordUl.x, vTextureCoordBr.y);\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nBoxBlurShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = 0.25 * (texture2D(uSampler, vTextureCoordUl) + texture2D(uSampler, vTextureCoordUr) + texture2D(uSampler, vTextureCoordBl) + texture2D(uSampler, vTextureCoordBr));\n        gl_FragColor = color * vColor;\n    }\n`;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class BlurShader extends DefaultShader {\n\n    constructor(context) {\n        super(context);\n        this._kernelRadius = 1;\n    }\n\n    get kernelRadius() {\n        return this._kernelRadius;\n    }\n\n    set kernelRadius(v) {\n        this._kernelRadius = v;\n        this.redraw();\n    }\n\n    useDefault() {\n        return this._amount === 0;\n    }\n\n    _beforeDrawEl({target}) {\n        target.ctx.filter = \"blur(\" + this._kernelRadius + \"px)\";\n    }\n\n    _afterDrawEl({target}) {\n        target.ctx.filter = \"none\";\n    }\n\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Component from \"../application/Component.mjs\";\nimport LinearBlurShader from \"../renderer/webgl/shaders/LinearBlurShader.mjs\";\nimport BoxBlurShader from \"../renderer/webgl/shaders/BoxBlurShader.mjs\";\nimport DefaultShader from \"../renderer/webgl/shaders/DefaultShader.mjs\";\nimport C2dBlurShader from \"../renderer/c2d/shaders/BlurShader.mjs\";\nimport Shader from \"../tree/Shader.mjs\";\nimport MultiSpline from \"../tools/MultiSpline.mjs\";\n\nexport default class FastBlurComponent extends Component {\n    static _template() {\n        return {}\n    }\n\n    get wrap() {\n        return this.tag(\"Wrap\");\n    }\n\n    set content(v) {\n        return this.wrap.content = v;\n    }\n\n    get content() {\n        return this.wrap.content;\n    }\n\n    set padding(v) {\n        this.wrap._paddingX = v;\n        this.wrap._paddingY = v;\n        this.wrap._updateBlurSize();\n    }\n\n    set paddingX(v) {\n        this.wrap._paddingX = v;\n        this.wrap._updateBlurSize();\n    }\n\n    set paddingY(v) {\n        this.wrap._paddingY = v;\n        this.wrap._updateBlurSize();\n    }\n\n    set amount(v) {\n        return this.wrap.amount = v;\n    }\n\n    get amount() {\n        return this.wrap.amount;\n    }\n\n    _onResize() {\n        this.wrap.w = this.renderWidth;\n        this.wrap.h = this.renderHeight;\n    }\n\n    get _signalProxy() {\n        return true;\n    }\n\n    _build() {\n        this.patch({\n            Wrap: {type: this.stage.gl ? WebGLFastBlurComponent : C2dFastBlurComponent}\n        });\n    }\n\n}\n\n\nclass C2dFastBlurComponent extends Component {\n\n    static _template() {\n        return {\n            forceZIndexContext: true,\n            rtt: true,\n            Textwrap: {shader: {type: C2dBlurShader}, Content: {}}\n        }\n    }\n\n    constructor(stage) {\n        super(stage);\n        this._textwrap = this.sel(\"Textwrap\");\n        this._wrapper = this.sel(\"Textwrap>Content\");\n\n        this._amount = 0;\n        this._paddingX = 0;\n        this._paddingY = 0;\n\n    }\n\n    static getSpline() {\n        if (!this._multiSpline) {\n            this._multiSpline = new MultiSpline();\n            this._multiSpline.parse(false, {0: 0, 0.25: 1.5, 0.5: 5.5, 0.75: 18, 1: 39});\n        }\n        return this._multiSpline;\n    }\n\n    get content() {\n        return this.sel('Textwrap>Content');\n    }\n\n    set content(v) {\n        this.sel('Textwrap>Content').patch(v, true);\n    }\n\n    set padding(v) {\n        this._paddingX = v;\n        this._paddingY = v;\n        this._updateBlurSize();\n    }\n\n    set paddingX(v) {\n        this._paddingX = v;\n        this._updateBlurSize();\n    }\n\n    set paddingY(v) {\n        this._paddingY = v;\n        this._updateBlurSize();\n    }\n\n    _updateBlurSize() {\n        let w = this.renderWidth;\n        let h = this.renderHeight;\n\n        let paddingX = this._paddingX;\n        let paddingY = this._paddingY;\n\n        this._wrapper.x = paddingX;\n        this._textwrap.x = -paddingX;\n\n        this._wrapper.y = paddingY;\n        this._textwrap.y = -paddingY;\n\n        this._textwrap.w = w + paddingX * 2;\n        this._textwrap.h = h + paddingY * 2;\n    }\n\n    get amount() {\n        return this._amount;\n    }\n\n    /**\n     * Sets the amount of blur. A value between 0 and 4. Goes up exponentially for blur.\n     * Best results for non-fractional values.\n     * @param v;\n     */\n    set amount(v) {\n        this._amount = v;\n        this._textwrap.shader.kernelRadius = C2dFastBlurComponent._amountToKernelRadius(v);\n    }\n\n    static _amountToKernelRadius(v) {\n        return C2dFastBlurComponent.getSpline().getValue(Math.min(1, v * 0.25));\n    }\n\n    get _signalProxy() {\n        return true;\n    }\n\n}\n\nclass WebGLFastBlurComponent extends Component {\n\n    static _template() {\n        const onUpdate = function(element, elementCore) {\n            if ((elementCore._recalc & (2 + 128))) {\n                const w = elementCore.w;\n                const h = elementCore.h;\n                let cur = elementCore;\n                do {\n                    cur = cur._children[0];\n                    cur._element.w = w;\n                    cur._element.h = h;\n                } while(cur._children);\n            }\n        };\n\n        return {\n            Textwrap: {rtt: true, forceZIndexContext: true, renderOffscreen: true, Content: {}},\n            Layers: {\n                L0: {rtt: true, onUpdate: onUpdate, renderOffscreen: true, visible: false, Content: {shader: {type: BoxBlurShader}}},\n                L1: {rtt: true, onUpdate: onUpdate, renderOffscreen: true, visible: false, Content: {shader: {type: BoxBlurShader}}},\n                L2: {rtt: true, onUpdate: onUpdate, renderOffscreen: true, visible: false, Content: {shader: {type: BoxBlurShader}}},\n                L3: {rtt: true, onUpdate: onUpdate, renderOffscreen: true, visible: false, Content: {shader: {type: BoxBlurShader}}}\n            },\n            Result: {shader: {type: FastBlurOutputShader}, visible: false}\n        }\n    }\n\n    get _signalProxy() {\n        return true;\n    }\n\n    constructor(stage) {\n        super(stage);\n        this._textwrap = this.sel(\"Textwrap\");\n        this._wrapper = this.sel(\"Textwrap>Content\");\n        this._layers = this.sel(\"Layers\");\n        this._output = this.sel(\"Result\");\n\n        this._amount = 0;\n        this._paddingX = 0;\n        this._paddingY = 0;\n    }\n\n    _buildLayers() {\n        const filterShaderSettings = [{x:1,y:0,kernelRadius:1},{x:0,y:1,kernelRadius:1},{x:1.5,y:0,kernelRadius:1},{x:0,y:1.5,kernelRadius:1}];\n        const filterShaders = filterShaderSettings.map(s => {\n            const shader = Shader.create(this.stage, Object.assign({type: LinearBlurShader}, s));\n            return shader;\n        });\n\n        this._setLayerTexture(this.getLayerContents(0), this._textwrap.getTexture(), []);\n        this._setLayerTexture(this.getLayerContents(1), this.getLayer(0).getTexture(), [filterShaders[0], filterShaders[1]]);\n\n        // Notice that 1.5 filters should be applied before 1.0 filters.\n        this._setLayerTexture(this.getLayerContents(2), this.getLayer(1).getTexture(), [filterShaders[0], filterShaders[1], filterShaders[2], filterShaders[3]]);\n        this._setLayerTexture(this.getLayerContents(3), this.getLayer(2).getTexture(), [filterShaders[0], filterShaders[1], filterShaders[2], filterShaders[3]]);\n    }\n\n    _setLayerTexture(element, texture, steps) {\n        if (!steps.length) {\n            element.texture = texture;\n        } else {\n            const step = steps.pop();\n            const child = element.stage.c({rtt: true, shader: step});\n\n            // Recurse.\n            this._setLayerTexture(child, texture, steps);\n\n            element.childList.add(child);\n        }\n        return element;\n    }\n\n    get content() {\n        return this.sel('Textwrap>Content');\n    }\n\n    set content(v) {\n        this.sel('Textwrap>Content').patch(v, true);\n    }\n\n    set padding(v) {\n        this._paddingX = v;\n        this._paddingY = v;\n        this._updateBlurSize();\n    }\n\n    set paddingX(v) {\n        this._paddingX = v;\n        this._updateBlurSize();\n    }\n\n    set paddingY(v) {\n        this._paddingY = v;\n        this._updateBlurSize();\n    }\n\n    getLayer(i) {\n        return this._layers.sel(\"L\" + i);\n    }\n\n    getLayerContents(i) {\n        return this.getLayer(i).sel(\"Content\");\n    }\n\n    _onResize() {\n        this._updateBlurSize();\n    }\n\n    _updateBlurSize() {\n        let w = this.renderWidth;\n        let h = this.renderHeight;\n\n        let paddingX = this._paddingX;\n        let paddingY = this._paddingY;\n\n        let fw = w + paddingX * 2;\n        let fh = h + paddingY * 2;\n        this._textwrap.w = fw;\n        this._wrapper.x = paddingX;\n        this.getLayer(0).w = this.getLayerContents(0).w = fw / 2;\n        this.getLayer(1).w = this.getLayerContents(1).w = fw / 4;\n        this.getLayer(2).w = this.getLayerContents(2).w = fw / 8;\n        this.getLayer(3).w = this.getLayerContents(3).w = fw / 16;\n        this._output.x = -paddingX;\n        this._textwrap.x = -paddingX;\n        this._output.w = fw;\n\n        this._textwrap.h = fh;\n        this._wrapper.y = paddingY;\n        this.getLayer(0).h = this.getLayerContents(0).h = fh / 2;\n        this.getLayer(1).h = this.getLayerContents(1).h = fh / 4;\n        this.getLayer(2).h = this.getLayerContents(2).h = fh / 8;\n        this.getLayer(3).h = this.getLayerContents(3).h = fh / 16;\n        this._output.y = -paddingY;\n        this._textwrap.y = -paddingY;\n        this._output.h = fh;\n\n        this.w = w;\n        this.h = h;\n    }\n\n    /**\n     * Sets the amount of blur. A value between 0 and 4. Goes up exponentially for blur.\n     * Best results for non-fractional values.\n     * @param v;\n     */\n    set amount(v) {\n        this._amount = v;\n        this._update();\n    }\n\n    get amount() {\n        return this._amount;\n    }\n\n    _update() {\n        let v = Math.min(4, Math.max(0, this._amount));\n        if (v === 0) {\n            this._textwrap.renderToTexture = false;\n            this._output.shader.otherTextureSource = null;\n            this._output.visible = false;\n        } else {\n            this._textwrap.renderToTexture = true;\n            this._output.visible = true;\n\n            this.getLayer(0).visible = (v > 0);\n            this.getLayer(1).visible = (v > 1);\n            this.getLayer(2).visible = (v > 2);\n            this.getLayer(3).visible = (v > 3);\n\n            if (v <= 1) {\n                this._output.texture = this._textwrap.getTexture();\n                this._output.shader.otherTextureSource = this.getLayer(0).getTexture();\n                this._output.shader.a = v;\n            } else if (v <= 2) {\n                this._output.texture = this.getLayer(0).getTexture();\n                this._output.shader.otherTextureSource = this.getLayer(1).getTexture();\n                this._output.shader.a = v - 1;\n            } else if (v <= 3) {\n                this._output.texture = this.getLayer(1).getTexture();\n                this._output.shader.otherTextureSource = this.getLayer(2).getTexture();\n                this._output.shader.a = v - 2;\n            } else if (v <= 4) {\n                this._output.texture = this.getLayer(2).getTexture();\n                this._output.shader.otherTextureSource = this.getLayer(3).getTexture();\n                this._output.shader.a = v - 3;\n            }\n        }\n    }\n\n    set shader(s) {\n        super.shader = s;\n        if (!this.renderToTexture) {\n            console.warn(\"[Lightning] Please enable renderToTexture to use with a shader.\");\n        }\n    }\n\n    _firstActive() {\n        this._buildLayers();\n    }\n\n}\n\n/**\n * Shader that combines two textures into one output.\n */\nclass FastBlurOutputShader extends DefaultShader {\n\n    constructor(ctx) {\n        super(ctx);\n\n        this._a = 0;\n        this._otherTextureSource = null;\n    }\n\n    get a() {\n        return this._a;\n    }\n\n    set a(v) {\n        this._a = v;\n        this.redraw();\n    }\n\n    set otherTextureSource(v) {\n        this._otherTextureSource = v;\n        this.redraw();\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        this._setUniform(\"a\", this._a, this.gl.uniform1f);\n        this._setUniform(\"uSampler2\", 1, this.gl.uniform1i);\n    }\n\n    beforeDraw(operation) {\n        let glTexture = this._otherTextureSource ? this._otherTextureSource.nativeTexture : null;\n\n        let gl = this.gl;\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, glTexture);\n        gl.activeTexture(gl.TEXTURE0);\n    }\n}\n\nFastBlurOutputShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uSampler2;\n    uniform float a;\n    void main(void){\n        if (a == 1.0) {\n            gl_FragColor = texture2D(uSampler2, vTextureCoord) * vColor;\n        } else {\n            gl_FragColor = ((1.0 - a) * texture2D(uSampler, vTextureCoord) + (a * texture2D(uSampler2, vTextureCoord))) * vColor;\n        }\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Component from \"../application/Component.mjs\";\nimport LinearBlurShader from \"../renderer/webgl/shaders/LinearBlurShader.mjs\";\nimport BoxBlurShader from \"../renderer/webgl/shaders/BoxBlurShader.mjs\";\nimport DefaultShader from \"../renderer/webgl/shaders/DefaultShader.mjs\";\n\nexport default class BloomComponent extends Component {\n\n    static _template() {\n        const onUpdate = function(element, elementCore) {\n            if ((elementCore._recalc & (2 + 128))) {\n                const w = elementCore.w;\n                const h = elementCore.h;\n                let cur = elementCore;\n                do {\n                    cur = cur._children[0];\n                    cur._element.w = w;\n                    cur._element.h = h;\n                } while(cur._children);\n            }\n        };\n\n        return {\n            Textwrap: {rtt: true, forceZIndexContext: true, renderOffscreen: true,\n                BloomBase: {shader: {type: BloomBaseShader},\n                    Content: {}\n                }\n            },\n            Layers: {\n                L0: {rtt: true, onUpdate: onUpdate, scale: 2, pivot: 0, visible: false, Content: {shader: {type: BoxBlurShader}}},\n                L1: {rtt: true, onUpdate: onUpdate, scale: 4, pivot: 0, visible: false, Content: {shader: {type: BoxBlurShader}}},\n                L2: {rtt: true, onUpdate: onUpdate, scale: 8, pivot: 0, visible: false, Content: {shader: {type: BoxBlurShader}}},\n                L3: {rtt: true, onUpdate: onUpdate, scale: 16, pivot: 0, visible: false, Content: {shader: {type: BoxBlurShader}}}\n            }\n        }\n    }\n\n    get _signalProxy() {\n        return true;\n    }\n\n    constructor(stage) {\n        super(stage);\n        this._textwrap = this.sel(\"Textwrap\");\n        this._wrapper = this.sel(\"Textwrap.Content\");\n        this._layers = this.sel(\"Layers\");\n\n        this._amount = 0;\n        this._paddingX = 0;\n        this._paddingY = 0;\n    }\n\n    _build() {\n        const filterShaderSettings = [{x:1,y:0,kernelRadius:3},{x:0,y:1,kernelRadius:3},{x:1.5,y:0,kernelRadius:3},{x:0,y:1.5,kernelRadius:3}];\n        const filterShaders = filterShaderSettings.map(s => {\n            const shader = this.stage.createShader(Object.assign({type: LinearBlurShader}, s));\n            return shader;\n        });\n\n        this._setLayerTexture(this.getLayerContents(0), this._textwrap.getTexture(), []);\n        this._setLayerTexture(this.getLayerContents(1), this.getLayer(0).getTexture(), [filterShaders[0], filterShaders[1]]);\n\n        // Notice that 1.5 filters should be applied before 1.0 filters.\n        this._setLayerTexture(this.getLayerContents(2), this.getLayer(1).getTexture(), [filterShaders[0], filterShaders[1], filterShaders[2], filterShaders[3]]);\n        this._setLayerTexture(this.getLayerContents(3), this.getLayer(2).getTexture(), [filterShaders[0], filterShaders[1], filterShaders[2], filterShaders[3]]);\n    }\n\n    _setLayerTexture(element, texture, steps) {\n        if (!steps.length) {\n            element.texture = texture;\n        } else {\n            const step = steps.pop();\n            const child = element.stage.c({rtt: true, shader: step});\n\n            // Recurse.\n            this._setLayerTexture(child, texture, steps);\n\n            element.childList.add(child);\n        }\n        return element;\n    }\n\n    get content() {\n        return this.sel('Textwrap.Content');\n    }\n\n    set content(v) {\n        this.sel('Textwrap.Content').patch(v);\n    }\n\n    set padding(v) {\n        this._paddingX = v;\n        this._paddingY = v;\n        this._updateBlurSize();\n    }\n\n    set paddingX(v) {\n        this._paddingX = v;\n        this._updateBlurSize();\n    }\n\n    set paddingY(v) {\n        this._paddingY = v;\n        this._updateBlurSize();\n    }\n\n    getLayer(i) {\n        return this._layers.sel(\"L\" + i);\n    }\n\n    getLayerContents(i) {\n        return this.getLayer(i).sel(\"Content\");\n    }\n\n    _onResize() {\n        this._updateBlurSize();\n    }\n\n    _updateBlurSize() {\n        let w = this.renderWidth;\n        let h = this.renderHeight;\n\n        let paddingX = this._paddingX;\n        let paddingY = this._paddingY;\n\n        let fw = w + paddingX * 2;\n        let fh = h + paddingY * 2;\n        this._textwrap.w = fw;\n        this._wrapper.x = paddingX;\n        this.getLayer(0).w = this.getLayerContents(0).w = fw / 2;\n        this.getLayer(1).w = this.getLayerContents(1).w = fw / 4;\n        this.getLayer(2).w = this.getLayerContents(2).w = fw / 8;\n        this.getLayer(3).w = this.getLayerContents(3).w = fw / 16;\n        this._textwrap.x = -paddingX;\n\n        this._textwrap.h = fh;\n        this._wrapper.y = paddingY;\n        this.getLayer(0).h = this.getLayerContents(0).h = fh / 2;\n        this.getLayer(1).h = this.getLayerContents(1).h = fh / 4;\n        this.getLayer(2).h = this.getLayerContents(2).h = fh / 8;\n        this.getLayer(3).h = this.getLayerContents(3).h = fh / 16;\n        this._textwrap.y = -paddingY;\n\n        this.w = w;\n        this.h = h;\n    }\n\n    /**\n     * Sets the amount of blur. A value between 0 and 4. Goes up exponentially for blur.\n     * Best results for non-fractional values.\n     * @param v;\n     */\n    set amount(v) {\n        this._amount = v;\n        this._update();\n    }\n\n    get amount() {\n        return this._amount;\n    }\n\n    _update() {\n        let v = Math.min(4, Math.max(0, this._amount));\n        if (v > 0) {\n            this.getLayer(0).visible = (v > 0);\n            this.getLayer(1).visible = (v > 1);\n            this.getLayer(2).visible = (v > 2);\n            this.getLayer(3).visible = (v > 3);\n        }\n    }\n\n    set shader(s) {\n        super.shader = s;\n        if (!this.renderToTexture) {\n            console.warn(\"[Lightning] Please enable renderToTexture to use with a shader.\");\n        }\n    }\n\n    _firstActive() {\n        this._build();\n    }\n\n}\n\nclass BloomBaseShader extends DefaultShader {\n}\n\nBloomBaseShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float m = max(max(color.r, color.g), color.b);\n        float c = max(0.0, (m - 0.80)) * 5.0;\n        color = color * c;\n        gl_FragColor = color;\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Component from \"../application/Component.mjs\";\n\nexport default class SmoothScaleComponent extends Component {\n\n    static _template() {\n        return {\n            ContentWrap: {renderOffscreen: true, forceZIndexContext: true, onAfterUpdate: SmoothScaleComponent._updateDimensions,\n                Content: {}\n            },\n            Scale: {visible: false}\n        }\n    }\n\n    constructor(stage) {\n        super(stage);\n\n        this._smoothScale = 1;\n        this._iterations = 0;\n    }\n\n    get content() {\n        return this.tag('Content');\n    }\n\n    set content(v) {\n        this.tag('Content').patch(v, true);\n    }\n\n    get smoothScale() {\n        return this._smoothScale;\n    }\n\n    set smoothScale(v) {\n        if (this._smoothScale !== v) {\n            let its = 0;\n            while(v < 0.5 && its < 12) {\n                its++;\n                v = v * 2;\n            }\n\n            this.scale = v;\n            this._setIterations(its);\n\n            this._smoothScale = v;\n        }\n    }\n\n    _setIterations(its) {\n        if (this._iterations !== its) {\n            const scalers = this.sel(\"Scale\").childList;\n            const content = this.sel(\"ContentWrap\");\n            while (scalers.length < its) {\n                const first = scalers.length === 0;\n                const texture = (first ? content.getTexture() : scalers.last.getTexture());\n                scalers.a({rtt: true, renderOffscreen: true, texture: texture});\n            }\n\n            SmoothScaleComponent._updateDimensions(this.tag(\"ContentWrap\"), true);\n\n            const useScalers = (its > 0);\n            this.patch({\n                ContentWrap: {renderToTexture: useScalers},\n                Scale: {visible: useScalers}\n            });\n\n            for (let i = 0, n = scalers.length; i < n; i++) {\n                scalers.getAt(i).patch({\n                    visible: i < its,\n                    renderOffscreen: i !== its - 1\n                });\n            }\n            this._iterations = its;\n        }\n    }\n\n    static _updateDimensions(contentWrap, force) {\n        const content = contentWrap.children[0];\n        let w = content.renderWidth;\n        let h = content.renderHeight;\n        if (w !== contentWrap.w || h !== contentWrap.h || force) {\n            contentWrap.w = w;\n            contentWrap.h = h;\n\n            const scalers = contentWrap.parent.tag(\"Scale\").children;\n            for (let i = 0, n = scalers.length; i < n; i++) {\n                w = w * 0.5;\n                h = h * 0.5;\n                scalers[i].w = w;\n                scalers[i].h = h;\n            }\n        }\n    }\n\n    get _signalProxy() {\n        return true;\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Component from \"../application/Component.mjs\";\n\nexport default class BorderComponent extends Component {\n\n    static _template() {\n        return {\n            Content: {},\n            Borders: {\n                Top: {rect: true, visible: false, mountY: 1},\n                Right: {rect: true, visible: false},\n                Bottom: {rect: true, visible: false},\n                Left: {rect: true, visible: false, mountX: 1}\n            }\n        };\n    }\n\n    get _signalProxy() {\n        return true;\n    }\n\n    constructor(stage) {\n        super(stage);\n\n        this._borderTop = this.tag(\"Top\");\n        this._borderRight = this.tag(\"Right\");\n        this._borderBottom = this.tag(\"Bottom\");\n        this._borderLeft = this.tag(\"Left\");\n\n        this.onAfterUpdate = function (element) {\n            const content = element.childList.first;\n            let w = element.core.w || content.renderWidth;\n            let h = element.core.h || content.renderHeight;\n            element._borderTop.w = w;\n            element._borderBottom.y = h;\n            element._borderBottom.w = w;\n            element._borderLeft.h = h + element._borderTop.h + element._borderBottom.h;\n            element._borderLeft.y = -element._borderTop.h;\n            element._borderRight.x = w;\n            element._borderRight.h = h + element._borderTop.h + element._borderBottom.h;\n            element._borderRight.y = -element._borderTop.h;\n        };\n\n        this.borderWidth = 1;\n    }\n\n    get content() {\n        return this.sel('Content');\n    }\n\n    set content(v) {\n        this.sel('Content').patch(v, true);\n    }\n\n    get borderWidth() {\n        return this.borderWidthTop;\n    }\n\n    get borderWidthTop() {\n        return this._borderTop.h;\n    }\n\n    get borderWidthRight() {\n        return this._borderRight.w;\n    }\n\n    get borderWidthBottom() {\n        return this._borderBottom.h;\n    }\n\n    get borderWidthLeft() {\n        return this._borderLeft.w;\n    }\n\n    set borderWidth(v) {\n        this.borderWidthTop = v;\n        this.borderWidthRight = v;\n        this.borderWidthBottom = v;\n        this.borderWidthLeft = v;\n    }\n\n    set borderWidthTop(v) {\n        this._borderTop.h = v;\n        this._borderTop.visible = (v > 0);\n    }\n\n    set borderWidthRight(v) {\n        this._borderRight.w = v;\n        this._borderRight.visible = (v > 0);\n    }\n\n    set borderWidthBottom(v) {\n        this._borderBottom.h = v;\n        this._borderBottom.visible = (v > 0);\n    }\n\n    set borderWidthLeft(v) {\n        this._borderLeft.w = v;\n        this._borderLeft.visible = (v > 0);\n    }\n\n    get colorBorder() {\n        return this.colorBorderTop;\n    }\n\n    get colorBorderTop() {\n        return this._borderTop.color;\n    }\n\n    get colorBorderRight() {\n        return this._borderRight.color;\n    }\n\n    get colorBorderBottom() {\n        return this._borderBottom.color;\n    }\n\n    get colorBorderLeft() {\n        return this._borderLeft.color;\n    }\n\n    set colorBorder(v) {\n        this.colorBorderTop = v;\n        this.colorBorderRight = v;\n        this.colorBorderBottom = v;\n        this.colorBorderLeft = v;\n    }\n\n    set colorBorderTop(v) {\n        this._borderTop.color = v;\n    }\n\n    set colorBorderRight(v) {\n        this._borderRight.color = v;\n    }\n\n    set colorBorderBottom(v) {\n        this._borderBottom.color = v;\n    }\n\n    set colorBorderLeft(v) {\n        this._borderLeft.color = v;\n    }\n\n    get borderTop() {\n        return this._borderTop;\n    }\n\n    set borderTop(settings) {\n        this.borderTop.patch(settings);\n    }\n\n    get borderRight() {\n        return this._borderRight;\n    }\n\n    set borderRight(settings) {\n        this.borderRight.patch(settings);\n    }\n\n    get borderBottom() {\n        return this._borderBottom;\n    }\n\n    set borderBottom(settings) {\n        this.borderBottom.patch(settings);\n    }\n\n    get borderLeft() {\n        return this._borderLeft;\n    }\n\n    set borderLeft(settings) {\n        this.borderLeft.patch(settings);\n    }\n\n    set borders(settings) {\n        this.borderTop = settings;\n        this.borderLeft = settings;\n        this.borderBottom = settings;\n        this.borderRight = settings;\n    }\n\n}\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport C2dDefaultShader from \"../../c2d/shaders/DefaultShader.mjs\";\nimport WebGLDefaultShader from \"../../webgl/shaders/DefaultShader.mjs\";\n\nexport class WebGLGrayscaleShader extends WebGLDefaultShader {\n\n    constructor(context) {\n        super(context);\n        this._amount = 1;\n    }\n\n    static getC2d() {\n        return C2dGrayscaleShader;\n    }\n\n\n    set amount(v) {\n        this._amount = v;\n        this.redraw();\n    }\n\n    get amount() {\n        return this._amount;\n    }\n\n    useDefault() {\n        return this._amount === 0;\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        this._setUniform(\"amount\", this._amount, this.gl.uniform1f);\n    }\n\n}\n\nWebGLGrayscaleShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float grayness = 0.2 * color.r + 0.6 * color.g + 0.2 * color.b;\n        gl_FragColor = vec4(amount * vec3(grayness, grayness, grayness) + (1.0 - amount) * color.rgb, color.a);\n    }\n`;\n\nexport class C2dGrayscaleShader extends C2dDefaultShader {\n\n    constructor(context) {\n        super(context);\n        this._amount = 1;\n    }\n\n    static getWebGL() {\n        return WebGLGrayscaleShader;\n    }\n\n\n    set amount(v) {\n        this._amount = v;\n        this.redraw();\n    }\n\n    get amount() {\n        return this._amount;\n    }\n\n    useDefault() {\n        return this._amount === 0;\n    }\n\n    _beforeDrawEl({target}) {\n        target.ctx.filter = \"grayscale(\" + this._amount + \")\";\n    }\n\n    _afterDrawEl({target}) {\n        target.ctx.filter = \"none\";\n    }\n\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport NoiseTexture from \"../../../textures/NoiseTexture.mjs\";\nimport DefaultShader from \"./DefaultShader.mjs\";\n\n/**\n * This shader can be used to fix a problem that is known as 'gradient banding'.\n */\nexport default class DitheringShader extends DefaultShader {\n\n    constructor(ctx) {\n        super(ctx);\n\n        this._noiseTexture = new NoiseTexture(ctx.stage);\n\n        this._graining = 1/256;\n\n        this._random = false;\n    }\n\n    set graining(v) {\n        this._graining = v;\n        this.redraw();\n    }\n\n    set random(v) {\n        this._random = v;\n        this.redraw();\n    }\n\n    setExtraAttribsInBuffer(operation) {\n        // Make sure that the noise texture is uploaded to the GPU.\n        this._noiseTexture.load();\n\n        let offset = operation.extraAttribsDataByteOffset / 4;\n        let floats = operation.quads.floats;\n\n        let length = operation.length;\n\n        for (let i = 0; i < length; i++) {\n\n            // Calculate noise texture coordinates so that it spans the full element.\n            let brx = operation.getElementWidth(i) / this._noiseTexture.getRenderWidth();\n            let bry = operation.getElementHeight(i) / this._noiseTexture.getRenderHeight();\n\n            let ulx = 0;\n            let uly = 0;\n            if (this._random) {\n                ulx = Math.random();\n                uly = Math.random();\n\n                brx += ulx;\n                bry += uly;\n\n                if (Math.random() < 0.5) {\n                    // Flip for more randomness.\n                    const t = ulx;\n                    ulx = brx;\n                    brx = t;\n                }\n\n                if (Math.random() < 0.5) {\n                    // Flip for more randomness.\n                    const t = uly;\n                    uly = bry;\n                    bry = t;\n                }\n            }\n\n            // Specify all corner points.\n            floats[offset] = ulx;\n            floats[offset + 1] = uly;\n\n            floats[offset + 2] = brx;\n            floats[offset + 3] = uly;\n\n            floats[offset + 4] = brx;\n            floats[offset + 5] = bry;\n\n            floats[offset + 6] = ulx;\n            floats[offset + 7] = bry;\n\n            offset += 8;\n        }\n    }\n\n    beforeDraw(operation) {\n        let gl = this.gl;\n        gl.vertexAttribPointer(this._attrib(\"aNoiseTextureCoord\"), 2, gl.FLOAT, false, 8, this.getVertexAttribPointerOffset(operation));\n\n        let glTexture = this._noiseTexture.source.nativeTexture;\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, glTexture);\n        gl.activeTexture(gl.TEXTURE0);\n    }\n\n    getExtraAttribBytesPerVertex() {\n        return 8;\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        this._setUniform(\"uNoiseSampler\", 1, this.gl.uniform1i);\n        this._setUniform(\"graining\", 2 * this._graining, this.gl.uniform1f);\n    }\n\n    enableAttribs() {\n        super.enableAttribs();\n        let gl = this.gl;\n        gl.enableVertexAttribArray(this._attrib(\"aNoiseTextureCoord\"));\n    }\n\n    disableAttribs() {\n        super.disableAttribs();\n        let gl = this.gl;\n        gl.disableVertexAttribArray(this._attrib(\"aNoiseTextureCoord\"));\n    }\n\n    useDefault() {\n        return this._graining === 0;\n    }\n\n    afterDraw(operation) {\n        if (this._random) {\n            this.redraw();\n        }\n    }\n\n}\n\nDitheringShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec2 aNoiseTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vNoiseTextureCoord = aNoiseTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nDitheringShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uNoiseSampler;\n    uniform float graining;\n    void main(void){\n        vec4 noise = texture2D(uNoiseSampler, vNoiseTextureCoord);\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        gl_FragColor = (color * vColor) + graining * (noise.r - 0.5);\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Utils from \"../../../tree/Utils.mjs\";\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class CircularPushShader extends DefaultShader {\n\n    constructor(ctx) {\n        super(ctx);\n\n        this._inputValue = 0;\n\n        this._maxDerivative = 0.01;\n\n        this._normalizedValue = 0;\n\n        // The offset between buckets. A value between 0 and 1.\n        this._offset = 0;\n\n        this._amount = 0.1;\n\n        this._aspectRatio = 1;\n\n        this._offsetX = 0;\n\n        this._offsetY = 0;\n\n        this.buckets = 100;\n    }\n\n    get aspectRatio() {\n        return this._aspectRatio;\n    }\n\n    set aspectRatio(v) {\n        this._aspectRatio = v;\n        this.redraw();\n    }\n\n    get offsetX() {\n        return this._offsetX;\n    }\n\n    set offsetX(v) {\n        this._offsetX = v;\n        this.redraw();\n    }\n\n    get offsetY() {\n        return this._offsetY;\n    }\n\n    set offsetY(v) {\n        this._offsetY = v;\n        this.redraw();\n    }\n\n    set amount(v) {\n        this._amount = v;\n        this.redraw();\n    }\n\n    get amount() {\n        return this._amount;\n    }\n\n    set inputValue(v) {\n        this._inputValue = v;\n    }\n\n    get inputValue() {\n        return this._inputValue;\n    }\n\n    set maxDerivative(v) {\n        this._maxDerivative = v;\n    }\n\n    get maxDerivative() {\n        return this._maxDerivative;\n    }\n\n    set buckets(v) {\n        if (v > 100) {\n            console.warn(\"[Lightning] CircularPushShader: supports max 100 buckets\");\n            v = 100;\n        }\n\n        // This should be set before starting.\n        this._buckets = v;\n\n        // Init values array in the correct length.\n        this._values = new Uint8Array(this._getValues(v));\n\n        this.redraw();\n    }\n\n    get buckets() {\n        return this._buckets;\n    }\n\n    _getValues(n) {\n        const v = [];\n        for (let i = 0; i < n; i++) {\n            v.push(this._inputValue);\n        }\n        return v;\n    }\n\n    /**\n     * Progresses the shader with the specified (fractional) number of buckets.\n     * @param {number} o;\n     *   A number from 0 to 1 (1 = all buckets).\n     */\n    progress(o) {\n        this._offset += o * this._buckets;\n        const full = Math.floor(this._offset);\n        this._offset -= full;\n        this._shiftBuckets(full);\n        this.redraw();\n    }\n\n    _shiftBuckets(n) {\n        for (let i = this._buckets - 1; i >= 0; i--) {\n            const targetIndex = i - n;\n            if (targetIndex < 0) {\n                this._normalizedValue = Math.min(this._normalizedValue + this._maxDerivative, Math.max(this._normalizedValue - this._maxDerivative, this._inputValue));\n                this._values[i] = 255 * this._normalizedValue;\n            } else {\n                this._values[i] = this._values[targetIndex];\n            }\n        }\n    }\n\n    set offset(v) {\n        this._offset = v;\n        this.redraw();\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        this._setUniform(\"aspectRatio\", this._aspectRatio, this.gl.uniform1f);\n        this._setUniform(\"offsetX\", this._offsetX, this.gl.uniform1f);\n        this._setUniform(\"offsetY\", this._offsetY, this.gl.uniform1f);\n        this._setUniform(\"amount\", this._amount, this.gl.uniform1f);\n        this._setUniform(\"offset\", this._offset, this.gl.uniform1f);\n        this._setUniform(\"buckets\", this._buckets, this.gl.uniform1f);\n        this._setUniform(\"uValueSampler\", 1, this.gl.uniform1i);\n    }\n\n    useDefault() {\n        return this._amount === 0;\n    }\n\n    beforeDraw(operation) {\n        const gl = this.gl;\n        gl.activeTexture(gl.TEXTURE1);\n        if (!this._valuesTexture) {\n            this._valuesTexture = gl.createTexture();\n            gl.bindTexture(gl.TEXTURE_2D, this._valuesTexture);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            if (Utils.isNode) {\n                gl.pixelStorei(gl.UNPACK_FLIP_BLUE_RED, false);\n            }\n            gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\n        } else {\n            gl.bindTexture(gl.TEXTURE_2D, this._valuesTexture);\n        }\n\n        // Upload new values.\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.ALPHA, this._buckets, 1, 0, gl.ALPHA, gl.UNSIGNED_BYTE, this._values);\n        gl.activeTexture(gl.TEXTURE0);\n    }\n\n    cleanup() {\n        if (this._valuesTexture) {\n            this.gl.deleteTexture(this._valuesTexture);\n        }\n    }\n\n\n}\n\nCircularPushShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    uniform float offsetX;\n    uniform float offsetY;\n    uniform float aspectRatio;\n    varying vec2 vTextureCoord;\n    varying vec2 vPos;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vPos = vTextureCoord * 2.0 - 1.0;\n        vPos.y = vPos.y * aspectRatio;\n        vPos.y = vPos.y + offsetY;\n        vPos.x = vPos.x + offsetX;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nCircularPushShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vPos;\n    uniform float amount;\n    uniform float offset;\n    uniform float values[100];\n    uniform float buckets;\n    uniform sampler2D uSampler;\n    uniform sampler2D uValueSampler;\n    void main(void){\n        float l = length(vPos);\n        float m = (l * buckets * 0.678 - offset) / buckets;\n        float f = texture2D(uValueSampler, vec2(m, 0.0)).a * amount;\n        vec2 unit = vPos / l;\n        gl_FragColor = texture2D(uSampler, vTextureCoord - f * unit) * vColor;\n    }\n`;\n\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class InversionShader extends DefaultShader {\n\n    constructor(context) {\n        super(context);\n        this._amount = 1;\n    }\n\n    set amount(v) {\n        this._amount = v;\n        this.redraw();\n    }\n\n    get amount() {\n        return this._amount;\n    }\n\n    useDefault() {\n        return this._amount === 0;\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        this._setUniform(\"amount\", this._amount, this.gl.uniform1f);\n    }\n\n}\n\nInversionShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        color.rgb = color.rgb * (1.0 - amount) + amount * (1.0 * color.a - color.rgb); \n        gl_FragColor = color * vColor;\n    }\n`;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport StageUtils from \"../../../tree/StageUtils.mjs\";\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class OutlineShader extends DefaultShader {\n\n    constructor(ctx) {\n        super(ctx);\n        this._width = 5;\n        this._col = 0xFFFFFFFF;\n        this._color = [1,1,1,1];\n    }\n\n    set width(v) {\n        this._width = v;\n        this.redraw();\n    }\n\n    get color() {\n        return this._col;\n    }\n\n    set color(v) {\n        if (this._col !== v) {\n            const col = StageUtils.getRgbaComponentsNormalized(v);\n            col[0] = col[0] * col[3];\n            col[1] = col[1] * col[3];\n            col[2] = col[2] * col[3];\n\n            this._color = col;\n\n            this.redraw();\n\n            this._col = v;\n        }\n    }\n\n    useDefault() {\n        return (this._width === 0 || this._col[3] === 0);\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        let gl = this.gl;\n        this._setUniform(\"color\", new Float32Array(this._color), gl.uniform4fv);\n    }\n\n    enableAttribs() {\n        super.enableAttribs();\n        this.gl.enableVertexAttribArray(this._attrib(\"aCorner\"));\n    }\n\n    disableAttribs() {\n        super.disableAttribs();\n        this.gl.disableVertexAttribArray(this._attrib(\"aCorner\"));\n    }\n\n    setExtraAttribsInBuffer(operation) {\n        let offset = operation.extraAttribsDataByteOffset / 4;\n        let floats = operation.quads.floats;\n\n        let length = operation.length;\n\n        for (let i = 0; i < length; i++) {\n\n            const elementCore = operation.getElementCore(i);\n\n            // We are setting attributes such that if the value is < 0 or > 1, a border should be drawn.\n            const ddw = this._width / elementCore.w;\n            const dw = ddw / (1 - 2 * ddw);\n            const ddh = this._width / elementCore.h;\n            const dh = ddh / (1 - 2 * ddh);\n\n            // Specify all corner points.\n            floats[offset] = -dw;\n            floats[offset + 1] = -dh;\n\n            floats[offset + 2] = 1 + dw;\n            floats[offset + 3] = -dh;\n\n            floats[offset + 4] = 1 + dw;\n            floats[offset + 5] = 1 + dh;\n\n            floats[offset + 6] = -dw;\n            floats[offset + 7] = 1 + dh;\n\n            offset += 8;\n        }\n    }\n\n    beforeDraw(operation) {\n        let gl = this.gl;\n        gl.vertexAttribPointer(this._attrib(\"aCorner\"), 2, gl.FLOAT, false, 8, this.getVertexAttribPointerOffset(operation));\n    }\n\n    getExtraAttribBytesPerVertex() {\n        return 8;\n    }\n\n}\n\nOutlineShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aCorner;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vCorner;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vCorner = aCorner;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nOutlineShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vCorner;\n    uniform vec4 color;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec2 m = min(vCorner, 1.0 - vCorner);\n        float value = step(0.0, min(m.x, m.y));\n        gl_FragColor = mix(color, texture2D(uSampler, vTextureCoord) * vColor, value);\n    }\n`;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\n/**\n * @see https://github.com/pixijs/pixi-filters/tree/master/filters/pixelate/src\n */\nexport default class PixelateShader extends DefaultShader {\n\n    constructor(ctx) {\n        super(ctx);\n\n        this._size = new Float32Array([4, 4]);\n    }\n\n    get x() {\n        return this._size[0];\n    }\n\n    set x(v) {\n        this._size[0] = v;\n        this.redraw();\n    }\n\n    get y() {\n        return this._size[1];\n    }\n\n    set y(v) {\n        this._size[1] = v;\n        this.redraw();\n    }\n\n    get size() {\n        return this._size[0];\n    }\n\n    set size(v) {\n        this._size[0] = v;\n        this._size[1] = v;\n        this.redraw();\n    }\n\n    useDefault() {\n        return ((this._size[0] === 0) && (this._size[1] === 0));\n    }\n\n    static getWebGLImpl() {\n        return WebGLPixelateShaderImpl;\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        let gl = this.gl;\n        this._setUniform(\"size\", new Float32Array(this._size), gl.uniform2fv);\n    }\n\n    getExtraAttribBytesPerVertex() {\n        return 8;\n    }\n\n    enableAttribs() {\n        super.enableAttribs();\n        this.gl.enableVertexAttribArray(this._attrib(\"aTextureRes\"));\n    }\n\n    disableAttribs() {\n        super.disableAttribs();\n        this.gl.disableVertexAttribArray(this._attrib(\"aTextureRes\"));\n    }\n\n    setExtraAttribsInBuffer(operation) {\n        let offset = operation.extraAttribsDataByteOffset / 4;\n        let floats = operation.quads.floats;\n\n        let length = operation.length;\n        for (let i = 0; i < length; i++) {\n            let w = operation.quads.getTextureWidth(operation.index + i);\n            let h = operation.quads.getTextureHeight(operation.index + i);\n\n            floats[offset] = w;\n            floats[offset + 1] = h;\n            floats[offset + 2] = w;\n            floats[offset + 3] = h;\n            floats[offset + 4] = w;\n            floats[offset + 5] = h;\n            floats[offset + 6] = w;\n            floats[offset + 7] = h;\n\n            offset += 8;\n        }\n    }\n\n    beforeDraw(operation) {\n        let gl = this.gl;\n        gl.vertexAttribPointer(this._attrib(\"aTextureRes\"), 2, gl.FLOAT, false, this.getExtraAttribBytesPerVertex(), this.getVertexAttribPointerOffset(operation));\n    }\n}\n\nPixelateShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aTextureRes;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        vTextureRes = aTextureRes;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nPixelateShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n\n    uniform vec2 size;\n    uniform sampler2D uSampler;\n    \n    vec2 mapCoord( vec2 coord )\n    {\n        coord *= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 unmapCoord( vec2 coord )\n    {\n        coord /= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 pixelate(vec2 coord, vec2 size)\n    {\n        return floor( coord / size ) * size;\n    }\n    \n    void main(void)\n    {\n        vec2 coord = mapCoord(vTextureCoord);\n        coord = pixelate(coord, size);\n        coord = unmapCoord(coord);\n        gl_FragColor = texture2D(uSampler, coord) * vColor;\n    }\n`;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class RadialFilterShader extends DefaultShader {\n    constructor(context) {\n        super(context);\n        this._radius = 0;\n        this._cutoff = 1;\n    }\n\n    set radius(v) {\n        this._radius = v;\n        this.redraw();\n    }\n\n    get radius() {\n        return this._radius;\n    }\n\n    set cutoff(v) {\n        this._cutoff = v;\n        this.redraw();\n    }\n\n    get cutoff() {\n        return this._cutoff;\n    }\n    \n    useDefault() {\n        return this._radius === 0;\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        // We substract half a pixel to get a better cutoff effect.\n        this._setUniform(\"radius\", 2 * (this._radius - 0.5) / operation.getRenderWidth(), this.gl.uniform1f);\n        this._setUniform(\"cutoff\", 0.5 * operation.getRenderWidth() / this._cutoff, this.gl.uniform1f);\n    }\n\n}\n\nRadialFilterShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 pos;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n        pos = gl_Position.xy;\n    }\n`;\n\nRadialFilterShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 pos;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float radius;\n    uniform float cutoff;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        float f = max(0.0, min(1.0, 1.0 - (length(pos) - radius) * cutoff));\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor * f;\n    }\n`;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\nimport StageUtils from \"../../../tree/StageUtils.mjs\";\n\nexport default class RoundedRectangleShader extends DefaultShader {\n    constructor(context) {\n        super(context);\n        this._blend = 0;\n        this._radius = [1, 1, 1, 1];\n        this._stroke = 0;\n        this._fc = 0x00ffffff;\n        this._fillColor = this._getNormalizedColor(0xffffffff);\n        this._strokeColor = this._getNormalizedColor(0x00ffffff);\n    }\n\n    set blend(p) {\n        this._blend = Math.min(Math.max(p, 0), 1);\n    }\n\n    set radius(v) {\n        if(Array.isArray(v)) {\n            if(v.length === 2) {\n                this._radius = [v[0], v[1], v[0], v[1]];\n            }\n            else if(v.length === 3) {\n                this._radius = [v[0], v[1], v[2], this._radius[3]];\n            }\n            else if (v.length === 4) {\n                this._radius = v;\n            }\n            else {\n                this._radius = [v[0], v[0], v[0], v[0]];\n            }\n        }\n        else {\n            this._radius = [v, v, v, v];\n        }\n        this.redraw();\n    }\n\n    get radius() {\n        return this._radius;\n    }\n\n    set topLeft(num) {\n        this._radius[0] = num;\n        this.redraw();\n    }\n\n    get topLeft() {\n        return this._radius[0];\n    }\n\n    set topRight(num) {\n        this._radius[1] = num;\n        this.redraw();\n    }\n\n    get topRight() {\n        return this._radius[1];\n    }\n\n    set bottomRight(num) {\n        this._radius[2] = num;\n        this.redraw();\n    }\n\n    get bottomRight() {\n        return this._radius[2];\n    }\n\n    set bottomLeft(num) {\n        this._radius[3] = num;\n        this.redraw();\n    }\n\n    get bottomLeft() {\n        return this._radius[4];\n    }\n\n    set strokeColor(argb) {\n        this._sc = argb;\n        this._strokeColor = this._getNormalizedColor(argb);\n        this.redraw();\n    }\n\n    get strokeColor() {\n        return this._sc;\n    }\n\n    set fillColor(argb) {\n        this._fc = argb;\n        this._fillColor = this._getNormalizedColor(argb);\n        this.redraw();\n    }\n\n    get fillColor() {\n        return this._fc;\n    }\n\n    set stroke(num) {\n        this._stroke = num;\n        this.redraw();\n    }\n\n    get stroke() {\n        return this._stroke;\n    }\n\n    _getNormalizedColor(color) {\n        const col = StageUtils.getRgbaComponentsNormalized(color);\n        col[0] *= col[3];\n        col[1] *= col[3];\n        col[2] *= col[3];\n        return new Float32Array(col);\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        const owner = operation.shaderOwner;\n        const renderPrecision = this.ctx.stage.getRenderPrecision();\n        const _radius = this._radius.map((r) => (r + 0.5) * renderPrecision)\n        this._setUniform('radius', new Float32Array(_radius), this.gl.uniform4fv);\n        this._setUniform('alpha', operation.getElementCore(0).renderContext.alpha, this.gl.uniform1f);\n        this._setUniform('blend', this._blend, this.gl.uniform1f);\n        this._setUniform('strokeColor', this._strokeColor, this.gl.uniform4fv);\n        this._setUniform('fillColor', this._fillColor, this.gl.uniform4fv);\n        this._setUniform('stroke',  this._stroke * renderPrecision, this.gl.uniform1f);\n        this._setUniform('resolution', new Float32Array([owner._w * renderPrecision, owner._h * renderPrecision]), this.gl.uniform2fv);\n    }\n}\n\nRoundedRectangleShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nRoundedRectangleShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n\n    #define PI 3.14159265359\n\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 radius;\n    uniform float stroke;\n    uniform vec4 strokeColor;\n    uniform vec4 fillColor;\n    uniform float alpha;\n    uniform float fill;\n    uniform float blend;\n    \n    float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    float innerBorderMask(float dist, float width){\n        float alpha1 = clamp(dist + width, 0.0, 1.0);\n        float alpha2 = clamp(dist, 0.0, 1.0);\n        return alpha1 - alpha2;\n    }\n\n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        float r = 0.0;\n        if (vTextureCoord.x < 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[0];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[1];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y >= 0.5) {\n            r = radius[2];\n        } else {\n            r = radius[3];\n        }\n        \n        float b = boxDist(vTextureCoord.xy * resolution - halfRes, halfRes - 0.005, r);\n        vec4 tex = texture2D(uSampler, vTextureCoord) * vColor;\n        vec4 blend = mix(vec4(1.0) * alpha, tex, blend);     \n        vec4 layer1 = mix(vec4(0.0), tex * fillColor, fillMask(b));\n        gl_FragColor = mix(layer1, blend * strokeColor, innerBorderMask(b, stroke));\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from './DefaultShader.mjs';\n\nexport default class FadeOutShader extends DefaultShader {\n    constructor(context) {\n        super(context);\n        this._fade = [0, 0, 0, 0];\n    }\n\n    set top(num) {\n        this._fade[0] = num;\n        this.redraw();\n    }\n\n    get top() {\n        return this._fade[0];\n    }\n\n    set right(num) {\n        this._fade[1] = num;\n        this.redraw();\n    }\n\n    get right() {\n        return this._fade[1];\n    }\n\n    set bottom(num) {\n        this._fade[2] = num;\n        this.redraw();\n    }\n\n    get bottom() {\n        return this._fade[2];\n    }\n\n    set left(num) {\n        this._fade[3] = num;\n        this.redraw();\n    }\n\n    get left() {\n        return this._fade[3];\n    }\n\n    set fade(v) {\n        if(Array.isArray(v)) {\n            if(v.length === 2) {\n                this._fade = [v[0], v[1], v[0], v[1]];\n            }\n            else if(v.length === 3) {\n                this._fade = [v[0], v[1], v[2], this._fade[3]];\n            }\n            else if (v.length === 4) {\n                this._fade = v;\n            }\n            else {\n                this._fade = [v[0], v[0], v[0], v[0]];\n            }\n        }\n        else {\n            this._fade = [v, v, v, v];\n        }\n        this.redraw();\n    }\n\n    get fade() {\n        return this._fade;\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        const owner = operation.shaderOwner;\n\n        const renderPrecision = this.ctx.stage.getRenderPrecision();\n        const fade = this._fade.map((f) => f * renderPrecision);\n        this._setUniform('fade',  new Float32Array(fade), this.gl.uniform4fv);\n        this._setUniform('resolution', new Float32Array([owner._w * renderPrecision, owner._h * renderPrecision]), this.gl.uniform2fv);\n    }\n}\n\nFadeOutShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 fade;\n    \n    void main() {\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 point = vTextureCoord.xy * resolution.xy;\n        \n        vec2 pos1;\n        vec2 pos2;\n        vec2 d;\n        float c;\n        float t = 0.0;\n             \n        if(fade[0] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x, point.y + fade[0]);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[1] > 0.0) {\n            vec2 pos1 = vec2(point.x - resolution.x - fade[1], vTextureCoord.y);\n            vec2 pos2 = vec2(point.x - resolution.x, vTextureCoord.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[2] > 0.0) {\n            vec2 pos1 = vec2(vTextureCoord.x, point.y - resolution.y - fade[2]);\n            vec2 pos2 = vec2(vTextureCoord.x, point.y - resolution.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[3] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x + fade[3], point.y);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        gl_FragColor = color;\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class VignetteShader extends DefaultShader {\n    constructor(context) {\n        super(context);\n        this._magnitude = 1.3;\n        this._intensity = 0.7;\n        this._pivot = [0.5, 0.5];\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n\n        this._setUniform(\"magnitude\", this._magnitude , this.gl.uniform1f);\n        this._setUniform(\"intensity\", this._intensity, this.gl.uniform1f);\n        this._setUniform('pivot', new Float32Array(this._pivot), this.gl.uniform2fv);\n        this.redraw()\n    }\n\n    set pivot(v) {\n        if(Array.isArray(v)) {\n            this._pivot = v;\n        }\n        else {\n            this._pivot = [v, v];\n        }\n        this.redraw();\n    }\n\n    get pivotX() {\n        return this._pivot[0];\n    }\n\n    set pivotX(v) {\n        this._pivot[0] = v;\n        this.redraw();\n    }\n\n    get pivotY() {\n        return this._pivot[1];\n    }\n\n    set pivotY(v) {\n        this._pivot[1] = v;\n        this.redraw();\n    }\n\n    get intensity() {\n        return this._intensity;\n    }\n\n    set intensity(v) {\n        this._intensity = v;\n        this.redraw();\n    }\n\n    get magnitude() {\n        return this._magnitude;\n\n    }\n\n    set magnitude(v) {\n        this._magnitude = v;\n        this.redraw();\n    }\n}\n\nVignetteShader.vertexShaderSource = DefaultShader.vertexShaderSource;\n\nVignetteShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float magnitude;\n    uniform float intensity;\n    uniform vec2 pivot;\n\n    void main() {\n        vec2 uv = vTextureCoord.xy - pivot + vec2(0.5);\n        uv.x = clamp(uv.x, 0.0, 1.0);\n        uv.y = clamp(uv.y, 0.0, 1.0);\n   \n        uv *=  1.00 - uv.yx;\n        float vig = uv.x * uv.y * 25.0 * intensity;\n        vig = pow(vig, 0.45 * magnitude);\n        vec4 fragColor = vec4(vig) * vColor;\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * fragColor;\n\n    }\n`\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\nimport StageUtils from '../../../tree/StageUtils.mjs'\n\nexport default class SpinnerShader extends DefaultShader {\n\n    constructor(ctx) {\n        super(ctx);\n        this._radius = 100;\n        this._width = 50;\n        this._period = 1;\n        this._angle = 0.5;\n        this._smooth = 0.005;\n        this._color = 0xffffffff;\n        this._backgroundColor = 0xff000000;\n        this._time = Date.now();\n    }\n\n    set radius(v) {\n        this._radius = v;\n        this.redraw();\n    }\n\n    set width(v) {\n        this._width = v;\n        this.redraw();\n    }\n\n    set period(v) {\n        this._period = v;\n        this.redraw();\n    }\n\n    set angle(v) {\n        this._angle = v\n        this.redraw();\n    }\n\n    set smooth(v) {\n        this._smooth = v;\n        this.redraw();\n    }\n\n    set color(v) {\n        this._color = v;\n        this.redraw();\n    }\n\n    set backgroundColor(v) {\n        this._backgroundColor = v;\n        this.redraw();\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        const owner = operation.shaderOwner\n\n        this._setUniform(\"iTime\", Date.now() - this._time, this.gl.uniform1f);\n\n        const renderPrecision = this.ctx.stage.getRenderPrecision();\n        this._setUniform('radius', this._radius * renderPrecision, this.gl.uniform1f);\n        this._setUniform('width', this._width * renderPrecision, this.gl.uniform1f);\n        this._setUniform('period', this._period, this.gl.uniform1f);\n        this._setUniform('angle', this._angle, this.gl.uniform1f);\n        this._setUniform('smooth', this._smooth, this.gl.uniform1f);\n        this._setUniform('color', new Float32Array(StageUtils.getRgbaComponentsNormalized(this._color)), this.gl.uniform4fv);\n        this._setUniform('backgroundColor', new Float32Array(StageUtils.getRgbaComponentsNormalized(this._backgroundColor)), this.gl.uniform4fv);\n        this._setUniform('resolution', new Float32Array([owner._w * renderPrecision, owner._h * renderPrecision]), this.gl.uniform2fv)\n\n        this.redraw()\n    }\n}\n\nSpinnerShader.vertexShaderSource = DefaultShader.vertexShaderSource;\n\nSpinnerShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float iTime;\n    uniform float radius;\n    uniform float width;\n    uniform float period;\n    uniform float angle;\n    uniform float smooth;\n    uniform vec2 resolution;\n\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n\n    float ratio = resolution.y / resolution.x;\n\n    vec2 transpose_pos(vec2 pos) {\n        if (ratio < 1.) {\n            float diff = 0.5 - pos.x;\n            pos.x = 0.5 - diff / ratio;\n        } else {\n            float diff = 0.5 - pos.y;\n            pos.y = 0.5 - diff * ratio;\n        }\n        return pos;\n    }\n\n    float get_angle(vec2 pos) {\n        pos = transpose_pos(pos);\n        float a = atan(pos.y - 0.5, pos.x - 0.5);\n        a = (1.0+a/3.14159)/2.0;\n        \n        return a;\n    }\n\n    float dist(vec2 pos1, vec2 pos2) {\n        pos1 = transpose_pos(pos1);\n        return distance(pos1, pos2);\n    }\n\n    void main()\n    {\n        vec2 fragCoord = vTextureCoord;\n        vec4 fragColor = vColor;\n        \n        vec2 st = vTextureCoord;\n        float pct = dist(st, vec2(0.5));\n\n        float a = get_angle(st);\n        float t = iTime / 1000.0 / period;\n\n        float inner = max((radius - width) / resolution.x, (radius - width) / resolution.y);\n        float outer = max(radius / resolution.x, radius / resolution.y);\n\n        float x1 = mod(t, 1.0);\n        float x2 = mod(t + angle, 1.0);\n\n        if (x1 < x2) {\n            if (a > x1 && a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        } else {\n            if (a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else if (a > x1) {\n                float val = (1.0 - (1.0 + x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (1.0 + x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        }\n\n        float s = smoothstep(inner, inner + smooth + 0.00001, pct) * (1.0 - smoothstep(outer, outer + smooth + 0.00001, pct));\n        gl_FragColor = texture2D(uSampler, fragCoord) * vColor * (1. - s * fragColor.a) + fragColor * s;\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class HoleShader extends DefaultShader {\n\n    constructor(context) {\n        super(context);\n        this._x = 0;\n        this._y = 0;\n        this._w = 0;\n        this._h = 0;\n        this._radius = 0;\n    }\n\n    get x() {\n        return this._x;\n    }\n\n    set x(v) {\n        this._x = v;\n        this.redraw();\n    }\n\n    get y() {\n        return this._y;\n    }\n\n    set y(v) {\n        this._y = v;\n        this.redraw();\n    }\n\n    get w() {\n        return this._w;\n    }\n\n    set w(v) {\n        this._w = v;\n        this.redraw();\n    }\n\n    get h() {\n        return this._h;\n    }\n\n    set h(v) {\n        this._h = v;\n        this.redraw();\n    }\n\n    get radius() {\n        return this._radius;\n    }\n\n    set radius(v) {\n        this._radius = v;\n        this.redraw();\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n\n        const owner = operation.shaderOwner;\n        const renderPrecision = this.ctx.stage.getRenderPrecision()\n\n        this._setUniform(\"x\", this._x * renderPrecision, this.gl.uniform1f);\n        this._setUniform(\"y\", this._y * renderPrecision, this.gl.uniform1f);\n        this._setUniform(\"w\", this._w * renderPrecision, this.gl.uniform1f);\n        this._setUniform(\"h\", this._h * renderPrecision, this.gl.uniform1f);\n        this._setUniform('radius',  (this._radius + .5) * renderPrecision, this.gl.uniform1f);\n        this._setUniform('resolution', new Float32Array([owner._w * renderPrecision, owner._h * renderPrecision]), this.gl.uniform2fv);\n    }\n\n    useDefault() {\n        return (this._x === 0 && this._y === 0 && this._w === 0 && this._h === 0)\n    }\n}\n\nHoleShader.vertexShaderSource = DefaultShader.vertexShaderSource;\n\nHoleShader.fragmentShaderSource = `\n   #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float x;\n    uniform float y;\n    uniform float w;\n    uniform float h;\n    uniform vec2 resolution;\n    uniform float radius;\n\n    float roundBox(vec2 p, vec2 b, float r) {\n        float d = length(max(abs(p)-b+r, 0.1))-r;\n        return smoothstep(1.0, 0.0, d);\n    }\n\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n        vec2 size = vec2(w, h) / 2.0;\n        float b = roundBox(pos, size, radius);\n        gl_FragColor = mix(color, vec4(0.0), b) * vColor;\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\nimport StageUtils from \"../../../tree/StageUtils.mjs\";\n\nexport default class RadialGradientShader extends DefaultShader {\n    constructor(context) {\n        super(context);\n        this._pivot = [0, 0];\n        this._ic = 0xffffffff;\n        this._normalizedIC = this._getNormalizedColor(this._ic);\n        this._oc = 0x00ffffff;\n        this._normalizedOC = this._getNormalizedColor(this._oc);\n        this._radius = 0;\n    }\n\n    set radiusX(v) {\n        this.radius = v;\n    }\n\n    get radiusX() {\n        return this._radius;\n    }\n\n    set radiusY(v) {\n        this._radiusY = v;\n        this.redraw();\n    }\n\n    get radiusY() {\n        return this._radiusY;\n    }\n\n    set radius(v) {\n        this._radius = v;\n        this.redraw();\n    }\n\n    set innerColor(argb) {\n        this._ic = argb;\n        this._normalizedIC = this._getNormalizedColor(argb);\n        this.redraw();\n    }\n\n    get innerColor() {\n        return this._ic;\n    }\n\n    set outerColor(argb) {\n        this._oc = argb;\n        this._normalizedOC = this._getNormalizedColor(argb);\n        this.redraw();\n    }\n\n    set color(argb) {\n        this.innerColor = argb;\n    }\n\n    get color() {\n        return this.innerColor;\n    }\n\n    get outerColor() {\n        return this._ic;\n    }\n\n    set x(f) {\n        this._x = f;\n        this.redraw();\n    }\n\n    set y(f) {\n        this._y = f;\n        this.redraw();\n    }\n\n    set pivot(v) {\n        if(Array.isArray(v) && v.length === 2) {\n            this._pivot = v;\n        }\n        else if(Array.isArray(v)) {\n            this._pivot = [v[0], v[1] || v[0]];\n        }\n        else {\n            this._pivot = [v, v];\n        }\n        this.redraw();\n    }\n\n    get pivot() {\n        return this._pivot[0];\n    }\n\n    set pivotY(f) {\n        this._pivot[1] = f;\n        this.redraw();\n    }\n\n    get pivotY() {\n        return this._pivot[1];\n    }\n\n    set pivotX(f) {\n        this._pivot[0] = f;\n        this.redraw();\n    }\n\n    get pivotX() {\n        return this._pivot[0];\n    }\n\n    _getNormalizedColor(color) {\n        const col = StageUtils.getRgbaComponentsNormalized(color);\n        col[0] *= col[3];\n        col[1] *= col[3];\n        col[2] *= col[3];\n        return new Float32Array(col);\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        const owner = operation.shaderOwner;\n\n        if(this._x) {\n            this._pivot[0] = this._x / owner.w;\n        }\n        if(this._y) {\n            this._pivot[1] = this._y / owner.h;\n        }\n\n        if(this._radius === 0) {\n            this._radius = owner.w * 0.5;\n        }\n\n        this._setUniform('innerColor', this._normalizedIC, this.gl.uniform4fv);\n        this._setUniform('fill', StageUtils.getRgbaComponentsNormalized(this._oc)[3], this.gl.uniform1f);\n        this._setUniform('outerColor', this._normalizedOC, this.gl.uniform4fv);\n        this._setUniform('pivot', new Float32Array(this._pivot),  this.gl.uniform2fv);\n        this._setUniform('resolution', new Float32Array([owner._w, owner._h]),  this.gl.uniform2fv);\n        this._setUniform('alpha', operation.getElementCore(0).renderContext.alpha, this.gl.uniform1f);\n        this._setUniform('radius',  this._radius, this.gl.uniform1f);\n        this._setUniform('radiusY',  (this._radiusY || this._radius), this.gl.uniform1f);\n    }\n}\n\nRadialGradientShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec2 pivot;\n    uniform vec4 innerColor;\n    uniform vec4 outerColor;\n    uniform float radius;\n    uniform float radiusY;\n    uniform float alpha;\n    uniform float fill;\n    uniform float aspectRatio;\n    \n    void main() {\n        vec2 point = vTextureCoord.xy * resolution;\n        vec2 projection = vec2(pivot.x * resolution.x, pivot.y * resolution.y);\n        float d = length((point - projection) / vec2(radius * 2.0, radiusY * 2.0));\n        vec4 color = mix(texture2D(uSampler, vTextureCoord) * vColor, outerColor * alpha, fill);\n        gl_FragColor = mix(innerColor * alpha, color, smoothstep(0.0, 1.0, d));\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class Light3dShader extends DefaultShader {\n\n    constructor(ctx) {\n        super(ctx);\n\n        this._strength = 0.5;\n        this._ambient = 0.5;\n        this._fudge = 0.4;\n\n        this._rx = 0;\n        this._ry = 0;\n\n        this._z = 0;\n        this._pivotX = NaN;\n        this._pivotY = NaN;\n        this._pivotZ = 0;\n\n        this._lightY = 0;\n        this._lightZ = 0;\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n\n        let vr = operation.shaderOwner;\n        let element = vr.element;\n\n        let pivotX = isNaN(this._pivotX) ? element.pivotX * vr.w : this._pivotX;\n        let pivotY = isNaN(this._pivotY) ? element.pivotY * vr.h : this._pivotY;\n        let coords = vr.getRenderTextureCoords(pivotX, pivotY);\n\n        // Counter normal rotation.\n\n        let rz = -Math.atan2(vr._renderContext.tc, vr._renderContext.ta);\n\n        let gl = this.gl;\n        this._setUniform(\"pivot\", new Float32Array([coords[0], coords[1], this._pivotZ]), gl.uniform3fv);\n        this._setUniform(\"rot\", new Float32Array([this._rx, this._ry, rz]), gl.uniform3fv);\n\n        this._setUniform(\"z\", this._z, gl.uniform1f);\n        this._setUniform(\"lightY\", this.lightY, gl.uniform1f);\n        this._setUniform(\"lightZ\", this.lightZ, gl.uniform1f);\n        this._setUniform(\"strength\", this._strength, gl.uniform1f);\n        this._setUniform(\"ambient\", this._ambient, gl.uniform1f);\n        this._setUniform(\"fudge\", this._fudge, gl.uniform1f);\n    }\n\n    set strength(v) {\n        this._strength = v;\n        this.redraw();\n    }\n\n    get strength() {\n        return this._strength;\n    }\n\n    set ambient(v) {\n        this._ambient = v;\n        this.redraw();\n    }\n\n    get ambient() {\n        return this._ambient;\n    }\n\n    set fudge(v) {\n        this._fudge = v;\n        this.redraw();\n    }\n\n    get fudge() {\n        return this._fudge;\n    }\n\n    get rx() {\n        return this._rx;\n    }\n\n    set rx(v) {\n        this._rx = v;\n        this.redraw();\n    }\n\n    get ry() {\n        return this._ry;\n    }\n\n    set ry(v) {\n        this._ry = v;\n        this.redraw();\n    }\n\n    get z() {\n        return this._z;\n    }\n\n    set z(v) {\n        this._z = v;\n        this.redraw();\n    }\n\n    get pivotX() {\n        return this._pivotX;\n    }\n\n    set pivotX(v) {\n        this._pivotX = v + 1;\n        this.redraw();\n    }\n\n    get pivotY() {\n        return this._pivotY;\n    }\n\n    set pivotY(v) {\n        this._pivotY = v + 1;\n        this.redraw();\n    }\n\n    get lightY() {\n        return this._lightY;\n    }\n\n    set lightY(v) {\n        this._lightY = v;\n        this.redraw();\n    }\n\n    get pivotZ() {\n        return this._pivotZ;\n    }\n\n    set pivotZ(v) {\n        this._pivotZ = v;\n        this.redraw();\n    }\n\n    get lightZ() {\n        return this._lightZ;\n    }\n\n    set lightZ(v) {\n        this._lightZ = v;\n        this.redraw();\n    }\n\n    useDefault() {\n        return (this._rx === 0 && this._ry === 0 && this._z === 0 && this._strength === 0 && this._ambient === 1);\n    }\n\n}\n\nLight3dShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float fudge;\n    uniform float strength;\n    uniform float ambient;\n    uniform float z;\n    uniform float lightY;\n    uniform float lightZ;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Set depth perspective\n        float perspective = 1.0 + fudge * pos.z;\n\n        pos.z += lightZ * projection.x;\n\n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, perspective);\n\n        // Correct light source position.\n        pos.y += lightY * abs(projection.y);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nLight3dShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec3 pos;\n    uniform sampler2D uSampler;\n    uniform float ambient;\n    uniform float strength;\n    void main(void){\n        vec4 rgba = texture2D(uSampler, vTextureCoord);\n        float d = length(pos);\n        float n = 1.0 / max(0.1, d);\n        rgba.rgb = rgba.rgb * (strength * n + ambient);\n        gl_FragColor = rgba * vColor;\n    }\n`;\n\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class PerspectiveShader extends DefaultShader {\n\n    constructor(ctx) {\n        super(ctx);\n\n        this._fudge = 0.2;\n        this._rx = 0;\n        this._ry = 0;\n        this._z = 1.0;\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n\n        const vr = operation.shaderOwner;\n        const element = vr.element;\n\n        const pivotX = element.pivotX * vr.w;\n        const pivotY = element.pivotY * vr.h;\n        const coords = vr.getRenderTextureCoords(pivotX, pivotY);\n\n        // Counter normal rotation.\n        const rz = -Math.atan2(vr._renderContext.tc, vr._renderContext.ta);\n\n        const gl = this.gl;\n        this._setUniform(\"pivot\", new Float32Array([coords[0], coords[1], 0]), gl.uniform3fv);\n        this._setUniform(\"rot\", new Float32Array([this._rx, this._ry, rz]), gl.uniform3fv);\n        this._setUniform(\"z\", this._z, gl.uniform1f);\n        this._setUniform(\"fudge\", this._fudge, gl.uniform1f);\n    }\n\n    set fudge(v) {\n        this._fudge = v;\n        this.redraw();\n    }\n\n    get fudge() {\n        return this._fudge;\n    }\n\n    get rx() {\n        return this._rx;\n    }\n\n    set rx(v) {\n        this._rx = v;\n        this.redraw();\n    }\n\n    get ry() {\n        return this._ry;\n    }\n\n    set ry(v) {\n        this._ry = v;\n        this.redraw();\n    }\n\n    get z() {\n        return this._z;\n    }\n\n    set z(v) {\n        this._z = v;\n        this.redraw();\n    }\n\n    useDefault() {\n        return (this._rx === 0 && this._ry === 0 && this._z === 0);\n    }\n\n}\n\nPerspectiveShader.vertexShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float z;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, z);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n`;\n\nPerspectiveShader.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform vec3 rot;\n    uniform float fudge;\n\n    void main(void) {\n        vec2 coords = vTextureCoord;\n\n        coords.xy -= vec2(0.5);\n        coords.y = coords.y + (sign(rot[0]) * 0.5 - coords.x) * sin(rot[0]) * fudge * coords.y;\n        coords.x = coords.x + (sign(rot[1]) * 0.5 - coords.y) * sin(rot[1]) * fudge * coords.x;\n        coords.xy += vec2(0.5);\n\n        if (coords.x < 0.0 || coords.x > 1.0 || coords.y < 0.0 || coords.y > 1.0) {\n            gl_FragColor = vec4(0.0);\n        } else {\n            gl_FragColor = texture2D(uSampler, coords) * vColor;\n        }\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\n\nexport default class MagnifierShader extends DefaultShader {\n\tconstructor(context) {\n\t  super(context);\n\t  this._x = 0;\n\t  this._y = 0;\n\t  this._w = 0;\n\t  this._h = 0;\n\t  this._radius = 0;\n\t  this._magnification = 0.6;\n\t}\n  \n\tget x() {\n\t  return this._x;\n\t}\n  \n\tset x(v) {\n\t  this._x = v;\n\t  this.redraw();\n\t}\n  \n\tget y() {\n\t  return this._y;\n\t}\n  \n\tset y(v) {\n\t  this._y = v;\n\t  this.redraw();\n\t}\n  \n\tget w() {\n\t  return this._w;\n\t}\n  \n\tset w(v) {\n\t  this._w = v;\n\t  this.redraw();\n\t}\n  \n\tget h() {\n\t  return this._h;\n\t}\n  \n\tset h(v) {\n\t  this._h = v;\n\t  this.redraw();\n\t}\n  \n\tget magnification() {\n\t  return this._magnification;\n\t}\n  \n\tset magnification(v) {\n\t  this._magnification = v;\n\t  this.redraw();\n\t}\n  \n\tget radius() {\n\t  return this._radius;\n\t}\n  \n\tset radius(v) {\n\t  this._radius = v;\n\t  this.redraw();\n\t}\n  \n\tsetupUniforms(operation) {\n\t  super.setupUniforms(operation);\n  \n\t  const owner = operation.shaderOwner;\n\t  const renderPrecision = this.ctx.stage.getRenderPrecision();\n\t  this._setUniform('x', this._x * renderPrecision, this.gl.uniform1f);\n\t  this._setUniform('y', this._y * renderPrecision, this.gl.uniform1f);\n\t  this._setUniform('w', this._w * renderPrecision, this.gl.uniform1f);\n\t  this._setUniform('h', this._h * renderPrecision, this.gl.uniform1f);\n\t  this._setUniform('magnification', this._magnification, this.gl.uniform1f);\n\t  this._setUniform(\n\t\t'radius',\n\t\t(this._radius + 0.5) * renderPrecision,\n\t\tthis.gl.uniform1f\n\t  );\n\t  this._setUniform(\n\t\t'resolution',\n\t\tnew Float32Array([\n\t\t  owner._w * renderPrecision,\n\t\t  owner._h * renderPrecision\n\t\t]),\n\t\tthis.gl.uniform2fv\n\t  );\n\t}\n \n\tuseDefault() {\n\t  return this._w === 0 && this._h === 0;\n\t}\n  }\n  \n  MagnifierShader.vertexShaderSource = DefaultShader.vertexShaderSource;\n  \n  MagnifierShader.fragmentShaderSource = `\n\t  #ifdef GL_ES\n\t\t# ifdef GL_FRAGMENT_PRECISION_HIGH\n\t\tprecision highp float;\n\t\t# else\n\t\tprecision lowp float;\n\t\t# endif\n\t  #endif\n\n\t  varying vec2 vTextureCoord;\n\t  varying vec4 vColor;\n\t  uniform sampler2D uSampler;\n\t  uniform float x;\n\t  uniform float y;\n\t  uniform float w;\n\t  uniform float h;\n\t  uniform vec2 resolution;\n\t  uniform float radius;\n\t  uniform float magnification;\n  \n\t  float roundBox(vec2 p, vec2 b, float r) {\n\t\t  float d = length(max(abs(p)-b+r, 0.1))-r;\n\t\t  return smoothstep(1.0, 0.0, d);\n\t  }\n\n\t  float inside(vec2 v) {\n\t\tvec2 s = step(vec2(0.0, 0.0), v) - step(vec2(1.0, 1.0), v);\n\t\treturn s.x * s.y;   \n      }\n  \n\t  void main(void) {\n\t\tvec4 color = texture2D(uSampler, vTextureCoord);\n\t\tvec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n\t\tvec2 size = vec2(w, h) / 2.0;\n\t\tfloat b = roundBox(pos, size, radius);\n\t\tvec2 pos2 = (vTextureCoord.xy * magnification * resolution + vec2(x, y) * magnification) / resolution;\n\t\tgl_FragColor = mix(color, texture2D(uSampler, pos2) * inside(pos2), b) * vColor;\n\t  }\n  `;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DefaultShader from \"./DefaultShader.mjs\";\nimport StageUtils from \"../../../tree/StageUtils.mjs\";\n\nexport default class SpinnerShader2 extends DefaultShader {\n    constructor(context) {\n        super(context);\n        this._period = 1;\n        this._stroke = 0;\n        this._showDot = true;\n        this._clockwise = true;\n        this._bc = 0xff000000;\n        this._normalizedBC = this._getNormalizedColor(this._bc);\n        this._c = 0xffffffff;\n        this._normalizedC = this._getNormalizedColor(this._c);\n    }\n\n    set radius(v) {\n        if(v === 0) {\n            v = 1;\n        }\n        this._radius = v;\n    }\n\n    set stroke(value) {\n        this._stroke = Math.abs(value);\n    }\n\n    get stroke() {\n        return this._stroke;\n    }\n\n    set color(argb) {\n        this._c = argb;\n        this._normalizedC = this._getNormalizedColor(argb);\n    }\n\n    get color() {\n        return this._c;\n    }\n\n    set backgroundColor(argb) {\n        this._bc = argb;\n        this._normalizedBC = this._getNormalizedColor(argb);\n    }\n\n    get backgroundColor() {\n        return this._sc;\n    }\n\n    set showDot(bool) {\n        this._showDot = bool;\n    }\n\n    get showDot() {\n        return this._showDot;\n    }\n\n    set clockwise(bool) {\n        this._clockwise = bool;\n    }\n\n    get clockwise() {\n        return this._clockwise;\n    }\n\n    set period(v) {\n        this._period = v;\n    }\n\n    get period() {\n        return this._period;\n    }\n\n    _getNormalizedColor(color) {\n        const col = StageUtils.getRgbaComponentsNormalized(color);\n        col[0] *= col[3];\n        col[1] *= col[3];\n        col[2] *= col[3];\n        return new Float32Array(col);\n    }\n\n    setupUniforms(operation) {\n        super.setupUniforms(operation);\n        const owner = operation.shaderOwner;\n        const radius = this._radius || (owner._w / 2);\n\n        if(this._stroke === 0) {\n            this._stroke = radius * 0.33;\n        }\n\n        this._setUniform('resolution', new Float32Array([owner._w, owner._h]),  this.gl.uniform2fv);\n        this._setUniform('color', this._normalizedC, this.gl.uniform4fv);\n        this._setUniform('backgroundColor', this._normalizedBC, this.gl.uniform4fv);\n        this._setUniform('stroke',  this._stroke, this.gl.uniform1f);\n        this._setUniform('radius',  radius, this.gl.uniform1f);\n        this._setUniform('direction',  this._clockwise ? -1 : 1, this.gl.uniform1f);\n        this._setUniform('showDot', !!this._showDot, this.gl.uniform1f);\n        this._setUniform('time', Date.now() - SpinnerShader2.spinSync, this.gl.uniform1f);\n        this._setUniform('period', this._period, this.gl.uniform1f);\n        this._setUniform('alpha', operation.getElementCore(0).renderContext.alpha, this.gl.uniform1f);\n\n        if(this._sc !== this._bc || this._stroke !== radius * 0.5) {\n            this.redraw();\n        }\n    }\n}\n\nSpinnerShader2.spinSync = Date.now();\n\nSpinnerShader2.fragmentShaderSource = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    \n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n    uniform float direction;\n    uniform float radius;\n    uniform float time;\n    uniform float stroke;\n    uniform float showDot;\n    uniform float period;\n    uniform float alpha;\n    \n    float circleDist(vec2 p, float radius){\n        return length(p) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 center = vTextureCoord.xy * resolution - halfRes;\n        \n        float c = max(-circleDist(center, radius - stroke), circleDist(center, radius));\n        float rot = -(time / 1000.0 / period) * 6.0 * direction;\n        center *= mat2(cos(rot), sin(rot), -sin(rot), cos(rot));\n        \n        float a = direction * atan(center.x, center.y) * PI * 0.05 + 0.45;\n        \n        float strokeRad = stroke * 0.5;\n        a = mix(a, max(a, fillMask(circleDist(vec2(center.x, center.y + (radius - strokeRad)), strokeRad))), showDot);\n        vec4 base = mix(vec4(0.0), backgroundColor * alpha, fillMask(c));\n        gl_FragColor = mix(base, color * alpha, fillMask(c) * a);\n    }\n`;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Application from \"./application/Application.mjs\";\nimport Component from \"./application/Component.mjs\";\nimport Base from \"./tree/Base.mjs\";\nimport Utils from \"./tree/Utils.mjs\";\nimport StageUtils from \"./tree/StageUtils.mjs\";\nimport Element from \"./tree/Element.mjs\";\nimport ElementCore from \"./tree/core/ElementCore.mjs\";\nimport ElementTexturizer from \"./tree/core/ElementTexturizer.mjs\";\nimport Texture from \"./tree/Texture.mjs\";\n\nimport Tools from \"./tools/Tools.mjs\";\nimport ObjMerger from \"./tools/ObjMerger.mjs\";\nimport ObjectListProxy from \"./tools/ObjectListProxy.mjs\";\nimport ObjectListWrapper from \"./tools/ObjectListWrapper.mjs\";\n\nimport RectangleTexture from \"./textures/RectangleTexture.mjs\";\nimport NoiseTexture from \"./textures/NoiseTexture.mjs\";\nimport TextTexture from \"./textures/TextTexture.mjs\";\nimport ImageTexture from \"./textures/ImageTexture.mjs\";\nimport HtmlTexture from \"./textures/HtmlTexture.mjs\";\nimport StaticTexture from \"./textures/StaticTexture.mjs\";\nimport StaticCanvasTexture from \"./textures/StaticCanvasTexture.mjs\";\nimport SourceTexture from \"./textures/SourceTexture.mjs\";\n\nimport ListComponent from \"./components/ListComponent.mjs\";\nimport FastBlurComponent from \"./components/FastBlurComponent.mjs\";\nimport BloomComponent from \"./components/BloomComponent.mjs\";\nimport SmoothScaleComponent from \"./components/SmoothScaleComponent.mjs\";\nimport BorderComponent from \"./components/BorderComponent.mjs\";\nimport EventEmitter from \"./EventEmitter.mjs\";\n\nimport WebGLShader from \"./renderer/webgl/WebGLShader.mjs\";\nimport WebGLDefaultShader from \"./renderer/webgl/shaders/DefaultShader.mjs\";\nimport { WebGLGrayscaleShader } from \"./renderer/common/shaders/GrayscaleShader.mjs\";\nimport BoxBlurShader from \"./renderer/webgl/shaders/BoxBlurShader.mjs\";\nimport DitheringShader from \"./renderer/webgl/shaders/DitheringShader.mjs\";\nimport CircularPushShader from \"./renderer/webgl/shaders/CircularPushShader.mjs\";\nimport InversionShader from \"./renderer/webgl/shaders/InversionShader.mjs\";\nimport LinearBlurShader from \"./renderer/webgl/shaders/LinearBlurShader.mjs\";\nimport OutlineShader from \"./renderer/webgl/shaders/OutlineShader.mjs\";\nimport PixelateShader from \"./renderer/webgl/shaders/PixelateShader.mjs\";\nimport RadialFilterShader from \"./renderer/webgl/shaders/RadialFilterShader.mjs\";\nimport RoundedRectangleShader from \"./renderer/webgl/shaders/RoundedRectangleShader.mjs\";\nimport FadeOutShader from \"./renderer/webgl/shaders/FadeOutShader.mjs\";\nimport VignetteShader from \"./renderer/webgl/shaders/VignetteShader.mjs\";\nimport SpinnerShader from \"./renderer/webgl/shaders/SpinnerShader.mjs\";\nimport HoleShader from \"./renderer/webgl/shaders/HoleShader.mjs\";\nimport RadialGradientShader from \"./renderer/webgl/shaders/RadialGradientShader.mjs\";\nimport Light3dShader from \"./renderer/webgl/shaders/Light3dShader.mjs\";\nimport PerspectiveShader from \"./renderer/webgl/shaders/PerspectiveShader.mjs\";\nimport MagnifierShader from \"./renderer/webgl/shaders/MagnifierShader.mjs\";\n\nimport C2dShader from \"./renderer/c2d/C2dShader.mjs\";\nimport C2dDefaultShader from \"./renderer/c2d/shaders/DefaultShader.mjs\";\nimport { C2dGrayscaleShader } from \"./renderer/common/shaders/GrayscaleShader.mjs\";\nimport C2dBlurShader from \"./renderer/c2d/shaders/BlurShader.mjs\";\n\nimport Stage from \"./tree/Stage.mjs\";\nimport SpinnerShader2 from './renderer/webgl/shaders/SpinnerShader2.mjs';\n\nconst lightning = {\n    Application,\n    Component,\n    Base,\n    Utils,\n    StageUtils,\n    Element,\n    Tools,\n    Stage,\n    ElementCore,\n    ElementTexturizer,\n    Texture,\n    EventEmitter,\n    shaders: {\n        Grayscale: WebGLGrayscaleShader,\n        BoxBlur: BoxBlurShader,\n        Dithering: DitheringShader,\n        CircularPush: CircularPushShader,\n        Inversion: InversionShader,\n        LinearBlur: LinearBlurShader,\n        Outline: OutlineShader,\n        Pixelate: PixelateShader,\n        RadialFilter: RadialFilterShader,\n        RoundedRectangle: RoundedRectangleShader,\n        Spinner2: SpinnerShader2,\n        FadeOut: FadeOutShader,\n        Hole: HoleShader,\n        Vignette: VignetteShader,\n        Spinner: SpinnerShader,\n        RadialGradient: RadialGradientShader,\n        Light3d: Light3dShader,\n        Perspective: PerspectiveShader,\n        Magnifier: MagnifierShader,\n        WebGLShader,\n        WebGLDefaultShader,\n        C2dShader,\n        C2dDefaultShader,\n        c2d: {\n            Grayscale: C2dGrayscaleShader,\n            Blur: C2dBlurShader\n        }\n    },\n    textures: {\n        RectangleTexture,\n        NoiseTexture,\n        TextTexture,\n        ImageTexture,\n        HtmlTexture,\n        StaticTexture,\n        StaticCanvasTexture,\n        SourceTexture\n    },\n    components: {\n        FastBlurComponent,\n        BloomComponent,\n        SmoothScaleComponent,\n        BorderComponent,\n        ListComponent\n    },\n    tools: {\n        ObjMerger,\n        ObjectListProxy,\n        ObjectListWrapper\n    }\n};\n\nif (Utils.isWeb) {\n    window.lng = lightning;\n}\n\nexport default lightning;\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst settings = {}\nconst subscribers = {}\n\nexport const initSettings = (appSettings, platformSettings) => {\n  settings['app'] = appSettings\n  settings['platform'] = platformSettings\n  settings['user'] = {}\n}\n\nconst publish = (key, value) => {\n  subscribers[key] && subscribers[key].forEach(subscriber => subscriber(value))\n}\n\nconst dotGrab = (obj = {}, key) => {\n  if (obj === null) return undefined\n  const keys = key.split('.')\n  for (let i = 0; i < keys.length; i++) {\n    obj = obj[keys[i]] = obj[keys[i]] !== undefined ? obj[keys[i]] : {}\n  }\n  return typeof obj === 'object' && obj !== null ? (Object.keys(obj).length ? obj : undefined) : obj\n}\n\nexport default {\n  get(type, key, fallback = undefined) {\n    const val = dotGrab(settings[type], key)\n    return val !== undefined ? val : fallback\n  },\n  has(type, key) {\n    return !!this.get(type, key)\n  },\n  set(key, value) {\n    settings['user'][key] = value\n    publish(key, value)\n  },\n  subscribe(key, callback) {\n    subscribers[key] = subscribers[key] || []\n    subscribers[key].push(callback)\n  },\n  unsubscribe(key, callback) {\n    if (callback) {\n      const index = subscribers[key] && subscribers[key].findIndex(cb => cb === callback)\n      index > -1 && subscribers[key].splice(index, 1)\n    } else {\n      if (key in subscribers) {\n        subscribers[key] = []\n      }\n    }\n  },\n  clearSubscribers() {\n    for (const key of Object.getOwnPropertyNames(subscribers)) {\n      delete subscribers[key]\n    }\n  },\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const hasRegex = /\\{\\/(.*?)\\/([igm]{0,3})\\}/g\nexport const isWildcard = /^[!*$]$/\nexport const hasLookupId = /\\/:\\w+?@@([0-9]+?)@@/\nexport const isNamedGroup = /^\\/:/\n\n/**\n * Test if a route is part regular expressed\n * and replace it for a simple character\n * @param route\n * @returns {*}\n */\nexport const stripRegex = (route, char = 'R') => {\n  // if route is part regular expressed we replace\n  // the regular expression for a character to\n  // simplify floor calculation and backtracking\n  if (hasRegex.test(route)) {\n    route = route.replace(hasRegex, char)\n  }\n  return route\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Create a local request register\n * @param flags\n * @returns {Map<any, any>}\n */\nexport const createRegister = flags => {\n  const reg = new Map()\n  // store user defined and router\n  // defined flags in register\n  ;[...Object.keys(flags), ...Object.getOwnPropertySymbols(flags)].forEach(key => {\n    reg.set(key, flags[key])\n  })\n  return reg\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Settings from '../Settings'\n\nconst prepLog = (type, args) => {\n  const colors = {\n    Info: 'green',\n    Debug: 'gray',\n    Warn: 'orange',\n    Error: 'red',\n  }\n\n  args = Array.from(args)\n  return [\n    '%c' + (args.length > 1 && typeof args[0] === 'string' ? args.shift() : type),\n    'background-color: ' + colors[type] + '; color: white; padding: 2px 4px; border-radius: 2px',\n    args,\n  ]\n}\n\nexport default {\n  info() {\n    Settings.get('platform', 'log') && console.log.apply(console, prepLog('Info', arguments))\n  },\n  debug() {\n    Settings.get('platform', 'log') && console.debug.apply(console, prepLog('Debug', arguments))\n  },\n  error() {\n    Settings.get('platform', 'log') && console.error.apply(console, prepLog('Error', arguments))\n  },\n  warn() {\n    Settings.get('platform', 'log') && console.warn.apply(console, prepLog('Warn', arguments))\n  },\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isBoolean, isObject, symbols } from '../utils/helpers'\nimport { createRegister } from '../utils/register'\nimport Log from '../../Log'\n\nexport default class Request {\n  constructor(hash = '', navArgs, storeCaller) {\n    /**\n     * Hash we navigate to\n     * @type {string}\n     * @private\n     */\n    this._hash = hash\n\n    /**\n     * Do we store previous hash in history\n     * @type {boolean}\n     * @private\n     */\n    this._storeCaller = storeCaller\n\n    /**\n     * Request and navigate data\n     * @type {Map}\n     * @private\n     */\n    this._register = new Map()\n\n    /**\n     * Flag if the instance is created due to\n     * this request\n     * @type {boolean}\n     * @private\n     */\n    this._isCreated = false\n\n    /**\n     * Flag if the instance is shared between\n     * previous and current request\n     * @type {boolean}\n     * @private\n     */\n    this._isSharedInstance = false\n\n    /**\n     * Flag if the request has been cancelled\n     * @type {boolean}\n     * @private\n     */\n    this._cancelled = false\n\n    /**\n     * if instance is shared between requests we copy state object\n     * from instance before the new request overrides state\n     * @type {null}\n     * @private\n     */\n    this._copiedHistoryState = null\n\n    // if there are arguments attached to navigate()\n    // we store them in new request\n    if (isObject(navArgs)) {\n      this._register = createRegister(navArgs)\n    } else if (isBoolean(navArgs)) {\n      // if second navigate() argument is explicitly\n      // set to false we prevent the calling page\n      // from ending up in history\n      this._storeCaller = navArgs\n    }\n    // @todo: remove because we can simply check\n    // ._storeCaller property\n    this._register.set(symbols.store, this._storeCaller)\n  }\n\n  cancel() {\n    Log.debug('[router]:', `cancelled ${this._hash}`)\n    this._cancelled = true\n  }\n\n  get url() {\n    return this._hash\n  }\n\n  get register() {\n    return this._register\n  }\n\n  get hash() {\n    return this._hash\n  }\n\n  set hash(args) {\n    this._hash = args\n  }\n\n  get route() {\n    return this._route\n  }\n\n  set route(args) {\n    this._route = args\n  }\n\n  get provider() {\n    return this._provider\n  }\n\n  set provider(args) {\n    this._provider = args\n  }\n\n  get providerType() {\n    return this._providerType\n  }\n\n  set providerType(args) {\n    this._providerType = args\n  }\n\n  set page(args) {\n    this._page = args\n  }\n\n  get page() {\n    return this._page\n  }\n\n  set isCreated(args) {\n    this._isCreated = args\n  }\n\n  get isCreated() {\n    return this._isCreated\n  }\n\n  get isSharedInstance() {\n    return this._isSharedInstance\n  }\n\n  set isSharedInstance(args) {\n    this._isSharedInstance = args\n  }\n\n  get isCancelled() {\n    return this._cancelled\n  }\n\n  set copiedHistoryState(v) {\n    this._copiedHistoryState = v\n  }\n\n  get copiedHistoryState() {\n    return this._copiedHistoryState\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isFunction } from '../utils/helpers'\n\nexport default class Route {\n  constructor(config = {}) {\n    // keep backwards compatible\n    let type = ['on', 'before', 'after'].reduce((acc, type) => {\n      return isFunction(config[type]) ? type : acc\n    }, undefined)\n\n    this._cfg = config\n    if (type) {\n      this._provider = {\n        type,\n        request: config[type],\n      }\n    }\n  }\n\n  get path() {\n    return this._cfg.path\n  }\n\n  get name() {\n    return this._cfg.name\n  }\n\n  get component() {\n    return this._cfg.component\n  }\n\n  get options() {\n    return this._cfg.options\n  }\n\n  get widgets() {\n    return this._cfg.widgets\n  }\n\n  get cache() {\n    return this._cfg.cache\n  }\n\n  get hook() {\n    return this._cfg.hook\n  }\n\n  get beforeNavigate() {\n    return this._cfg.beforeNavigate\n  }\n\n  get provider() {\n    return this._provider\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { hasRegex, hasLookupId, isNamedGroup, stripRegex } from './regex'\nimport { routes, routeExists, bootRequest, getRoutes } from './router'\nimport Request from '../model/Request'\nimport Route from '../model/Route'\nimport { objectToQueryString, isObject, isString } from './helpers'\n\n/**\n * Simple route length calculation\n * @param route {string}\n * @returns {number} - floor\n */\nexport const getFloor = route => {\n  return stripRegex(route).split('/').length\n}\n\n/**\n * return all stored routes that live on the same floor\n * @param floor\n * @returns {Array}\n */\nconst getRoutesByFloor = floor => {\n  const matches = []\n  // simple filter of level candidates\n  for (let [route] of routes.entries()) {\n    if (getFloor(route) === floor) {\n      matches.push(route)\n    }\n  }\n  return matches\n}\n\n/**\n * return a matching route by provided hash\n * hash: home/browse/12 will match:\n * route: home/browse/:categoryId\n * @param hash {string}\n * @returns {boolean|{}} - route\n */\nexport const getRouteByHash = hash => {\n  // @todo: clean up on handleHash\n  hash = hash.replace(/^#/, '')\n\n  const getUrlParts = /(\\/?:?[^/]+)/g\n  // grab possible candidates from stored routes\n  const candidates = getRoutesByFloor(getFloor(hash))\n  // break hash down in chunks\n  const hashParts = hash.match(getUrlParts) || []\n\n  // to simplify the route matching and prevent look around\n  // in our getUrlParts regex we get the regex part from\n  // route candidate and store them so that we can reference\n  // them when we perform the actual regex against hash\n  let regexStore = []\n\n  let matches = candidates.filter(route => {\n    let isMatching = true\n    // replace regex in route with lookup id => @@{storeId}@@\n    if (hasRegex.test(route)) {\n      const regMatches = route.match(hasRegex)\n      if (regMatches && regMatches.length) {\n        route = regMatches.reduce((fullRoute, regex) => {\n          const lookupId = regexStore.length\n          fullRoute = fullRoute.replace(regex, `@@${lookupId}@@`)\n          regexStore.push(regex.substring(1, regex.length - 1))\n          return fullRoute\n        }, route)\n      }\n    }\n\n    const routeParts = route.match(getUrlParts) || []\n\n    for (let i = 0, j = routeParts.length; i < j; i++) {\n      const routePart = routeParts[i]\n      const hashPart = hashParts[i]\n\n      // Since we support catch-all and regex driven name groups\n      // we first test for regex lookup id and see if the regex\n      // matches the value from the hash\n      if (hasLookupId.test(routePart)) {\n        const routeMatches = hasLookupId.exec(routePart)\n        const storeId = routeMatches[1]\n        const routeRegex = regexStore[storeId]\n\n        // split regex and modifiers so we can use both\n        // to create a new RegExp\n        // eslint-disable-next-line\n                const regMatches = /\\/([^\\/]+)\\/([igm]{0,3})/.exec(routeRegex)\n\n        if (regMatches && regMatches.length) {\n          const expression = regMatches[1]\n          const modifiers = regMatches[2]\n\n          const regex = new RegExp(`^/${expression}$`, modifiers)\n\n          if (!regex.test(hashPart)) {\n            isMatching = false\n          }\n        }\n      } else if (isNamedGroup.test(routePart)) {\n        // we kindly skip namedGroups because this is dynamic\n        // we only need to the static and regex drive parts\n        continue\n      } else if (hashPart && routePart.toLowerCase() !== hashPart.toLowerCase()) {\n        isMatching = false\n      }\n    }\n    return isMatching\n  })\n\n  if (matches.length) {\n    if (matches.indexOf(hash) !== -1) {\n      const match = matches[matches.indexOf(hash)]\n      return routes.get(match)\n    } else {\n      // we give prio to static routes over dynamic\n      matches = matches.sort(a => {\n        return isNamedGroup.test(a) ? -1 : 1\n      })\n      // would be strange if this fails\n      // but still we test\n      if (routeExists(matches[0])) {\n        return routes.get(matches[0])\n      }\n    }\n  }\n  return false\n}\n\nexport const getValuesFromHash = (hash = '', path) => {\n  // replace the regex definition from the route because\n  // we already did the matching part\n  path = stripRegex(path, '')\n\n  const getUrlParts = /(\\/?:?[\\w%\\s:.-]+)/g\n  const hashParts = hash.match(getUrlParts) || []\n  const routeParts = path.match(getUrlParts) || []\n  const getNamedGroup = /^\\/:([\\w-]+)\\/?/\n\n  return routeParts.reduce((storage, value, index) => {\n    const match = getNamedGroup.exec(value)\n    if (match && match.length) {\n      storage.set(match[1], decodeURIComponent(hashParts[index].replace(/^\\//, '')))\n    }\n    return storage\n  }, new Map())\n}\n\nexport const getOption = (stack, prop) => {\n  // eslint-disable-next-line\n    if(stack && stack.hasOwnProperty(prop)){\n    return stack[prop]\n  }\n  // we explicitly return undefined since we're testing\n  // for explicit test values\n}\n\n/**\n * create and return new Route instance\n * @param config\n */\nexport const createRoute = config => {\n  // we need to provide a bit of additional logic\n  // for the bootComponent\n  if (config.path === '$') {\n    let options = {\n      preventStorage: true,\n    }\n    if (isObject(config.options)) {\n      options = {\n        ...config.options,\n        ...options,\n      }\n    }\n    config.options = options\n    // if configured add reference to bootRequest\n    // as router after provider\n    if (bootRequest) {\n      config.after = bootRequest\n    }\n  }\n  return new Route(config)\n}\n\n/**\n * Create a new Router request object\n * @param url\n * @param args\n * @param store\n * @returns {*}\n */\nexport const createRequest = (url, args, store) => {\n  return new Request(url, args, store)\n}\n\nexport const getHashByName = obj => {\n  if (!obj.to && !obj.name) {\n    return false\n  }\n  const route = getRouteByName(obj.to || obj.name)\n  const hasDynamicGroup = /\\/:([\\w-]+)\\/?/\n  let hash = route\n\n  // if route contains dynamic group\n  // we replace them with the provided params\n  if (hasDynamicGroup.test(route)) {\n    if (obj.params) {\n      const keys = Object.keys(obj.params)\n      hash = keys.reduce((acc, key) => {\n        return acc.replace(`:${key}`, obj.params[key])\n      }, route)\n    }\n    if (obj.query) {\n      return `${hash}${objectToQueryString(obj.query)}`\n    }\n  }\n  return hash\n}\n\nconst getRouteByName = name => {\n  for (let [path, route] of routes.entries()) {\n    if (route.name === name) {\n      return path\n    }\n  }\n  return false\n}\n\nexport const keepActivePageAlive = (route, request) => {\n  if (isString(route)) {\n    const routes = getRoutes()\n    if (routes.has(route)) {\n      route = routes.get(route)\n    } else {\n      return false\n    }\n  }\n\n  const register = request.register\n  const routeOptions = route.options\n\n  if (register.has('keepAlive')) {\n    return register.get('keepAlive')\n  } else if (routeOptions && routeOptions.keepAlive) {\n    return routeOptions.keepAlive\n  }\n\n  return false\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isArray, isFunction, ucfirst } from './helpers'\n\nexport default (page, events = [], params = {}) => {\n  if (!isArray(events)) {\n    events = [events]\n  }\n  events.forEach(e => {\n    const event = `_on${ucfirst(e)}`\n    if (isFunction(page[event])) {\n      page[event](params)\n    }\n  })\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { app, widgetsHost } from './router'\nimport { ucfirst } from './helpers'\nimport emit from './emit'\n\nlet activeWidget = null\n\nexport const getReferences = () => {\n  if (!widgetsHost) {\n    return\n  }\n  return widgetsHost.get().reduce((storage, widget) => {\n    const key = widget.ref.toLowerCase()\n    storage[key] = widget\n    return storage\n  }, {})\n}\n\n/**\n * update the visibility of the available widgets\n * for the current page / route\n * @param page\n */\nexport const updateWidgets = (widgets, page) => {\n  // force lowercase lookup\n  const configured = (widgets || []).map(ref => ref.toLowerCase())\n\n  widgetsHost.forEach(widget => {\n    widget.visible = configured.indexOf(widget.ref.toLowerCase()) !== -1\n    if (widget.visible) {\n      emit(widget, ['activated'], page)\n    }\n  })\n  if (app.state === 'Widgets' && activeWidget && !activeWidget.visible) {\n    app._setState('')\n  }\n}\n\nconst getWidgetByName = name => {\n  name = ucfirst(name)\n  return widgetsHost.getByRef(name) || false\n}\n\n/**\n * delegate app focus to a on-screen widget\n * @param name - {string}\n */\nexport const focusWidget = name => {\n  const widget = getWidgetByName(name)\n  if (widget) {\n    setActiveWidget(widget)\n\n    // if app is already in 'Widgets' state we can assume that\n    // focus has been delegated from one widget to another so\n    // we need to set the new widget reference and trigger a\n    // new focus calculation of Lightning's focuspath\n    if (app.state === 'Widgets') {\n      app.reload(activeWidget)\n    } else {\n      app._setState('Widgets', [activeWidget])\n    }\n  }\n}\n\nexport const handleRemote = (type, name) => {\n  if (type === 'widget') {\n    focusWidget(name)\n  } else if (type === 'page') {\n    restoreFocus()\n  }\n}\n\nexport const restoreFocus = () => {\n  activeWidget = null\n  app._setState('')\n}\n\nexport const getActiveWidget = () => {\n  return activeWidget\n}\n\nexport const setActiveWidget = instance => {\n  activeWidget = instance\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getReferences } from './widgets'\n\nexport const createComponent = (stage, type) => {\n  return stage.c({\n    type,\n    visible: false,\n    widgets: getReferences(),\n  })\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getActiveHash, getActivePage } from './router'\nimport { getOption, getRouteByHash } from './route'\nimport { isFunction, isObject, isArray, isBoolean, symbols } from './helpers'\nimport { getRouterConfig } from './router'\n\n/**\n * Simple flat array that holds the visited hashes + state Object\n * so the router can navigate back to them\n * @type {Array}\n */\nlet history = []\n\nexport const updateHistory = request => {\n  const hash = getActiveHash()\n  if (!hash) {\n    return\n  }\n\n  // navigate storage flag\n  const register = request.register\n  const forceNavigateStore = register.get(symbols.store)\n\n  // test preventStorage on route configuration\n  const activeRoute = getRouteByHash(hash)\n  const preventStorage = getOption(activeRoute.options, 'preventStorage')\n\n  // we give prio to navigate storage flag\n  let store = isBoolean(forceNavigateStore) ? forceNavigateStore : !preventStorage\n\n  if (store) {\n    const toStore = hash.replace(/^\\//, '')\n    const location = locationInHistory(toStore)\n    const stateObject = getStateObject(getActivePage(), request)\n    const routerConfig = getRouterConfig()\n\n    // store hash if it's not a part of history or flag for\n    // storage of same hash is true\n    if (location === -1 || routerConfig.get('storeSameHash')) {\n      history.push({ hash: toStore, state: stateObject })\n    } else {\n      // if we visit the same route we want to sync history\n      const prev = history.splice(location, 1)[0]\n      history.push({ hash: prev.hash, state: stateObject })\n    }\n  }\n}\n\nconst locationInHistory = hash => {\n  for (let i = 0; i < history.length; i++) {\n    if (history[i].hash === hash) {\n      return i\n    }\n  }\n  return -1\n}\n\nexport const getHistoryState = hash => {\n  let state = null\n  if (history.length) {\n    // if no hash is provided we get the last\n    // pushed history record\n    if (!hash) {\n      const record = history[history.length - 1]\n      // could be null\n      state = record.state\n    } else {\n      if (locationInHistory(hash) !== -1) {\n        const record = history[locationInHistory(hash)]\n        state = record.state\n      }\n    }\n  }\n  return state\n}\n\nexport const replaceHistoryState = (state = null, hash) => {\n  if (!history.length) {\n    return\n  }\n  const location = hash ? locationInHistory(hash) : history.length - 1\n  if (location !== -1 && isObject(state)) {\n    history[location].state = state\n  }\n}\n\nconst getStateObject = (page, request) => {\n  // if the new request shared instance with the\n  // previous request we used the copied state object\n  if (request.isSharedInstance) {\n    if (request.copiedHistoryState) {\n      return request.copiedHistoryState\n    }\n  } else if (page && isFunction(page.historyState)) {\n    return page.historyState()\n  }\n  return null\n}\n\nexport const getHistory = () => {\n  return history.slice(0)\n}\n\nexport const setHistory = (arr = []) => {\n  if (isArray(arr)) {\n    history = arr\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Lightning from '../../Lightning'\n\nexport default class ColorShift extends Lightning.shaders.WebGLDefaultShader {\n  set brightness(v) {\n    this._brightness = (v - 50) / 100\n    this.redraw()\n  }\n\n  set contrast(v) {\n    this._contrast = (v + 50) / 100\n    this.redraw()\n  }\n\n  set gamma(v) {\n    this._gamma = (v + 50) / 100\n    this.redraw()\n  }\n\n  setupUniforms(operation) {\n    super.setupUniforms(operation)\n    const gl = this.gl\n    this._setUniform(\n      'colorAdjust',\n      [this._brightness || 0.0, this._contrast || 1.0, this._gamma || 1.0],\n      gl.uniform3fv\n    )\n  }\n}\n\nColorShift.before = `\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n        \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec3 colorAdjust;\n    \n    const mat3 RGBtoOpponentMat = mat3(0.2814, -0.0971, -0.0930, 0.6938, 0.1458,-0.2529, 0.0638, -0.0250, 0.4665);\n    const mat3 OpponentToRGBMat = mat3(1.1677, 0.9014, 0.7214, -6.4315, 2.5970, 0.1257, -0.5044, 0.0159, 2.0517);    \n`\n\nColorShift.after = `    \n    vec3 brightnessContrast(vec3 value, float brightness, float contrast)\n    {\n        return (value - 0.5) * contrast + 0.5 + brightness;\n    }   \n    \n    vec3 updateGamma(vec3 value, float param)\n    {\n        return vec3(pow(abs(value.r), param),pow(abs(value.g), param),pow(abs(value.b), param));\n    } \n       \n    void main(void){\n        vec4 fragColor = texture2D(uSampler, vTextureCoord);        \n        vec4 color = filter(fragColor) * vColor;       \n        \n        vec3 bc = brightnessContrast(color.rgb,colorAdjust[0],colorAdjust[1]);        \n        vec3 ga = updateGamma(bc.rgb, colorAdjust[2]);  \n              \n        gl_FragColor = vec4(ga.rgb, color.a);          \n    }    \n`\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ColorShift from './ColorShift'\n\nexport default class ProtanopiaShader extends ColorShift {}\n\nProtanopiaShader.fragmentShaderSource = `\n    ${ColorShift.before}    \n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.20,  0.99, -0.19, 0.0);\n        vec4 g = vec4( 0.16,  0.79,  0.04, 0.0);\n        vec4 b = vec4( 0.01, -0.01,  1.00, 0.0);\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }\n    \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= opponentColor.y * 1.5; \n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));      \n    }    \n    ${ColorShift.after} \n`\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ColorShift from './ColorShift'\n\nexport default class DeuteranopiaShader extends ColorShift {}\n\nDeuteranopiaShader.fragmentShaderSource = `\n    ${ColorShift.before}\n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.43,  0.72, -0.15, 0.0 );\n        vec4 g = vec4( 0.34,  0.57,  0.09, 0.0 );\n        vec4 b = vec4(-0.02,  0.03,  1.00, 0.0 );\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }\n       \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= opponentColor.y * 1.5; \n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));    \n    }\n    ${ColorShift.after}    \n`\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ColorShift from './ColorShift'\n\nexport default class TritanopiaShader extends ColorShift {}\n\nTritanopiaShader.fragmentShaderSource = `\n    ${ColorShift.before}    \n    vec4 vision(vec4 color)\n    {\n        vec4 r = vec4( 0.97,  0.11, -0.08, 0.0 );\n        vec4 g = vec4( 0.02,  0.82,  0.16, 0.0 );\n        vec4 b = vec4(-0.06,  0.88,  0.18, 0.0 );\n       \n        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);\t\n    }   \n    \n    vec4 filter( vec4 color )\n    {   \n        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);\n        opponentColor.x -= ((3.0 * opponentColor.z) - opponentColor.y) * 0.25;\n        vec3 rgbColor = OpponentToRGBMat * opponentColor;\n        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));\n    }   \n    ${ColorShift.after} \n`\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ColorShift from './ColorShift'\n\nexport default class NeutralShader extends ColorShift {}\n\nNeutralShader.fragmentShaderSource = `\n    ${ColorShift.before}\n    vec4 filter( vec4 color )\n    {\n        return color;\n    }\n    ${ColorShift.after}\n`\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ColorShift from './ColorShift'\n\nexport default class MonochromacyShader extends ColorShift {}\n\nMonochromacyShader.fragmentShaderSource = `\n    ${ColorShift.before}\n    vec4 filter( vec4 color )\n    {   \n        float grey = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n        return vec4(vec3(grey, grey, grey), 1.0 ); \n    }\n    ${ColorShift.after}\n`\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* global SpeechSynthesisErrorEvent */\nfunction flattenStrings(series = []) {\n  const flattenedSeries = []\n\n  for (var i = 0; i < series.length; i++) {\n    if (typeof series[i] === 'string' && !series[i].includes('PAUSE-')) {\n      flattenedSeries.push(series[i])\n    } else {\n      break\n    }\n  }\n  // add a \"word boundary\" to ensure the Announcer doesn't automatically try to\n  // interpret strings that look like dates but are not actually dates\n  // for example, if \"Rising Sun\" and \"1993\" are meant to be two separate lines,\n  // when read together, \"Sun 1993\" is interpretted as \"Sunday 1993\"\n  return [flattenedSeries.join(',\\b ')].concat(series.slice(i))\n}\n\nfunction delay(pause) {\n  return new Promise(resolve => {\n    setTimeout(resolve, pause)\n  })\n}\n\n/**\n * Speak a string\n *\n * @param {string} phrase Phrase to speak\n * @param {SpeechSynthesisUtterance[]} utterances An array which the new SpeechSynthesisUtterance instance representing this utterance will be appended\n * @return {Promise<void>} Promise resolved when the utterance has finished speaking, and rejected if there's an error\n */\nfunction speak(phrase, utterances, lang = 'en-US') {\n  const synth = window.speechSynthesis\n  return new Promise((resolve, reject) => {\n    const utterance = new SpeechSynthesisUtterance(phrase)\n    utterance.lang = lang\n    utterance.onend = () => {\n      resolve()\n    }\n    utterance.onerror = e => {\n      reject(e)\n    }\n    utterances.push(utterance)\n    synth.speak(utterance)\n  })\n}\n\nfunction speakSeries(series, lang, root = true) {\n  const synth = window.speechSynthesis\n  const remainingPhrases = flattenStrings(Array.isArray(series) ? series : [series])\n  const nestedSeriesResults = []\n  /*\n    We hold this array of SpeechSynthesisUtterances in order to prevent them from being\n    garbage collected prematurely on STB hardware which can cause the 'onend' events of\n    utterances to not fire consistently.\n  */\n  const utterances = []\n  let active = true\n\n  const seriesChain = (async () => {\n    try {\n      while (active && remainingPhrases.length) {\n        const phrase = await Promise.resolve(remainingPhrases.shift())\n        if (!active) {\n          // Exit\n          // Need to check this after the await in case it was cancelled in between\n          break\n        } else if (typeof phrase === 'string' && phrase.includes('PAUSE-')) {\n          // Pause it\n          let pause = phrase.split('PAUSE-')[1] * 1000\n          if (isNaN(pause)) {\n            pause = 0\n          }\n          await delay(pause)\n        } else if (typeof phrase === 'string' && phrase.length) {\n          // Speak it\n          const totalRetries = 3\n          let retriesLeft = totalRetries\n          while (active && retriesLeft > 0) {\n            try {\n              await speak(phrase, utterances, lang)\n              retriesLeft = 0\n            } catch (e) {\n              // eslint-disable-next-line no-undef\n              if (e instanceof SpeechSynthesisErrorEvent) {\n                if (e.error === 'network') {\n                  retriesLeft--\n                  console.warn(`Speech synthesis network error. Retries left: ${retriesLeft}`)\n                  await delay(500 * (totalRetries - retriesLeft))\n                } else if (e.error === 'canceled' || e.error === 'interrupted') {\n                  // Cancel or interrupt error (ignore)\n                  retriesLeft = 0\n                } else {\n                  throw new Error(`SpeechSynthesisErrorEvent: ${e.error}`)\n                }\n              } else {\n                throw e\n              }\n            }\n          }\n        } else if (typeof phrase === 'function') {\n          const seriesResult = speakSeries(phrase(), lang, false)\n          nestedSeriesResults.push(seriesResult)\n          await seriesResult.series\n        } else if (Array.isArray(phrase)) {\n          // Speak it (recursively)\n          const seriesResult = speakSeries(phrase, lang, false)\n          nestedSeriesResults.push(seriesResult)\n          await seriesResult.series\n        }\n      }\n    } finally {\n      active = false\n    }\n  })()\n  return {\n    series: seriesChain,\n    get active() {\n      return active\n    },\n    append: toSpeak => {\n      remainingPhrases.push(toSpeak)\n    },\n    cancel: () => {\n      if (!active) {\n        return\n      }\n      if (root) {\n        synth.cancel()\n      }\n      nestedSeriesResults.forEach(nestedSeriesResults => {\n        nestedSeriesResults.cancel()\n      })\n      active = false\n    },\n  }\n}\n\nlet currentSeries\nexport default function(toSpeak, lang) {\n  currentSeries && currentSeries.cancel()\n  currentSeries = speakSeries(toSpeak, lang)\n  return currentSeries\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * Code from: https://github.com/jashkenas/underscore is\n * Copyright (c) 2009-2022 Jeremy Ashkenas, Julian Gonggrijp, and DocumentCloud and Investigative Reporters & Editors\n * Licensed under the MIT License based off:\n * http://unscriptable.com/2009/03/20/debouncing-javascript-methods/ which is:\n * Copyright (c) 2007-2009 unscriptable.com and John M. Hann\n * Licensed under the MIT License (with X11 advertising exception)\n */\n\nexport function getElmName(elm) {\n  return elm.ref || elm.constructor.name\n}\n\n/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear'\n * that is a function which will clear the timer to prevent previously scheduled executions.\n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nexport function debounce(func, wait, immediate) {\n  var timeout, args, context, timestamp, result\n  if (null == wait) wait = 100\n\n  function later() {\n    var last = Date.now() - timestamp\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last)\n    } else {\n      timeout = null\n      if (!immediate) {\n        result = func.apply(context, args)\n        context = args = null\n      }\n    }\n  }\n\n  var debounced = function() {\n    context = this\n    args = arguments\n    timestamp = Date.now()\n    var callNow = immediate && !timeout\n    if (!timeout) timeout = setTimeout(later, wait)\n    if (callNow) {\n      result = func.apply(context, args)\n      context = args = null\n    }\n\n    return result\n  }\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout)\n      timeout = null\n    }\n  }\n\n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args)\n      context = args = null\n\n      clearTimeout(timeout)\n      timeout = null\n    }\n  }\n\n  return debounced\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport SpeechEngine from './Speech.js'\nimport { debounce, getElmName } from './utils.js'\n\nlet resetFocusPathTimer\nlet prevFocusPath = []\nlet currentlySpeaking\nlet voiceOutDisabled = false\nconst fiveMinutes = 300000\n\nfunction onFocusChangeCore(focusPath = []) {\n  if (!Announcer.enabled) {\n    return\n  }\n\n  const loaded = focusPath.every(elm => !elm.loading)\n  const focusDiff = focusPath.filter(elm => !prevFocusPath.includes(elm))\n\n  resetFocusPathTimer()\n\n  if (!loaded) {\n    Announcer.onFocusChange()\n    return\n  }\n\n  prevFocusPath = focusPath.slice(0)\n\n  let toAnnounceText = []\n  let toAnnounce = focusDiff.reduce((acc, elm) => {\n    if (elm.announce) {\n      acc.push([getElmName(elm), 'Announce', elm.announce])\n      toAnnounceText.push(elm.announce)\n    } else if (elm.title) {\n      acc.push([getElmName(elm), 'Title', elm.title])\n      toAnnounceText.push(elm.title)\n    }\n    return acc\n  }, [])\n\n  focusDiff.reverse().reduce((acc, elm) => {\n    if (elm.announceContext) {\n      acc.push([getElmName(elm), 'Context', elm.announceContext])\n      toAnnounceText.push(elm.announceContext)\n    } else {\n      acc.push([getElmName(elm), 'No Context', ''])\n    }\n    return acc\n  }, toAnnounce)\n\n  if (Announcer.debug) {\n    console.table(toAnnounce)\n  }\n\n  if (toAnnounceText.length) {\n    return Announcer.speak(toAnnounceText.reduce((acc, val) => acc.concat(val), []))\n  }\n}\n\nfunction textToSpeech(toSpeak) {\n  if (voiceOutDisabled) {\n    return\n  }\n\n  return (currentlySpeaking = SpeechEngine(toSpeak))\n}\n\nconst Announcer = {\n  enabled: true,\n  debug: false,\n  cancel: function() {\n    currentlySpeaking && currentlySpeaking.cancel()\n  },\n  clearPrevFocus: function(depth = 0) {\n    prevFocusPath = prevFocusPath.slice(0, depth)\n    resetFocusPathTimer()\n  },\n  speak: function(text, { append = false, notification = false } = {}) {\n    if (Announcer.enabled) {\n      Announcer.onFocusChange.flush()\n      if (append && currentlySpeaking && currentlySpeaking.active) {\n        currentlySpeaking.append(text)\n      } else {\n        Announcer.cancel()\n        textToSpeech(text)\n      }\n\n      if (notification) {\n        voiceOutDisabled = true\n        currentlySpeaking.series.finally(() => {\n          voiceOutDisabled = false\n          Announcer.refresh()\n        })\n      }\n    }\n\n    return currentlySpeaking\n  },\n  setupTimers: function({ focusDebounce = 400, focusChangeTimeout = fiveMinutes } = {}) {\n    Announcer.onFocusChange = debounce(onFocusChangeCore, focusDebounce)\n\n    resetFocusPathTimer = debounce(() => {\n      // Reset focus path for full announce\n      prevFocusPath = []\n    }, focusChangeTimeout)\n  },\n}\nAnnouncer.setupTimers()\nexport default Announcer\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport let Log\nexport let Settings\nexport let ApplicationInstance\nexport let Ads\nexport let Lightning\n\nexport const initLightningSdkPlugin = {\n  set log(v) {\n    Log = v\n  },\n  set settings(v) {\n    Settings = v\n  },\n  set ads(v) {\n    Ads = v\n  },\n  set lightning(v) {\n    Lightning = v\n  },\n  set appInstance(v) {\n    ApplicationInstance = v\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Log } from '../LightningSdkPlugins'\n\nexport const initMetrics = config => {\n  sendMetric = config.sendMetric\n}\n\nlet sendMetric = (type, event, params) => {\n  Log.info('Sending metric', type, event, params)\n}\n\n// available metric per category\nconst metrics = {\n  app: ['launch', 'loaded', 'ready', 'close'],\n  page: ['view', 'leave'],\n  user: ['click', 'input'],\n  media: [\n    'abort',\n    'canplay',\n    'ended',\n    'pause',\n    'play',\n    // with some videos there occur almost constant suspend events ... should investigate\n    // 'suspend',\n    'volumechange',\n    'waiting',\n    'seeking',\n    'seeked',\n  ],\n}\n\n// error metric function (added to each category)\nconst errorMetric = (type, message, code, visible, params = {}) => {\n  params = { params, ...{ message, code, visible } }\n  sendMetric(type, 'error', params)\n}\n\nconst Metric = (type, events, options = {}) => {\n  return events.reduce(\n    (obj, event) => {\n      obj[event] = (name, params = {}) => {\n        params = { ...options, ...(name ? { name } : {}), ...params }\n        sendMetric(type, event, params)\n      }\n      return obj\n    },\n    {\n      error(message, code, params) {\n        errorMetric(type, message, code, params)\n      },\n      event(name, params) {\n        sendMetric(type, name, params)\n      },\n    }\n  )\n}\n\nconst Metrics = types => {\n  return Object.keys(types).reduce(\n    (obj, type) => {\n      // media metric works a bit different!\n      // it's a function that accepts a url and returns an object with the available metrics\n      // url is automatically passed as a param in every metric\n      type === 'media'\n        ? (obj[type] = url => Metric(type, types[type], { url }))\n        : (obj[type] = Metric(type, types[type]))\n      return obj\n    },\n    { error: errorMetric, event: sendMetric }\n  )\n}\n\nexport default Metrics(metrics)\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Settings } from '../LightningSdkPlugins'\n\nconst defaultChannels = [\n  {\n    number: 1,\n    name: 'Metro News 1',\n    description: 'New York Cable News Channel',\n    entitled: true,\n    program: {\n      title: 'The Morning Show',\n      description: \"New York's best morning show\",\n      startTime: new Date(new Date() - 60 * 5 * 1000).toUTCString(), // started 5 minutes ago\n      duration: 60 * 30, // 30 minutes\n      ageRating: 0,\n    },\n  },\n  {\n    number: 2,\n    name: 'MTV',\n    description: 'Music Television',\n    entitled: true,\n    program: {\n      title: 'Beavis and Butthead',\n      description: 'American adult animated sitcom created by Mike Judge',\n      startTime: new Date(new Date() - 60 * 20 * 1000).toUTCString(), // started 20 minutes ago\n      duration: 60 * 45, // 45 minutes\n      ageRating: 18,\n    },\n  },\n  {\n    number: 3,\n    name: 'NBC',\n    description: 'NBC TV Network',\n    entitled: false,\n    program: {\n      title: 'The Tonight Show Starring Jimmy Fallon',\n      description: 'Late-night talk show hosted by Jimmy Fallon on NBC',\n      startTime: new Date(new Date() - 60 * 10 * 1000).toUTCString(), // started 10 minutes ago\n      duration: 60 * 60, // 1 hour\n      ageRating: 10,\n    },\n  },\n]\n\nexport const channels = () => Settings.get('platform', 'tv', defaultChannels)\n\nexport const randomChannel = () => channels()[~~(channels.length * Math.random())]\n","export default (method, args = null, context = null) => {\n  let result\n  if (method && typeof method === 'function') {\n    try {\n      result = method.apply(context, args)\n    } catch (e) {\n      result = e\n    }\n  } else {\n    result = method\n  }\n\n  // if it looks like a duck .. ehm ... promise and talks like a promise, let's assume it's a promise\n  if (\n    result !== null &&\n    typeof result === 'object' &&\n    result.then &&\n    typeof result.then === 'function'\n  ) {\n    return result\n  }\n  // otherwise make it into a promise\n  else {\n    return new Promise((resolve, reject) => {\n      if (result instanceof Error) {\n        reject(result)\n      } else {\n        resolve(result)\n      }\n    })\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default {\n  abort: 'Abort',\n  canplay: 'CanPlay',\n  canplaythrough: 'CanPlayThrough',\n  durationchange: 'DurationChange',\n  emptied: 'Emptied',\n  encrypted: 'Encrypted',\n  ended: 'Ended',\n  error: 'Error',\n  interruptbegin: 'InterruptBegin',\n  interruptend: 'InterruptEnd',\n  loadeddata: 'LoadedData',\n  loadedmetadata: 'LoadedMetadata',\n  loadstart: 'LoadStart',\n  pause: 'Pause',\n  play: 'Play',\n  playing: 'Playing',\n  progress: 'Progress',\n  ratechange: 'Ratechange',\n  seeked: 'Seeked',\n  seeking: 'Seeking',\n  stalled: 'Stalled',\n  // suspend: 'Suspend', // this one is called a looooot for some videos\n  timeupdate: 'TimeUpdate',\n  volumechange: 'VolumeChange',\n  waiting: 'Waiting',\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default (sourceObject, setup = () => {}) => {\n  let ready = false\n\n  const doSetup = () => {\n    if (ready === false) {\n      setup()\n      ready = true\n    }\n  }\n\n  return Object.keys(sourceObject).reduce((obj, key) => {\n    if (typeof sourceObject[key] === 'function') {\n      obj[key] = function() {\n        doSetup()\n        return sourceObject[key].apply(sourceObject, arguments)\n      }\n    } else if (typeof Object.getOwnPropertyDescriptor(sourceObject, key).get === 'function') {\n      obj.__defineGetter__(key, function() {\n        doSetup()\n        return Object.getOwnPropertyDescriptor(sourceObject, key).get.apply(sourceObject)\n      })\n    } else if (typeof Object.getOwnPropertyDescriptor(sourceObject, key).set === 'function') {\n      obj.__defineSetter__(key, function() {\n        doSetup()\n        return Object.getOwnPropertyDescriptor(sourceObject, key).set.sourceObject[key].apply(\n          sourceObject,\n          arguments\n        )\n      })\n    } else {\n      obj[key] = sourceObject[key]\n    }\n    return obj\n  }, {})\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nlet timeout = null\n\nexport default (cb, delay) => {\n  clearTimeout(timeout)\n  timeout = setTimeout(() => {\n    cb()\n  }, delay)\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Log, Lightning } from '../LightningSdkPlugins'\n\nexport default () => {\n  return class VideoTexture extends Lightning.Component {\n    static _template() {\n      return {\n        Video: {\n          alpha: 1,\n          visible: false,\n          pivot: 0.5,\n          texture: { type: Lightning.textures.StaticTexture, options: {} },\n        },\n      }\n    }\n\n    set videoEl(v) {\n      this._videoEl = v\n    }\n\n    get videoEl() {\n      return this._videoEl\n    }\n\n    get videoView() {\n      return this.tag('Video')\n    }\n\n    get videoTexture() {\n      return this.videoView.texture\n    }\n\n    get isVisible() {\n      return this.videoView.alpha === 1 && this.videoView.visible === true\n    }\n\n    _init() {\n      this._createVideoTexture()\n    }\n\n    _createVideoTexture() {\n      const stage = this.stage\n\n      const gl = stage.gl\n      const glTexture = gl.createTexture()\n      gl.bindTexture(gl.TEXTURE_2D, glTexture)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n      this.videoTexture.options = {\n        source: glTexture,\n        w: this.videoEl.width,\n        h: this.videoEl.height,\n      }\n\n      this.videoView.w = this.videoEl.width / this.stage.getRenderPrecision()\n      this.videoView.h = this.videoEl.height / this.stage.getRenderPrecision()\n    }\n\n    start() {\n      const stage = this.stage\n      this._lastTime = 0\n      if (!this._updateVideoTexture) {\n        this._updateVideoTexture = () => {\n          if (this.videoTexture.options.source && this.videoEl.videoWidth && this.active) {\n            const gl = stage.gl\n\n            const currentTime = new Date().getTime()\n            const getVideoPlaybackQuality = this.videoEl.getVideoPlaybackQuality()\n\n            // When BR2_PACKAGE_GST1_PLUGINS_BAD_PLUGIN_DEBUGUTILS is not set in WPE, webkitDecodedFrameCount will not be available.\n            // We'll fallback to fixed 30fps in this case.\n            // As 'webkitDecodedFrameCount' is about to deprecate, check for the 'totalVideoFrames'\n            const frameCount = getVideoPlaybackQuality\n              ? getVideoPlaybackQuality.totalVideoFrames\n              : this.videoEl.webkitDecodedFrameCount\n\n            const mustUpdate = frameCount\n              ? this._lastFrame !== frameCount\n              : this._lastTime < currentTime - 30\n\n            if (mustUpdate) {\n              this._lastTime = currentTime\n              this._lastFrame = frameCount\n              try {\n                gl.bindTexture(gl.TEXTURE_2D, this.videoTexture.options.source)\n                gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false)\n                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.videoEl)\n                this._lastFrame = this.videoEl.webkitDecodedFrameCount\n                this.videoView.visible = true\n\n                this.videoTexture.options.w = this.videoEl.width\n                this.videoTexture.options.h = this.videoEl.height\n                const expectedAspectRatio = this.videoView.w / this.videoView.h\n                const realAspectRatio = this.videoEl.width / this.videoEl.height\n\n                if (expectedAspectRatio > realAspectRatio) {\n                  this.videoView.scaleX = realAspectRatio / expectedAspectRatio\n                  this.videoView.scaleY = 1\n                } else {\n                  this.videoView.scaleY = expectedAspectRatio / realAspectRatio\n                  this.videoView.scaleX = 1\n                }\n              } catch (e) {\n                Log.error('texImage2d video', e)\n                this.stop()\n              }\n              this.videoTexture.source.forceRenderUpdate()\n            }\n          }\n        }\n      }\n      if (!this._updatingVideoTexture) {\n        stage.on('frameStart', this._updateVideoTexture)\n        this._updatingVideoTexture = true\n      }\n    }\n\n    stop() {\n      const stage = this.stage\n      stage.removeListener('frameStart', this._updateVideoTexture)\n      this._updatingVideoTexture = false\n      this.videoView.visible = false\n\n      if (this.videoTexture.options.source) {\n        const gl = stage.gl\n        gl.bindTexture(gl.TEXTURE_2D, this.videoTexture.options.source)\n        gl.clearColor(0, 0, 0, 1)\n        gl.clear(gl.COLOR_BUFFER_BIT)\n      }\n    }\n\n    position(top, left) {\n      this.videoView.patch({\n        x: left,\n        y: top,\n      })\n    }\n\n    size(width, height) {\n      this.videoView.patch({\n        w: width,\n        h: height,\n      })\n    }\n\n    show() {\n      this.videoView.alpha = 1\n    }\n\n    hide() {\n      this.videoView.alpha = 0\n    }\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport executeAsPromise from '@michieljs/execute-as-promise'\n\nimport Metrics from '../Metrics'\nimport { Log, Ads, Settings, ApplicationInstance } from '../LightningSdkPlugins'\n\nimport events from './events'\nimport autoSetupMixin from '../helpers/autoSetupMixin'\nimport easeExecution from '../helpers/easeExecution'\nimport VideoTexture from './VideoTexture'\n\nexport let mediaUrl = url => url\nlet videoEl\nlet videoTexture\nlet metrics\nlet consumer\nlet precision = 1\nlet textureMode = false\n\nexport const initVideoPlayer = config => {\n  if (config.mediaUrl) {\n    mediaUrl = config.mediaUrl\n  }\n}\n// todo: add this in a 'Registry' plugin\n// to be able to always clean this up on app close\nlet eventHandlers = {}\n\nconst state = {\n  adsEnabled: false,\n  playing: false,\n  _playingAds: false,\n  get playingAds() {\n    return this._playingAds\n  },\n  set playingAds(val) {\n    if (this._playingAds !== val) {\n      this._playingAds = val\n      fireOnConsumer(val === true ? 'AdStart' : 'AdEnd')\n    }\n  },\n  skipTime: false,\n  playAfterSeek: null,\n}\n\nconst hooks = {\n  play() {\n    state.playing = true\n  },\n  pause() {\n    state.playing = false\n  },\n  seeked() {\n    state.playAfterSeek === true && videoPlayerPlugin.play()\n    state.playAfterSeek = null\n  },\n  abort() {\n    deregisterEventListeners()\n  },\n}\n\nconst withPrecision = val => Math.round(precision * val) + 'px'\n\nconst fireOnConsumer = (event, args) => {\n  if (consumer) {\n    consumer.fire('$videoPlayer' + event, args, videoEl.currentTime)\n    consumer.fire('$videoPlayerEvent', event, args, videoEl.currentTime)\n  }\n}\n\nconst fireHook = (event, args) => {\n  hooks[event] && typeof hooks[event] === 'function' && hooks[event].call(null, event, args)\n}\n\nlet customLoader = null\nlet customUnloader = null\n\nconst loader = (url, videoEl, config) => {\n  return customLoader && typeof customLoader === 'function'\n    ? customLoader(url, videoEl, config)\n    : new Promise(resolve => {\n        url = mediaUrl(url)\n        videoEl.setAttribute('src', url)\n        videoEl.load()\n        resolve()\n      })\n}\n\nconst unloader = videoEl => {\n  return customUnloader && typeof customUnloader === 'function'\n    ? customUnloader(videoEl)\n    : new Promise(resolve => {\n        videoEl.removeAttribute('src')\n        videoEl.load()\n        resolve()\n      })\n}\n\nexport const setupVideoTag = () => {\n  const videoEls = document.getElementsByTagName('video')\n  if (videoEls && videoEls.length) {\n    return videoEls[0]\n  } else {\n    const videoEl = document.createElement('video')\n    const platformSettingsWidth = Settings.get('platform', 'width')\n      ? Settings.get('platform', 'width')\n      : 1920\n    const platformSettingsHeight = Settings.get('platform', 'height')\n      ? Settings.get('platform', 'height')\n      : 1080\n    videoEl.setAttribute('id', 'video-player')\n    videoEl.setAttribute('width', withPrecision(platformSettingsWidth))\n    videoEl.setAttribute('height', withPrecision(platformSettingsHeight))\n    videoEl.style.position = 'absolute'\n    videoEl.style.zIndex = '1'\n    videoEl.style.display = 'none'\n    videoEl.style.visibility = 'hidden'\n    videoEl.style.top = withPrecision(0)\n    videoEl.style.left = withPrecision(0)\n    videoEl.style.width = withPrecision(platformSettingsWidth)\n    videoEl.style.height = withPrecision(platformSettingsHeight)\n    document.body.appendChild(videoEl)\n    return videoEl\n  }\n}\n\nexport const setUpVideoTexture = () => {\n  if (!ApplicationInstance.tag('VideoTexture')) {\n    const el = ApplicationInstance.stage.c({\n      type: VideoTexture(),\n      ref: 'VideoTexture',\n      zIndex: 0,\n      videoEl,\n    })\n    ApplicationInstance.childList.addAt(el, 0)\n  }\n  return ApplicationInstance.tag('VideoTexture')\n}\n\nconst registerEventListeners = () => {\n  Log.info('VideoPlayer', 'Registering event listeners')\n  Object.keys(events).forEach(event => {\n    const handler = e => {\n      // Fire a metric for each event (if it exists on the metrics object)\n      if (metrics && metrics[event] && typeof metrics[event] === 'function') {\n        metrics[event]({ currentTime: videoEl.currentTime })\n      }\n      // fire an internal hook\n      fireHook(event, { videoElement: videoEl, event: e })\n\n      // fire the event (with human friendly event name) to the consumer of the VideoPlayer\n      fireOnConsumer(events[event], { videoElement: videoEl, event: e })\n    }\n\n    eventHandlers[event] = handler\n    videoEl.addEventListener(event, handler)\n  })\n}\n\nconst deregisterEventListeners = () => {\n  Log.info('VideoPlayer', 'Deregistering event listeners')\n  Object.keys(eventHandlers).forEach(event => {\n    videoEl.removeEventListener(event, eventHandlers[event])\n  })\n  eventHandlers = {}\n}\n\nconst videoPlayerPlugin = {\n  consumer(component) {\n    consumer = component\n  },\n\n  loader(loaderFn) {\n    customLoader = loaderFn\n  },\n\n  unloader(unloaderFn) {\n    customUnloader = unloaderFn\n  },\n\n  position(top = 0, left = 0) {\n    videoEl.style.left = withPrecision(left)\n    videoEl.style.top = withPrecision(top)\n    if (textureMode === true) {\n      videoTexture.position(top, left)\n    }\n  },\n\n  size(width = 1920, height = 1080) {\n    videoEl.style.width = withPrecision(width)\n    videoEl.style.height = withPrecision(height)\n    videoEl.width = parseFloat(videoEl.style.width)\n    videoEl.height = parseFloat(videoEl.style.height)\n    if (textureMode === true) {\n      videoTexture.size(width, height)\n    }\n  },\n\n  area(top = 0, right = 1920, bottom = 1080, left = 0) {\n    this.position(top, left)\n    this.size(right - left, bottom - top)\n  },\n\n  open(url, config = {}) {\n    if (!this.canInteract) return\n    metrics = Metrics.media(url)\n\n    this.hide()\n    deregisterEventListeners()\n\n    if (this.src == url) {\n      this.clear().then(this.open(url, config))\n    } else {\n      const adConfig = { enabled: state.adsEnabled, duration: 300 }\n      if (config.videoId) {\n        adConfig.caid = config.videoId\n      }\n      Ads.get(adConfig, consumer).then(ads => {\n        state.playingAds = true\n        ads.prerolls().then(() => {\n          state.playingAds = false\n          loader(url, videoEl, config)\n            .then(() => {\n              registerEventListeners()\n              this.show()\n              this.play()\n            })\n            .catch(e => {\n              fireOnConsumer('Error', { videoElement: videoEl, event: e })\n        \n              // This is not API-compliant, as it results in firing \"$videoPlayererror\" rather than \"$videoPlayerError\".\n              // See docs here for API-compliant events -> https://github.com/Metrological/metrological-sdk/blob/master/docs/plugins/videoplayer.md#event-overview\n              // It has been kept for backwards compatability for library consumers who may have already written handler functions to match it.\n              fireOnConsumer('error', { videoElement: videoEl, event: e })\n            })\n        })\n      })\n    }\n  },\n\n  reload() {\n    if (!this.canInteract) return\n    const url = videoEl.getAttribute('src')\n    this.close()\n    this.open(url)\n  },\n\n  close() {\n    Ads.cancel()\n    if (state.playingAds) {\n      state.playingAds = false\n      Ads.stop()\n      // call self in next tick\n      setTimeout(() => {\n        this.close()\n      })\n    }\n    if (!this.canInteract) return\n    this.clear()\n    this.hide()\n    deregisterEventListeners()\n  },\n\n  clear() {\n    if (!this.canInteract) return\n    // pause the video first to disable sound\n    this.pause()\n    if (textureMode === true) videoTexture.stop()\n    return unloader(videoEl).then(() => {\n      fireOnConsumer('Clear', { videoElement: videoEl })\n    })\n  },\n\n  play() {\n    if (!this.canInteract) return\n    if (textureMode === true) videoTexture.start()\n    executeAsPromise(videoEl.play, null, videoEl).catch(e => {\n      fireOnConsumer('Error', { videoElement: videoEl, event: e })\n\n      // This is not API-compliant, as it results in firing \"$videoPlayererror\" rather than \"$videoPlayerError\".\n      // See docs here for API-compliant events -> https://github.com/Metrological/metrological-sdk/blob/master/docs/plugins/videoplayer.md#event-overview\n      // It has been kept for backwards compatability for library consumers who may have already written handler functions to match it.\n      fireOnConsumer('error', { videoElement: videoEl, event: e })\n    })\n  },\n\n  pause() {\n    if (!this.canInteract) return\n    videoEl.pause()\n  },\n\n  playPause() {\n    if (!this.canInteract) return\n    this.playing === true ? this.pause() : this.play()\n  },\n\n  mute(muted = true) {\n    if (!this.canInteract) return\n    videoEl.muted = muted\n  },\n\n  loop(looped = true) {\n    videoEl.loop = looped\n  },\n\n  seek(time) {\n    if (!this.canInteract) return\n    if (!this.src) return\n    // define whether should continue to play after seek is complete (in seeked hook)\n    if (state.playAfterSeek === null) {\n      state.playAfterSeek = !!state.playing\n    }\n    // pause before actually seeking\n    this.pause()\n    // currentTime always between 0 and the duration of the video (minus 0.1s to not set to the final frame and stall the video)\n    videoEl.currentTime = Math.max(0, Math.min(time, this.duration - 0.1))\n  },\n\n  skip(seconds) {\n    if (!this.canInteract) return\n    if (!this.src) return\n\n    state.skipTime = (state.skipTime || videoEl.currentTime) + seconds\n    easeExecution(() => {\n      this.seek(state.skipTime)\n      state.skipTime = false\n    }, 300)\n  },\n\n  show() {\n    if (!this.canInteract) return\n    if (textureMode === true) {\n      videoTexture.show()\n    } else {\n      videoEl.style.display = 'block'\n      videoEl.style.visibility = 'visible'\n    }\n  },\n\n  hide() {\n    if (!this.canInteract) return\n    if (textureMode === true) {\n      videoTexture.hide()\n    } else {\n      videoEl.style.display = 'none'\n      videoEl.style.visibility = 'hidden'\n    }\n  },\n\n  enableAds(enabled = true) {\n    state.adsEnabled = enabled\n  },\n\n  /* Public getters */\n  get duration() {\n    return videoEl && (isNaN(videoEl.duration) ? Infinity : videoEl.duration)\n  },\n\n  get currentTime() {\n    return videoEl && videoEl.currentTime\n  },\n\n  get muted() {\n    return videoEl && videoEl.muted\n  },\n\n  get looped() {\n    return videoEl && videoEl.loop\n  },\n\n  get src() {\n    return videoEl && videoEl.getAttribute('src')\n  },\n\n  get playing() {\n    return state.playing\n  },\n\n  get playingAds() {\n    return state.playingAds\n  },\n\n  get canInteract() {\n    // todo: perhaps add an extra flag wether we allow interactions (i.e. pauze, mute, etc.) during ad playback\n    return state.playingAds === false\n  },\n\n  get top() {\n    return videoEl && parseFloat(videoEl.style.top)\n  },\n\n  get left() {\n    return videoEl && parseFloat(videoEl.style.left)\n  },\n\n  get bottom() {\n    return videoEl && parseFloat(videoEl.style.top - videoEl.style.height)\n  },\n\n  get right() {\n    return videoEl && parseFloat(videoEl.style.left - videoEl.style.width)\n  },\n\n  get width() {\n    return videoEl && parseFloat(videoEl.style.width)\n  },\n\n  get height() {\n    return videoEl && parseFloat(videoEl.style.height)\n  },\n\n  get visible() {\n    if (textureMode === true) {\n      return videoTexture.isVisible\n    } else {\n      return videoEl && videoEl.style.display === 'block'\n    }\n  },\n\n  get adsEnabled() {\n    return state.adsEnabled\n  },\n\n  // prefixed with underscore to indicate 'semi-private'\n  // because it's not recommended to interact directly with the video element\n  get _videoEl() {\n    return videoEl\n  },\n\n  get _consumer() {\n    return consumer\n  },\n}\n\nexport default autoSetupMixin(videoPlayerPlugin, () => {\n  precision =\n    (ApplicationInstance && ApplicationInstance.stage && ApplicationInstance.stage.getRenderPrecision()) || precision\n\n  videoEl = setupVideoTag()\n\n  textureMode = Settings.get('platform', 'textureMode', false)\n  if (textureMode === true) {\n    videoEl.setAttribute('crossorigin', 'anonymous')\n    videoTexture = setUpVideoTexture()\n  }\n})\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Lightning from '../Lightning'\n\nexport default class VersionLabel extends Lightning.Component {\n  static _template() {\n    return {\n      rect: true,\n      color: 0xbb0078ac,\n      h: 40,\n      w: 100,\n      x: w => w - 50,\n      y: h => h - 50,\n      mount: 1,\n      Text: {\n        w: w => w,\n        h: h => h,\n        y: 5,\n        x: 20,\n        text: {\n          fontSize: 22,\n          lineHeight: 26,\n        },\n      },\n    }\n  }\n\n  _firstActive() {\n    this.tag('Text').text = `APP - v${this.version}\\nSDK - v${this.sdkVersion}`\n    this.tag('Text').loadTexture()\n    this.w = this.tag('Text').renderWidth + 40\n    this.h = this.tag('Text').renderHeight + 5\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Lightning from '../Lightning'\nimport Settings from '../Settings'\nimport Log from '../Log'\nexport default class FpsIndicator extends Lightning.Component {\n  static _template() {\n    return {\n      rect: true,\n      color: 0xffffffff,\n      texture: Lightning.Tools.getRoundRect(80, 80, 40),\n      h: 80,\n      w: 80,\n      x: 100,\n      y: 100,\n      mount: 1,\n      Background: {\n        x: 3,\n        y: 3,\n        texture: Lightning.Tools.getRoundRect(72, 72, 36),\n        color: 0xff008000,\n      },\n      Counter: {\n        w: w => w,\n        h: h => h,\n        y: 10,\n        text: {\n          fontSize: 32,\n          textAlign: 'center',\n        },\n      },\n      Text: {\n        w: w => w,\n        h: h => h,\n        y: 48,\n        text: {\n          fontSize: 15,\n          textAlign: 'center',\n          text: 'FPS',\n        },\n      },\n    }\n  }\n\n  _setup() {\n    this.config = {\n      ...{\n        log: false,\n        interval: 500,\n        threshold: 1,\n      },\n      ...Settings.get('platform', 'showFps'),\n    }\n\n    this.fps = 0\n    this.lastFps = this.fps - this.config.threshold\n\n    const fpsCalculator = () => {\n      this.fps = ~~(1 / this.stage.dt)\n    }\n    this.stage.on('frameStart', fpsCalculator)\n    this.stage.off('framestart', fpsCalculator)\n    this.interval = setInterval(this.showFps.bind(this), this.config.interval)\n  }\n\n  _firstActive() {\n    this.showFps()\n  }\n\n  _detach() {\n    clearInterval(this.interval)\n  }\n\n  showFps() {\n    if (Math.abs(this.lastFps - this.fps) <= this.config.threshold) return\n    this.lastFps = this.fps\n    // green\n    let bgColor = 0xff008000\n    // orange\n    if (this.fps <= 40 && this.fps > 20) bgColor = 0xffffa500\n    // red\n    else if (this.fps <= 20) bgColor = 0xffff0000\n\n    this.tag('Background').setSmooth('color', bgColor)\n    this.tag('Counter').text = `${this.fps}`\n\n    this.config.log && Log.info('FPS', this.fps)\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Log from '../Log'\n\nconst registry = {\n  eventListeners: [],\n  timeouts: [],\n  intervals: [],\n  targets: [],\n}\n\nexport default {\n  // Timeouts\n  setTimeout(cb, timeout, ...params) {\n    const timeoutId = setTimeout(\n      () => {\n        registry.timeouts = registry.timeouts.filter(id => id !== timeoutId)\n        cb.apply(null, params)\n      },\n      timeout,\n      params\n    )\n    Log.info('Set Timeout', 'ID: ' + timeoutId)\n    registry.timeouts.push(timeoutId)\n    return timeoutId\n  },\n\n  clearTimeout(timeoutId) {\n    if (registry.timeouts.indexOf(timeoutId) > -1) {\n      registry.timeouts = registry.timeouts.filter(id => id !== timeoutId)\n      Log.info('Clear Timeout', 'ID: ' + timeoutId)\n      clearTimeout(timeoutId)\n    } else {\n      Log.error('Clear Timeout', 'ID ' + timeoutId + ' not found')\n    }\n  },\n\n  clearTimeouts() {\n    registry.timeouts.forEach(timeoutId => {\n      this.clearTimeout(timeoutId)\n    })\n  },\n\n  // Intervals\n  setInterval(cb, interval, ...params) {\n    const intervalId = setInterval(\n      () => {\n        registry.intervals.filter(id => id !== intervalId)\n        cb.apply(null, params)\n      },\n      interval,\n      params\n    )\n    Log.info('Set Interval', 'ID: ' + intervalId)\n    registry.intervals.push(intervalId)\n    return intervalId\n  },\n\n  clearInterval(intervalId) {\n    if (registry.intervals.indexOf(intervalId) > -1) {\n      registry.intervals = registry.intervals.filter(id => id !== intervalId)\n      Log.info('Clear Interval', 'ID: ' + intervalId)\n      clearInterval(intervalId)\n    } else {\n      Log.error('Clear Interval', 'ID ' + intervalId + ' not found')\n    }\n  },\n\n  clearIntervals() {\n    registry.intervals.forEach(intervalId => {\n      this.clearInterval(intervalId)\n    })\n  },\n\n  // Event listeners\n  addEventListener(target, event, handler) {\n    target.addEventListener(event, handler)\n    const targetIndex =\n      registry.targets.indexOf(target) > -1\n        ? registry.targets.indexOf(target)\n        : registry.targets.push(target) - 1\n\n    registry.eventListeners[targetIndex] = registry.eventListeners[targetIndex] || {}\n    registry.eventListeners[targetIndex][event] = registry.eventListeners[targetIndex][event] || []\n    registry.eventListeners[targetIndex][event].push(handler)\n    Log.info(\n      'Add eventListener',\n      'Target:',\n      target,\n      'Event: ' + event,\n      'Handler:',\n      handler.toString()\n    )\n  },\n\n  removeEventListener(target, event, handler) {\n    const targetIndex = registry.targets.indexOf(target)\n    if (\n      targetIndex > -1 &&\n      registry.eventListeners[targetIndex] &&\n      registry.eventListeners[targetIndex][event] &&\n      registry.eventListeners[targetIndex][event].indexOf(handler) > -1\n    ) {\n      registry.eventListeners[targetIndex][event] = registry.eventListeners[targetIndex][\n        event\n      ].filter(fn => fn !== handler)\n      Log.info(\n        'Remove eventListener',\n        'Target:',\n        target,\n        'Event: ' + event,\n        'Handler:',\n        handler.toString()\n      )\n      target.removeEventListener(event, handler)\n      // remove key from event listeners object when no events are registered for that event\n      Object.keys(registry.eventListeners[targetIndex]).forEach(event => {\n        if (registry.eventListeners[targetIndex][event].length === 0) {\n          delete registry.eventListeners[targetIndex][event]\n        }\n      })\n      // remove reference to the target when target has no event listeners registered\n      if (Object.keys(registry.eventListeners[targetIndex]).length === 0) {\n        registry.targets.splice(targetIndex, 1)\n        registry.eventListeners.splice(targetIndex, 1)\n      }\n    } else {\n      Log.error(\n        'Remove eventListener',\n        'Not found',\n        'Target',\n        target,\n        'Event: ' + event,\n        'Handler',\n        handler.toString()\n      )\n    }\n  },\n\n  // if `event` is omitted, removes all registered event listeners for target\n  // if `target` is also omitted, removes all registered event listeners\n  removeEventListeners(target, event) {\n    if (target && event) {\n      const targetIndex = registry.targets.indexOf(target)\n      if (targetIndex > -1) {\n        registry.eventListeners[targetIndex][event].forEach(handler => {\n          this.removeEventListener(target, event, handler)\n        })\n      }\n    } else if (target) {\n      const targetIndex = registry.targets.indexOf(target)\n      if (targetIndex > -1) {\n        Object.keys(registry.eventListeners[targetIndex]).forEach(_event => {\n          this.removeEventListeners(target, _event)\n        })\n      }\n    } else {\n      Object.keys(registry.eventListeners).forEach(targetIndex => {\n        this.removeEventListeners(registry.targets[targetIndex])\n      })\n    }\n  },\n\n  // Clear everything (to be called upon app close for proper cleanup)\n  clear() {\n    this.clearTimeouts()\n    this.clearIntervals()\n    this.removeEventListeners()\n    registry.eventListeners = []\n    registry.timeouts = []\n    registry.intervals = []\n    registry.targets = []\n  },\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Accessibility from '../Accessibility'\nimport Deepmerge from 'deepmerge'\nimport { isPlainObject } from 'is-plain-object'\nimport Lightning from '../Lightning'\nimport Locale from '../Locale'\nimport Metrics from '../Metrics'\nimport VersionLabel from '../VersionLabel'\nimport FpsCounter from '../FpsCounter'\nimport Log from '../Log'\nimport Settings from '../Settings'\nimport { initLanguage } from '../Language'\nimport Utils from '../Utils'\nimport Registry from '../Registry'\nimport { initColors } from '../Colors'\n\nimport packageInfo from '../../package.json'\n\nexport let AppInstance\nexport let AppData\n\nconst defaultOptions = {\n  stage: { w: 1920, h: 1080, precision: 1, clearColor: 0x00000000, canvas2d: false },\n  debug: false,\n  defaultFontFace: 'RobotoRegular',\n  keys: {\n    8: 'Back',\n    13: 'Enter',\n    27: 'Menu',\n    37: 'Left',\n    38: 'Up',\n    39: 'Right',\n    40: 'Down',\n    174: 'ChannelDown',\n    175: 'ChannelUp',\n    178: 'Stop',\n    250: 'PlayPause',\n    191: 'Search', // Use \"/\" for keyboard\n    409: 'Search',\n  },\n}\n\nconst customFontFaces = []\n\nconst fontLoader = (fonts, store) =>\n  new Promise((resolve, reject) => {\n    fonts\n      .map(({ family, url, urls, descriptors }) => () => {\n        const src = urls\n          ? urls.map(url => {\n              return 'url(' + url + ')'\n            })\n          : 'url(' + url + ')'\n        const fontFace = new FontFace(family, src, descriptors || {})\n        store.push(fontFace)\n        Log.info('Loading font', family)\n        document.fonts.add(fontFace)\n        return fontFace.load()\n      })\n      .reduce((promise, method) => {\n        return promise.then(() => method())\n      }, Promise.resolve(null))\n      .then(resolve)\n      .catch(reject)\n  })\n\nexport default function(App, appData, platformSettings) {\n  const { width, height } = platformSettings\n\n  if (width && height) {\n    defaultOptions.stage['w'] = width\n    defaultOptions.stage['h'] = height\n    defaultOptions.stage['precision'] = width / 1920\n  }\n\n  // support for 720p browser\n  if (!width && !height && window.innerHeight === 720) {\n    defaultOptions.stage['w'] = 1280\n    defaultOptions.stage['h'] = 720\n    defaultOptions.stage['precision'] = 1280 / 1920\n  }\n\n  return class Application extends Lightning.Application {\n    constructor(options) {\n      const config = Deepmerge(defaultOptions, options, {\n        isMergeableObject: isPlainObject\n      })\n\n      super(config)\n      this.config = config\n    }\n\n    static _template() {\n      return {\n        w: 1920,\n        h: 1080,\n      }\n    }\n\n    colorshift(type = false, config = {}) {\n      Accessibility.colorshift(this, type, config)\n    }\n\n    get keymapping() {\n      return this.stage.application.config.keys\n    }\n\n    /**\n     * This function overrides the default keymap with the latest keymap.\n     * @param customKeyMap\n     * @param keepDuplicates\n     */\n    overrideKeyMap(customKeyMap, keepDuplicates = false) {\n      const baseKeyMap = this.stage.application.config.keys\n      Object.keys(customKeyMap).reduce((keymapping, key) => {\n        // prevent duplicate values to exist in final keymapping (i.e. 2 keys triggering 'Back')\n        if (!keepDuplicates) {\n          Object.keys(baseKeyMap).forEach(baseKey => {\n            if (baseKey != key && baseKeyMap[baseKey] == customKeyMap[key]) {\n              delete keymapping[baseKey]\n            }\n          })\n        }\n        keymapping[key] = customKeyMap[key]\n        return keymapping\n      }, baseKeyMap)\n      return baseKeyMap\n    }\n\n    _setup() {\n      Promise.all([\n        this.loadFonts((App.config && App.config.fonts) || (App.getFonts && App.getFonts()) || []),\n        // to be deprecated\n        Locale.load((App.config && App.config.locale) || (App.getLocale && App.getLocale())),\n        App.language && this.loadLanguage(App.language()),\n        App.colors && this.loadColors(App.colors()),\n      ])\n        .then(() => {\n          Metrics.app.loaded()\n\n          this.w = this.config.stage.w / this.config.stage.precision\n          this.h = this.config.stage.h / this.config.stage.precision\n\n          AppData = appData\n\n          AppInstance = this.stage.c({\n            ref: 'App',\n            type: App,\n            zIndex: 1,\n            forceZIndexContext: !!platformSettings.showVersion || !!platformSettings.showFps,\n          })\n\n          this.childList.a(AppInstance)\n\n          this._refocus()\n\n          Log.info('App version', this.config.version)\n          Log.info('SDK version', packageInfo.version)\n\n          if (platformSettings.showVersion) {\n            this.childList.a({\n              ref: 'VersionLabel',\n              type: VersionLabel,\n              version: this.config.version,\n              sdkVersion: packageInfo.version,\n              zIndex: 1,\n            })\n          }\n\n          if (platformSettings.showFps) {\n            this.childList.a({\n              ref: 'FpsCounter',\n              type: FpsCounter,\n              zIndex: 1,\n            })\n          }\n\n          super._setup()\n        })\n        .catch(console.error)\n    }\n\n    _handleBack() {\n      this.closeApp()\n    }\n\n    _handleExit() {\n      this.closeApp()\n    }\n\n    closeApp() {\n      Log.info('Signaling App Close')\n\n      if (platformSettings.onClose && typeof platformSettings.onClose === 'function') {\n        platformSettings.onClose(...arguments)\n      } else {\n        this.close()\n      }\n    }\n\n    close() {\n      Log.info('Closing App')\n\n      Settings.clearSubscribers()\n      Registry.clear()\n\n      this.childList.remove(this.tag('App'))\n      this.cleanupFonts()\n      // force texture garbage collect\n      this.stage.gc()\n      this.destroy()\n    }\n\n    loadFonts(fonts) {\n      return platformSettings.fontLoader && typeof platformSettings.fontLoader === 'function'\n        ? platformSettings.fontLoader(fonts, customFontFaces)\n        : fontLoader(fonts, customFontFaces)\n    }\n\n    cleanupFonts() {\n      if ('delete' in document.fonts) {\n        customFontFaces.forEach(fontFace => {\n          Log.info('Removing font', fontFace.family)\n          document.fonts.delete(fontFace)\n        })\n      } else {\n        Log.info('No support for removing manually-added fonts')\n      }\n    }\n\n    loadLanguage(config) {\n      let file = Utils.asset('translations.json')\n      let language = config\n\n      if (typeof language === 'object') {\n        language = config.language || null\n        file = config.file || file\n      }\n\n      return initLanguage(file, language)\n    }\n\n    loadColors(config) {\n      let file = Utils.asset('colors.json')\n      if (config && (typeof config === 'string' || typeof config === 'object')) {\n        file = config\n      }\n      return initColors(file)\n    }\n\n    set focus(v) {\n      this._focussed = v\n      this._refocus()\n    }\n\n    _getFocused() {\n      return this._focussed || this.tag('App')\n    }\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  getConfigMap,\n  isArray,\n  isBoolean,\n  isComponentConstructor,\n  isFunction,\n  isPage,\n  symbols,\n  cleanHash,\n} from './helpers'\nimport { step, navigateQueue } from '../index'\nimport { createRoute, getOption } from './route'\nimport { createComponent } from './components'\nimport Log from '../../Log'\nimport { isWildcard, stripRegex } from './regex'\nimport emit from './emit'\nimport { updateWidgets } from './widgets'\nimport { setHistory, updateHistory } from './history'\nimport { AppInstance } from '../../Application'\n\n/**\n * @type {Lightning.Application}\n */\nexport let application\n\n/**\n * Actual instance of the app\n * @type {Lightning.Component}\n */\nexport let app\n\n/**\n * Component that hosts all routed pages\n * @type {Lightning.Component}\n */\nexport let pagesHost\n\n/**\n * @type {Lightning.Stage}\n */\nexport let stage\n\n/**\n * Platform driven Router configuration\n * @type {Map<string>}\n */\nexport let routerConfig\n\n/**\n * Component that hosts all attached widgets\n * @type {Lightning.Component}\n */\nexport let widgetsHost\n\n/**\n * Hash we point the browser to when we boot the app\n * and there is no deep-link provided\n * @type {string|Function}\n */\nlet rootHash\n\n/**\n * Boot request will fire before app start\n * can be used to execute some global logic\n * and can be configured\n */\nexport let bootRequest\n\n/**\n * Flag if we need to update the browser location hash.\n * Router can work without.\n * @type {boolean}\n */\nexport let updateHash = true\n\n/**\n * Will be called before a route starts, can be overridden\n * via routes config\n * @param from - route we came from\n * @param to - route we navigate to\n * @returns {Promise<*>}\n */\n// eslint-disable-next-line\nexport let beforeEachRoute = async (from, to)=>{\n  return true\n}\n\n/**\n *  * Will be called after a navigate successfully resolved,\n * can be overridden via routes config\n */\nexport let afterEachRoute = () => {}\n\n/**\n * All configured routes\n * @type {Map<string, object>}\n */\nexport let routes = new Map()\n\n/**\n * Store all page components per route\n * @type {Map<string, object>}\n */\nexport let components = new Map()\n\n/**\n * Flag if router has been initialised\n * @type {boolean}\n */\nlet initialised = false\n\n/**\n * Current page being rendered on screen\n * @type {null}\n */\nlet activePage = null\nlet activeHash\nlet activeRoute\n\n/**\n *  During the process of a navigation request a new\n *  request can start, to prevent unwanted behaviour\n *  the navigate()-method stores the last accepted hash\n *  so we can invalidate any prior requests\n */\nlet lastAcceptedHash\n\n/**\n * With on()-data providing behaviour the Router forced the App\n * in a Loading state. When the data-provider resolves we want to\n * change the state back to where we came from\n */\nlet previousState\n\nconst mixin = app => {\n  // by default the Router Baseclass provides the component\n  // reference in which we store our pages\n  if (app.pages) {\n    pagesHost = app.pages.childList\n  }\n  // if the app is using widgets we grab refs\n  // and hide all the widgets\n  if (app.widgets && app.widgets.children) {\n    widgetsHost = app.widgets.childList\n    // hide all widgets on boot\n    widgetsHost.forEach(w => (w.visible = false))\n  }\n  app._handleBack = e => {\n    step(-1)\n    e.preventDefault()\n  }\n}\n\nexport const bootRouter = (config, instance) => {\n  let { appInstance, routes } = config\n\n  // if instance is provided and it's and Lightning Component instance\n  if (instance && isPage(instance)) {\n    app = instance\n  }\n  if (!app) {\n    app = appInstance || AppInstance\n  }\n\n  application = app.application\n  pagesHost = application.childList\n  stage = app.stage\n  routerConfig = getConfigMap()\n\n  mixin(app)\n\n  if (isArray(routes)) {\n    setup(config)\n  } else if (isFunction(routes)) {\n    console.warn('[Router]: Calling Router.route() directly is deprecated.')\n    console.warn(\n      'Use object config: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration'\n    )\n  }\n}\n\nconst setup = config => {\n  if (!initialised) {\n    init(config)\n  }\n  config.routes.forEach(r => {\n    const path = cleanHash(r.path)\n    if (!routeExists(path)) {\n      const route = createRoute(r)\n      routes.set(path, route)\n      // if route has a configured component property\n      // we store it in a different map to simplify\n      // the creating and destroying per route\n      if (route.component) {\n        let type = route.component\n        if (isComponentConstructor(type)) {\n          if (!routerConfig.get('lazyCreate')) {\n            type = createComponent(stage, type)\n            pagesHost.a(type)\n          }\n        }\n        components.set(path, type)\n      }\n    } else {\n      console.error(`${path} already exists in routes configuration`)\n    }\n  })\n}\n\nconst init = config => {\n  rootHash = config.root\n  if (isFunction(config.boot)) {\n    bootRequest = config.boot\n  }\n  if (isBoolean(config.updateHash)) {\n    updateHash = config.updateHash\n  }\n  if (isFunction(config.beforeEachRoute)) {\n    beforeEachRoute = config.beforeEachRoute\n  }\n  if (isFunction(config.afterEachRoute)) {\n    afterEachRoute = config.afterEachRoute\n  }\n  if (config.bootComponent) {\n    console.warn(\n      '[Router]: Boot Component is now available as a special router: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration?id=special-routes'\n    )\n    console.warn(\n      '[Router]: setting { bootComponent } property will be deprecated in a future release'\n    )\n    if (isPage(config.bootComponent)) {\n      config.routes.push({\n        path: '$',\n        component: config.bootComponent,\n        // we try to assign the bootRequest as after data-provider\n        // so it will behave as any other component\n        after: bootRequest || null,\n        options: {\n          preventStorage: true,\n        },\n      })\n    } else {\n      console.error(`[Router]: ${config.bootComponent} is not a valid boot component`)\n    }\n  }\n  config.routes.forEach(item => {\n    // replacing regexes with 'R' to avoid issues with pattern matching below\n    const strippedPath = stripRegex(item.path)\n\n    // Pattern to identify the last path of the route\n    // It should start with \"/:\" + any word  and ends with \"?\"\n    // It should be the last path of the route\n    // valid => /player/:asset/:assetId? (:assetId is optional)\n    // invalid => /player/:asset/:assetId?/test (:assetId? is not an optional path)\n    // invalid => /player/:asset?/:assetId? (second path is not considered as an optional path)\n    const pattern = /.*\\/:.*?\\?$/u\n\n    if (pattern.test(strippedPath)) {\n      const optionalPath = item.path.substring(0, item.path.lastIndexOf('/'))\n      const originalPath = item.path.substring(0, item.path.lastIndexOf('?'))\n      item.path = originalPath\n      //Create another entry with the optional path\n      let optionalItem = { ...item }\n      optionalItem.path = optionalPath\n      config.routes.push(optionalItem)\n    }\n  })\n  initialised = true\n}\n\nexport const storeComponent = (route, type) => {\n  if (components.has(route)) {\n    components.set(route, type)\n  }\n}\n\nexport const getComponent = route => {\n  if (components.has(route)) {\n    return components.get(route)\n  }\n  return null\n}\n\n// delete existing route instance from memory\nexport const deleteCurrentInstance = route => {\n  if (components.has(route) && pagesHost.getIndex(components.get(route)) !== -1) {\n    pagesHost.remove(components.get(route))\n    storeComponent(route, components.get(route)._routedType || components.get(route).constructor)\n  }\n}\n\n/**\n * Test if router needs to update browser location hash\n * @returns {boolean}\n */\nexport const mustUpdateLocationHash = () => {\n  if (!routerConfig || !routerConfig.size) {\n    return false\n  }\n  // we need support to either turn change hash off\n  // per platform or per app\n  const updateConfig = routerConfig.get('updateHash')\n  return !((isBoolean(updateConfig) && !updateConfig) || (isBoolean(updateHash) && !updateHash))\n}\n\n/**\n * Will be called when a new navigate() request has completed\n * and has not been expired due to it's async nature\n * @param request\n */\nexport const onRequestResolved = request => {\n  const hash = request.hash\n  const route = request.route\n  const register = request.register\n  const page = request.page\n\n  // clean up history if modifier is set\n  if (getOption(route.options, 'clearHistory')) {\n    setHistory([])\n  } else if (hash && !isWildcard.test(route.path)) {\n    updateHistory(request)\n  }\n\n  // we only update the stackLocation if a route\n  // is not expired before it resolves\n  storeComponent(route.path, page)\n\n  if (request.isSharedInstance || !request.isCreated) {\n    emit(page, 'changed')\n  } else if (request.isCreated) {\n    emit(page, 'mounted')\n  }\n\n  // only update widgets if we have a host\n  if (widgetsHost) {\n    updateWidgets(route.widgets, page)\n  }\n\n  // we want to clean up if there is an\n  // active page that is not being shared\n  // between current and previous route\n  if (getActivePage() && !request.isSharedInstance) {\n    cleanUp(activePage, request)\n  }\n\n  // provide history object to active page\n  if (register.get(symbols.historyState) && isFunction(page.historyState)) {\n    page.historyState(register.get(symbols.historyState))\n  }\n\n  setActivePage(page)\n\n  activeHash = request.hash\n  activeRoute = route.path\n\n  // cleanup all cancelled requests\n  for (let request of navigateQueue.values()) {\n    if (request.isCancelled && request.hash) {\n      navigateQueue.delete(request.hash)\n    }\n  }\n\n  afterEachRoute(request)\n\n  Log.info('[route]:', route.path)\n  Log.info('[hash]:', hash)\n}\n\nconst cleanUp = (page, request) => {\n  const route = activeRoute\n  const register = request.register\n  const lazyDestroy = routerConfig.get('lazyDestroy')\n  const destroyOnBack = routerConfig.get('destroyOnHistoryBack')\n  const keepAlive = register.get('keepAlive')\n  const isFromHistory = register.get(symbols.backtrack)\n\n  let doCleanup = false\n\n  // if this request is executed due to a step back in history\n  // and we have configured to destroy active page when we go back\n  // in history or lazyDestory is enabled\n  if (isFromHistory && (destroyOnBack || lazyDestroy)) {\n    doCleanup = true\n  }\n\n  // clean up if lazyDestroy is enabled and the keepAlive flag\n  // in navigation register is false\n  if (lazyDestroy && !keepAlive) {\n    doCleanup = true\n  }\n\n  // if the current and new request share the same route blueprint\n  if (activeRoute === request.route.path) {\n    doCleanup = true\n  }\n\n  if (doCleanup) {\n    // grab original class constructor if\n    // statemachine routed else store constructor\n    storeComponent(route, page._routedType || page.constructor)\n\n    // actual remove of page from memory\n    pagesHost.remove(page)\n\n    // force texture gc() if configured\n    // so we can cleanup textures in the same tick\n    if (routerConfig.get('gcOnUnload')) {\n      stage.gc()\n    }\n  } else {\n    // If we're not removing the page we need to\n    // reset it's properties\n    page.patch({\n      x: 0,\n      y: 0,\n      scale: 1,\n      visible: false,\n      alpha: 1,\n    })\n  }\n}\n\nexport const getActiveHash = () => {\n  return activeHash\n}\n\nexport const setActiveHash = hash => {\n  activeHash = hash\n}\n\nexport const setActivePage = page => {\n  activePage = page\n}\n\nexport const getActivePage = () => {\n  return activePage\n}\n\nexport const getActiveRoute = () => {\n  return activeRoute\n}\n\nexport const getLastHash = () => {\n  return lastAcceptedHash\n}\n\nexport const setLastHash = hash => {\n  lastAcceptedHash = hash\n}\n\nexport const setPreviousState = state => {\n  previousState = state\n}\n\nexport const getPreviousState = () => {\n  return previousState\n}\n\nexport const routeExists = key => {\n  return routes.has(key)\n}\n\nexport const getRootHash = () => {\n  return rootHash\n}\n\nexport const getBootRequest = () => {\n  return bootRequest\n}\n\nexport const getRouterConfig = () => {\n  return routerConfig\n}\n\nexport const getRoutes = () => {\n  return routes\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Lightning from '../../Lightning'\nimport Settings from '../../Settings'\nimport { getActiveHash } from './router'\nimport { getResumeHash } from '../index'\n\nexport const isFunction = v => {\n  return typeof v === 'function'\n}\n\nexport const isObject = v => {\n  return typeof v === 'object' && v !== null\n}\n\nexport const isBoolean = v => {\n  return typeof v === 'boolean'\n}\n\nexport const isPage = v => {\n  if (v instanceof Lightning.Element || isComponentConstructor(v)) {\n    return true\n  }\n  return false\n}\n\nexport const isComponentConstructor = type => {\n  return type.prototype && 'isComponent' in type.prototype\n}\n\nexport const isArray = v => {\n  return Array.isArray(v)\n}\n\nexport const ucfirst = v => {\n  return `${v.charAt(0).toUpperCase()}${v.slice(1)}`\n}\n\nexport const isString = v => {\n  return typeof v === 'string'\n}\n\nexport const isPromise = method => {\n  let result\n  if (isFunction(method)) {\n    try {\n      result = method.apply(null)\n    } catch (e) {\n      result = e\n    }\n  } else {\n    result = method\n  }\n  return isObject(result) && isFunction(result.then)\n}\n\nexport const cleanHash = (hash = '') => {\n  return hash.replace(/^#/, '').replace(/\\/+$/, '')\n}\n\nexport const getConfigMap = () => {\n  const routerSettings = Settings.get('platform', 'router')\n  const isObj = isObject(routerSettings)\n  return [\n    'backtrack',\n    'gcOnUnload',\n    'destroyOnHistoryBack',\n    'lazyCreate',\n    'lazyDestroy',\n    'reuseInstance',\n    'autoRestoreRemote',\n    'numberNavigation',\n    'updateHash',\n    'storeSameHash',\n  ].reduce((config, key) => {\n    config.set(key, isObj ? routerSettings[key] : Settings.get('platform', key))\n    return config\n  }, new Map())\n}\n\nexport const incorrectParams = (cb, route) => {\n  const isIncorrect = /^\\w*?\\s?\\(\\s?\\{.*?\\}\\s?\\)/i\n  if (isIncorrect.test(cb.toString())) {\n    console.warn(\n      [\n        `DEPRECATION: The data-provider for route: ${route} is not correct.`,\n        '\"page\" is no longer a property of the params object but is now the first function parameter: ',\n        'https://github.com/rdkcentral/Lightning-SDK/blob/feature/router/docs/plugins/router/dataproviding.md#data-providing',\n        \"It's supported for now but will be removed in a future release.\",\n      ].join('\\n')\n    )\n    return true\n  }\n  return false\n}\n\nexport const getQueryStringParams = (hash = getActiveHash()) => {\n  const resumeHash = getResumeHash()\n  if ((hash === '$' || !hash) && resumeHash) {\n    if (isString(resumeHash)) {\n      hash = resumeHash\n    }\n  }\n\n  let parse = ''\n  const getQuery = /([?&].*)/\n  const matches = getQuery.exec(hash)\n  const params = {}\n\n  if (document.location && document.location.search) {\n    parse = document.location.search\n  }\n\n  if (matches && matches.length) {\n    let hashParams = matches[1]\n    if (parse) {\n      // if location.search is not empty we\n      // remove the leading ? to create a\n      // valid string\n      hashParams = hashParams.replace(/^\\?/, '')\n      // we parse hash params last so they we can always\n      // override search params with hash params\n      parse = `${parse}&${hashParams}`\n    } else {\n      parse = hashParams\n    }\n  }\n\n  if (parse) {\n    const urlParams = new URLSearchParams(parse)\n    for (const [key, value] of urlParams.entries()) {\n      params[key] = value\n    }\n    return params\n  } else {\n    return false\n  }\n}\n\nexport const objectToQueryString = obj => {\n  if (!isObject(obj)) {\n    return ''\n  }\n  return (\n    '?' +\n    Object.keys(obj)\n      .map(key => {\n        return `${key}=${obj[key]}`\n      })\n      .join('&')\n  )\n}\n\nexport const symbols = {\n  route: Symbol('route'),\n  hash: Symbol('hash'),\n  store: Symbol('store'),\n  fromHistory: Symbol('fromHistory'),\n  expires: Symbol('expires'),\n  resume: Symbol('resume'),\n  backtrack: Symbol('backtrack'),\n  historyState: Symbol('historyState'),\n  queryParams: Symbol('queryParams'),\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { symbols, getQueryStringParams } from './helpers'\nimport { app, routes, routeExists, setPreviousState } from './router'\nimport { getValuesFromHash } from './route'\nimport emit from './emit'\n\nexport const dataHooks = {\n  on: request => {\n    setPreviousState(app.state || '')\n    app._setState('Loading')\n    return execProvider(request)\n  },\n  before: request => {\n    return execProvider(request)\n  },\n  after: request => {\n    try {\n      execProvider(request, true)\n    } catch (e) {\n      // for now we fail silently\n    }\n    return Promise.resolve()\n  },\n}\n\nconst execProvider = (request, emitProvided) => {\n  const route = request.route\n  const provider = route.provider\n  const expires = route.cache ? route.cache * 1000 : 0\n  const params = addPersistData(request)\n  return provider\n    .request(request.page, { ...params })\n    .then(() => {\n      request.page[symbols.expires] = Date.now() + expires\n      if (emitProvided) {\n        emit(request.page, 'dataProvided')\n      }\n    })\n    .catch(e => {\n      request.page[symbols.expires] = Date.now()\n      throw e\n    })\n}\n\nexport const addPersistData = ({ page, route, hash, register = new Map() }) => {\n  const urlValues = getValuesFromHash(hash, route.path)\n  const queryParams = getQueryStringParams(hash)\n  const pageData = new Map([...urlValues, ...register])\n  const params = {}\n\n  // make dynamic url data available to the page\n  // as instance properties\n  for (let [name, value] of pageData) {\n    params[name] = value\n  }\n\n  if (queryParams) {\n    params[symbols.queryParams] = queryParams\n  }\n\n  // check navigation register for persistent data\n  if (register.size) {\n    const obj = {}\n    for (let [k, v] of register) {\n      obj[k] = v\n    }\n    page.persist = obj\n  }\n\n  // make url data and persist data available\n  // via params property\n  page.params = params\n  emit(page, ['urlParams'], params)\n\n  return params\n}\n\n/**\n * Test if page passed cache-time\n * @param page\n * @returns {boolean}\n */\nexport const isPageExpired = page => {\n  if (!page[symbols.expires]) {\n    return false\n  }\n\n  const expires = page[symbols.expires]\n  const now = Date.now()\n\n  return now >= expires\n}\n\nexport const hasProvider = path => {\n  if (routeExists(path)) {\n    const record = routes.get(path)\n    return !!record.provider\n  }\n  return false\n}\n\nexport const getProvider = route => {\n  // @todo: fix, route already is passed in\n  if (routeExists(route.path)) {\n    const { provider } = routes.get(route.path)\n    return {\n      type: provider.type,\n      provider: provider.request,\n    }\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst fade = (i, o) => {\n  return new Promise(resolve => {\n    i.patch({\n      alpha: 0,\n      visible: true,\n      smooth: {\n        alpha: [1, { duration: 0.5, delay: 0.1 }],\n      },\n    })\n    // resolve on y finish\n    i.transition('alpha').on('finish', () => {\n      if (o) {\n        o.visible = false\n      }\n      resolve()\n    })\n  })\n}\n\nconst crossFade = (i, o) => {\n  return new Promise(resolve => {\n    i.patch({\n      alpha: 0,\n      visible: true,\n      smooth: {\n        alpha: [1, { duration: 0.5, delay: 0.1 }],\n      },\n    })\n    if (o) {\n      o.patch({\n        smooth: {\n          alpha: [0, { duration: 0.5, delay: 0.3 }],\n        },\n      })\n    }\n    // resolve on y finish\n    i.transition('alpha').on('finish', () => {\n      resolve()\n    })\n  })\n}\n\nconst moveOnAxes = (axis, direction, i, o) => {\n  const bounds = axis === 'x' ? 1920 : 1080\n  return new Promise(resolve => {\n    i.patch({\n      [`${axis}`]: direction ? bounds * -1 : bounds,\n      visible: true,\n      smooth: {\n        [`${axis}`]: [0, { duration: 0.4, delay: 0.2 }],\n      },\n    })\n    // out is optional\n    if (o) {\n      o.patch({\n        [`${axis}`]: 0,\n        smooth: {\n          [`${axis}`]: [direction ? bounds : bounds * -1, { duration: 0.4, delay: 0.2 }],\n        },\n      })\n    }\n    // resolve on y finish\n    i.transition(axis).on('finish', () => {\n      resolve()\n    })\n  })\n}\n\nconst up = (i, o) => {\n  return moveOnAxes('y', 0, i, o)\n}\n\nconst down = (i, o) => {\n  return moveOnAxes('y', 1, i, o)\n}\n\nconst left = (i, o) => {\n  return moveOnAxes('x', 0, i, o)\n}\n\nconst right = (i, o) => {\n  return moveOnAxes('x', 1, i, o)\n}\n\nexport default {\n  fade,\n  crossFade,\n  up,\n  down,\n  left,\n  right,\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getRouterConfig } from './router'\nimport { isPromise, isString } from './helpers'\nimport Transitions from '../transitions'\n\n/**\n * execute transition between new / old page and\n * toggle the defined widgets\n * @todo: platform override default transition\n * @param pageIn\n * @param pageOut\n */\nexport const executeTransition = (pageIn, pageOut = null) => {\n  const transition = pageIn.pageTransition || pageIn.easing\n  const hasCustomTransitions = !!(pageIn.smoothIn || pageIn.smoothInOut || transition)\n  const transitionsDisabled = getRouterConfig().get('disableTransitions')\n\n  if (pageIn.easing) {\n    console.warn('easing() method is deprecated and will be removed. Use pageTransition()')\n  }\n\n  // default behaviour is a visibility toggle\n  if (!hasCustomTransitions || transitionsDisabled) {\n    pageIn.visible = true\n    if (pageOut) {\n      pageOut.visible = false\n    }\n    return Promise.resolve()\n  }\n\n  if (transition) {\n    let type\n    try {\n      type = transition.call(pageIn, pageIn, pageOut)\n    } catch (e) {\n      type = 'crossFade'\n    }\n\n    if (isPromise(type)) {\n      return type\n    }\n\n    if (isString(type)) {\n      const fn = Transitions[type]\n      if (fn) {\n        return fn(pageIn, pageOut)\n      }\n    }\n\n    // keep backwards compatible for now\n    if (pageIn.smoothIn) {\n      // provide a smooth function that resolves itself\n      // on transition finish\n      const smooth = (p, v, args = {}) => {\n        return new Promise(resolve => {\n          pageIn.visible = true\n          pageIn.setSmooth(p, v, args)\n          pageIn.transition(p).on('finish', () => {\n            resolve()\n          })\n        })\n      }\n      return pageIn.smoothIn({ pageIn, smooth })\n    }\n  }\n  return Transitions.crossFade(pageIn, pageOut)\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  app,\n  getComponent,\n  onRequestResolved,\n  getLastHash,\n  pagesHost,\n  stage,\n  getPreviousState,\n  getActivePage,\n  routerConfig,\n  routeExists,\n} from './router'\n\nimport Log from '../../Log'\nimport { isBoolean, isComponentConstructor, isFunction, symbols } from './helpers'\nimport { getProvider, hasProvider, isPageExpired, dataHooks, addPersistData } from './provider'\nimport { createComponent } from './components'\nimport { executeTransition } from './transition'\nimport { getActiveWidget } from './widgets'\nimport emit from './emit'\nimport { getOption } from './route'\nimport { navigate } from '../index'\nimport { setHistory, updateHistory } from './history'\nimport { isWildcard } from './regex'\n\n/**\n * The actual loading of the component\n * */\nexport const load = async request => {\n  let expired = false\n  try {\n    request = await loader(request)\n    if (request && !request.isCancelled) {\n      // in case of on() providing we need to reset\n      // app state;\n      if (app.state === 'Loading') {\n        if (getPreviousState() === 'Widgets') {\n          app._setState('Widgets', [getActiveWidget()])\n        } else {\n          app._setState('')\n        }\n      }\n      // Do page transition if instance\n      // is not shared between the routes\n      if (!request.isSharedInstance && !request.isCancelled) {\n        await executeTransition(request.page, getActivePage())\n      }\n    } else {\n      expired = true\n    }\n    // on expired we only cleanup\n    if (expired || request.isCancelled) {\n      Log.debug('[router]:', `Rejected ${request.hash} because route to ${getLastHash()} started`)\n      if (request.isCreated && !request.isSharedInstance) {\n        // remove from render-tree\n        pagesHost.remove(request.page)\n      }\n    } else {\n      onRequestResolved(request)\n      // resolve promise\n      return request.page\n    }\n  } catch (request) {\n    if (!request.route) {\n      console.error(request)\n    } else if (!expired) {\n      // @todo: revisit\n      const { route } = request\n      // clean up history if modifier is set\n      if (getOption(route.options, 'clearHistory')) {\n        setHistory([])\n      } else if (!isWildcard.test(route.path)) {\n        updateHistory(request)\n      }\n\n      if (request.isCreated && !request.isSharedInstance) {\n        // remove from render-tree\n        pagesHost.remove(request.page)\n      }\n      handleError(request)\n    }\n  }\n}\n\nconst loader = async request => {\n  const route = request.route\n  const hash = request.hash\n  const register = request.register\n\n  // todo: grab from Route instance\n  let type = getComponent(route.path)\n  let isConstruct = isComponentConstructor(type)\n  let provide = false\n\n  // if it's an instance bt we're not coming back from\n  // history we test if we can re-use this instance\n  if (!isConstruct && !register.get(symbols.backtrack)) {\n    if (!mustReuse(route)) {\n      type = type.constructor\n      isConstruct = true\n    }\n  }\n\n  // If page is Lightning Component instance\n  if (!isConstruct) {\n    request.page = type\n    // if we have have a data route for current page\n    if (hasProvider(route.path)) {\n      if (isPageExpired(type) || type[symbols.hash] !== hash) {\n        provide = true\n      }\n    }\n    let currentRoute = getActivePage() && getActivePage()[symbols.route]\n    // if the new route is equal to the current route it means that both\n    // route share the Component instance and stack location / since this case\n    // is conflicting with the way before() and after() loading works we flag it,\n    // and check platform settings in we want to re-use instance\n    if (route.path === currentRoute) {\n      request.isSharedInstance = true\n      // since we're re-using the instance we must attach\n      // historyState to the request to prevent it from\n      // being overridden.\n      if (isFunction(request.page.historyState)) {\n        request.copiedHistoryState = request.page.historyState()\n      }\n    }\n  } else {\n    request.page = createComponent(stage, type)\n    pagesHost.a(request.page)\n    // test if need to request data provider\n    if (hasProvider(route.path)) {\n      provide = true\n    }\n    request.isCreated = true\n  }\n\n  // we store hash and route as properties on the page instance\n  // that way we can easily calculate new behaviour on page reload\n  request.page[symbols.hash] = hash\n  request.page[symbols.route] = route.path\n\n  try {\n    if (provide) {\n      // extract attached data-provider for route\n      // we're processing\n      const { type: loadType, provider } = getProvider(route)\n\n      // update running request\n      request.provider = provider\n      request.providerType = loadType\n\n      await dataHooks[loadType](request)\n\n      // we early exit if the current request is expired\n      if (hash !== getLastHash()) {\n        return false\n      } else {\n        if (request.providerType !== 'after') {\n          emit(request.page, 'dataProvided')\n        }\n        // resolve promise\n        return request\n      }\n    } else {\n      addPersistData(request)\n      return request\n    }\n  } catch (e) {\n    request.error = e\n    return Promise.reject(request)\n  }\n}\n\nconst handleError = request => {\n  if (request && request.error) {\n    console.error(request.error)\n  } else if (request) {\n    Log.error(request)\n  }\n\n  if (request.page && routeExists('!')) {\n    navigate('!', { request }, false)\n  }\n}\n\nexport const mustReuse = route => {\n  const opt = getOption(route.options, 'reuseInstance')\n  const config = routerConfig.get('reuseInstance')\n\n  // route always has final decision\n  if (isBoolean(opt)) {\n    return opt\n  }\n  return !(isBoolean(config) && config === false)\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Lightning from '../Lightning'\nimport { default as Router } from './index'\nimport { routerConfig } from './utils/router.js'\nimport { isBoolean } from './utils/helpers'\n\nexport class RoutedApp extends Lightning.Component {\n  static _template() {\n    return {\n      Pages: {\n        forceZIndexContext: true,\n      },\n      /**\n       * This is a default Loading page that will be made visible\n       * during data-provider on() you CAN override in child-class\n       */\n      Loading: {\n        rect: true,\n        w: 1920,\n        h: 1080,\n        color: 0xff000000,\n        visible: false,\n        zIndex: 99,\n        Label: {\n          mount: 0.5,\n          x: 960,\n          y: 540,\n          text: {\n            text: 'Loading..',\n          },\n        },\n      },\n    }\n  }\n\n  static _states() {\n    return [\n      class Loading extends this {\n        $enter() {\n          this.tag('Loading').visible = true\n        }\n\n        $exit() {\n          this.tag('Loading').visible = false\n        }\n      },\n      class Widgets extends this {\n        $enter(args, widget) {\n          // store widget reference\n          this._widget = widget\n\n          // since it's possible that this behaviour\n          // is non-remote driven we force a recalculation\n          // of the focuspath\n          this._refocus()\n        }\n\n        _getFocused() {\n          // we delegate focus to selected widget\n          // so it can consume remotecontrol presses\n          return this._widget\n        }\n\n        // if we want to widget to widget focus delegation\n        reload(widget) {\n          this._widget = widget\n          this._refocus()\n        }\n\n        _handleKey() {\n          const restoreFocus = routerConfig.get('autoRestoreRemote')\n          /**\n           * The Router used to delegate focus back to the page instance on\n           * every unhandled key. This is barely usefull in any situation\n           * so for now we offer the option to explicity turn that behaviour off\n           * so we don't don't introduce a breaking change.\n           */\n          if (!isBoolean(restoreFocus) || restoreFocus === true) {\n            Router.focusPage()\n          }\n        }\n      },\n    ]\n  }\n\n  /**\n   * Return location where pages need to be stored\n   */\n  get pages() {\n    return this.tag('Pages')\n  }\n\n  /**\n   * Tell router where widgets are stored\n   */\n  get widgets() {\n    return this.tag('Widgets')\n  }\n\n  /**\n   * we MUST register _handleBack method so the Router\n   * can override it\n   * @private\n   */\n  _handleBack() {}\n\n  /**\n   * We MUST return Router.activePage() so the new Page\n   * can listen to the remote-control.\n   */\n  _getFocused() {\n    return Router.getActivePage()\n  }\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  isFunction,\n  isPage,\n  isObject,\n  isBoolean,\n  isString,\n  getQueryStringParams,\n  symbols,\n  cleanHash,\n} from './utils/helpers'\n\nimport {\n  bootRouter,\n  routeExists,\n  getRootHash,\n  getBootRequest,\n  mustUpdateLocationHash,\n  getComponent,\n  storeComponent,\n  stage,\n  app,\n  routerConfig,\n  setLastHash,\n  getActivePage,\n  beforeEachRoute,\n  getActiveHash,\n  getActiveRoute,\n  deleteCurrentInstance,\n} from './utils/router'\n\nimport { focusWidget, getActiveWidget, restoreFocus } from './utils/widgets'\nimport { getHistory, setHistory, getHistoryState, replaceHistoryState } from './utils/history'\nimport {\n  createRequest,\n  getRouteByHash,\n  getValuesFromHash,\n  getFloor,\n  getHashByName,\n  keepActivePageAlive,\n} from './utils/route'\nimport { load } from './utils/loader'\nimport { stripRegex, isWildcard } from './utils/regex'\nimport { RoutedApp } from './base'\nimport Registry from '../Registry'\n\n/*\nrouThor ==[x]\n */\nexport let navigateQueue = new Map()\nlet forcedHash = ''\nlet resumeHash = ''\n\n/**\n * Start routing the app\n * @param config - route config object\n * @param instance - instance of the app\n */\nconst startRouter = (config, instance) => {\n  bootRouter(config, instance)\n  registerListener()\n  start()\n}\n\n// start translating url\nconst start = () => {\n  let hash = (getHash() || '').replace(/^#/, '')\n  const bootKey = '$'\n  const params = getQueryStringParams(hash)\n  const bootRequest = getBootRequest()\n  const rootHash = getRootHash()\n  const isDirectLoad = hash.indexOf(bootKey) !== -1\n\n  // prevent direct reload of wildcard routes\n  // expect bootComponent\n  if (isWildcard.test(hash) && hash !== bootKey) {\n    hash = ''\n  }\n\n  // store resume point for manual resume\n  resumeHash = isDirectLoad ? rootHash : hash || rootHash\n\n  const ready = () => {\n    if (!hash && rootHash) {\n      if (isString(rootHash)) {\n        navigate(rootHash)\n      } else if (isFunction(rootHash)) {\n        rootHash().then(res => {\n          if (isObject(res)) {\n            navigate(res.path, res.params)\n          } else {\n            navigate(res)\n          }\n        })\n      }\n    } else {\n      queue(hash)\n      handleHashChange()\n        .then(() => {\n          app._refocus()\n        })\n        .catch(e => {\n          console.error(e)\n        })\n    }\n  }\n\n  if (routeExists(bootKey)) {\n    if (hash && !isDirectLoad) {\n      if (!getRouteByHash(hash)) {\n        navigate('*', { failedHash: hash })\n        return\n      }\n    }\n    navigate(\n      bootKey,\n      {\n        resume: resumeHash,\n        reload: bootKey === hash,\n      },\n      false\n    )\n  } else if (isFunction(bootRequest)) {\n    bootRequest(params)\n      .then(() => {\n        ready()\n      })\n      .catch(e => {\n        handleBootError(e)\n      })\n  } else {\n    ready()\n  }\n}\n\nconst handleBootError = e => {\n  if (routeExists('!')) {\n    navigate('!', { request: { error: e } })\n  } else {\n    console.error(e)\n  }\n}\n\n/**\n * start a new request\n * @param url\n * @param args\n * @param store\n */\nexport const navigate = (url, args = {}, store) => {\n  if (isObject(url)) {\n    url = getHashByName(url)\n    if (!url) {\n      return\n    }\n  }\n\n  let hash = getHash()\n  if (!mustUpdateLocationHash() && forcedHash) {\n    hash = forcedHash\n  }\n  if (hash.replace(/^#/, '') !== url) {\n    // push request in the queue\n    queue(url, args, store)\n\n    if (mustUpdateLocationHash()) {\n      setHash(url)\n    } else {\n      forcedHash = url\n      handleHashChange(url)\n        .then(() => {\n          app._refocus()\n        })\n        .catch(e => {\n          console.error(e)\n        })\n    }\n  } else if (args.reload) {\n    // push request in the queue\n    queue(url, args, store)\n\n    handleHashChange(url)\n      .then(() => {\n        app._refocus()\n      })\n      .catch(e => {\n        console.error(e)\n      })\n  }\n}\n\nconst queue = (hash, args = {}, store) => {\n  hash = cleanHash(hash)\n  if (!navigateQueue.has(hash)) {\n    for (let request of navigateQueue.values()) {\n      request.cancel()\n    }\n    const request = createRequest(hash, args, store)\n    navigateQueue.set(decodeURIComponent(hash), request)\n\n    return request\n  }\n  return false\n}\n\n/**\n * Handle change of hash\n * @param override\n * @returns {Promise<void>}\n */\nconst handleHashChange = async override => {\n  const hash = cleanHash(override || getHash())\n  const queueId = decodeURIComponent(hash)\n  let request = navigateQueue.get(queueId)\n\n  // handle hash updated manually\n  if (!request && !navigateQueue.size) {\n    request = queue(hash)\n  }\n\n  const route = getRouteByHash(hash)\n\n  if (!route) {\n    if (routeExists('*')) {\n      navigate('*', { failedHash: hash })\n    } else {\n      console.error(`Unable to navigate to: ${hash}`)\n    }\n    return\n  }\n\n  // update current processed request\n  request.hash = hash\n  request.route = route\n\n  let result = await beforeEachRoute(getActiveHash(), request)\n\n  // test if a local hook is configured for the route\n  if (result && route.beforeNavigate) {\n    result = await route.beforeNavigate(getActiveHash(), request)\n  }\n\n  if (isBoolean(result)) {\n    // only if resolve value is explicitly true\n    // we continue the current route request\n    if (result) {\n      return resolveHashChange(request)\n    }\n  } else {\n    // if navigation guard didn't return true\n    // we cancel the current request\n    request.cancel()\n    navigateQueue.delete(queueId)\n\n    if (isString(result)) {\n      navigate(result)\n    } else if (isObject(result)) {\n      let store = true\n      if (isBoolean(result.store)) {\n        store = result.store\n      }\n      navigate(result.path, result.params, store)\n    }\n  }\n}\n\n/**\n * Continue processing the hash change if not blocked\n * by global or local hook\n * @param request - {}\n */\nconst resolveHashChange = request => {\n  const hash = request.hash\n  const route = request.route\n  const queueId = decodeURIComponent(hash)\n  // store last requested hash so we can\n  // prevent a route that resolved later\n  // from displaying itself\n  setLastHash(hash)\n\n  if (route.path) {\n    const component = getComponent(route.path)\n    // if a hook is provided for the current route\n    if (isFunction(route.hook)) {\n      const urlParams = getValuesFromHash(hash, route.path)\n      const params = {}\n      for (const key of urlParams.keys()) {\n        params[key] = urlParams.get(key)\n      }\n      route.hook(app, { ...params })\n    }\n    // if there is a component attached to the route\n    if (component) {\n      // force page to root state to prevent shared state issues\n      const activePage = getActivePage()\n      if (activePage) {\n        const keepAlive = keepActivePageAlive(getActiveRoute(), request)\n        if (activePage && route.path === getActiveRoute() && !keepAlive) {\n          activePage._setState('')\n        }\n      }\n\n      if (isPage(component, stage)) {\n        load(request).then(() => {\n          app._refocus()\n          navigateQueue.delete(queueId)\n        })\n      } else {\n        // of the component is not a constructor\n        // or a Component instance we can assume\n        // that it's a dynamic import\n        component()\n          .then(contents => {\n            return contents.default\n          })\n          .then(module => {\n            storeComponent(route.path, module)\n            return load(request)\n          })\n          .then(() => {\n            app._refocus()\n            navigateQueue.delete(queueId)\n          })\n      }\n    } else {\n      navigateQueue.delete(queueId)\n    }\n  }\n}\n\n/**\n * Directional step in history\n * @param level\n */\nexport const step = (level = 0) => {\n  if (!level || isNaN(level)) {\n    return false\n  }\n  const history = getHistory()\n  // for now we only support negative numbers\n  level = Math.abs(level)\n\n  //Check whether we have any history avaialble or not\n  if (history.length) {\n    // for now we only support history back\n    const route = history.splice(history.length - level, level)[0]\n    // store changed history\n    setHistory(history)\n    return navigate(\n      route.hash,\n      {\n        [symbols.backtrack]: true,\n        [symbols.historyState]: route.state,\n      },\n      false\n    )\n  } else if (routerConfig.get('backtrack')) {\n    const hashLastPart = /(\\/:?[\\w%\\s-]+)$/\n    let hash = stripRegex(getHash())\n    let floor = getFloor(hash)\n\n    // test if we got deep-linked\n    if (floor > 1) {\n      while (floor--) {\n        // strip of last part\n        hash = hash.replace(hashLastPart, '')\n        // if we have a configured route\n        // we navigate to it\n        if (getRouteByHash(hash)) {\n          return navigate(hash, { [symbols.backtrack]: true }, false)\n        }\n      }\n    }\n  }\n\n  // we can't step back past the amount\n  // of history entries\n  if (level > history.length) {\n    if (isFunction(app._handleAppClose)) {\n      return app._handleAppClose()\n    }\n    return app.application.closeApp()\n  }\n  return false\n}\n\n/**\n * Resume Router's page loading process after\n * the BootComponent became visible;\n */\nconst resume = () => {\n  if (isString(resumeHash)) {\n    navigate(resumeHash, false)\n    resumeHash = ''\n  } else if (isFunction(resumeHash)) {\n    resumeHash().then(res => {\n      resumeHash = ''\n      if (isObject(res)) {\n        navigate(res.path, res.params)\n      } else {\n        navigate(res)\n      }\n    })\n  } else {\n    console.warn('[Router]: resume() called but no hash found')\n  }\n}\n\n/**\n * Force reload active hash\n */\nconst reload = () => {\n  if (!isNavigating()) {\n    const hash = getActiveHash()\n    navigate(hash, { reload: true }, false)\n  }\n}\n\n/**\n * Query if the Router is still processing a Request\n * @returns {boolean}\n */\nconst isNavigating = () => {\n  if (navigateQueue.size) {\n    let isProcessing = false\n    for (let request of navigateQueue.values()) {\n      if (!request.isCancelled) {\n        isProcessing = true\n      }\n    }\n    return isProcessing\n  }\n  return false\n}\n\nexport const getResumeHash = () => {\n  return resumeHash\n}\n\n/**\n * By default we return the location hash\n * @returns {string}\n */\nlet getHash = () => {\n  return document.location.hash\n}\n\n/**\n * Update location hash\n * @param url\n */\nlet setHash = url => {\n  document.location.hash = url\n}\n\n/**\n * This can be called from the platform / bootstrapper to override\n * the default getting and setting of the hash\n * @param config\n */\nexport const initRouter = config => {\n  if (config.getHash) {\n    getHash = config.getHash\n  }\n  if (config.setHash) {\n    setHash = config.setHash\n  }\n}\n\n/**\n * On hash change we start processing\n */\nconst registerListener = () => {\n  Registry.addEventListener(window, 'hashchange', async () => {\n    if (mustUpdateLocationHash()) {\n      try {\n        await handleHashChange()\n      } catch (e) {\n        console.error(e)\n      }\n    }\n  })\n}\n\n/**\n * Navigate to root hash\n */\nconst root = () => {\n  const rootHash = getRootHash()\n  if (isString(rootHash)) {\n    navigate(rootHash)\n  } else if (isFunction(rootHash)) {\n    rootHash().then(res => {\n      if (isObject(res)) {\n        navigate(res.path, res.params)\n      } else {\n        navigate(res)\n      }\n    })\n  }\n}\n\nconst deletePage = (param) => {\n  deleteCurrentInstance(param)\n}\n\n// export API\nexport default {\n  startRouter,\n  navigate,\n  resume,\n  step,\n  go: step,\n  back: step.bind(null, -1),\n  activePage: getActivePage,\n  getActivePage() {\n    // warning\n    return getActivePage()\n  },\n  deletePage,\n  getActiveRoute,\n  getActiveHash,\n  focusWidget,\n  getActiveWidget,\n  restoreFocus,\n  isNavigating,\n  getHistory,\n  setHistory,\n  getHistoryState,\n  replaceHistoryState,\n  getQueryStringParams,\n  reload,\n  symbols,\n  App: RoutedApp,\n  // keep backwards compatible\n  focusPage: restoreFocus,\n  root: root,\n  /**\n   * Deprecated api methods\n   */\n  setupRoutes() {\n    console.warn('Router: setupRoutes is deprecated, consolidate your configuration')\n    console.warn('https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration')\n  },\n  on() {\n    console.warn('Router.on() is deprecated, consolidate your configuration')\n    console.warn('https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration')\n  },\n  before() {\n    console.warn('Router.before() is deprecated, consolidate your configuration')\n    console.warn('https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration')\n  },\n  after() {\n    console.warn('Router.after() is deprecated, consolidate your configuration')\n    console.warn('https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration')\n  },\n}\n","import {\r\n  IntrinsicNodeProps,\r\n  View,\r\n  Text,\r\n  ElementNode,\r\n  activeElement,\r\n  hexColor,\r\n} from \"@lightningjs/solid\";\r\nimport styles from \"./ListSlider.style\";\r\nimport { For, createEffect, createSelector, createSignal, on } from \"solid-js\";\r\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\r\nimport { FocusRing, TileRow } from \"..\";\r\nimport theme from \"theme\";\r\nimport { Column, Row } from \"@lightningjs/solid-primitives\";\r\nimport { navigate } from \"@lightningjs/sdk/src/Router\";\r\nimport Thumbnail from \"../Thumnail\";\r\nexport default function ListSlider(props: IntrinsicNodeProps) {\r\n  console.log(props.type);\r\n  let focusRingRef;\r\n  const isFirst = createSelector(() => {\r\n    return 0;\r\n  });\r\n\r\n  const [rowX, setRowX] = createSignal(props.x);\r\n\r\n  function moveRow(row) {\r\n    console.log(\"row\", row);\r\n    if(row.selected === 0){\r\n      setRowX(90)\r\n    }else {\r\n      setRowX(row.selected * -row.children[0]._width + 10);\r\n    }\r\n    \r\n  }\r\n  function onEnter(this: ElementNode) {\r\n    let entity = this.children.selected;\r\n    assertTruthy(entity && entity.id);\r\n    navigate(\"/\" + entity.id);\r\n  }\r\n\r\n  // console.log('props',props)\r\n  return (\r\n    <View clipping style={styles.itemsContainer}>\r\n      <TileRow\r\n        animate\r\n        gap={10}\r\n        x={rowX()}\r\n        y={props.y}\r\n        width={4400}\r\n        style={styles.Row}\r\n        justifyContent={\"flexStart\"}\r\n        autofocus={isFirst(0)}\r\n        onSelectedChanged={moveRow}\r\n        items={props.data}\r\n        onFocus={props.onFocus}\r\n        onEnter={props.onEnter}\r\n      />\r\n    </View>\r\n  );\r\n}\r\n","import { createEffect, createMemo, on, createSignal,\r\n  Show, createResource, createSelector, For, onMount } from \"solid-js\";\r\nimport { ElementNode, View, activeElement } from '@lightningjs/solid';\r\nimport { Column } from '@lightningjs/solid-primitives';\r\nimport { useNavigate, useParams } from \"@solidjs/router\";\r\nimport { TileRow } from '../components';\r\nimport styles from '../styles';\r\nimport { setGlobalBackground } from \"../state\";\r\nimport browseProvider from '../api/providers/browse';\r\nimport { createInfiniteScroll } from '../components/pagination';\r\nimport ContentBlock from \"../components/ContentBlock\";\r\nimport * as entityProvider from '../api/providers/entity';\r\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\r\nimport ListColumn from \"../components/ListColumn\";\r\nimport ListSlider from \"../components/ListSlider\";\r\n\r\nconst Browse = () => {\r\n  const params = useParams();\r\n  const [columnY, setcolumnY] = createSignal(0);\r\n  const [entityInfo, setEntityInfo] = createSignal();\r\n  const [entityData] = createResource(entityInfo, entityProvider.getInfo);\r\n  const [heroContent, setHeroContent] = createSignal({});\r\n  const navigate = useNavigate();\r\n  const isFirst = createSelector(() => {\r\n    return 0;\r\n  });\r\n\r\n  const provider = createMemo(() => {\r\n    return createInfiniteScroll(browseProvider(params.filter || 'all', 8));\r\n  });\r\n  createEffect(on(activeElement, (elm) => {\r\n    if (elm.backdrop) {\r\n      setGlobalBackground(elm.backdrop);\r\n    }\r\n    // if (elm.entityInfo) {\r\n    //   setEntityInfo(elm.entityInfo);\r\n    // }\r\n    if (elm.heroContent) {\r\n      setHeroContent(elm.heroContent);\r\n    }\r\n    \r\n  }, { defer: true}))\r\n\r\n\r\n  function onEnter(this: ElementNode) {\r\n    let entity = this.children.selected;\r\n    assertTruthy(entity && entity.href);\r\n    navigate(entity.href)\r\n  };\r\n\r\n  return (\r\n    <Show when={provider().pages().length}>\r\n      <ContentBlock y={200} x={90} {...heroContent()}></ContentBlock>\r\n      <ListSlider x={90}  y={50} onEnter={onEnter} data={[...provider().pages()[0]]}/>\r\n    </Show>\r\n  );\r\n};\r\n\r\nexport default Browse;\r\n","import { render, Canvas, Config } from '@lightningjs/solid';\r\nimport { HashRouter, Route } from \"@solidjs/router\";\r\nimport App from './pages/App';\r\nimport coreExtensionModuleUrl from './AppCoreExtensions.js?importChunkUrl';\r\nimport coreWorkerUrl from './threadx-core-worker.js?importChunkUrl';\r\nimport HomePage from './pages/Home';\r\nimport SearchPage from './pages/Search';\r\nimport VideoPage from './pages/Video';\r\nimport TiviPage from './pages/Tivi';\r\nimport NotFound from './pages/NotFound';\r\nimport Videos from './pages/Videos';\r\nimport EXListSlider from './pages/EXListSlider';\r\n\r\nConfig.debug = false;\r\nConfig.fontSettings.fontFamily = 'Ubuntu';\r\nConfig.fontSettings.color = 0xffffffff;\r\n\r\nconst driver = 'main' as 'main' | 'threadx';\r\n\r\nrender(() =>  (\r\n  <Canvas options={{\r\n    coreExtensionModule: coreExtensionModuleUrl,\r\n    threadXCoreWorkerUrl: driver === 'threadx' ? coreWorkerUrl : undefined,\r\n    deviceLogicalPixelRatio: 0.5,\r\n    appWidth: 1920, appHeight: 1080\r\n  }}>\r\n    <HashRouter root={App}>\r\n      <Route path=\"/\" component={HomePage} />\r\n      <Route path=\"/search\" component={SearchPage} />\r\n      <Route path=\"/videos\" component={Videos} />\r\n      <Route path=\"/tv\" component={TiviPage} />\r\n      <Route path=\"/*all\" component={NotFound} />\r\n      <Route path=\"/list\" component={EXListSlider} />\r\n    </HashRouter>\r\n  </Canvas>\r\n));\r\n"],"file":"assets/index-478a4c27.js"}